import{default as e}from'https://testingcf.jsdelivr.net/npm/cytoscape/+esm';import{default as t}from'https://testingcf.jsdelivr.net/npm/cytoscape-cola/+esm';import{default as a}from'https://testingcf.jsdelivr.net/npm/cytoscape-fcose/+esm';import{default as o}from'https://testingcf.jsdelivr.net/npm/cytoscape-node-html-label/+esm';import*as n from'https://testingcf.jsdelivr.net/npm/klona/+esm';import*as r from'https://testingcf.jsdelivr.net/npm/pinia/+esm';import{polyfill as i}from'https://testingcf.jsdelivr.net/npm/mobile-drag-drop/+esm';import'https://testingcf.jsdelivr.net/npm/mobile-drag-drop/default.css/+esm';import{scrollBehaviourDragImageTranslateOverride as l}from'https://testingcf.jsdelivr.net/npm/mobile-drag-drop/scroll-behaviour/+esm';import{v4 as c}from'https://testingcf.jsdelivr.net/npm/uuid/+esm';var s={6350(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},8067(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},1416(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},1703(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},6489(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},9210(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},5285(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},8875(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},21(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},7886(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'.acu-word-pool-search[data-v-244ae7d6]{width:100%;padding:8px 12px;border-radius:var(--acu-radius-md);border:1px solid var(--acu-border);background:var(--acu-input-bg);color:var(--acu-text-main);font-size:13px}.acu-word-pool-search[data-v-244ae7d6]:focus{border-color:var(--acu-title-color);outline:none}.acu-word-pool-item[data-v-244ae7d6]:last-child{border-bottom:none !important}','',{version:3,sources:['webpack://./src/可视化表格/components/settings/divination/WordPoolPanel.vue'],names:[],mappings:'AAEA,uCACE,UAAA,CACA,gBAAA,CACA,kCAAA,CACA,kCAAA,CACA,8BAAA,CACA,0BAAA,CACA,cAAA,CAEA,6CACE,mCAAA,CACA,YAAA,CAIJ,gDACE,6BAAA',sourcesContent:['\n// 样式使用全局类，这里只写少量特定的\n.acu-word-pool-search {\n  width: 100%;\n  padding: 8px 12px;\n  border-radius: var(--acu-radius-md);\n  border: 1px solid var(--acu-border);\n  background: var(--acu-input-bg);\n  color: var(--acu-text-main);\n  font-size: 13px;\n\n  &:focus {\n    border-color: var(--acu-title-color);\n    outline: none;\n  }\n}\n\n.acu-word-pool-item:last-child {\n  border-bottom: none !important;\n}\n'],sourceRoot:''}]);const l=i},1569(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'\n','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},1829(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'\n','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},1656(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'\n','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},4850(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'\n','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const l=i},8537(e,t,a){a.r(t),a.d(t,{default:()=>l});var o=a(5016),n=a.n(o),r=a(5048),i=a.n(r)()(n());i.push([e.id,'.template-settings-group[data-v-2a4c34ca]{padding:12px;display:flex;flex-direction:column;gap:12px}.template-shortcuts-row[data-v-2a4c34ca]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.template-shortcuts-row .hint[data-v-2a4c34ca]{font-size:12px;color:var(--acu-text-sub)}.acu-wildcard-btn[data-v-2a4c34ca]{background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:4px;padding:2px 6px;cursor:pointer;font-size:12px;color:var(--acu-title-color);transition:all 0.2s}.acu-wildcard-btn[data-v-2a4c34ca]:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color)}.acu-wildcard-btn code[data-v-2a4c34ca]{font-family:monospace}.template-textarea[data-v-2a4c34ca]{min-height:120px;resize:vertical;line-height:1.5;font-family:monospace;width:100%;pointer-events:auto !important}.acu-wildcard-help[data-v-2a4c34ca]{background:rgba(0,0,0,0.05);border-radius:8px;padding:8px 12px}.acu-help-header[data-v-2a4c34ca]{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:12px;color:var(--acu-text-sub);-webkit-user-select:none;user-select:none}.acu-help-header strong[data-v-2a4c34ca]{flex:1}.acu-wildcard-help ul[data-v-2a4c34ca]{margin:8px 0 0 0;padding-left:20px;list-style-type:disc;font-size:12px;color:var(--acu-text-sub)}.acu-wildcard-help li[data-v-2a4c34ca]{margin-bottom:4px}.acu-wildcard-help code[data-v-2a4c34ca]{background:rgba(0,0,0,0.1);padding:0 4px;border-radius:3px;font-family:monospace;color:var(--acu-text-main)}\n','',{version:3,sources:['webpack://./src/可视化表格/components/settings/divination/DimensionManagerPanel.vue'],names:[],mappings:'AA+eA,0CACE,YAAa,CACb,YAAa,CACb,qBAAsB,CACtB,QACF,CAEA,yCACE,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,cACF,CAEA,+CACE,cAAe,CACf,yBACF,CAEA,mCACE,8BAA+B,CAC/B,kCAAmC,CACnC,iBAAkB,CAClB,eAAgB,CAChB,cAAe,CACf,cAAe,CACf,4BAA6B,CAC7B,mBACF,CAEA,yCACE,+BAAgC,CAChC,mCACF,CAEA,wCACE,qBACF,CAEA,oCACE,gBAAiB,CACjB,eAAgB,CAChB,eAAgB,CAChB,qBAAsB,CACtB,UAAW,CACX,8BACF,CAEA,oCACE,2BAA+B,CAC/B,iBAAkB,CAClB,gBACF,CAEA,kCACE,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,cAAe,CACf,cAAe,CACf,yBAA0B,CAC1B,wBAAiB,CAAjB,gBACF,CAEA,yCACE,MACF,CAEA,uCACE,gBAAiB,CACjB,iBAAkB,CAClB,oBAAqB,CACrB,cAAe,CACf,yBACF,CAEA,uCACE,iBACF,CAEA,yCACE,0BAA8B,CAC9B,aAAc,CACd,iBAAkB,CAClB,qBAAsB,CACtB,0BACF',sourcesContent:['<template>\n  <div class="acu-dimension-manager">\n    \x3c!-- 预设管理头部 --\x3e\n    <PresetManagerHeader\n      :presets="divinationStore.presets"\n      :active-preset-id="divinationStore.activePresetId"\n      :show-toolbar="true"\n      :is-migrating="isMigrating"\n      :selected-count="selectedDimensionIds.size"\n      title="维度预设"\n      hint="保存和加载维度配置"\n      @select="handleSelectPreset"\n      @restore-default="handleRestoreDefault"\n      @delete="handleDeletePreset"\n      @save="handleQuickSave"\n      @save-as="openSaveDialog"\n      @collapse-all="collapseAll"\n      @expand-all="expandAll"\n      @import="triggerImport"\n      @export-current="handleExportCurrentPreset"\n      @export-all="handleExportPresets"\n      @toggle-migrate="toggleMigrateMode"\n      @migrate-to="handleMigrateTo"\n    />\n\n    \x3c!-- 维度列表 --\x3e\n    <div\n      v-for="(dim, dimIndex) in divinationStore.config.dimensions"\n      :key="dim.id"\n      class="acu-settings-section dimension-container"\n      :class="{\n        \'is-collapsed\': collapsedDimensions[dim.id],\n        \'is-selected\': isMigrating && selectedDimensionIds.has(dim.id),\n      }"\n      @click="isMigrating ? toggleDimensionSelection(dim.id) : null"\n    >\n      \x3c!-- 维度标题行 --\x3e\n      <div class="acu-settings-title dimension-header" @click="!isMigrating && toggleCollapse(dim.id)">\n        <div class="header-left">\n          <i class="fas fa-chevron-right collapse-icon" :class="{ \'is-expanded\': !collapsedDimensions[dim.id] }"></i>\n          <input v-model="dim.name" class="acu-input-minimal dimension-name-input" placeholder="维度名称" @click.stop />\n        </div>\n        <div class="header-right">\n          <label class="acu-switch" @click.stop>\n            <input v-model="dim.enabled" type="checkbox" />\n            <span class="slider"></span>\n          </label>\n          <button\n            class="acu-icon-btn danger"\n            :disabled="dim.id === \'luck\'"\n            :title="dim.id === \'luck\' ? \'运势维度不可删除\' : \'删除维度\'"\n            @click.stop="handleRemoveDimension(dimIndex)"\n          >\n            <i class="fas fa-trash"></i>\n          </button>\n        </div>\n      </div>\n\n      \x3c!-- 档位列表 (展开区域) --\x3e\n      <div v-show="!collapsedDimensions[dim.id]" class="dimension-content">\n        <div class="tier-list">\n          <div v-for="(tier, tierIndex) in dim.tiers" :key="tier.id" class="tier-item">\n            \x3c!-- 第一行: 基本信息 --\x3e\n            <div class="tier-row basic-info">\n              <div class="tier-name-wrapper">\n                <input v-model="tier.name" class="acu-input-minimal tier-name-input" placeholder="档位名称" />\n                \x3c!-- 颜色选择器 (仅运势维度显示) --\x3e\n                <input\n                  v-if="dim.id === \'luck\'"\n                  v-model="tier.color"\n                  type="color"\n                  class="acu-color-picker-mini"\n                  title="档位颜色"\n                />\n              </div>\n              <button class="acu-icon-btn small danger" title="删除档位" @click="removeTier(dimIndex, tierIndex)">\n                <i class="fas fa-times"></i>\n              </button>\n            </div>\n\n            \x3c!-- 第二行: 权重调节 --\x3e\n            <div class="tier-row weight-control">\n              <span class="label">权重</span>\n              <input v-model.number="tier.weight" type="range" min="0" max="100" step="1" class="acu-range-input" />\n              <span class="acu-badge">{{ tier.weight }}</span>\n            </div>\n\n            \x3c!-- 第三行: 提示词 --\x3e\n            <div class="tier-row prompt-editor">\n              <textarea\n                v-model="tier.prompt"\n                class="acu-textarea-scrollable compact"\n                placeholder="在此输入该档位的提示词..."\n                rows="2"\n              ></textarea>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- 添加档位按钮 --\x3e\n        <button class="acu-btn-dashed full-width" @click="addTier(dimIndex)">\n          <i class="fas fa-plus"></i> 添加新档位\n        </button>\n      </div>\n    </div>\n\n    \x3c!-- 新建维度按钮 --\x3e\n    <button class="acu-btn-dashed full-width add-dimension-btn" @click="handleAddDimension">\n      <i class="fas fa-layer-group"></i> 新建维度\n    </button>\n\n    \x3c!-- 高级设置：自定义模板 --\x3e\n    <div class="acu-settings-section advanced-settings">\n      <div class="acu-settings-title">\n        <div class="header-left">\n          <i class="fas fa-file-alt"></i>\n          提示词模板\n        </div>\n      </div>\n      <div class="acu-settings-group template-settings-group">\n        \x3c!-- 1. 快捷按钮行 --\x3e\n        <div class="template-shortcuts-row">\n          <span class="hint">快捷插入:</span>\n          <button class="acu-wildcard-btn" @click="insertTemplatePlaceholder(\'{{luck}}\')">\n            <code>{{ \'\\{\\{luck\\}\\}\' }}</code>\n          </button>\n          <button class="acu-wildcard-btn" @click="insertTemplatePlaceholder(\'{{words}}\')">\n            <code>{{ \'\\{\\{words\\}\\}\' }}</code>\n          </button>\n          <button class="acu-wildcard-btn" @click="insertTemplatePlaceholder(\'{{dimensions}}\')">\n            <code>{{ \'\\{\\{dimensions\\}\\}\' }}</code>\n          </button>\n        </div>\n\n        \x3c!-- 2. 文本框行 --\x3e\n        <div class="template-editor-row">\n          <textarea\n            ref="templateInputRef"\n            v-model="divinationStore.config.customTemplate"\n            class="acu-edit-textarea template-textarea"\n            placeholder="在此输入自定义模板..."\n            rows="6"\n          ></textarea>\n        </div>\n\n        \x3c!-- 3. 说明行 --\x3e\n        <div class="template-help-row">\n          <div class="acu-wildcard-help">\n            <div class="acu-help-header" @click="toggleHelp">\n              <i class="fas fa-lightbulb"></i>\n              <strong>通配符说明</strong>\n              <i class="fas" :class="showHelp ? \'fa-chevron-up\' : \'fa-chevron-down\'"></i>\n            </div>\n            <ul v-show="showHelp">\n              <li>\n                <code>{{ \'\\{\\{luck\\}\\}\' }}</code> - 运势结果（如：大吉...）\n              </li>\n              <li>\n                <code>{{ \'\\{\\{words\\}\\}\' }}</code> - 随机词列表（如：苹果、香蕉）\n              </li>\n              <li>\n                <code>{{ \'\\{\\{dimensions\\}\\}\' }}</code> - 其他维度结果拼接\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- 隐藏的文件输入 --\x3e\n    <input ref="fileInputRef" type="file" accept=".json" style="display: none" @change="handleImportPresets" />\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { useTextareaAutosize } from \'@vueuse/core\';\nimport { v4 as uuidv4 } from \'uuid\';\nimport { onMounted, ref, toRef } from \'vue\';\nimport { TEMPLATE_WITH_DIMENSIONS } from \'../../../composables/usePromptBuild\';\nimport { useToast } from \'../../../composables/useToast\';\nimport { useDivinationStore } from \'../../../stores/useDivinationStore\';\nimport { useUIStore } from \'../../../stores/useUIStore\';\nimport type { Dimension, DimensionTier, DivinationPreset } from \'../../../types\';\nimport PresetManagerHeader from \'../PresetManagerHeader.vue\';\n\nconst divinationStore = useDivinationStore() as any;\nconst uiStore = useUIStore();\nconst toast = useToast();\n\n// 折叠状态管理\nconst collapsedDimensions = ref<Record<string, boolean>>({});\nconst fileInputRef = ref<HTMLInputElement | null>(null);\nconst templateInputRef = ref<HTMLTextAreaElement | null>(null);\nconst showHelp = ref(true);\n\n// 迁移模式状态\nconst isMigrating = ref(false);\nconst selectedDimensionIds = ref<Set<string>>(new Set());\n\n// 自动调整高度\nconst customTemplateRef = toRef(divinationStore.config, \'customTemplate\');\nuseTextareaAutosize({ element: templateInputRef, input: customTemplateRef });\n\nconst toggleHelp = () => {\n  showHelp.value = !showHelp.value;\n};\n\n// 初始化：如果自定义模板为空，填充默认模板\nonMounted(() => {\n  if (!divinationStore.config.customTemplate) {\n    divinationStore.config.customTemplate = TEMPLATE_WITH_DIMENSIONS;\n  }\n});\n\n// ============================================================\n// 预设管理\n// ============================================================\n\nfunction handleSelectPreset(id: string) {\n  divinationStore.applyPreset(id);\n  toast.success(\'已应用维度预设\');\n}\n\nfunction handleRestoreDefault() {\n  if (confirm(\'确定要恢复默认维度配置吗？当前未保存的修改将丢失。\')) {\n    divinationStore.restoreDefaultDimensions();\n    toast.success(\'已恢复默认维度配置\');\n  }\n}\n\nfunction handleDeletePreset(id: string) {\n  const preset = divinationStore.presets.find((p: DivinationPreset) => p.id === id);\n  if (!preset) return;\n\n  if (confirm(`确定要删除预设「${preset.name}」吗？`)) {\n    divinationStore.deletePreset(id);\n    toast.info(\'预设已删除\');\n  }\n}\n\nfunction handleQuickSave() {\n  const activeId = divinationStore.activePresetId;\n  if (activeId) {\n    const preset = divinationStore.presets.find((p: DivinationPreset) => p.id === activeId);\n    if (preset) {\n      divinationStore.saveCurrentToPreset(preset.name);\n      toast.success(`预设「${preset.name}」已更新`);\n      return;\n    }\n  }\n  // 如果没有激活的预设，则打开另存为对话框\n  openSaveDialog();\n}\n\nfunction openSaveDialog() {\n  uiStore.openPresetSaveDialog(\n    {\n      presetType: \'divination\', // 使用自定义类型或通用类型\n      summaryItems: [],\n      initialName: \'\',\n      checkDuplicate: (name: string) => divinationStore.presets.some((p: DivinationPreset) => p.name === name),\n    },\n    {\n      onSave: (name: string) => {\n        divinationStore.saveCurrentToPreset(name);\n        toast.success(`预设「${name}」已保存`);\n      },\n    },\n  );\n}\n\n// 导出当前预设\nfunction handleExportCurrentPreset() {\n  const activeId = divinationStore.activePresetId;\n  if (!activeId) {\n    toast.warning(\'请先选择一个预设\');\n    return;\n  }\n  const preset = divinationStore.presets.find((p: DivinationPreset) => p.id === activeId);\n  if (!preset) return;\n\n  const data = {\n    type: \'acu_divination_presets\',\n    version: \'1.0\',\n    timestamp: new Date().toISOString(),\n    presets: [preset], // 仅导出当前预设\n  };\n\n  downloadJson(data, `acu-preset-${preset.name}-${Date.now()}.json`);\n  toast.success(`预设「${preset.name}」已导出`);\n}\n\n// 备份所有预设\nfunction handleExportPresets() {\n  const data = {\n    type: \'acu_divination_presets\',\n    version: \'1.0\',\n    timestamp: new Date().toISOString(),\n    presets: divinationStore.presets,\n  };\n\n  downloadJson(data, `acu-divination-backup-${Date.now()}.json`);\n  toast.success(\'所有预设已备份\');\n}\n\nfunction downloadJson(data: any, filename: string) {\n  const blob = new Blob([JSON.stringify(data, null, 2)], { type: \'application/json\' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement(\'a\');\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n}\n\n// 触发导入\nfunction triggerImport() {\n  fileInputRef.value?.click();\n}\n\n// 导入预设\nfunction handleImportPresets(event: Event) {\n  const file = (event.target as HTMLInputElement).files?.[0];\n  if (!file) return;\n\n  const reader = new FileReader();\n  reader.onload = e => {\n    try {\n      const content = e.target?.result as string;\n      const data = JSON.parse(content);\n\n      if (data.type === \'acu_divination_presets\' && Array.isArray(data.presets)) {\n        let importedCount = 0;\n        data.presets.forEach((importedPreset: DivinationPreset) => {\n          // 检查 ID 冲突，如果有冲突则重新生成 ID\n          const existing = divinationStore.presets.find((p: DivinationPreset) => p.id === importedPreset.id);\n          if (existing) {\n            // 如果 ID 冲突但内容不同，或者只是想合并，这里简单处理为追加并重命名\n            // 实际策略可以是：覆盖、跳过或重命名。这里采用：如果 ID 相同则覆盖\n            const index = divinationStore.presets.findIndex((p: DivinationPreset) => p.id === importedPreset.id);\n            divinationStore.presets[index] = importedPreset;\n          } else {\n            divinationStore.presets.push(importedPreset);\n          }\n          importedCount++;\n        });\n\n        // 强制保存一次\n        divinationStore.saveConfig();\n        toast.success(`成功导入 ${importedCount} 个预设`);\n      } else {\n        toast.error(\'无效的预设文件格式\');\n      }\n    } catch (err) {\n      console.error(\'导入失败:\', err);\n      toast.error(\'导入失败：文件格式错误\');\n    }\n  };\n  reader.readAsText(file);\n  // 重置 input\n  (event.target as HTMLInputElement).value = \'\';\n}\n\n// 切换折叠\nconst toggleCollapse = (id: string) => {\n  collapsedDimensions.value[id] = !collapsedDimensions.value[id];\n};\n\n// 全部折叠\nfunction collapseAll() {\n  divinationStore.config.dimensions.forEach((dim: any) => {\n    collapsedDimensions.value[dim.id] = true;\n  });\n}\n\n// 全部展开\nfunction expandAll() {\n  divinationStore.config.dimensions.forEach((dim: any) => {\n    collapsedDimensions.value[dim.id] = false;\n  });\n}\n\n// 切换迁移模式\nfunction toggleMigrateMode() {\n  isMigrating.value = !isMigrating.value;\n  if (isMigrating.value) {\n    selectedDimensionIds.value.clear();\n    toast.info(\'迁移模式：点击选中要迁移的维度，然后选择目标预设\');\n  } else {\n    selectedDimensionIds.value.clear();\n  }\n}\n\n// 切换维度选中\nfunction toggleDimensionSelection(dimId: string) {\n  if (selectedDimensionIds.value.has(dimId)) {\n    selectedDimensionIds.value.delete(dimId);\n  } else {\n    selectedDimensionIds.value.add(dimId);\n  }\n  // 强制触发响应式更新\n  selectedDimensionIds.value = new Set(selectedDimensionIds.value);\n}\n\n// 迁移到目标预设\nfunction handleMigrateTo(targetPresetId: string) {\n  if (selectedDimensionIds.value.size === 0) {\n    toast.warning(\'请先选中要迁移的维度\');\n    return;\n  }\n\n  const targetPreset = divinationStore.presets.find((p: any) => p.id === targetPresetId);\n  if (!targetPreset) return;\n\n  // 执行迁移\n  const selectedDims = divinationStore.config.dimensions.filter((d: any) => selectedDimensionIds.value.has(d.id));\n\n  divinationStore.migrateDimensionsToPreset(selectedDims, targetPresetId);\n\n  toast.success(`已迁移 ${selectedDims.length} 个维度到「${targetPreset.name}」`);\n\n  // 退出迁移模式\n  isMigrating.value = false;\n  selectedDimensionIds.value.clear();\n}\n\n// 添加新维度\nconst handleAddDimension = () => {\n  const newDim: Dimension = {\n    id: uuidv4(),\n    name: \'新维度\',\n    enabled: true,\n    tiers: [\n      {\n        id: uuidv4(),\n        name: \'默认档位\',\n        weight: 50,\n        prompt: \'\',\n      },\n    ],\n  };\n  divinationStore.addDimension(newDim);\n  // 自动展开新维度\n  collapsedDimensions.value[newDim.id] = false;\n};\n\n// 删除维度\nconst handleRemoveDimension = (index: any) => {\n  if (confirm(\'确定要删除这个维度吗？此操作不可撤销。\')) {\n    divinationStore.removeDimension(index);\n  }\n};\n\n// 添加档位\nconst addTier = (dimIndex: any) => {\n  const newTier: DimensionTier = {\n    id: uuidv4(),\n    name: \'新档位\',\n    weight: 10,\n    prompt: \'\',\n    color: \'#808080\',\n  };\n  divinationStore.config.dimensions[dimIndex].tiers.push(newTier);\n};\n\n// 删除档位\nconst removeTier = (dimIndex: any, tierIndex: any) => {\n  divinationStore.config.dimensions[dimIndex].tiers.splice(tierIndex, 1);\n};\n\n// 插入模板占位符 (追加到末尾)\nconst insertTemplatePlaceholder = (placeholder: string) => {\n  const current = divinationStore.config.customTemplate || \'\';\n  divinationStore.config.customTemplate = current + placeholder;\n\n  // 滚动到底部并聚焦\n  const textarea = templateInputRef.value;\n  if (textarea) {\n    setTimeout(() => {\n      textarea.focus();\n      textarea.scrollTop = textarea.scrollHeight;\n      // 移动光标到末尾\n      const len = divinationStore.config.customTemplate.length;\n      textarea.setSelectionRange(len, len);\n    }, 0);\n  }\n};\n<\/script>\n\n<style scoped>\n/*\n  注意：由于样式隔离限制，主要样式应写在 src/可视化表格/styles/components/settings-panel.scss\n  或 src/可视化表格/styles/components/divination-settings.scss 中。\n  这里只保留极少量无法提取的样式或临时样式。\n*/\n.template-settings-group {\n  padding: 12px;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.template-shortcuts-row {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  flex-wrap: wrap;\n}\n\n.template-shortcuts-row .hint {\n  font-size: 12px;\n  color: var(--acu-text-sub);\n}\n\n.acu-wildcard-btn {\n  background: var(--acu-bg-panel);\n  border: 1px solid var(--acu-border);\n  border-radius: 4px;\n  padding: 2px 6px;\n  cursor: pointer;\n  font-size: 12px;\n  color: var(--acu-title-color);\n  transition: all 0.2s;\n}\n\n.acu-wildcard-btn:hover {\n  background: var(--acu-btn-hover);\n  border-color: var(--acu-title-color);\n}\n\n.acu-wildcard-btn code {\n  font-family: monospace;\n}\n\n.template-textarea {\n  min-height: 120px;\n  resize: vertical;\n  line-height: 1.5;\n  font-family: monospace;\n  width: 100%;\n  pointer-events: auto !important; /* 强制可点击 */\n}\n\n.acu-wildcard-help {\n  background: rgba(0, 0, 0, 0.05);\n  border-radius: 8px;\n  padding: 8px 12px;\n}\n\n.acu-help-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  cursor: pointer;\n  font-size: 12px;\n  color: var(--acu-text-sub);\n  user-select: none;\n}\n\n.acu-help-header strong {\n  flex: 1;\n}\n\n.acu-wildcard-help ul {\n  margin: 8px 0 0 0;\n  padding-left: 20px;\n  list-style-type: disc;\n  font-size: 12px;\n  color: var(--acu-text-sub);\n}\n\n.acu-wildcard-help li {\n  margin-bottom: 4px;\n}\n\n.acu-wildcard-help code {\n  background: rgba(0, 0, 0, 0.1);\n  padding: 0 4px;\n  border-radius: 3px;\n  font-family: monospace;\n  color: var(--acu-text-main);\n}\n</style>\n'],sourceRoot:''}]);const l=i},5048(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var a='',o=void 0!==t[5];return t[4]&&(a+='@supports ('.concat(t[4],') {')),t[2]&&(a+='@media '.concat(t[2],' {')),o&&(a+='@layer'.concat(t[5].length>0?' '.concat(t[5]):'',' {')),a+=e(t),o&&(a+='}'),t[2]&&(a+='}'),t[4]&&(a+='}'),a}).join('')},t.i=function(e,a,o,n,r){'string'==typeof e&&(e=[[null,e,void 0]]);var i={};if(o)for(var l=0;l<this.length;l++){var c=this[l][0];null!=c&&(i[c]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);o&&i[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]='@layer'.concat(d[5].length>0?' '.concat(d[5]):'',' {').concat(d[1],'}')),d[5]=r),a&&(d[2]?(d[1]='@media '.concat(d[2],' {').concat(d[1],'}'),d[2]=a):d[2]=a),n&&(d[4]?(d[1]='@supports ('.concat(d[4],') {').concat(d[1],'}'),d[4]=n):d[4]=''.concat(n)),t.push(d))}},t}},5016(e){e.exports=function(e){var t=e[1],a=e[3];if(!a)return t;if('function'==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),n='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(o),r='/*# '.concat(n,' */');return[t].concat([r]).join('\n')}return[t].join('\n')}},4797(e,t,a){a.d(t,{C2:()=>o,CY:()=>r,dE:()=>n,ie:()=>i});const o='acu_visualizer',n={DATA_SNAPSHOT:'acu_data_snapshot_v18_5',CONFIG_CACHE:'acu_config_cache_v1',WINDOW_POSITION:'acu_win_position',BALL_POSITION:'acu_ball_position',LOCAL_STATE:'acu_local_state'},r={windowPosition:{x:0,y:0,width:400,isCentered:!0},isCollapsed:!1,isPinned:!1,activeTab:null,layout:'horizontal'},i={visibleTabs:[],tabOrder:[],tableHeights:{},tableStyles:{},reverseTables:[],cellLocks:{}}},2867(e,t,a){a.d(t,{X0:()=>p,td:()=>i});var o=a(4061),n=a(9800),r=a(4797);const i={visibleButtons:['save','collapseTab','refresh','toggle','settings'],buttonOrder:['save','collapseTab','refresh','toggle','settings','director','saveAs','undo','manualUpdate','purge','pin','openNative'],buttonGroups:[],longPressDirectExec:!1},l={presets:[],activePresetId:null,themeVars:{},themeVarOpacities:{},highlight:{manualColor:'orange',manualHex:'#d35400',aiColor:'blue',aiHex:'#3498db',titleColor:'orange',titleHex:'#d35400'},backgroundConfig:{...n.o6},customCSS:''},c={config:{enabled:!0,drawCount:4,enableBias:!0,autoSync:!0,cardBackImage:'',themeColor:'#6b4c9a',themeId:'wafuku',flipMode:'auto',peepMode:!1,dimensions:[],customTemplate:'',enableWordDrawing:!0,enableTableWords:!0,enableWordPool:!1,wordDrawMode:'perItem',wordsPerItem:1,tablePoolConfig:{},categoryConfig:{},tableSyncConfig:{}},presets:[],activePresetId:null},s={appearance:{type:'icon',content:'fa-layer-group',size:50,notifyAnimation:'ripple',borderColor:'#ffffff',borderOpacity:40,bgColor:'#ffffff',bgOpacity:25,imageInvert:!1},customFonts:[]},d={version:1,lastUpdated:Date.now(),tabs:[],buttons:{...i},theme:{...l},ui:{},dashboard:{widgets:[],layout:'grid',columns:2,showStats:!0},tagLibrary:{categories:[],tags:[]},divination:{...c},ball:{...s},chats:{}};let u=null;function p(){return u||(u=function(){const e=(0,o.ref)(!1),t=(0,o.reactive)({...d}),a=(0,o.reactive)({...r.CY});function n(e){return{...d,...e,buttons:{...i,...e.buttons||{}},theme:{...l,...e.theme||{},highlight:{...l.highlight,...e.theme?.highlight||{}},backgroundConfig:{...l.backgroundConfig,...e.theme?.backgroundConfig||{}}},ui:{...d.ui,...e.ui||{}},dashboard:{...d.dashboard,...e.dashboard||{}},tagLibrary:{categories:e.tagLibrary?.categories||[],tags:e.tagLibrary?.tags||[]},divination:{...c,...e.divination||{},config:{...c.config,...e.divination?.config||{}}},ball:{...s,...e.ball||{},appearance:{...s.appearance,...e.ball?.appearance||{}}},chats:e.chats||{}}}async function u(){try{t.lastUpdated=Date.now(),SillyTavern.extensionSettings[r.C2]={...t},await SillyTavern.saveSettingsDebounced(),f()}catch(e){console.error('[ACU] 配置保存失败:',e)}}function p(){try{const e=localStorage.getItem(r.dE.LOCAL_STATE);e&&Object.assign(a,r.CY,JSON.parse(e))}catch(e){}}function m(){try{localStorage.setItem(r.dE.LOCAL_STATE,JSON.stringify(a))}catch(e){}}function f(){try{localStorage.setItem(r.dE.CONFIG_CACHE,JSON.stringify(t))}catch(e){}}function g(){try{const e=localStorage.getItem(r.dE.CONFIG_CACHE);if(e){const a=n(JSON.parse(e));return Object.assign(t,a),!0}}catch(e){}return!1}return{isLoaded:e,config:t,localState:a,loadConfig:function(){try{const a=SillyTavern?.extensionSettings?.[r.C2];if(!a&&(console.warn('[ACU] extensionSettings 未就绪或为空，尝试从本地缓存恢复'),g()))return console.info('[ACU] 已从本地缓存恢复配置'),void(e.value=!0);if(a){const e=n(a);Object.assign(t,e),console.info('[ACU] 配置加载成功')}else Object.assign(t,d),console.info('[ACU] 首次使用或配置丢失，初始化默认配置');p(),f()}catch(e){console.warn('[ACU] 配置加载失败，尝试从本地缓存恢复:',e),g()||(Object.assign(t,d),console.warn('[ACU] 使用默认配置'))}e.value=!0},saveConfig:u,loadLocalState:p,saveLocalState:m,getChatConfig:function(e){return t.chats[e]??{...r.ie}},setChatConfig:function(e,a){t.chats[e]||(t.chats[e]={...r.ie}),Object.assign(t.chats[e],a),u()},exportAllConfigs:function(){return JSON.stringify({exportVersion:1,exportTime:Date.now(),config:{...t},localState:{...a}},null,2)},importConfigs:async function(e){try{const o=JSON.parse(e);return o.exportVersion&&o.config?(Object.assign(t,d,o.config),await u(),o.localState&&(Object.assign(a,r.CY,o.localState),m()),{success:!0,message:'配置导入成功'}):{success:!1,message:'无效的配置文件格式'}}catch(e){return{success:!1,message:`导入失败: ${e}`}}},resetToDefault:async function(){Object.assign(t,d),t.version=1,t.lastUpdated=Date.now(),await u(),Object.assign(a,r.CY),m()}}}()),u}},8963(e,t,a){a.d(t,{o:()=>l});var o=a(4061);const n='avatars';let r=null;const i=new Map;function l(){const e=(0,o.ref)(!1),t=(0,o.ref)(null);async function a(){return r||new Promise((a,o)=>{const i=indexedDB.open('acu_avatars',1);i.onerror=()=>{const e=`[AvatarManager] 打开数据库失败: ${i.error?.message}`;console.error(e),t.value=e,o(i.error)},i.onsuccess=()=>{r=i.result,r.onclose=()=>{console.warn('[AvatarManager] 数据库连接已关闭，重置实例'),r=null,e.value=!1},r.onerror=e=>{console.error('[AvatarManager] 数据库错误:',e.target.error)},e.value=!0,console.info('[AvatarManager] 数据库连接成功'),a(r)},i.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(n)||(t.createObjectStore(n,{keyPath:'name'}),console.info('[AvatarManager] 创建数据库表成功'))}})}async function l(e){const t=await a();return new Promise((a,o)=>{const r=t.transaction(n,'readwrite').objectStore(n);i.has(e.name)&&(URL.revokeObjectURL(i.get(e.name)),i.delete(e.name));const l={...e,updatedAt:e.updatedAt||Date.now()},c=r.put(l);c.onsuccess=()=>{console.info(`[AvatarManager] 保存头像成功: ${e.name}`),a()},c.onerror=()=>{console.error(`[AvatarManager] 保存头像失败: ${c.error}`),o(c.error)}})}async function c(e){if(!e)return null;const t=await a();return new Promise(a=>{const o=t.transaction(n,'readonly').objectStore(n).get(e);o.onsuccess=()=>{a(o.result||null)},o.onerror=()=>{console.error(`[AvatarManager] 获取头像失败: ${o.error}`),a(null)}})}async function s(){const e=await a();return new Promise(t=>{const a=e.transaction(n,'readonly').objectStore(n).getAll();a.onsuccess=()=>{t(a.result||[])},a.onerror=()=>{console.error(`[AvatarManager] 获取所有头像失败: ${a.error}`),t([])}})}function d(){try{const e=window.parent||window,$=e.jQuery||window.jQuery;if($){const e=$('.mes[is_user="true"]').last().find('.avatar img');if(e.length&&e.attr('src')){const t=e.attr('src');if(t&&!t.includes('default')&&!t.includes('placeholder'))return t}const t=$('#user_avatar_block img').first();if(t.length&&t.attr('src'))return t.attr('src')}const t=e.SillyTavern||window.SillyTavern;if(t?.getContext){const e=t.getContext();if(e?.userAvatar)return e.userAvatar}}catch(e){console.warn('[AvatarManager] getSillyTavernUserAvatar error:',e)}return null}function u(){try{const e=(window.parent||window).AutoCardUpdaterAPI;if(e?.exportTableAsJson){const t=e.exportTableAsJson();for(const e in t){const a=t[e];if(a?.name?.includes('主角')&&a.content?.[1]?.[1])return a.content[1][1]}}}catch(e){console.warn('[AvatarManager] getPlayerNameFromTable error:',e)}return null}function p(e){if(!e)return!1;const t=['<user>','{{user}}','主角','player','protagonist'],a=e.toLowerCase();for(const e of t)if(a===e.toLowerCase())return!0;const o=u();return!(!o||e!==o)}async function m(e){if(!e)return e;const t=await s();for(const a of t)if(a.aliases?.includes(e))return a.name;return e}return{isReady:e,error:t,initDB:a,saveAvatar:l,getAvatar:c,deleteAvatar:async function(e){if(!e)return;i.has(e)&&(URL.revokeObjectURL(i.get(e)),i.delete(e));const t=await a();return new Promise(a=>{const o=t.transaction(n,'readwrite').objectStore(n).delete(e);o.onsuccess=()=>{console.info(`[AvatarManager] 删除头像成功: ${e}`),a()},o.onerror=()=>{console.error(`[AvatarManager] 删除头像失败: ${o.error}`),a()}})},deleteAvatars:async function(e){if(!e.length)return;for(const t of e)i.has(t)&&(URL.revokeObjectURL(i.get(t)),i.delete(t));const t=await a();return new Promise((a,o)=>{const r=t.transaction(n,'readwrite'),i=r.objectStore(n);let l=0;const c=e.length;for(const t of e){const e=i.delete(t);e.onsuccess=()=>{l++,l===c&&(console.info(`[AvatarManager] 批量删除完成: ${c} 个`),a())},e.onerror=()=>{console.error(`[AvatarManager] 删除失败: ${t}`),l++,l===c&&a()}}r.onerror=()=>o(r.error)})},getAllAvatars:s,hasAvatar:async function(e){if(!e)return!1;const t=await a();return new Promise(a=>{const o=t.transaction(n,'readonly').objectStore(n).getKey(e);o.onsuccess=()=>a(void 0!==o.result),o.onerror=()=>a(!1)})},getStats:async function(){const e=await a();return new Promise(t=>{const a=e.transaction(n,'readonly').objectStore(n).getAll();a.onsuccess=()=>{const e=a.result||[],o=e.reduce((e,t)=>e+(t.blob?.size||0),0);t({count:e.length,totalSizeBytes:o,totalSizeMB:(o/1024/1024).toFixed(2)})},a.onerror=()=>{t({count:0,totalSizeBytes:0,totalSizeMB:'0.00'})}})},clearAll:async function(){i.forEach(e=>URL.revokeObjectURL(e)),i.clear();const e=await a();return new Promise(t=>{const a=e.transaction(n,'readwrite').objectStore(n).clear();a.onsuccess=()=>{console.info('[AvatarManager] 清空所有头像成功'),t()},a.onerror=()=>{console.error(`[AvatarManager] 清空失败: ${a.error}`),t()}})},getAvatarUrl:async function e(t){if(!t)return null;if(i.has(t))return i.get(t);const a=await c(t);if(a){if(a.blob){const e=URL.createObjectURL(a.blob);return i.set(t,e),e}if(a.url)return a.url}const o=await m(t);if(o!==t)return e(o);if(p(t)){const e=d();if(e)return e}return null},getAvatarDisplayConfig:async function(e){const t=await c(e);return t?{offsetX:t.offsetX??50,offsetY:t.offsetY??50,scale:t.scale??150}:{offsetX:50,offsetY:50,scale:150}},getSillyTavernUserAvatar:d,getSillyTavernCharacterAvatar:function(){try{const e=window.parent||window,$=e.jQuery||window.jQuery;if($){const e=$('#avatar_img_holder img').first();if(e.length&&e.attr('src'))return e.attr('src');const t=$('.mes:not([is_user="true"])').last().find('.avatar img');if(t.length&&t.attr('src'))return t.attr('src')}const t=e.SillyTavern||window.SillyTavern;if(t?.getContext){const e=t.getContext();if(e?.characterAvatar)return e.characterAvatar}}catch(e){console.warn('[AvatarManager] getSillyTavernCharacterAvatar error:',e)}return null},getPlayerNameFromTable:u,isPlayerNode:p,resolvePrimaryName:m,addAlias:async function(e,t){const a=await c(e);if(!a)return;const o=a.aliases||[];o.includes(t)||(o.push(t),await l({...a,aliases:o,updatedAt:Date.now()}))},removeAlias:async function(e,t){const a=await c(e);if(!a)return;const o=(a.aliases||[]).filter(e=>e!==t);await l({...a,aliases:o,updatedAt:Date.now()})},getAliasMap:async function(){const e=await s(),t=new Map;for(const a of e)if(a.aliases?.length)for(const e of a.aliases)t.set(e,a.name);return t},getAliases:async function(e){const t=await c(e);return t?.aliases||[]},setAliases:async function(e,t){let a=await c(e);a=a?{...a,aliases:t,updatedAt:Date.now()}:{name:e,offsetX:50,offsetY:50,scale:150,aliases:t,updatedAt:Date.now()},await l(a)},getDisplayLabel:async function(e){return e},setDisplayLabel:async function(e,t){console.warn('[AvatarManager] setDisplayLabel 已废弃，请使用聊天变量保存标签配置')},getDisplayChars:function(e){if(!e)return[];if('undefined'!=typeof Intl&&Intl.Segmenter){const t=new Intl.Segmenter('zh',{granularity:'grapheme'});return Array.from(t.segment(e),e=>e.segment)}return[...e]},cleanup:function(){i.forEach(e=>URL.revokeObjectURL(e)),i.clear(),console.info('[AvatarManager] 已清理 ObjectURL 缓存')}}}},5526(e,t,a){a.d(t,{$H:()=>c,Aq:()=>n,DZ:()=>d,dQ:()=>p,e$:()=>s,eO:()=>u,saveBackground:()=>l});const o='backgrounds',n='global_theme_background';let r=null;async function i(){return r||new Promise((e,t)=>{const a=indexedDB.open('acu_background_db',1);a.onerror=()=>{console.error('[ACU Background] 打开数据库失败:',a.error),t(a.error)},a.onsuccess=()=>{r=a.result,console.info('[ACU Background] 数据库连接成功'),e(r)},a.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(o)||(t.createObjectStore(o,{keyPath:'chatId'}),console.info('[ACU Background] 创建背景图片表成功'))}})}async function l(e,t,a='image/png'){const n=await i();return new Promise((r,i)=>{const l=n.transaction(o,'readwrite').objectStore(o),c={chatId:e,imageData:t,mimeType:a,timestamp:Date.now()},s=l.put(c);s.onsuccess=()=>{console.info('[ACU Background] 保存背景图片成功, chatId:',e),r()},s.onerror=()=>{console.error('[ACU Background] 保存背景图片失败:',s.error),i(s.error)}})}async function c(e){const t=await i();return new Promise((a,n)=>{const r=t.transaction(o,'readonly').objectStore(o).get(e);r.onsuccess=()=>{const t=r.result;if(t?.imageData){const o=URL.createObjectURL(t.imageData);console.info('[ACU Background] 加载背景图片成功, chatId:',e),a(o)}else a(null)},r.onerror=()=>{console.error('[ACU Background] 加载背景图片失败:',r.error),n(r.error)}})}async function s(e){const t=await i();return new Promise((a,n)=>{const r=t.transaction(o,'readwrite').objectStore(o).delete(e);r.onsuccess=()=>{console.info('[ACU Background] 删除背景图片成功, chatId:',e),a()},r.onerror=()=>{console.error('[ACU Background] 删除背景图片失败:',r.error),n(r.error)}})}async function d(e){return{blob:e,mimeType:e.type||'image/png'}}async function u(e){if(e.startsWith('data:')){const t=await fetch(e),a=await t.blob();return{blob:a,mimeType:a.type}}try{const t=await fetch(e,{mode:'cors'});if(!t.ok)throw new Error(`HTTP ${t.status}`);const a=await t.blob();return{blob:a,mimeType:a.type}}catch{throw new Error('无法加载外部图片，可能是跨域限制')}}function p(e){e.startsWith('blob:')&&URL.revokeObjectURL(e)}},5708(e,t,a){a.d(t,{t:()=>u});var o=a(4061),n=a(4778),r=a(2867);const i={全局数据表:null,世界地图点:'详细地点',地图元素表:'元素名称',主角信息:'姓名',重要人物表:'姓名',技能表:'技能名称',物品表:'物品名称',装备表:'装备名称',任务表:'名称',总结表:'编码索引',总体大纲:'编码索引',重要情报:'情报名称',势力:'名称'};function l(){return SillyTavern.getCurrentChatId()||'default'}const c=(0,o.ref)({}),s=(0,o.ref)({});let d=null;function u(){const e=(0,r.X0)();function t(){const t=l();if(d!==t){d=t;const a=e.getChatConfig(t);c.value=a.cellLocks||{}}return c.value}function a(){const t=l();e.setChatConfig(t,{cellLocks:{...c.value}}),console.info('[CellLock] 锁定数据已保存到 ConfigManager')}function u(e,t,a,o){const n=function(e){if(e.startsWith('_row_')){const t=parseInt(e.substring(5),10);return Number.isFinite(t)?{type:'index',index:t}:null}const t=e.indexOf('=');return t>0?{type:'pk',field:e.substring(0,t),value:e.substring(t+1)}:null}(t);if(!n)return-1;if('index'===n.type)return n.index<a.length-1?n.index:-1;const r=o.indexOf(n.field);if(-1===r)return-1;for(let e=1;e<a.length;e++)if(String(a[e][r]??'')===n.value)return e-1;return-1}function p(e){const t=(0,n.M1)().getDB();if(!t?.setTableLockState)return void console.warn('[CellLock] 数据库锁定 API 不可用，仅保存到 ConfigManager');const a=t.exportTableAsJson?.();if(a){for(const o in a){if(!o.startsWith('sheet_'))continue;const n=a[o]?.name;if(!n)continue;const r=e[n];if(!r||0===Object.keys(r).length){t.clearTableLocks?.(o);continue}const i=a[o]?.content;if(!i||i.length<2)continue;const l=i[0],c=[],s=[];for(const[e,t]of Object.entries(r)){const a=u(0,e,i,l);if(-1!==a)if(t._fullRow)c.push(a);else for(const e of Object.keys(t._fields)){const t=l.indexOf(e);t>0&&s.push(`${a}:${t-1}`)}}t.setTableLockState(o,{rows:c,cols:[],cells:s})}console.info('[CellLock] 锁定状态已同步到数据库 API')}}function m(e,t,a,o){const n=i[e];if(null===n)return'_row_0';let r=1;if(n){const e=a.indexOf(n);-1!==e&&(r=e)}const l=t[r];if(l)return`${n||a[r]}=${l}`;if(void 0!==o)return`_row_${o}`;for(let e=0;e<t.length;e++)if(t[e]&&0!==e)return`${a[e]||`col${e}`}=${t[e]}`;return null}function f(e,t){const a=t._fullRow?t._snapshot:t._fields;if(!a||0===Object.keys(a).length)return null;const o=new Array(e.length).fill(null);for(const[t,n]of Object.entries(a)){const a=e.indexOf(t);-1!==a&&(o[a]=n)}return o}const g=(0,o.computed)(()=>{let e=0;for(const t of Object.values(s.value))if('object'==typeof t)for(const a of Object.values(t))a._fullRow?e+=Object.keys(a._snapshot||{}).length:e+=Object.keys(a._fields||{}).length;return e});return{loadLocks:t,initPendingLocks:function(){t(),s.value=JSON.parse(JSON.stringify(c.value)),Object.keys(c.value).length>0&&p(c.value)},getRowKey:m,pendingLocks:s,toggleCellLock:function(e,t,a,o){const n=JSON.parse(JSON.stringify(s.value));n[e]||(n[e]={}),n[e][t]||(n[e][t]={_fullRow:!1,_fields:{},_snapshot:null});const r=n[e][t];let i;return r._fullRow&&r._snapshot?void 0!==r._snapshot[a]?(delete r._snapshot[a],0===Object.keys(r._snapshot).length&&(r._fullRow=!1,r._snapshot=null),i=!1):(r._fields[a]=o,i=!0):void 0!==r._fields[a]?(delete r._fields[a],i=!1):(r._fields[a]=o,i=!0),r._fullRow||0!==Object.keys(r._fields).length||(delete n[e][t],0===Object.keys(n[e]).length&&delete n[e]),s.value=n,console.log('[CellLock] toggleCellLock:',e,t,a,'->',i,'count:',function(e){let t=0;for(const a of Object.values(e))if('object'==typeof a)for(const e of Object.values(a))e._fullRow?t+=Object.keys(e._snapshot||{}).length:t+=Object.keys(e._fields||{}).length;return t}(n)),i},toggleRowLock:function(e,t,a,o){const n=JSON.parse(JSON.stringify(s.value));n[e]||(n[e]={});const r=n[e]?.[t];if(r?._fullRow)return delete n[e][t],0===Object.keys(n[e]).length&&delete n[e],s.value=n,console.log('[CellLock] toggleRowLock: 解锁整行',e,t),!1;const i={};return a.forEach((e,t)=>{e&&null!=o[t]&&''!==o[t]&&(i[e]=o[t])}),n[e][t]={_fullRow:!0,_fields:{},_snapshot:i},s.value=n,console.log('[CellLock] toggleRowLock: 锁定整行',e,t,'fields:',Object.keys(i).length),!0},savePendingLocks:function(){c.value=JSON.parse(JSON.stringify(s.value)),a(),p(c.value)},discardPendingLocks:function(){s.value={}},isCellLockedPending:function(e,t,a){const o=s.value[e]?.[t];return!!o&&(o._fullRow?void 0!==o._snapshot?.[a]:void 0!==o._fields?.[a])},isRowLockedPending:function(e,t){return!0===s.value[e]?.[t]?._fullRow},getLockedFieldsPending:function(e,t){const a=s.value[e]?.[t];return a?a._fullRow?Object.keys(a._snapshot||{}):Object.keys(a._fields||{}):[]},hasRowAnyLockPending:function(e,t){const a=s.value[e]?.[t];return!!a&&(!!a._fullRow||Object.keys(a._fields||{}).length>0)},isCellLocked:function(e,a,o){t();const n=c.value[e]?.[a];return!!n&&(n._fullRow?void 0!==n._snapshot?.[o]:void 0!==n._fields?.[o])},isRowLocked:function(e,a){return t(),!0===c.value[e]?.[a]?._fullRow},applyLocks:function(e,a){t();const o=c.value[e];if(!o||!a||a.length<2)return{modified:!1,restored:[]};const n=a[0],r=[];let i=!1;const l={};for(let t=1;t<a.length;t++){const o=m(e,a[t],n,t-1);o&&(l[o]=t)}for(const[t,c]of Object.entries(o)){const o=l[t];if(void 0===o){const e=f(n,c);e&&(a.push(e),r.push(t),i=!0,console.info(`[CellLock] 恢复被删除的锁定行: ${t}`));continue}const s=a[o],d=c._fullRow?c._snapshot:c._fields;if(d)for(const[a,o]of Object.entries(d)){const r=n.indexOf(a);-1!==r&&s[r]!==o&&(console.info(`[CellLock] 恢复锁定值: ${e}[${t}].${a} = "${o}" (原值: "${s[r]}")`),s[r]=o,i=!0)}}return{modified:i,restored:r}},updateLockedValue:function(e,o,n,r){t();const i=c.value[e]?.[o];if(!i)return!1;let l=!1;return i._fullRow&&i._snapshot&&void 0!==i._snapshot[n]&&(i._snapshot[n]=r,l=!0),i._fields&&void 0!==i._fields[n]&&(i._fields[n]=r,l=!0),l&&(a(),console.log('[CellLock] updateLockedValue:',e,o,n,'->',r)),l},pendingLockCount:g}}},5397(e,t,a){a.d(t,{EZ:()=>o});a(4061);const o=[{id:'superLucky',name:'中！',weight:5,color:'#ffd700',prompt:'如有神助，无往不利。甚至有意想不到的收获。'},{id:'lucky',name:'大吉',weight:15,color:'#fbc02d',prompt:'合心合意，顺风顺水。再大的阻碍也能以奇怪的方式丝滑解决。'},{id:'slightlyLucky',name:'末吉',weight:20,color:'#e6b000',prompt:'有惊无险。尽管一波三折，结果也勉强让人满意。'},{id:'neutral',name:'平',weight:20,color:'#808080',prompt:'客观中立。严格遵循世界观下的现实逻辑，成败完全取决于操作的可行性。'},{id:'slightlyUnlucky',name:'小凶',weight:20,color:'#ffa07a',prompt:'事倍功半。虽然没有彻底失败，但必须付出额外的代价才能勉强维持现状。'},{id:'unlucky',name:'大凶',weight:15,color:'#ff6347',prompt:'墨菲定律生效：如果事情可能变糟，它就必须变糟。'},{id:'superUnlucky',name:'不中嘞...',weight:5,color:'#8b0000',prompt:'灾难性的连锁反应。最坏的情况不仅发生了，还会引发更多的灾难。'}]},3833(e,t,a){a.d(t,{O:()=>f,m:()=>m});var o=a(4061);const n='row_snapshots';let r=null;async function i(){return r||new Promise((e,t)=>{const a=indexedDB.open('acu_history_db',1);a.onerror=()=>{console.error('[ACU IndexedDB] 打开数据库失败:',a.error),t(a.error)},a.onsuccess=()=>{r=a.result,console.info('[ACU IndexedDB] 数据库连接成功'),e(r)},a.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(n)){const e=t.createObjectStore(n,{keyPath:'id',autoIncrement:!0});e.createIndex('by_chat_row',['chatId','rowKey'],{unique:!1}),e.createIndex('by_chat','chatId',{unique:!1}),e.createIndex('by_timestamp','timestamp',{unique:!1}),console.info('[ACU IndexedDB] 创建数据库表和索引成功')}}})}async function l(e){const t=await i();return new Promise((a,o)=>{const r=t.transaction(n,'readwrite').objectStore(n).add(e);r.onsuccess=()=>{console.info('[ACU IndexedDB] 添加快照成功, ID:',r.result),a(r.result)},r.onerror=()=>{console.error('[ACU IndexedDB] 添加快照失败:',r.error),o(r.error)}})}async function c(e,t){const a=await i();return new Promise((o,r)=>{const i=a.transaction(n,'readonly').objectStore(n).index('by_chat_row').getAll([e,t]);i.onsuccess=()=>{o(i.result||[])},i.onerror=()=>{console.error('[ACU IndexedDB] 查询快照失败:',i.error),r(i.error)}})}async function s(e){const t=await i();return new Promise((a,o)=>{const r=t.transaction(n,'readwrite').objectStore(n).delete(e);r.onsuccess=()=>{console.info('[ACU IndexedDB] 删除快照成功, ID:',e),a()},r.onerror=()=>{console.error('[ACU IndexedDB] 删除快照失败:',r.error),o(r.error)}})}function d(){try{const e=window.SillyTavern||window.parent?.SillyTavern||window.top?.SillyTavern;if(e?.getCurrentChatId){const t=e.getCurrentChatId();if(t)return t}if(e?.chat?.length>0){const t=e.chat[0];if(t?.chat_id)return t.chat_id}}catch(e){console.warn('[ACU History] 获取 chatId 失败:',e)}return'default'}function u(e,t){return`${e}-row-${t}`}function p(e,t){const a=Object.keys(e).map(Number),o=Object.keys(t).map(Number);if(a.length!==o.length)return!1;for(const o of a)if(e[o]!==t[o])return!1;return!0}function m(){const e=(0,o.ref)(!1);return{isLoading:e,saveSnapshot:async function(t,a,o,n){try{e.value=!0;const r=d(),i=u(t,a),m=(await c(r,i)).sort((e,t)=>t.timestamp-e.timestamp);if(m.length>0){if(p(o,m[0].cells))return void console.info('[ACU History] 内容未变化，跳过记录')}if(await l({chatId:r,rowKey:i,timestamp:Date.now(),source:n,cells:o}),console.info(`[ACU History] 已记录 ${i} 的快照 (${n})`),m.length>=5){const e=m.slice(4);for(const t of e)void 0!==t.id&&await s(t.id);console.info(`[ACU History] 清理旧快照 ${e.length} 条`)}}catch(e){console.error('[ACU History] 保存快照失败:',e)}finally{e.value=!1}},getSnapshots:async function(t,a){try{e.value=!0;const o=d(),n=u(t,a);console.info('[ACU History] 查询快照, 参数:',{chatId:o,rowKey:n,tableName:t,rowIndex:a});const r=await c(o,n);return console.info('[ACU History] 查询结果:',r.length,'条'),r.sort((e,t)=>t.timestamp-e.timestamp).slice(0,5)}catch(e){return console.error('[ACU History] 获取快照失败:',e),[]}finally{e.value=!1}},snapshotToTableRow:function(e,t){return{index:t.index,key:t.key,cells:t.cells.map((t,a)=>({...t,value:void 0!==e.cells[a]?e.cells[a]:t.value}))}},tableRowToCells:function(e){const t={};return e.cells.forEach((e,a)=>{t[a]=e.value}),t},getDiff:function(e,t){const a=new Set;for(const[o,n]of Object.entries(t)){const t=Number(o);e.cells[t]!==n&&a.add(t)}for(const o of Object.keys(e.cells)){const e=Number(o);void 0===t[e]&&a.add(e)}return a},formatRelativeTime:function(e){const t=Date.now()-e;return t<6e4?'刚刚':t<36e5?`${Math.floor(t/6e4)}分钟前`:t<864e5?`${Math.floor(t/36e5)}小时前`:t<1728e5?'昨天':new Date(e).toLocaleDateString('zh-CN',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'})},clearCurrentChatHistory:async function(){try{const e=d();await async function(e){const t=await i();return new Promise((a,o)=>{const r=t.transaction(n,'readwrite'),i=r.objectStore(n).index('by_chat').openCursor(IDBKeyRange.only(e));let l=0;i.onsuccess=e=>{const t=e.target.result;t&&(t.delete(),l++,t.continue())},r.oncomplete=()=>{console.info(`[ACU IndexedDB] 按聊天删除完成, 共删除 ${l} 条`),a()},r.onerror=()=>{console.error('[ACU IndexedDB] 按聊天删除失败:',r.error),o(r.error)}})}(e),console.info('[ACU History] 已清除当前聊天的历史记录')}catch(e){console.error('[ACU History] 清除历史失败:',e)}},getCurrentChatId:d}}async function f(e,t,a,o){try{const n=u(t,a.index),r={};a.cells.forEach((e,t)=>{r[t]=String(e.value)});const i=(await c(e,n)).sort((e,t)=>t.timestamp-e.timestamp);if(i.length>0){const e=i[0];if(p(r,e.cells))return void console.info('[ACU History] 内容未变化，跳过记录')}if(await l({chatId:e,rowKey:n,timestamp:Date.now(),source:o,cells:r}),console.info(`[ACU History] 已记录 ${n} 的快照 (${o})`),i.length>=5){const e=i.slice(4);for(const t of e)void 0!==t.id&&await s(t.id);console.info(`[ACU History] 清理旧快照 ${e.length} 条`)}}catch(e){console.error('[ACU History] 保存快照失败:',e)}}},2134(e,t,a){a.d(t,{qy:()=>r,te:()=>d});var o=a(4061);const n={indexColumnName:'编码索引',checkEmptyCell:!0,checkIndexGap:!0,emptyCheckColumns:[]};function r(e){if(!e||'string'!=typeof e)return!1;const t=e.toLowerCase();return t.includes('总结')||t.includes('大纲')||t.includes('summary')||t.includes('outline')}function i(e){if(null==e)return null;const t=String(e).trim();if(''===t)return null;const a=t.match(/(\d+)/);return a?parseInt(a[1],10):null}function l(e){const t=e.match(/^(.+)-row-\d+$/);if(t)return t[1];const a=e.match(/^(.+)-\d+-\d+$/);return a?a[1]:null}function c(e){const t=e.match(/-row-(\d+)$/);if(t)return parseInt(t[1],10);const a=e.match(/-(\d+)-\d+$/);return a?parseInt(a[1],10):null}function s(e,t,a,o,n){const l=t.name||e,c=[];if(!r(l))return{sheetId:e,tableName:l,hasIssues:!1,issues:[]};if(!t.content||!Array.isArray(t.content)||t.content.length<2)return{sheetId:e,tableName:l,hasIssues:!1,issues:[]};const s=a?.content?.length||1,d=t.content.length;if(d<=s)return{sheetId:e,tableName:l,hasIssues:!1,issues:[]};const u=s,p=d-1;console.info(`[ACU IntegrityCheck] 表格 "${l}" 检测到新增行: 快照${s-1}行 → 当前${d-1}行, 新增行范围: 第${u}~${p}行(content索引)`);const m=t.content[0],f=m.findIndex(e=>String(e).trim()===n.indexColumnName);if(-1===f)return console.info(`[ACU IntegrityCheck] 表格 "${l}" 没有编码索引列，跳过检测`),{sheetId:e,tableName:l,hasIssues:!1,issues:[]};let g=null;if(a?.content&&a.content.length>1){g=i(a.content[a.content.length-1][f])}for(let a=u;a<=p;a++){const o=t.content[a],r=a-1;if(n.checkEmptyCell)for(let t=0;t<m.length;t++){const i=String(m[t]||'').trim();if(n.emptyCheckColumns&&n.emptyCheckColumns.length>0&&!n.emptyCheckColumns.includes(i))continue;const s=o[t];''===(null!=s?String(s).trim():'')&&c.push({sheetId:e,tableName:l,rowIndex:r,colIndex:t,issueType:'empty_cell',description:`AI新增的第 ${a} 行，"${m[t]}" 列为空`,currentValue:''})}if(n.checkIndexGap){const n=i(o[f]);if(a===u&&null!==g&&null!==n)n!==g+1&&c.push({sheetId:e,tableName:l,rowIndex:r,colIndex:f,issueType:'index_gap',description:`AI新增行索引从 ${g} 跳到 ${n}`,currentValue:String(o[f]??''),expectedValue:String(g+1)});else if(a>u){const s=a-1,d=i(t.content[s][f]);null!==d&&null!==n&&n!==d+1&&c.push({sheetId:e,tableName:l,rowIndex:r,colIndex:f,issueType:'index_gap',description:`AI新增行之间索引从 ${d} 跳到 ${n}`,currentValue:String(o[f]??''),expectedValue:String(d+1)})}}}return{sheetId:e,tableName:l,hasIssues:c.length>0,issues:c}}function d(e={}){const t={...n,...e},a=(0,o.ref)(new Map),i=(0,o.computed)(()=>{const e=[];return a.value.forEach(t=>{e.push(...t)}),e}),d=(0,o.computed)(()=>i.value.length>0),u=(0,o.computed)(()=>{const e=[];return a.value.forEach((t,a)=>{t.length>0&&e.push(a)}),e}),p=(0,o.computed)(()=>{let e=0,t=0;return i.value.forEach(a=>{'empty_cell'===a.issueType&&e++,'index_gap'===a.issueType&&t++}),{total:i.value.length,emptyCell:e,indexGap:t}});return{issuesByTable:a,allIssues:i,hasIssues:d,problematicTables:u,issueStats:p,checkIntegrity:function(e,o,n){const r=new Map;if(!e||!n||0===n.size)return void(a.value=r);const u=new Map;for(const e of n){const t=l(e),a=c(e);t&&null!==a&&(u.has(t)||u.set(t,new Set),u.get(t).add(a))}for(const a in e){if('mate'===a||'updated'===a||'created'===a||a.startsWith('_'))continue;const n=e[a];if(!n||!n.name)continue;const i=n.name,l=u.get(i);if(!l||0===l.size)continue;let c=null;if(o)for(const e in o)if(o[e]?.name===i){c=o[e];break}const d=s(a,n,c,0,t);d.hasIssues&&(r.set(d.tableName,d.issues),console.warn(`[ACU IntegrityCheck] 表格 "${d.tableName}" 发现 ${d.issues.length} 个问题`))}a.value=r,d.value?console.warn(`[ACU IntegrityCheck] 共发现 ${i.value.length} 个完整性问题`):console.info('[ACU IntegrityCheck] AI填表完整性检测通过')},hasTableIssues:function(e){const t=a.value.get(e);return!!t&&t.length>0},getTableIssues:function(e){return a.value.get(e)||[]},clearIssues:function(){a.value=new Map},getSummaryText:function(){if(!d.value)return'所有表格完整性检测通过';const e=p.value,t=[];return e.emptyCell>0&&t.push(`${e.emptyCell} 个空值`),e.indexGap>0&&t.push(`${e.indexGap} 个索引断裂`),`发现 ${t.join('、')}，共 ${e.total} 个问题`},isSummaryOrOutlineTable:r}}},5604(e,t,a){a.d(t,{d:()=>u,toast:()=>p});var o=a(4061);const n=(0,o.ref)({visible:!1,message:'',type:'info',timer:null});function r(e,t='info',a=3e3){n.value.timer&&clearTimeout(n.value.timer),n.value.visible=!0,n.value.message=e,n.value.type=t,n.value.timer=setTimeout(()=>{n.value.visible=!1,n.value.timer=null},a)}function i(){n.value.timer&&clearTimeout(n.value.timer),n.value.visible=!1,n.value.timer=null}function l(e,t=3e3){r(e,'success',t)}function c(e,t=4e3){r(e,'error',t)}function s(e,t=3500){r(e,'warning',t)}function d(e,t=3e3){r(e,'info',t)}function u(){return{state:n,show:r,hide:i,success:l,error:c,warning:s,info:d}}const p={show:r,hide:i,success:l,error:c,warning:s,info:d}},5749(e,t,a){a.d(t,{KX:()=>l,R3:()=>c,_V:()=>n,dK:()=>r,o9:()=>i});a(4061);var o=a(4778);function n(e){const t=(0,o.M1)().getDB(),a=t?.exportTableAsJson?.();if(!a)return e;const n=a[`sheet_${e}`];return n?.name||e}function r(){const e=(0,o.M1)().getDB(),t=e?.exportTableAsJson?e.exportTableAsJson():null;if(!t)return console.info('[useWordPool] ACU API 不可用或返回空，无法检测词库表'),[];const a=[];for(const[e,o]of Object.entries(t)){if(!e.startsWith('sheet_'))continue;const t=e.replace('sheet_',''),n=o.name||'',r=['随机','随机词','random','dict','chaos'].some(e=>n.toLowerCase().includes(e.toLowerCase())),i=['随机','随机词','random','dict','chaos'].some(e=>t.toLowerCase().includes(e.toLowerCase()));(r||i)&&a.push(t)}return console.info(`[useWordPool] 扫描了 ${Object.keys(t).length} 个表，检测到 ${a.length} 个词库表:`,a),a}function i(e){const t=(0,o.M1)().getDB(),a=t?.exportTableAsJson?t.exportTableAsJson():null;if(!a)return[];const n=a[`sheet_${e}`];return Array.isArray(n)?n:n&&'object'==typeof n&&Array.isArray(n.content)?n.content:[]}function l(e,t,a,o){const n=r(),l=[],s=new Map;for(const e of n){const t=o[e];if(t&&!t.enabled)continue;const a=i(e);if(a.length<=1)continue;const n=a[a.length-1],r=[];if(Array.isArray(n))for(const e of n)if(e&&'string'==typeof e){const t=e.trim();t&&r.push(t)}r.length>0&&s.set(e,r)}if('perItem'===e){for(const[e,a]of s){const e=Math.min(t,a.length),o=c([...a]);l.push(...o.slice(0,e))}console.info(`[useWordPool] perItem 模式从表格抽取 ${l.length} 个词:`,l)}else if('custom'===e){let e=a;for(const[a,n]of s){if(e<=0)break;const r=o[a],i=r?.limit||0,s=i>0?Math.min(i,e):Math.min(t,e),d=Math.min(s,n.length),u=c([...n]);l.push(...u.slice(0,d)),e-=d}console.info(`[useWordPool] custom 模式从表格抽取 ${l.length} 个词:`,l)}else{const e=[];for(const t of s.values())e.push(...t);const t=c(e),o=Math.min(a,t.length);l.push(...t.slice(0,o)),console.info(`[useWordPool] mixed 模式从表格抽取 ${l.length} 个词:`,l)}return l}function c(e){const t=[...e];for(let e=t.length-1;e>0;e--){const a=Math.floor(Math.random()*(e+1));[t[e],t[a]]=[t[a],t[e]]}return t}},6744(e,t,a){a.d(t,{$P:()=>o.$P,Ct:()=>i.C,D$:()=>n.D,H6:()=>l.H6,JH:()=>o.JH,MP:()=>o.MP,j_:()=>l.j_,mu:()=>o.mu,zI:()=>r.zI});var o=a(9388),n=(a(4674),a(4866)),r=(a(9185),a(420)),i=(a(9623),a(4293)),l=a(6964)},9388(e,t,a){a.d(t,{$P:()=>l,JH:()=>m,MP:()=>f,mu:()=>c,pQ:()=>u,um:()=>p,zG:()=>d});var o=a(4015),n=a(3035),r=a(4061),i=a(2867);const l={type:'icon',content:'fa-layer-group',size:50,notifyAnimation:'ripple',borderColor:'#ffffff',borderOpacity:40,bgColor:'#ffffff',bgOpacity:25,imageInvert:!1,enableNotifyAnimation:!0},c=[{id:'save',icon:'fa-save',label:'保存'},{id:'saveAs',icon:'fa-file-export',label:'另存为'},{id:'undo',icon:'fa-undo',label:'撤回'},{id:'refresh',icon:'fa-sync-alt',label:'刷新'},{id:'manualUpdate',icon:'fa-hand-sparkles',label:'手动更新'},{id:'purge',icon:'fa-eraser',label:'清除范围'},{id:'pin',icon:'fa-thumbtack',label:'固定面板'},{id:'toggle',icon:'fa-compress',label:'收起面板'},{id:'openNative',icon:'fa-external-link-alt',label:'原生编辑器'},{id:'collapseTab',icon:'fa-box-open',label:'收纳Tab'},{id:'director',icon:'fa-clapperboard',label:'导演控制台'},{id:'settings',icon:'fa-cog',label:'设置'}],s={theme:'retro',fontFamily:'default',cardWidth:280,fontSize:13,itemsPerPage:20,highlightNew:!0,highlightColor:'orange',highlightManualColor:'orange',highlightAiColor:'blue',customTitleColor:!1,titleColor:'orange',layout:'vertical',limitLongText:!1,showDashboard:!0,showPagination:!0,lockPanel:!1,purgeConfirmation:!0,gridColumns:0,autoSave:!1,autoSaveDelay:5e3,visibleButtons:['save','collapseTab','refresh','toggle','settings'],buttonOrder:['save','collapseTab','refresh','toggle','settings','director','saveAs','undo','manualUpdate','purge','pin','openNative'],buttonGroups:[],longPressDirectExec:!1,clearTableOnSwipe:!0,collapseTabBar:!1,showCollapseTabButton:!0,mobileSafeAreaBottom:50,autoImportInteractions:!1,enableIOSInputFix:!1},d=[{id:'retro',name:'复古羊皮',icon:'fa-scroll'},{id:'dark',name:'极夜深空',icon:'fa-moon'},{id:'modern',name:'现代清爽',icon:'fa-sun'},{id:'forest',name:'森之物语',icon:'fa-tree'},{id:'ocean',name:'深海幽蓝',icon:'fa-water'},{id:'cyber',name:'赛博霓虹',icon:'fa-bolt'},{id:'purple',name:'梦幻浅紫',icon:'fa-magic'}],u=[{id:'default',name:'系统默认 (Modern)',val:'\'Segoe UI\', \'Microsoft YaHei\', sans-serif'},{id:'hanchan',name:'寒蝉全圆体',val:'"寒蝉全圆体", sans-serif'},{id:'maple',name:'Maple Mono (代码风)',val:'"Maple Mono NF CN", monospace'},{id:'huiwen',name:'汇文明朝体 (Huiwen)',val:'"Huiwen-mincho", serif'},{id:'cooper',name:'Cooper正楷',val:'"CooperZhengKai", serif'},{id:'yffyt',name:'YFFYT (艺术体)',val:'"YFFYT", sans-serif'},{id:'fusion',name:'Fusion Pixel (像素风)',val:'"Fusion Pixel 12px M latin", monospace'},{id:'wenkai',name:'霞鹜文楷 (WenKai)',val:'"LXGW WenKai", serif'},{id:'notosans',name:'思源黑体 (Noto Sans)',val:'"Noto Sans CJK", sans-serif'},{id:'zhuque',name:'朱雀仿宋 (Zhuque)',val:'"Zhuque Fangsong (technical preview)", serif'}],p={orange:{main:'#d35400',bg:'rgba(211, 84, 0, 0.1)',name:'活力橙'},red:{main:'#e74c3c',bg:'rgba(231, 76, 60, 0.1)',name:'警示红'},blue:{main:'#3498db',bg:'rgba(52, 152, 219, 0.1)',name:'天空蓝'},green:{main:'#27ae60',bg:'rgba(39, 174, 96, 0.1)',name:'自然绿'},purple:{main:'#9b59b6',bg:'rgba(155, 89, 182, 0.1)',name:'罗兰紫'},teal:{main:'#1abc9c',bg:'rgba(26, 188, 156, 0.1)',name:'青绿'},pink:{main:'#e91e63',bg:'rgba(233, 30, 99, 0.1)',name:'少女粉'},lime:{main:'#82c91e',bg:'rgba(130, 201, 30, 0.1)',name:'酸橙'},indigo:{main:'#3f51b5',bg:'rgba(63, 81, 181, 0.1)',name:'靛蓝'},cyan:{main:'#00bcd4',bg:'rgba(0, 188, 212, 0.1)',name:'青色'},brown:{main:'#795548',bg:'rgba(121, 85, 72, 0.1)',name:'咖啡'},grey:{main:'#607d8b',bg:'rgba(96, 125, 139, 0.1)',name:'蓝灰'}},m=(0,n.defineStore)('acu-config',()=>{const e=(0,i.X0)(),t=(0,r.ref)({...s,...(0,o.klona)(e.config.ui)}),a=(0,r.ref)([...e.config.buttons?.visibleButtons||i.td.visibleButtons]),n=(0,r.ref)([...e.config.buttons?.buttonOrder||i.td.buttonOrder]),l=(0,r.ref)((0,o.klona)(e.config.buttons?.buttonGroups||i.td.buttonGroups)),d=(0,r.ref)(e.config.buttons?.longPressDirectExec??i.td.longPressDirectExec);let m=!0;function f(){m||(e.config.buttons={visibleButtons:[...a.value],buttonOrder:[...n.value],buttonGroups:(0,o.klona)(l.value),longPressDirectExec:d.value},e.saveConfig(),console.log('[ACU ConfigStore] 按钮配置已保存:',e.config.buttons))}(0,r.watch)(t,t=>{m||(Object.assign(e.config.ui,(0,o.klona)(t)),e.saveConfig())},{deep:!0}),(0,r.watch)(a,f,{deep:!0}),(0,r.watch)(n,f,{deep:!0}),(0,r.watch)(l,f,{deep:!0}),(0,r.watch)(d,f),setTimeout(()=>{m=!1},100);const g=(0,r.computed)(()=>t.value.theme),v=(0,r.computed)(()=>t.value.fontFamily),b=(0,r.computed)(()=>{const e=u.find(e=>e.id===t.value.fontFamily);return e?.val||u[0].val});function h(e){const t=e.startsWith('#')?e:`#${e}`,a=parseInt(t.slice(1,3),16),o=parseInt(t.slice(3,5),16),n=parseInt(t.slice(5,7),16);return{main:t,bg:`rgba(${a}, ${o}, ${n}, 0.1)`,name:'自定义颜色'}}const x=(0,r.computed)(()=>p[t.value.highlightColor]||p.orange),w=(0,r.computed)(()=>{if('custom'===t.value.highlightManualColor&&t.value.customHighlightManualHex)return h(t.value.customHighlightManualHex);const e=t.value.highlightManualColor||t.value.highlightColor;return p[e]||p.orange}),y=(0,r.computed)(()=>{if('custom'===t.value.highlightAiColor&&t.value.customHighlightAiHex)return h(t.value.customHighlightAiHex);const e=t.value.highlightAiColor||'blue';return p[e]||p.blue}),k=(0,r.computed)(()=>t.value.customTitleColor?'custom'===t.value.titleColor&&t.value.customTitleHex?h(t.value.customTitleHex):p[t.value.titleColor]||p.orange:w.value),C=(0,r.computed)(()=>t.value.gridColumns&&t.value.gridColumns>0?`repeat(${t.value.gridColumns}, 1fr)`:'repeat(auto-fill, minmax(110px, 1fr))');const N=(0,r.computed)(()=>{const e=n.value,t=a.value,o=e.filter(e=>t.includes(e));return console.log('[ACU ConfigStore] sortedVisibleButtons:',o,'order:',e,'visible:',t),o}),V=(0,r.computed)(()=>{const e=a.value,t=l.value.map(e=>e.secondaryId).filter(Boolean);return c.filter(a=>!a.hidden&&!e.includes(a.id)&&!t.includes(a.id))}),E=(0,r.computed)(()=>V.value.length>0);const B=(0,r.computed)(()=>l.value),T=(0,r.computed)(()=>d.value);const S=(0,r.computed)(()=>({visibleButtons:a.value,buttonOrder:n.value,buttonGroups:l.value,longPressDirectExec:d.value}));return{config:t,buttonsConfig:S,theme:g,fontFamily:v,fontFamilyValue:b,highlightColorObj:x,highlightManualColorObj:w,highlightAiColorObj:y,titleColorObj:k,gridColumnsCss:C,updateConfig:function(e){Object.assign(t.value,e)},resetConfig:function(){t.value={...s}},setTheme:function(e){t.value.theme=e},setFontFamily:function(e){t.value.fontFamily=e},setLayout:function(e){t.value.layout=e},setHighlightColor:function(e){t.value.highlightColor=e,t.value.highlightManualColor=e},setHighlightManualColor:function(e){t.value.highlightManualColor=e,t.value.highlightColor=e},setHighlightAiColor:function(e){t.value.highlightAiColor=e},setTitleColor:function(e){t.value.titleColor=e},toggleHighlightNew:function(){t.value.highlightNew=!t.value.highlightNew},toggleCustomTitleColor:function(){t.value.customTitleColor=!t.value.customTitleColor},toggleShowDashboard:function(){t.value.showDashboard=!t.value.showDashboard},toggleShowPagination:function(){t.value.showPagination=!t.value.showPagination},toggleLockPanel:function(){t.value.lockPanel=!t.value.lockPanel},toggleLimitLongText:function(){t.value.limitLongText=!t.value.limitLongText},setVisibleButtons:function(e){a.value=[...e],console.log('[ACU ConfigStore] setVisibleButtons:',a.value)},setButtonOrder:function(e){n.value=[...e],console.log('[ACU ConfigStore] setButtonOrder:',n.value)},isButtonVisible:function(e){return a.value.includes(e)},toggleButtonVisibility:function(e){const t=[...a.value],o=t.indexOf(e);o>-1?t.splice(o,1):t.push(e),a.value=t},sortedVisibleButtons:N,hiddenButtons:V,hasHiddenButtons:E,getButtonConfig:function(e){return c.find(t=>t.id===e)},buttonGroups:B,longPressDirectExec:T,setButtonGroups:function(e){l.value=(0,o.klona)(e)},addButtonGroup:function(e,t){const a=l.value.filter(a=>a.secondaryId!==t&&a.primaryId!==e);a.push({primaryId:e,secondaryId:t}),l.value=[...a],console.log('[ACU] addButtonGroup:',e,'->',t,'groups:',a)},removeButtonGroupSecondary:function(e){const t=l.value.filter(t=>t.primaryId!==e);l.value=[...t],console.log('[ACU] removeButtonGroupSecondary:',e,'groups:',t)},getSecondaryButtonId:function(e){const t=l.value.find(t=>t.primaryId===e);return t?.secondaryId||null},isSecondaryButton:function(e){return l.value.some(t=>t.secondaryId===e)},toggleLongPressDirectExec:function(){d.value=!d.value},setLongPressDirectExec:function(e){d.value=e},resetButtonConfig:function(){a.value=[...i.td.visibleButtons],n.value=[...i.td.buttonOrder],l.value=[],d.value=!1,console.log('[ACU ConfigStore] 按钮配置已重置')}}}),f=(0,n.defineStore)('acu-ball-appearance',()=>{const e=(0,i.X0)(),t=(0,r.ref)({...l,...(0,o.klona)(e.config.ball?.appearance||{})}),a=(0,r.ref)((0,o.klona)(e.config.ball?.customFonts||[])),n=(0,r.computed)(()=>!0);let c=!0;(0,r.watch)(t,t=>{c||(e.config.ball||(e.config.ball={appearance:{},customFonts:[]}),Object.assign(e.config.ball.appearance,(0,o.klona)(t)),e.saveConfig())},{deep:!0}),(0,r.watch)(a,t=>{c||(e.config.ball||(e.config.ball={appearance:{},customFonts:[]}),e.config.ball.customFonts=(0,o.klona)(t),e.saveConfig())},{deep:!0}),setTimeout(()=>{c=!1},100);const s=(0,r.computed)(()=>a.value.filter(e=>e.importUrl).map(e=>e.importUrl)),d=(0,r.computed)(()=>[...u,...a.value.map(e=>({id:e.id,name:e.name,val:e.fontFamily}))]);function p(e,t){const a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!a)return e;return`rgba(${parseInt(a[1],16)}, ${parseInt(a[2],16)}, ${parseInt(a[3],16)}, ${t/100})`}const m=(0,r.computed)(()=>{const e=t.value;return{'--ball-size':`${e.size}px`,'--ball-border-color':e.borderColor,'--ball-border-color-rgba':p(e.borderColor,e.borderOpacity),'--ball-bg-color':p(e.bgColor,e.bgOpacity)}});return{appearance:t,customFonts:a,isLoaded:n,updateAppearance:function(e){Object.assign(t.value,e)},setIcon:function(e,a){t.value.type=e,t.value.content=a},setSize:function(e){t.value.size=Math.max(40,Math.min(100,e))},setBorderColor:function(e,a){t.value.borderColor=e,void 0!==a&&(t.value.borderOpacity=a)},setBgColor:function(e,a){t.value.bgColor=e,void 0!==a&&(t.value.bgOpacity=a)},setNotifyAnimation:function(e){t.value.notifyAnimation=e},setEnableNotifyAnimation:function(e){t.value.enableNotifyAnimation=e},resetAppearance:function(){t.value={...l}},setAppearance:function(e){t.value={...l,...e}},addFont:function(e){const t={...e,id:`custom_${Date.now()}`};return a.value=[...a.value,t],t},removeFont:function(e){a.value=a.value.filter(t=>t.id!==e)},fontImportUrls:s,allFonts:d,cssVariables:m,hexToRgba:p}})},4674(e,t,a){a.d(t,{f:()=>u});var o=a(4015),n=a(3035),r=a(4061),i=a(2867),l=a(5749),c=a(9800),s=a(4778);const d={widgets:[],layout:'grid',columns:2,showStats:!0,hasInitializedDefaults:!1};const u=(0,n.defineStore)('acu-dashboard',()=>{const e=(0,i.X0)(),t=(0,r.ref)(!1),a=(0,r.ref)({...d});let n=!0;(0,r.watch)(a,t=>{n||(e.config.dashboard=(0,o.klona)(t),e.saveConfig())},{deep:!0});const u=(0,r.computed)(()=>{const e=a.value?.widgets;return Array.isArray(e)?e.filter(e=>e.enabled).sort((e,t)=>e.order-t.order):[]}),p=(0,r.computed)(()=>{const e=a.value?.widgets;return Array.isArray(e)?[...e].sort((e,t)=>e.order-t.order):[]}),m=(0,r.computed)(()=>a.value.showStats),f=(0,r.computed)(()=>a.value.columns),g=(0,r.computed)(()=>a.value.layout);async function v(){try{e.config.dashboard=(0,o.klona)(a.value),await e.saveConfig(),console.log('[ACU Dashboard] 配置保存成功')}catch(e){console.error('[ACU Dashboard] 配置保存失败:',e)}}function b(){let e=!1;const t=[...a.value.widgets];t.forEach(t=>{if('table'!==t.type)return;const a=t.widgetTagConfig?.displayedTagIds?.length>0,n=t.widgetTagConfig?.displayedCategoryIds?.length>0;if(a||n)return;let r;const i=t.title||t.tableId||'';for(const[e,t]of Object.entries(c.JT))if(t.some(e=>i.toLowerCase().includes(e.toLowerCase()))){r=c.b3[e];break}r?.widgetTagConfig&&(t.widgetTagConfig||(t.widgetTagConfig={displayedTagIds:[],displayedCategoryIds:[]}),t.widgetTagConfig=(0,o.klona)(r.widgetTagConfig),console.log(`[ACU Dashboard] 已自动为组件 "${t.title}" 应用默认标签配置`),e=!0)}),e&&(a.value={...a.value,widgets:t})}async function h(t=!0){const n=e.config.dashboard;if(n&&Array.isArray(n.widgets)&&n.widgets.length>0)return void(0!==a.value.widgets.length&&a.value.hasInitializedDefaults||(a.value=(0,o.klona)({...d,...n,hasInitializedDefaults:!0}),console.log('[ACU Dashboard] 从 ConfigManager 恢复配置，widgets:',a.value.widgets.length)));if(a.value.hasInitializedDefaults)return void console.log('[ACU Dashboard] 已完成首次初始化，跳过默认组件添加');if(a.value.widgets.length>0)return console.log('[ACU Dashboard] 检测到已有配置（旧版本升级），标记为已初始化'),a.value={...a.value,hasInitializedDefaults:!0},void(t&&(e.config.dashboard=(0,o.klona)(a.value),await e.saveConfig()));let r=!1;a.value.widgets.some(e=>'updateStatus'===e.type)||(y('updateStatus',!1),r=!0);const i=(0,l.dK)();i.length>0&&(a.value.widgets.some(e=>'randomWordPool'===e.type)||(y('randomWordPool',!1),r=!0,console.log(`[ACU Dashboard] 检测到 ${i.length} 个随机表，已自动添加随机词表组件`)));const u=(0,s.tu)();if(!u){if(r&&t){const t=a.value;e.config.dashboard={...t,hasInitializedDefaults:!0},v()}return}const p=(0,s.tE)(u);if(!p){if(r&&t){const t=a.value;e.config.dashboard={...t,hasInitializedDefaults:!0},v()}return}const m=[{keywords:c.JT.task||[],templateKey:'task'},{keywords:c.JT.item||[],templateKey:'item'},{keywords:c.JT.global||[],templateKey:'global'},{keywords:['交互','互动'],templateKey:'interaction'}];for(const[e,t]of Object.entries(p)){const o=t.key,n=e.toLowerCase();for(const t of m)if(t.keywords.some(e=>n.includes(e.toLowerCase()))){a.value.widgets.some(e=>e.tableId===o)||(x(o,e,t.templateKey,!1),console.log(`[ACU Dashboard] 自动添加表格: ${e} (模板: ${t.templateKey})`),r=!0);break}}a.value={...a.value,hasInitializedDefaults:!0},r&&t?console.log('[ACU Dashboard] 默认组件已更新（首次初始化）'):t&&console.log('[ACU Dashboard] 首次初始化完成，已保存初始化标记')}function x(e,t,r,i=!0){let l=r?c.b3[r]:void 0;const s=t||e;if(!l)for(const[e,t]of Object.entries(c.JT))if(t.some(e=>s.toLowerCase().includes(e.toLowerCase()))){l=c.b3[e];break}let d=l?.actions||['goToTable'];const u=s.toLowerCase();(u.includes('人物')||u.includes('npc'))&&(d.includes('relationshipGraph')||(d=[...d,'relationshipGraph']));let p=l?.displayStyle||'list';l||!t?.includes('交互')&&!t?.includes('互动')&&'sheet_Interaction_CN'!==e||(p='interaction');const m={id:`widget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:'table',tableId:e,title:l?.title||t||e,icon:l?.icon||'fa-table',displayColumns:l?.displayColumns||[],maxRows:l?.maxRows||8,actions:d,order:a.value.widgets.length,enabled:!0,colSpan:l?.colSpan||1,displayStyle:p,widgetTagConfig:l?.widgetTagConfig?(0,o.klona)(l.widgetTagConfig):void 0},f=[...a.value.widgets,m];return a.value={...a.value,widgets:f},i||(n=!0,setTimeout(()=>{n=!1},50)),m}function w(e,t){const o=[...a.value.widgets],n=o.find(t=>t.id===e);n&&(Object.assign(n,t),a.value={...a.value,widgets:o})}function y(e,t=!0){const o={updateStatus:{type:'updateStatus',title:'表格状态',icon:'fa-sync-alt',colSpan:2,actions:['nativeEdit']},optionsPanel:{type:'optionsPanel',title:'选项聚合面板',icon:'fa-list-check',colSpan:2},randomWordPool:{type:'randomWordPool',title:'随机词表',icon:'fa-dice',colSpan:1,actions:['settings']}}[e],r={id:`special_${e}_${Date.now()}`,type:e,title:o.title||e,icon:o.icon||'fa-cog',displayColumns:[],maxRows:10,actions:o.actions||[],order:a.value.widgets.length,enabled:!0,colSpan:o.colSpan||2,displayStyle:'list'},i=[...a.value.widgets,r];return a.value={...a.value,widgets:i},t||(n=!0,setTimeout(()=>{n=!1},50)),r}return{config:a,isInitialized:t,enabledWidgets:u,allWidgets:p,showStats:m,columns:f,layout:g,loadConfig:async function(){try{!function(){const t=e.config.dashboard;t&&Array.isArray(t.widgets)?(a.value=(0,o.klona)({...d,...t}),console.info('[DashboardStore] 配置已加载，widgets 数量:',a.value.widgets.length)):console.info('[DashboardStore] 未从 ConfigManager 读取到有效配置，保持当前状态')}(),setTimeout(()=>{n=!1},500);const r=a.value.widgets.length>0;await h(r),b(),t.value=!0,console.log('[ACU Dashboard] 配置加载成功:',a.value)}catch(e){console.warn('[ACU Dashboard] 加载配置失败:',e),t.value=!0,n=!1}},saveConfig:v,updateConfig:function(e){a.value={...a.value,...e}},addWidget:x,removeWidget:function(e){const t=[...a.value.widgets],o=t.findIndex(t=>t.id===e);-1!==o&&(t.splice(o,1),t.forEach((e,t)=>{e.order=t}),a.value={...a.value,widgets:t})},updateWidget:w,toggleWidget:function(e){const t=[...a.value.widgets],o=t.find(t=>t.id===e);o&&(o.enabled=!o.enabled,a.value={...a.value,widgets:t})},moveWidget:function(e,t){const o=[...a.value.widgets],n=o.findIndex(t=>t.id===e);if(-1===n)return;const[r]=o.splice(n,1);o.splice(t,0,r),o.forEach((e,t)=>{e.order=t}),a.value={...a.value,widgets:o}},setWidgetActions:function(e,t){w(e,{actions:t})},resetConfig:function(){a.value={...d}},findWidgetByTableId:function(e){return a.value.widgets.find(t=>t.tableId===e)},hasWidget:function(e){return a.value.widgets.some(t=>t.tableId===e)},hasSpecialWidget:function(e){return a.value.widgets.some(t=>t.type===e)},addSpecialWidget:y,removeSpecialWidget:function(e){const t=[...a.value.widgets],o=t.findIndex(t=>t.type===e);-1!==o&&(t.splice(o,1),t.forEach((e,t)=>{e.order=t}),a.value={...a.value,widgets:t})},getWidgetById:function(e){return a.value.widgets.find(t=>t.id===e)},ensureDefaultWidgets:h,cleanupInvalidWidgets:function(e){const t=new Set(e);let o=!1;const n=[...a.value.widgets];for(let e=n.length-1;e>=0;e--){const a=n[e];'table'===a.type&&a.tableId&&(t.has(a.tableId)||(console.log(`[ACU Dashboard] 移除无效组件: ${a.title} (Table ID: ${a.tableId} 不存在)`),n.splice(e,1),o=!0))}o&&(n.forEach((e,t)=>{e.order=t}),a.value={...a.value,widgets:n})},applyDefaultsToEmptyWidgets:b}})},4866(e,t,a){a.d(t,{D:()=>p});var o=a(4015),n=a(5708),r=a(3833),i=a(2134),l=a(4778),c=a(3035),s=a(4061);const d='acu_data_snapshot_v18_5';function u(e){if(null==e)return'';const t=String(e).trim();return'null'===t||'undefined'===t?'':t}const p=(0,c.defineStore)('acu-data',()=>{const e=(0,s.ref)(null),t=(0,s.ref)({}),a=(0,s.ref)(null),c=(0,s.ref)(null),p=(0,s.reactive)(new Set),m=(0,s.reactive)(new Set),f=(0,s.computed)(()=>{const e=new Set;return p.forEach(t=>e.add(t)),m.forEach(t=>e.add(t)),e}),g=(0,s.reactive)(new Set),v=(0,s.ref)(!1),b=(0,s.ref)(!1),h=(0,s.ref)(null),x=(0,i.te)(),w=((0,n.t)(),x.issuesByTable),y=x.hasIssues,k=x.problematicTables,C=x.issueStats,N=(0,s.computed)(()=>g.size>0),V=(0,s.computed)(()=>p.size>0||m.size>0||g.size>0),E=V,B=(0,s.computed)(()=>null!==c.value);function T(){try{const e=localStorage.getItem(d);return e?JSON.parse(e):null}catch{return null}}function S(e){try{a.value=(0,o.klona)(e),localStorage.setItem(d,JSON.stringify(e))}catch(e){console.error('[ACU] Save snapshot failed:',e)}}function D(){try{localStorage.removeItem(d)}catch{}}function A(e,t){return`${e}-row-${t}`}function I(e,t,a){return`${e}-${t}-${a}`}function M(){let e=window.SillyTavern||(window.parent?window.parent.SillyTavern:null);return!e&&window.top&&window.top.SillyTavern&&(e=window.top.SillyTavern),e}function U(e,t,o){if(!a.value)return'';for(const n in a.value){const r=a.value[n];if(r&&r.name===e&&r.content){const e=r.content[t+1];if(e&&void 0!==e[o])return String(e[o])}}return''}function P(){if(!e.value)return;const a=(0,o.klona)(e.value);for(const e in a){const o=a[e];if(!o||!o.name||!o.content)continue;const n=t.value[o.name];if(!n)continue;const r=o.content[0]||[],i=[r];for(const e of n){const t=[];for(let a=0;a<r.length;a++){const o=e.cells[a];t.push(o?o.value:'')}i.push(t)}o.content=i}e.value=a}function L(e=!1){p.clear(),m.clear(),e&&g.clear()}function F(e){const t={};for(const a in e){const o=e[a];if(!o?.name)continue;if(!o.content||!Array.isArray(o.content))continue;const n=o.name,r=o.content[0]||[],i=[];for(let e=1;e<o.content.length;e++){const t=o.content[e],a=[];for(let e=0;e<r.length;e++)a.push({key:String(r[e]||`col_${e}`),value:String(t[e]??'')});i.push({index:e-1,cells:a})}t[n]=i}return t}function j(e){if(0===g.size)return e;const t=(0,o.klona)(e);for(const e in t){if('mate'===e)continue;const a=t[e];if(!a||!a.name||!a.content)continue;const o=[a.content[0]];for(let e=1;e<a.content.length;e++){const t=e-1,n=A(a.name,t);g.has(n)||o.push(a.content[e])}a.content=o}return t}async function O(e,t){const a=M();if(!a||!a.chat||!a.chat[e])throw new Error(`楼层 ${e} 不存在`);const n=a.chat[e];let r='';if(n.TavernDB_ACU_IsolatedData){const e=Object.keys(n.TavernDB_ACU_IsolatedData);e.length>0&&(r=e[0])}else n.TavernDB_ACU_IsolatedData={};n.TavernDB_ACU_IsolatedData[r]||(n.TavernDB_ACU_IsolatedData[r]={independentData:{},modifiedKeys:[],updateGroupKeys:[]});const i=n.TavernDB_ACU_IsolatedData[r];i.independentData||(i.independentData={});const l=Object.keys(t).filter(e=>e.startsWith('sheet_'));l.forEach(e=>{i.independentData[e]=(0,o.klona)(t[e])});const c=i.modifiedKeys||[];i.modifiedKeys=[...new Set([...c,...l])]}async function R(){const e=(0,l.M1)().getDB();if(e&&e.syncWorldbookEntries)try{await e.syncWorldbookEntries({createIfNeeded:!0})}catch(e){console.warn('[ACU] Worldbook sync failed:',e)}}async function H(){const e=M();e?.saveChatDebounced?await e.saveChatDebounced():e?.saveChat&&await e.saveChat()}function W(e){g.has(e)?(g.delete(e),console.info(`[ACU] 取消删除标记: ${e}`)):(g.add(e),console.info(`[ACU] 添加删除标记: ${e}`))}function Y(e){const t=e.split('-');if(t.length>=2){const e=[];for(let a=0;a<t.length&&('row'!==t[a]&&!/^\d+$/.test(t[a]));a++)e.push(t[a]);if(e.length>0)return e.join('-')}return null}function X(t){if(!e.value)return null;for(const a in e.value)if(e.value[a]?.name===t)return a;return null}function G(e){return m.has(e)?'manual':p.has(e)?'ai':null}function q(e,a,o){const n=A(e,a);if(m.has(n))return'manual';if(p.has(n))return'ai';if(g.has(n))return'manual';const r=t.value[e],i=o??(r?.[a]?.cells.length||0);let l=!1,c=!1;for(let t=0;t<i;t++){const o=I(e,a,t);m.has(o)&&(l=!0),p.has(o)&&(c=!0)}return l?'manual':c?'ai':null}return{stagedData:e,tables:t,snapshot:a,aiDiffMap:p,manualDiffMap:m,diffMap:f,pendingDeletes:g,isSaving:v,isLoading:b,targetFloorInfo:h,lastSavedData:c,hasPendingDeletes:N,hasUnsavedChanges:V,hasChanges:E,getModifiedTableIds:function(){const t=new Set;for(const e of m){const a=Y(e);a&&t.add(a)}for(const e of p){const a=Y(e);a&&t.add(a)}for(const e of g){const a=Y(e);a&&t.add(a)}const a=new Set;for(const o of t){const t=X(o);t?a.add(t):e.value&&e.value[o]&&a.add(o)}return Array.from(a)},hasUndoData:B,getStagedData:function(){return e.value},loadFromDatabase:async function(){if(b.value)console.warn('[ACU] 加载进行中，跳过重复请求');else try{b.value=!0,console.info('[ACU] 开始加载数据...');const n=(0,l.tu)();if(!n)return void console.warn('[ACU] 未获取到表格数据');const r=(0,o.klona)(n);e.value=r;const i=F(r);Object.entries(i).reduce((e,[t,a])=>(e[t]=a,e),{});t.value=i,a.value=(0,o.klona)(r),p.clear(),m.clear(),g.clear(),S(r),x.checkIntegrity(r,null,new Set),console.info('[ACU] 数据加载完成，表格数量:',Object.keys(i).length)}catch(e){throw console.error('[ACU] 加载数据失败:',e),e}finally{b.value=!1}},processToTableData:F,setStagedData:function(a){const n=(0,o.klona)(a);return e.value=n,t.value=F(n),console.info('[ACU] 暂存数据已设置'),n},generateDiffMap:function(e){if(p.clear(),!a.value)return;const t=a.value;for(const a in e){if('mate'===a||'updated'===a||'created'===a||a.startsWith('_'))continue;const o=e[a],n=t[a];if(!o||!o.content)continue;const r=o.name||a.replace('sheet_','');if(!n||!n.content){for(let e=1;e<o.content.length;e++){const t=A(r,e-1);m.has(t)||p.add(t)}continue}const i=Math.max(o.content.length,n.content.length);for(let e=1;e<i;e++){const t=o.content[e],a=n.content[e],i=e-1;if(!t||!a){const e=A(r,i);if(m.has(e)||p.add(e),t&&!a)for(let e=0;e<t.length;e++){const t=I(r,i,e);m.has(t)||p.add(t)}continue}const l=Math.max(t.length,a.length);for(let e=0;e<l;e++){if(u(t[e])!==u(a[e])){const t=I(r,i,e);m.has(t)||p.add(t)}}}}console.info(`[ACU] AI差异映射已生成，AI变更: ${p.size}, 手动变更: ${m.size}`)},saveToDatabase:async function(){if(v.value)return console.warn('[ACU] 保存进行中，跳过重复请求'),{success:!1,savedToFloor:-1,error:'保存进行中'};try{v.value=!0,console.info('[ACU] 开始保存数据...');let t=e.value;if(t||(t=(0,l.tu)()),!t)throw new Error('无数据可保存');const n=j((0,o.klona)(t)),r=function(){const e=M();if(!e||!e.chat||0===e.chat.length)return-1;for(let t=e.chat.length-1;t>=0;t--){const a=e.chat[t];if(!a.is_user&&a.TavernDB_ACU_IsolatedData)return h.value={index:t,isAuto:!0,reason:'已存在数据'},t}for(let t=e.chat.length-1;t>=0;t--)if(!e.chat[t].is_user)return h.value={index:t,isAuto:!0,reason:'新建数据位置'},t;return-1}();if(-1===r)throw new Error('未找到合适的目标楼层');return await O(r,n),await R(),await H(),a.value=(0,o.klona)(n),e.value=(0,o.klona)(n),L(!0),S(n),console.info(`[ACU] 数据保存完成，目标楼层: ${r}`),{success:!0,savedToFloor:r}}catch(e){const t=e.message;return console.error('[ACU] 保存数据失败:',e),{success:!1,savedToFloor:-1,error:t}}finally{v.value=!1}},saveToFloor:async function(t){if(v.value)return console.warn('[ACU] 保存进行中，跳过重复请求'),{success:!1,savedToFloor:-1,error:'保存进行中'};try{v.value=!0,console.info(`[ACU] 保存到第 ${t} 楼...`);let n=e.value;if(n||(n=(0,l.tu)()),!n)throw new Error('无数据可保存');const r=j((0,o.klona)(n));return await O(t,r),await R(),await H(),a.value=(0,o.klona)(r),e.value=(0,o.klona)(r),L(!0),S(r),console.info(`[ACU] 已保存到第 ${t} 楼`),{success:!0,savedToFloor:t}}catch(e){const t=e.message;return console.error('[ACU] 保存到指定楼层失败:',e),{success:!1,savedToFloor:-1,error:t}}finally{v.value=!1}},purgeFloorRange:async function(a,n){if(v.value)console.warn('[ACU] 操作进行中，跳过重复请求');else try{v.value=!0,console.info(`[ACU] 清除第 ${a} 到 ${n} 楼的数据...`);const r=M();if(!r||!r.chat)throw new Error('无法访问聊天记录');const i=r.chat.length-1,c=Math.max(0,a),s=Math.min(i,n);if(isNaN(c)||isNaN(s)||c>s)throw new Error('无效的楼层范围');const d=['TavernDB_ACU_Data','TavernDB_ACU_SummaryData','TavernDB_ACU_IndependentData','TavernDB_ACU_Identity','TavernDB_ACU_IsolatedData','TavernDB_ACU_ModifiedKeys','TavernDB_ACU_UpdateGroupKeys'];let u=0;for(let e=c;e<=s;e++){const t=r.chat[e];if(!t)continue;let a=!1;for(const e of d)Object.prototype.hasOwnProperty.call(t,e)&&(delete t[e],a=!0);a&&u++}if(u>0){await H(),await R();const a=(0,l.tu)();if(a){const n=(0,o.klona)(a);e.value=n,t.value=F(n),S(n)}else e.value=null,t.value={},D();L(!0)}console.info(`[ACU] 已清除 ${u} 个楼层的数据`)}catch(e){throw console.error('[ACU] 清除楼层数据失败:',e),e}finally{v.value=!1}},insertRow:function(e,a){const o=t.value[e];if(!o||0===o.length)return void console.warn(`[ACU] 表格 ${e} 不存在或为空`);const n=o[0],r={index:o.length,cells:n.cells.map(e=>({key:e.key,value:''}))};o.splice(a+1,0,r),o.forEach((e,t)=>{e.index=t});const i=A(e,a+1);m.add(i),P(),console.info(`[ACU] 在 ${e} 第 ${a} 行后插入新行`)},updateCell:function(e,a,o,n,i){const l=t.value[e];if(!l||!l[a])return void console.warn(`[ACU] 无效的单元格位置: ${e}[${a}][${o}]`);const c=l[a];if(c.cells[o]){const t=c.cells[o].value;c.cells[o].value=n;const l=I(e,a,o);if(n!==U(e,a,o)){if(m.add(l),p.delete(l),!i?.skipHistory){const i=function(){const e=M();if(e?.getCurrentChatId){const t=e.getCurrentChatId();if(t)return t}return e?.chat_metadata?.chat_id?String(e.chat_metadata.chat_id):e?.chat?.length>0&&e.chat[0]?.chat_id?e.chat[0].chat_id:'default'}();if(console.info('[ACU] 保存历史记录, 参数:',{chatId:i,tableId:e,rowIndex:a,colIndex:o,oldValue:t.substring(0,50)+(t.length>50?'...':''),newValue:n.substring(0,50)+(n.length>50?'...':'')}),i){const n={index:a,key:A(e,a),cells:c.cells.map((e,a)=>({colIndex:a,key:e.key,value:a===o?t:e.value}))};(0,r.O)(i,e,n,'manual').then(()=>{console.info('[ACU] 历史记录保存成功')}).catch(e=>{console.warn('[ACU] 历史记录保存失败:',e)})}else console.warn('[ACU] 无法获取 chatId，跳过历史记录保存')}}else{m.delete(l),p.delete(l);c.cells.every((t,o)=>t.value===U(e,a,o))&&c.cells.forEach((_,t)=>{const o=I(e,a,t);m.delete(o),p.delete(o)})}P(),console.info(`[ACU] 更新 ${e}[${a}][${o}]: "${t}" -> "${n}"`)}},toggleDelete:W,toggleDeleteRow:function(e,t){W(A(e,t))},markForDelete:function(e,t){const a=A(e,t);g.add(a)},unmarkForDelete:function(e,t){const a=A(e,t);g.delete(a)},getCellChangeType:G,getRowChangeType:q,hasTableAiChanges:function(e){for(const t of p)if(t.startsWith(`${e}-`))return!0;return!1},getTablesWithAiChanges:function(){const e=new Set;for(const t of p){const a=Y(t);a&&e.add(a)}return Array.from(e)},isRowChanged:function(e,t,a){return null!==q(e,t,a)},isRowPendingDelete:function(e,t){return g.has(A(e,t))},isPendingDelete:function(e){return g.has(e)},isCellChanged:function(e){return null!==G(e)},getRowKey:A,getCellKey:I,clearChanges:L,syncToStagedData:P,loadSnapshot:T,saveSnapshot:S,clearSnapshot:D,saveLastState:function(){const e=a.value||T();e?(c.value=(0,o.klona)(e),console.info('[ACU] 已保存当前快照到撤回缓存')):console.warn('[ACU] 无快照数据可保存到撤回缓存')},undoToLastSave:function(){if(!c.value)return console.warn('[ACU] 无可撤回的数据'),!1;const n=(0,o.klona)(c.value);e.value=n;const r=F(n);t.value=r,p.clear(),g.clear();const i=[];if(a.value)for(const e in n){if('mate'===e||'updated'===e||'created'===e||e.startsWith('_'))continue;const t=n[e],o=a.value[e];if(!t?.content)continue;const r=t.name||e.replace('sheet_','');if(!o?.content){for(let e=1;e<t.content.length;e++){const t=A(r,e-1);i.push(t)}continue}const l=Math.max(t.content.length,o.content.length);for(let e=1;e<l;e++){const a=t.content[e],n=o.content[e],l=e-1;if(!a||!n){const e=A(r,l);i.push(e);continue}const c=Math.max(a.length,n.length);for(let e=0;e<c;e++){if(String(a[e]??'')!==String(n[e]??'')){const t=I(r,l,e);i.push(t)}}}}return m.clear(),i.forEach(e=>m.add(e)),m.add('__undo_pending__'),console.info(`[ACU] 撤回后差异: 手动变更 ${m.size} 项`),console.info('[ACU] 已撤回到上次保存前的状态（需手动保存）'),!0},clearUndoCache:function(){c.value=null,console.info('[ACU] 已清除撤回缓存')},getUndoData:function(){return c.value?(0,o.klona)(c.value):null},integrityIssues:w,hasIntegrityIssues:y,problematicTables:k,integrityStats:C,checkIntegrity:e=>{x.checkIntegrity(e,a.value,p)},hasTableIssues:x.hasTableIssues,getTableIssues:x.getTableIssues,getIntegritySummary:x.getSummaryText,clearIntegrityIssues:x.clearIssues,isSummaryOrOutlineTable:i.qy}})},9185(e,t,a){a.d(t,{E:()=>g});var o=a(3035),n=a(4061),r=a(2867),i=a(5397),l=a(5749),c=a(4778),s=a(9687);const d='ACU_Divination',u={id:'luck',name:'运势',enabled:!0,tiers:i.EZ},p={id:'sanity',name:'扭曲度',enabled:!1,tiers:[{id:'normal',name:'正常逻辑',weight:50,prompt:''},{id:'absurd',name:'"天然合理"',weight:50,prompt:'特别要求：若需要融合非日常要素，场景中的所有角色必须将其视为日常生活中理所当然的一部分，绝不要有特殊反应。'}]},m={id:'misunderstanding',name:'误会机制',enabled:!1,tiers:[{id:'semantic',name:'语义歧义',weight:1,prompt:'请设计一段对话，让角色A在谈论某物品或事件时省略关键主语，导致角色B误会谈论对象，产生错误联想而导致的误会。'},{id:'projection',name:'预设偏见',weight:1,prompt:'请基于角色B当前的心理阴影或秘密（如自卑、愧疚、暗恋），强行将角色A的一个善意或无心的举动，解读为负面，从而产生低落情绪。'},{id:'fragment',name:'断章取义',weight:1,prompt:'请构建一个场景，安排角色B在「最容易引起误解的时间点」闯入或路过，只目击到事件的「结果」而完全错过了「起因」，导致B通过逻辑补全推导出偏差认知。'},{id:'jargon',name:'电波接错',weight:1,prompt:'请让角色A使用意有所指的话、圈子黑话或网络梗进行表达，而角色B完全按字面意思理解，产生有趣或严肃的持续性误会。'}]},f={enabled:!0,drawCount:4,enableBias:!0,autoSync:!0,cardBackImage:'',themeColor:'#6b4c9a',themeId:'wafuku',flipMode:'auto',peepMode:!1,dimensions:[u,p,m],customTemplate:'',enableWordDrawing:!0,enableTableWords:!0,enableWordPool:!1,wordDrawMode:'perItem',wordsPerItem:1,tableColumnConfig:void 0,tablePoolConfig:{},categoryConfig:{},tableSyncConfig:{}},g=(0,o.defineStore)('acu-divination',()=>{const e=(0,r.X0)();const t=(0,n.ref)(function(){const t=e.config.divination.config;return{...f,...t,dimensions:t?.dimensions?.length>0?t.dimensions:f.dimensions,tablePoolConfig:t?.tablePoolConfig||{},tableSyncConfig:t?.tableSyncConfig||{}}}());let a=!0;(0,n.watch)(t,t=>{a?a=!1:(e.config.divination.config=t,e.saveConfig())},{deep:!0});const o=(0,n.computed)({get:()=>e.config.divination.presets||[],set:t=>{e.config.divination.presets=t,e.saveConfig()}}),i=(0,n.computed)({get:()=>e.config.divination.activePresetId,set:t=>{e.config.divination.activePresetId=t,e.saveConfig()}}),g=(0,n.ref)([]),v=(0,n.computed)(()=>e.isLoaded.value);function b(a){const n={id:`preset_${Date.now()}`,name:a,createdAt:(new Date).toISOString(),dimensions:JSON.parse(JSON.stringify(t.value.dimensions))},r=[...o.value,n];return e.config.divination.presets=r,e.config.divination.activePresetId=n.id,e.saveConfig(),n}function h(e){const t=e.split('|'),a=t[0];let o='neutral',n=0;if(t.length>1){const e=t[1];o='正'===e||'positive'===e?'positive':'负'===e||'negative'===e?'negative':'neutral'}return t.length>2&&(n=parseInt(t[2],10)||0),{name:a,bias:o,limit:n}}async function x(){try{if('function'!=typeof getWorldbook)return void console.warn('[Divination] getWorldbook API unavailable');const e=await getWorldbook(d);g.value=e.map(e=>{const{name:t,bias:a,limit:o}=h(e.name),n=e.content.split('\n').map(e=>e.trim()).filter(e=>e);return{id:e.uid,name:t,bias:a,limit:o,path:[...e.strategy.keys,t],words:n,enabled:e.enabled,rawEntry:e}}),console.info(`[Divination] Loaded ${g.value.length} categories from worldbook`)}catch(e){console.warn('[Divination] Failed to load worldbook (it might not exist yet):',e),g.value=[]}}function w(e,t){if(0===e.length||e.length!==t.length)return null;const a=t.reduce((e,t)=>e+t,0);let o=Math.random()*a;for(let a=0;a<e.length;a++)if(o-=t[a],o<=0)return e[a];return e[e.length-1]}return{config:t,categories:g,isLoaded:v,loadConfig:function(){console.info('[Divination] 配置已就绪')},saveConfig:function(){e.saveConfig(),console.info('[Divination] 已保存配置')},loadFromWorldbook:x,syncFromACU:async function(){console.info('[Divination] Starting sync from ACU...');try{const e=(0,c.tu)();if(!e)return void console.warn('[Divination] No ACU table data found');const a=[],o=t.value.tableSyncConfig||{};for(const t in e){const n=e[t];if(n.name&&(n.name.includes('Random')||n.name.includes('随机'))){const e=n.id||t;if(!1===o[e]){console.info(`[Divination] Table ${n.name} (${e}) sync disabled by config`);continue}a.push(n)}}if(0===a.length)return void console.info('[Divination] No tables found to sync (or all disabled)');const n=new Map;for(const e of a){const t=e.content?.[0]||[],a=e.content?.slice(1)||[],o=e.name||'Random';t.forEach((e,t)=>{const r=String(e).trim();if(!r)return;const i=/^(列\d+|Column\s*\d+|Col\s*\d+|[A-Z])$/i.test(r)?o:r;let{name:l,bias:c,limit:s}=h(i);-1===r.indexOf('|')&&(l.includes('吉')||l.includes('好')||l.includes('正')||l.includes('赏')?c='positive':(l.includes('凶')||l.includes('坏')||l.includes('负')||l.includes('罚'))&&(c='negative'));const d=`${l}|${c}|${s}`;if(n.has(d)){const e=n.get(d);e.keys.includes(o)||e.keys.push(o)}else n.set(d,{name:l,bias:c,limit:s,words:new Set,keys:[o]});a.forEach(e=>{const a=e[t];if(a){const e=String(a).trim();e&&n.get(d).words.add(e)}})})}let r=[];try{r=await getWorldbook(d)}catch{}const i=[];for(const[e,t]of n){const e=`${t.name}|${t.bias}|${t.limit}`,a=r.find(t=>t.name===e),o=a?a.content.split('\n').map(e=>e.trim()).filter(e=>e):[],n=new Set([...o,...t.words]),l=Array.from(n).join('\n');if(a){const e=a.strategy?.keys||[],o=Array.from(new Set([...e,...t.keys]));i.push({...a,content:l,strategy:{...a.strategy,keys:o}})}else i.push({name:e,enabled:!0,strategy:{type:'constant',keys:t.keys,keys_secondary:{logic:'not_all',keys:[]},scan_depth:'same_as_global'},position:{type:'before_character_definition',role:'system',depth:0,order:0},content:l,probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}})}const l=new Set(i.map(e=>e.name)),s=r.filter(e=>!l.has(e.name));i.push(...s),'function'==typeof createOrReplaceWorldbook?(await createOrReplaceWorldbook(d,i,{render:'debounced'}),console.info('[Divination] Synced to worldbook successfully'),await x()):console.warn('[Divination] createOrReplaceWorldbook API unavailable')}catch(e){console.error('[Divination] Sync failed:',e)}},performDivination:function(){const e=[];let a=null;for(const o of t.value.dimensions)if(o.enabled&&o.tiers.length>0){const t=o.tiers.map(e=>e.weight),n=w(o.tiers,t);n&&(e.push({dimension:o,tier:n}),'luck'===o.id&&(a=n))}let o=[];if(t.value.enableTableWords){const e=(0,l.KX)(t.value.wordDrawMode,t.value.wordsPerItem,t.value.drawCount,t.value.tablePoolConfig);o.push(...e),console.info(`[Divination] 从表格抽词，模式: ${t.value.wordDrawMode}，结果:`,e)}if(t.value.enableWordPool){const e='perItem'===t.value.wordDrawMode?t.value.wordsPerItem:Math.max(0,t.value.drawCount-o.length),n=function(e,a,o,n,r,i){const c=[],s=n.filter(e=>{const t=r[e.id];return(t?t.enabled:e.enabled)&&e.words.length>0});if(0===s.length)return c;if('perItem'===e){for(const e of s){const t=Math.min(a,e.words.length),o=(0,l.R3)([...e.words]);c.push(...o.slice(0,t))}console.info(`[Divination] perItem 模式从世界书抽取 ${c.length} 个词:`,c)}else if('custom'===e){let e=o;for(const t of s){if(e<=0)break;const o=r[t.id],n=o?.limit??t.limit??0,i=n>0?Math.min(n,e):Math.min(a,e),s=Math.min(i,t.words.length),d=(0,l.R3)([...t.words]);c.push(...d.slice(0,s)),e-=s}console.info(`[Divination] custom 模式从世界书抽取 ${c.length} 个词:`,c)}else{const e=s.map(e=>t.value.enableBias&&i?function(e,t){const a=e.id;return'superLucky'===a||'lucky'===a?'positive'===t?3:1:'slightlyLucky'===a?'positive'===t?2:1:'neutral'===a?1:'slightlyUnlucky'===a?'negative'===t||'neutral'===t?2:1:'unlucky'===a||'superUnlucky'===a?'negative'===t?3:'neutral'===t?2:1:1}(i,e.bias):1);let a=o;for(;a>0;){const t=w(s,e);if(!t)break;const o=t.words[Math.floor(Math.random()*t.words.length)];c.push(o),a--}console.info(`[Divination] mixed 模式从世界书抽取 ${c.length} 个词:`,c)}return c}(t.value.wordDrawMode,t.value.wordsPerItem,e,g.value,t.value.categoryConfig,a);o.push(...n),console.info(`[Divination] 从世界书抽词，模式: ${t.value.wordDrawMode}，结果:`,n)}t.value.enableTableWords&&t.value.enableWordPool&&o.length>0&&(o=(0,l.R3)(o),console.info('[Divination] 混合抽词后打乱顺序:',o));const n=e.find(e=>'luck'===e.dimension.id),r=e.filter(e=>'luck'!==e.dimension.id).map(e=>({name:e.dimension.name,value:e.tier.name,prompt:e.tier.prompt}));return{luck:n?{name:n.tier.name,color:n.tier.color||'#808080',prompt:n.tier.prompt}:{name:'未知',color:'#808080',prompt:''},dimensions:r,words:o,timestamp:Date.now()}},addDimension:function(a){const o={...t.value};o.dimensions=[...o.dimensions,a],e.config.divination.config=o,e.saveConfig()},updateDimension:function(a,o){const n={...t.value};a>=0&&a<n.dimensions.length&&(n.dimensions=[...n.dimensions],n.dimensions[a]=o,e.config.divination.config=n,e.saveConfig())},removeDimension:function(a){const o={...t.value};if(a>=0&&a<o.dimensions.length){if('luck'===o.dimensions[a].id)return void console.warn('[Divination] Cannot remove luck dimension');o.dimensions=[...o.dimensions],o.dimensions.splice(a,1),e.config.divination.config=o,e.saveConfig()}},uploadCardBack:async function(a){try{const o=await(0,s.bB)(a),n=await(0,s.w4)(o,1024,.9),r={...t.value,cardBackImage:n};e.config.divination.config=r,e.saveConfig(),console.info('[Divination] Card back image uploaded')}catch(e){throw console.error('[Divination] Failed to upload card back:',e),e}},updateCategory:async function(e){try{const t=g.value.findIndex(t=>t.id===e.id);-1!==t&&(g.value[t]=e);let a=[];try{a=await getWorldbook(d)}catch{console.warn('[Divination] Worldbook not found, creating new...')}const o=a.findIndex(t=>t.uid===e.id),n=e.words.join('\n');if(-1===o)return void console.warn(`[Divination] Entry with uid ${e.id} not found in worldbook`);a[o]={...a[o],content:n,enabled:e.enabled},'function'==typeof createOrReplaceWorldbook&&(await createOrReplaceWorldbook(d,a,{render:'debounced'}),console.info('[Divination] Category updated in worldbook'))}catch(e){console.error('[Divination] Failed to update category:',e)}},presets:o,activePresetId:i,createPreset:b,saveCurrentToPreset:function(a){const n=[...o.value],r=n.findIndex(e=>e.name===a);if(r>-1){const a=n[r],o={...a,dimensions:JSON.parse(JSON.stringify(t.value.dimensions))};return n[r]=o,e.config.divination.presets=n,e.config.divination.activePresetId=a.id,e.saveConfig(),o}return b(a)},deletePreset:function(t){const a=[...o.value],n=a.findIndex(e=>e.id===t);n>-1&&(a.splice(n,1),e.config.divination.presets=a,i.value===t&&(e.config.divination.activePresetId=null),e.saveConfig())},applyPreset:function(a){const n=o.value.find(e=>e.id===a);n&&(e.config.divination.config={...t.value,dimensions:JSON.parse(JSON.stringify(n.dimensions))},e.config.divination.activePresetId=a,e.saveConfig())},restoreDefaultDimensions:function(){e.config.divination.config={...f,cardBackImage:t.value.cardBackImage,tablePoolConfig:t.value.tablePoolConfig||{},tableSyncConfig:t.value.tableSyncConfig||{},categoryConfig:t.value.categoryConfig||{},themeColor:t.value.themeColor,themeId:t.value.themeId,dimensions:[JSON.parse(JSON.stringify(u)),JSON.parse(JSON.stringify(p)),JSON.parse(JSON.stringify(m))]},e.config.divination.activePresetId=null,e.saveConfig()},migrateDimensionsToPreset:function(t,a){const n=[...o.value],r=n.findIndex(e=>e.id===a);if(-1===r)return void console.warn('[Divination] Target preset not found:',a);const i=n[r];t.map(e=>JSON.parse(JSON.stringify(e))).forEach(e=>{const t=i.dimensions.findIndex(t=>t.id===e.id);t>-1?i.dimensions[t]=e:i.dimensions.push(e)}),n[r]={...i},e.config.divination.presets=n,e.saveConfig()}}})},420(e,t,a){a.d(t,{TY:()=>l,X8:()=>c,nD:()=>s,zI:()=>p});var o=a(4015),n=a(3035),r=a(4061),i=a(2867);const l=[{border:'#E91E63',background:'rgba(233, 30, 99, 0.1)',opacity:10},{border:'#2196F3',background:'rgba(33, 150, 243, 0.1)',opacity:10},{border:'#4CAF50',background:'rgba(76, 175, 80, 0.1)',opacity:10},{border:'#FF9800',background:'rgba(255, 152, 0, 0.1)',opacity:10},{border:'#9C27B0',background:'rgba(156, 39, 176, 0.1)',opacity:10},{border:'#00BCD4',background:'rgba(0, 188, 212, 0.1)',opacity:10},{border:'#795548',background:'rgba(121, 85, 72, 0.1)',opacity:10},{border:'#607D8B',background:'rgba(96, 125, 139, 0.1)',opacity:10}],c={border:'#666666',background:'rgba(128, 128, 128, 0.1)',opacity:10},s={size:60,borderColor:'#333333',borderWidth:2,backgroundColor:'#dcd0c0',shape:'ellipse'},d={enabled:!1,position:'top-right',items:[{id:'legend-love',label:'恋爱/暧昧',color:'#E91E63',emoji:'❤️',keywords:['恋','爱','暧昧','情人','伴侣']},{id:'legend-family',label:'亲属',color:'#2196F3',emoji:'💙',keywords:['父','母','兄','弟','姐','妹','亲']},{id:'legend-friend',label:'友好/同伴',color:'#4CAF50',emoji:'💚',keywords:['友','朋','伙伴','同伴','盟']},{id:'legend-neutral',label:'中立/一般',color:'#9E9E9E',emoji:'⚪',keywords:['同事','邻居','认识']},{id:'legend-interest',label:'利益关系',color:'#FF9800',emoji:'🟡',keywords:['合作','雇佣','交易','利用']},{id:'legend-enemy',label:'敌对/仇恨',color:'#F44336',emoji:'🔴',keywords:['敌','仇','对手','竞争']},{id:'legend-complex',label:'复杂/未知',color:'#9C27B0',emoji:'🟣',keywords:[]}]},u={nodeSize:50,edgeWidth:2.5,relationLabelFontSize:10,nameLabelFontSize:12,factionLabelFontSize:14,showLegend:!0,showBackground:!0,factionColors:{},factionAvatars:{},nodeOverrides:{},legendConfig:{...d}},p=(0,n.defineStore)('graphConfig',()=>{const e=(0,i.X0)(),t=(0,r.computed)(()=>SillyTavern.getCurrentChatId()||''),a=(0,r.ref)({...u});function n(){const n=t.value;if(!n)return void(a.value={...u});const r=e.getChatConfig(n);a.value=r.graphConfig?(0,o.klona)(r.graphConfig):{...u},console.info('[GraphConfigStore] 已加载聊天配置:',n)}(0,r.watch)(t,()=>{n()},{immediate:!0});let s=!0;function p(){if(!t.value)return void console.warn('[GraphConfigStore] 无法保存：未设置聊天 ID');const n=e.getChatConfig(t.value);e.setChatConfig(t.value,{...n,graphConfig:(0,o.klona)(a.value)})}return(0,r.watch)(a,a=>{if(s)return;if(!t.value)return;const n=e.getChatConfig(t.value);e.setChatConfig(t.value,{...n,graphConfig:(0,o.klona)(a)})},{deep:!0}),setTimeout(()=>{s=!1},100),{config:a,currentChatId:t,initChatId:function(e){console.info('[GraphConfigStore] initChatId 已弃用，聊天 ID 现在自动获取')},saveConfig:p,resetToDefault:function(){a.value={...u,factionColors:{}}},refresh:function(){n()},setFactionColor:function(e,t){a.value.factionColors={...a.value.factionColors,[e]:t}},getFactionColor:function(e,t=[],o=!1){if(a.value.factionColors[e])return a.value.factionColors[e];if(o)return c;const n=(Object.keys(a.value.factionColors).length+t.indexOf(e))%l.length;return l[Math.max(0,n)]},hasFactionColor:function(e){return!!a.value.factionColors[e]},initFactionColors:function(e){const t={...a.value.factionColors};let o=Object.keys(t).length;for(const a of e)t[a]||(t[a]=l[o%l.length],o++);a.value.factionColors=t},setFactionAvatar:function(e,t){a.value.factionAvatars||(a.value.factionAvatars={}),a.value.factionAvatars={...a.value.factionAvatars,[e]:t}},getFactionAvatar:function(e){return a.value.factionAvatars?.[e]},removeFactionAvatar:function(e){if(a.value.factionAvatars?.[e]){const t={...a.value.factionAvatars};delete t[e],a.value.factionAvatars=t}},hasFactionAvatar:function(e){return!!a.value.factionAvatars?.[e]},getAllFactionAvatars:function(){return a.value.factionAvatars||{}},setFactionOverride:function(e,t){const o=e.replace('faction-container-',''),n=a.value.factionColors[o]||{...c};a.value.factionColors={...a.value.factionColors,[o]:{...n,...t}}},getFactionOverride:function(e){const t=e.replace('faction-container-','');return a.value.factionColors[t]},removeFactionOverride:function(e){const t=e.replace('faction-container-','');if(a.value.factionColors[t]){const e={...a.value.factionColors};delete e[t],a.value.factionColors=e}},setNodeStyleOverride:function(e,t){a.value.nodeOverrides||(a.value.nodeOverrides={});const o=a.value.nodeOverrides[e]||{};a.value.nodeOverrides={...a.value.nodeOverrides,[e]:{...o,...t}}},getNodeStyleOverride:function(e){return a.value.nodeOverrides?.[e]},removeNodeStyleOverride:function(e){if(a.value.nodeOverrides?.[e]){const t={...a.value.nodeOverrides};delete t[e],a.value.nodeOverrides=t}},hasNodeStyleOverride:function(e){return!!a.value.nodeOverrides?.[e]},setLegendEnabled:function(e){a.value.legendConfig||(a.value.legendConfig={...d}),a.value.legendConfig.enabled=e},setLegendPosition:function(e){a.value.legendConfig||(a.value.legendConfig={...d}),a.value.legendConfig.position=e},addLegendItem:function(e){a.value.legendConfig||(a.value.legendConfig={...d});const t={...e,id:`legend-${Date.now()}`};a.value.legendConfig.items=[...a.value.legendConfig.items,t]},updateLegendItem:function(e,t){a.value.legendConfig?.items&&(a.value.legendConfig.items=a.value.legendConfig.items.map(a=>a.id===e?{...a,...t}:a))},removeLegendItem:function(e){a.value.legendConfig?.items&&(a.value.legendConfig.items=a.value.legendConfig.items.filter(t=>t.id!==e))},getLegendConfig:function(){return a.value.legendConfig||d},resetLegendConfig:function(){a.value.legendConfig={...d}},matchLegendColor:function(e){const t=a.value.legendConfig;if(!t?.enabled||!t.items?.length)return null;for(const a of t.items)if(a.keywords.some(t=>e.includes(t)))return a.color;return null},setShowBackground:function(e){a.value.showBackground=e,p()}}})},9623(e,t,a){a.d(t,{A:()=>s});var o=a(4015),n=a(3035),r=a(4061),i=a(2867);const l={categories:[{id:'cat_general',path:'通用',icon:'fas fa-cog',createdAt:'2024-01-01T00:00:00.000Z'},{id:'cat_location',path:'地点',icon:'fas fa-map-marker-alt',createdAt:'2024-01-01T00:00:00.000Z'},{id:'cat_character',path:'人物',icon:'fas fa-user',createdAt:'2024-01-01T00:00:00.000Z'},{id:'cat_char_social',path:'人物/社交',createdAt:'2024-01-01T00:00:00.000Z'},{id:'cat_char_observe',path:'人物/观察',createdAt:'2024-01-01T00:00:00.000Z'},{id:'cat_char_conflict',path:'人物/冲突',createdAt:'2024-01-01T00:00:00.000Z'},{id:'cat_item',path:'物品',icon:'fas fa-box-open',createdAt:'2024-01-01T00:00:00.000Z'},{id:'cat_quest',path:'任务',icon:'fas fa-scroll',createdAt:'2024-01-01T00:00:00.000Z'},{id:'cat_action',path:'动作',icon:'fas fa-running',createdAt:'2024-01-01T00:00:00.000Z'}],tags:[{id:'tag_gen_prevent',label:'防转述',categoryId:'cat_general',promptTemplate:'禁止在正文中复述用户输入。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_gen_speak',label:'抢话',categoryId:'cat_general',promptTemplate:'{{user}}在正文中必须有2句以上新对白。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_gen_detail',label:'细写',categoryId:'cat_general',promptTemplate:'放慢节奏，禁止更换当前叙事中心与切场景。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_gen_pov',label:'切视角',categoryId:'cat_general',promptTemplate:'以{{rowTitle}}的视角来描写接下来的场景。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_loc_go',label:'前往',categoryId:'cat_location',promptTemplate:'动身前往{{rowTitle}}。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_loc_wander',label:'闲逛',categoryId:'cat_location',promptTemplate:'在{{rowTitle}}四处闲逛。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_loc_search',label:'搜查',categoryId:'cat_location',promptTemplate:'仔细搜查{{rowTitle}}。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_loc_sneak',label:'潜入',categoryId:'cat_location',promptTemplate:'悄悄潜入{{rowTitle}}。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_talk',label:'搭话',categoryId:'cat_char_social',promptTemplate:'主动向{{rowTitle}}搭话。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_ask',label:'询问',categoryId:'cat_char_social',promptTemplate:'向{{rowTitle}}询问...',allowPreEdit:!0,createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_req',label:'请求',categoryId:'cat_char_social',promptTemplate:'向{{rowTitle}}请求...',allowPreEdit:!0,createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_invite',label:'邀请',categoryId:'cat_char_social',promptTemplate:'邀请{{rowTitle}}同行。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_thx',label:'感谢',categoryId:'cat_char_social',promptTemplate:'向{{rowTitle}}表示感谢。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_sry',label:'道歉',categoryId:'cat_char_social',promptTemplate:'向{{rowTitle}}道歉。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_gaze',label:'注视',categoryId:'cat_char_observe',promptTemplate:'默默注视着{{rowTitle}}。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_track',label:'跟踪',categoryId:'cat_char_observe',promptTemplate:'悄悄跟踪{{rowTitle}}。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_listen',label:'偷听',categoryId:'cat_char_observe',promptTemplate:'偷听{{rowTitle}}的谈话。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_ques',label:'质问',categoryId:'cat_char_conflict',promptTemplate:'质问{{rowTitle}}关于',allowPreEdit:!0,createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_threat',label:'威胁',categoryId:'cat_char_conflict',promptTemplate:'威胁{{rowTitle}}。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_atk',label:'攻击',categoryId:'cat_char_conflict',promptTemplate:'对{{rowTitle}}发起攻击。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_char_flee',label:'逃离追击',categoryId:'cat_char_conflict',promptTemplate:'试图逃离{{rowTitle}}的追击。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_item_use',label:'使用',categoryId:'cat_item',promptTemplate:'使用{{rowTitle}}。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_item_check',label:'检查',categoryId:'cat_item',promptTemplate:'仔细检查{{rowTitle}}，试图发现更多信息。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_item_gift',label:'赠送',categoryId:'cat_item',promptTemplate:'把{{rowTitle}}送给',allowPreEdit:!0,createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_item_show',label:'展示',categoryId:'cat_item',promptTemplate:'向 展示{{rowTitle}}。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_quest_advance',label:'推进',categoryId:'cat_quest',promptTemplate:'自然推进剧情，加入可以推进{{rowTitle}}进度的要素/桥段。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_quest_clue',label:'追踪线索',categoryId:'cat_quest',promptTemplate:'追踪关于{{rowTitle}}的新线索。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_quest_help',label:'求助',categoryId:'cat_quest',promptTemplate:'为解决{{rowTitle}}寻求 帮助。',allowPreEdit:!0,createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_act_hide',label:'躲藏',categoryId:'cat_action',promptTemplate:'<user>找地方躲起来。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_act_rest',label:'休息',categoryId:'cat_action',promptTemplate:'<user>决定找个地方休息一下。',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_act_silent',label:'沉默',categoryId:'cat_action',promptTemplate:'<user>陷入沉默',createdAt:'2024-01-01T00:00:00.000Z'},{id:'tag_act_daze',label:'走神',categoryId:'cat_action',promptTemplate:'<user>走神发呆了一会儿。',createdAt:'2024-01-01T00:00:00.000Z'}]};function c(e){return`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const s=(0,n.defineStore)('acu-tag-library',()=>{const e=(0,i.X0)();const t=(0,r.ref)(function(){const t=e.config.tagLibrary;return t&&(t.categories?.length||t.tags?.length)?(0,o.klona)(t):(0,o.klona)(l)}()),a=(0,r.ref)(''),n=(0,r.ref)(''),s=(0,r.computed)(()=>e.isLoaded.value);let d=!0;(0,r.watch)(t,t=>{d||(e.config.tagLibrary=(0,o.klona)(t),e.saveConfig())},{deep:!0}),setTimeout(()=>{d=!1},100);const u=(0,r.ref)('normal'),p=(0,r.ref)(new Set),m=(0,r.ref)(new Set),f=(0,r.ref)(null);async function g(){e.saveConfig(),console.info('[ACU TagLibrary] 已保存标签库')}function v(e,a){const o=e.split('/');for(let e=1;e<o.length;e++){const a=o.slice(0,e).join('/');if(!t.value.categories.find(e=>e.path===a)){const e={id:c('cat'),path:a,createdAt:(new Date).toISOString()};t.value.categories.push(e),console.info('[ACU TagLibrary] 自动创建父级分类:',a)}}const n=t.value.categories.find(t=>t.path===e);if(n)return void 0!==a&&a!==n.icon&&(n.icon=a,console.info('[ACU TagLibrary] 更新分类图标:',e)),n;const r={id:c('cat'),path:e,icon:a,createdAt:(new Date).toISOString()};return t.value.categories.push(r),console.info('[ACU TagLibrary] 创建分类:',e),g(),r}function b(e,a){const o=t.value.categories.find(t=>t.id===e);o&&(void 0!==a.path&&(o.path=a.path),void 0!==a.icon&&(o.icon=a.icon),g())}function h(e){return t.value.categories.find(t=>t.id===e)}const x=(0,r.computed)(()=>{let e=[...t.value.tags];if(n.value.trim()){const t=n.value.toLowerCase();e=e.filter(e=>e.label.toLowerCase().includes(t)||e.promptTemplate.toLowerCase().includes(t))}if('uncategorized'===a.value)e=e.filter(e=>!e.categoryId||!t.value.categories.find(t=>t.id===e.categoryId));else if(a.value){const o=h(a.value);if(o){const a=new Set([o.id]),n=o.path+'/';t.value.categories.forEach(e=>{e.path.startsWith(n)&&a.add(e.id)}),e=e.filter(e=>a.has(e.categoryId))}else e=[]}return e.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()),e});function w(e,a='',o=''){const n={id:c('tag'),label:e,categoryId:a,promptTemplate:o,createdAt:(new Date).toISOString()};return t.value.tags.push(n),g(),n}function y(e,a){const o=new Set(e);t.value.tags.forEach(e=>{o.has(e.id)&&(e.categoryId=a)}),g()}function k(){p.value=new Set,m.value=new Set,f.value=null}const C=(0,r.computed)(()=>t.value.tags.length),N=(0,r.computed)(()=>t.value.categories.length),V=(0,r.computed)(()=>t.value.tags.filter(e=>!e.categoryId||!t.value.categories.find(t=>t.id===e.categoryId)).length);return{library:t,activeCategoryId:a,searchKeyword:n,isLoaded:s,currentMode:u,selectedTagIds:p,selectedCategoryIds:m,selectionType:f,loadLibrary:async function(){const t=e.config.tagLibrary;t&&(t.categories?.length||t.tags?.length)?console.info('[ACU TagLibrary] 已加载标签库:',{categories:t.categories?.length||0,tags:t.tags?.length||0}):(e.config.tagLibrary=(0,o.klona)(l),e.saveConfig(),console.info('[ACU TagLibrary] 首次使用，加载默认标签库'))},saveLibrary:g,addCategory:v,deleteCategory:function(e){const a=t.value.categories.find(t=>t.id===e);if(!a)return void console.warn('[ACU TagLibrary] 分类不存在:',e);const o=new Set;t.value.categories.forEach(e=>{(e.path===a.path||e.path.startsWith(a.path+'/'))&&o.add(e.id)}),t.value.tags=t.value.tags.filter(e=>!o.has(e.categoryId)),t.value.categories=t.value.categories.filter(e=>!o.has(e.id)),console.info('[ACU TagLibrary] 已删除分类及其内容:',a.path,'(子分类数:',o.size-1,')'),g()},updateCategory:b,getCategoryById:h,getCategoryByPath:function(e){return t.value.categories.find(t=>t.path===e)},getChildCategories:function(e){return t.value.categories.filter(t=>{if(''===e)return!t.path.includes('/');if(!t.path.startsWith(e+'/'))return!1;return!t.path.slice(e.length+1).includes('/')})},getCategoryTagCount:function(e){const a=h(e);if(!a)return 0;const o=new Set;return t.value.categories.forEach(e=>{(e.path===a.path||e.path.startsWith(a.path+'/'))&&o.add(e.id)}),t.value.tags.filter(e=>o.has(e.categoryId)).length},filteredTags:x,upsertTag:function(e){const a=t.value.tags.findIndex(t=>t.id===e.id);a>=0?t.value.tags[a]={...e}:t.value.tags.push({...e,createdAt:e.createdAt||(new Date).toISOString()}),g()},createTag:w,deleteTag:function(e){t.value.tags=t.value.tags.filter(t=>t.id!==e),g()},deleteTags:function(e){const a=new Set(e);t.value.tags=t.value.tags.filter(e=>!a.has(e.id)),g()},getTagById:function(e){return t.value.tags.find(t=>t.id===e)},getTagsByCategory:function(e){return t.value.tags.filter(t=>t.categoryId===e)},moveTagToCategory:function(e,a){const o=t.value.tags.find(t=>t.id===e);o&&(o.categoryId=a,g())},moveTagsToCategory:y,setMode:function(e){'migrate'!==e&&'export'!==e&&k(),u.value=e},toggleTagSelection:function(e){'category'===f.value&&m.value.clear(),f.value='tag',p.value.has(e)?p.value.delete(e):p.value.add(e),p.value=new Set(p.value)},toggleCategorySelection:function(e){'tag'===f.value&&p.value.clear(),f.value='category',m.value.has(e)?m.value.delete(e):m.value.add(e),m.value=new Set(m.value)},clearSelection:k,migrateSelectedTags:function(e){'tag'===f.value&&p.value.size>0&&(y(Array.from(p.value),e),k())},migrateSelectedCategories:function(e){'category'===f.value&&m.value.size>0&&(m.value.forEach(t=>{const a=h(t);if(a){const o=a.path.split('/'),n=o[o.length-1];b(t,{path:e?`${e}/${n}`:n})}}),k())},migrateSelectedItems:function(e){const a=e?h(e):null,o=a?.path||'';'tag'===f.value&&p.value.size>0?(y(Array.from(p.value),e),k()):'category'===f.value&&m.value.size>0&&(m.value.forEach(a=>{const n=h(a);if(n&&a!==e){const e=n.path,r=e.split('/'),i=r[r.length-1],l=o?`${o}/${i}`:i;b(a,{path:l}),t.value.categories.forEach(t=>{if(t.path.startsWith(e+'/')){const a=l+t.path.slice(e.length);b(t.id,{path:a})}})}}),k())},exportLibrary:function(e,a){let o=[],n=[];if('all'===e)o=[...t.value.categories],n=[...t.value.tags];else if('category'===e&&a){const e=h(a);if(e){o=t.value.categories.filter(t=>t.path===e.path||t.path.startsWith(e.path+'/'));const a=new Set(o.map(e=>e.id));n=t.value.tags.filter(e=>a.has(e.categoryId))}}else if('selected'===e){n=t.value.tags.filter(e=>p.value.has(e.id));const e=new Set(n.map(e=>e.categoryId).filter(Boolean));o=t.value.categories.filter(t=>e.has(t.id))}return{version:'1.0',exportedAt:(new Date).toISOString(),categories:o.map(e=>({id:e.id,path:e.path,icon:e.icon})),tags:n.map(e=>{const t=h(e.categoryId);return{id:e.id,label:e.label,category:t?.path||'',prompt:e.promptTemplate,allowPreEdit:e.allowPreEdit}})}},importLibrary:function(e,a){try{let o=0,n=0,r=0,i=0;const l=new Map;return t.value.categories.forEach(e=>{l.set(e.path,e.id)}),e.categories.forEach(e=>{if(!l.has(e.path)){const t=v(e.path,e.icon);l.set(e.path,t.id),o++}}),e.tags.forEach(e=>{const o=l.get(e.category)||'',c=t.value.tags.find(t=>t.label===e.label&&t.categoryId===o);if(c)if('overwrite'===a.conflictStrategy)c.promptTemplate=e.prompt,c.allowPreEdit=e.allowPreEdit,r++;else{let a=e.label,n=1;for(;t.value.tags.some(e=>e.label===a&&e.categoryId===o);)a=`${e.label}_${n}`,n++;w(a,o,e.prompt);const r=t.value.tags[t.value.tags.length-1];r&&e.allowPreEdit&&(r.allowPreEdit=e.allowPreEdit),i++}else{w(e.label,o,e.prompt);const a=t.value.tags[t.value.tags.length-1];a&&e.allowPreEdit&&(a.allowPreEdit=e.allowPreEdit),n++}}),{success:!0,addedCategories:o,addedTags:n,updatedTags:r,renamedTags:i}}catch(e){return console.error('[ACU TagLibrary] 导入失败:',e),{success:!1,addedCategories:0,addedTags:0,updatedTags:0,renamedTags:0,error:e instanceof Error?e.message:'未知错误'}}},clearAll:function(){t.value.tags=[],t.value.categories=[],console.info('[ACU TagLibrary] 已清空所有标签和分类'),g()},selectCategory:function(e){a.value=e},resetSelection:function(){a.value='',n.value=''},totalTags:C,totalCategories:N,uncategorizedCount:V}})},4293(e,t,a){a.d(t,{C:()=>f});var o=a(4015),n=a(3035),r=a(4061),i=a(2867),l=a(5526),c=a(9800),s=a(9388);const d={manualColor:'orange',manualHex:'#d35400',aiColor:'blue',aiHex:'#3498db',titleColor:'orange',titleHex:'#d35400'};function u(e,t=.1){const a=e.startsWith('#')?e:`#${e}`;return`rgba(${parseInt(a.slice(1,3),16)}, ${parseInt(a.slice(3,5),16)}, ${parseInt(a.slice(5,7),16)}, ${t})`}function p(e,t){const a=e.startsWith('#')?e:`#${e}`;return`rgba(${parseInt(a.slice(1,3),16)}, ${parseInt(a.slice(3,5),16)}, ${parseInt(a.slice(5,7),16)}, ${t})`}function m(e,t){if('custom'===e&&t)return t;const a=s.um[e];return a?.main||'#d35400'}const f=(0,n.defineStore)('acu-theme',()=>{const e=(0,i.X0)(),t=(0,r.ref)((0,o.klona)(e.config.theme?.presets||[])),n=(0,r.ref)(e.config.theme?.activePresetId||null),f=(0,r.ref)((0,o.klona)(e.config.theme?.themeVars||{})),g=(0,r.ref)((0,o.klona)(e.config.theme?.themeVarOpacities||{})),v=(0,r.ref)((0,o.klona)(e.config.theme?.highlight||{...d})),b=(0,r.ref)((0,o.klona)(e.config.theme?.backgroundConfig||{...c.o6})),h=(0,r.ref)(e.config.theme?.customCSS||''),x=(0,r.computed)(()=>e.isLoaded.value);let w=!0;function y(){w||(e.config.theme={presets:(0,o.klona)(t.value),activePresetId:n.value,themeVars:(0,o.klona)(f.value),themeVarOpacities:(0,o.klona)(g.value),highlight:(0,o.klona)(v.value),backgroundConfig:(0,o.klona)(b.value),customCSS:h.value},e.saveConfig())}(0,r.watch)(t,y,{deep:!0}),(0,r.watch)(n,y),(0,r.watch)(f,y,{deep:!0}),(0,r.watch)(g,y,{deep:!0}),(0,r.watch)(v,y,{deep:!0}),(0,r.watch)(b,y,{deep:!0}),(0,r.watch)(h,y),setTimeout(()=>{w=!1},100);const k=(0,s.JH)(),C=(0,r.computed)(()=>k.config.theme),N=(0,r.computed)(()=>m(v.value.manualColor,v.value.manualHex)),V=(0,r.computed)(()=>m(v.value.aiColor,v.value.aiHex)),E=(0,r.computed)(()=>m(v.value.titleColor,v.value.titleHex)),B=(0,r.computed)(()=>u(E.value,.08)),T=(0,r.computed)(()=>n.value&&t.value.find(e=>e.id===n.value)||null);function S(){const e=k.config;v.value={manualColor:e.highlightManualColor||e.highlightColor||'orange',manualHex:e.customHighlightManualHex,aiColor:e.highlightAiColor||'blue',aiHex:e.customHighlightAiHex,titleColor:e.titleColor||'orange',titleHex:e.customTitleHex}}function D(){const e=v.value;k.updateConfig({highlightManualColor:e.manualColor,highlightColor:e.manualColor,customHighlightManualHex:e.manualHex,highlightAiColor:e.aiColor,customHighlightAiHex:e.aiHex,titleColor:e.titleColor,customTitleHex:e.titleHex,highlightNew:!0,customTitleColor:!0})}function A(e){const a=(0,s.MP)(),o={id:`preset_${Date.now()}`,name:e,createdAt:(new Date).toISOString(),baseTheme:C.value,themeVars:{...f.value},themeVarOpacities:{...g.value},highlight:{...v.value},backgroundConfig:{...b.value},customCSS:h.value,ballAppearance:{...a.appearance}};return t.value=[...t.value,o],o}async function I(e){try{let t=null;if(b.value.imageUrl&&b.value.imageUrl.startsWith('blob:')?t=b.value.imageUrl:(t=await(0,l.$H)(l.Aq),!t&&n.value&&n.value!==e&&(t=await(0,l.$H)(n.value))),t){const o=await fetch(t),n=await o.blob(),{saveBackground:r}=await Promise.resolve().then(a.bind(a,5526));await r(e,n,n.type),console.info('[ACU Theme] 已将背景图片绑定到预设:',e)}}catch(e){console.warn('[ACU Theme] 绑定背景图片到预设失败:',e)}}const M=(0,r.ref)(!1);function U(e,a){const o=[...t.value],n=o.findIndex(t=>t.id===e);n>-1&&(o[n]={...o[n],...a},t.value=o)}function P(){const e=[];for(const[t,a]of Object.entries(f.value))if(a){const o=c.DR[t];if(o){const n=g.value[t]??100;if(n<100&&a.startsWith('#')){const t=p(a,n/100);e.push(`${o}: ${t};`)}else e.push(`${o}: ${a};`)}}if(e.push(`--acu-highlight: ${N.value};`),e.push(`--acu-highlight-manual: ${N.value};`),e.push(`--acu-highlight-manual-bg: ${u(N.value)};`),e.push(`--acu-highlight-ai: ${V.value};`),e.push(`--acu-highlight-ai-bg: ${u(V.value)};`),e.push(`--acu-title-color: ${E.value};`),e.push(`--acu-title-color-bg: ${B.value};`),e.push(`--acu-accent: ${E.value};`),b.value.enabled&&b.value.imageUrl){const t=b.value,a=(t.offsetX,t.offsetY,(t.scale||100)/100),o='auto'===t.size?'100%':t.size;e.push(`--acu-bg-image: url("${t.imageUrl}");`),e.push('--acu-bg-position: center center;'),e.push(`--acu-bg-size: ${o};`),e.push(`--acu-bg-scale: ${a};`),e.push(`--acu-bg-offset-x: ${t.offsetX||0}%;`),e.push(`--acu-bg-offset-y: ${t.offsetY||0}%;`),e.push('--acu-bg-repeat: no-repeat;'),e.push(`--acu-bg-opacity: ${t.opacity/100};`),e.push(`--acu-bg-blur: ${t.blur}px;`)}else e.push('--acu-bg-image: none;');if(0===e.length)return'';let t=`.acu-app, .acu-wrapper, .acu-modal-container { ${e.join(' ')} }`;return b.value.enabled&&b.value.imageUrl&&(t+='\n        .acu-data-display::before {\n          content: "";\n          position: absolute;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background-image: var(--acu-bg-image);\n          background-position: var(--acu-bg-position);\n          background-size: var(--acu-bg-size);\n          background-repeat: var(--acu-bg-repeat);\n          transform: translate(var(--acu-bg-offset-x), var(--acu-bg-offset-y)) scale(var(--acu-bg-scale));\n          transform-origin: center center;\n          opacity: var(--acu-bg-opacity);\n          filter: blur(var(--acu-bg-blur));\n          pointer-events: none;\n          z-index: -1;\n          border-radius: 12px; /* 保持圆角一致 */\n        }\n        .acu-data-display {\n          position: relative;\n          z-index: 0;\n          background: transparent !important; /* 让背景透出来 */\n        }\n      '),t}return{presets:t,activePresetId:n,currentThemeVars:f,currentThemeVarOpacities:g,currentHighlight:v,backgroundConfig:b,customCSS:h,isLoaded:x,baseTheme:C,manualHighlightColor:N,aiHighlightColor:V,titleColor:E,titleBgColor:B,activePreset:T,loadFromStorage:async function a(o=!1){try{if(!e.isLoaded.value)return console.warn('[ACU Theme] ConfigManager 尚未加载，延迟加载背景图片'),void setTimeout(()=>a(o),500);const r=n.value,i=b.value;if(r){const e=t.value.find(e=>e.id===r);if(e&&i.enabled&&i.hasIndexedDBImage)try{let t=await(0,l.$H)(e.id);t||(t=await(0,l.$H)(l.Aq)),t&&(b.value.imageUrl=t,console.info('[ACU Theme] 已从 IndexedDB 恢复背景图片'))}catch(e){console.warn('[ACU Theme] 恢复背景图片失败:',e)}D()}else if(i.enabled&&i.hasIndexedDBImage){try{const e=await(0,l.$H)(l.Aq);e&&(b.value.imageUrl=e,console.info('[ACU Theme] 已从 IndexedDB 恢复背景图片'))}catch(e){console.warn('[ACU Theme] 恢复背景图片失败:',e)}S()}console.info('[ACU Theme] 主题配置已就绪')}catch(e){console.error('[ACU Theme] 加载配置失败:',e)}},saveToStorage:function(){try{y(),D(),console.info('[ACU Theme] 已保存主题配置')}catch(e){console.error('[ACU Theme] 保存配置失败:',e)}},syncFromConfigStore:S,syncToConfigStore:D,createPreset:A,saveCurrentToPreset:function(e){const a=(0,s.MP)(),o=[...t.value],r=o.findIndex(t=>t.name===e);if(r>-1){const e=o[r],i={...e,baseTheme:C.value,themeVars:{...f.value},themeVarOpacities:{...g.value},highlight:{...v.value},backgroundConfig:{...b.value},customCSS:h.value,ballAppearance:{...a.appearance}};return o[r]=i,t.value=o,n.value=e.id,b.value.enabled&&b.value.hasIndexedDBImage&&I(e.id),i}{const t=A(e);return n.value=t.id,b.value.enabled&&b.value.hasIndexedDBImage&&I(t.id),t}},deletePreset:function(e){const a=[...t.value],o=a.findIndex(t=>t.id===e);o>-1&&(a.splice(o,1),t.value=a,n.value===e&&(n.value=null))},applyPreset:async function(e){const a=t.value.find(t=>t.id===e);if(a){M.value=!0;try{n.value=e,k.setTheme(a.baseTheme),f.value={...a.themeVars||{}},g.value={...a.themeVarOpacities||{}},v.value={...a.highlight};const t=a.backgroundConfig||{...c.o6};if(t.imageUrl='',b.value={...t},t.enabled)if(t.hasIndexedDBImage){const e=a.id;try{let t=await(0,l.$H)(e);t||(t=await(0,l.$H)(l.Aq),t&&console.info('[ACU Theme] 预设应用：使用全局背景 (兼容)')),t?(b.value.imageUrl=t,console.info('[ACU Theme] 预设应用：已恢复背景图片')):(console.warn('[ACU Theme] 预设应用：IndexedDB 中未找到背景图片'),b.value.hasIndexedDBImage=!1)}catch(e){console.warn('[ACU Theme] 预设应用：恢复背景图片失败',e)}}else t.externalUrl&&(b.value.imageUrl=t.externalUrl,console.info('[ACU Theme] 预设应用：使用外部背景 URL'));h.value=a.customCSS||'';const o=(0,s.MP)();a.ballAppearance?o.setAppearance(a.ballAppearance):o.setAppearance(s.$P),D()}finally{M.value=!1}}},updatePreset:U,renamePreset:function(e,t){U(e,{name:t})},setManualHighlightColor:function(e,t){v.value={...v.value,manualColor:e,manualHex:t}},setAiHighlightColor:function(e,t){v.value={...v.value,aiColor:e,aiHex:t}},setTitleColor:function(e,t){v.value={...v.value,titleColor:e,titleHex:t}},setThemeVar:function(e,t){f.value={...f.value,[e]:t}},removeThemeVar:function(e){const t={...f.value};delete t[e],f.value=t},clearThemeVars:function(){f.value={}},setThemeVarOpacity:function(e,t){g.value={...g.value,[e]:Math.max(0,Math.min(100,t))}},removeThemeVarOpacity:function(e){const t={...g.value};delete t[e],g.value=t},clearThemeVarOpacities:function(){g.value={}},setBackgroundConfig:function(e){b.value={...b.value,...e}},getBackgroundConfig:function(){return b.value},setCustomCSS:function(e){h.value=e},clearCustomCSS:function(){h.value=''},getInjectedStyles:P,getFullInjectedCSS:function(){return[P(),h.value].filter(Boolean).join('\n\n')}}})},6964(e,t,a){a.d(t,{$9:()=>h,H6:()=>b,SC:()=>x,Sj:()=>w,j_:()=>y});var o=a(7696),n=a(4015),r=a(4061),i=a(4797),l=a(2867),c=a(4866),s=a(9185),d=a(3035);const u='acu_ui_collapse_state',p='acu_pin_state',m='acu_active_tab',f='acu_table_order',g='acu_float_ball_pos',v='acu_layout',b='acu_tab_dashboard_home',h='acu_tab_options_panel',x='acu_tab_relationship_graph';function w(e){return/势力|组织|阵营/.test(e)?'fas fa-fist-raised':/技能/.test(e)?'fas fa-magic':/人物|角色|npc/i.test(e)?'fas fa-users':/交互|行动/.test(e)?'fas fa-hand-pointer':/随机/.test(e)?'fas fa-dice':/全局/.test(e)?'fas fa-globe':/地点|地图/.test(e)?'fas fa-map-marked-alt':/大纲/.test(e)?'fas fa-book':'fas fa-table'}const y=(0,d.defineStore)('acu-ui',()=>{const e=(0,o.rXt)(u,!1),t=(0,o.rXt)(p,!1),a=(0,o.rXt)(m,null),d=(0,o.rXt)(f,[]),x=(0,l.X0)(),w=(0,r.computed)(()=>SillyTavern.getCurrentChatId()||'default'),y=(0,r.ref)({...i.ie}),k=(0,r.ref)([]),C=(0,r.ref)([]);(0,r.watch)(w,()=>{!function(){const e=w.value,t=x.config.chats[e];y.value=t?(0,n.klona)(t):{...i.ie},k.value=[...y.value.visibleTabs],C.value=[...y.value.tabOrder],console.info('[UIStore] 已加载聊天配置:',e,'visibleTabs:',k.value)}()},{immediate:!0});let N=!0;(0,r.watch)(y,e=>{if(N)return;const t=w.value;x.setChatConfig(t,(0,n.klona)(e))},{deep:!0}),(0,r.watch)(k,e=>{if(N)return;y.value.visibleTabs=[...e];const t=w.value;x.setChatConfig(t,(0,n.klona)(y.value)),console.info('[UIStore] visibleTabs 已保存:',e)},{deep:!0}),(0,r.watch)(C,e=>{if(N)return;y.value.tabOrder=[...e];const t=w.value;x.setChatConfig(t,(0,n.klona)(y.value)),console.info('[UIStore] tabOrder 已保存:',e)},{deep:!0}),setTimeout(()=>{N=!1},100);const V=(0,r.computed)({get:()=>y.value.tableHeights,set:e=>{y.value.tableHeights=e}}),E=(0,r.computed)({get:()=>y.value.tableStyles,set:e=>{y.value.tableStyles=e}}),B=(0,r.computed)({get:()=>y.value.reverseTables,set:e=>{y.value.reverseTables=e}}),T=(0,o.rXt)(g,{x:20,y:'undefined'!=typeof window?window.innerHeight-150:500}),S=(0,o.rXt)(v,'horizontal'),D=(0,r.computed)({get:()=>k.value,set:e=>{k.value=[...e]}}),A=(0,r.computed)({get:()=>C.value,set:e=>{C.value=[...e]}}),I=(0,r.ref)(1),M=(0,r.ref)(''),U=(0,r.ref)(0),P=(0,r.ref)(!1),L=(0,r.ref)(!1),F=(0,r.ref)(!1),j=(0,r.ref)(!1),O=(0,r.ref)(!1),R=(0,r.ref)(!1),H=(0,r.ref)(null),W=(0,r.reactive)({visible:!1,props:{tableName:'',tableId:'',rowIndex:0,currentRowData:null}}),Y=(0,r.reactive)({visible:!1,props:{widgetId:'',widgetConfig:null,tableHeaders:[]}}),X=(0,r.reactive)({visible:!1,props:{tableName:'',tableId:'',rowIndex:0,currentRowData:null,titleColIndex:0}}),G=(0,r.reactive)({visible:!1,props:{imageUrl:'',name:'',initialOffsetX:50,initialOffsetY:50,initialScale:150,initialInvert:!1,showInvertOption:!1}}),q=(0,r.shallowRef)(null),K=(0,r.shallowRef)(null),J=(0,r.reactive)({visible:!1,props:{widgetId:'',currentActions:[]}}),Z=(0,r.reactive)({visible:!1,props:{nodes:[],factions:[]}}),Q=(0,r.shallowRef)(null),ee=(0,r.shallowRef)(null),te=(0,r.reactive)({visible:!1,props:{nodeId:'',fullName:'',currentLabel:'',selectedIndices:[]}}),ae=(0,r.shallowRef)(null),oe=(0,r.shallowRef)(null),ne=(0,r.shallowRef)(null),re=(0,r.reactive)({visible:!1,props:{fullName:'',initialIndices:[]}}),ie=(0,r.shallowRef)(null),le=(0,r.shallowRef)(null);function ce(){re.visible=!1,ie.value=null,le.value=null}const se=(0,r.reactive)({visible:!1,props:{factions:[]}}),de=(0,r.reactive)({visible:!1,props:{factionId:'',factionName:''}}),ue=(0,r.ref)(!1),pe=(0,r.ref)(!1),me=(0,r.reactive)({visible:!1,props:{currentFloor:0}}),fe=(0,r.reactive)({visible:!1,props:{maxFloor:0}}),ge=(0,r.reactive)({visible:!1,props:{initialStartFloor:void 0,initialEndFloor:void 0},state:{selectedTableKeys:[]}}),ve=(0,r.shallowRef)(null),be=(0,r.ref)(!1),he=(0,r.reactive)({visible:!1,props:{tableName:'',tableId:'',rowIndex:0,currentRowData:null,titleColIndex:1}}),xe=(0,r.ref)(!1),we=(0,r.reactive)({visible:!1}),ye=(0,r.shallowRef)(null),ke=(0,r.reactive)({visible:!1,props:{presetType:'manual-update',summaryItems:[],initialName:''}}),Ce=(0,r.shallowRef)(null),Ne=(0,r.reactive)({visible:!1,props:{categoryId:'',rowContext:{title:'',value:''},widgetId:''}}),Ve=(0,r.reactive)({visible:!1,props:{tagLabel:'',resolvedPrompt:'',showCompanions:!1,widgetId:''}}),Ee=(0,r.reactive)({visible:!1,props:{widgetId:'',displayedTagIds:[],displayedCategoryIds:[]}}),Be=(0,r.shallowRef)(null),Te=(0,r.reactive)({visible:!1,props:{currentIcon:''}}),Se=(0,r.shallowRef)(null);function De(){Te.visible=!1,Se.value=null}const Ae=(0,r.ref)(!1),ze=(0,r.reactive)({visible:!1,content:'',x:0,y:0}),Ie=(0,r.reactive)({visible:!1,result:null,isQuickRerollMode:!1}),_e=(0,r.reactive)({visible:!1,props:{prompt:''}}),Me=(0,r.computed)(()=>!e.value&&null!==a.value),Ue=(0,r.computed)(()=>a.value===b),Pe=(0,r.computed)(()=>a.value===h);const $e=(0,r.computed)(()=>M.value);const Le=(0,r.computed)(()=>'horizontal'===S.value);function Fe(e){if(!A.value||0===A.value.length)return e;return[...A.value.filter(t=>e.includes(t)),...e.filter(e=>!A.value.includes(e))]}function je(){G.visible=!1,q.value=null,K.value=null}function Oe(){te.visible=!1,ae.value=null,oe.value=null,ne.value=null}function Re(e='main'){'main'!==e&&(H.value=e),ue.value=!0}function He(){ge.visible=!1,ve.value=null}function We(){ke.visible=!1,Ce.value=null}function Ye(){we.visible=!1,ye.value=null}function Xe(){Ee.visible=!1,Be.value=null}const Ge=(0,r.ref)(0),qe=(0,r.ref)(!1);return{isCollapsed:e,isPinned:t,activeTab:a,tableOrder:d,tableHeights:V,tableStyles:E,reverseTables:B,ballPosition:T,layout:S,visibleTabs:D,currentPage:I,searchTerm:M,currentSearchTerm:$e,scrollTop:U,isEditingOrder:P,isInitialized:L,isContentHidden:F,isMobile:j,isLockEditMode:O,showLockedOnly:R,initialSettingsPanel:H,isPanelVisible:Me,isDashboardActive:Ue,isOptionsActive:Pe,reverseOrderTables:B,isHorizontalLayout:Le,toggleCollapse:function(){e.value=!e.value},togglePin:function(){t.value=!t.value},setActiveTab:function(e){a.value=e,I.value=1,M.value=''},setTableOrder:function(e){d.value=e},setTableHeight:function(e,t){V.value={...V.value,[e]:t}},resetTableHeight:function(e){const t={...V.value};delete t[e],V.value=t},getTableHeight:function(e){return V.value[e]},setTableStyle:function(e,t){E.value={...E.value,[e]:t}},getTableStyle:function(e){return E.value[e]||'list'},toggleTableReverse:function(e){const t=[...B.value],a=t.indexOf(e);a>-1?t.splice(a,1):t.push(e),B.value=t},isTableReversed:function(e){return B.value.includes(e)},setCurrentPage:function(e){I.value=Math.max(1,e)},setSearchTerm:function(e){M.value=e.toLowerCase(),I.value=1},saveScrollTop:function(e){U.value=e},enterEditingOrder:function(){P.value=!0},exitEditingOrder:function(){P.value=!1},setEditingOrder:function(e){P.value=e},setMobile:function(e){j.value=e},setLayout:function(e){S.value=e},toggleLayout:function(){S.value='horizontal'===S.value?'vertical':'horizontal'},closePanel:function(){e.value=!0,F.value=!1},openPanel:function(){F.value=!1,e.value=!1,null===a.value&&(a.value=b)},setInitialized:function(e){L.value=e},updateSaveBtnState:function(){const{$}=window.jQuery?{$:window.jQuery}:{$:window.parent.$};if(!$)return;const e=(0,c.D)().hasUnsavedChanges,t=$(window.parent.document).find('#acu-btn-save-global');t.length&&(e?(t.addClass('acu-has-changes'),t.find('i').addClass('fa-beat-fade'),t.css('color','#e67e22')):(t.removeClass('acu-has-changes'),t.find('i').removeClass('fa-beat-fade'),t.css('color','')))},autoFitPanelHeight:function(e=!1){const{$}=window.jQuery?{$:window.jQuery}:{$:window.parent.$};if(!$)return;const t=$(window.parent.document).find('#acu-data-area');if(!t.length)return;const o=a.value;!e&&o&&V.value[o]||setTimeout(()=>{const e=t[0].scrollHeight,a=($(window.parent).height()||800)-200;let o=Math.min(e+20,a);o<200&&(o=200),t.css('height',o+'px')},100)},saveBallPosition:function(e){T.value=e},getBallPosition:function(){return T.value},resetBallPosition:function(){const e='undefined'!=typeof window?window.parent?.innerHeight??window.innerHeight:500;T.value={x:20,y:Math.max(100,e-150)}},setVisibleTabs:function(e){D.value=e},isTabVisible:function(e){return 0===D.value.length||D.value.includes(e)},toggleTabVisibility:function(e){const t=[...D.value],a=t.indexOf(e);a>-1?t.splice(a,1):t.push(e),D.value=t},resetVisibleTabs:function(){D.value=[]},tabOrder:A,setTabOrder:function(e){A.value=e},getSortedTabIds:Fe,moveTab:function(e,t,a){const o=Fe(a),n=o.indexOf(e);if(-1===n)return;const r=[...o];r.splice(n,1),r.splice(t,0,e),A.value=r},showTab:function(e){D.value.includes(e)||(D.value=[...D.value,e])},hideTab:function(e){D.value=D.value.filter(t=>t!==e)},resetTabConfig:function(){D.value=[],A.value=[]},syncNewTablesToVisibleTabs:function(e){if(0===D.value.length)return[];const t=e.filter(e=>!D.value.includes(e));return t.length>0&&(D.value=[...D.value,...t],console.info(`[ACU] 检测到 ${t.length} 个新表格，已自动添加到可见列表:`,t)),t},rowEditDialog:W,widgetSettingsDialog:Y,dashboardHistoryDialog:X,avatarCropDialog:G,widgetActionsDialog:J,avatarManagerDialog:Z,nodeConfigDialog:te,nodeLabelDialog:re,graphSettingsDialog:se,factionSettingsDialog:de,settingsDialog:ue,directorDialog:pe,inputFloorDialog:me,purgeRangeDialog:fe,advancedPurgeDialog:ge,manualUpdateDialog:be,historyDialog:he,tabsPopup:xe,presetSaveDialog:ke,openRowEditDialog:function(e){W.props={...e},W.visible=!0},closeRowEditDialog:function(){W.visible=!1},openWidgetSettingsDialog:function(e){Y.props={...e},Y.visible=!0},closeWidgetSettingsDialog:function(){Y.visible=!1},openDashboardHistoryDialog:function(e){X.props={...e},X.visible=!0},closeDashboardHistoryDialog:function(){X.visible=!1},switchFromRowEditToHistory:function(){X.props={tableName:W.props.tableName,tableId:W.props.tableId,rowIndex:W.props.rowIndex,currentRowData:W.props.currentRowData,titleColIndex:0},W.visible=!1,X.visible=!0},openAvatarCropDialog:function(e,t){G.props={imageUrl:e.imageUrl,name:e.name,initialOffsetX:e.initialOffsetX??50,initialOffsetY:e.initialOffsetY??50,initialScale:e.initialScale??150,initialInvert:e.initialInvert??!1,showInvertOption:e.showInvertOption??!1},q.value=t.onApply,K.value=t.onUpload??null,G.visible=!0},closeAvatarCropDialog:je,handleAvatarCropApply:function(e){q.value&&q.value(e),je()},handleAvatarCropUpload:function(e){K.value&&K.value(e)},openWidgetActionsDialog:function(e){J.props={...e},J.visible=!0},closeWidgetActionsDialog:function(){J.visible=!1},openAvatarManagerDialog:function(e,t){Z.props={...e},Q.value=t.onUpdate??null,ee.value=t.onLabelChange??null,Z.visible=!0},closeAvatarManagerDialog:function(){Z.visible=!1,Q.value=null,ee.value=null},handleAvatarManagerUpdate:function(){Q.value&&Q.value()},handleAvatarManagerLabelChange:function(){ee.value&&ee.value()},openNodeConfigDialog:function(e,t){te.props={...e},ae.value=t.onConfirm,oe.value=t.onResetToFullName,ne.value=t.onStyleUpdate??null,te.visible=!0},closeNodeConfigDialog:Oe,handleNodeConfigConfirm:function(e,t,a){ae.value&&ae.value(e,t,a),Oe()},handleNodeConfigResetToFullName:function(e,t){oe.value&&oe.value(e,t),Oe()},handleNodeConfigStyleUpdate:function(e){ne.value&&ne.value(e)},openNodeLabelDialog:function(e,t){re.props={...e},ie.value=t.onApply,le.value=t.onReset,re.visible=!0},closeNodeLabelDialog:ce,handleNodeLabelApply:function(e){ie.value&&ie.value(e.selectedIndices),ce()},handleNodeLabelReset:function(){le.value&&le.value(),ce()},openGraphSettingsDialog:function(e=[]){se.props.factions=e,se.visible=!0},closeGraphSettingsDialog:function(){se.visible=!1},openFactionSettingsDialog:function(e,t){de.props={factionId:e,factionName:t},de.visible=!0},closeFactionSettingsDialog:function(){de.visible=!1},openSettingsDialog:Re,closeSettingsDialog:function(){ue.value=!1},openDirectorDialog:function(){pe.value=!0},closeDirectorDialog:function(){pe.value=!1},openInputFloorDialog:function(e=0){me.props.currentFloor=e,me.visible=!0},closeInputFloorDialog:function(){me.visible=!1},openPurgeRangeDialog:function(e=0){fe.props.maxFloor=e,fe.visible=!0},closePurgeRangeDialog:function(){fe.visible=!1},openAdvancedPurgeDialog:function(e,t,a){ge.props={...e},a&&(ge.state.selectedTableKeys=[...a.selectedTableKeys]),ve.value=t.onConfirm,ge.visible=!0},closeAdvancedPurgeDialog:He,handleAdvancedPurgeConfirm:function(e){ve.value&&ve.value(e),He()},openManualUpdateDialog:function(){be.value=!0},closeManualUpdateDialog:function(){be.value=!1},openHistoryDialog:function(e){he.props={...e},he.visible=!0},closeHistoryDialog:function(){he.visible=!1},openTabsPopup:function(){xe.value=!0},closeTabsPopup:function(){xe.value=!1},toggleTabsPopup:function(){xe.value=!xe.value},openPresetSaveDialog:function(e,t){ke.props={...e},Ce.value=t.onSave,ke.visible=!0},closePresetSaveDialog:We,handlePresetSave:function(e){Ce.value&&Ce.value(e),We()},addTableDialog:we,openAddTableDialog:function(e){ye.value=e,we.visible=!0},closeAddTableDialog:Ye,handleAddTableConfirm:function(e){ye.value&&ye.value(e),Ye()},categorySelectDialog:Ne,tagPreEditDialog:Ve,tagManagerDialog:Ee,openCategorySelectDialog:function(e){Ne.props={...e},Ne.visible=!0},closeCategorySelectDialog:function(){Ne.visible=!1},openTagPreEditDialog:function(e){Ve.props={...e},Ve.visible=!0},closeTagPreEditDialog:function(){Ve.visible=!1},openTagManagerDialog:function(e,t){Ee.props={...e},Be.value=t??null,Ee.visible=!0},closeTagManagerDialog:Xe,handleTagManagerSave:function(e,t){Be.value&&Be.value(e,t),Xe()},iconSelectDialog:Te,openIconSelectDialog:function(e,t){Te.props={...e},Se.value=t.onSelect,Te.visible=!0},closeIconSelectDialog:De,handleIconSelect:function(e){Se.value&&Se.value(e),De()},divinationOverlay:Ie,openDivinationOverlay:function(e,t=!1){Ie.result=e,Ie.isQuickRerollMode=t,Ie.visible=!0},closeDivinationOverlay:function(){Ie.visible=!1,Ie.isQuickRerollMode=!1},promptEditorDialog:_e,openPromptEditorDialog:function(e){_e.props.prompt=e,_e.visible=!0},closePromptEditorDialog:function(){_e.visible=!1},initDivinationSystem:async function(){const e=(0,s.E)();e.isLoaded||(e.loadConfig(),await e.loadFromWorldbook())},openDivinationSettingsDialog:()=>{Re('divination')},aiNotifySignal:(0,r.computed)(()=>Ge.value),triggerAiNotify:function(){Ge.value++,qe.value=!1},isAiGenerating:(0,r.computed)(()=>qe.value),setAiGenerating:function(e){qe.value=e},tagPreviewMode:Ae,tagPreviewTooltip:ze,toggleTagPreviewMode:()=>{Ae.value=!Ae.value,ze.visible=!1},showTagPreviewTooltip:(e,t,a)=>{ze.content=e,ze.x=t,ze.y=a,ze.visible=!0},hideTagPreviewTooltip:()=>{ze.visible=!1}}})},9800(e,t,a){a.d(t,{DR:()=>n,JT:()=>s,Qo:()=>i,b3:()=>c,bT:()=>l,j7:()=>r,o6:()=>o});const o={enabled:!1,hasIndexedDBImage:!1,externalUrl:void 0,imageUrl:'',opacity:30,size:'cover',blur:0,offsetX:0,offsetY:0,scale:100},n={bgNav:'--acu-bg-nav',bgPanel:'--acu-bg-panel',cardBg:'--acu-card-bg',tableHead:'--acu-table-head',tableHover:'--acu-table-hover',badgeBg:'--acu-badge-bg',inputBg:'--acu-input-bg',menuBg:'--acu-menu-bg',overlayBg:'--acu-overlay-bg',textMain:'--acu-text-main',textSub:'--acu-text-sub',menuText:'--acu-menu-text',border:'--acu-border',btnBg:'--acu-btn-bg',btnHover:'--acu-btn-hover',btnActiveBg:'--acu-btn-active-bg',btnActiveText:'--acu-btn-active-text',shadow:'--acu-shadow'},r=[{id:'background',name:'背景色',icon:'fa-fill-drip',vars:[{key:'bgNav',label:'导航栏背景'},{key:'bgPanel',label:'面板背景'},{key:'cardBg',label:'卡片背景'},{key:'tableHead',label:'表头背景'},{key:'tableHover',label:'悬浮背景'},{key:'badgeBg',label:'徽章背景'},{key:'inputBg',label:'输入框背景'},{key:'menuBg',label:'菜单背景'},{key:'overlayBg',label:'遮罩背景'}]},{id:'text',name:'文本色',icon:'fa-font',vars:[{key:'textMain',label:'主文本色'},{key:'textSub',label:'次要文本色'},{key:'menuText',label:'菜单文本色'}]},{id:'button',name:'边框与按钮',icon:'fa-square',vars:[{key:'border',label:'边框色'},{key:'btnBg',label:'按钮背景'},{key:'btnHover',label:'按钮悬浮'},{key:'btnActiveBg',label:'按钮激活背景'},{key:'btnActiveText',label:'按钮激活文本'}]},{id:'effect',name:'效果',icon:'fa-magic',vars:[{key:'shadow',label:'阴影色'}]}],i=[{value:'list',label:'普通列表'},{value:'grid',label:'普通网格'},{value:'global',label:'全局状态'},{value:'interaction',label:'交互表'}],l={goToTable:{id:'goToTable',icon:'fa-external-link-alt',label:'跳转',tooltip:'跳转到表格'},clear:{id:'clear',icon:'fa-eraser',label:'清除',tooltip:'清除表格数据'},undo:{id:'undo',icon:'fa-undo',label:'撤回',tooltip:'撤回上次修改'},manualUpdate:{id:'manualUpdate',icon:'fa-hand-sparkles',label:'更新',tooltip:'手动更新'},relationshipGraph:{id:'relationshipGraph',icon:'fa-project-diagram',label:'关系图',tooltip:'人物关系图'},settings:{id:'settings',icon:'fa-cog',label:'设置',tooltip:'看板设置'},nativeEdit:{id:'nativeEdit',icon:'fa-external-link-alt',label:'原生编辑器',tooltip:'打开原生编辑器'},divination:{id:'divination',icon:'fa-dice',label:'抽签',tooltip:'赛博算卦 - 注入隐藏提示词'},console:{id:'console',icon:'fa-solid fa-clapperboard',label:'导演控制台',tooltip:'打开导演控制台'},quickReroll:{id:'quickReroll',icon:'fa-dice',secondaryIcon:'fa-redo-alt',label:'快捷重抽',tooltip:'抽签并替换最后一条用户消息中的剧情元指令'}},c={task:{type:'table',title:'任务',icon:'fa-tasks',displayColumns:['名称','任务名','name','Name','类型','状态'],maxRows:5,actions:['goToTable'],colSpan:1,displayStyle:'list',widgetTagConfig:{displayedTagIds:[],displayedCategoryIds:['cat_quest']}},item:{type:'table',title:'物品',icon:'fa-box-open',displayColumns:['名称','物品名','name','Name','数量'],maxRows:12,actions:['goToTable'],colSpan:1,displayStyle:'grid',widgetTagConfig:{displayedTagIds:[],displayedCategoryIds:['cat_item']}},character:{type:'table',title:'主角',icon:'fa-user',displayColumns:[],maxRows:1,actions:['goToTable'],colSpan:2,displayStyle:'list',widgetTagConfig:{displayedTagIds:[],displayedCategoryIds:['cat_character']}},location:{type:'table',title:'地点',icon:'fa-map-marker-alt',displayColumns:['名称','地点','name','Name','描述'],maxRows:5,actions:['goToTable'],colSpan:1,displayStyle:'list',widgetTagConfig:{displayedTagIds:[],displayedCategoryIds:['cat_location']}},global:{type:'table',title:'全局状态',icon:'fa-globe',displayColumns:['时间','地点'],maxRows:1,actions:['goToTable'],colSpan:2,displayStyle:'global'}},s={task:['任务','Task','task','Quest','quest','日程'],item:['物品','道具','Item','item','背包','库存','装备','武器'],character:['主角','玩家','Player','player','protagonist','人物','角色','NPC','npc'],location:['地点','位置','Location','location','场景'],global:['全局','Global']}},9687(e,t,a){function o(e){return new Promise((t,a)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=()=>t(o.result),o.onerror=a})}function n(e,t=100,a=.8){return new Promise((o,n)=>{const r=new Image;r.onload=()=>{try{const e=document.createElement('canvas'),i=Math.min(1,t/Math.max(r.width,r.height));e.width=r.width*i,e.height=r.height*i;const l=e.getContext('2d');if(!l)return void n(new Error('无法创建 canvas context'));l.drawImage(r,0,0,e.width,e.height),o(e.toDataURL('image/jpeg',a))}catch(e){n(e)}},r.onerror=()=>n(new Error('图片加载失败')),r.src=e})}function r(e,t){const a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!a)return e;return`rgba(${parseInt(a[1],16)}, ${parseInt(a[2],16)}, ${parseInt(a[3],16)}, ${t/100})`}a.d(t,{bB:()=>o,j5:()=>r,w4:()=>n})},4778(e,t,a){a.d(t,{w4:()=>E.w4,Y3:()=>N,bB:()=>E.bB,n2:()=>D,M1:()=>B,cq:()=>c,ev:()=>s,tu:()=>T,j5:()=>E.j5,_C:()=>h,Et:()=>x,Zg:()=>V,iF:()=>y,tE:()=>S});const o=[{level:'S',name:'爱/沉迷',color:'#E91E63',keywords:['恋','男友','女友','爱','暧昧','情人','伴侣','老婆','老公','丈夫','妻子','粉丝','迷','倾心','心上人']},{level:'A',name:'亲属',color:'#2196F3',keywords:['父','母','爹','娘','妈','爸','兄','哥','弟','姐','妹','爷','奶','叔','姑','舅','姨','亲','族','祖','儿','女','孙']},{level:'B',name:'师/友/同伴',color:'#4CAF50',keywords:['友','盟','知己','故交','青梅竹马','发小','闺蜜','死党','伙','同窗','师','弟子','学生','队友','搭档','同伴','同门','徒','教官','学徒','向导','哨兵']},{level:'C',name:'社会关系/未分类',color:'#9E9E9E',keywords:['同事','邻居','舍友','室友','顾客','客户','上司','下属','同学','路人','熟人','认识','相识','同乡','老乡','房东','租客','店员','老板','员工','主管','经理','助手','秘书','管家','仆人','侍从','护卫','保镖']},{level:'D',name:'利益关系',color:'#FF9800',keywords:['合作','雇佣','交易','债务','炮友','利用','工具人','棋子','操控','傀儡','买卖','债主','欠债','商业','合伙','投资','赞助','金主','资助','包养','契约','协议']},{level:'E',name:'敌对关系',color:'#F44336',keywords:['仇','敌','死','对手','竞争','仇敌','死敌','宿敌','威胁','敌对','仇人','仇家','敌人','对头','冤家','杀父','杀母','血仇','深仇','世仇','夙敌','劲敌','强敌','死对头','眼中钉','宿主','夺舍','寄生']}],n='?',r='复杂/未知',i='#9C27B0';function l(e,t){return t.keywords.some(t=>e.includes(t))}function c(e,t){const a=e.split(/[,，、;；|]/).map(e=>e.trim()).filter(e=>e.length>0);if(0===a.length)return{color:o.find(e=>'C'===e.level).color,level:'C',typeName:'社会关系',isComplex:!1};if(t&&t.length>0)for(const e of t)if(e.keywords&&e.keywords.length>0)for(const t of a)if(e.keywords.some(e=>t.includes(e)))return{color:e.color,level:'C',typeName:e.label,isComplex:!1};const c=new Set;if(a.forEach(e=>{for(const t of o)if(l(e,t)){c.add(t.level);break}}),0===c.size)return{color:o.find(e=>'C'===e.level).color,level:'C',typeName:'社会关系',isComplex:!1};const s=['S','A','B'].some(e=>c.has(e)),d=c.has('E');if(s&&d)return{color:i,level:n,typeName:r,isComplex:!0};const u=['S','A','E','D','B','C'];for(const e of u)if(c.has(e)){const t=o.find(t=>t.level===e);return{color:t.color,level:t.level,typeName:t.name,isComplex:!1}}return{color:o.find(e=>'C'===e.level).color,level:'C',typeName:'社会关系',isComplex:!1}}function s(){const e={S:'💗',A:'💙',B:'💚',C:'⚪',D:'🟡',E:'🔴','?':'🟣'};return[...o.map(t=>({level:t.level,name:t.name,color:t.color,emoji:e[t.level]})),{level:n,name:r,color:i,emoji:e['?']},{level:'dashed',name:'过往/隐藏',color:'#888888',emoji:'┄',isDashed:!0}]}function d(e,t){const a=(e||'')+(t||'');return['过去','过往','从前','曾经','曾','前','原','故','昔','已故','已逝','前任','旧','暗','秘','隐','伪','假','表面','疑','可能','潜在','疑似'].some(e=>a.includes(e))}function u(e){return e?e.replace(/[。.]+$/,'').replace(/\s+/g,'').trim():''}a(4061);const p=/[;；|\n]/,m=/[、,，/&]/,f=/[：:]/;function g(e,t){const a=e.cells.find(e=>e.colIndex===t);return a?String(a.value??'').trim():''}function v(e,t){return t&&e&&t.get(e)||e}function b(e,t){const a=e.map(e=>e.toLowerCase());for(const e of t){const t=a.findIndex(t=>t.includes(e.toLowerCase()));if(-1!==t)return t}return-1}function h(e,t){const a=e.toLowerCase(),o=t.toLowerCase();return['人物','角色','npc','character','主角','protagonist','player'].some(e=>a.includes(e)||o.includes(e))}function x(e){return/^[A-Za-z\s'-]+$/.test(e)&&e.includes(' ')}function w(e){if(x(e)){const t=e.split(' ')[0];return t.length>6?t.slice(0,6):t}return e.length>0?e[e.length-1]:e}function y(e,t=[],a,o,n){const r=[],i=[],l=[],s=new Set;if(!e||0===e.rows.length)return{elements:[],nodeCount:0,edgeCount:0,warnings:['关系表为空或不存在']};const u=e.headers,p=b(u,['source','源','主体','发起方','from']),m=b(u,['target','目标','客体','接收方','to']),f=b(u,['关系','relation','关系词']),h=b(u,['备注','note','说明','remark']);if(-1===p||-1===m)return{elements:[],nodeCount:0,edgeCount:0,warnings:['关系表缺少 source/target 列，无法解析']};const x=new Set,y=new Set,k=new Set;if(t.forEach(e=>{const t=e.name.toLowerCase(),a=t.includes('主角')||t.includes('protagonist'),o=b(e.headers,['姓名','name','名称','角色名']);-1!==o&&e.rows.forEach(e=>{const t=g(e,o);t&&(a?x.add(t):y.add(t))})}),a){const e=b(a.headers,['名称','name','势力名']);-1!==e&&a.rows.forEach(t=>{const a=g(t,e);a&&k.add(a)})}function C(e){if(!e||s.has(e))return;s.add(e);const t=function(e){return x.has(e)?'protagonist':y.has(e)?'character':k.has(e)?'faction':'unknown'}(e),a=w(e);i.push({data:{id:e,label:a,type:t},classes:t})}return e.rows.forEach((e,t)=>{const a=g(e,p),i=g(e,m),s=-1!==f?g(e,f):'',u=-1!==h?g(e,h):'';if(!a||!i)return void((a||i)&&r.push(`第 ${t+1} 行数据不完整（source: "${a}", target: "${i}"）`));const b=v(a,o),x=v(i,o);C(b),C(x);const w=c(s,n);l.push({data:{id:`edge-${t}`,source:b,target:x,label:s||'关系',note:u,color:w.color,lineStyle:d(u)?'dashed':'solid',level:w.level}})}),{elements:[...i,...l],nodeCount:i.length,edgeCount:l.length,warnings:r}}function k(e,t){const a=[],o=[],n=new Set;let r=0;const i=new Set(t.validTargets||[]);function l(e,o=t.nodeType){if(!e||n.has(e))return;n.add(e);const r=w(e);a.push({data:{id:e,label:r,type:o},classes:o})}const s=new Map;e.forEach(e=>{const a=b(e.headers,t.nameColKeywords),o=b(e.headers,t.relationColKeywords);-1!==a&&-1!==o&&e.rows.forEach(e=>{const n=g(e,a),r=g(e,o);if(!n||!r)return;const b=v(n,t.aliasMap);l(b),i.add(b);const h=function(e,t=new Set){if(!e||'string'!=typeof e)return[];const a=[],o=e.split(p).map(e=>e.trim()).filter(Boolean);for(const e of o){let o='',n=e;const r=e.match(/[（(]([^）)]+)[）)]/);r&&(o=r[1],n=e.replace(/[（(][^）)]+[）)]/g,'').trim()),n=n.replace(/[""]([^""]+)[""]/g,'$1');const i=n.match(/^(.+?)与(.+?)的(.+)$/);if(i){const e=i[1].trim(),t=i[2].trim(),n=i[3].split(m).map(e=>e.trim()).filter(Boolean);for(const r of n){const n=u(r);n&&a.push({targets:[e,t],relation:n,note:o})}continue}const l=n.match(/^(.+?[、,，].+?)的(.+)$/);if(l){const e=l[1],t=l[2],n=e.split(m).map(e=>e.trim()).filter(Boolean);if(n.length>1){const e=t.split(m).map(e=>e.trim()).filter(Boolean);for(const t of e){const e=u(t);e&&a.push({targets:n,relation:e,note:o})}continue}}const c=n.match(/^(.+?)的(.+)$/);if(c){const e=c[1].trim(),t=c[2];let n;n=t.includes('与')?t.split(/与/).map(e=>e.trim()).filter(Boolean):t.split(m).map(e=>e.trim()).filter(Boolean);for(const t of n){const n=u(t);n&&a.push({targets:[e],relation:n,note:o})}continue}const s=n.match(/^与(.+?)([^、,，\s]+)$/);if(s){const e=s[1].trim(),t=s[2].trim(),n=e.split(m).map(e=>e.trim()).filter(Boolean),r=t.split(m).map(e=>e.trim()).filter(Boolean);let i=!1;for(const e of r){const t=u(e);n.length>0&&t&&(a.push({targets:n,relation:t,note:o}),i=!0)}if(i)continue}const d=n.match(new RegExp(`^(.+?)${f.source}(.+)$`));if(d){let e=d[1].trim(),n=d[2].trim(),r=!1;const i=e=>e.split(m).map(e=>e.trim()).some(e=>t.has(e));if(t.size>0){const t=i(e),a=i(n);!t&&a&&(r=!0)}r&&([e,n]=[n,e]);const l=n,c=e.split(m).map(e=>e.trim()).filter(Boolean),s=l.split(m).map(e=>e.trim()).filter(Boolean);for(const e of s){const t=u(e);t&&a.push({targets:c,relation:t,note:o})}continue}console.info(`[RelationshipParser] 无法解析: "${e}"`)}return a}(r,i);for(const e of h){const a=u(e.relation);if(a)for(const o of e.targets){const n=v(o,t.aliasMap);if(t.validTargets&&!t.validTargets.has(n))continue;l(n);const r=`${b}->${n}`,i=c(a,t.customLegendItems),u=d(e.note,a);if(s.has(r)){const t=s.get(r);t.relations.includes(a)||t.relations.push(a),e.note&&!t.notes.includes(e.note)&&t.notes.push(e.note);const o=['S','A','E','D','B','C','?'],n=o.indexOf(t.level);(o.indexOf(i.level)<n||-1===n)&&(t.color=i.color,t.level=i.level),u&&(t.useDashed=!0)}else s.set(r,{relations:[e.relation],notes:e.note?[e.note]:[],color:i.color,level:i.level,useDashed:u})}}})});const h=new Set;return s.forEach((e,t)=>{const[a,n]=t.split('->'),i=[a,n].sort().join('<->');if(h.has(i))return;const l=`${n}->${a}`,c=s.get(l);let d=!1;if(c){d=[...e.relations].sort().join(',')===[...c.relations].sort().join(',')}const u=e.relations.join('/'),p=e.notes.join('; ');d?(h.add(i),o.push({data:{id:'edge-'+r++,source:a,target:n,label:u||'关系',note:p,color:e.color,lineStyle:e.useDashed?'dashed':'solid',level:e.level,bidirectional:!0}})):o.push({data:{id:'edge-'+r++,source:a,target:n,label:u||'关系',note:p,color:e.color,lineStyle:e.useDashed?'dashed':'solid',level:e.level,bidirectional:!1}})}),{elements:[...a,...o],nodeCount:a.length,edgeCount:o.length,warnings:[]}}function C(e){const t=['势力','faction','组织','organization','阵营'];return e.find(e=>{const a=e.name.toLowerCase(),o=e.id.toLowerCase();return t.some(e=>a.includes(e)||o.includes(e))})||null}function N(e,t){const a=function(e){const t=C(e);if(!t)return console.info('[FactionMapping] 未找到势力表'),[];const a=b(t.headers,['名称','name','势力名','组织名','阵营名']);if(-1===a)return console.info('[FactionMapping] 势力表中未找到名称列'),[];const o=[];return t.rows.forEach(e=>{const t=g(e,a);t&&!o.includes(t)&&o.push(t)}),console.info(`[FactionMapping] 从势力表提取 ${o.length} 个势力:`,o),o}(e),o=function(e,t){const a=new Map,o=['所属','势力','阵营','组织','身份','职业','faction','affiliation','organization'];for(const n of e){const e=b(n.headers,['姓名','name','名称','角色名']),r=b(n.headers,o);-1!==e&&-1!==r&&n.rows.forEach(o=>{const n=g(o,e),i=g(o,r);if(!n||!i)return;const l=[...t].sort((e,t)=>t.length-e.length);for(const e of l)if(i.includes(e)){a.set(n,e),console.info(`[FactionMapping] 角色 "${n}" 匹配势力 "${e}" (来自 "${i}")`);break}})}return console.info(`[FactionMapping] 从人物表提取 ${a.size} 个角色的势力归属`),a}(t,a),n=C(e),r=[];if(n&&a.length>0){k([n],{nameColKeywords:['名称','name','势力名','组织名','阵营名'],relationColKeywords:['关系','外交','relation','relationship','势力关系'],nodeType:'faction',validTargets:new Set(a)}).elements.forEach(e=>{e.data.source&&e.data.target&&r.push({source:e.data.source,target:e.data.target,relation:e.data.label||'关系'})}),console.info(`[FactionMapping] 使用通用解析器解析出 ${r.length} 条势力间关系`)}return{factionList:a,characterToFaction:o,factionRelations:r}}function V(e=[],t,a,o){const n=[],r=[];e.forEach(e=>{const t=e.name.toLowerCase();t.includes('主角')||t.includes('protagonist')?n.push(e):r.push(e)});const i=k(n,{nameColKeywords:['姓名','name','名称','角色名'],relationColKeywords:['人际关系','关系','relationship','relations'],nodeType:'protagonist',aliasMap:a,customLegendItems:o}),l=k(r,{nameColKeywords:['姓名','name','名称','角色名'],relationColKeywords:['人际关系','关系','relationship','relations'],nodeType:'character',aliasMap:a,customLegendItems:o}),c=new Map,s=[],d=[...i.warnings,...l.warnings],u=e=>{e.elements.forEach(e=>{if(e.data.source&&e.data.target){const t={...e};t.data.id=`edge-${s.length}`,s.push(t)}else{const t=e.data.id;c.has(t)||c.set(t,e)}})};u(i),u(l);const p=new Set(c.keys()),m=['所属','势力','阵营','组织','身份','职业','faction','affiliation','organization'];return e.forEach(e=>{const t=b(e.headers,['姓名','name','名称','角色名']),a=b(e.headers,m);-1!==t&&-1!==a&&e.rows.forEach(o=>{const n=g(o,t),r=g(o,a);if(n&&r&&!p.has(n)){const t=e.name.toLowerCase().includes('主角')?'protagonist':'character',a=w(n);c.set(n,{data:{id:n,label:a,type:t},classes:t}),p.add(n)}})}),{elements:[...c.values(),...s],nodeCount:c.size,edgeCount:s.length,warnings:d}}var E=a(9687);a(9221);function B(){const e=window.parent||window;return{$:window.jQuery||e.jQuery,getDB:()=>e.AutoCardUpdaterAPI||window.AutoCardUpdaterAPI}}function T(){const e=B().getDB();try{return e&&e.exportTableAsJson?e.exportTableAsJson():null}catch(e){return console.warn('[ACU] getTableData error:',e),null}}function S(e){if(!e||'object'!=typeof e)return{};const t={};for(const a in e)if(e[a]?.name){const o=e[a];t[o.name]={key:a,headers:o.content?.[0]||[],rows:o.content?.slice(1)||[]}}return Object.keys(t).length>0?t:null}function D(e){if(!e)return'';const t=String(e);return'True'===t||'Yes'===t||'完成'===t||'已完成'===t?'acu-badge-success':'False'===t||'No'===t||'失败'===t||'未完成'===t?'acu-badge-danger':'进行中'===t||'Doing'===t?'acu-badge-warning':/^\d+%$/.test(t)?'acu-badge-info':/^Lv\.?\d+$/i.test(t)?'acu-badge-primary':''}},9221(e,t,a){a.d(t,{NX:()=>o,YP:()=>n});a(4061);function o(e){if(!e||!e.rows)return[];const t=[],{optionColIndices:a}=function(e){const t=e.headers||[],a=[];if(t.forEach((e,t)=>{e&&/(选项|Option|分支)/i.test(String(e))&&a.push(t)}),0===a.length&&t.length>0)if(1===t.length)a.push(0);else for(let e=1;e<t.length;e++)a.push(e);return{isMatrix:!0,optionColIndices:a}}(e),o=e.headers||[];return e.rows.forEach(e=>{const n=e.cells.map(e=>String(e.value||'').trim()),r=[];n.forEach((e,t)=>{!a.includes(t)&&e&&r.push(e)}),a.forEach(e=>{const a=n[e];if(a){const n=o[e]||'',i=[...r];n&&i.push(n),t.push({text:a,tags:i})}})}),t}function n(e){return e.includes('选项')||e.toLowerCase().includes('option')}},2720(e,t,a){var o=a(6350);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('1441031e',o,!1,{ssrId:!0})},7261(e,t,a){var o=a(8067);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('29405792',o,!1,{ssrId:!0})},402(e,t,a){var o=a(1416);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('0fba0984',o,!1,{ssrId:!0})},3245(e,t,a){var o=a(1703);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('47703fb6',o,!1,{ssrId:!0})},6519(e,t,a){var o=a(6489);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('cd21d8e8',o,!1,{ssrId:!0})},8508(e,t,a){var o=a(9210);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('3d76eee2',o,!1,{ssrId:!0})},639(e,t,a){var o=a(5285);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('c8affff8',o,!1,{ssrId:!0})},773(e,t,a){var o=a(8875);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('50d15491',o,!1,{ssrId:!0})},8455(e,t,a){var o=a(21);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('480632a2',o,!1,{ssrId:!0})},652(e,t,a){var o=a(7886);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('6299b1a2',o,!1,{ssrId:!0})},9058(e,t,a){var o=a(1569);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('77c90075',o,!1,{ssrId:!0})},1402(e,t,a){var o=a(1829);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('7987a798',o,!1,{ssrId:!0})},1873(e,t,a){var o=a(1656);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('1264d040',o,!1,{ssrId:!0})},2731(e,t,a){var o=a(4850);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('f3f64338',o,!1,{ssrId:!0})},8558(e,t,a){var o=a(8537);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('cb670388',o,!1,{ssrId:!0})},6146(n,r,i){i.d(r,{default:()=>k}),i.r(r);var l=i(4061),c=i(6212),s=i(8963),d=i(5526),u=i(6744),p=i(420),m=i(4778),f=i(6094);const g={class:'acu-relationship-graph'},v={key:1,class:'acu-graph-legend'},b={class:'label'},h={class:'acu-graph-toolbar'},x={key:2,class:'acu-graph-empty'},w='acu_graph_config',y=(0,l.defineComponent)({__name:'RelationshipGraph',props:{relationshipTable:{default:null},characterTables:{default:()=>[]},factionTable:{default:null},allTables:{default:()=>[]},showLegend:{type:Boolean,default:!0},initialLayout:{default:'fcose'}},emits:['node-click','edge-click'],setup(n,{expose:r,emit:i}){e.use(a),e.use(t),o(e);const y=(0,u.JH)(),k=(0,u.j_)(),C=(0,u.zI)(),N=(0,u.Ct)(),V=(0,s.o)(),E=(0,l.ref)(new Map),B=(0,l.ref)(new Map),T=(0,l.ref)(null),S=n,D=i,A=(0,l.ref)(null);let I=null;const M=(0,l.ref)(!1),U=(0,l.ref)(''),P=(0,l.ref)(null),L=(0,l.ref)(null),F=(0,l.ref)(new Set);const j=(0,l.ref)(R().lastLayout||S.initialLayout),O=(0,l.ref)(null);function R(){try{const e=getVariables({type:'chat'})[w]||{};return e.positions&&!e.layoutPositions&&(console.info('[RelationshipGraph] 迁移旧格式位置数据到 fcose'),e.layoutPositions={fcose:e.positions},delete e.positions,H(e)),e}catch(e){return console.warn('[RelationshipGraph] 获取聊天变量失败:',e),{}}}function H(e){try{insertOrAssignVariables({[w]:e},{type:'chat'})}catch(e){console.warn('[RelationshipGraph] 保存聊天变量失败:',e)}}function W(e){const t=e||j.value;return R().layoutPositions?.[t]}function Y(e,t){try{const a=window.parent?.document||document,o=a.querySelector('.acu-wrapper');if(o){const t=getComputedStyle(o).getPropertyValue(e).trim();if(t)return t}return getComputedStyle(a.documentElement).getPropertyValue(e).trim()||t}catch{return t}}function X(){return{textMain:Y('--acu-text-main','#333333'),textSub:Y('--acu-text-sub','#666666'),cardBg:Y('--acu-card-bg','#ffffff'),border:Y('--acu-border','#e0e0e0'),titleColor:Y('--acu-title-color','#d35400'),bgPanel:Y('--acu-bg-panel','#e6e2d3'),btnBg:Y('--acu-btn-bg','#dcd0c0'),highlight:Y('--acu-highlight','#d35400'),fontFamily:Y('--acu-font-family','Source Han Sans SC, sans-serif')}}async function G(){const e=X().fontFamily.split(',')[0].trim().replace(/['"]/g,'');if(e)try{const t=window.parent?.document||document;await t.fonts.load(`16px "${e}"`),console.info('[RelationshipGraph] 字体预加载完成:',e)}catch(t){console.warn('[RelationshipGraph] 字体预加载失败:',e,t)}}const q=(0,l.computed)(()=>(0,m.ev)()),K=(0,l.computed)(()=>{if(!C.config.showBackground)return{enabled:!1,style:{}};const e=N.backgroundConfig,t=T.value||e.externalUrl||'';if(!e.enabled||!t)return{enabled:!1,style:{}};const a=(e.scale||100)/100;return{enabled:!0,style:{backgroundImage:`url(${t})`,backgroundPosition:'center center',backgroundSize:'auto'===e.size?'100%':e.size,backgroundRepeat:'no-repeat',transform:`translate(${e.offsetX||0}%, ${e.offsetY||0}%) scale(${a})`,transformOrigin:'center center',opacity:e.opacity/100,filter:e.blur>0?`blur(${e.blur}px)`:'none',position:'absolute',top:'0',left:'0',width:'100%',height:'100%',zIndex:'0',pointerEvents:'none'}}}),J=(0,l.computed)(()=>{const e=C.getLegendConfig();if(e.enabled&&e.items?.length)return e.items.map(e=>({label:e.label,color:e.color,keywords:e.keywords}))}),Z=(0,l.computed)(()=>{console.info('[RelationshipGraph] 解析数据 - props:',{relationshipTable:S.relationshipTable?.name,characterTablesCount:S.characterTables?.length,characterTablesNames:S.characterTables?.map(e=>e.name),factionTable:S.factionTable?.name,aliasMapSize:B.value.size,customLegendEnabled:!!J.value});const e=(0,m.iF)(S.relationshipTable,S.characterTables,S.factionTable,B.value,J.value);if(console.info('[RelationshipGraph] 专用关系表解析结果:',{nodeCount:e.nodeCount,edgeCount:e.edgeCount,warnings:e.warnings}),0===e.nodeCount&&S.characterTables&&S.characterTables.length>0){console.info('[RelationshipGraph] 无专用关系表，尝试从角色表内嵌字段解析');const e=(0,m.Zg)(S.characterTables,S.factionTable,B.value,J.value);return console.info('[RelationshipGraph] 内嵌字段解析结果:',{nodeCount:e.nodeCount,edgeCount:e.edgeCount,warnings:e.warnings}),e}return e}),Q=(0,l.computed)(()=>Z.value.nodeCount>0),ee=(0,l.computed)(()=>{const{factionList:e,characterToFaction:t}=(0,m.Y3)(S.allTables||[],S.characterTables||[]);return e.filter(e=>{for(const[_,a]of t)if(a===e)return!0;return!1})});function te(){k.setActiveTab(u.H6)}function ae(e){switch(e){case'cola':return{name:'fcose',quality:'proof',randomize:!1,animate:!0,animationDuration:500,fit:!0,padding:30,nodeSeparation:75,idealEdgeLength:100,edgeElasticity:.45,nestingFactor:.1,gravity:.25,numIter:2500,nodeRepulsion:4500,tilingPaddingVertical:10,tilingPaddingHorizontal:10};case'circle':return{name:'concentric',concentric:e=>O.value&&e.id()===O.value?100:O.value||'protagonist'!==e.data('type')?1:100,levelWidth:()=>1,minNodeSpacing:80,animate:!0,animationDuration:500,fit:!0,padding:30};default:return{name:'fcose',quality:'proof',randomize:!1,animate:!0,animationDuration:500,fit:!0,padding:30,nodeSeparation:100,idealEdgeLength:120,edgeElasticity:.45,nestingFactor:.1,gravity:.25,numIter:2500,nodeRepulsion:4500}}}function oe(){if(!A.value)return;const t=X(),a=W(),o=a?Object.keys(a).length:0,n=Z.value.nodeCount,r=o>0&&n>0&&o>=.8*n;console.info('[RelationshipGraph] 布局检查:',{保存的位置数:o,当前节点数:n,使用保存位置:r});const i=Z.value.elements.map(e=>{const t=e.data?.id;if(t&&!e.data?.source){const o=E.value.get(t);let n;r&&a&&(a[t]?(console.info('[RelationshipGraph] 恢复节点位置:',t,a[t]),n=a[t]):n={x:200*(Math.random()-.5),y:200*(Math.random()-.5)});const i=e.data?.fullName||e.data?.id||'',l=C.getNodeStyleOverride(t),c=l?.size??C.config.nodeSize,s=l?.shape??'ellipse',d=l?.borderWidth??0,u=X().textMain,p=l?.borderColor??u;return{...e,data:{...e.data,avatarUrl:o?.url||void 0,avatarOffsetX:o?.offsetX??50,avatarOffsetY:o?.offsetY??50,avatarScale:o?.scale??150,fullName:i,nodeSize:c,nodeShape:s,nodeBorderWidth:d,nodeBorderColor:p},...n?{position:n}:{}}}return e});I=e({container:A.value,elements:i,style:[{selector:'node',style:{label:'data(label)','text-valign':'center','text-halign':'center','text-wrap':'wrap','text-max-width':C.config.nodeSize-4+'px','background-color':t.btnBg,color:t.textMain,'font-family':t.fontFamily,'font-size':e=>{const t=(e.data('label')||'').length,a=C.config.nodeSize;let o;return o=t<=1?.6:t<=2?.45:t<=3?.35:t<=4?.28:.22,`${Math.round(a*o)}px`},'font-weight':'bold',width:C.config.nodeSize,height:C.config.nodeSize,'border-width':1.5,'border-color':t.textMain}},{selector:'node.protagonist',style:{'background-color':t.highlight,color:t.textMain,'border-width':1.5,'border-color':t.textMain}},{selector:'node.character',style:{}},{selector:'node.faction',style:{'background-color':t.btnBg,color:t.textMain,'border-width':1.5,'border-color':t.textMain,shape:'round-rectangle',width:70,height:35,'font-size':'14px'}},{selector:'node.unknown',style:{'background-color':t.btnBg,color:t.textMain,'border-width':1.5,'border-color':t.textMain}},{selector:'node[avatarUrl]',style:{'background-color':'transparent','background-opacity':0,'border-width':0,width:C.config.nodeSize,height:C.config.nodeSize,label:''}},{selector:'edge',style:{'curve-style':'bezier','target-arrow-shape':'triangle','target-arrow-color':'data(color)','line-color':'data(color)','line-style':'solid',width:C.config.edgeWidth,label:'data(label)','font-size':`${C.config.relationLabelFontSize}px`,'font-family':t.fontFamily,'text-rotation':'autorotate','text-margin-y':-8,color:'#fff','text-background-color':'data(color)','text-background-opacity':.95,'text-background-padding':`${Math.max(3,Math.round(.25*C.config.relationLabelFontSize))}px`,'text-background-shape':'roundrectangle'}},{selector:'edge[lineStyle = "dashed"]',style:{'line-style':'dashed'}},{selector:'edge[?bidirectional]',style:{'source-arrow-shape':'triangle','source-arrow-color':'data(color)','curve-style':'straight'}},{selector:'node:selected',style:{'border-width':4,'border-color':'#FFC107','overlay-opacity':.2,'overlay-color':'#FFC107'}},{selector:'edge:selected',style:{width:4,'line-color':'#FFC107','target-arrow-color':'#FFC107'}},{selector:'.search-dimmed',style:{display:'none'}}],layout:r?{name:'preset'}:ae(j.value),userZoomingEnabled:!0,userPanningEnabled:!0,boxSelectionEnabled:!1,minZoom:.3,maxZoom:3,wheelSensitivity:.45}),I.on('tap','node',e=>{const t=e.target,a=t.id(),o=t.data('type')||'unknown';M.value?le(a):('circle'===j.value&&function(e){if(!I)return;if(O.value===e)return;console.info(`[RelationshipGraph] 切换环形中心节点: ${O.value||'(主角)'} → ${e}`),O.value=e;I.layout(ae('circle')).run()}(a),D('node-click',{id:a,type:o}))}),I.on('dbltap','node:childless',e=>{const t=e.target;t.hasClass('faction-container')||function(e,t){const a=fe()[e],o=a?.displayLabel||t,n=a?.selectedIndices||function(e){const t=function(e){if((0,m.Et)(e))return e.split(' ').filter(Boolean);return e.split('')}(e);if((0,m.Et)(e))return[0];return t.length>0?[t.length-1]:[]}(t);k.openNodeConfigDialog({nodeId:e,fullName:t,currentLabel:o,selectedIndices:n},{onConfirm:be,onResetToFullName:he,onStyleUpdate:xe})}(t.id(),t.id())}),I.on('dbltap','node.faction-container',e=>{const t=e.target,a=t.id(),o=t.data('label')||a.replace('faction-container-','');k.openFactionSettingsDialog(a,o)}),I.on('tap','edge',e=>{const t=e.target;D('edge-click',{source:t.source().id(),target:t.target().id(),relation:t.data('label')||''})});const l=(0,c.Q0)(()=>{pe()},1e3);I.on('dragfree','node',()=>{l()}),r&&I.fit(void 0,30),ve(),'cola'===j.value&&(console.info('[RelationshipGraph] 初始化时检测到 cola 布局，创建势力容器'),de(),ye()),ke(),I.nodeHtmlLabel([{query:'node[avatarUrl]',halign:'center',valign:'center',halignBox:'center',valignBox:'center',tpl:e=>{const t=e.avatarUrl||'',a=e.avatarOffsetX??50,o=e.avatarOffsetY??50,n=e.avatarScale??150,r=e.fullName||e.id||'',i=C.config.nameLabelFontSize||14,l=e.nodeSize||C.config.nodeSize||50,c=e.nodeShape||'ellipse',s=e.nodeBorderWidth??0,d=X().textMain;let u,p='none';'ellipse'===c?u='50%':'round-rectangle'===c?u='12px':'hexagon'===c?(u='0',p='polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%)'):u='0';const m=l-2*s;return`\n          <div class="acu-graph-avatar-wrapper">\n            <div class="acu-graph-avatar" style="\n              width: ${m}px;\n              height: ${m}px;\n              border-radius: ${u};\n              border: ${s}px solid ${e.nodeBorderColor??d};\n              background-image: url('${t}');\n              background-position: ${a}% ${o}%;\n              background-size: ${n}%;\n              background-repeat: no-repeat;\n              box-sizing: content-box;\n              clip-path: ${p};\n            "></div>\n            <div class="acu-graph-avatar-name" style="font-size: ${i}px;">${r}</div>\n          </div>\n        `}}])}function ne(){I&&(I.elements().remove(),I.add(Z.value.elements),I.layout(ae(j.value)).run())}function re(){M.value=!M.value,M.value?setTimeout(()=>{P.value?.focus()},100):ce()}function ie(e){if(!I)return;const t=e.trim().toLowerCase();if(!t)return void ce();const a=I.nodes().filter(e=>{if(e.hasClass('faction-container')||e.hasClass('hidden-in-cola'))return!1;const a=(e.id()||'').toLowerCase(),o=(e.data('label')||'').toLowerCase(),n=(e.data('fullName')||'').toLowerCase();return a.includes(t)||o.includes(t)||n.includes(t)}).first();a&&a.length>0&&le(a.id())}function le(e){if(!I)return;const t=I.getElementById(e);if(!t||0===t.length)return;L.value=e,U.value=t.data('label')||e,I.batch(()=>{0===F.value.size&&I.elements('.hidden-in-cola').forEach(e=>{F.value.add(e.id())});let e=t.neighborhood('node').filter(e=>!e.hasClass('hidden-in-cola')).add(t),a=t.connectedEdges().filter(e=>!e.hasClass('hidden-in-cola'));if('cola'===j.value){const t=new Set;e.forEach(e=>{const a=e.parent();a.length>0&&a.hasClass('faction-container')&&t.add(a.id())}),t.forEach(t=>{const a=I.getElementById(t);a.length>0&&(e=e.add(a))}),I.edges('.faction-edge').forEach(e=>{const o=e.source().id(),n=e.target().id();t.has(o)&&t.has(n)&&(a=a.add(e))})}I.elements().addClass('search-dimmed'),e.removeClass('search-dimmed'),a.removeClass('search-dimmed')});const a=I.elements().not('.search-dimmed');I.animate({fit:{eles:a,padding:50},duration:400})}function ce(){I&&(L.value=null,U.value='',I.batch(()=>{I.elements().removeClass('search-dimmed'),F.value.size>0&&F.value.forEach(e=>{const t=I.getElementById(e);t.length>0&&t.addClass('hidden-in-cola')})}),F.value.clear())}function se(){I?.fit(void 0,30)}function de(){if(!I)return!1;const e=X(),{factionList:t,characterToFaction:a,factionRelations:o}=(0,m.Y3)(S.allTables||[],S.characterTables||[]);if(0===t.length)return console.info('[RelationshipGraph] 未找到势力数据，跳过容器创建'),!1;console.info(`[RelationshipGraph] 创建势力容器: ${t.length} 个势力`),I.nodes('.faction-container').remove();for(const e of t){const t=I.getElementById(e);t&&t.length>0&&!t.hasClass('faction-container')&&(t.addClass('hidden-in-cola'),console.info(`[RelationshipGraph] 隐藏与势力同名的节点: "${e}"`))}for(const e of t){let o=!1;for(const[_,t]of a)if(t===e){o=!0;break}if(!o){console.info(`[RelationshipGraph] 跳过无成员势力: "${e}"`);continue}let n;if(C.hasFactionColor(e))n=C.getFactionColor(e,t);else{const a=t.indexOf(e);n=a>=0&&a<8?C.getFactionColor(e,t):p.X8}I.add({group:'nodes',data:{id:`faction-container-${e}`,label:e,type:'faction-container',borderColor:n.border,backgroundColor:n.background},classes:'faction-container'})}a.forEach((e,t)=>{const a=I?.getElementById(t);a&&a.length>0&&(a.move({parent:`faction-container-${e}`}),console.info(`[RelationshipGraph] 角色 "${t}" → 势力 "${e}"`))});let n=0;const r=new Set;for(const e of o){const t=`faction-container-${e.source}`,a=`faction-container-${e.target}`,i=[e.source,e.target].sort().join('<->');if(!r.has(i)&&(I.getElementById(t).length>0&&I.getElementById(a).length>0)){const l=o.find(t=>t.source===e.target&&t.target===e.source),c=l&&l.relation===e.relation;c&&r.add(i);const s=(0,m.cq)(e.relation);I.add({group:'edges',data:{id:'faction-edge-'+n++,source:t,target:a,label:e.relation,color:s.color,level:s.level,bidirectional:c},classes:'faction-edge'}),console.info(`[RelationshipGraph] 势力边: "${e.source}" ${c?'↔':'→'} "${e.target}" (${e.relation})`)}}return I.style().selector('node.faction-container').style({'background-color':'data(backgroundColor)','background-opacity':1,'border-width':2,'border-style':'dashed','border-color':'data(borderColor)',shape:'roundrectangle',padding:'20px',label:'data(label)','text-valign':'top','text-halign':'center','font-size':`${C.config.factionLabelFontSize}px`,'font-family':e.fontFamily,'font-weight':'bold',color:'data(borderColor)','text-background-color':'data(backgroundColor)','text-background-opacity':1,'text-background-padding':`${Math.max(4,Math.round(.4*C.config.factionLabelFontSize))}px`,'text-background-shape':'roundrectangle','text-border-width':2,'text-border-color':'data(borderColor)','text-margin-y':-8}).selector('edge.faction-edge').style({'curve-style':'bezier','target-arrow-shape':'triangle','target-arrow-color':'data(color)','line-color':'data(color)','line-style':'solid',width:3,label:'data(label)','font-size':`${C.config.relationLabelFontSize}px`,'font-family':e.fontFamily,'text-rotation':'autorotate','text-margin-y':-10,color:'#fff','text-background-color':'data(color)','text-background-opacity':.95,'text-background-padding':`${Math.max(3,Math.round(.25*C.config.relationLabelFontSize))}px`,'text-background-shape':'roundrectangle'}).selector('node.hidden-in-cola').style({display:'none'}).selector('edge.hidden-in-cola').style({display:'none'}).update(),I.nodes('.hidden-in-cola').connectedEdges().addClass('hidden-in-cola'),!0}function ue(e){if(!I)return;if(e===j.value)return;const t=j.value;'cola'===t&&'cola'!==e&&I&&(I.nodes().forEach(e=>{e.parent().length>0&&e.parent().is('.faction-container')&&e.move({parent:null})}),I.elements('.hidden-in-cola').removeClass('hidden-in-cola'),I.edges('.faction-edge').remove(),I.nodes('.faction-container').remove(),console.info('[RelationshipGraph] 已移除势力容器')),j.value=e,console.info(`[RelationshipGraph] 布局切换: ${t} → ${e}`);const a=R();a.lastLayout=e,H(a),'cola'===e&&(de(),ye());const o=function(e){const t=e||j.value,a=R();console.info(`[RelationshipGraph] hasSavedPositions(${t}):`,{layoutPositions:a.layoutPositions?Object.keys(a.layoutPositions):'undefined',targetLayoutData:a.layoutPositions?.[t]?Object.keys(a.layoutPositions[t]).length+' 个节点':'无'});const o=a.layoutPositions?.[t];return!!(o&&Object.keys(o).length>0)}(e);if(console.info(`[RelationshipGraph] 检查 [${e}] 是否有保存位置: ${o}`),o)console.info(`[RelationshipGraph] 恢复 [${e}] 保存的位置`),function(e){if(!I)return!1;const t=e||j.value,a=W(t);if(!a)return!1;const o=Object.keys(a)[0],n=a[o];console.info(`[RelationshipGraph] 准备恢复 [${t}] 位置，共 ${Object.keys(a).length} 个节点 (首节点 "${o}": 保存=${n?.x?.toFixed(0)}, ${n?.y?.toFixed(0)})`);let r=!1,i=0;I.nodes().forEach(e=>{const t=e.id(),o=a[t];if(o){const a=e.position();console.info(`[RelationshipGraph] 设置节点 "${t}": 目标=(${o.x?.toFixed?.(0)??o.x}, ${o.y?.toFixed?.(0)??o.y}), 当前=(${a.x.toFixed(0)}, ${a.y.toFixed(0)})`),e.position({x:o.x,y:o.y});const n=e.position();console.info(`[RelationshipGraph] 节点 "${t}": (${a.x.toFixed(0)}, ${a.y.toFixed(0)}) → (${n.x.toFixed(0)}, ${n.y.toFixed(0)})`),r=!0,i++}}),r&&(console.info(`[RelationshipGraph] 从 [${t}] 恢复了 ${i} 个节点位置`),I.fit(void 0,30))}(e);else{console.info(`[RelationshipGraph] [${e}] 无保存位置，运行布局算法`);I.layout(ae(e)).run()}}function pe(e){if(!I)return;const t=e||j.value,a={};let o=!0;if(I.nodes().forEach(e=>{const t=e.position();t&&isFinite(t.x)&&isFinite(t.y)&&(a[e.id()]={x:t.x,y:t.y},0===t.x&&0===t.y||(o=!1))}),o&&Object.keys(a).length>0)return void console.warn('[RelationshipGraph] 跳过保存：所有位置都是 (0, 0)，布局可能未完成');const n=Object.keys(a)[0],r=a[n];console.info(`[RelationshipGraph] 保存节点位置到 [${t}]:`,Object.keys(a).length,`个节点 (首节点 "${n}": ${r?.x?.toFixed(0)}, ${r?.y?.toFixed(0)})`);const i=R();i.layoutPositions||(i.layoutPositions={}),i.layoutPositions[t]=a,H(i)}function me(){const e=R();e.layoutPositions&&(delete e.layoutPositions[j.value],H(e));const t=j.value;console.info(`[RelationshipGraph] 清除 [${t}] 布局位置，重新运行布局`);const a=ae(t);'fcose'!==t&&'cola'!==t||(a.randomize=!0);const o=I?.layout(a);o?.one('layoutstop',()=>{pe(t)}),o?.run()}function fe(){return R().labels||{}}function ge(e){const t=R();t.labels=e,H(t)}function ve(){if(!I)return;const e=fe();I.nodes().forEach(t=>{const a=t.id(),o=e[a];o&&o.displayLabel?t.data('label',o.displayLabel):t.data('label',a)}),console.info('[RelationshipGraph] 标签配置已应用，共配置:',Object.keys(e).length,'个节点')}function be(e,t,a){const o=fe();if(o[e]={displayLabel:t,selectedIndices:a},ge(o),I){const a=I.getElementById(e);a&&a.data('label',t)}}function he(e,t){const a=fe();if(delete a[e],ge(a),I){const a=I.getElementById(e);a&&a.data('label',t)}}function xe(e){if(!I)return;const t=I.getElementById(e);if(!t||0===t.length)return;const a=C.getNodeStyleOverride(e),o=C.config.nodeSize||50,n=a?.size??o,r=a?.borderWidth??0,i=a?.borderColor??'transparent',l=a?.shape??'ellipse';t.style({width:n,height:n}),t.data('nodeSize',n),t.data('nodeBorderWidth',r),t.data('nodeBorderColor',i),t.data('nodeShape',l),t.trigger('data'),console.info(`[RelationshipGraph] 应用节点样式覆盖: ${e}, size=${n}, border=${r}px ${i}, shape=${l}`)}function we(){if(!I)return;const e=C.config.nodeOverrides||{},t=Object.entries(e);0!==t.length&&(I.batch(()=>{for(const[e,a]of t){const t=I.getElementById(e);t&&0!==t.length&&(void 0!==a.size&&(t.style({width:a.size,height:a.size}),t.data('nodeSize',a.size)),void 0!==a.borderWidth&&t.data('nodeBorderWidth',a.borderWidth),void 0!==a.borderColor&&t.data('nodeBorderColor',a.borderColor),void 0!==a.shape&&t.data('nodeShape',a.shape))}}),console.info(`[RelationshipGraph] 应用了 ${t.length} 个节点样式覆盖`))}function ye(){if(!I)return;const e=I.nodes('.faction-container');if(0===e.length)return;X();const{factionList:t}=(0,m.Y3)(S.allTables||[],S.characterTables||[]);I.batch(()=>{e.forEach(e=>{const a=e.id(),o=a.replace('faction-container-',''),n=C.getFactionOverride(a)||C.getFactionColor(o,t);e.data('borderColor',n.border),e.data('backgroundColor',n.background);const r={},i=n.opacity??function(e,t=10){const a=e.match(/rgba?\s*\([^)]+,\s*([\d.]+)\s*\)/);return a?Math.round(100*parseFloat(a[1])):t}(n.background,10);r['background-opacity']=i/100;const l=n.labelPosition??'top';if('none'===l)r['text-opacity']=0,r['text-background-opacity']=0;else switch(r['text-opacity']=1,r['text-background-opacity']=1,r.label=o,r['text-valign']=function(e){switch(e){case'top':case'top-left':case'top-right':case'none':default:return'top';case'bottom':case'bottom-left':case'bottom-right':return'bottom'}}(l),r['text-halign']=function(e){switch(e){case'top-left':case'bottom-left':return'left';case'top-right':case'bottom-right':return'right';default:return'center'}}(l),l){case'top':default:r['text-margin-y']=-8,r['text-margin-x']=0;break;case'bottom':r['text-margin-y']=8,r['text-margin-x']=0;break;case'top-left':r['text-valign']='top',r['text-halign']='left',r['text-margin-x']=25,r['text-margin-y']=25;break;case'top-right':r['text-valign']='top',r['text-halign']='right',r['text-margin-x']=-25,r['text-margin-y']=25;break;case'bottom-left':r['text-valign']='bottom',r['text-halign']='left',r['text-margin-x']=25,r['text-margin-y']=-25;break;case'bottom-right':r['text-valign']='bottom',r['text-halign']='right',r['text-margin-x']=-25,r['text-margin-y']=-25}void 0!==n.labelFontSize&&(r['font-size']=`${n.labelFontSize}px`),r['text-background-color']=n.background,r['text-background-opacity']=i/100,r.color=n.border,r['text-border-color']=n.border,e.style(r)})}),console.info(`[RelationshipGraph] 应用了 ${e.length} 个势力容器样式`)}function ke(){I&&(console.info('[RelationshipGraph] 应用所有配置...'),I.batch(()=>{we(),ye()}),I.style().update(),console.info('[RelationshipGraph] 所有配置应用完成'))}const Ce=(0,l.computed)(()=>Z.value&&Z.value.elements?Z.value.elements.filter(e=>!e.data.source&&!e.data.target).map(e=>({id:e.data.id,name:e.data.id,label:e.data.label||e.data.id,type:e.data.type||'character'})):[]),Ne=(0,l.computed)(()=>ee.value.map((e,t)=>({id:`faction_${t}`,name:e})));function Ve(){k.openGraphSettingsDialog(ee.value)}(0,l.watch)(()=>k.avatarManagerDialog.visible,e=>{if(!e){const{$}=(0,m.M1)();$('.acu-data-display').removeClass('has-modal')}}),(0,l.watch)(()=>C.config,()=>{!function(){if(!I)return;const e=C.config;console.info('[RelationshipGraph] 实时更新图形样式'),I.batch(()=>{I.style().selector('node').style({width:e.nodeSize,height:e.nodeSize,'text-max-width':e.nodeSize-4+'px'}).selector('node[avatarUrl]').style({width:e.nodeSize,height:e.nodeSize}).selector('edge').style({width:e.edgeWidth,'font-size':`${e.relationLabelFontSize}px`}).selector('node.faction-container').style({'font-size':`${e.factionLabelFontSize}px`}).selector('edge.faction-edge').style({'font-size':`${e.relationLabelFontSize}px`}).update()}),ke()}()},{deep:!0}),(0,l.watch)(()=>C.config.nodeOverrides,()=>{I&&(we(),I.style().update())},{deep:!0}),(0,l.watch)(()=>C.config.factionColors,()=>{I&&(ye(),I.style().update())},{deep:!0}),(0,l.watch)(()=>C.config.legendConfig,()=>{I&&Q.value&&(console.info('[RelationshipGraph] 图例配置变化，重新应用边颜色'),I.batch(()=>{const e=Z.value.elements.filter(e=>e.data.source&&e.data.target);for(const t of e){const e=t.data.id;if(!e)continue;const a=I.getElementById(e);a&&a.length>0&&(a.data('color',t.data.color),a.data('level',t.data.level))}}),I.style().update())},{deep:!0});let Ee=0;async function Be(){try{const e=await V.getAliasMap();B.value=e,console.info(`[RelationshipGraph] 别名映射加载完成: ${e.size} 个别名`)}catch(e){console.warn('[RelationshipGraph] 加载别名映射失败:',e)}}async function Te(){const e=Z.value.elements.filter(e=>!e.data.source&&!e.data.target),t=new Map;for(const a of e){const e=a.data.id;if(e)try{const a=await V.getAvatarUrl(e);if(a){const o=await V.getAvatarDisplayConfig(e);t.set(e,{url:a,offsetX:o.offsetX,offsetY:o.offsetY,scale:o.scale})}}catch(t){console.warn(`[RelationshipGraph] 获取头像失败: ${e}`,t)}}E.value=t,console.info(`[RelationshipGraph] 头像预加载完成: ${t.size}/${e.length}`)}async function Se(){console.log('[RelationshipGraph] handleAvatarUpdate 被调用'),await Be(),await Te(),I&&(I.nodes().forEach(e=>{const t=e.id(),a=E.value.get(t);a?(e.data('avatarUrl',a.url),e.data('avatarOffsetX',a.offsetX),e.data('avatarOffsetY',a.offsetY),e.data('avatarScale',a.scale)):(e.removeData('avatarUrl'),e.removeData('avatarOffsetX'),e.removeData('avatarOffsetY'),e.removeData('avatarScale'))}),ve(),I.nodes().trigger('data'),I.style().update())}function De(){console.log('[RelationshipGraph] handleLabelChange 被调用'),I&&(ve(),I.style().update())}(0,l.watch)(()=>N.backgroundConfig.imageUrl,e=>{if(e)T.value!==e&&(T.value=e,console.info('[RelationshipGraph] 背景图片已更新（来自 themeStore）'));else{const e=++Ee;setTimeout(()=>{e!==Ee||N.backgroundConfig.imageUrl||T.value&&(T.value=null,console.info('[RelationshipGraph] 背景图片已清除'))},150)}});const Ae=(0,l.ref)(!1);async function ze(){const e=N.backgroundConfig;if(e.imageUrl)return T.value=e.imageUrl,void console.info('[RelationshipGraph] 初始化：使用 themeStore 背景');if(e.hasIndexedDBImage)try{const e=await(0,d.$H)(d.Aq);e&&(T.value=e,console.info('[RelationshipGraph] 初始化：从 IndexedDB 加载背景'))}catch(e){console.warn('[RelationshipGraph] 初始化：加载背景图片失败:',e)}else e.externalUrl&&(T.value=e.externalUrl,console.info('[RelationshipGraph] 初始化：使用外部 URL 背景'))}function Ie(){if(!I)return;const e=X();I.batch(()=>{I.nodes().forEach(t=>{const a={'font-family':e.fontFamily,color:e.textMain,'border-width':1.5,'border-color':e.textMain};t.hasClass('protagonist')?a['background-color']=e.highlight:t.hasClass('faction-container')||t.data('avatarUrl')||(a['background-color']=e.btnBg),t.style(a)}),I.edges().forEach(t=>{t.style('font-family',e.fontFamily)})}),I.style().update(),console.info('[RelationshipGraph] 节点颜色和字体已更新')}return(0,l.onMounted)(async()=>{await Promise.all([Be(),ze()]),Q.value&&(await Te(),await G(),oe(),Ae.value=!0)}),(0,l.watch)(Q,async e=>{e&&!Ae.value&&A.value&&(console.info('[RelationshipGraph] 数据准备就绪，预加载头像和字体...'),await Te(),await G(),console.info('[RelationshipGraph] 初始化图形'),oe(),Ae.value=!0)},{immediate:!0}),(0,l.onBeforeUnmount)(()=>{I?.destroy(),I=null,T.value?.startsWith('blob:')&&T.value!==N.backgroundConfig.imageUrl&&((0,d.dQ)(T.value),T.value=null)}),(0,l.watch)(()=>S.relationshipTable,()=>{I&&ne()},{deep:!0}),(0,l.watch)([()=>y.config.theme,()=>N.activePresetId,()=>N.currentHighlight,()=>N.currentThemeVars],()=>{I&&setTimeout(()=>{Ie(),ye(),I.style().update()},100)},{deep:!0}),(0,l.watch)(()=>y.config.fontFamily,async()=>{I&&(await G(),Ie())}),r({fitToView:se,zoomIn:function(){I&&I.zoom(1.2*I.zoom())},zoomOut:function(){I&&I.zoom(I.zoom()/1.2)},setLayout:ue,refresh:function(){ne()},applyAllConfigs:ke,applyAllNodeStyleOverrides:we,applyAllFactionStyles:ye,openAvatarManager:function(){const{$}=(0,m.M1)();$('.acu-data-display').addClass('has-modal'),k.openAvatarManagerDialog({nodes:Ce.value,factions:Ne.value},{onUpdate:Se,onLabelChange:De})}}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',g,[(0,l.createCommentVNode)(' 背景层 '),K.value.enabled?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-graph-background',style:(0,l.normalizeStyle)(K.value.style)},null,4)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 图例（顶部） '),(0,l.unref)(C).config.showLegend?((0,l.openBlock)(),(0,l.createElementBlock)('div',v,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(q.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.level,class:'acu-legend-item'},[(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['dot',{dashed:e.isDashed}]),style:(0,l.normalizeStyle)({backgroundColor:e.isDashed?'transparent':e.color,borderColor:e.color})},null,6),(0,l.createElementVNode)('span',b,(0,l.toDisplayString)(e.emoji)+' '+(0,l.toDisplayString)(e.name),1)]))),128))])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 图容器（中间） '),(0,l.createElementVNode)('div',{ref_key:'containerRef',ref:A,class:'acu-graph-container'},null,512),(0,l.createCommentVNode)(' 搜索框（工具栏上方，仅搜索模式显示） '),(0,l.createVNode)(l.Transition,{name:'acu-slide-up'},{default:(0,l.withCtx)(()=>[M.value?((0,l.openBlock)(),(0,l.createBlock)(f.A,{key:0,ref_key:'searchInputRef',ref:P,modelValue:U.value,'onUpdate:modelValue':t[0]||(t[0]=e=>U.value=e),class:'acu-graph-search-input',placeholder:'搜索人物...',autofocus:!0,'show-result-count':!1,onSearch:ie,onClear:ce},null,8,['modelValue'])):(0,l.createCommentVNode)('v-if',!0)]),_:1}),(0,l.createCommentVNode)(' 工具栏（底部） '),(0,l.createElementVNode)('div',h,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-icon-btn',{active:M.value}]),title:'搜索模式',onClick:re},[...t[4]||(t[4]=[(0,l.createElementVNode)('i',{class:'fas fa-search'},null,-1)])],2),t[12]||(t[12]=(0,l.createElementVNode)('span',{class:'acu-toolbar-divider'},null,-1)),(0,l.createElementVNode)('button',{class:'acu-icon-btn',title:'适应视图',onClick:se},[...t[5]||(t[5]=[(0,l.createElementVNode)('i',{class:'fas fa-compress-arrows-alt'},null,-1)])]),t[13]||(t[13]=(0,l.createElementVNode)('span',{class:'acu-toolbar-divider'},null,-1)),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-icon-btn',{active:'fcose'===j.value}]),title:'力导向布局',onClick:t[1]||(t[1]=e=>ue('fcose'))},[...t[6]||(t[6]=[(0,l.createElementVNode)('i',{class:'fas fa-project-diagram'},null,-1)])],2),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-icon-btn',{active:'cola'===j.value}]),title:'势力分组布局',onClick:t[2]||(t[2]=e=>ue('cola'))},[...t[7]||(t[7]=[(0,l.createElementVNode)('i',{class:'fas fa-object-group'},null,-1)])],2),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-icon-btn',{active:'circle'===j.value}]),title:'环形布局',onClick:t[3]||(t[3]=e=>ue('circle'))},[...t[8]||(t[8]=[(0,l.createElementVNode)('i',{class:'fas fa-circle-notch'},null,-1)])],2),t[14]||(t[14]=(0,l.createElementVNode)('span',{class:'acu-toolbar-divider'},null,-1)),(0,l.createElementVNode)('button',{class:'acu-icon-btn',title:'重置布局',onClick:me},[...t[9]||(t[9]=[(0,l.createElementVNode)('i',{class:'fas fa-undo'},null,-1)])]),t[15]||(t[15]=(0,l.createElementVNode)('span',{class:'acu-toolbar-divider'},null,-1)),(0,l.createElementVNode)('button',{class:'acu-icon-btn',title:'图形设置',onClick:(0,l.withModifiers)(Ve,['stop'])},[...t[10]||(t[10]=[(0,l.createElementVNode)('i',{class:'fas fa-cog'},null,-1)])]),t[16]||(t[16]=(0,l.createElementVNode)('span',{class:'acu-toolbar-divider'},null,-1)),(0,l.createElementVNode)('button',{class:'acu-icon-btn',title:'返回仪表盘',onClick:(0,l.withModifiers)(te,['stop'])},[...t[11]||(t[11]=[(0,l.createElementVNode)('i',{class:'fas fa-arrow-left'},null,-1)])])]),(0,l.createCommentVNode)(' 空状态 '),Q.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('div',x,[...t[17]||(t[17]=[(0,l.createElementVNode)('i',{class:'fas fa-project-diagram'},null,-1),(0,l.createElementVNode)('p',null,'暂无关系数据',-1),(0,l.createElementVNode)('p',{class:'hint'},'请确保存在"关系表"并包含有效数据',-1)])]))]))}});i(9058);const k=y},6094(e,t,a){a.d(t,{A:()=>s});var o=a(4061),n=a(6212);const r={class:'acu-search-input-wrapper'},i=['placeholder'],l={key:0,class:'acu-search-result'},c={key:1,class:'no-result'},s=(0,o.defineComponent)({__name:'SearchBox',props:{modelValue:{},resultCount:{},debounce:{default:300},autofocus:{type:Boolean,default:!1},placeholder:{default:'搜索...'},showResultCount:{type:Boolean,default:!0}},emits:['update:modelValue','search','clear','searchImmediate'],setup(e,{expose:t,emit:a}){const s=e,d=a,u=(0,o.ref)(),p=(0,o.ref)(s.modelValue),m=(0,o.ref)(!1);s.autofocus&&(0,o.onMounted)(()=>{u.value?.focus()});const f=(0,n.Q0)(e=>{d('update:modelValue',e),d('search',e)},s.debounce);(0,o.watch)(p,e=>{f(e)}),(0,o.watch)(()=>s.modelValue,e=>{e!==p.value&&(p.value=e)});const g=()=>{p.value='',d('update:modelValue',''),d('search',''),d('clear'),u.value?.focus()},v=()=>{d('update:modelValue',p.value),d('search',p.value),d('searchImmediate',p.value)};return t({focus:()=>{u.value?.focus()},blur:()=>{u.value?.blur()},clear:g,selectAll:()=>{u.value?.select()},inputRef:u}),(t,a)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{class:(0,o.normalizeClass)(['acu-search-box',{focused:m.value,'has-value':p.value}])},[(0,o.createElementVNode)('div',r,[(0,o.createCommentVNode)(' 搜索图标 '),a[4]||(a[4]=(0,o.createElementVNode)('i',{class:'fas fa-search acu-search-icon'},null,-1)),(0,o.createCommentVNode)(' 搜索输入框 '),(0,o.withDirectives)((0,o.createElementVNode)('input',{ref_key:'inputRef',ref:u,'onUpdate:modelValue':a[0]||(a[0]=e=>p.value=e),type:'text',class:'acu-search-input',placeholder:e.placeholder,onFocus:a[1]||(a[1]=e=>m.value=!0),onBlur:a[2]||(a[2]=e=>m.value=!1),onKeydown:[(0,o.withKeys)(g,['escape']),(0,o.withKeys)(v,['enter'])]},null,40,i),[[o.vModelText,p.value]]),(0,o.createCommentVNode)(' 清空按钮 '),(0,o.createVNode)(o.Transition,{name:'acu-fade'},{default:(0,o.withCtx)(()=>[p.value?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'acu-search-clear',title:'清空搜索',onClick:g},[...a[3]||(a[3]=[(0,o.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])):(0,o.createCommentVNode)('v-if',!0)]),_:1})]),(0,o.createCommentVNode)(' 搜索结果计数（可选） '),(0,o.createVNode)(o.Transition,{name:'acu-fade'},{default:(0,o.withCtx)(()=>[e.showResultCount&&void 0!==e.resultCount?((0,o.openBlock)(),(0,o.createElementBlock)('div',l,[e.resultCount>0?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:0},[a[5]||(a[5]=(0,o.createTextVNode)(' 找到 ',-1)),(0,o.createElementVNode)('strong',null,(0,o.toDisplayString)(e.resultCount),1),a[6]||(a[6]=(0,o.createTextVNode)(' 条结果 ',-1))],64)):p.value?((0,o.openBlock)(),(0,o.createElementBlock)('span',c,'无匹配结果')):(0,o.createCommentVNode)('v-if',!0)])):(0,o.createCommentVNode)('v-if',!0)]),_:1})],2))}})},1667(e,t){t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,o]of t)a[e]=o;return a}},4424(e,t,a){function o(e,t){for(var a=[],o={},n=0;n<t.length;n++){var r=t[n],i=r[0],l={id:e+':'+n,css:r[1],media:r[2],sourceMap:r[3]};o[i]?o[i].parts.push(l):a.push(o[i]={id:i,parts:[l]})}return a}a.d(t,{A:()=>f});var n='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!n)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var r={},i=n&&(document.head||document.getElementsByTagName('head')[0]),l=null,c=0,s=!1,d=function(){},u=null,p='data-vue-ssr-id',m='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function f(e,t,a,n){s=a,u=n||{};var i=o(e,t);return g(i),function(t){for(var a=[],n=0;n<i.length;n++){var l=i[n];(c=r[l.id]).refs--,a.push(c)}t?g(i=o(e,t)):i=[];for(n=0;n<a.length;n++){var c;if(0===(c=a[n]).refs){for(var s=0;s<c.parts.length;s++)c.parts[s]();delete r[c.id]}}}}function g(e){for(var t=0;t<e.length;t++){var a=e[t],o=r[a.id];if(o){o.refs++;for(var n=0;n<o.parts.length;n++)o.parts[n](a.parts[n]);for(;n<a.parts.length;n++)o.parts.push(b(a.parts[n]));o.parts.length>a.parts.length&&(o.parts.length=a.parts.length)}else{var i=[];for(n=0;n<a.parts.length;n++)i.push(b(a.parts[n]));r[a.id]={id:a.id,refs:1,parts:i}}}}function v(){var e=document.createElement('style');return e.type='text/css',i.appendChild(e),e}function b(e){var t,a,o=document.querySelector('style['+p+'~="'+e.id+'"]');if(o){if(s)return d;o.parentNode.removeChild(o)}if(m){var n=c++;o=l||(l=v()),t=w.bind(null,o,n,!1),a=w.bind(null,o,n,!0)}else o=v(),t=y.bind(null,o),a=function(){o.parentNode.removeChild(o)};return t(e),function(o){if(o){if(o.css===e.css&&o.media===e.media&&o.sourceMap===e.sourceMap)return;t(e=o)}else a()}}var h,x=(h=[],function(e,t){return h[e]=t,h.filter(Boolean).join('\n')});function w(e,t,a,o){var n=a?'':o.css;if(e.styleSheet)e.styleSheet.cssText=x(t,n);else{var r=document.createTextNode(n),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(r,i[t]):e.appendChild(r)}}function y(e,t){var a=t.css,o=t.media,n=t.sourceMap;if(o&&e.setAttribute('media',o),u.ssrId&&e.setAttribute(p,t.id),n&&(a+='\n/*# sourceURL='+n.sources[0]+' */',a+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+' */'),e.styleSheet)e.styleSheet.cssText=a;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(a))}}},4015(e,t,a){e.exports=(e=>{var t={};return a.d(t,e),t})({klona:()=>n.klona})},3035(e,t,a){e.exports=(e=>{var t={};return a.d(t,e),t})({createPinia:()=>r.createPinia,defineStore:()=>r.defineStore,storeToRefs:()=>r.storeToRefs})},4061(e){e.exports=Vue},7696(e,t,a){a.d(t,{AHd:()=>E,MLh:()=>c,PMY:()=>C,X2F:()=>d,fOm:()=>V,iDZ:()=>m,niW:()=>T,rXt:()=>k,wYm:()=>N});var o=a(6212),n=a(4061);const r=o.oc?window:void 0,i=(o.oc&&window.document,o.oc?window.navigator:void 0);o.oc&&window.location;function l(e){var t;const a=(0,n.toValue)(e);return null!=(t=null==a?void 0:a.$el)?t:a}function c(...e){const t=[],a=()=>{t.forEach(e=>e()),t.length=0},i=(0,n.computed)(()=>{const t=(0,o.$r)((0,n.toValue)(e[0])).filter(e=>null!=e);return t.every(e=>'string'!=typeof e)?t:void 0}),c=(0,o.T3)(()=>{var t,a;return[null!=(a=null==(t=i.value)?void 0:t.map(e=>l(e)))?a:[r].filter(e=>null!=e),(0,o.$r)((0,n.toValue)(i.value?e[1]:e[0])),(0,o.$r)((0,n.unref)(i.value?e[2]:e[1])),(0,n.toValue)(i.value?e[3]:e[2])]},([e,n,r,i])=>{if(a(),!(null==e?void 0:e.length)||!(null==n?void 0:n.length)||!(null==r?void 0:r.length))return;const l=(0,o.Gv)(i)?{...i}:i;t.push(...e.flatMap(e=>n.flatMap(t=>r.map(a=>((e,t,a,o)=>(e.addEventListener(t,a,o),()=>e.removeEventListener(t,a,o)))(e,t,a,l)))))},{flush:'post'});return(0,o.Uo)(a),()=>{c(),a()}}let s=!1;function d(e,t,a={}){const{window:i=r,ignore:d=[],capture:u=!0,detectIframe:p=!1,controls:m=!1}=a;if(!i)return m?{stop:o.lQ,cancel:o.lQ,trigger:o.lQ}:o.lQ;if(o.un&&!s){s=!0;const e={passive:!0};Array.from(i.document.body.children).forEach(t=>t.addEventListener('click',o.lQ,e)),i.document.documentElement.addEventListener('click',o.lQ,e)}let f=!0;const g=e=>(0,n.toValue)(d).some(t=>{if('string'==typeof t)return Array.from(i.document.querySelectorAll(t)).some(t=>t===e.target||e.composedPath().includes(t));{const a=l(t);return a&&(e.target===a||e.composedPath().includes(a))}});const v=a=>{const o=l(e);null!=a.target&&(o instanceof Element||!function(e){const t=(0,n.toValue)(e);return t&&16===t.$.subTree.shapeFlag}(e)||!function(e,t){const a=(0,n.toValue)(e),o=a.$.subTree&&a.$.subTree.children;return!(null==o||!Array.isArray(o))&&o.some(e=>e.el===t.target||t.composedPath().includes(e.el))}(e,a))&&o&&o!==a.target&&!a.composedPath().includes(o)&&('detail'in a&&0===a.detail&&(f=!g(a)),f?t(a):f=!0)};let b=!1;const h=[c(i,'click',e=>{b||(b=!0,setTimeout(()=>{b=!1},0),v(e))},{passive:!0,capture:u}),c(i,'pointerdown',t=>{const a=l(e);f=!g(t)&&!(!a||t.composedPath().includes(a))},{passive:!0}),p&&c(i,'blur',a=>{setTimeout(()=>{var o;const n=l(e);'IFRAME'!==(null==(o=i.document.activeElement)?void 0:o.tagName)||(null==n?void 0:n.contains(i.document.activeElement))||t(a)},0)},{passive:!0})].filter(Boolean),x=()=>h.forEach(e=>e());return m?{stop:x,cancel:()=>{f=!1},trigger:e=>{f=!0,v(e),f=!1}}:x}function u(e){const t=function(){const e=(0,n.shallowRef)(!1),t=(0,n.getCurrentInstance)();return t&&(0,n.onMounted)(()=>{e.value=!0},t),e}();return(0,n.computed)(()=>(t.value,Boolean(e())))}Symbol('vueuse-ssr-width');function p(e,t={}){const{controls:a=!1,navigator:r=i}=t,l=u(()=>r&&'permissions'in r),s=(0,n.shallowRef)(),d='string'==typeof e?{name:e}:e,p=(0,n.shallowRef)(),m=()=>{var e,t;p.value=null!=(t=null==(e=s.value)?void 0:e.state)?t:'prompt'};c(s,'change',m,{passive:!0});const f=(0,o.Jv)(async()=>{if(l.value){if(!s.value)try{s.value=await r.permissions.query(d)}catch(e){s.value=void 0}finally{m()}return a?(0,n.toRaw)(s.value):void 0}});return f(),a?{state:p,isSupported:l,query:f}:p}function m(e={}){const{navigator:t=i,read:a=!1,source:r,copiedDuring:l=1500,legacy:s=!1}=e,d=u(()=>t&&'clipboard'in t),m=p('clipboard-read'),f=p('clipboard-write'),g=(0,n.computed)(()=>d.value||s),v=(0,n.shallowRef)(''),b=(0,n.shallowRef)(!1),h=(0,o.TO)(()=>b.value=!1,l,{immediate:!1});function x(e){return'granted'===e||'prompt'===e}return g.value&&a&&c(['copy','cut'],async function(){let e=!(d.value&&x(m.value));if(!e)try{v.value=await t.clipboard.readText()}catch(t){e=!0}var a,o,n;e&&(v.value=null!=(n=null==(o=null==(a=null==document?void 0:document.getSelection)?void 0:a.call(document))?void 0:o.toString())?n:'')},{passive:!0}),{isSupported:g,text:v,copied:b,copy:async function(e=(0,n.toValue)(r)){if(g.value&&null!=e){let a=!(d.value&&x(f.value));if(!a)try{await t.clipboard.writeText(e)}catch(e){a=!0}a&&function(e){const t=document.createElement('textarea');t.value=null!=e?e:'',t.style.position='absolute',t.style.opacity='0',document.body.appendChild(t),t.select(),document.execCommand('copy'),t.remove()}(e),v.value=e,b.value=!0,h.start()}}}}const f='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:'undefined'!=typeof globalThis?globalThis:'undefined'!=typeof self?self:{},g='__vueuse_ssr_handlers__',v=b();function b(){return g in f||(f[g]=f[g]||{}),f[g]}function h(e,t){return v[e]||t}function x(e){return null==e?'any':e instanceof Set?'set':e instanceof Map?'map':e instanceof Date?'date':'boolean'==typeof e?'boolean':'string'==typeof e?'string':'object'==typeof e?'object':Number.isNaN(e)?'any':'number'}const w={boolean:{read:e=>'true'===e,write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},y='vueuse-storage';function k(e,t,a,i={}){var l;const{flush:s='pre',deep:d=!0,listenToStorageChanges:u=!0,writeDefaults:p=!0,mergeDefaults:m=!1,shallow:f,window:g=r,eventFilter:v,onError:b=e=>{console.error(e)},initOnMounted:k}=i,C=(f?n.shallowRef:n.ref)('function'==typeof t?t():t),N=(0,n.computed)(()=>(0,n.toValue)(e));if(!a)try{a=h('getDefaultStorage',()=>{var e;return null==(e=r)?void 0:e.localStorage})()}catch(e){b(e)}if(!a)return C;const V=(0,n.toValue)(t),E=x(V),B=null!=(l=i.serializer)?l:w[E],{pause:T,resume:S}=(0,o.Hr)(C,e=>function(e){try{const t=a.getItem(N.value);if(null==e)I(t,null),a.removeItem(N.value);else{const o=B.write(e);t!==o&&(a.setItem(N.value,o),I(t,o))}}catch(e){b(e)}}(e),{flush:s,deep:d,eventFilter:v});(0,n.watch)(N,()=>M(),{flush:s});let D=!1;const A=e=>{k&&!D||M(e.detail)};function I(e,t){if(g){const o={key:N.value,oldValue:e,newValue:t,storageArea:a};g.dispatchEvent(a instanceof Storage?new StorageEvent('storage',o):new CustomEvent(y,{detail:o}))}}function M(e){if(!e||e.storageArea===a)if(e&&null==e.key)C.value=V;else if(!e||e.key===N.value){T();try{const t=B.write(C.value);void 0!==e&&(null==e?void 0:e.newValue)===t||(C.value=function(e){const t=e?e.newValue:a.getItem(N.value);if(null==t)return p&&null!=V&&a.setItem(N.value,B.write(V)),V;if(!e&&m){const e=B.read(t);return'function'==typeof m?m(e,V):'object'!==E||Array.isArray(e)?e:{...V,...e}}return'string'!=typeof t?t:B.read(t)}(e))}catch(e){b(e)}finally{e?(0,n.nextTick)(S):S()}}}return g&&u&&(a instanceof Storage?c(g,'storage',e=>{k&&!D||M(e)},{passive:!0}):c(g,y,A)),k?(0,o.rd)(()=>{D=!0,M()}):M(),C}function C(e,t={}){var a;const{pointerTypes:i,preventDefault:l,stopPropagation:s,exact:d,onMove:u,onEnd:p,onStart:m,initialValue:f,axis:g='both',draggingElement:v=r,containerElement:b,handle:h=e,buttons:x=[0]}=t,w=(0,n.ref)(null!=(a=(0,n.toValue)(f))?a:{x:0,y:0}),y=(0,n.ref)(),k=e=>!i||i.includes(e.pointerType),C=e=>{(0,n.toValue)(l)&&e.preventDefault(),(0,n.toValue)(s)&&e.stopPropagation()},N=a=>{var o;if(!(0,n.toValue)(x).includes(a.button))return;if((0,n.toValue)(t.disabled)||!k(a))return;if((0,n.toValue)(d)&&a.target!==(0,n.toValue)(e))return;const r=(0,n.toValue)(b),i=null==(o=null==r?void 0:r.getBoundingClientRect)?void 0:o.call(r),l=(0,n.toValue)(e).getBoundingClientRect(),c={x:a.clientX-(r?l.left-i.left+r.scrollLeft:l.left),y:a.clientY-(r?l.top-i.top+r.scrollTop:l.top)};!1!==(null==m?void 0:m(c,a))&&(y.value=c,C(a))},V=a=>{if((0,n.toValue)(t.disabled)||!k(a))return;if(!y.value)return;const o=(0,n.toValue)(b),r=(0,n.toValue)(e).getBoundingClientRect();let{x:i,y:l}=w.value;'x'!==g&&'both'!==g||(i=a.clientX-y.value.x,o&&(i=Math.min(Math.max(0,i),o.scrollWidth-r.width))),'y'!==g&&'both'!==g||(l=a.clientY-y.value.y,o&&(l=Math.min(Math.max(0,l),o.scrollHeight-r.height))),w.value={x:i,y:l},null==u||u(w.value,a),C(a)},E=e=>{!(0,n.toValue)(t.disabled)&&k(e)&&y.value&&(y.value=void 0,null==p||p(w.value,e),C(e))};if(o.oc){const e=()=>{var e;return{capture:null==(e=t.capture)||e,passive:!(0,n.toValue)(l)}};c(h,'pointerdown',N,e),c(v,'pointermove',V,e),c(v,'pointerup',E,e)}return{...(0,o.QW)(w),position:w,isDragging:(0,n.computed)(()=>!!y.value),style:(0,n.computed)(()=>`left:${w.value.x}px;top:${w.value.y}px;`)}}function N(e,t,a={}){const{window:i=r,...c}=a;let s;const d=u(()=>i&&'ResizeObserver'in i),p=()=>{s&&(s.disconnect(),s=void 0)},m=(0,n.computed)(()=>{const t=(0,n.toValue)(e);return Array.isArray(t)?t.map(e=>l(e)):[l(t)]}),f=(0,n.watch)(m,e=>{if(p(),d.value&&i){s=new ResizeObserver(t);for(const t of e)t&&s.observe(t,c)}},{immediate:!0,flush:'post'}),g=()=>{p(),f()};return(0,o.Uo)(g),{isSupported:d,stop:g}}function V(e={}){const{window:t=r}=e,a=(0,n.ref)(null),o=(0,n.computed)(()=>{var e,t;return null!=(t=null==(e=a.value)?void 0:e.toString())?t:''}),i=(0,n.computed)(()=>a.value?function(e){var t;const a=null!=(t=e.rangeCount)?t:0;return Array.from({length:a},(_,t)=>e.getRangeAt(t))}(a.value):[]),l=(0,n.computed)(()=>i.value.map(e=>e.getBoundingClientRect()));return t&&c(t.document,'selectionchange',function(){a.value=null,t&&(a.value=t.getSelection())},{passive:!0}),{text:o,rects:l,ranges:i,selection:a}}function E(e={}){var t,a;const{window:i=r}=e,l=(0,o.lW)(null==e?void 0:e.element),c=(0,o.lW)(null!=(t=null==e?void 0:e.input)?t:''),s=null!=(a=null==e?void 0:e.styleProp)?a:'height',d=(0,n.shallowRef)(1),u=(0,n.shallowRef)(0);function p(){var t;if(!l.value)return;let a='';l.value.style[s]='1px',d.value=null==(t=l.value)?void 0:t.scrollHeight;const o=(0,n.toValue)(null==e?void 0:e.styleTarget);o?o.style[s]=`${d.value}px`:a=`${d.value}px`,l.value.style[s]=a}return(0,n.watch)([c,l],()=>(0,n.nextTick)(p),{immediate:!0}),(0,n.watch)(d,()=>{var t;return null==(t=null==e?void 0:e.onResize)?void 0:t.call(e)}),N(l,([{contentRect:e}])=>{u.value!==e.width&&function(e=r,t){e&&'function'==typeof e.requestAnimationFrame?e.requestAnimationFrame(t):t()}(i,()=>{u.value=e.width,p()})}),(null==e?void 0:e.watch)&&(0,n.watch)(e.watch,p,{immediate:!0,deep:!0}),{textarea:l,input:c,triggerResize:p}}Number.POSITIVE_INFINITY;const B={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};o.D_;function T(e,t){const{containerStyle:a,wrapperProps:o,scrollTo:r,calculateRange:i,currentList:l,containerRef:c}='itemHeight'in t?function(e,t){const a=S(t),{state:o,source:r,currentList:i,size:l,containerRef:c}=a,s={overflowY:'auto'},{itemHeight:d,overscan:u=5}=e,p=D(o,r,d),m=A(r,d),f=I('vertical',u,m,p,a),g=M(d,r),v=(0,n.computed)(()=>g(o.value.start)),b=P(d,r);U(l,t,c,f);const h=F('vertical',f,g,c),x=(0,n.computed)(()=>({style:{width:'100%',height:b.value-v.value+'px',marginTop:`${v.value}px`}}));return{calculateRange:f,scrollTo:h,containerStyle:s,wrapperProps:x,currentList:i,containerRef:c}}(t,e):function(e,t){const a=S(t),{state:o,source:r,currentList:i,size:l,containerRef:c}=a,s={overflowX:'auto'},{itemWidth:d,overscan:u=5}=e,p=D(o,r,d),m=A(r,d),f=I('horizontal',u,m,p,a),g=M(d,r),v=(0,n.computed)(()=>g(o.value.start)),b=P(d,r);U(l,t,c,f);const h=F('horizontal',f,g,c),x=(0,n.computed)(()=>({style:{height:'100%',width:b.value-v.value+'px',marginLeft:`${v.value}px`,display:'flex'}}));return{scrollTo:h,calculateRange:f,wrapperProps:x,containerStyle:s,currentList:i,containerRef:c}}(t,e);return{list:l,scrollTo:r,containerProps:{ref:c,onScroll:()=>{i()},style:a},wrapperProps:o}}function S(e){const t=(0,n.shallowRef)(null),a=function(e,t={width:0,height:0},a={}){const{window:i=r,box:c='content-box'}=a,s=(0,n.computed)(()=>{var t,a;return null==(a=null==(t=l(e))?void 0:t.namespaceURI)?void 0:a.includes('svg')}),d=(0,n.shallowRef)(t.width),u=(0,n.shallowRef)(t.height),{stop:p}=N(e,([t])=>{const a='border-box'===c?t.borderBoxSize:'content-box'===c?t.contentBoxSize:t.devicePixelContentBoxSize;if(i&&s.value){const t=l(e);if(t){const e=t.getBoundingClientRect();d.value=e.width,u.value=e.height}}else if(a){const e=(0,o.$r)(a);d.value=e.reduce((e,{inlineSize:t})=>e+t,0),u.value=e.reduce((e,{blockSize:t})=>e+t,0)}else d.value=t.contentRect.width,u.value=t.contentRect.height},a);(0,o.rd)(()=>{const a=l(e);a&&(d.value='offsetWidth'in a?a.offsetWidth:t.width,u.value='offsetHeight'in a?a.offsetHeight:t.height)});const m=(0,n.watch)(()=>l(e),e=>{d.value=e?t.width:0,u.value=e?t.height:0});return{width:d,height:u,stop:function(){p(),m()}}}(t),i=(0,n.ref)([]),c=(0,n.shallowRef)(e);return{state:(0,n.ref)({start:0,end:10}),source:c,currentList:i,size:a,containerRef:t}}function D(e,t,a){return o=>{if('number'==typeof a)return Math.ceil(o/a);const{start:n=0}=e.value;let r=0,i=0;for(let e=n;e<t.value.length;e++){if(r+=a(e),i=e,r>o)break}return i-n}}function A(e,t){return a=>{if('number'==typeof t)return Math.floor(a/t)+1;let o=0,n=0;for(let r=0;r<e.value.length;r++){if(o+=t(r),o>=a){n=r;break}}return n+1}}function I(e,t,a,o,{containerRef:n,state:r,currentList:i,source:l}){return()=>{const c=n.value;if(c){const n=a('vertical'===e?c.scrollTop:c.scrollLeft),s=o('vertical'===e?c.clientHeight:c.clientWidth),d=n-t,u=n+s+t;r.value={start:d<0?0:d,end:u>l.value.length?l.value.length:u},i.value=l.value.slice(r.value.start,r.value.end).map((e,t)=>({data:e,index:t+r.value.start}))}}}function M(e,t){return a=>{if('number'==typeof e){return a*e}return t.value.slice(0,a).reduce((t,_,a)=>t+e(a),0)}}function U(e,t,a,o){(0,n.watch)([e.width,e.height,()=>(0,n.toValue)(t),a],()=>{o()})}function P(e,t){return(0,n.computed)(()=>'number'==typeof e?t.value.length*e:t.value.reduce((t,_,a)=>t+e(a),0))}const L={horizontal:'scrollLeft',vertical:'scrollTop'};function F(e,t,a,o){return n=>{o.value&&(o.value[L[e]]=a(n),t())}}},6212(e,t,a){a.d(t,{$r:()=>b,D_:()=>g,Gv:()=>l,Hr:()=>N,Jv:()=>v,Q0:()=>k,QW:()=>V,T3:()=>S,TO:()=>B,Th:()=>T,Uo:()=>n,lQ:()=>c,lW:()=>u,oc:()=>r,rd:()=>E,un:()=>s});var o=a(4061);function n(e){return!!(0,o.getCurrentScope)()&&((0,o.onScopeDispose)(e),!0)}const r='undefined'!=typeof window&&'undefined'!=typeof document,i=('undefined'!=typeof WorkerGlobalScope&&(globalThis,WorkerGlobalScope),Object.prototype.toString),l=e=>'[object Object]'===i.call(e),c=()=>{},s=d();function d(){var e,t;return r&&(null==(e=null==window?void 0:window.navigator)?void 0:e.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||(null==(t=null==window?void 0:window.navigator)?void 0:t.maxTouchPoints)>2&&/iPad|Macintosh/.test(null==window?void 0:window.navigator.userAgent))}function u(...e){if(1!==e.length)return(0,o.toRef)(...e);const t=e[0];return'function'==typeof t?(0,o.readonly)((0,o.customRef)(()=>({get:t,set:c}))):(0,o.ref)(t)}function p(e,t){return function(...a){return new Promise((o,n)=>{Promise.resolve(e(()=>t.apply(this,a),{fn:t,thisArg:this,args:a})).then(o).catch(n)})}}const m=e=>e();function f(e,t={}){let a,n,r=c;const i=e=>{clearTimeout(e),r(),r=c};let l;return c=>{const s=(0,o.toValue)(e),d=(0,o.toValue)(t.maxWait);return a&&i(a),s<=0||void 0!==d&&d<=0?(n&&(i(n),n=void 0),Promise.resolve(c())):new Promise((e,o)=>{r=t.rejectOnCancel?o:e,l=c,d&&!n&&(n=setTimeout(()=>{a&&i(a),n=void 0,e(l())},d)),a=setTimeout(()=>{n&&i(n),n=void 0,e(c())},s)})}}function g(e){return e}function v(e){let t;function a(){return t||(t=e()),t}return a.reset=async()=>{const e=t;t=void 0,e&&await e},a}function b(e){return Array.isArray(e)?e:[e]}function h(e){const t=Object.create(null);return a=>t[a]||(t[a]=e(a))}const x=/\B([A-Z])/g,w=(h(e=>e.replace(x,'-$1').toLowerCase()),/-(\w)/g);h(e=>e.replace(w,(_,e)=>e?e.toUpperCase():''));function y(e){return e||(0,o.getCurrentInstance)()}function k(e,t=200,a={}){return p(f(t,a),e)}function C(e,t,a={}){const{eventFilter:n=m,...r}=a;return(0,o.watch)(e,p(n,t),r)}function N(e,t,a={}){const{eventFilter:n,initialState:r='active',...i}=a,{eventFilter:l,pause:c,resume:s,isActive:d}=function(e=m,t={}){const{initialState:a='active'}=t,n=u('active'===a);return{isActive:(0,o.readonly)(n),pause:function(){n.value=!1},resume:function(){n.value=!0},eventFilter:(...t)=>{n.value&&e(...t)}}}(n,{initialState:r});return{stop:C(e,t,{...i,eventFilter:l}),pause:c,resume:s,isActive:d}}function V(e,t={}){if(!(0,o.isRef)(e))return(0,o.toRefs)(e);const a=Array.isArray(e.value)?Array.from({length:e.value.length}):{};for(const n in e.value)a[n]=(0,o.customRef)(()=>({get:()=>e.value[n],set(a){var r;if(null==(r=(0,o.toValue)(t.replaceRef))||r)if(Array.isArray(e.value)){const t=[...e.value];t[n]=a,e.value=t}else{const t={...e.value,[n]:a};Object.setPrototypeOf(t,Object.getPrototypeOf(e.value)),e.value=t}else e.value[n]=a}}));return a}function E(e,t=!0,a){y(a)?(0,o.onMounted)(e,a):t?e():(0,o.nextTick)(e)}function B(e,t,a={}){const{immediate:i=!0,immediateCallback:l=!1}=a,c=(0,o.shallowRef)(!1);let s;function d(){s&&(clearTimeout(s),s=void 0)}function u(){c.value=!1,d()}function p(...a){l&&e(),d(),c.value=!0,s=setTimeout(()=>{c.value=!1,s=void 0,e(...a)},(0,o.toValue)(t))}return i&&(c.value=!0,r&&p()),n(u),{isPending:(0,o.shallowReadonly)(c),start:p,stop:u}}function T(e,t,a={}){const{debounce:o=0,maxWait:n,...r}=a;return C(e,t,{...r,eventFilter:f(o,{maxWait:n})})}function S(e,t,a){return(0,o.watch)(e,t,{...a,immediate:!0})}}},d={};function u(e){var t=d[e];if(void 0!==t)return t.exports;var a=d[e]={id:e,exports:{}};return s[e](a,a.exports,u),a.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var a in t)u.o(t,a)&&!u.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};var p=u(3035),m=u(4061),f=u(9388),g=u(4293),v=u(4778);const b='acu-styles',h='acu-dynamic-font',x='acu-theme-custom';function w(){const e=(0,f.JH)(),t=(0,g.C)(),{$}=(0,v.M1)(),a=()=>{try{return window.parent?.document||document}catch{return document}},o=(0,m.computed)(()=>{try{return getScriptId()}catch{return'acu-visualizer'}}),n=(0,m.ref)(null),r=(0,m.ref)(null),i=(0,m.ref)(null),l=(0,m.ref)(null),c=(0,m.ref)(!1),s={hanchan:'https://fontsapi.zeoseven.com/3/main/result.css',maple:'https://fontsapi.zeoseven.com/442/main/result.css',huiwen:'https://fontsapi.zeoseven.com/256/main/result.css',cooper:'https://fontsapi.zeoseven.com/482/main/result.css',yffyt:'https://fontsapi.zeoseven.com/446/main/result.css',fusion:'https://fontsapi.zeoseven.com/570/main/result.css',wenkai:'https://fontsapi.zeoseven.com/292/main/result.css',notosans:'https://fontsapi.zeoseven.com/69/main/result.css',zhuque:'https://fontsapi.zeoseven.com/7/main/result.css'},d=new Set,u=()=>{const t=a(),n=`${h}-${o.value}`;t.getElementById(n)?.remove();const r=t.createElement('style');r.id=n,r.setAttribute('data-source','acu-visualizer');const l=(()=>{const t=e.config.fontFamily||'default',a=f.pQ.find(e=>e.id===t);return a?.val||f.pQ[0].val})();r.textContent=`\n      /* 主容器字体 */\n      .acu-wrapper,\n      .acu-modal-container,\n      .acu-attachment-picker-overlay,\n      .acu-app .acu-toast,\n      .acu-edit-dialog,\n      .acu-cell-menu,\n      .acu-nav-container,\n      #acu-ghost-preview {\n        font-family: ${l} !important;\n      }\n\n      /* 所有文本元素字体（排除图标） */\n      .acu-wrapper p,\n      .acu-wrapper div:not(.fa):not(.fas):not(.far):not(.fab),\n      .acu-wrapper span:not(.fa):not(.fas):not(.far):not(.fab),\n      .acu-wrapper label,\n      .acu-wrapper button,\n      .acu-wrapper a,\n      .acu-wrapper input,\n      .acu-wrapper select,\n      .acu-wrapper textarea,\n      .acu-wrapper th,\n      .acu-wrapper td,\n      .acu-modal-container p,\n      .acu-modal-container div:not(.fa):not(.fas):not(.far):not(.fab),\n      .acu-modal-container span:not(.fa):not(.fas):not(.far):not(.fab),\n      .acu-modal-container label,\n      .acu-modal-container button,\n      .acu-modal-container a,\n      .acu-modal-container input,\n      .acu-modal-container select,\n      .acu-modal-container textarea,\n      .acu-modal-container th,\n      .acu-modal-container td {\n        font-family: ${l} !important;\n      }\n\n      /* Toast - 字体跟随设置，颜色使用主文本色（限定在 .acu-app 内，避免与数据库插件冲突） */\n      .acu-app .acu-toast,\n      .acu-app .acu-toast p,\n      .acu-app .acu-toast div,\n      .acu-app .acu-toast span,\n      .acu-app .acu-toast-message {\n        font-family: ${l} !important;\n        color: var(--acu-text-main) !important;\n        text-shadow: none !important;\n      }\n\n      /* Toast 图标 */\n      .acu-app .acu-toast i {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n        color: var(--acu-text-main) !important;\n      }\n\n      /* Tab/导航按钮 - 普通态：主文本色 */\n      .acu-tab-btn,\n      .acu-tab-btn span,\n      .acu-tab-btn i,\n      .acu-nav-btn,\n      .acu-nav-btn span,\n      .acu-nav-btn i {\n        font-family: ${l} !important;\n        text-shadow: none !important;\n        color: var(--acu-text-main) !important;\n      }\n\n      /* 导航按钮激活状态 - 背景使用主文本色，文字使用面板背景色(反色) */\n      .acu-nav-btn.active,\n      .acu-nav-btn.active span,\n      .acu-nav-btn.active i {\n        background: var(--acu-text-main) !important;\n        background-color: var(--acu-text-main) !important;\n        color: var(--acu-bg-panel) !important;\n      }\n\n      /* 卡片文本 */\n      .acu-data-card,\n      .acu-data-card p,\n      .acu-data-card div:not(.fa):not(.fas):not(.far):not(.fab),\n      .acu-data-card span:not(.fa):not(.fas):not(.far):not(.fab),\n      .acu-card-label,\n      .acu-card-value,\n      .acu-grid-label,\n      .acu-grid-value,\n      .acu-full-label,\n      .acu-full-value,\n      .acu-editable-title {\n        font-family: ${l} !important;\n        text-shadow: none !important;\n      }\n\n      /* 其他组件 */\n      .acu-panel-title,\n      .acu-settings-label,\n      .acu-btn-block,\n      .acu-nav-btn,\n      .acu-edit-textarea {\n        font-family: ${l} !important;\n      }\n\n      /* 保护 Font Awesome 图标字体 */\n      .acu-wrapper i.fa,\n      .acu-wrapper i.fas,\n      .acu-wrapper i.far,\n      .acu-wrapper i.fab,\n      .acu-wrapper .fa,\n      .acu-wrapper .fas,\n      .acu-wrapper .far,\n      .acu-wrapper .fab,\n      .acu-modal-container i.fa,\n      .acu-modal-container i.fas,\n      .acu-modal-container i.far,\n      .acu-modal-container i.fab,\n      .acu-modal-container .fa,\n      .acu-modal-container .fas,\n      .acu-modal-container .far,\n      .acu-modal-container .fab {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n      }\n\n      /* 颜色污染防护 - 只重置 text-shadow，不覆盖颜色 */\n      .acu-wrapper p,\n      .acu-wrapper div,\n      .acu-wrapper span,\n      .acu-wrapper label,\n      .acu-wrapper button,\n      .acu-modal-container p,\n      .acu-modal-container div,\n      .acu-modal-container span,\n      .acu-modal-container label,\n      .acu-modal-container button {\n        text-shadow: none !important;\n      }\n\n      /* 卡片标题 - 使用主题色 + 用户字体 */\n      .acu-editable-title,\n      .acu-panel-title {\n        color: var(--acu-title-color) !important;\n        font-family: ${l} !important;\n      }\n\n      /* 仪表盘标题和内容 */\n      .acu-dash-title,\n      .acu-dash-title span,\n      .acu-dash-title-text {\n        font-family: ${l} !important;\n        color: var(--acu-title-color) !important;\n        text-shadow: none !important;\n      }\n\n      /* 仪表盘图标 */\n      .acu-dash-title i,\n      .acu-dash-empty i,\n      .acu-dash-card i,\n      .acu-dash-npc-item i {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n        color: var(--acu-text-sub) !important;\n      }\n\n      /* 仪表盘空状态 */\n      .acu-dash-empty,\n      .acu-dash-empty span {\n        font-family: ${l} !important;\n        color: var(--acu-text-sub) !important;\n        text-shadow: none !important;\n      }\n\n      /* 表格空状态"暂无数据" */\n      .acu-empty-state,\n      .acu-empty-state p,\n      .acu-empty-state span,\n      .acu-no-data {\n        font-family: ${l} !important;\n        color: var(--acu-text-sub) !important;\n        text-shadow: none !important;\n      }\n\n      /* 空状态图标 */\n      .acu-empty-state i {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n        color: var(--acu-text-sub) !important;\n      }\n\n      /* 卡片列名 label - 字体大小受设置控制 */\n      label.acu-card-label,\n      label.acu-grid-label,\n      label.acu-full-label,\n      .acu-data-card label.acu-card-label,\n      .acu-data-card label.acu-grid-label,\n      .acu-data-card label.acu-full-label,\n      .acu-wrapper label.acu-card-label,\n      .acu-wrapper label.acu-grid-label,\n      .acu-wrapper label.acu-full-label {\n        font-family: ${l} !important;\n        font-size: calc(var(--acu-font-size, 13px) - 2px) !important;\n        text-shadow: none !important;\n      }\n\n      /* hint文本 - 使用次要文本色，字体大小受设置控制 */\n      .acu-wrapper .hint,\n      .acu-wrapper .acu-text-sub,\n      .acu-modal-container .hint,\n      .acu-modal-container .acu-text-sub,\n      .acu-settings-label .hint {\n        color: var(--acu-text-sub) !important;\n        font-size: calc(var(--acu-font-size, 13px) - 2px) !important;\n      }\n\n      /* Tab/Nav 图标使用 Font Awesome */\n      .acu-tab-btn i,\n      .acu-nav-btn i {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n      }\n\n      /* 手动更新弹窗文本 */\n      .acu-manual-update-dialog p,\n      .acu-manual-update-dialog div,\n      .acu-manual-update-dialog span,\n      .acu-manual-update-dialog label,\n      .acu-modal-body p,\n      .acu-modal-body div,\n      .acu-modal-body span,\n      .acu-modal-body label {\n        color: var(--acu-text-main) !important;\n        text-shadow: none !important;\n      }\n\n      /* 设置面板返回按钮 - 使用主文本色 */\n      .acu-modal-back,\n      .acu-modal-back i,\n      .acu-back-btn,\n      .acu-back-btn i {\n        color: var(--acu-text-main) !important;\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n      }\n\n      /* 设置面板关闭按钮 */\n      .acu-modal-close i,\n      .acu-close-pill i {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n        color: inherit !important;\n      }\n\n      /* 所有按钮字体 - 统一使用用户设置的字体 */\n      .acu-wrapper button,\n      .acu-modal-container button,\n      .acu-close-pill,\n      .acu-tool-btn,\n      .acu-btn,\n      .acu-btn-primary,\n      .acu-btn-secondary,\n      .acu-btn-danger,\n      .acu-btn-save,\n      .btn-cancel,\n      .btn-confirm,\n      .acu-preset-dropdown-btn,\n      .acu-modal-btn,\n      .acu-action-btn,\n      .acu-page-btn,\n      .acu-dialog-btn {\n        font-family: ${l} !important;\n      }\n\n      /* 主题面板CSS按钮 */\n      .acu-theme-panel button,\n      .acu-css-actions button,\n      .acu-css-actions .acu-tool-btn {\n        font-family: ${l} !important;\n      }\n\n      /* 头像管理弹窗 */\n      .acu-avatar-manager-modal button,\n      .acu-avatar-manager-modal label,\n      .acu-avatar-manager-modal span,\n      .acu-avatar-manager button,\n      .acu-avatar-manager label,\n      .acu-avatar-manager span,\n      .acu-avatar-dialog button,\n      .acu-avatar-dialog label,\n      .acu-avatar-dialog span {\n        font-family: ${l} !important;\n      }\n\n      /* 设置面板标题图标 - 使用主文本色 */\n      .acu-modal-header i:not(.acu-close-pill i),\n      .acu-settings-title i {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n        color: var(--acu-text-main) !important;\n      }\n    `,t.head.appendChild(r),i.value=r,console.info('[ACU Styles] Font styles injected')},p=()=>{if(!r.value)return;const t=e.config,a=e.highlightColorObj,o=e.highlightManualColorObj,n=e.highlightAiColorObj,i=e.titleColorObj,l=t.gridColumns&&t.gridColumns>0?`repeat(${t.gridColumns}, 1fr)`:'repeat(auto-fill, minmax(110px, 1fr))',c=`\n      .acu-wrapper,\n      .acu-modal-container,\n      .acu-attachment-picker-overlay,\n      .acu-app .acu-toast,\n      .acu-cell-menu {\n        /* 卡片配置 */\n        --acu-card-width: ${t.cardWidth||280}px;\n        --acu-font-size: ${t.fontSize||13}px;\n\n        /* 高亮色 (兼容旧样式) */\n        --acu-highlight: ${a.main};\n        --acu-highlight-bg: ${a.bg};\n        --acu-accent: ${a.main};\n\n        /* 手动修改高亮色 */\n        --acu-highlight-manual: ${o.main};\n        --acu-highlight-manual-bg: ${o.bg};\n\n        /* AI填表高亮色 */\n        --acu-highlight-ai: ${n.main};\n        --acu-highlight-ai-bg: ${n.bg};\n\n        /* 标题色 */\n        --acu-title-color: ${i.main};\n        --acu-title-color-bg: ${i.bg};\n        --acu-title-color-rgb: ${function(e){const t=e.replace('#',''),a=parseInt(t,16);return`${a>>16&255}, ${a>>8&255}, ${255&a}`}(i.main)};\n\n        /* 导航栏 */\n        --acu-nav-cols: ${l};\n\n        /* 文本限制 */\n        --acu-text-max-height: ${!1!==t.limitLongText?'80px':'none'};\n        --acu-text-overflow: ${!1!==t.limitLongText?'auto':'visible'};\n      }\n\n      /* ============================================================\n       * 双色高亮样式 (已移除背景色和动画效果)\n       * ============================================================ */\n\n      /* 手动修改高亮 (橙色系) - 覆盖值元素及其所有子元素 */\n      .acu-cell-changed-manual .acu-grid-value,\n      .acu-cell-changed-manual .acu-full-value,\n      .acu-cell-changed-manual .acu-card-value,\n      .acu-cell-changed-manual .acu-grid-value *,\n      .acu-cell-changed-manual .acu-full-value *,\n      .acu-cell-changed-manual .acu-card-value *,\n      .acu-row-changed-manual .acu-editable-title {\n        color: var(--acu-highlight-manual) !important;\n        font-weight: 600;\n      }\n\n      /* AI填表高亮 (蓝色系) - 覆盖值元素及其所有子元素 */\n      .acu-cell-changed-ai .acu-grid-value,\n      .acu-cell-changed-ai .acu-full-value,\n      .acu-cell-changed-ai .acu-card-value,\n      .acu-cell-changed-ai .acu-grid-value *,\n      .acu-cell-changed-ai .acu-full-value *,\n      .acu-cell-changed-ai .acu-card-value *,\n      .acu-row-changed-ai .acu-editable-title {\n        color: var(--acu-highlight-ai) !important;\n        font-weight: 600;\n      }\n\n      /* 通用变更高亮 (兼容旧样式) */\n      .acu-cell-changed:not(.acu-cell-changed-manual):not(.acu-cell-changed-ai) .acu-grid-value,\n      .acu-cell-changed:not(.acu-cell-changed-manual):not(.acu-cell-changed-ai) .acu-full-value,\n      .acu-cell-changed:not(.acu-cell-changed-manual):not(.acu-cell-changed-ai) .acu-card-value,\n      .acu-cell-changed:not(.acu-cell-changed-manual):not(.acu-cell-changed-ai) .acu-grid-value *,\n      .acu-cell-changed:not(.acu-cell-changed-manual):not(.acu-cell-changed-ai) .acu-full-value *,\n      .acu-cell-changed:not(.acu-cell-changed-manual):not(.acu-cell-changed-ai) .acu-card-value *,\n      .acu-highlight-changed {\n        color: var(--acu-title-color) !important;\n        font-weight: 600;\n      }\n\n      /* ============================================================\n       * 酒馆主题污染防护 - 最高优先级覆盖\n       * 使用全局选择器 + !important 确保优先级高于酒馆主题\n       * ============================================================ */\n\n      /* 滑块 (Range Input) 完全重置 */\n      .acu-wrapper input[type="range"],\n      .acu-modal-container input[type="range"],\n      .acu-settings-control input[type="range"] {\n        -webkit-appearance: none !important;\n        -moz-appearance: none !important;\n        appearance: none !important;\n        background: transparent !important;\n        background-color: transparent !important;\n        background-image: none !important;\n        border: none !important;\n        box-shadow: none !important;\n        outline: none !important;\n        width: 120px !important;\n        height: 20px !important;\n      }\n\n      /* 滑块圆点 - Webkit */\n      .acu-wrapper input[type="range"]::-webkit-slider-thumb,\n      .acu-modal-container input[type="range"]::-webkit-slider-thumb,\n      .acu-settings-control input[type="range"]::-webkit-slider-thumb {\n        -webkit-appearance: none !important;\n        appearance: none !important;\n        width: 16px !important;\n        height: 16px !important;\n        background: var(--acu-title-color) !important;\n        background-color: var(--acu-title-color) !important;\n        background-image: none !important;\n        border-radius: 50% !important;\n        border: none !important;\n        margin-top: -5px !important;\n        cursor: pointer !important;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) !important;\n      }\n\n      /* 滑块轨道 - Webkit */\n      .acu-wrapper input[type="range"]::-webkit-slider-runnable-track,\n      .acu-modal-container input[type="range"]::-webkit-slider-runnable-track,\n      .acu-settings-control input[type="range"]::-webkit-slider-runnable-track {\n        -webkit-appearance: none !important;\n        width: 100% !important;\n        height: 6px !important;\n        background: var(--acu-border) !important;\n        background-color: var(--acu-border) !important;\n        background-image: none !important;\n        border-radius: 3px !important;\n        border: none !important;\n        cursor: pointer !important;\n        box-shadow: none !important;\n      }\n\n      /* 滑块圆点 - Firefox */\n      .acu-wrapper input[type="range"]::-moz-range-thumb,\n      .acu-modal-container input[type="range"]::-moz-range-thumb,\n      .acu-settings-control input[type="range"]::-moz-range-thumb {\n        -moz-appearance: none !important;\n        width: 16px !important;\n        height: 16px !important;\n        background: var(--acu-title-color) !important;\n        background-color: var(--acu-title-color) !important;\n        background-image: none !important;\n        border-radius: 50% !important;\n        border: none !important;\n        cursor: pointer !important;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) !important;\n      }\n\n      /* 滑块轨道 - Firefox */\n      .acu-wrapper input[type="range"]::-moz-range-track,\n      .acu-modal-container input[type="range"]::-moz-range-track,\n      .acu-settings-control input[type="range"]::-moz-range-track {\n        -moz-appearance: none !important;\n        width: 100% !important;\n        height: 6px !important;\n        background: var(--acu-border) !important;\n        background-color: var(--acu-border) !important;\n        background-image: none !important;\n        border-radius: 3px !important;\n        border: none !important;\n        cursor: pointer !important;\n        box-shadow: none !important;\n      }\n\n      /* 输入框/选择框 污染防护 */\n      .acu-wrapper input[type="text"],\n      .acu-wrapper input[type="number"],\n      .acu-wrapper input[type="password"],\n      .acu-wrapper select,\n      .acu-wrapper textarea,\n      .acu-modal-container input[type="text"],\n      .acu-modal-container input[type="number"],\n      .acu-modal-container input[type="password"],\n      .acu-modal-container select,\n      .acu-modal-container textarea,\n      .acu-settings-control input[type="text"],\n      .acu-settings-control input[type="number"],\n      .acu-settings-control select {\n        background: var(--acu-card-bg) !important;\n        background-color: var(--acu-card-bg) !important;\n        background-image: none !important;\n        border: 1px solid var(--acu-border) !important;\n        border-radius: 6px !important;\n        color: var(--acu-text-main) !important;\n        font-family: inherit !important;\n        font-size: 13px !important;\n        text-shadow: none !important;\n        box-shadow: none !important;\n        backdrop-filter: none !important;\n        filter: none !important;\n      }\n\n      .acu-wrapper input[type="text"]:hover,\n      .acu-wrapper input[type="number"]:hover,\n      .acu-wrapper select:hover,\n      .acu-modal-container input[type="text"]:hover,\n      .acu-modal-container input[type="number"]:hover,\n      .acu-modal-container select:hover,\n      .acu-settings-control input:hover,\n      .acu-settings-control select:hover {\n        border-color: var(--acu-title-color) !important;\n        background: var(--acu-card-bg) !important;\n        background-color: var(--acu-card-bg) !important;\n        background-image: none !important;\n        box-shadow: 0 0 0 2px var(--acu-title-color-bg) !important;\n      }\n\n      .acu-wrapper input[type="text"]:focus,\n      .acu-wrapper input[type="number"]:focus,\n      .acu-wrapper select:focus,\n      .acu-modal-container input[type="text"]:focus,\n      .acu-modal-container input[type="number"]:focus,\n      .acu-modal-container select:focus,\n      .acu-settings-control input:focus,\n      .acu-settings-control select:focus {\n        border-color: var(--acu-title-color) !important;\n        background: var(--acu-card-bg) !important;\n        background-color: var(--acu-card-bg) !important;\n        background-image: none !important;\n        box-shadow: 0 0 0 2px var(--acu-title-color-bg) !important;\n        outline: none !important;\n      }\n\n      /* 选择框下拉箭头 */\n      .acu-wrapper select,\n      .acu-modal-container select,\n      .acu-settings-control select {\n        -webkit-appearance: none !important;\n        -moz-appearance: none !important;\n        appearance: none !important;\n        padding-right: 30px !important;\n        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E") !important;\n        background-repeat: no-repeat !important;\n        background-position: right 8px center !important;\n        background-size: 16px !important;\n      }\n\n      /* 滚动条 污染防护 */\n      .acu-wrapper::-webkit-scrollbar,\n      .acu-wrapper *::-webkit-scrollbar,\n      .acu-modal-container::-webkit-scrollbar,\n      .acu-modal-container *::-webkit-scrollbar {\n        width: 6px !important;\n        height: 6px !important;\n      }\n\n      .acu-wrapper::-webkit-scrollbar-track,\n      .acu-wrapper *::-webkit-scrollbar-track,\n      .acu-modal-container::-webkit-scrollbar-track,\n      .acu-modal-container *::-webkit-scrollbar-track {\n        background: transparent !important;\n        background-color: transparent !important;\n      }\n\n      .acu-wrapper::-webkit-scrollbar-thumb,\n      .acu-wrapper *::-webkit-scrollbar-thumb,\n      .acu-modal-container::-webkit-scrollbar-thumb,\n      .acu-modal-container *::-webkit-scrollbar-thumb {\n        background: var(--acu-border) !important;\n        background-color: var(--acu-border) !important;\n        background-image: none !important;\n        border-radius: 3px !important;\n        border: none !important;\n        box-shadow: none !important;\n      }\n\n      .acu-wrapper::-webkit-scrollbar-thumb:hover,\n      .acu-wrapper *::-webkit-scrollbar-thumb:hover,\n      .acu-modal-container::-webkit-scrollbar-thumb:hover,\n      .acu-modal-container *::-webkit-scrollbar-thumb:hover {\n        background: var(--acu-text-sub) !important;\n        background-color: var(--acu-text-sub) !important;\n      }\n\n      /* 文本元素 污染防护 - 必须同时重置 font-family */\n      /* 注意：font-size 不使用 !important，允许组件样式覆盖（如 .acu-global-time-primary { font-size: 1.4em }） */\n      .acu-wrapper,\n      .acu-wrapper p,\n      .acu-wrapper div,\n      .acu-wrapper span,\n      .acu-wrapper label,\n      .acu-wrapper li,\n      .acu-wrapper a,\n      .acu-wrapper button,\n      .acu-wrapper th,\n      .acu-wrapper td,\n      .acu-modal-container,\n      .acu-modal-container p,\n      .acu-modal-container div,\n      .acu-modal-container span,\n      .acu-modal-container label,\n      .acu-modal-container li,\n      .acu-modal-container a,\n      .acu-modal-container button,\n      .acu-modal-container th,\n      .acu-modal-container td {\n        font-family: var(--acu-font-family) !important;\n        font-size: var(--acu-font-size, 13px);\n        text-shadow: none !important;\n        line-height: 1.5;\n      }\n\n      /* 普通文本颜色 - 特定选择器 */\n      .acu-settings-label,\n      .acu-card-label,\n      .acu-grid-label,\n      .acu-full-label,\n      .acu-wrapper .acu-card-value,\n      .acu-wrapper .acu-grid-value,\n      .acu-modal-container .acu-modal-body {\n        color: var(--acu-text-main) !important;\n        font-size: var(--acu-font-size, 13px) !important;\n      }\n\n      /* 次要文本颜色 */\n      .acu-wrapper .hint,\n      .acu-wrapper .acu-text-sub,\n      .acu-modal-container .hint,\n      .acu-modal-container .acu-text-sub,\n      .acu-settings-label .hint {\n        color: var(--acu-text-sub) !important;\n        font-size: 11px !important;\n      }\n\n      /* 标题 - 使用 --acu-title-color 防止酒馆污染 */\n      .acu-wrapper h1,\n      .acu-wrapper h2,\n      .acu-wrapper h3,\n      .acu-wrapper h4,\n      .acu-wrapper h5,\n      .acu-wrapper h6,\n      .acu-modal-container h1,\n      .acu-modal-container h2,\n      .acu-modal-container h3,\n      .acu-modal-container h4,\n      .acu-modal-container h5,\n      .acu-modal-container h6 {\n        color: var(--acu-title-color) !important;\n        text-shadow: none !important;\n        font-weight: 600 !important;\n      }\n\n      /* 弹窗标题 - 使用 --acu-text-main */\n      .acu-settings-title,\n      .acu-modal-title {\n        color: var(--acu-text-main) !important;\n        text-shadow: none !important;\n        font-weight: 600 !important;\n      }\n\n      /* 面板标题和行标题 - 使用 --acu-title-color + 用户字体 */\n      .acu-panel-title,\n      .acu-editable-title,\n      .acu-card-label,\n      .acu-grid-label,\n      .acu-full-label {\n        color: var(--acu-title-color) !important;\n        font-family: var(--acu-font-family) !important;\n        text-shadow: none !important;\n        font-weight: 600 !important;\n      }\n\n      /* Tab 按钮 - 精确保护 */\n      .acu-tab-btn,\n      .acu-tab-btn span,\n      .acu-nav-btn,\n      .acu-action-btn {\n        font-family: var(--acu-font-family) !important;\n        font-size: var(--acu-font-size, 13px) !important;\n        text-shadow: none !important;\n      }\n\n\n      /* Tab 按钮字体 */\n      .acu-tab-btn,\n      .acu-nav-btn,\n      .acu-action-btn {\n        font-family: var(--acu-font-family) !important;\n        font-size: var(--acu-font-size, 13px) !important;\n        text-shadow: none !important;\n      }\n\n      /* 折叠栏标题 */\n      .acu-settings-section .acu-settings-title,\n      .acu-config-section h4,\n      .acu-collapse-header,\n      .acu-collapse-title,\n      summary {\n        font-family: var(--acu-font-family) !important;\n        font-size: var(--acu-font-size, 13px) !important;\n        color: var(--acu-text-main) !important;\n        text-shadow: none !important;\n      }\n\n      /* 图标字体保护 - Font Awesome 不应被覆盖 */\n      .acu-wrapper i.fa,\n      .acu-wrapper i.fas,\n      .acu-wrapper i.far,\n      .acu-wrapper i.fab,\n      .acu-wrapper .fa,\n      .acu-wrapper .fas,\n      .acu-wrapper .far,\n      .acu-wrapper .fab,\n      .acu-modal-container i.fa,\n      .acu-modal-container i.fas,\n      .acu-modal-container i.far,\n      .acu-modal-container i.fab,\n      .acu-modal-container .fa,\n      .acu-modal-container .fas,\n      .acu-modal-container .far,\n      .acu-modal-container .fab {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n      }\n    `;r.value.textContent=c},w=()=>{if(!l.value)return;const e=t.getFullInjectedCSS();l.value.textContent=e,console.info('[ACU Styles] Theme custom styles updated')},y=t=>{const o=a().querySelector('.acu-wrapper');if(!o)return;const n=t||e.config.theme||'retro';f.zG.forEach(e=>{o.classList.remove(`acu-theme-${e.id}`)}),o.classList.add(`acu-theme-${n}`),console.info(`[ACU Styles] Theme applied: ${n}`)},k=t=>{const o=a().querySelector('.acu-data-display');if(!o)return;const n=t||e.config.layout||'vertical';o.classList.remove('acu-layout-vertical','acu-layout-horizontal'),o.classList.add(`acu-layout-${n}`),console.info(`[ACU Styles] Layout applied: ${n}`)},C=t=>{const o=t||e.config.fontFamily||'default';(e=>{const t=s[e];if(!t||'default'===e||d.has(e))return;const o=a(),n=`acu-font-${e}`;if(o.getElementById(n))return void d.add(e);const r=o.createElement('link');r.id=n,r.rel='stylesheet',r.href=t,r.setAttribute('data-source','acu-visualizer-font'),o.head.appendChild(r),d.add(e)})(o),u(),console.info(`[ACU Styles] Font applied: ${o}`)},N=()=>{const e=a(),t=o.value;e.getElementById(`${b}-base-${t}`)?.remove(),e.getElementById(`${b}-dynamic-${t}`)?.remove(),e.getElementById(`${h}-${t}`)?.remove(),d.forEach(t=>{e.getElementById(`acu-font-${t}`)?.remove()}),d.clear(),e.getElementById(`${x}-${t}`)?.remove(),n.value=null,r.value=null,i.value=null,l.value=null,c.value=!1,console.info('[ACU Styles] Styles cleaned up')},V=()=>{c.value?console.info('[ACU Styles] Already initialized'):((()=>{const e=a(),t=`${b}-base-${o.value}`;if(e.getElementById(t))return console.info('[ACU Styles] Base styles already injected'),void(n.value=e.getElementById(t));const r=e.createElement('style');r.id=t,r.setAttribute('data-source','acu-visualizer'),r.textContent='/*! tailwindcss v4.2.0 | MIT License | https://tailwindcss.com */@import "https://fontsapi.zeoseven.com/69/main/result.css";@import "https://fontsapi.zeoseven.com/3/main/result.css";@import "https://fontsapi.zeoseven.com/442/main/result.css";@import "https://fontsapi.zeoseven.com/256/main/result.css";@import "https://fontsapi.zeoseven.com/482/main/result.css";@import "https://fontsapi.zeoseven.com/446/main/result.css";@import "https://fontsapi.zeoseven.com/570/main/result.css";@import "https://fontsapi.zeoseven.com/292/main/result.css";@import "https://fontsapi.zeoseven.com/7/main/result.css";:root{--acu-neutral-50:#fafafa;--acu-neutral-100:#f5f5f5;--acu-neutral-200:#eeeeee;--acu-neutral-300:#e0e0e0;--acu-neutral-400:#bdbdbd;--acu-neutral-500:#9e9e9e;--acu-neutral-600:#757575;--acu-neutral-700:#616161;--acu-neutral-800:#424242;--acu-neutral-900:#212121;--acu-success:#27ae60;--acu-warning:#f39c12;--acu-danger:#e74c3c;--acu-info:#3498db;--acu-z-ball:2147483646;--acu-z-overlay:2147483647;--acu-z-menu:2147483648;--acu-radius-sm:6px;--acu-radius-md:12px;--acu-radius-lg:16px;--acu-shadow-sm:0 2px 8px rgba(0,0,0,0.1);--acu-shadow-md:0 4px 16px rgba(0,0,0,0.15);--acu-shadow-lg:0 15px 50px rgba(0,0,0,0.3);--acu-transition-fast:0.15s;--acu-transition-normal:0.3s;--acu-transition-slow:0.5s}.acu-wrapper,.acu-theme-retro{--acu-bg-nav:#e6e2d3;--acu-bg-panel:#e6e2d3;--acu-card-bg:#fffef9;--acu-table-head:#efebe4;--acu-table-hover:#f0ebe0;--acu-badge-bg:#efebe4;--acu-input-bg:rgba(255,255,255,0.5);--acu-menu-bg:#fff;--acu-overlay-bg:rgba(94,75,53,0.4);--acu-text-main:#5e4b35;--acu-text-sub:#999;--acu-menu-text:#333;--acu-border:#dcd0c0;--acu-btn-bg:#dcd0c0;--acu-btn-hover:#cbbba8;--acu-btn-active-bg:#8d7b6f;--acu-btn-active-text:#fdfaf5;--acu-shadow:rgba(0,0,0,0.1);--acu-card-width:280px;--acu-font-size:13px;--acu-highlight:#d35400;--acu-title-color-bg:rgba(211,84,0,0.08);--acu-title-color:#d35400;--acu-accent:#d35400;--acu-nav-cols:repeat(auto-fill,minmax(90px,1fr));--acu-text-max-height:80px;--acu-text-overflow:auto;--acu-win-width:400px;--acu-win-left:100px;--acu-win-bottom:100px}.acu-theme-dark{--acu-bg-nav:rgba(43,43,43,0.95);--acu-bg-panel:rgba(37,37,37,0.95);--acu-border:#444;--acu-text-main:#eee;--acu-text-sub:#aaa;--acu-btn-bg:rgba(58,58,58,0.5);--acu-btn-hover:#4a4a4a;--acu-btn-active-bg:#6a5acd;--acu-btn-active-text:#fff;--acu-table-head:rgba(51,51,51,0.8);--acu-table-hover:rgba(58,58,58,0.5);--acu-shadow:rgba(0,0,0,0.6);--acu-card-bg:rgba(45,48,53,0.8);--acu-badge-bg:#3a3f4b;--acu-menu-bg:#333;--acu-menu-text:#eee;--acu-input-bg:rgba(0,0,0,0.3);--acu-overlay-bg:rgba(0,0,0,0.75)}.acu-theme-modern{--acu-bg-nav:#ffffff;--acu-bg-panel:#f8f9fa;--acu-border:#e0e0e0;--acu-text-main:#333;--acu-text-sub:#888;--acu-btn-bg:#f1f3f5;--acu-btn-hover:#e9ecef;--acu-btn-active-bg:#007bff;--acu-btn-active-text:#fff;--acu-table-head:#f8f9fa;--acu-table-hover:#f1f3f5;--acu-shadow:rgba(0,0,0,0.08);--acu-card-bg:#ffffff;--acu-badge-bg:#f1f3f5;--acu-menu-bg:#fff;--acu-menu-text:#333;--acu-input-bg:#ffffff;--acu-overlay-bg:rgba(0,0,0,0.3)}.acu-theme-forest{--acu-bg-nav:#e8f5e9;--acu-bg-panel:#e8f5e9;--acu-border:#c8e6c9;--acu-text-main:#2e7d32;--acu-text-sub:#81c784;--acu-btn-bg:#c8e6c9;--acu-btn-hover:#a5d6a7;--acu-btn-active-bg:#43a047;--acu-btn-active-text:#fff;--acu-table-head:#dcedc8;--acu-table-hover:#f1f8e9;--acu-shadow:rgba(0,0,0,0.1);--acu-card-bg:#ffffff;--acu-badge-bg:#dcedc8;--acu-menu-bg:#fff;--acu-menu-text:#2e7d32;--acu-input-bg:rgba(255,255,255,0.7);--acu-overlay-bg:rgba(46,125,50,0.2)}.acu-theme-ocean{--acu-bg-nav:#e3f2fd;--acu-bg-panel:#e3f2fd;--acu-border:#bbdefb;--acu-text-main:#1565c0;--acu-text-sub:#64b5f6;--acu-btn-bg:#bbdefb;--acu-btn-hover:#90caf9;--acu-btn-active-bg:#1976d2;--acu-btn-active-text:#fff;--acu-table-head:#bbdefb;--acu-table-hover:#e1f5fe;--acu-shadow:rgba(0,0,0,0.15);--acu-card-bg:#ffffff;--acu-badge-bg:#e3f2fd;--acu-menu-bg:#fff;--acu-menu-text:#1565c0;--acu-input-bg:rgba(255,255,255,0.7);--acu-overlay-bg:rgba(21,101,192,0.2)}.acu-theme-cyber{--acu-bg-nav:#000000;--acu-bg-panel:#0a0a0a;--acu-border:#333;--acu-text-main:#00ffcc;--acu-text-sub:#ff00ff;--acu-btn-bg:#1a1a1a;--acu-btn-hover:#333;--acu-btn-active-bg:#ff00ff;--acu-btn-active-text:#fff;--acu-table-head:#111;--acu-table-hover:#1a1a1a;--acu-shadow:0 0 10px rgba(0,255,204,0.3);--acu-card-bg:#050505;--acu-badge-bg:#222;--acu-menu-bg:#111;--acu-menu-text:#00ffcc;--acu-input-bg:#111;--acu-overlay-bg:rgba(0,0,0,0.85)}.acu-theme-purple{--acu-bg-nav:#ede7f6;--acu-bg-panel:#ede7f6;--acu-border:#d1c4e9;--acu-text-main:#4a148c;--acu-text-sub:#7b1fa2;--acu-btn-bg:#d1c4e9;--acu-btn-hover:#b39ddb;--acu-btn-active-bg:#7b1fa2;--acu-btn-active-text:#fff;--acu-table-head:#f5f0fa;--acu-table-hover:#f3e5f5;--acu-shadow:rgba(74,20,140,0.1);--acu-card-bg:#faf8fc;--acu-badge-bg:#f5f0fa;--acu-menu-bg:#faf8fc;--acu-menu-text:#4a148c;--acu-input-bg:rgba(255,255,255,0.8);--acu-overlay-bg:rgba(74,20,140,0.3)}.acu-wrapper[data-font=hanchan]{--acu-font-family:\'HanChanQuanYuan\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=maple]{--acu-font-family:\'Maple Mono\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=huiwen]{--acu-font-family:\'Huiwen-mincho\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=cooper]{--acu-font-family:\'Cooper Zhengkai\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=yffyt]{--acu-font-family:\'YFFYT\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=fusion]{--acu-font-family:\'Fusion Pixel 12px M latin\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=lxgw]{--acu-font-family:\'LXGW WenKai\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=siyuan]{--acu-font-family:\'Source Han Sans SC\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=zhuque]{--acu-font-family:\'Zhuque Fangsong (technical preview)\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-font-hanchan{--acu-font-family:\'HanChanQuanYuan\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-font-maple{--acu-font-family:\'Maple Mono\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-font-huiwen{--acu-font-family:\'Huiwen-mincho\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-font-cooper{--acu-font-family:\'Cooper Zhengkai\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-font-yffyt{--acu-font-family:\'YFFYT\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-font-fusion{--acu-font-family:\'Fusion Pixel 12px M latin\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-font-lxgw{--acu-font-family:\'LXGW WenKai\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-font-siyuan{--acu-font-family:\'Source Han Sans SC\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-font-zhuque{--acu-font-family:\'Zhuque Fangsong (technical preview)\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper,.acu-wrapper *,.acu-modal-container,.acu-modal-container *,#acu-ghost-preview{font-family:var(--acu-font-family,Source Han Sans SC,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif)}.acu-text-xs{font-size:11px}.acu-text-sm{font-size:12px}.acu-text-base{font-size:13px}.acu-text-md{font-size:14px}.acu-text-lg{font-size:15px}.acu-text-xl{font-size:16px}.acu-text-2xl{font-size:18px}.acu-text-3xl{font-size:20px}.acu-font-normal{font-weight:400}.acu-font-medium{font-weight:500}.acu-font-semibold{font-weight:600}.acu-font-bold{font-weight:700}.acu-font-extrabold{font-weight:800}.acu-title{font-weight:700;color:var(--acu-title-color);line-height:1.35}.acu-wrapper[data-font=fusion],.acu-font-fusion{-webkit-font-smoothing:none;-moz-osx-font-smoothing:unset;font-smooth:never;text-rendering:optimizeSpeed}.acu-wrapper,.acu-modal-container{color:var(--acu-text-main) !important;text-shadow:none !important}.acu-wrapper p,.acu-wrapper div,.acu-wrapper span,.acu-wrapper label,.acu-wrapper li,.acu-wrapper a,.acu-wrapper th,.acu-wrapper td,.acu-wrapper dt,.acu-wrapper dd,.acu-wrapper figcaption,.acu-wrapper legend,.acu-wrapper summary,.acu-modal-container p,.acu-modal-container div,.acu-modal-container span,.acu-modal-container label,.acu-modal-container li,.acu-modal-container a,.acu-modal-container th,.acu-modal-container td,.acu-modal-container dt,.acu-modal-container dd,.acu-modal-container figcaption,.acu-modal-container legend,.acu-modal-container summary{color:var(--acu-text-main) !important;text-shadow:none !important}.acu-wrapper h1,.acu-wrapper h2,.acu-wrapper h3,.acu-wrapper h4,.acu-wrapper h5,.acu-wrapper h6,.acu-modal-container h1,.acu-modal-container h2,.acu-modal-container h3,.acu-modal-container h4,.acu-modal-container h5,.acu-modal-container h6{color:var(--acu-title-color) !important;text-shadow:none !important;font-weight:600}.acu-wrapper .acu-card-label,.acu-wrapper .acu-grid-label,.acu-wrapper .acu-full-label,.acu-wrapper .acu-panel-title,.acu-wrapper .acu-editable-title,.acu-modal-container .acu-card-label,.acu-modal-container .acu-grid-label,.acu-modal-container .acu-full-label,.acu-modal-container .acu-panel-title,.acu-modal-container .acu-editable-title{color:var(--acu-title-color) !important;text-shadow:none !important;font-weight:600}.acu-wrapper .acu-modal-title,.acu-wrapper .acu-settings-title,.acu-modal-container .acu-modal-title,.acu-modal-container .acu-settings-title{color:var(--acu-text-main) !important;text-shadow:none !important;font-weight:600}.acu-wrapper .hint,.acu-wrapper .acu-text-sub,.acu-wrapper .acu-settings-label .hint,.acu-modal-container .hint,.acu-modal-container .acu-text-sub,.acu-modal-container .acu-settings-label .hint{color:var(--acu-text-sub) !important;font-size:11px}:where(.acu-wrapper,.acu-modal-container) input,:where(.acu-wrapper,.acu-modal-container) select,:where(.acu-wrapper,.acu-modal-container) textarea{background:var(--acu-card-bg) !important;background-color:var(--acu-card-bg) !important;background-image:none !important;border:1px solid var(--acu-border) !important;border-radius:6px !important;font-family:inherit !important;font-size:inherit !important;color:var(--acu-text-main) !important;text-shadow:none !important;box-shadow:none !important;backdrop-filter:none !important;filter:none !important;transition:border-color .2s ease !important}:where(.acu-wrapper,.acu-modal-container) input:hover,:where(.acu-wrapper,.acu-modal-container) input:focus,:where(.acu-wrapper,.acu-modal-container) select:hover,:where(.acu-wrapper,.acu-modal-container) select:focus,:where(.acu-wrapper,.acu-modal-container) textarea:hover,:where(.acu-wrapper,.acu-modal-container) textarea:focus{background:var(--acu-card-bg) !important;background-color:var(--acu-card-bg) !important;background-image:none !important;border-color:var(--acu-title-color) !important;box-shadow:0 0 0 2px rgba(var(--acu-title-color-rgb,52,152,219),0.15) !important;outline:none !important}:where(.acu-wrapper,.acu-modal-container) input::placeholder,:where(.acu-wrapper,.acu-modal-container) select::placeholder,:where(.acu-wrapper,.acu-modal-container) textarea::placeholder{color:var(--acu-text-sub) !important;opacity:.6 !important;font-family:inherit !important;font-weight:normal !important;font-style:normal !important}:where(.acu-wrapper,.acu-modal-container) button{background:var(--acu-btn-bg) !important;background-color:var(--acu-btn-bg) !important;background-image:none !important;border:1px solid rgba(0,0,0,0) !important;border-radius:6px !important;font-family:inherit !important;font-size:inherit !important;color:var(--acu-text-main) !important;text-shadow:none !important;box-shadow:none !important;backdrop-filter:none !important;-webkit-backdrop-filter:none !important;filter:none !important;cursor:pointer !important;transition:all .2s ease !important}:where(.acu-wrapper,.acu-modal-container) button:hover{background:var(--acu-btn-hover) !important;background-color:var(--acu-btn-hover) !important;background-image:none !important;backdrop-filter:none !important;-webkit-backdrop-filter:none !important}:where(.acu-wrapper,.acu-modal-container) button:focus{outline:none !important;box-shadow:0 0 0 2px rgba(var(--acu-title-color-rgb,52,152,219),0.15) !important}:where(.acu-wrapper,.acu-modal-container) button:disabled{opacity:.5 !important;cursor:not-allowed !important}:where(.acu-wrapper,.acu-modal-container) input[type=range]{-webkit-appearance:none !important;appearance:none !important;background:rgba(0,0,0,0) !important;background-color:rgba(0,0,0,0) !important;background-image:none !important;border:none !important;box-shadow:none !important;height:20px !important}:where(.acu-wrapper,.acu-modal-container) input[type=range]::-webkit-slider-thumb{-webkit-appearance:none !important;appearance:none !important;width:16px !important;height:16px !important;background:var(--acu-title-color) !important;background-color:var(--acu-title-color) !important;background-image:none !important;border-radius:50% !important;border:none !important;margin-top:-5px !important;cursor:pointer !important;box-shadow:0 1px 3px rgba(0,0,0,.2) !important}:where(.acu-wrapper,.acu-modal-container) input[type=range]::-webkit-slider-runnable-track{-webkit-appearance:none !important;width:100% !important;height:6px !important;background:var(--acu-border) !important;background-color:var(--acu-border) !important;background-image:none !important;border-radius:3px !important;border:none !important;cursor:pointer !important;box-shadow:none !important}:where(.acu-wrapper,.acu-modal-container) input[type=range]::-moz-range-thumb{-moz-appearance:none !important;width:16px !important;height:16px !important;background:var(--acu-title-color) !important;background-color:var(--acu-title-color) !important;background-image:none !important;border-radius:50% !important;border:none !important;cursor:pointer !important;box-shadow:0 1px 3px rgba(0,0,0,.2) !important}:where(.acu-wrapper,.acu-modal-container) input[type=range]::-moz-range-track{-moz-appearance:none !important;width:100% !important;height:6px !important;background:var(--acu-border) !important;background-color:var(--acu-border) !important;background-image:none !important;border-radius:3px !important;border:none !important;cursor:pointer !important;box-shadow:none !important}:where(.acu-wrapper,.acu-modal-container) select{-webkit-appearance:none !important;appearance:none !important;padding-right:30px !important;background-image:url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23666\'%3E%3Cpath d=\'M7 10l5 5 5-5z\'/%3E%3C/svg%3E") !important;background-repeat:no-repeat !important;background-position:right 8px center !important;background-size:16px !important}:where(.acu-wrapper,.acu-modal-container) code,:where(.acu-wrapper,.acu-modal-container) pre{font-family:inherit !important;background:rgba(0,0,0,0) !important;background-color:rgba(0,0,0,0) !important;border:none !important;box-shadow:none !important;padding:0 !important;margin:0 !important;color:inherit !important;text-shadow:none !important;backdrop-filter:none !important;-webkit-backdrop-filter:none !important}:where(.acu-wrapper,.acu-modal-container) code *,:where(.acu-wrapper,.acu-modal-container) pre *{color:inherit !important;background:rgba(0,0,0,0) !important;text-shadow:none !important}:where(.acu-wrapper,.acu-modal-container),:where(.acu-wrapper,.acu-modal-container) p,:where(.acu-wrapper,.acu-modal-container) div,:where(.acu-wrapper,.acu-modal-container) span,:where(.acu-wrapper,.acu-modal-container) label,:where(.acu-wrapper,.acu-modal-container) li,:where(.acu-wrapper,.acu-modal-container) a,:where(.acu-wrapper,.acu-modal-container) button,:where(.acu-wrapper,.acu-modal-container) input,:where(.acu-wrapper,.acu-modal-container) select,:where(.acu-wrapper,.acu-modal-container) textarea,:where(.acu-wrapper,.acu-modal-container) th,:where(.acu-wrapper,.acu-modal-container) td{font-family:var(--acu-font-family,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif) !important;font-size:inherit;line-height:1.5}:where(.acu-wrapper,.acu-modal-container) i.fa,:where(.acu-wrapper,.acu-modal-container) i.fas,:where(.acu-wrapper,.acu-modal-container) i.far,:where(.acu-wrapper,.acu-modal-container) i.fab,:where(.acu-wrapper,.acu-modal-container) i.fa-solid,:where(.acu-wrapper,.acu-modal-container) i.fa-regular,:where(.acu-wrapper,.acu-modal-container) i.fa-brands,:where(.acu-wrapper,.acu-modal-container) i.fa-light,:where(.acu-wrapper,.acu-modal-container) i.fa-thin,:where(.acu-wrapper,.acu-modal-container) i.fa-duotone,:where(.acu-wrapper,.acu-modal-container) .fa,:where(.acu-wrapper,.acu-modal-container) .fas,:where(.acu-wrapper,.acu-modal-container) .far,:where(.acu-wrapper,.acu-modal-container) .fab,:where(.acu-wrapper,.acu-modal-container) .fa-solid,:where(.acu-wrapper,.acu-modal-container) .fa-regular,:where(.acu-wrapper,.acu-modal-container) .fa-brands,:where(.acu-wrapper,.acu-modal-container) .fa-light,:where(.acu-wrapper,.acu-modal-container) .fa-thin,:where(.acu-wrapper,.acu-modal-container) .fa-duotone,:where(.acu-wrapper,.acu-modal-container) [class*=fa-]{font-family:"Font Awesome 6 Free","Font Awesome 6 Pro","Font Awesome 5 Free",FontAwesome !important;font-weight:900 !important;font-style:normal !important;font-variant:normal !important;line-height:1 !important;text-rendering:auto !important;-webkit-font-smoothing:antialiased !important;-moz-osx-font-smoothing:grayscale !important}:where(.acu-wrapper,.acu-modal-container) .far,:where(.acu-wrapper,.acu-modal-container) .fa-regular{font-weight:400 !important}:where(.acu-wrapper,.acu-modal-container) .fab,:where(.acu-wrapper,.acu-modal-container) .fa-brands{font-family:"Font Awesome 6 Brands","Font Awesome 5 Brands",FontAwesome !important;font-weight:400 !important}.acu-wrapper,.acu-modal-container,.acu-wrapper *,.acu-modal-container *{scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-wrapper::-webkit-scrollbar,.acu-modal-container::-webkit-scrollbar,.acu-wrapper *::-webkit-scrollbar,.acu-modal-container *::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-wrapper::-webkit-scrollbar-track,.acu-modal-container::-webkit-scrollbar-track,.acu-wrapper *::-webkit-scrollbar-track,.acu-modal-container *::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important;background-color:rgba(0,0,0,0) !important}.acu-wrapper::-webkit-scrollbar-thumb,.acu-modal-container::-webkit-scrollbar-thumb,.acu-wrapper *::-webkit-scrollbar-thumb,.acu-modal-container *::-webkit-scrollbar-thumb{background:var(--acu-border) !important;background-color:var(--acu-border) !important;background-image:none !important;border-radius:3px !important;border:none !important;box-shadow:none !important}.acu-wrapper::-webkit-scrollbar-thumb:hover,.acu-modal-container::-webkit-scrollbar-thumb:hover,.acu-wrapper *::-webkit-scrollbar-thumb:hover,.acu-modal-container *::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important;background-color:var(--acu-text-sub) !important}.acu-wrapper::-webkit-scrollbar-corner,.acu-modal-container::-webkit-scrollbar-corner,.acu-wrapper *::-webkit-scrollbar-corner,.acu-modal-container *::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-wrapper,.acu-wrapper *,.acu-wrapper *::before,.acu-wrapper *::after{box-sizing:border-box}.acu-wrapper{font-family:var(--acu-font-family,Source Han Sans SC,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif);font-size:var(--acu-font-size,13px);color:var(--acu-text-main);line-height:1.5;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.acu-wrapper{scrollbar-width:thin !important;scrollbar-color:var(--acu-title-color,var(--acu-border)) rgba(0,0,0,0) !important}.acu-wrapper::-webkit-scrollbar,.acu-wrapper *::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-wrapper::-webkit-scrollbar-track,.acu-wrapper *::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-wrapper::-webkit-scrollbar-thumb,.acu-wrapper *::-webkit-scrollbar-thumb{background:var(--acu-border) !important;border-radius:3px !important}.acu-wrapper::-webkit-scrollbar-thumb:hover,.acu-wrapper *::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important}.acu-wrapper::-webkit-scrollbar-corner,.acu-wrapper *::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-wrapper *{scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-panel-content{scrollbar-width:thin !important;scrollbar-color:var(--acu-title-color) rgba(0,0,0,0) !important}.acu-panel-content::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-panel-content::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-panel-content::-webkit-scrollbar-thumb{background-color:var(--acu-title-color) !important;border-radius:3px !important}.acu-panel-content::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-modal-container{scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-modal-container::-webkit-scrollbar,.acu-modal-container *::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-modal-container::-webkit-scrollbar-track,.acu-modal-container *::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-modal-container::-webkit-scrollbar-thumb,.acu-modal-container *::-webkit-scrollbar-thumb{background:var(--acu-border) !important;border-radius:3px !important}.acu-modal-container::-webkit-scrollbar-thumb:hover,.acu-modal-container *::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important}.acu-modal-container::-webkit-scrollbar-corner,.acu-modal-container *::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-modal-container *{scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-wrapper ::selection{background:var(--acu-title-color);color:#fff}.acu-wrapper ::-moz-selection{background:var(--acu-title-color);color:#fff}#acu-parent-container{position:fixed !important;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;z-index:var(--acu-z-overlay);pointer-events:none !important;display:flex;flex-direction:column-reverse;justify-content:flex-start}#acu-parent-container .acu-wrapper{position:absolute !important;width:var(--acu-win-width,600px) !important;left:var(--acu-win-left,50%) !important;bottom:var(--acu-win-bottom,50%) !important;max-width:98vw;pointer-events:none;display:flex;flex-direction:column-reverse;transform-origin:bottom center;will-change:transform;transition:none !important;touch-action:none}.acu-hidden{display:none !important}.acu-grid-value,.acu-full-value,.acu-card-value,.acu-editable-title,.acu-grid-label,.acu-full-label,.acu-card-label{user-select:text !important;-webkit-user-select:text !important;cursor:text}.acu-app{font-family:var(--acu-font-family,"Microsoft YaHei",sans-serif);font-size:var(--acu-font-size,13px);color:var(--acu-text-main,#333);position:relative;z-index:2147483640}.acu-no-data{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 24px;color:var(--acu-text-muted,#999);text-align:center}.acu-no-data i{font-size:48px;margin-bottom:16px;opacity:.5}.acu-no-data p{margin:0;font-size:var(--acu-font-size,13px)}@keyframes acu-shake{0%,100%{transform:rotate(0deg)}25%{transform:rotate(10deg)}50%{transform:rotate(0deg)}75%{transform:rotate(-10deg)}}@keyframes acu-shake-x{0%,100%{transform:translateX(0)}10%,30%,50%,70%,90%{transform:translateX(-4px)}20%,40%,60%,80%{transform:translateX(4px)}}@keyframes acu-fade-in{from{opacity:0}to{opacity:1}}@keyframes acu-fade-out{from{opacity:1}to{opacity:0}}@keyframes acu-pop-up{from{opacity:0;transform:scale(0.9) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}@keyframes acu-pop-down{from{opacity:1;transform:scale(1) translateY(0)}to{opacity:0;transform:scale(0.9) translateY(10px)}}@keyframes acu-slide-in-right{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}@keyframes acu-slide-in-left{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}@keyframes acu-slide-in-up{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes acu-slide-in-down{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}@keyframes acu-spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}@keyframes acu-bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}.acu-animate-spin{animation:acu-spin 1s linear infinite}.acu-highlight-changed:not(.acu-data-card){color:var(--acu-title-color) !important;font-weight:bold}.acu-save-alert{animation:acu-shake .4s ease-in-out infinite;color:#fff !important;background-color:#e74c3c !important;text-shadow:0 0 5px rgba(231,76,60,.5);border-color:#c0392b !important}.acu-badge-pending{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-15deg);width:80px;height:80px;border:4px solid #e74c3c;border-radius:50%;color:#e74c3c;font-size:20px;font-weight:900;display:flex;align-items:center;justify-content:center;z-index:50;pointer-events:none;opacity:.6;box-shadow:inset 0 0 10px rgba(231,76,60,.2);background:hsla(0,0%,100%,.1)}.acu-wrapper{position:fixed;left:var(--acu-win-left,50%);bottom:var(--acu-win-bottom,50%);width:var(--acu-win-width,400px);transform:translate(-50%,50%);display:flex;flex-direction:column-reverse;z-index:2147483645;pointer-events:auto !important;max-height:100vh;max-height:calc(100vh - var(--acu-win-bottom,50%))}.acu-wrapper.collapsed{display:none}#acu-parent-container{position:fixed !important;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;z-index:2147483647;pointer-events:none !important;display:flex;flex-direction:column-reverse;justify-content:flex-start}#acu-parent-container .acu-wrapper{position:relative;max-width:100vw;pointer-events:auto !important;display:flex;flex-direction:column-reverse;transform-origin:bottom center;will-change:transform;transition:none !important}#acu-parent-container .acu-wrapper{position:absolute !important;width:min(var(--acu-win-width,600px),100vw) !important;left:var(--acu-win-left,50%) !important;bottom:var(--acu-win-bottom,50%) !important;transform:translate(-50%,50%);touch-action:none;max-height:calc(100vh - var(--acu-win-bottom,50%)) !important}.acu-wrapper.acu-centered-mode{bottom:auto !important;top:50vh !important;left:50vw !important;transform:translate(-50%,-50%) !important;max-height:none !important}.acu-wrapper.acu-centered-mode .acu-data-display{display:none !important}#acu-parent-container .acu-wrapper.acu-centered-mode{position:fixed !important;bottom:auto !important;top:50vh !important;left:50vw !important;transform:translate(-50%,-50%) !important;max-height:none !important}.acu-data-display{order:2;flex:1 1 auto;min-height:150px;margin-bottom:3px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:12px;position:relative;display:none;flex-direction:column;backdrop-filter:blur(8px);box-shadow:0 -5px 25px rgba(0,0,0,.3);width:100%;overscroll-behavior:contain;isolation:isolate;pointer-events:auto !important;overflow:clip}.acu-data-display.visible{display:flex}.acu-data-display.has-modal{z-index:100;overflow:visible !important}.acu-data-display.acu-layout-horizontal{touch-action:pan-x pan-y !important;overflow:clip}.acu-data-display.acu-layout-vertical{touch-action:pan-y !important;overflow:clip}.acu-panel-content{flex:1;display:flex;flex-direction:column;min-height:0;overflow:hidden;padding:0;scrollbar-width:thin;scrollbar-color:var(--acu-title-color) rgba(0,0,0,0)}.acu-panel-content::-webkit-scrollbar{width:6px;height:6px}.acu-panel-content::-webkit-scrollbar-thumb{background-color:var(--acu-title-color);border-radius:3px}.acu-panel-header{flex:0 0 auto;display:flex;justify-content:space-between;align-items:center;padding:4px 12px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);border-radius:12px 12px 0 0}.acu-panel-title{font-weight:bold;color:var(--acu-text-main);display:flex;align-items:center;gap:8px;white-space:nowrap;font-size:15px}.acu-header-actions{display:flex;align-items:center;gap:10px}.acu-resize-handle{display:block !important;pointer-events:auto !important;position:absolute;right:-12px;top:0;bottom:0;width:14px;cursor:ew-resize;z-index:2147483650;touch-action:none}.acu-resize-handle::after{content:"";position:absolute;left:0;top:0;bottom:0;width:2px;background:var(--acu-border);opacity:.3;transition:opacity .2s}.acu-resize-handle:hover::after{background:var(--acu-title-color);opacity:1;width:4px;left:0}@media (max-width:768px){.acu-resize-handle{display:none !important;pointer-events:none !important}}.acu-close-btn{background:none;border:none;color:var(--acu-text-sub);cursor:pointer;font-size:16px;padding:4px;transition:color .2s}.acu-close-btn:hover{color:#e74c3c}.acu-layout-horizontal .acu-panel-content{overflow:hidden !important;min-height:150px}.acu-data-display.acu-layout-horizontal{min-height:200px}.acu-data-display.acu-layout-horizontal.visible{display:flex;flex-direction:column}@media (max-width:768px){#acu-btn-pin{display:none !important}.acu-panel-header{padding:4px 10px !important;min-height:38px !important}.acu-panel-title{font-size:13px !important;margin-right:auto}.acu-search-input{height:28px !important;width:80px !important;font-size:12px !important}.acu-search-input:focus{width:120px !important}.acu-nav-container{padding:8px 6px !important;gap:0 !important}.acu-nav-separator{margin:1px 0 !important;opacity:.2}.acu-nav-tabs-area{gap:1px !important}.acu-nav-btn{padding:6px 2px !important;font-size:12px !important;min-height:32px !important}.acu-nav-actions-area{padding-top:2px !important;gap:8px !important;display:flex !important;width:100% !important}.acu-action-btn{width:auto !important;flex:1 !important;height:40px !important;border-radius:8px !important;background:var(--acu-btn-bg);margin:0 !important}.acu-action-btn i{font-size:18px !important}.acu-action-btn:active{background:var(--acu-btn-active-bg);color:#fff}}@media (max-width:700px){.acu-dash-container{grid-template-columns:1fr}}.acu-settings-modal{max-width:720px}.acu-settings-modal .acu-modal-body{padding:0}.acu-settings-section{padding:12px 16px}.acu-settings-section:first-child{padding-top:16px}.acu-settings-title{font-size:13px;font-weight:600;color:var(--acu-text-main);margin-bottom:8px;padding:0 4px;display:flex;align-items:center;gap:8px}.acu-settings-title i{color:var(--acu-text-main);font-size:14px}.acu-settings-group{padding:12px 16px;background:var(--acu-table-head);border-radius:12px;border:none}.acu-settings-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0}.acu-settings-row:not(:last-child){border-bottom:1px solid var(--acu-border)}.acu-settings-row.column{flex-direction:column;align-items:stretch;gap:8px}.acu-settings-row.column .acu-settings-label{width:100%}.acu-settings-row.column .acu-settings-control{width:100%}.acu-settings-label{font-size:13px;font-weight:600;color:var(--acu-text-main);display:flex;flex-direction:column;gap:2px}.acu-settings-label .hint{font-size:11px;font-weight:400;color:var(--acu-text-sub)}.acu-settings-control{display:flex;align-items:center;gap:8px}.acu-settings-control select{appearance:auto !important;-webkit-appearance:menulist !important;-moz-appearance:menulist !important;padding:8px 12px !important;background:var(--acu-btn-bg) !important;border:1px solid var(--acu-border) !important;border-radius:6px !important;color:var(--acu-text-main) !important;font-size:13px !important;font-family:inherit !important;cursor:pointer !important;outline:none !important;box-shadow:none !important;min-height:auto !important;height:auto !important;line-height:normal !important;margin:0 !important}.acu-settings-control select:focus{border-color:var(--acu-title-color) !important}.acu-settings-control select option{background:var(--acu-bg-panel) !important;color:var(--acu-text-main) !important}.acu-settings-control input[type=text],.acu-settings-control input[type=number]{padding:8px 12px !important;background:var(--acu-btn-bg) !important;border:1px solid var(--acu-border) !important;border-radius:6px !important;color:var(--acu-text-main) !important;font-size:13px !important;font-family:inherit !important;outline:none !important}.acu-settings-control input[type=text]:focus,.acu-settings-control input[type=number]:focus{border-color:var(--acu-title-color) !important}.acu-settings-control input[type=color]{width:32px !important;height:32px !important}.acu-settings-control input[type=range]{-webkit-appearance:none;appearance:none;height:6px;background:var(--acu-border);border-radius:3px;outline:none;cursor:pointer}.acu-settings-control input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:var(--acu-title-color);border-radius:50%;cursor:pointer;-webkit-transition:transform .2s;transition:transform .2s;filter:none !important}.acu-settings-control input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.2)}.acu-settings-control input[type=range]::-moz-range-thumb{width:16px;height:16px;background:var(--acu-title-color);border-radius:50%;border:none;cursor:pointer;filter:none !important}.acu-nav-row{cursor:pointer;transition:background .2s ease}.acu-nav-row:hover{background:var(--acu-table-hover)}.acu-nav-row:active{opacity:.8}.acu-nav-row .acu-settings-control i.fa-chevron-right{font-size:12px;color:var(--acu-text-sub)}.acu-modal-back{display:flex;align-items:center;justify-content:center;width:32px;height:32px;margin-right:8px;background:rgba(0,0,0,0);border:none;border-radius:6px;cursor:pointer;color:inherit;opacity:.7;transition:all .2s ease}.acu-modal-back:hover{opacity:1;background:var(--acu-hover-bg,rgba(255,255,255,0.1))}.acu-modal-title{font-size:16px;font-weight:bold}.acu-bottom-spacer{height:calc(30px + var(--acu-safe-area-bottom,50px));padding-bottom:var(--acu-safe-area-bottom,50px);width:100%;text-align:center;color:var(--acu-text-sub,#999);font-size:10px;display:flex;align-items:center;justify-content:center;opacity:.5;flex-shrink:0}.acu-floating-ball-vue{--ball-size:50px;--ball-border-color:#ffffff;--ball-border-color-rgba:rgba(255,255,255,0.4);--ball-bg-color:rgba(255,255,255,0.25);position:fixed;width:var(--ball-size);height:var(--ball-size);font-size:calc(var(--ball-size)*.4);background:var(--ball-bg-color);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:2px solid var(--ball-border-color-rgba);border-radius:50%;box-shadow:0 4px 15px rgba(0,0,0,.3);z-index:2147483647;display:flex;align-items:center;justify-content:center;cursor:pointer;touch-action:none;color:var(--acu-text-main,#333);-webkit-user-select:none;user-select:none;transition:all .3s cubic-bezier(0.18,0.89,0.32,1.28);pointer-events:auto !important;overflow:visible;box-sizing:border-box}.acu-floating-ball-vue i{display:flex;align-items:center;justify-content:center;width:100%;height:100%;line-height:1;position:relative;z-index:2}.acu-floating-ball-vue .ball-emoji{display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:calc(var(--ball-size)*.46);position:relative;z-index:2}.acu-floating-ball-vue img{width:100%;height:100%;object-fit:cover;border-radius:50%;pointer-events:none;position:relative;z-index:2}.acu-floating-ball-vue .ball-image{width:100%;height:100%;border-radius:50%;pointer-events:none;position:relative;z-index:2}.acu-floating-ball-vue .ball-image.ball-image-invert{filter:invert(1)}.acu-floating-ball-vue:active{transform:scale(0.9);background:var(--ball-bg-color);filter:brightness(1.2)}.acu-floating-ball-vue.has-issues{animation:pulse-warning 1.5s ease-in-out infinite;border-color:rgba(245,108,108,.6);box-shadow:0 4px 15px rgba(245,108,108,.4)}.acu-floating-ball-vue.has-issues .acu-issue-badge{position:absolute;top:-4px;right:-4px;width:18px;height:18px;background:#f56c6c;border-radius:50%;font-size:12px;font-weight:bold;color:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(245,108,108,.5);animation:badge-bounce 1s ease-in-out infinite}.acu-floating-ball-vue.has-issues:hover{box-shadow:0 6px 20px rgba(245,108,108,.5)}.acu-floating-ball-vue.docked{left:0 !important;width:20px !important;height:50px !important;border-radius:0 8px 8px 0 !important;opacity:.3;background:#000;border:1px solid #666;border-left:none;font-size:0 !important;transform:none !important}.acu-floating-ball-vue.docked::after{content:"›";color:#fff;font-size:16px;font-weight:bold;display:block}.acu-floating-ball-vue.docked:hover,.acu-floating-ball-vue.docked:active{opacity:.8;width:30px !important}.acu-floating-ball-vue.docked .acu-issue-badge{display:none}@keyframes pulse-warning{0%,100%{box-shadow:0 4px 15px rgba(245,108,108,.4),0 0 0 0 rgba(245,108,108,.4)}50%{box-shadow:0 4px 15px rgba(245,108,108,.4),0 0 0 10px rgba(245,108,108,0)}}@keyframes badge-bounce{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}@keyframes acu-notify-ripple-1{0%{transform:scale(1);opacity:.8}100%{transform:scale(2.5);opacity:0}}@keyframes acu-notify-ripple-2{0%{transform:scale(1);opacity:.6}100%{transform:scale(2.2);opacity:0}}@keyframes acu-notify-ripple-3{0%{transform:scale(1);opacity:.4}100%{transform:scale(1.9);opacity:0}}.acu-floating-ball-vue.ai-notify.anim-ripple{border-color:var(--ball-border-color-rgba);animation:acu-notify-glow 2s infinite ease-in-out}.acu-floating-ball-vue.ai-notify.anim-ripple::before,.acu-floating-ball-vue.ai-notify.anim-ripple::after{content:"";position:absolute;top:-2px;left:-2px;right:-2px;bottom:-2px;border-radius:50%;border:2px solid var(--ball-border-color,#90cdf4);animation:acu-notify-ripple-1 1.5s ease-out infinite;pointer-events:none}.acu-floating-ball-vue.ai-notify.anim-ripple::after{animation:acu-notify-ripple-2 1.5s ease-out .5s infinite}@keyframes acu-arc-rotate{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes acu-arc-flash-1{0%,90%,100%{opacity:0}92%,95%{opacity:1}}@keyframes acu-arc-flash-2{0%,80%,100%{opacity:0}82%,88%{opacity:1}}.acu-floating-ball-vue.ai-notify.anim-arc{border-color:var(--ball-border-color-rgba)}.acu-floating-ball-vue.ai-notify.anim-arc::before{content:"";position:absolute;width:120%;height:120%;border-radius:50%;background:radial-gradient(circle at 20% 0%,var(--ball-border-color,#a29bfe) 0%,transparent 30%),radial-gradient(circle at 80% 100%,var(--ball-border-color,#a29bfe) 0%,transparent 30%);animation:acu-arc-rotate 1s linear infinite,acu-arc-flash-1 .3s ease infinite;opacity:.8;pointer-events:none}.acu-floating-ball-vue.ai-notify.anim-arc::after{content:"";position:absolute;width:130%;height:130%;border-radius:50%;background:radial-gradient(circle at 50% 0%,var(--ball-border-color,#74b9ff) 0%,transparent 25%),radial-gradient(circle at 50% 100%,var(--ball-border-color,#74b9ff) 0%,transparent 25%);animation:acu-arc-rotate 1.5s linear infinite reverse,acu-arc-flash-2 .5s ease infinite;opacity:.6;pointer-events:none}.acu-ball-preview{--ball-size:56px;--ball-border-color:#90cdf4;--ball-border-color-rgba:rgba(144,205,244,1);--ball-bg-color:rgba(43,43,43,1);width:var(--ball-size);height:var(--ball-size);font-size:calc(var(--ball-size)*.46);background:var(--ball-bg-color);border:2px solid var(--ball-border-color-rgba);border-radius:50%;display:flex;align-items:center;justify-content:center;position:relative;overflow:visible;box-sizing:border-box;transition:all .2s ease}.acu-ball-preview i{position:relative;z-index:2}.acu-ball-preview img{width:100%;height:100%;object-fit:cover;border-radius:50%;position:relative;z-index:2}.acu-ball-preview.p-anim-ripple{border-color:var(--ball-border-color-rgba);animation:acu-notify-glow 2s infinite ease-in-out}.acu-ball-preview.p-anim-ripple::before,.acu-ball-preview.p-anim-ripple::after{content:"";position:absolute;top:-2px;left:-2px;right:-2px;bottom:-2px;border-radius:50%;border:2px solid var(--ball-border-color);animation:acu-notify-ripple-1 1.5s ease-out infinite;pointer-events:none}.acu-ball-preview.p-anim-ripple::after{animation:acu-notify-ripple-2 1.5s ease-out .5s infinite}.acu-ball-preview.p-anim-arc{border-color:var(--ball-border-color-rgba)}.acu-ball-preview.p-anim-arc::before{content:"";position:absolute;width:120%;height:120%;border-radius:50%;background:radial-gradient(circle at 20% 0%,var(--ball-border-color) 0%,transparent 30%),radial-gradient(circle at 80% 100%,var(--ball-border-color) 0%,transparent 30%);animation:acu-arc-rotate 1s linear infinite,acu-arc-flash-1 .3s ease infinite;opacity:.8;pointer-events:none}.acu-ball-preview.p-anim-arc::after{content:"";position:absolute;width:130%;height:130%;border-radius:50%;background:radial-gradient(circle at 50% 0%,var(--ball-border-color) 0%,transparent 25%),radial-gradient(circle at 50% 100%,var(--ball-border-color) 0%,transparent 25%);animation:acu-arc-rotate 1.5s linear infinite reverse,acu-arc-flash-2 .5s ease infinite;opacity:.6;pointer-events:none}.acu-ball-preview.p-notify{animation:acu-notify-glow 2s infinite ease-in-out}@keyframes acu-notify-glow{0%,100%{box-shadow:0 0 5px var(--ball-border-color,#55efc4);border-color:var(--ball-border-color,#55efc4)}50%{box-shadow:0 0 25px var(--ball-border-color,#55efc4);border-color:var(--ball-border-color,#55efc4)}}.acu-tab-bar{width:100%}.acu-nav-container{position:relative;order:1;flex:0 0 auto;display:flex;flex-direction:column;gap:0;padding:6px 10px;background:var(--acu-bg-nav);border-top:1px solid var(--acu-border);border-radius:14px 14px 0 0;backdrop-filter:blur(5px);box-shadow:0 -4px 20px rgba(0,0,0,.2);transition:transform .2s;touch-action:pan-y;width:100%;pointer-events:auto !important;cursor:move;z-index:10}.acu-nav-container.editing-order .acu-nav-btn{border:1px dashed #f0ad4e;cursor:grab;opacity:.8}.acu-nav-tabs-area{display:grid;grid-template-columns:var(--acu-nav-cols,repeat(auto-fill,minmax(110px,1fr)));gap:3px;width:100%}.acu-nav-btn{width:100%;display:flex;align-items:center;justify-content:center;gap:6px;padding:5px 3px;border:1px solid rgba(0,0,0,0);border-radius:8px;background:var(--acu-btn-bg);color:var(--acu-text-main);font-weight:600;font-size:13px;cursor:pointer;transition:all .2s ease;-webkit-user-select:none;user-select:none;text-align:center;white-space:nowrap;overflow:hidden}.acu-nav-btn span{overflow:hidden;text-overflow:ellipsis}.acu-nav-btn:hover{background:var(--acu-btn-hover);transform:translateY(-2px)}.acu-nav-btn.active{background:var(--acu-btn-active-bg);color:var(--acu-btn-active-text);box-shadow:0 2px 6px rgba(0,0,0,.15)}.acu-nav-separator{width:100%;height:1px;border-top:1px dashed var(--acu-border);margin:5px 0;opacity:.6}.acu-nav-actions-area{position:relative;display:flex;width:100%;justify-content:space-between;align-items:stretch;background:rgba(0,0,0,0);padding-top:0;gap:8px}.acu-order-controls{display:none;width:100%;text-align:center;background:var(--acu-table-head);padding:5px;margin-bottom:5px;border-radius:4px;border:1px dashed var(--acu-border)}.acu-order-controls.visible{display:block}.acu-order-controls{font-size:12px;color:var(--acu-text-sub)}.acu-order-done-btn{background:var(--acu-btn-active-bg);color:var(--acu-btn-active-text);border:none;border-radius:4px;padding:2px 8px;margin-left:8px;cursor:pointer;font-size:12px;transition:all .2s}.acu-order-done-btn:hover{opacity:.9;transform:scale(1.05)}.acu-nav-btn.drag-handle{border:1px dashed #f0ad4e;cursor:grab;opacity:.8}.acu-nav-btn.drag-handle:active{cursor:grabbing}.acu-nav-btn.dragging{opacity:.5;border:2px solid var(--acu-title-color)}.acu-nav-btn.has-ai-changes{border:2px solid var(--acu-highlight-ai,#3498db)}.acu-nav-btn.has-ai-changes:hover{border-color:var(--acu-highlight-ai,#3498db)}.acu-nav-btn.has-ai-changes.active{border-color:var(--acu-highlight-ai,#3498db)}.acu-nav-btn.has-issues{border:2px solid #f56c6c;animation:tab-issue-pulse 2s ease-in-out infinite;position:relative}.acu-nav-btn.has-issues::before{content:"";position:absolute;top:-3px;right:-3px;width:8px;height:8px;background:#f56c6c;border-radius:50%;box-shadow:0 0 4px rgba(245,108,108,.6)}.acu-nav-btn.has-issues:hover{border-color:#f56c6c;box-shadow:0 2px 8px rgba(245,108,108,.3)}.acu-nav-btn.has-issues.active{border-color:#f56c6c;box-shadow:0 2px 10px rgba(245,108,108,.4)}@keyframes tab-issue-pulse{0%,100%{border-color:#f56c6c}50%{border-color:rgba(245,108,108,.4)}}.acu-action-btn{display:flex;align-items:center;justify-content:center;flex:1;min-width:36px;height:36px;border:1px solid var(--acu-border);border-radius:8px;background:var(--acu-btn-bg);color:var(--acu-text-main);font-size:14px;cursor:pointer;transition:all .2s ease}.acu-action-btn:hover{background:var(--acu-btn-hover);transform:translateY(-1px)}.acu-action-btn:active{transform:translateY(0)}.acu-action-btn.refreshing i{animation:acu-spin 1s linear infinite}.acu-action-btn.has-changes{animation:acu-pulse 1.5s ease-in-out infinite;border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-action-btn.acu-btn-danger{color:#e74c3c}.acu-action-btn.acu-btn-danger:hover{background:rgba(231,76,60,.1);border-color:#e74c3c}.acu-action-btn.acu-btn-toggle.active{background:var(--acu-btn-hover);color:var(--acu-title-color);border-color:var(--acu-title-color)}@keyframes acu-spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}@keyframes acu-pulse{0%,100%{box-shadow:0 0 0 0 rgba(var(--acu-title-color-rgb,211,84,0),0.4)}50%{box-shadow:0 0 0 8px rgba(var(--acu-title-color-rgb,211,84,0),0)}}.acu-data-card{background:var(--acu-card-bg);border:none;box-shadow:0 2px 8px var(--acu-shadow);border-radius:12px;transition:all .25s ease;display:flex;flex-direction:column;position:relative;-webkit-user-select:none;user-select:none;touch-action:pan-x pan-y;overflow-y:auto;overflow-x:hidden;overscroll-behavior:contain;scrollbar-width:thin;scrollbar-color:hsla(0,0%,100%,.2) rgba(0,0,0,0)}.acu-data-card::-webkit-scrollbar{width:4px;height:4px}.acu-data-card::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.acu-data-card::-webkit-scrollbar-thumb{background:hsla(0,0%,100%,.2);border-radius:2px;-webkit-transition:background .2s ease;transition:background .2s ease}.acu-data-card::-webkit-scrollbar-thumb:hover{background:hsla(0,0%,100%,.4)}.acu-data-card.acu-editing-lock{border-color:var(--acu-title-color) !important;box-shadow:0 0 0 1px var(--acu-title-color) !important;z-index:5;-webkit-user-select:text !important;user-select:text !important;touch-action:none !important}@keyframes acu-shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-4px)}75%{transform:translateX(4px)}}.acu-grid-value,.acu-full-value,.acu-card-value,.acu-editable-title,.acu-grid-label,.acu-full-label,.acu-card-label{user-select:text !important;-webkit-user-select:text !important;cursor:text}.acu-layout-vertical .acu-card-grid{display:flex;flex-wrap:wrap;justify-content:center;align-items:stretch;gap:14px}.acu-layout-vertical .acu-data-card{flex:0 0 var(--acu-card-width,280px);width:var(--acu-card-width,280px);height:auto;overflow-y:visible;overflow-x:visible;display:flex;flex-direction:column}.acu-layout-vertical .acu-data-card:hover{transform:translateY(-4px);box-shadow:0 8px 25px var(--acu-shadow);z-index:5}.acu-layout-horizontal .acu-card-grid{display:inline-flex;flex-wrap:nowrap;gap:14px;height:auto;align-items:flex-start;padding-bottom:10px;min-width:100%}.acu-layout-horizontal .acu-data-card{flex:0 0 var(--acu-card-width,280px);width:var(--acu-card-width,280px);height:-moz-fit-content;height:fit-content;max-height:98%;overflow-y:auto;white-space:normal;touch-action:pan-x pan-y !important}.acu-card-header{padding:10px 15px;background:rgba(0,0,0,0);border-bottom:1px solid rgba(0,0,0,.05);font-weight:bold;color:var(--acu-title-color);font-size:14px;display:flex;justify-content:center;align-items:center;position:relative;flex:0 0 auto}.acu-editable-title{cursor:pointer;border-bottom:1px dashed rgba(0,0,0,0);transition:all .2s;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:15px;font-weight:800;text-align:center;width:100%;padding:2px 5px;border-radius:4px;display:inline-flex;align-items:center;justify-content:center;gap:6px}.acu-editable-title:hover{background:var(--acu-table-hover);color:var(--acu-title-color)}.acu-editable-title.acu-title-locked{background:var(--acu-title-color-bg);border:1px solid var(--acu-title-color)}.acu-title-lock-icon{font-size:10px;opacity:.8;flex-shrink:0}.acu-title-editor{flex:1;min-width:0}.acu-title-editor textarea{width:100%;font-size:15px;font-weight:800;text-align:center;background:hsla(0,0%,100%,.15);border:1px solid var(--acu-title-color,#667eea);border-radius:4px;padding:4px 8px;color:var(--acu-title-color)}.acu-title-editor textarea:focus{outline:none;box-shadow:0 0 0 2px var(--acu-title-color-bg,rgba(102,126,234,0.2))}.acu-card-index{position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:10px;color:var(--acu-text-sub);font-weight:normal;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;opacity:.8}.acu-history-btns{position:absolute;right:8px;top:50%;transform:translateY(-50%);display:flex !important;flex-direction:row !important;flex-wrap:nowrap !important;align-items:center;gap:2px}.acu-row-lock-btn{position:absolute;right:10px;top:50%;transform:translateY(-50%);width:26px;height:26px;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:50%;color:var(--acu-text-sub);cursor:pointer;font-size:12px;transition:all .2s ease}.acu-row-lock-btn:hover{background:var(--acu-title-color-bg);color:var(--acu-title-color);border-color:var(--acu-title-color)}.acu-row-lock-btn.acu-row-locked{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color)}.acu-row-lock-btn.acu-row-locked:hover{background:var(--acu-title-color);filter:brightness(1.1)}.acu-card-body{padding:0;display:flex;flex-direction:column;gap:0;font-size:var(--acu-font-size,13px);flex:1}.acu-card-main-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:12px;flex:1}.acu-grid-item{display:flex;flex-direction:column;gap:2px;padding:5px;border-radius:6px;cursor:pointer;overflow:hidden}.acu-grid-item:hover{background:var(--acu-table-hover)}.acu-grid-label{font-size:11px;color:var(--acu-title-color);text-transform:uppercase;letter-spacing:.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-grid-value{font-size:var(--acu-font-size,13px);color:var(--acu-text-main);font-weight:500;white-space:pre-wrap;word-break:break-word;line-height:1.35}.acu-card-full-area{display:flex;flex-direction:column;gap:8px;padding:0 12px 10px 12px}.acu-full-item{display:flex;flex-direction:column;gap:3px;padding:6px;border-radius:6px;border-top:1px dashed rgba(0,0,0,.05);cursor:pointer}.acu-full-item:hover{background:var(--acu-table-hover)}.acu-full-label{font-size:11px;color:var(--acu-title-color);font-weight:bold}.acu-full-value{font-size:var(--acu-font-size,13px);color:var(--acu-text-main);line-height:1.4;word-break:break-all;white-space:pre-wrap;max-height:var(--acu-text-max-height,80px);overflow-y:var(--acu-text-overflow,auto);scrollbar-width:none}.acu-data-card.acu-style-list .acu-card-body{padding:6px 12px;display:flex;flex-direction:column;gap:0}.acu-data-card.acu-style-list .acu-card-row{display:block !important;padding:6px 0 !important;border-bottom:1px dashed var(--acu-border);cursor:pointer;overflow:hidden}.acu-data-card.acu-style-list .acu-card-row:last-child{border-bottom:none}.acu-data-card.acu-style-list .acu-card-row:hover{background:var(--acu-table-hover)}.acu-data-card.acu-style-list .acu-card-label{float:left !important;clear:left;width:auto !important;margin-right:8px !important;color:var(--acu-title-color);font-size:.9em;font-weight:bold;line-height:1.5}.acu-data-card.acu-style-list .acu-card-value{display:block !important;width:auto !important;margin:0 !important;text-align:left !important;word-break:break-all !important;white-space:pre-wrap !important;line-height:1.5 !important;color:var(--acu-text-main);max-height:var(--acu-text-max-height,80px);overflow-y:var(--acu-text-overflow,auto);scrollbar-width:none}.acu-data-card.acu-style-list .acu-card-value::-webkit-scrollbar{display:none}.acu-data-card.acu-style-list .acu-highlight-changed{display:inline-block;width:auto;line-height:1.4}.acu-cell-changed .acu-grid-value,.acu-cell-changed .acu-full-value,.acu-cell-changed .acu-card-value{font-weight:600}.acu-cell-changed-manual .acu-grid-value,.acu-cell-changed-manual .acu-full-value,.acu-cell-changed-manual .acu-card-value{color:var(--acu-highlight-manual,#d35400) !important;font-weight:600}.acu-cell-changed-ai .acu-grid-value,.acu-cell-changed-ai .acu-full-value,.acu-cell-changed-ai .acu-card-value{color:var(--acu-highlight-ai,#3498db) !important;font-weight:600}.acu-cell-locked{position:relative;background:rgba(231,76,60,.08) !important;border-left:3px solid #e74c3c !important}.acu-cell-locked::after{content:"";font-family:"Font Awesome 6 Free","Font Awesome 5 Free",FontAwesome;font-weight:900;position:absolute;top:4px;right:6px;font-size:10px;color:#e74c3c;opacity:.7;pointer-events:none}.acu-cell-locked .acu-grid-value,.acu-cell-locked .acu-full-value,.acu-cell-locked .acu-card-value{color:#c0392b !important}.acu-cell-locked .acu-grid-label,.acu-cell-locked .acu-full-label,.acu-cell-locked .acu-card-label{color:#e74c3c;font-weight:600}.acu-row-locked{background:rgba(231,76,60,.05) !important;border:1px solid rgba(231,76,60,.3) !important}.acu-row-locked .acu-card-header{background:rgba(231,76,60,.1);color:#c0392b}.acu-row-locked .acu-card-header::after{content:"已锁定";font-family:"Font Awesome 6 Free","Font Awesome 5 Free",FontAwesome,inherit;font-weight:600;font-size:11px;color:#e74c3c;margin-left:8px;opacity:.8}.acu-pull-overlay{display:flex;align-items:center;justify-content:center;overflow:hidden;width:100%;flex:0 0 auto;height:0;transition:height .1s linear}.acu-pull-top{background:rgba(46,204,113,.15);border-bottom:2px dashed #27ae60;color:#27ae60}.acu-pull-bottom{background:rgba(231,76,60,.15);border-top:2px dashed #c0392b;color:#c0392b}.acu-pull-restore{background:rgba(52,152,219,.15) !important;border-top:2px dashed #2980b9 !important;color:#2980b9 !important}.acu-pull-icon{display:flex;flex-direction:column;align-items:center;gap:5px;opacity:.8}.acu-pull-text{font-size:12px;opacity:.9}.acu-swipe-overlay{position:absolute;top:0;bottom:0;width:0;display:flex;align-items:center;justify-content:center;overflow:hidden;pointer-events:none;z-index:10;font-size:18px;font-weight:bold;transition:width .1s linear;white-space:nowrap}.acu-swipe-right{left:0;background:rgba(46,204,113,.2);border-right:2px dashed #27ae60;color:#27ae60}.acu-swipe-left{right:0;background:rgba(231,76,60,.2);border-left:2px dashed #c0392b;color:#c0392b}.acu-swipe-restore{background:rgba(52,152,219,.2) !important;border-left:2px dashed #2980b9 !important;color:#2980b9 !important}.acu-data-table{display:flex;flex-direction:column;flex:1;min-height:0;height:100%;gap:0}.acu-data-table.acu-table-loading{opacity:.6;pointer-events:none}.acu-table-toolbar{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--acu-table-head,rgba(0,0,0,0.03));border-bottom:1px solid var(--acu-border,rgba(0,0,0,0.06));border-radius:0;gap:12px;z-index:10;flex-shrink:0}.acu-toolbar-left{display:flex;align-items:center;gap:8px;flex-shrink:0;min-width:0}.acu-table-title{font-weight:600;font-size:calc(var(--acu-font-size,13px) + 1px);color:var(--acu-title-color,var(--acu-text-main,#333));white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-table-count{font-size:calc(var(--acu-font-size,13px) - 2px);color:var(--acu-text-muted,#999);white-space:nowrap}.acu-table-badge{font-size:11px;padding:2px 6px;border-radius:10px;white-space:nowrap}.acu-table-badge.acu-badge-changed{background:rgba(102,126,234,.15);color:var(--acu-title-color,#667eea)}.acu-table-badge.acu-badge-deleting{background:rgba(231,76,60,.15);color:var(--acu-danger,#e74c3c)}.acu-toolbar-right{display:flex;align-items:center;gap:8px;flex-shrink:0}.acu-icon-btn.acu-height-handle{cursor:ns-resize}.acu-icon-btn.acu-close-btn:hover{background:rgba(231,76,60,.1);color:var(--acu-danger,#e74c3c)}.acu-search-input.acu-search-inline{width:100px;padding:4px 8px;border:none;border-radius:var(--acu-radius-sm,4px);background:rgba(0,0,0,0);color:var(--acu-text-main,#333);font-size:calc(var(--acu-font-size,13px) - 1px);outline:none;transition:all .2s}.acu-search-input.acu-search-inline:focus{width:140px;background:var(--acu-btn-hover,rgba(0,0,0,0.05))}.acu-search-input.acu-search-inline::placeholder{color:var(--acu-text-muted,#999)}.acu-search-clear{color:var(--acu-text-muted,#999);cursor:pointer;font-size:11px;flex-shrink:0}.acu-search-clear:hover{color:var(--acu-text-main,#333)}.acu-cards-container{flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;overscroll-behavior:contain;padding:12px}.acu-cards-container.acu-view-card{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-content:flex-start;align-items:stretch}.acu-cards-container.acu-view-card>.acu-data-card{flex:0 0 var(--acu-card-width,280px);width:var(--acu-card-width,280px)}.acu-cards-container.acu-view-list{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-content:flex-start;align-items:stretch}.acu-cards-container.acu-view-list>.acu-data-card{flex:0 0 var(--acu-card-width,280px);width:var(--acu-card-width,280px)}.acu-layout-horizontal .acu-cards-container{flex:1 1 0;height:0;min-height:0;display:flex !important;flex-wrap:nowrap !important;gap:14px;align-items:flex-start;justify-content:flex-start;white-space:nowrap;overflow-x:auto !important;overflow-y:hidden !important;touch-action:pan-x pan-y !important;padding:12px;padding-bottom:8px;overscroll-behavior-x:contain}.acu-layout-horizontal .acu-cards-container.acu-view-card,.acu-layout-horizontal .acu-cards-container.acu-view-list{display:flex !important;flex-wrap:nowrap !important}.acu-layout-horizontal .acu-data-card{flex:0 0 var(--acu-card-width,280px) !important;width:var(--acu-card-width,280px) !important;min-width:var(--acu-card-width,280px);align-self:flex-start;height:-moz-fit-content;height:fit-content;max-height:calc(100% - 4px);overflow-y:auto;white-space:normal;touch-action:pan-x pan-y !important;display:flex !important}.acu-layout-horizontal .acu-data-table{height:100%;min-height:200px;display:flex;flex-direction:column;overflow:hidden}.acu-layout-horizontal .acu-table-toolbar{flex-shrink:0;position:relative;z-index:10}.acu-layout-horizontal .acu-pagination-container{flex-shrink:0;position:relative;z-index:10}.acu-layout-horizontal .acu-panel-content{overflow:hidden !important;min-height:150px}.acu-empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 24px;color:var(--acu-text-muted,#999);grid-column:1/-1}.acu-empty-state i{font-size:48px;margin-bottom:16px;opacity:.5}.acu-empty-state p{margin:0;font-size:var(--acu-font-size,13px)}.acu-pagination{display:flex;justify-content:center;align-items:center;gap:4px;padding:12px;flex-wrap:wrap}.acu-btn-page{min-width:32px;padding:4px 8px;font-size:calc(var(--acu-font-size,13px) - 1px)}.acu-btn-page.active{font-weight:600}.acu-page-ellipsis{padding:4px 8px;color:var(--acu-text-muted,#999)}.acu-modal-btn{padding:10px 24px;border:none;border-radius:8px;font-size:14px;font-weight:500;font-family:inherit;cursor:pointer;transition:all .2s ease}.acu-modal-btn.primary{background:var(--acu-title-color);color:#fff}.acu-modal-btn.primary:hover{filter:brightness(1.1);transform:translateY(-1px)}.acu-modal-btn.secondary{background:var(--acu-btn-bg);color:var(--acu-text-main);border:1px solid var(--acu-border)}.acu-modal-btn.secondary:hover{background:var(--acu-btn-hover)}.acu-modal-btn.danger{background:#e74c3c;color:#fff}.acu-modal-btn.danger:hover{background:#c0392b}.acu-modal-btn:disabled{opacity:.5;cursor:not-allowed;transform:none !important}.acu-action-btn{flex:1;height:36px;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border-radius:8px;color:var(--acu-text-sub);cursor:pointer;border:1px solid rgba(0,0,0,0);transition:all .2s;font-size:16px;font-family:inherit;-webkit-user-select:none;user-select:none}.acu-action-btn:hover{background:var(--acu-btn-hover);color:var(--acu-text-main);transform:translateY(-2px);border-color:var(--acu-border)}.acu-tool-btn{padding:6px 12px;font-size:12px;font-family:inherit;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);cursor:pointer;transition:all .2s ease;white-space:nowrap}.acu-tool-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color)}.acu-tool-btn.small{padding:4px 10px;font-size:11px}.acu-icon-btn{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0) !important;border:none;border-radius:4px;color:var(--acu-text-main) !important;opacity:1 !important;cursor:pointer;transition:all .2s}.acu-icon-btn i{color:inherit !important}.acu-icon-btn:hover{background:var(--acu-btn-hover) !important;color:var(--acu-title-color) !important;opacity:1 !important}.acu-icon-btn.active{background:var(--acu-title-color-bg) !important;color:var(--acu-title-color) !important;opacity:1 !important}#acu-btn-save-global{color:var(--acu-title-color)}#acu-btn-save-global:hover{background:var(--acu-btn-active-bg);color:var(--acu-btn-active-text)}#acu-btn-save-specific{color:#9b59b6;display:none}.acu-dialog-btn{background:none;border:none;cursor:pointer;font-size:14px;font-weight:bold;display:flex;align-items:center;gap:6px;color:var(--acu-text-sub);transition:color .2s}.acu-page-btn{padding:0;border:1px solid var(--acu-border);background:var(--acu-btn-bg);color:var(--acu-title-color);border-radius:6px;cursor:pointer;font-size:12px;min-width:32px;height:32px;display:flex;align-items:center;justify-content:center;transition:all .2s;-webkit-user-select:none;user-select:none;font-weight:500;flex-shrink:0}.acu-page-btn:not(.disabled):not(.active):hover{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color);transform:translateY(-2px);box-shadow:0 2px 5px rgba(0,0,0,.1)}.acu-page-btn.active{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color);font-weight:bold;cursor:default}.acu-page-btn.disabled{opacity:.5;cursor:not-allowed;background:var(--acu-text-sub)}.acu-page-arrow{width:36px;font-size:14px}.acu-tab-btn{padding:6px 12px;cursor:pointer;font-size:13px;font-weight:bold;color:var(--acu-text-sub);border-bottom:2px solid rgba(0,0,0,0);transition:all .2s}.acu-tab-btn:hover{color:var(--acu-text-main);background:var(--acu-table-hover);border-radius:4px 4px 0 0}.acu-tab-btn.active{color:var(--acu-title-color);border-bottom-color:var(--acu-title-color)}.acu-action-bar{display:flex;align-items:center;gap:4px;padding:4px}.acu-action-bar .acu-action-btn{flex:none;width:32px;height:32px;padding:0;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);cursor:pointer;border-radius:6px;transition:all .2s ease}.acu-action-bar .acu-action-btn:hover{background:var(--acu-hover-bg,rgba(255,255,255,0.1));color:var(--acu-text-main);transform:none;border-color:rgba(0,0,0,0)}.acu-action-bar .acu-action-btn:active{transform:scale(0.95)}.acu-action-bar .acu-action-btn.acu-btn-active{background:var(--acu-title-color-bg,rgba(52,152,219,0.2));color:var(--acu-title-color,#3498db);border-color:var(--acu-title-color)}.acu-action-bar .acu-action-btn i{font-size:14px}.acu-btn-danger{color:#e74c3c}.acu-btn-danger:hover{background:rgba(231,76,60,.2)}.acu-btn-toggle.active{background:var(--acu-title-color-bg,rgba(52,152,219,0.2)) !important;color:var(--acu-title-color,#3498db) !important;border:1px solid var(--acu-title-color,#3498db) !important;box-shadow:inset 0 0 0 1px rgba(52,152,219,.3)}.has-changes{color:#f39c12;animation:pulse 1.5s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}.acu-action-btn-wrapper{position:relative;display:flex;align-items:center;flex:1}.acu-action-bar .acu-action-btn-wrapper{flex:none}.has-secondary{position:relative}.secondary-indicator{position:absolute;top:2px;right:2px;width:6px;height:6px;background:var(--acu-primary-color,#3498db);border-radius:50%;pointer-events:none}.acu-popup-btn{position:absolute;top:100%;left:50%;transform:translateX(-50%);margin-top:4px;z-index:100;background:var(--acu-panel-bg,#2a2a2a) !important;border:1px solid var(--acu-primary-color,#3498db) !important;box-shadow:0 4px 12px rgba(0,0,0,.3)}.acu-popup-btn:hover{background:var(--acu-primary-color,#3498db) !important;color:#fff !important}.acu-btn-success{color:#27ae60 !important;background:rgba(39,174,96,.15) !important;border:1px solid rgba(39,174,96,.3) !important}.acu-btn-success:hover{background:rgba(39,174,96,.25) !important;color:#2ecc71 !important}.acu-icon-btn.acu-dual-icon{position:relative}.acu-icon-btn.acu-dual-icon .icon-secondary{position:absolute;bottom:0;right:0;font-size:8px;opacity:.9;background:var(--acu-card-bg);border-radius:50%;padding:2px;line-height:1;z-index:1}.acu-search-input{background:var(--acu-btn-bg);border:1px solid var(--acu-border);color:var(--acu-text-main);padding:2px 2px 3px 22px;border-radius:16px;font-size:12px;width:100px;transition:all .2s}.acu-search-input:focus{width:140px;outline:none;border-color:var(--acu-title-color);background:var(--acu-input-bg)}.acu-search-icon{position:absolute;left:10px;font-size:10px;color:var(--acu-text-sub);pointer-events:none}.acu-inline-editor{width:100%;position:relative;touch-action:manipulation}.acu-edit-textarea{width:100%;min-height:24px;padding:6px 8px;border:2px solid var(--acu-title-color,#667eea);border-radius:var(--acu-radius-sm,4px);background:var(--acu-input-bg,#fff);color:var(--acu-text-main,#333);font-size:var(--acu-font-size,13px);font-family:inherit;line-height:1.5;resize:none;outline:none;box-sizing:border-box;overflow:hidden;user-select:text !important;-webkit-user-select:text !important;touch-action:manipulation}.acu-edit-textarea:focus{box-shadow:0 0 0 3px var(--acu-title-color-bg,rgba(102,126,234,0.2))}.acu-textarea-scrollable{width:100%;min-height:24px;padding:6px 8px;border:2px solid var(--acu-title-color);border-radius:var(--acu-radius-sm);background:var(--acu-input-bg);color:var(--acu-text-main);font-size:var(--acu-font-size);font-family:inherit;line-height:1.5;outline:none;box-sizing:border-box;overflow-y:auto !important;resize:vertical;user-select:text !important;-webkit-user-select:text !important;touch-action:manipulation}.acu-textarea-scrollable:focus{box-shadow:0 0 0 3px var(--acu-title-color-bg)}.acu-editing-lock .acu-inline-editor{touch-action:manipulation}.acu-settings-input{background:var(--acu-input-bg);border:1px solid var(--acu-border);border-radius:6px;padding:8px 12px;color:var(--acu-text-main);font-size:14px;transition:border-color .2s}.acu-settings-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-range-input{-webkit-appearance:none;appearance:none;width:100%;height:6px;background:var(--acu-border);border-radius:3px;outline:none;cursor:pointer}.acu-range-input::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:var(--acu-title-color);border-radius:50%;cursor:pointer;-webkit-transition:transform .2s;transition:transform .2s}.acu-range-input::-webkit-slider-thumb:hover{transform:scale(1.2)}.acu-range-input::-webkit-slider-thumb{filter:none !important}.acu-range-input::-moz-range-thumb{width:16px;height:16px;background:var(--acu-title-color);border-radius:50%;border:none;cursor:pointer;filter:none !important}.acu-select{appearance:auto !important;-webkit-appearance:menulist !important;-moz-appearance:menulist !important;padding:8px 12px !important;background:var(--acu-btn-bg) !important;border:1px solid var(--acu-border) !important;border-radius:6px !important;color:var(--acu-text-main) !important;font-size:13px !important;font-weight:normal !important;font-family:inherit !important;cursor:pointer !important;text-align:center !important;text-align-last:center !important;width:auto !important;min-width:80px;outline:none !important;box-shadow:none !important;min-height:auto !important;height:auto !important;line-height:normal !important;margin:0 !important;transition:border-color .2s ease}.acu-select:focus{border-color:var(--acu-title-color) !important}.acu-select option{background:var(--acu-bg-panel) !important;color:var(--acu-text-main) !important;text-align:center}input[type=color]{width:32px;height:32px;padding:0;border:2px solid var(--acu-border) !important;border-radius:6px;cursor:pointer;background:rgba(0,0,0,0);flex-shrink:0;transition:all .2s ease}input[type=color]:hover{border-color:var(--acu-title-color);transform:scale(1.05)}input[type=color]::-webkit-color-swatch-wrapper{padding:2px}input[type=color]::-webkit-color-swatch{border-radius:3px;border:none}input[type=color]::-moz-color-swatch{border-radius:3px;border:none}input[type=color].acu-dashed{border-style:dashed !important}.acu-color-swatch{width:32px !important;height:32px !important}.acu-textarea{width:100%;padding:10px 12px;font-size:12px;line-height:1.5;background:var(--acu-table-head);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);resize:vertical;font-family:inherit}.acu-textarea:focus{outline:none;border-color:var(--acu-title-color)}.acu-textarea::placeholder{color:var(--acu-text-sub);opacity:.6}.acu-search-box{display:flex;align-items:center;gap:12px}.acu-search-input-wrapper{position:relative;display:flex;align-items:center;flex:1;max-width:300px;min-width:180px}.acu-search-box .acu-search-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--acu-text-sub,#999);font-size:14px;pointer-events:none;transition:color var(--acu-transition-fast,0.15s);z-index:1}.focused .acu-search-box .acu-search-icon{color:var(--acu-title-color,#d35400)}.acu-search-box .acu-search-input{width:100%;height:36px;padding:0 36px;border:1px solid var(--acu-border,#dcd0c0);border-radius:var(--acu-radius-md,12px);background:var(--acu-input-bg,rgba(255,255,255,0.5));color:var(--acu-text-main,#5e4b35);font-size:var(--acu-font-size,13px);outline:none;transition:border-color var(--acu-transition-fast,0.15s),box-shadow var(--acu-transition-fast,0.15s),background var(--acu-transition-fast,0.15s)}.acu-search-box .acu-search-input::placeholder{color:var(--acu-text-sub,#999);opacity:.7}.acu-search-box .acu-search-input:focus{border-color:var(--acu-title-color,#d35400);box-shadow:0 0 0 3px var(--acu-title-color-bg,rgba(211,84,0,0.08));background:var(--acu-card-bg,#fffef9)}.has-value .acu-search-box .acu-search-input{padding-right:40px}.acu-search-clear{position:absolute;right:8px;display:flex;align-items:center;justify-content:center;width:24px;height:24px;border:none;border-radius:50%;background:var(--acu-badge-bg,#efebe4);color:var(--acu-text-sub,#999);cursor:pointer;transition:background var(--acu-transition-fast,0.15s),color var(--acu-transition-fast,0.15s),transform var(--acu-transition-fast,0.15s)}.acu-search-clear i{font-size:12px}.acu-search-clear:hover{background:var(--acu-danger,#e74c3c);color:#fff;transform:scale(1.1)}.acu-search-clear:active{transform:scale(0.95)}.acu-search-result{font-size:.85em;color:var(--acu-text-sub,#999);white-space:nowrap}.acu-search-result strong{color:var(--acu-title-color,#d35400);font-weight:600}.acu-search-result .no-result{color:var(--acu-warning,#f39c12)}.acu-fade-enter-active,.acu-fade-leave-active{transition:opacity .15s ease,transform .15s ease}.acu-fade-enter-from,.acu-fade-leave-to{opacity:0;transform:scale(0.8)}.acu-fade-enter-to,.acu-fade-leave-from{opacity:1;transform:scale(1)}@media (max-width:480px){.acu-search-box{flex-direction:column;align-items:stretch;gap:8px}.acu-search-input-wrapper{max-width:none;min-width:auto}.acu-search-box .acu-search-input{height:40px}.acu-search-result{text-align:center;font-size:.8em}}@media screen and (max-width:768px){.acu-fix-ios-zoom .acu-search-input,.acu-fix-ios-zoom .acu-edit-textarea,.acu-fix-ios-zoom .acu-textarea-scrollable,.acu-fix-ios-zoom .acu-settings-input,.acu-fix-ios-zoom .acu-select,.acu-fix-ios-zoom .acu-textarea,.acu-fix-ios-zoom .acu-search-box .acu-search-input,.acu-fix-ios-zoom .acu-inline-editor textarea,.acu-fix-ios-zoom input,.acu-fix-ios-zoom select,.acu-fix-ios-zoom textarea{font-size:16px !important;line-height:1.4 !important}.acu-fix-ios-zoom .acu-search-input{width:120px}.acu-fix-ios-zoom .acu-search-input:focus{width:160px}}.acu-switch{position:relative;display:inline-flex;align-items:center;width:44px;height:24px;cursor:pointer;flex-shrink:0}.acu-switch input[type=checkbox]{opacity:0;width:0;height:0;position:absolute;pointer-events:none}.acu-switch .slider,.acu-switch .acu-switch-slider{position:absolute;inset:0;background:var(--acu-btn-bg);border:none;border-radius:12px;transition:background .2s ease}.acu-switch .slider::after,.acu-switch .acu-switch-slider::after{content:"";position:absolute;top:50%;left:2px;transform:translateY(-50%);width:20px;height:20px;background:var(--acu-text-sub);border:none;border-radius:50%;transition:all .2s ease;box-shadow:0 1px 3px rgba(0,0,0,.15)}.acu-switch input[type=checkbox]:checked+.slider,.acu-switch input[type=checkbox]:checked+.acu-switch-slider{background:var(--acu-title-color)}.acu-switch input[type=checkbox]:checked+.slider::after,.acu-switch input[type=checkbox]:checked+.acu-switch-slider::after{left:calc(100% - 22px);background:#fff}.acu-switch:hover .slider,.acu-switch:hover .acu-switch-slider{opacity:.85}.acu-switch:not(:has(input)){background:var(--acu-btn-bg);border:none;border-radius:12px;transition:background .2s ease}.acu-switch:not(:has(input))::after{content:"";position:absolute;top:50%;left:2px;transform:translateY(-50%);width:20px;height:20px;background:var(--acu-text-sub);border:none;border-radius:50%;transition:all .2s ease;box-shadow:0 1px 3px rgba(0,0,0,.15)}.acu-switch:not(:has(input)).active{background:var(--acu-title-color)}.acu-switch:not(:has(input)).active::after{left:calc(100% - 22px);background:#fff}.acu-switch:not(:has(input)):hover{opacity:.9}.acu-badge,.acu-badge-default,.acu-badge-female,.acu-badge-male,.acu-badge-pill,.acu-badge-tag{display:inline-block;padding:2px 8px;border-radius:var(--acu-radius-sm,4px);font-size:calc(var(--acu-font-size,13px) - 1px);background:var(--acu-badge-bg,rgba(0,0,0,0.05))}.acu-badge,.acu-badge-default,.acu-badge-female,.acu-badge-male,.acu-badge-pill,.acu-badge-tag,.acu-wrapper .acu-badge{color:var(--acu-text-main,#333) !important}.acu-badge,.acu-badge-default,.acu-badge-female,.acu-badge-male,.acu-badge-pill,.acu-badge-tag{line-height:1.4;word-break:break-word;white-space:pre-wrap}.acu-badge-default,.acu-badge-female,.acu-badge-male{background:rgba(0,0,0,0);padding:0;color:inherit}.acu-badge-pill,.acu-badge-tag{border-radius:999px;padding:2px 10px}.acu-badge-count{display:inline-flex;align-items:center;justify-content:center;min-width:20px;height:20px;padding:0 6px;border-radius:50%;font-size:11px;font-weight:bold;background:var(--acu-title-color);color:#fff;line-height:1}.acu-badge-primary,.acu-badge-percent,.acu-badge-level,.acu-badge-danger,.acu-badge-warning,.acu-badge-success,.acu-badge-number,.acu-wrapper .acu-badge-primary{background:var(--acu-title-color-bg) !important;color:var(--acu-title-color) !important}.acu-badge-secondary,.acu-badge-info,.acu-wrapper .acu-badge-secondary{background:var(--acu-table-head) !important;color:var(--acu-text-sub) !important}.acu-badge-outline,.acu-badge-tag,.acu-wrapper .acu-badge-outline{background:rgba(0,0,0,0) !important;border:1px solid var(--acu-border) !important;color:var(--acu-text-sub) !important}.acu-badge-outline,.acu-badge-tag{padding:1px 7px}.acu-badge-outline-primary,.acu-wrapper .acu-badge-outline-primary{background:rgba(0,0,0,0) !important;border:1px solid var(--acu-title-color) !important;color:var(--acu-title-color) !important}.acu-badge-outline-primary{padding:1px 7px}.acu-badge-interactive{cursor:pointer;transition:all .15s ease;-webkit-user-select:none;user-select:none}.acu-badge-interactive:hover{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color)}.acu-badge-interactive:active{transform:translateY(1px)}.acu-stamp-delete{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-15deg);width:80px;height:80px;border:4px solid #e74c3c;border-radius:50%;color:#e74c3c;font-size:20px;font-weight:900;display:flex;align-items:center;justify-content:center;z-index:50;pointer-events:none;opacity:.6;box-shadow:inset 0 0 10px rgba(231,76,60,.2);background:hsla(0,0%,100%,.1)}.acu-badge-default,.acu-badge-female,.acu-badge-male{background:rgba(0,0,0,0)}.acu-pagination-container{flex:0 0 auto;flex-shrink:0;width:100%;display:flex;justify-content:space-between;align-items:center;padding:6px 8px;background:var(--acu-bg-panel);border-top:1px solid var(--acu-border);z-index:10;box-sizing:border-box}.acu-pagination-container.hidden{display:none !important}.acu-pagination-numbers{display:flex;justify-content:center;align-items:center;gap:4px;flex:1;overflow:hidden}.acu-page-btn{padding:0;border:1px solid var(--acu-border);background:var(--acu-btn-bg);color:var(--acu-title-color);border-radius:5px;cursor:pointer;font-size:11px;min-width:26px;height:26px;display:flex;align-items:center;justify-content:center;transition:all .2s;-webkit-user-select:none;user-select:none;font-weight:500;flex-shrink:0}.acu-page-btn:not(.disabled):not(.active):hover{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color);transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.1)}.acu-page-btn.active{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color);font-weight:bold;cursor:default}.acu-page-btn.disabled{opacity:.5;cursor:not-allowed;background:var(--acu-text-sub)}.acu-page-arrow{width:30px;font-size:12px}.acu-page-dots{color:var(--acu-text-sub);font-size:11px;padding:0 2px;letter-spacing:1px}.acu-pagination-info{color:var(--acu-text-sub);font-size:11px;white-space:nowrap}.acu-pagination{display:flex;align-items:center;justify-content:center;padding:8px 15px;gap:5px;flex-wrap:nowrap;font-size:var(--acu-font-size,13px);background:var(--acu-bg-panel);border-top:1px solid var(--acu-border);box-sizing:border-box;width:100%;flex:0 0 auto}.acu-pagination .acu-pagination-info{display:flex;align-items:center;gap:4px;color:var(--acu-text-sub,#999);white-space:nowrap}.acu-pagination .acu-pagination-info strong{color:var(--acu-text-main,#5e4b35);font-weight:600}.acu-pagination .acu-pagination-info .acu-pagination-total{opacity:.7;font-size:.9em}.acu-pagination-controls{display:flex;align-items:center;gap:4px}.acu-page-list{display:flex;align-items:center;gap:4px}.acu-pagination .acu-btn{display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--acu-border,#dcd0c0);background:var(--acu-btn-bg,#dcd0c0);color:var(--acu-text-main,#5e4b35);cursor:pointer;transition:background var(--acu-transition-fast,0.15s),border-color var(--acu-transition-fast,0.15s),color var(--acu-transition-fast,0.15s),transform var(--acu-transition-fast,0.15s);-webkit-user-select:none;user-select:none;flex-shrink:0}.acu-pagination .acu-btn:hover:not(:disabled){background:var(--acu-title-color,#5e4b35);color:#fff;border-color:var(--acu-title-color,#5e4b35);transform:translateY(-2px);box-shadow:0 2px 5px rgba(0,0,0,.1)}.acu-pagination .acu-btn:active:not(:disabled){transform:scale(0.95)}.acu-pagination .acu-btn:disabled,.acu-pagination .acu-btn.disabled{opacity:.5;cursor:not-allowed;background:var(--acu-text-sub,#999)}.acu-pagination .acu-btn-icon{width:32px;height:32px;padding:0;border-radius:var(--acu-radius-sm,6px)}.acu-pagination .acu-btn-icon i{font-size:14px}.acu-pagination .acu-btn-page{min-width:32px;height:32px;padding:0;border-radius:6px;font-size:12px;font-weight:500;flex-shrink:0}.acu-pagination .acu-btn-page.active{background:var(--acu-title-color,#5e4b35);border-color:var(--acu-title-color,#5e4b35);color:#fff;font-weight:bold;cursor:default}.acu-pagination .acu-btn-page.active:hover{transform:none}.acu-pagination .acu-btn-page i{font-size:14px}.acu-pagination .acu-btn-sm{height:28px;padding:0 12px;font-size:12px;border-radius:var(--acu-radius-sm,6px)}.acu-page-ellipsis{display:flex;align-items:center;justify-content:center;min-width:24px;height:32px;color:var(--acu-text-sub,#999);font-size:12px;padding:0 2px;letter-spacing:1px;flex-shrink:0}.acu-page-ellipsis i{font-size:12px}.acu-pagination-jump{display:flex;align-items:center;gap:8px;color:var(--acu-text-sub,#999);white-space:nowrap}.acu-pagination-jump .acu-input-sm{width:56px;height:28px;padding:0 8px;border:1px solid var(--acu-border,#dcd0c0);border-radius:var(--acu-radius-sm,6px);background:var(--acu-input-bg,rgba(255,255,255,0.5));color:var(--acu-text-main,#5e4b35);font-size:var(--acu-font-size,13px);text-align:center;outline:none;transition:border-color var(--acu-transition-fast,0.15s),box-shadow var(--acu-transition-fast,0.15s);-moz-appearance:textfield}.acu-pagination-jump .acu-input-sm::-webkit-outer-spin-button,.acu-pagination-jump .acu-input-sm::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.acu-pagination-jump .acu-input-sm:focus{border-color:var(--acu-title-color,#d35400);box-shadow:0 0 0 3px var(--acu-title-color-bg,rgba(211,84,0,0.08))}@media (max-width:480px){.acu-pagination{flex-direction:column;gap:12px}.acu-pagination .acu-pagination-info{order:-1}.acu-pagination-jump{font-size:12px}.acu-pagination-jump .acu-input-sm{width:48px;height:26px}.acu-pagination-jump .acu-btn-sm{height:26px;padding:0 10px}}.acu-dash-container{display:grid;grid-template-columns:1fr 2fr;gap:16px;height:100%;padding:5px;overflow-y:auto;font-size:var(--acu-font-size);touch-action:pan-y}@media (max-width:700px){.acu-dash-container{grid-template-columns:1fr}}.acu-dash-card{background:var(--acu-card-bg);border-radius:12px;border:1px solid var(--acu-border);padding:16px;display:flex;flex-direction:column;gap:12px;box-shadow:0 4px 12px var(--acu-shadow);min-height:0;overflow:hidden}.acu-dash-title{font-size:1.2em;font-weight:bold;color:var(--acu-title-color) !important;border-bottom:1px dashed var(--acu-border);padding:0 16px 2px 16px;margin-bottom:0;display:flex;justify-content:space-between;align-items:center;transition:background .2s;gap:8px;-webkit-user-select:none;user-select:none}.acu-dash-title *{font-size:inherit}.acu-dash-title.acu-dash-title-clickable{cursor:pointer}.acu-dash-title.acu-dash-title-clickable:hover{background:var(--acu-table-hover);border-radius:6px 6px 0 0}.acu-dash-collapse-icon{font-size:.7em;color:var(--acu-text-sub) !important;transition:transform .2s;flex-shrink:0;display:flex;align-items:center;justify-content:center;height:28px}.acu-dash-title-text{display:flex;align-items:center;gap:8px;cursor:pointer;padding:2px 6px;margin:-2px -6px;border-radius:4px;transition:color .2s,background .2s}.acu-dash-title-text i{font-size:.9em}.acu-dash-title-text i,.acu-wrapper .acu-dash-title-text i{color:var(--acu-title-color) !important}.acu-dash-title-clickable .acu-dash-title-text:hover{color:var(--acu-highlight,var(--acu-title-color)) !important;background:rgba(var(--acu-highlight-rgb,144,205,244),0.15)}.acu-dash-actions{display:flex;gap:2px}.acu-dash-npc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px;padding:0 16px}.acu-dash-npc-item{background:var(--acu-table-head);padding:10px;border-radius:8px;cursor:default;border:1px solid rgba(0,0,0,0);transition:all .2s;font-weight:500;color:var(--acu-text-main);font-size:1em;display:flex;align-items:center;justify-content:center;gap:8px}.acu-dash-npc-item:hover{border-color:var(--acu-highlight);color:var(--acu-highlight);background:var(--acu-btn-bg)}.acu-dash-npc-text{flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-align:center}.acu-dash-list-item{padding:6px 16px;border-bottom:1px solid var(--acu-border);color:var(--acu-text-sub);font-size:1em;display:flex;align-items:center;gap:6px;cursor:default;flex-wrap:nowrap}.acu-dash-list-item.acu-multi-tags{flex-wrap:wrap}.acu-dash-list-item:hover{color:var(--acu-text-main);padding-left:20px}.acu-dash-list-item i{font-size:.8em;color:var(--acu-title-color) !important}.acu-dash-row-collapse-btn{width:22px !important;height:22px !important;min-width:22px !important;display:flex;align-items:center;justify-content:center;border-radius:50%;background:var(--acu-table-head) !important;border:1px solid var(--acu-border) !important;color:var(--acu-text-sub) !important;font-size:10px !important;padding:0 !important;cursor:pointer;transition:all .2s}.acu-dash-row-collapse-btn:hover{background:var(--acu-title-color-bg) !important;border-color:var(--acu-title-color) !important;color:var(--acu-title-color) !important}.acu-dash-interactive{cursor:pointer !important;position:relative}.acu-tab-btn{padding:6px 12px;cursor:pointer;font-size:13px;font-weight:bold;color:var(--acu-text-sub);transition:all .2s;background:rgba(0,0,0,0);border:none;border-bottom:2px solid rgba(0,0,0,0)}.acu-tab-btn:hover{color:var(--acu-text-main);background:var(--acu-table-hover);border-radius:4px 4px 0 0}.acu-tab-btn.active{color:var(--acu-highlight);border-bottom-color:var(--acu-highlight)}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.acu-dash-npc-item.acu-highlight-changed,.acu-dash-list-item.acu-highlight-changed{color:var(--acu-highlight) !important;background-color:var(--acu-highlight-bg);font-weight:bold;animation:pulse-highlight 2s infinite}.acu-dash-widget.acu-highlight-ai-table .acu-dash-title-text{color:var(--acu-highlight-ai)}.acu-dash-widget.acu-highlight-ai-table .acu-dash-title-text i{color:var(--acu-highlight-ai)}.acu-dash-widget.acu-highlight-ai-table .acu-dash-count{background:var(--acu-highlight-ai-bg);color:var(--acu-highlight-ai)}.acu-dash-npc-item.acu-highlight-ai,.acu-dash-list-item.acu-highlight-ai{color:var(--acu-highlight-ai) !important;background:var(--acu-highlight-ai-bg) !important;font-weight:600;border-color:var(--acu-highlight-ai) !important}.acu-dash-display-tag{display:inline-flex;align-items:center;padding:2px 8px;font-size:11px;font-weight:500;color:var(--acu-text-sub);background:var(--acu-table-head);border:1px solid var(--acu-border);border-radius:10px;white-space:nowrap;flex-shrink:0}.acu-dash-interactive-tag{display:inline-flex;align-items:center;padding:2px 8px;font-size:11px;font-weight:500;color:var(--acu-title-color);background:var(--acu-title-color-bg);border:1px solid var(--acu-title-color);border-radius:10px;white-space:nowrap;flex-shrink:0;cursor:pointer;transition:all .15s ease}.acu-dash-interactive-tag:hover{background:var(--acu-title-color);color:#fff}.acu-dash-interactive-tag.fixed{border-style:dashed}.acu-dash-category-btn{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;font-size:11px;font-weight:500;color:var(--acu-text-sub);background:var(--acu-table-head);border:1px dashed var(--acu-border);border-radius:10px;white-space:nowrap;flex-shrink:0;cursor:pointer;transition:all .15s ease}.acu-dash-category-btn i{font-size:10px;opacity:.7}.acu-dash-category-btn i,.acu-wrapper .acu-dash-category-btn i{color:var(--acu-title-color) !important}.acu-dash-category-btn:hover{background:var(--acu-title-color-bg);border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-dash-category-btn:hover i{opacity:1}.acu-dash-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;color:var(--acu-text-sub);text-align:center}.acu-dash-empty i{font-size:24px;margin-bottom:8px;opacity:.5}.acu-dash-widget{position:relative;background:var(--acu-card-bg);border-radius:12px;border:1px solid var(--acu-border);padding:4px 0;display:flex;flex-direction:column;gap:2px;box-shadow:0 4px 12px var(--acu-shadow);transition:all .2s ease;min-width:0;max-height:250px}.acu-dash-widget.acu-dash-widget-wide{grid-column:span 2}.acu-dash-widget:has(.acu-global-widget){padding:0 !important;gap:0 !important}.acu-dash-widget-editing{border:2px dashed var(--acu-title-color);cursor:grab;background:linear-gradient(var(--acu-card-bg),var(--acu-card-bg)) padding-box,linear-gradient(45deg,var(--acu-title-color),var(--acu-border)) border-box}.acu-dash-widget-editing:active{cursor:grabbing}.acu-widget-remove{position:absolute;top:-10px;left:-10px;width:24px;height:24px;border-radius:50%;background:#e74c3c;color:#fff;border:2px solid var(--acu-card-bg);cursor:pointer;z-index:10;display:flex;align-items:center;justify-content:center;font-size:12px;box-shadow:0 2px 6px rgba(0,0,0,.2);transition:transform .15s ease}.acu-widget-remove:hover{transform:scale(1.1)}.acu-widget-config{position:absolute;top:-10px;right:-10px;width:24px;height:24px;border-radius:50%;background:var(--acu-title-color);color:#fff;border:2px solid var(--acu-card-bg);cursor:pointer;z-index:10;display:flex;align-items:center;justify-content:center;font-size:12px;box-shadow:0 2px 6px rgba(0,0,0,.2);transition:transform .15s ease}.acu-widget-config:hover{transform:scale(1.1)}.acu-widget-resize{position:absolute;bottom:-10px;right:-10px;width:24px;height:24px;border-radius:50%;background:var(--acu-btn-bg);color:var(--acu-text-sub);border:2px solid var(--acu-border);cursor:nwse-resize;z-index:10;display:flex;align-items:center;justify-content:center;font-size:10px;box-shadow:0 2px 6px rgba(0,0,0,.2);transition:all .15s ease}.acu-widget-resize:hover{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color)}.acu-dash-body-scrollable{flex:1;min-height:0;max-height:100%;overflow-y:auto;overflow-x:hidden}.acu-dash-body-scrollable::-webkit-scrollbar{width:4px}.acu-dash-body-scrollable::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.acu-dash-body-scrollable::-webkit-scrollbar-thumb{background:var(--acu-border);border-radius:2px}.acu-dash-body-scrollable::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub)}.acu-dash-count{display:inline-flex;align-items:center;justify-content:center;min-width:18px;height:18px;padding:0 5px;font-size:11px;font-weight:600;color:var(--acu-title-color);background:var(--acu-title-color-bg,rgba(var(--acu-title-color-rgb),0.15));border-radius:9px}.acu-dash-list-text{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-dash-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--acu-border);background:var(--acu-bg-nav);flex-shrink:0}.acu-dash-header-left{display:flex;align-items:center;gap:8px;flex-shrink:0}.acu-dash-header-title{font-size:1.1em;font-weight:600;color:var(--acu-text-main) !important;display:flex;align-items:center;gap:6px}.acu-dash-header-title i{color:var(--acu-title-color) !important}.acu-dash-header-spacer{flex:1;min-width:16px}.acu-dash-header-actions{display:flex;gap:6px;align-items:center;flex-shrink:0}.acu-dash-header-actions .acu-icon-btn.acu-btn-primary{background:var(--acu-title-color) !important;color:#fff !important;border-color:var(--acu-title-color) !important}.acu-dash-header-actions .acu-icon-btn.acu-btn-primary:hover{opacity:.9}.acu-dash-grid{flex:1;overflow-y:auto;display:grid;grid-template-columns:repeat(2,1fr);gap:8px;padding:8px;align-content:start}.acu-dash-widget-dragging{opacity:.5}.acu-dash-widget-drop-target{border:2px dashed var(--acu-title-color);background:var(--acu-title-color-bg,rgba(var(--acu-title-color-rgb),0.1))}.acu-dash-container-new{display:flex;flex-direction:column;height:100%;overflow:hidden}.acu-dash-empty-state{grid-column:1/-1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 24px;text-align:center;color:var(--acu-text-sub)}.acu-dash-empty-state i{font-size:48px;margin-bottom:16px;opacity:.5}.acu-dash-empty-state p{margin:0 0 16px;font-size:14px}.acu-dash-add-first-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:var(--acu-title-color);color:#fff;border:none;border-radius:8px;font-size:14px;cursor:pointer;transition:opacity .2s}.acu-dash-add-first-btn:hover{opacity:.9}.acu-actions-config-modal{max-width:320px}@media (max-width:400px){.acu-actions-config-modal{max-width:95%}}.acu-dash-row-edit-btn{width:24px;height:24px;min-width:24px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;border-radius:4px;color:var(--acu-text-sub);cursor:pointer;transition:all .2s;opacity:0;margin-left:auto;flex-shrink:0}.acu-dash-row-edit-btn i{font-size:11px}.acu-dash-row-edit-btn:hover{background:var(--acu-btn-hover);color:var(--acu-title-color)}.acu-dash-npc-item:hover .acu-dash-row-edit-btn{opacity:1}.acu-dash-list-item:hover .acu-dash-row-edit-btn{opacity:1}.acu-dash-row-collapse-btn{width:20px;height:20px;min-width:20px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;border-radius:4px;color:var(--acu-text-sub);cursor:pointer;transition:all .15s ease;margin-left:4px;flex-shrink:0;padding:0}.acu-dash-row-collapse-btn i{font-size:10px}.acu-dash-row-collapse-btn:hover{background:var(--acu-btn-hover);color:var(--acu-title-color)}.acu-row-edit-modal{max-width:500px;width:90%;max-height:80vh;display:flex;flex-direction:column}.acu-row-edit-modal .acu-pc-only{display:block}.acu-row-edit-modal .acu-mobile-only{display:none}@media (max-width:768px){.acu-row-edit-modal{max-width:100%;width:100%;max-height:85vh;border-radius:20px 20px 0 0;margin:0}.acu-row-edit-modal .acu-pc-only{display:none !important}.acu-row-edit-modal .acu-mobile-only{display:block !important}}.acu-row-edit-modal .acu-modal-body{flex:1;overflow-y:auto;padding:16px}.acu-row-edit-content .acu-data-card{background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:12px;padding:12px;width:100% !important;max-width:none !important;box-sizing:border-box}.acu-status-board{width:100%;display:flex;flex-direction:column;gap:8px}.acu-status-board-header{display:flex;align-items:center;justify-content:space-between;padding:4px 8px;border-bottom:1px dashed var(--acu-border);flex-wrap:wrap;gap:8px}.acu-status-board-summary{font-size:11px;color:var(--acu-text-sub);white-space:nowrap}.acu-status-table-wrapper{overflow-x:auto}.acu-status-table{width:100%;border-collapse:collapse;font-size:12px}.acu-status-table th,.acu-status-table td{padding:6px 8px;text-align:left;border-bottom:1px solid var(--acu-border);font-family:var(--acu-font-family) !important}.acu-status-table th{font-weight:600;color:var(--acu-text-sub);background:var(--acu-table-head);font-size:11px;white-space:nowrap}.acu-status-table td{color:var(--acu-text-main)}.acu-status-table tbody tr{cursor:pointer;transition:background .15s}.acu-status-table tbody tr:hover{background:var(--acu-table-hover)}.acu-status-table tbody tr:last-child td{border-bottom:none}.acu-status-name{font-weight:500;max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-status-freq,.acu-status-unrecorded,.acu-status-last-update{text-align:center !important}.acu-status-col-freq,.acu-status-col-unrecorded,.acu-status-col-last{text-align:center !important}.acu-status-disabled{color:var(--acu-text-sub);opacity:.6}.acu-status-global-hint{font-size:10px;color:var(--acu-text-sub);margin-left:2px}.acu-status-empty,.acu-status-loading{text-align:center;padding:20px !important;color:var(--acu-text-sub)}.acu-status-empty i,.acu-status-loading i{margin-right:6px}.acu-status-table tbody tr.acu-highlight-ai td{color:var(--acu-highlight-ai) !important;font-weight:600}.acu-status-table tbody tr.acu-highlight-ai td span{color:inherit !important}.acu-status-table tbody tr.acu-highlight-ai .acu-status-name{color:var(--acu-highlight-ai) !important;font-weight:700}.acu-status-table tbody tr.acu-row-selected{background:var(--acu-title-color-bg) !important}.acu-status-table tbody tr.acu-row-selected td{color:var(--acu-title-color)}.acu-status-table tbody tr.acu-row-selected .acu-status-name{font-weight:600}.acu-status-board-actions{display:flex;align-items:center;gap:8px;margin-left:auto}.acu-status-toolbar{display:flex;align-items:center;gap:4px;padding-right:8px;border-right:1px solid var(--acu-border);margin-right:4px}.acu-freq-input{width:60px;padding:4px 6px;text-align:center;font-size:13px;font-weight:500;border:1px solid var(--acu-border);border-radius:4px;background:var(--acu-btn-bg);color:var(--acu-text-main);transition:border-color .15s ease}.acu-freq-input:focus{outline:none;border-color:var(--acu-title-color);background:var(--acu-card-bg)}.acu-freq-input::-webkit-inner-spin-button,.acu-freq-input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.acu-freq-input[type=number]{-moz-appearance:textfield}.acu-status-table td.acu-status-name span{display:inline-block;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-icon-btn.acu-edit-active{background:var(--acu-title-color-bg);border-color:var(--acu-title-color);color:var(--acu-title-color)}@media (max-width:768px){.acu-status-toolbar{flex-wrap:wrap;gap:2px;padding-right:4px;margin-right:2px}.acu-freq-input{width:50px;padding:3px 4px;font-size:12px}.acu-status-board-actions{gap:4px}}.acu-embedded-options{width:100%;display:flex;flex-direction:column;gap:12px}.acu-embedded-options-list{display:flex;flex-direction:column;gap:12px}.acu-embedded-option-group{display:flex;flex-direction:column;gap:6px}.acu-embedded-option-rows{display:flex;flex-direction:column;gap:4px}.acu-embedded-option-row{display:flex;align-items:center;gap:8px;padding:6px 10px;background:var(--acu-table-head);border-radius:6px;cursor:pointer;transition:all .15s}.acu-embedded-option-row:hover{background:var(--acu-table-hover);color:var(--acu-title-color)}.acu-embedded-option-tags{display:flex;gap:4px;flex-shrink:0}.acu-option-tag{font-size:10px !important;padding:1px 5px !important;background:var(--acu-title-color-bg,rgba(var(--acu-title-color-rgb),0.15)) !important;color:var(--acu-title-color) !important}.acu-embedded-option-text{flex:1;font-size:12px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-dash-add-section{grid-column:1/-1;display:flex;flex-direction:column;gap:0}.acu-dash-add-section .acu-action-btn{width:100%;justify-content:center;border-radius:12px;padding:10px 16px}.acu-dash-add-section .acu-action-btn.active{border-bottom-left-radius:0;border-bottom-right-radius:0;border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-dash-add-list{border-top:none;border-top-left-radius:0;border-top-right-radius:0}.acu-dash-add-list .acu-switch-list-body{max-height:200px}.acu-dash-add-list .acu-switch-list-item.is-selected .item-label i{color:var(--acu-title-color)}.acu-dash-virtual-container{max-height:200px;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch}.acu-dash-virtual-container::-webkit-scrollbar{width:4px}.acu-dash-virtual-container::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.acu-dash-virtual-container::-webkit-scrollbar-thumb{background:var(--acu-border);border-radius:2px}.acu-dash-virtual-container::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub)}.acu-dash-virtual-container .acu-dash-npc-grid{margin-bottom:8px}.acu-dash-virtual-container .acu-dash-npc-grid:last-child{margin-bottom:0}.acu-selected-tags{display:flex;flex-wrap:wrap;gap:8px;padding:10px;background:var(--acu-table-head);border-radius:8px;min-height:40px}.acu-selected-tag{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;background:var(--acu-title-color-bg);border:1px solid var(--acu-title-color);border-radius:6px;color:var(--acu-title-color);font-size:12px;font-weight:500}.acu-tag-remove{display:flex;align-items:center;justify-content:center;width:16px;height:16px;background:rgba(0,0,0,0);border:none;border-radius:50%;color:var(--acu-title-color);cursor:pointer;transition:all .15s ease;padding:0}.acu-tag-remove:hover{background:rgba(231,76,60,.2);color:#e74c3c}.acu-tag-remove i{font-size:10px}.acu-tab-btn{display:flex;align-items:center;gap:6px;padding:10px 16px;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);font-size:13px;cursor:pointer;white-space:nowrap;position:relative;transition:all .2s ease}.acu-tab-btn i{font-size:14px}.acu-tab-btn:hover{color:var(--acu-text-main);background:var(--acu-btn-hover)}.acu-tab-btn.active{color:var(--acu-title-color);font-weight:600}.acu-tab-btn.active::after{content:"";position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:60%;height:3px;background:var(--acu-title-color);border-radius:3px 3px 0 0}.acu-options-panel{display:flex;flex-direction:column;height:100%;min-height:0}.acu-options-header{flex:0 0 auto;padding:8px 12px;-webkit-user-select:none;user-select:none}.acu-options-title{font-size:1.2em;font-weight:800;color:var(--acu-title-color,#333);display:flex;align-items:center;gap:8px}.acu-options-title i{color:var(--acu-title-color,#667eea)}.acu-options-count{color:var(--acu-text-sub,#666);font-size:.9em}.acu-options-content{flex:1;overflow-y:auto !important;min-height:0;padding:10px;touch-action:pan-y;-webkit-overflow-scrolling:touch;position:relative;z-index:10}.acu-options-list{display:flex;flex-direction:column;gap:12px;padding-bottom:20px;flex:1;min-height:0}.acu-options-list .acu-dash-card{flex:1;min-height:0;display:flex;flex-direction:column}.acu-empty-state{text-align:center;color:var(--acu-text-sub,#666);padding:30px;font-size:.9em}.acu-option-rows{display:flex;flex-direction:column;gap:6px;overflow-y:auto;min-height:0;flex:1;padding-right:4px}.acu-option-rows::-webkit-scrollbar{width:4px}.acu-option-rows::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.acu-option-rows::-webkit-scrollbar-thumb{background:var(--acu-border);border-radius:2px}.acu-option-rows::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub)}.acu-embedded-option-row{display:flex;flex-direction:column;align-items:flex-start;gap:8px;padding:12px;background:hsla(0,0%,100%,.05);border-radius:8px;border:1px solid var(--acu-border,rgba(255,255,255,0.1));cursor:pointer;transition:background .1s,transform .1s;-webkit-user-select:none;user-select:none;touch-action:pan-y}.acu-embedded-option-row:hover{background:var(--acu-table-hover,rgba(255,255,255,0.1));border-color:var(--acu-title-color,#667eea)}.acu-embedded-option-row:active{transform:translateY(1px)}.acu-embedded-option-tags{display:flex;flex-wrap:wrap;gap:4px;width:100%;flex-shrink:0}.acu-embedded-option-text{width:100%;color:var(--acu-text-main,#333);font-weight:500;font-size:var(--acu-font-size,14px);line-height:1.5;word-break:break-word;white-space:pre-wrap}.acu-tab-config-panel,.acu-button-config-panel{display:flex;flex-direction:column;gap:16px}.acu-btn-text{display:flex;align-items:center;gap:4px;padding:4px 8px;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub,#999);cursor:pointer;font-size:12px;border-radius:4px;transition:all .2s}.acu-btn-text:hover{background:var(--acu-btn-hover,#cbbba8);color:var(--acu-text-main,#5e4b35)}.acu-btn-text.acu-btn-clear{font-size:11px}.acu-btn-text.acu-btn-clear:hover{color:#e74c3c;background:rgba(231,76,60,.1)}.acu-config-section{display:flex;flex-direction:column;gap:8px}.acu-config-section h4{margin:0;font-size:13px;font-weight:600;color:var(--acu-text-main,#5e4b35);display:flex;align-items:center;gap:6px}.acu-config-section h4 .acu-btn-reset{margin-left:auto;font-size:11px}.acu-config-hint{display:flex;align-items:center;gap:6px;padding:8px 12px;background:var(--acu-table-head,#efebe4);border:1px solid var(--acu-border,#dcd0c0);border-radius:6px;font-size:12px;color:var(--acu-text-sub,#999)}.acu-config-hint i{color:var(--acu-title-color,#d35400)}.acu-visible-area{background:var(--acu-title-color-bg,rgba(211,84,0,0.08));border-radius:8px;padding:12px;border:1px dashed var(--acu-border,#dcd0c0)}.acu-visible-area h4{display:flex;align-items:center;gap:6px;font-weight:600}.acu-visible-area h4 i{color:var(--acu-title-color,#d35400)}.acu-hidden-area{background:var(--acu-table-head,#efebe4);border-radius:8px;padding:12px}.acu-hidden-area h4{display:flex;align-items:center;gap:6px;font-weight:600}.acu-hidden-area h4 i{color:var(--acu-text-sub,#999)}.acu-tab-visible-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:6px;max-height:160px;overflow-y:auto;padding:4px}@media (max-width:480px){.acu-tab-visible-grid{grid-template-columns:repeat(2,1fr)}}.acu-tab-config-btn{position:relative;cursor:grab;touch-action:none}.acu-tab-config-btn:hover{border-color:#e74c3c !important;background:rgba(231,76,60,.1) !important}.acu-tab-config-btn.dragging{opacity:.5;cursor:grabbing;border:2px dashed var(--acu-title-color,#d35400) !important}.acu-tab-config-btn .tab-type-badge-mini{position:absolute;top:-4px;right:-4px;font-size:8px;padding:1px 4px;border-radius:3px;background:var(--acu-title-color,#d35400);color:#fff;line-height:1.2}.acu-tab-hidden-list{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;max-height:150px;overflow-y:auto;padding:4px}@media (max-width:480px){.acu-tab-hidden-list{grid-template-columns:repeat(2,1fr)}}.acu-tab-hidden-item{display:flex;align-items:center;gap:6px;padding:8px 10px;border:1px solid var(--acu-border,#dcd0c0);border-radius:6px;background:var(--acu-card-bg,#fffef9);color:var(--acu-text-sub,#999);cursor:pointer;transition:all .2s;font-size:12px}.acu-tab-hidden-item:hover{background:var(--acu-title-color-bg,rgba(211,84,0,0.08));border-color:var(--acu-title-color,#d35400);color:var(--acu-title-color,#d35400)}.acu-tab-hidden-item:hover .add-icon{color:var(--acu-title-color,#d35400)}.acu-tab-hidden-item.is-special{border-left:2px solid var(--acu-text-sub,#999)}.acu-tab-hidden-item .tab-icon{width:14px;text-align:center}.acu-tab-hidden-item .tab-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-tab-hidden-item .tab-type-badge{font-size:9px;padding:1px 4px;border-radius:2px;background:rgba(0,0,0,.05)}.acu-tab-hidden-item .add-icon{font-size:10px;color:var(--acu-text-sub,#999)}.acu-empty-hint{display:flex;align-items:center;justify-content:center;gap:8px;padding:16px;color:var(--acu-text-sub,#999);font-size:12px;font-style:italic}.acu-empty-hint i{font-size:14px}.acu-btn-visible-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(48px,1fr));gap:8px;max-height:180px;overflow-y:auto;padding:4px}@media (max-width:480px){.acu-btn-visible-grid{grid-template-columns:repeat(auto-fill,48px);justify-content:flex-start}}.acu-btn-config-item{position:relative;display:flex;align-items:center;justify-content:center;width:48px;height:48px;border:1px solid var(--acu-border,#dcd0c0);border-radius:8px;background:var(--acu-card-bg,#fffef9);cursor:grab;touch-action:none;transition:all .2s}.acu-btn-config-item .btn-icon{font-size:16px;color:var(--acu-text-main,#5e4b35)}.acu-btn-config-item:hover{background:rgba(231,76,60,.1);border-color:#e74c3c}.acu-btn-config-item:hover .btn-icon{color:#e74c3c}.acu-btn-config-item.is-required{cursor:default;border-color:var(--acu-title-color,#d35400)}.acu-btn-config-item.is-required:hover{background:var(--acu-card-bg,#fffef9);border-color:var(--acu-title-color,#d35400)}.acu-btn-config-item.is-required:hover .btn-icon{color:var(--acu-text-main,#5e4b35)}.acu-btn-config-item .required-dot{position:absolute;top:4px;right:4px;width:6px;height:6px;border-radius:50%;background:var(--acu-title-color,#d35400)}.acu-btn-config-item .attachment-indicator{position:absolute;bottom:-4px;right:-4px;display:flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:50%;background:var(--acu-title-color,#d35400);color:#fff;font-size:8px;cursor:pointer;border:2px solid var(--acu-bg-panel,#e6e2d3);transition:all .2s}.acu-btn-config-item .attachment-indicator:hover{background:#e74c3c;transform:scale(1.1)}.acu-btn-config-item .attachment-add-btn{position:absolute;bottom:-4px;right:-4px;display:flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:4px;border:1px dashed var(--acu-text-sub,#999);background:var(--acu-bg-panel,#e6e2d3);color:var(--acu-text-sub,#999);font-size:8px;cursor:pointer;padding:0;transition:all .2s}.acu-btn-config-item .attachment-add-btn:hover{border-color:var(--acu-title-color,#d35400);color:var(--acu-title-color,#d35400);background:var(--acu-title-color-bg,rgba(211,84,0,0.08))}.acu-btn-hidden-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(40px,1fr));gap:6px;max-height:100px;overflow-y:auto;padding:4px}@media (max-width:480px){.acu-btn-hidden-grid{grid-template-columns:repeat(auto-fill,40px);justify-content:flex-start}}.acu-btn-hidden-item{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border:1px solid var(--acu-border,#dcd0c0);border-radius:6px;background:var(--acu-card-bg,#fffef9);color:var(--acu-text-sub,#999);cursor:pointer;transition:all .2s;font-size:14px;padding:0}.acu-btn-hidden-item:hover{background:var(--acu-title-color-bg,rgba(211,84,0,0.08));border-color:var(--acu-title-color,#d35400);color:var(--acu-title-color,#d35400)}.acu-config-hint-fixed{position:sticky;bottom:0;margin-top:auto;background:var(--acu-bg-panel,#e6e2d3);border-top:1px solid var(--acu-border,#dcd0c0);border-left:none;border-right:none;border-bottom:none;border-radius:0;margin-left:-16px;margin-right:-16px;padding:10px 16px;margin-bottom:-16px}.acu-attachment-picker-overlay{position:fixed;top:0;left:0;right:0;bottom:0;width:100vw !important;height:100vh !important;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:2147483647;padding:20px;box-sizing:border-box}.acu-attachment-picker{width:90%;max-width:300px;max-height:calc(100vh - 100px);background:var(--acu-bg-panel,#e6e2d3);border:1px solid var(--acu-border,#dcd0c0);border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,.3);overflow:hidden}.acu-attachment-picker .picker-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--acu-table-head,#efebe4);border-bottom:1px solid var(--acu-border,#dcd0c0)}.acu-attachment-picker .picker-header h4{margin:0;font-size:14px;font-weight:600;color:var(--acu-title-color,#d35400)}.acu-attachment-picker .picker-header .btn-close{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub,#999);cursor:pointer;border-radius:4px;transition:all .2s}.acu-attachment-picker .picker-header .btn-close:hover{background:var(--acu-btn-hover,#cbbba8);color:var(--acu-text-main,#5e4b35)}.acu-attachment-picker .picker-content{padding:16px}.acu-attachment-picker .picker-hint{margin:0 0 12px;font-size:12px;color:var(--acu-text-sub,#999)}.acu-attachment-picker .picker-options{display:grid;grid-template-columns:repeat(auto-fill,minmax(48px,1fr));gap:8px;max-height:200px;overflow-y:auto}.acu-attachment-picker .picker-option{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:10px 6px;border:1px solid var(--acu-border,#dcd0c0);border-radius:8px;background:var(--acu-card-bg,#fffef9);color:var(--acu-text-main,#5e4b35);cursor:pointer;transition:all .2s;font-size:10px;text-align:center}.acu-attachment-picker .picker-option:hover{background:var(--acu-title-color-bg,rgba(211,84,0,0.08));border-color:var(--acu-title-color,#d35400);color:var(--acu-title-color,#d35400)}.acu-attachment-picker .picker-option i{font-size:18px;color:var(--acu-text-sub,#999)}.acu-attachment-picker .picker-option:hover i{color:var(--acu-title-color,#d35400)}.acu-attachment-picker .picker-option span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%}@media (max-width:768px){.acu-attachment-picker-overlay{padding:16px}.acu-attachment-picker{width:100%;max-width:320px}.acu-attachment-picker .picker-options{max-height:250px}}.acu-mode-control{display:flex !important;flex-direction:column !important;align-items:flex-end !important;gap:8px !important;width:100%}.acu-mode-control .acu-select{width:auto !important;min-width:120px}.acu-mode-control .acu-range-wrapper{display:flex;align-items:center;gap:8px;width:100%;justify-content:flex-end;margin-top:4px}.acu-mode-control .acu-inline-range{width:120px !important;flex-shrink:0}.acu-mode-control .acu-range-value{min-width:24px;text-align:right;font-variant-numeric:tabular-nums;color:var(--acu-title-color,#d35400);font-weight:bold}.acu-update-layout{display:flex;gap:0}@media (max-width:768px){.acu-update-layout{flex-direction:column}}.acu-update-left{flex:1;min-width:0;max-height:calc(80vh - 120px);overflow-y:auto;padding-right:16px;scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-update-left::-webkit-scrollbar{width:4px !important;height:4px !important}.acu-update-left::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-update-left::-webkit-scrollbar-thumb{background:var(--acu-border) !important;border-radius:2px !important}.acu-update-left::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important}.acu-update-left::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}@media (max-width:768px){.acu-update-left{max-height:none;padding-right:0}}.acu-update-right{width:260px;flex-shrink:0;border-left:1px solid var(--acu-border);padding-left:20px;display:flex;flex-direction:column}@media (max-width:768px){.acu-update-right{display:none}}.acu-table-selector{background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:12px;overflow:hidden}.acu-table-selector-header{display:flex;flex-wrap:wrap;gap:6px;padding:10px 12px;border-bottom:1px solid var(--acu-border);background:var(--acu-table-head);justify-content:flex-end}.acu-table-selector-list{max-height:280px;overflow-y:auto;padding:8px;scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-table-selector-list::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-table-selector-list::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-table-selector-list::-webkit-scrollbar-thumb{background:var(--acu-border) !important;border-radius:3px !important}.acu-table-selector-list::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important}.acu-table-selector-list::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-table-selector-item{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:8px;cursor:pointer;transition:background .15s;-webkit-user-select:none;user-select:none}.acu-table-selector-item:hover{background:var(--acu-table-hover)}.acu-table-selector-item .acu-switch.small{transform:scale(0.65);transform-origin:center;margin:0 -4px;flex-shrink:0}.acu-table-selector-item input[type=checkbox]:not(.acu-switch input){appearance:checkbox !important;-webkit-appearance:checkbox !important;-moz-appearance:checkbox !important;width:16px !important;height:16px !important;min-width:16px !important;min-height:16px !important;margin:0 !important;padding:0 !important;cursor:pointer !important;accent-color:var(--acu-title-color) !important;background:none !important;background-color:rgba(0,0,0,0) !important;background-image:none !important;border:revert !important;outline:none !important;box-shadow:none !important;vertical-align:middle !important;flex-shrink:0 !important;position:relative !important}.acu-table-selector-item input[type=checkbox]:not(.acu-switch input)::before,.acu-table-selector-item input[type=checkbox]:not(.acu-switch input)::after{content:none !important;display:none !important}.acu-table-selector-item .table-name{flex:1;font-size:13px;color:var(--acu-text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-table-selector-item.is-summary-outline .table-name::after{content:"★";color:var(--acu-title-color);margin-left:4px;font-size:10px}.acu-table-selector-item.is-selected{background:var(--acu-title-color-bg)}.acu-table-selector-footer{padding:8px 12px;border-top:1px solid var(--acu-border);font-size:12px;color:var(--acu-text-sub);text-align:center}.acu-table-selector-empty{padding:20px;text-align:center;color:var(--acu-text-sub);font-size:13px}.acu-table-selector-empty i{display:block;font-size:24px;margin-bottom:8px;opacity:.5}.acu-quick-select-btn{padding:4px 10px;font-size:11px;border-radius:6px;border:1px solid var(--acu-border);background:var(--acu-btn-bg);color:var(--acu-text-main);cursor:pointer;transition:all .15s;white-space:nowrap}.acu-quick-select-btn:hover{background:var(--acu-btn-hover)}.acu-quick-select-btn.active{background:var(--acu-title-color-bg);border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-quick-select-btn i{margin-right:4px;font-size:10px}.acu-table-selector-mobile{margin-top:12px}.acu-table-selector-mobile .acu-table-selector{margin-top:8px}.acu-collapsible{cursor:pointer;display:flex;align-items:center;justify-content:space-between}.acu-collapsible .acu-collapse-indicator{font-size:12px;color:var(--acu-text-sub);transition:transform .2s}.acu-collapsible.is-expanded .acu-collapse-indicator{transform:rotate(180deg)}@media (max-width:768px){.acu-hide-mobile{display:none !important}}.acu-show-mobile-only{display:none}@media (max-width:768px){.acu-show-mobile-only{display:block}}@media (min-width:769px){.acu-manual-update-modal{max-width:800px}.acu-manual-update-modal .acu-modal-body{overflow:visible;max-height:none;padding:20px}}.acu-switch-list{background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:12px;overflow:hidden}.acu-switch-list-header{display:flex;flex-wrap:wrap;gap:6px;padding:10px 12px;border-bottom:1px solid var(--acu-border);background:var(--acu-table-head);justify-content:flex-end}.acu-switch-list-body{max-height:280px;overflow-y:auto;padding:8px;scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-switch-list-body::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-switch-list-body::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-switch-list-body::-webkit-scrollbar-thumb{background:var(--acu-border) !important;border-radius:3px !important}.acu-switch-list-body::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important}.acu-switch-list-body::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-switch-list-item{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:8px;cursor:pointer;transition:background .15s;-webkit-user-select:none;user-select:none}.acu-switch-list-item:hover{background:var(--acu-table-hover)}.acu-switch-list-item.is-selected{background:var(--acu-title-color-bg)}.acu-switch-list-item .item-label{flex:1;font-size:13px;color:var(--acu-text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-switch-list-item .item-badge{color:var(--acu-title-color);margin-left:4px;font-size:10px}.acu-switch-list-item .acu-switch.small{transform:scale(0.65);transform-origin:center;margin:0 -4px;flex-shrink:0}.acu-switch-list-empty{padding:20px;text-align:center;color:var(--acu-text-sub);font-size:13px}.acu-switch-list-empty i{display:block;font-size:24px;margin-bottom:8px;opacity:.5}.acu-switch-list-footer{padding:8px 12px;border-top:1px solid var(--acu-border);font-size:12px;color:var(--acu-text-sub);text-align:center}.acu-switch-list-footer .empty-hint{color:var(--acu-title-color)}.acu-graph-loading{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;min-height:300px;color:var(--acu-text-sub);font-size:14px}.acu-graph-loading i{font-size:24px;color:var(--acu-title-color)}.acu-relationship-graph{position:relative;width:100%;flex:1 1 auto;min-height:400px;background:var(--acu-bg-panel);border-radius:12px;overflow:hidden;display:flex;flex-direction:column}.acu-graph-background{position:absolute;top:0;left:0;right:0;bottom:0;z-index:0;pointer-events:none;background-color:rgba(0,0,0,0);background-repeat:no-repeat}.acu-panel-content:has(.acu-relationship-graph){display:flex;flex-direction:column;flex:1;min-height:450px;overflow:hidden}.acu-data-table:has(.acu-relationship-graph){min-height:450px;height:auto !important;overflow:hidden}@media (min-width:769px){.acu-data-display:has(.acu-relationship-graph){min-height:calc(100vh - var(--acu-win-bottom,100px) - 80px);flex:1 1 auto}}.acu-graph-container{width:100%;position:absolute;top:40px;bottom:48px;left:0;right:0;overflow:hidden;z-index:1;background:rgba(0,0,0,0)}.acu-graph-search-input{position:absolute;bottom:56px;left:50%;transform:translateX(-50%);width:200px;z-index:10}.acu-graph-search-input .acu-search-input-wrapper{background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1)}.acu-slide-up-enter-active,.acu-slide-up-leave-active{transition:all .2s ease}.acu-slide-up-enter-from,.acu-slide-up-leave-to{opacity:0;transform:translateX(-50%) translateY(10px)}.acu-graph-toolbar{position:absolute;bottom:0;left:0;right:0;display:flex;align-items:center;justify-content:center;gap:4px;background:var(--acu-bg-panel);padding:8px 12px;border-top:1px solid var(--acu-border);z-index:10}.acu-graph-legend{position:absolute;top:0;left:0;right:0;display:flex;flex-wrap:wrap;justify-content:center;gap:8px;background:var(--acu-bg-panel);padding:8px 12px;font-size:11px;border-bottom:1px solid var(--acu-border);z-index:10}.acu-toolbar-divider{width:1px;height:20px;background:var(--acu-border);margin:0 4px}@keyframes pulse-success{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}.acu-legend-item{display:flex;align-items:center;gap:4px;white-space:nowrap}.acu-legend-item .dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}.acu-legend-item .dot.dashed{width:18px;height:2px;border-radius:0;border:none;background:rgba(0,0,0,0) !important;position:relative}.acu-legend-item .dot.dashed::before{content:"";position:absolute;top:0;left:0;right:0;height:2px;border-top:2px dashed currentColor;color:inherit}.acu-legend-item .label{color:var(--acu-text-sub)}.acu-graph-empty{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center;gap:12px;color:var(--acu-text-sub);text-align:center}.acu-graph-empty i{font-size:48px;opacity:.3}.acu-graph-empty p{margin:0;font-size:14px}.acu-graph-empty .hint{font-size:12px;opacity:.7}.acu-node-fullname{margin:0 0 6px 0;font-size:13px;color:var(--acu-text-main)}.acu-node-hint{margin:0 0 12px 0;font-size:11px;color:var(--acu-text-sub)}.acu-node-preview{margin:0 0 12px 0;padding:8px 12px;font-size:14px;font-weight:600;color:var(--acu-text-main);background:var(--acu-table-head);border-radius:6px;text-align:center}.acu-char-selector{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}.acu-char-btn{width:40px;height:40px;border:2px solid var(--acu-border);border-radius:8px;background:var(--acu-card-bg);color:var(--acu-text-main);font-size:18px;cursor:pointer;transition:all .15s ease}.acu-char-btn:hover{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-char-btn.active{border-color:var(--acu-title-color);background:var(--acu-title-color);color:#fff}.acu-node-config-actions{display:flex;gap:8px;justify-content:flex-end}.acu-action-btn{padding:8px 16px;border:none;border-radius:6px;font-size:13px;cursor:pointer;transition:all .15s ease}.acu-action-btn.primary{background:var(--acu-title-color);color:#fff}.acu-action-btn.primary:hover{filter:brightness(1.1)}.acu-action-btn.secondary{background:var(--acu-table-head);color:var(--acu-text-main)}.acu-action-btn.secondary:hover{background:var(--acu-table-hover)}@media (max-width:768px){.acu-relationship-graph{min-height:calc(100vh - var(--acu-win-bottom,100px) - 120px);max-height:calc(100vh - var(--acu-win-bottom,100px) - 80px)}.acu-data-display:has(.acu-relationship-graph){flex:1 1 auto;min-height:calc(100vh - var(--acu-win-bottom,100px) - 80px)}.acu-panel-content:has(.acu-relationship-graph){flex:1;min-height:0;height:100%;overflow:hidden !important}.acu-graph-toolbar{padding:6px 8px;gap:2px;flex-wrap:wrap;position:absolute;bottom:0;left:0;right:0}.acu-icon-btn{width:28px;height:28px;font-size:12px}.acu-graph-legend{padding:6px 10px;font-size:10px;gap:6px;position:absolute;top:0;left:0;right:0}.acu-graph-container{top:36px;bottom:44px}.acu-legend-item .dot{width:8px;height:8px}}.acu-graph-avatar-wrapper{display:flex;flex-direction:column;align-items:center;gap:4px;pointer-events:none}.acu-graph-avatar{border:2px solid var(--acu-text-main,#333);box-shadow:0 2px 8px rgba(0,0,0,.15);overflow:hidden;background-color:var(--acu-card-bg,#fff)}.acu-graph-avatar-name{font-weight:bold;color:var(--acu-text-main,#333);text-shadow:-1px -1px 0 var(--acu-card-bg,#fff),1px -1px 0 var(--acu-card-bg,#fff),-1px 1px 0 var(--acu-card-bg,#fff),1px 1px 0 var(--acu-card-bg,#fff);white-space:nowrap;max-width:80px;overflow:hidden;text-overflow:ellipsis}.acu-icon-btn[title=势力分组布局].active{background:var(--acu-title-color-bg);color:var(--acu-title-color)}.acu-interaction-list{display:flex;flex-direction:column;gap:8px;padding:8px}.acu-interaction-item{background:var(--acu-table-head);border-radius:8px;padding:10px;display:flex;flex-direction:column;gap:8px;border:1px solid rgba(0,0,0,0);transition:all .2s}.acu-interaction-item:hover{background:var(--acu-btn-bg);border-color:var(--acu-border)}.acu-interaction-item.acu-highlight-ai{background:var(--acu-highlight-ai-bg);border-color:var(--acu-highlight-ai)}.acu-interaction-header{display:flex;justify-content:space-between;align-items:center;width:100%}.acu-interaction-target{font-weight:bold;color:var(--acu-text-main);font-size:1em}.acu-interaction-actions{display:flex;flex-direction:row;gap:8px;align-items:center}.acu-interaction-meta{display:flex;align-items:center;gap:8px;font-size:.9em;flex-wrap:wrap}.acu-badge{padding:2px 6px;border-radius:4px;font-size:.8em;font-weight:500;white-space:normal;word-break:break-word}.acu-badge.acu-badge-primary{background:var(--acu-title-color-bg);color:var(--acu-title-color);border:1px solid var(--acu-title-color)}.acu-badge.acu-badge-secondary{background:var(--acu-table-head);color:var(--acu-text-sub);border:1px solid var(--acu-border)}.acu-interaction-text{font-size:.95em;color:var(--acu-text-main);background:rgba(0,0,0,.05);padding:6px 8px;border-radius:6px;line-height:1.4;white-space:pre-wrap}.acu-btn-success{color:#2ecc71 !important;border-color:#2ecc71 !important}.acu-btn-success:hover{background:rgba(46,204,113,.1) !important}.acu-dimension-manager{display:flex;flex-direction:column;gap:12px}.dimension-container{transition:all .2s ease;border:1px solid var(--acu-border);background:var(--acu-bg-panel);border-radius:8px;overflow:hidden}.dimension-container.is-collapsed{background:var(--acu-card-bg)}.dimension-container.is-collapsed .dimension-header{border-bottom:none}.dimension-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;cursor:pointer;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);transition:background .2s}.dimension-header:hover{background:var(--acu-table-hover)}.dimension-header .header-left{display:flex;align-items:center;gap:8px;flex:1}.dimension-header .header-right{display:flex;align-items:center;gap:8px}.dimension-header .collapse-icon{font-size:12px;color:var(--acu-text-sub);transition:transform .2s;width:16px;text-align:center}.dimension-header .collapse-icon.is-expanded{transform:rotate(90deg)}.dimension-name-input{background:rgba(0,0,0,0);border:1px solid rgba(0,0,0,0);color:var(--acu-text-main);font-weight:600;font-size:14px;padding:4px 8px;border-radius:4px;width:100%;max-width:200px;transition:all .2s}.dimension-name-input:hover{border-color:var(--acu-border);background:var(--acu-input-bg)}.dimension-name-input:focus{outline:none;border-color:var(--acu-title-color);background:var(--acu-input-bg)}.dimension-content{padding:12px;background:var(--acu-bg-panel)}.tier-list{display:flex;flex-direction:column;gap:12px;margin-bottom:12px}.tier-item{display:flex;flex-direction:column;gap:8px;padding-bottom:12px;border-bottom:1px dashed var(--acu-border)}.tier-item:last-child{border-bottom:none;padding-bottom:0}.tier-row{display:flex;align-items:center;gap:8px}.tier-row.basic-info{justify-content:space-between}.tier-row.weight-control{background:var(--acu-table-head);padding:6px 10px;border-radius:6px}.tier-row.weight-control .label{font-size:12px;color:var(--acu-text-sub);white-space:nowrap}.tier-row.weight-control .acu-range-input{flex:1;height:4px}.tier-row.weight-control .acu-badge{min-width:24px;text-align:center}.tier-row.prompt-editor .acu-textarea-scrollable{min-height:48px;font-size:12px;padding:6px;border-color:var(--acu-border);background:var(--acu-input-bg)}.tier-row.prompt-editor .acu-textarea-scrollable:focus{border-color:var(--acu-title-color);min-height:80px}.tier-name-wrapper{display:flex;align-items:center;gap:8px;flex:1}.tier-name-input{background:rgba(0,0,0,0);border:none;border-bottom:1px solid var(--acu-border);color:var(--acu-text-main);font-size:13px;padding:2px 4px;width:100%;max-width:150px;border-radius:0;transition:border-color .2s}.tier-name-input:focus{outline:none;border-bottom-color:var(--acu-title-color)}.acu-color-picker-mini{width:20px !important;height:20px !important;border-radius:4px !important;border:1px solid var(--acu-border) !important;padding:0 !important;appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);cursor:pointer}.acu-color-picker-mini::-webkit-color-swatch-wrapper{padding:0}.acu-color-picker-mini::-webkit-color-swatch{border-radius:3px;border:none}.acu-btn-dashed{display:flex;align-items:center;justify-content:center;gap:6px;width:100%;padding:8px;background:rgba(0,0,0,0);border:1px dashed var(--acu-border);border-radius:6px;color:var(--acu-text-sub);font-size:12px;cursor:pointer;transition:all .2s}.acu-btn-dashed:hover{border-color:var(--acu-title-color);color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-btn-dashed.add-dimension-btn{margin-top:8px;padding:12px;font-size:13px;border-style:solid;background:var(--acu-card-bg)}.acu-btn-dashed.add-dimension-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-border);color:var(--acu-text-main)}.acu-input-minimal{font-family:inherit}.acu-dimension-toolbar{display:flex;align-items:center;gap:2px;padding:4px 8px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border)}.acu-dimension-toolbar .toolbar-label{font-size:11px;color:var(--acu-text-sub);white-space:nowrap}.acu-dimension-toolbar .toolbar-spacer{flex:1}.acu-dimension-toolbar .toolbar-divider{width:1px;height:16px;background:var(--acu-border);margin:0 2px}.acu-dimension-toolbar .toolbar-badge{display:inline-flex;align-items:center;justify-content:center;min-width:16px;height:16px;padding:0 4px;background:var(--acu-title-color);color:#fff;border-radius:8px;font-size:10px;font-weight:600}.acu-dimension-toolbar .acu-icon-btn{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;border-radius:4px;color:var(--acu-text-sub);font-size:12px;cursor:pointer;transition:all .15s}.acu-dimension-toolbar .acu-icon-btn:hover{background:var(--acu-btn-hover);color:var(--acu-text-main)}.acu-dimension-toolbar .acu-icon-btn.active{background:var(--acu-title-color);color:#fff}.acu-dimension-toolbar .acu-icon-btn.migrate-in{color:var(--acu-title-color)}.acu-dimension-toolbar .acu-icon-btn.migrate-in:hover{background:var(--acu-title-color-bg)}.dimension-container.is-selected{border-color:var(--acu-title-color);box-shadow:0 0 0 2px var(--acu-title-color-bg)}.dimension-container.is-selected .dimension-header{background:var(--acu-title-color-bg)}.acu-preset-option.migrate-disabled{opacity:.6;cursor:not-allowed}.acu-preset-option.migrate-target .acu-preset-delete-btn{display:none}.acu-migrate-hint{font-size:10px;color:var(--acu-text-sub);padding:2px 6px;background:var(--acu-table-head);border-radius:3px}.acu-preset-header{position:sticky;top:0;margin:0 0 16px;padding:12px 16px;z-index:10;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border)}.acu-preset-header .acu-settings-row{margin-bottom:0}.acu-preset-header .hint{white-space:nowrap}.acu-preset-control{display:flex;align-items:center;gap:8px;margin-left:auto;justify-content:flex-end}.acu-preset-dropdown{position:relative;flex:1;min-width:120px;max-width:200px}.acu-preset-dropdown.open .acu-preset-dropdown-btn i{transform:rotate(180deg)}.acu-preset-dropdown-btn{display:flex;align-items:center;justify-content:space-between;width:100%;padding:8px 12px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);font-size:13px;cursor:pointer;transition:all .2s ease}.acu-preset-dropdown-btn:hover{border-color:var(--acu-text-sub)}.acu-preset-dropdown-btn .acu-preset-selected-name{flex:1;text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-preset-dropdown-btn i{font-size:10px;color:var(--acu-text-sub);transition:transform .2s ease;margin-left:8px}.acu-preset-dropdown-menu{position:absolute;top:100%;left:0;right:0;margin-top:4px;max-height:200px;overflow-y:auto;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:8px;box-shadow:0 4px 16px rgba(0,0,0,.15);z-index:100}.acu-preset-option{display:flex;align-items:center;padding:10px 12px;cursor:pointer;transition:background .15s ease}.acu-preset-option:hover{background:var(--acu-btn-hover)}.acu-preset-option.active{background:var(--acu-title-color-bg);color:var(--acu-title-color)}.acu-preset-option:first-child{border-radius:7px 7px 0 0}.acu-preset-option:last-child{border-radius:0 0 7px 7px}.acu-preset-option .acu-preset-option-name{flex:1;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-preset-option .acu-preset-delete-btn{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;border-radius:4px;color:var(--acu-text-sub);cursor:pointer;opacity:0;transition:all .15s ease}.acu-preset-option .acu-preset-delete-btn:hover{background:rgba(231,76,60,.1);color:#e74c3c}.acu-preset-option .acu-preset-delete-btn i{font-size:10px}.acu-preset-option:hover .acu-preset-delete-btn{opacity:1}.acu-preset-actions{display:flex;gap:8px}.acu-global-widget{width:100%;height:auto;min-height:100%;display:block;color:var(--acu-text-main);position:relative}.acu-global-header{display:flex;flex-direction:row;align-items:center;justify-content:space-between;gap:16px;width:100%;padding:12px 16px;flex-wrap:wrap}.acu-global-body{display:flex;flex-wrap:wrap;gap:8px;width:100%;padding:0 16px 12px 16px}.acu-global-footer{width:100%;padding:0 16px 12px 16px}.acu-global-time-group{display:flex;align-items:center;gap:12px;flex-wrap:wrap}.acu-global-widget .acu-global-time-primary{display:flex;align-items:center;gap:8px;font-size:1.2em;font-weight:600;color:var(--acu-title-color) !important}.acu-global-widget .acu-global-time-primary span{color:var(--acu-title-color) !important;font-size:inherit}.acu-global-widget .acu-global-time-primary i{opacity:.8}.acu-global-time-secondary{display:flex;gap:8px}.acu-global-widget .acu-global-location{display:flex;align-items:center;gap:10px;font-size:1.3em;font-weight:600;line-height:1.4;color:var(--acu-text-main) !important}.acu-global-widget .acu-global-location *{font-size:inherit}.acu-global-widget .acu-global-location i{color:var(--acu-title-color) !important;font-size:.9em;flex-shrink:0;opacity:.8}.acu-global-widget .acu-global-location .location-path{display:flex;flex-wrap:wrap;align-items:center;gap:6px}.acu-global-widget .acu-global-location .location-part{font-weight:500;color:var(--acu-text-main) !important}.acu-global-widget .acu-global-location .location-part:last-child{color:var(--acu-title-color) !important;font-weight:600}.acu-global-widget .acu-global-location .location-sep{color:var(--acu-text-sub) !important;font-size:.8em;opacity:.6}.acu-global-item{display:flex;align-items:center;background:rgba(0,0,0,.03);border-radius:var(--acu-radius-md);padding:6px 10px;font-size:.95em;transition:all .2s ease;border:1px solid rgba(0,0,0,0)}.acu-theme-dark .acu-global-item{background:hsla(0,0%,100%,.05)}.acu-global-item:hover{background:var(--acu-table-hover);border-color:var(--acu-border)}.acu-global-item.layout-inline{width:auto;flex-grow:1;max-width:48%;min-width:120px}.acu-global-item.layout-inline.people-group{max-width:100%}.acu-global-item.layout-block{width:100%;background:rgba(0,0,0,.02)}.acu-global-item.layout-block .item-value{white-space:normal}.acu-global-item .item-icon{flex-shrink:0;width:20px;text-align:center;margin-right:8px;color:var(--acu-text-sub);font-size:.9em}.acu-global-item .item-content{display:flex;flex-direction:column;flex:1;min-width:0}.acu-global-item .item-label{font-size:.75em;color:var(--acu-text-sub);margin-bottom:2px}.acu-global-item .item-value{font-weight:500;color:var(--acu-text-main);line-height:1.3}.acu-global-person-list{display:flex;flex-wrap:wrap;gap:6px;width:100%;padding-top:4px}.acu-global-person-list .person-tag{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;background:var(--acu-badge-bg);border-radius:12px;font-size:.85em;color:var(--acu-text-main);border:1px solid rgba(0,0,0,0);transition:all .2s}.acu-global-person-list .person-tag:hover{border-color:var(--acu-title-color);color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-global-person-list .person-tag:hover i{opacity:1}.acu-badge-outline{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border:1px solid var(--acu-border);border-radius:10px;font-size:.85em;color:var(--acu-text-sub);white-space:nowrap}.acu-badge-outline i{font-size:.9em}.acu-badge-outline.is-highlight{color:var(--acu-title-color);border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.rwp-header{cursor:pointer}.rwp-body{padding:8px;max-height:400px;overflow-y:auto}.rwp-column-group{margin-bottom:8px;border-radius:8px;background:var(--acu-card-bg)}.rwp-column-group:last-child{margin-bottom:0}.rwp-column-group.collapsed .rwp-group-content{display:none}.rwp-group-header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:var(--acu-table-head);cursor:pointer;transition:background .15s ease;border-radius:8px}.rwp-group-header:hover{background:var(--acu-table-hover)}.rwp-group-header .rwp-header-left{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--acu-text-main)}.rwp-group-header .rwp-header-left i{font-size:10px;color:var(--acu-text-sub);transition:transform .2s ease}.rwp-group-header .rwp-column-name{font-weight:500}.rwp-group-header .rwp-word-count{font-size:11px;color:var(--acu-text-sub)}.rwp-group-header .rwp-header-right{display:flex;align-items:center;gap:8px}.rwp-limit-wrapper{position:relative;display:flex;align-items:center}.rwp-limit-popover{position:absolute;top:calc(100% + 8px);right:0;width:200px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:var(--acu-radius-md);box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:100;padding:12px;cursor:default}.rwp-limit-popover .popover-header{font-size:12px;color:var(--acu-text-sub);margin-bottom:8px}.rwp-limit-popover .popover-body{display:flex;flex-direction:column;gap:8px}.rwp-limit-popover .limit-control{display:flex;align-items:center;gap:8px}.rwp-limit-popover .limit-control input[type=range]{flex:1}.rwp-limit-popover .limit-control .limit-value{font-size:13px;font-weight:500;min-width:32px;text-align:right}.rwp-limit-popover .popover-actions{display:flex;justify-content:flex-end}.rwp-group-content{display:flex;flex-wrap:wrap;gap:6px;padding:10px 12px;background:var(--acu-card-bg);border-top:1px solid var(--acu-border)}.rwp-word-badge{display:inline-flex;align-items:center;padding:4px 10px;font-size:12px;color:var(--acu-text-main);background:var(--acu-btn-bg);border-radius:12px;transition:all .15s ease}.rwp-word-badge:hover{background:var(--acu-btn-hover)}.rwp-word-badge.disabled{opacity:.5;color:var(--acu-text-sub)}.rwp-empty-hint{font-size:12px;color:var(--acu-text-sub);font-style:italic}@media (max-width:768px){.rwp-body{max-height:300px}.rwp-group-header{padding:8px 10px}.rwp-group-content{padding:8px 10px}.rwp-word-badge{padding:3px 8px;font-size:11px}}.acu-modal-container{position:fixed;top:0;left:0;right:0;bottom:0;width:100vw !important;height:100vh !important;z-index:2147483647;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);animation:acu-fadeIn .2s ease;pointer-events:auto !important}.acu-modal{position:relative;width:90%;max-width:500px;max-height:80vh;background:var(--acu-bg-panel);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.3);display:flex;flex-direction:column;overflow:hidden;animation:acu-slideUp .3s ease}.acu-modal-header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--acu-border);background:var(--acu-table-head)}.acu-modal-header h3{margin:0;font-size:16px;font-weight:600;color:var(--acu-text-main);display:flex;align-items:center;gap:8px}.acu-modal-header h3 i{color:var(--acu-title-color)}.acu-modal-close{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);font-size:18px;cursor:pointer;border-radius:8px;transition:all .2s ease}.acu-modal-close:hover{background:rgba(231,76,60,.15);color:#e74c3c}.acu-modal-body{flex:1;padding:20px;overflow-y:auto;overflow-x:hidden;scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-modal-body::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-modal-body::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-modal-body::-webkit-scrollbar-thumb{background:var(--acu-border) !important;border-radius:3px !important}.acu-modal-body::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important}.acu-modal-body::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-modal-footer{display:flex;align-items:center;justify-content:flex-end;gap:12px;padding:16px 20px;border-top:1px solid var(--acu-border);background:var(--acu-bg-panel)}.acu-close-pill{background-color:var(--acu-text-main,#333) !important;color:var(--acu-bg-panel,#fff) !important;border:none !important;padding:6px 20px;border-radius:20px;font-weight:bold;font-size:13px;cursor:pointer;box-shadow:0 4px 10px var(--acu-title-color-bg,rgba(74,158,255,0.2));transition:transform .2s,filter .2s;display:inline-flex;align-items:center;justify-content:center;margin-left:auto}.acu-close-pill:hover{filter:brightness(0.85);transform:scale(1.05)}.modal-enter-active,.modal-leave-active{transition:opacity .2s ease}.modal-enter-active .acu-modal,.modal-leave-active .acu-modal{transition:transform .3s cubic-bezier(0.4,0,0.2,1)}.modal-enter-from,.modal-leave-to{opacity:0}.modal-enter-from .acu-modal,.modal-leave-to .acu-modal{transform:scale(0.95) translateY(-20px)}#toast-container .acu-toast{position:relative !important;left:auto !important;top:auto !important;transform:none !important;margin:0 auto 6px !important}.acu-app .acu-toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:2147483647;display:flex;align-items:center;gap:10px;padding:14px 24px;border-radius:12px;font-size:14px;font-weight:500;box-shadow:0 8px 32px rgba(0,0,0,.25);backdrop-filter:blur(10px);pointer-events:none;background:var(--acu-bg-panel);color:var(--acu-text-main);border:1px solid var(--acu-border)}.acu-app .acu-toast i{font-size:18px;flex-shrink:0;color:var(--acu-text-main)}.acu-app .acu-toast .acu-toast-message{max-width:300px;line-height:1.4}.acu-app .toast-enter-active,.acu-app .toast-leave-active{transition:all .35s cubic-bezier(0.4,0,0.2,1)}.acu-app .toast-enter-from{opacity:0;transform:translateX(-50%) translateY(-20px) scale(0.9)}.acu-app .toast-leave-to{opacity:0;transform:translateX(-50%) translateY(-10px) scale(0.95)}.acu-graph-settings-modal{max-width:480px}.acu-graph-settings-modal .acu-modal-body{padding:0}.acu-background-config-section{margin-top:12px}.acu-background-preview-container{margin-bottom:12px}.acu-background-preview{position:relative;width:100%;height:150px;border:1px solid var(--acu-border);border-radius:12px;background:var(--acu-table-head);overflow:hidden;cursor:grab;-webkit-user-select:none;user-select:none;transition:border-color .2s ease}.acu-background-preview.dragging{cursor:grabbing;border-color:var(--acu-title-color)}.acu-background-preview.has-image{background:rgba(0,0,0,0)}.acu-background-preview:hover{border-color:var(--acu-title-color)}.acu-preview-image{width:100%;height:100%;background-size:cover;background-position:center;background-repeat:no-repeat;transition:background-position .05s ease}.acu-no-image-hint{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:8px;color:var(--acu-text-sub)}.acu-no-image-hint i{font-size:32px;opacity:.5}.acu-no-image-hint span{font-size:12px;opacity:.7}.acu-background-actions{display:flex;gap:8px;margin-bottom:12px}.acu-background-actions .acu-action-btn{flex:1;height:36px;font-size:13px;gap:6px}.acu-background-actions .acu-action-btn i{font-size:14px}.acu-url-input-row{margin-bottom:12px}.acu-url-input-row .acu-background-url-input{width:100%;padding:10px 12px !important;background:var(--acu-btn-bg) !important;border:1px solid var(--acu-border) !important;border-radius:8px !important;color:var(--acu-text-main) !important;font-size:12px !important;font-family:monospace !important}.acu-url-input-row .acu-background-url-input:focus{border-color:var(--acu-title-color) !important;box-shadow:0 0 0 2px var(--acu-title-color-bg) !important}.acu-url-input-row .acu-background-url-input::placeholder{color:var(--acu-text-sub) !important;opacity:.7 !important}.acu-faction-color-hint{display:flex;align-items:center;gap:16px;padding:8px 16px;margin-bottom:8px;font-size:11px;color:var(--acu-text-sub)}.acu-faction-color-hint .hint-item{display:flex;align-items:center;gap:4px}.acu-faction-color-hint .hint-box{width:14px;height:14px;border-radius:3px}.acu-faction-color-hint .hint-box.dashed{border:2px dashed var(--acu-text-sub);background:rgba(0,0,0,0)}.acu-faction-color-hint .hint-box.solid{background:var(--acu-text-sub);opacity:.3}.acu-faction-color-group{padding:12px 16px;background:var(--acu-table-head);border-radius:12px;border:none}.acu-faction-color-group.acu-faction-color-scrollable{max-height:200px;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--acu-border) rgba(0,0,0,0)}.acu-faction-color-group.acu-faction-color-scrollable::-webkit-scrollbar{width:6px}.acu-faction-color-group.acu-faction-color-scrollable::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.acu-faction-color-group.acu-faction-color-scrollable::-webkit-scrollbar-thumb{background:var(--acu-border);border-radius:3px}.acu-faction-color-group.acu-faction-color-scrollable::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub)}.acu-faction-color-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0}.acu-faction-color-row:not(:last-child){border-bottom:1px solid var(--acu-border)}.acu-faction-color-row .acu-settings-label{flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:13px;font-weight:500;color:var(--acu-text-main)}.acu-faction-color-control{display:flex;align-items:center;gap:8px;flex-shrink:0}.acu-faction-color-control input[type=color]{width:28px !important;height:28px !important}.acu-faction-color-control .acu-opacity-slider{width:60px !important;height:14px !important}.acu-faction-color-control .acu-opacity-value{font-size:11px;color:var(--acu-text-sub);width:32px;text-align:right}.acu-legend-items-section{margin-top:12px}.acu-legend-items-header{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;font-size:12px;font-weight:500;color:var(--acu-text-sub)}.acu-legend-items-list{max-height:200px;overflow-y:auto;padding:8px 16px;background:var(--acu-table-head);border-radius:12px;margin:0 16px;scrollbar-width:thin;scrollbar-color:var(--acu-border) rgba(0,0,0,0)}.acu-legend-items-list::-webkit-scrollbar{width:6px}.acu-legend-items-list::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.acu-legend-items-list::-webkit-scrollbar-thumb{background:var(--acu-border);border-radius:3px}.acu-legend-items-list::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub)}.acu-legend-item-row{padding:10px 0;display:flex;align-items:center;justify-content:space-between;gap:8px}.acu-legend-item-row:not(:last-child){border-bottom:1px solid var(--acu-border)}.acu-legend-item-display{display:flex;align-items:center;gap:8px;flex:1;min-width:0}.acu-legend-color-dot{width:14px;height:14px;border-radius:50%;flex-shrink:0;box-shadow:0 1px 3px rgba(0,0,0,.15)}.acu-legend-emoji{font-size:14px;flex-shrink:0}.acu-legend-label{font-size:13px;font-weight:500;color:var(--acu-text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-legend-keywords{display:flex;align-items:center;gap:4px;flex-wrap:wrap;margin-left:auto}.acu-legend-keyword-tag{font-size:10px;padding:2px 6px;background:var(--acu-btn-bg);color:var(--acu-text-sub);border-radius:4px;white-space:nowrap}.acu-legend-keyword-more{font-size:10px;color:var(--acu-text-sub)}.acu-legend-item-actions{display:flex;align-items:center;gap:4px;flex-shrink:0}.acu-legend-action-btn{width:28px;height:28px;display:flex;align-items:center;justify-content:center;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);border-radius:6px;cursor:pointer;transition:all .2s ease}.acu-legend-action-btn:hover{background:var(--acu-btn-bg);color:var(--acu-text-main)}.acu-legend-action-btn.acu-legend-action-btn-danger:hover{background:rgba(231,76,60,.15);color:#e74c3c}.acu-legend-action-btn i{font-size:12px}.acu-legend-item-edit{flex:1;display:flex;flex-direction:column;gap:8px}.acu-legend-edit-row{display:flex;align-items:center;gap:8px}.acu-legend-input{flex:1;min-width:80px;padding:6px 10px !important;font-size:12px !important}.acu-legend-color-input{width:32px !important;height:32px !important;padding:2px !important;flex-shrink:0}.acu-legend-emoji-input{width:48px !important;padding:6px 8px !important;font-size:14px !important;text-align:center;flex-shrink:0}.acu-legend-keywords-input{flex:1;padding:6px 10px !important;font-size:12px !important}.acu-legend-edit-actions{display:flex;align-items:center;gap:6px;justify-content:flex-end}.acu-legend-empty{padding:16px;text-align:center;color:var(--acu-text-sub);font-size:12px}.acu-legend-reset-wrapper{margin-top:12px;padding:0 16px;display:flex;justify-content:center}.acu-action-btn-small{padding:6px 12px !important;font-size:12px !important}.acu-action-btn-small i{font-size:11px !important}.acu-action-btn-primary{background:var(--acu-title-color) !important;color:#fff !important}.acu-action-btn-primary:hover{filter:brightness(1.1)}.acu-faction-settings-modal{max-width:400px}.acu-faction-settings-modal .acu-modal-body{padding:0;padding-bottom:var(--acu-safe-area-bottom,20px)}.acu-faction-settings-modal .acu-action-row{display:flex;justify-content:space-between;gap:12px}.acu-faction-settings-modal .acu-action-row .acu-action-btn{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;padding:10px 16px;border:none;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s ease}.acu-faction-settings-modal .acu-action-row .acu-action-btn i{font-size:12px}.acu-faction-settings-modal .acu-action-row .acu-action-btn-primary{background:var(--acu-title-color);color:#fff}.acu-faction-settings-modal .acu-action-row .acu-action-btn-primary:hover{filter:brightness(1.1)}.acu-faction-settings-modal .acu-action-row .acu-action-btn-secondary{background:var(--acu-btn-bg);color:var(--acu-text-main)}.acu-faction-settings-modal .acu-action-row .acu-action-btn-secondary:hover{background:var(--acu-btn-hover)}.acu-node-config-modal{max-width:420px}.acu-node-config-modal .acu-modal-body{padding:0;padding-bottom:var(--acu-safe-area-bottom,20px)}.acu-node-config-modal .acu-node-hint{font-size:12px;color:var(--acu-text-sub);margin-bottom:12px}.acu-node-config-modal .acu-char-selector{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}.acu-node-config-modal .acu-char-btn{min-width:36px;height:36px;padding:0 12px;border:2px solid var(--acu-border);border-radius:8px;background:var(--acu-btn-bg);color:var(--acu-text-main);font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease}.acu-node-config-modal .acu-char-btn:hover{border-color:var(--acu-title-color);background:var(--acu-btn-hover)}.acu-node-config-modal .acu-char-btn.active{border-color:var(--acu-title-color);background:var(--acu-title-color);color:#fff}.acu-node-config-modal .acu-node-preview{font-size:13px;color:var(--acu-text-main);padding:8px 12px;background:var(--acu-card-bg);border-radius:6px;margin-bottom:12px}.acu-node-config-modal .acu-node-config-actions{display:flex;justify-content:flex-end;gap:8px}.acu-node-config-modal .acu-node-config-actions .acu-action-btn{padding:8px 16px;border:none;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s ease}.acu-node-config-modal .acu-node-config-actions .acu-action-btn.secondary{background:var(--acu-btn-bg);color:var(--acu-text-main)}.acu-node-config-modal .acu-node-config-actions .acu-action-btn.secondary:hover{background:var(--acu-btn-hover)}.acu-node-config-modal .acu-node-config-actions .acu-action-btn.primary{background:var(--acu-title-color);color:#fff}.acu-node-config-modal .acu-node-config-actions .acu-action-btn.primary:hover{filter:brightness(1.1)}.acu-node-config-modal .acu-action-row{display:flex;justify-content:space-between;gap:12px}.acu-node-config-modal .acu-action-row .acu-action-btn{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;padding:10px 16px;border:none;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s ease}.acu-node-config-modal .acu-action-row .acu-action-btn i{font-size:12px}.acu-node-config-modal .acu-action-row .acu-action-btn-primary{background:var(--acu-title-color);color:#fff}.acu-node-config-modal .acu-action-row .acu-action-btn-primary:hover{filter:brightness(1.1)}.acu-node-config-modal .acu-action-row .acu-action-btn-secondary{background:var(--acu-btn-bg);color:var(--acu-text-main)}.acu-node-config-modal .acu-action-row .acu-action-btn-secondary:hover{background:var(--acu-btn-hover)}.acu-input-floor-modal{max-width:400px}.floor-input-group{display:flex;flex-direction:column;gap:12px}.floor-input{width:100%;padding:12px 16px;font-size:16px;text-align:center;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main)}.floor-input:focus{outline:none;border-color:var(--acu-title-color)}.floor-hint{font-size:12px;color:var(--acu-text-sub);text-align:center}.floor-info{display:flex;align-items:center;gap:8px;padding:12px;background:var(--acu-table-head);border-radius:8px;font-size:13px;color:var(--acu-text-sub)}.floor-info i{color:var(--acu-title-color)}.floor-error{display:flex;align-items:center;gap:8px;padding:10px 12px;background:rgba(231,76,60,.1);border:1px solid rgba(231,76,60,.3);border-radius:8px;font-size:13px;color:#e74c3c}.acu-purge-overlay{display:flex !important;align-items:center !important;justify-content:center !important;padding-top:0 !important}.acu-purge-range-modal{width:85%;max-width:360px;height:auto;margin:0;box-shadow:0 25px 50px rgba(0,0,0,.5);overflow:visible;border-radius:16px;background:var(--acu-bg-panel)}.acu-purge-title{text-align:center;border-bottom:none;padding:25px 20px 0 20px;font-size:18px;font-weight:600;color:var(--acu-text-main)}.acu-purge-content{padding:20px 30px;display:flex;flex-direction:column;align-items:center;gap:15px}.acu-purge-icon{width:50px;height:50px;background:rgba(231,76,60,.15);color:#e74c3c;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;margin-bottom:5px}.acu-purge-hint{font-size:13px;color:var(--acu-text-sub);margin:0;text-align:center;line-height:1.4}.acu-purge-hint-sub{opacity:.7;font-size:12px}.acu-purge-inputs{display:flex;gap:10px;align-items:center;justify-content:center;width:100%}.acu-purge-input{text-align:center;font-size:20px;font-weight:bold;height:50px;width:100px;border-radius:12px;background:var(--acu-input-bg,var(--acu-btn-bg));border:2px solid var(--acu-border);color:var(--acu-text-main);transition:border-color .2s ease}.acu-purge-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-purge-input::placeholder{color:var(--acu-text-sub);opacity:.5;font-weight:normal;font-size:14px}.acu-purge-input::-webkit-outer-spin-button,.acu-purge-input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.acu-purge-input[type=number]{-moz-appearance:textfield}.acu-purge-separator{font-weight:bold;color:var(--acu-text-main);font-size:18px}.acu-purge-btns{padding:0 20px 25px 20px;border-top:none;display:flex;justify-content:space-between;gap:10px}.acu-purge-btn{flex:1;display:flex;justify-content:center;align-items:center;padding:10px;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;border:none;transition:all .2s ease}.acu-purge-btn-cancel{background:var(--acu-btn-bg);color:var(--acu-text-main)}.acu-purge-btn-cancel:hover{background:var(--acu-btn-hover)}.acu-purge-btn-confirm{background:#e74c3c;color:#fff}.acu-purge-btn-confirm:hover:not(:disabled){background:#c0392b}.acu-purge-btn-confirm:disabled{opacity:.5;cursor:not-allowed}.acu-purge-btn-advanced{flex:0 0 auto;background:rgba(0,0,0,0);color:var(--acu-text-sub);border:1px solid var(--acu-border);gap:6px}.acu-purge-btn-advanced:hover{background:var(--acu-btn-bg);color:var(--acu-title-color);border-color:var(--acu-title-color)}.acu-purge-btn-advanced i{font-size:12px}.acu-purge-btns-right{display:flex;gap:10px;flex:1}.acu-advanced-purge-modal{max-width:520px;max-height:85vh}.acu-advanced-purge-modal .acu-modal-body{padding:16px;overflow-y:auto;max-height:calc(85vh - 120px)}.acu-purge-range-row{display:flex;align-items:center;justify-content:center;gap:12px;padding:8px 0}.acu-purge-range-row .acu-purge-input{width:100px;height:44px;font-size:18px}.acu-purge-range-row .acu-purge-separator{font-size:20px;color:var(--acu-text-sub)}.acu-purge-range-hint{display:flex;align-items:center;justify-content:center;gap:6px;margin-top:8px;font-size:12px;color:var(--acu-text-sub)}.acu-purge-range-hint i{font-size:11px}.acu-purge-quick-actions{display:flex;justify-content:center;gap:8px;margin-top:8px}.acu-purge-warning{display:flex;align-items:center;gap:10px;margin-top:12px;padding:12px 16px;background:rgba(231,76,60,.1);border:1px solid rgba(231,76,60,.3);border-radius:10px;color:#e74c3c;font-size:13px}.acu-purge-warning i{font-size:16px;flex-shrink:0}.acu-purge-warning span{line-height:1.4}@media (max-width:768px){.acu-advanced-purge-modal{max-width:none;max-height:70vh}.acu-advanced-purge-modal .acu-modal-body{max-height:calc(70vh - 120px)}.acu-purge-range-row .acu-purge-input{width:80px;height:40px;font-size:16px}}.acu-add-table-modal{max-width:520px;max-height:85vh}.acu-add-table-modal .acu-modal-body{padding:16px;overflow-y:auto;max-height:calc(85vh - 120px);display:flex;flex-direction:column;gap:16px}.acu-add-table-tabs{display:flex;gap:8px;border-bottom:1px solid var(--acu-border);padding-bottom:8px;margin-bottom:8px}.acu-add-table-paste{display:flex;flex-direction:column;gap:12px}.acu-add-table-paste .acu-textarea-scrollable{min-height:150px;font-family:monospace;font-size:12px}.acu-add-table-file{display:flex;justify-content:center;padding:20px 0}.acu-add-table-file .acu-file-label{display:flex;flex-direction:column;align-items:center;gap:12px;padding:30px;border:2px dashed var(--acu-border);border-radius:12px;cursor:pointer;transition:all .2s ease;width:100%;max-width:300px;background:var(--acu-bg-panel)}.acu-add-table-file .acu-file-label:hover{border-color:var(--acu-title-color);background:var(--acu-btn-hover)}.acu-add-table-file .acu-file-label i{font-size:32px;color:var(--acu-text-sub)}.acu-add-table-file .acu-file-label span{font-size:14px;color:var(--acu-text-main)}.acu-add-table-error{display:flex;align-items:center;gap:8px;padding:10px 12px;background:rgba(231,76,60,.1);border:1px solid rgba(231,76,60,.3);border-radius:8px;font-size:13px;color:#e74c3c;word-break:break-all}.acu-add-table-error i{flex-shrink:0}.acu-add-table-list{display:flex;flex-direction:column;gap:12px;border-top:1px solid var(--acu-border);padding-top:16px}@media (max-width:768px){.acu-add-table-modal{max-width:none;max-height:70vh}.acu-add-table-modal .acu-modal-body{max-height:calc(70vh - 120px)}}.acu-manual-update-modal{max-width:95%;max-height:80vh}@media (min-width:601px){.acu-manual-update-modal{max-width:800px;max-height:85vh}}.acu-manual-update-modal .acu-modal-body{padding:0;overflow-y:auto;max-height:calc(80vh - 60px)}@media (min-width:601px){.acu-manual-update-modal .acu-modal-body{max-height:calc(85vh - 60px);padding:20px}}.acu-manual-update-modal .acu-settings-group{padding:12px 16px}.acu-manual-update-modal .acu-settings-row{padding:8px 0}.acu-loading-state{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:48px 20px;color:var(--acu-text-sub)}.acu-loading-state i{font-size:24px;color:var(--acu-title-color)}.acu-loading-state span{font-size:14px}.acu-config-input{width:80px;padding:8px 12px;font-size:14px;text-align:center;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);transition:all .2s ease}.acu-config-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-config-input:hover:not(:focus){border-color:var(--acu-text-sub)}.acu-config-input::-webkit-inner-spin-button,.acu-config-input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.acu-config-input{-moz-appearance:textfield}.acu-update-action-group{padding:12px 16px 16px;display:flex;flex-direction:column;align-items:center}.acu-update-btn{display:flex;align-items:center;justify-content:center;gap:10px;width:100%;padding:14px 24px;font-size:15px;font-weight:600;color:var(--acu-text-main);background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:12px;cursor:pointer;transition:all .2s ease}.acu-update-btn i{font-size:18px;color:var(--acu-title-color)}.acu-update-btn:hover:not(:disabled){background:var(--acu-btn-hover);transform:translateY(-1px)}.acu-update-btn:active:not(:disabled){transform:translateY(0)}.acu-update-btn:disabled{opacity:.7;cursor:not-allowed}.acu-update-btn.is-updating{opacity:.7}@media (max-width:768px){.acu-manual-update-modal{max-width:none;max-height:70vh}.acu-manual-update-modal .acu-modal-body{max-height:calc(70vh - 60px)}.acu-manual-update-modal .acu-config-input{width:100px}.acu-update-btn{padding:16px 24px;font-size:16px}}.acu-preset-control{display:flex;align-items:center;gap:6px;margin-left:auto}.acu-config-select{min-width:120px;padding:8px 12px;font-size:13px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);cursor:pointer;transition:all .2s ease}.acu-config-select:focus{outline:none;border-color:var(--acu-title-color)}.acu-config-select:hover:not(:focus){border-color:var(--acu-text-sub)}.acu-tool-btn.acu-btn-danger:hover{background:rgba(231,76,60,.1);border-color:#e74c3c;color:#e74c3c}.acu-issue-alert{display:flex;align-items:center;gap:10px;margin:0 16px 12px;padding:12px 16px;background:rgba(245,108,108,.1);border:1px solid rgba(245,108,108,.3);border-radius:10px;color:#f56c6c;font-size:13px}.acu-issue-alert i{font-size:16px;flex-shrink:0}.acu-issue-alert span{line-height:1.4}.acu-preset-save-modal{max-width:360px}@media (max-width:768px){.acu-preset-save-modal{width:90vw;max-width:340px;margin:auto;border-radius:16px}}.acu-preset-warning{display:flex;align-items:center;gap:8px;margin-top:12px;padding:10px 14px;background:rgba(243,156,18,.1);border:1px solid rgba(243,156,18,.3);border-radius:8px;color:#f39c12;font-size:12px}.acu-preset-warning i{font-size:14px;flex-shrink:0}.acu-preset-summary{margin-top:12px;padding:12px 14px;background:var(--acu-table-head);border-radius:8px;font-size:12px}.acu-preset-summary .acu-preset-summary-title{font-weight:600;color:var(--acu-text-main);margin-bottom:8px}.acu-preset-summary .acu-preset-summary-list{margin:0;padding-left:16px;color:var(--acu-text-sub);line-height:1.6}.acu-preset-summary .acu-preset-summary-list li{margin:2px 0}.acu-history-modal{min-width:800px;max-width:1200px;max-height:90vh}.acu-history-modal .acu-pc-only{display:block}.acu-history-modal .acu-mobile-only{display:none}.acu-history-modal .acu-modal-body{padding:0;overflow:hidden}.acu-history-layout.acu-pc-layout{display:flex;height:calc(90vh - 60px);overflow:hidden}.acu-history-layout.acu-pc-layout .acu-history-sidebar{flex:1;min-width:320px;max-width:480px;overflow-y:auto;border-right:1px solid var(--acu-border);padding:20px 24px;background:var(--acu-table-head)}.acu-history-layout.acu-pc-layout .acu-history-main{flex:1;min-width:320px;display:flex;flex-direction:column;padding:20px 24px;overflow:hidden}.acu-history-list{display:flex;flex-direction:column;gap:8px}.acu-history-item{border:1px solid var(--acu-border);border-radius:8px;background:var(--acu-card-bg);overflow:hidden}.acu-history-item[open] .acu-history-summary{border-bottom:1px solid var(--acu-border)}.acu-history-summary{padding:10px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:13px;font-weight:600;transition:background .2s;list-style:none}.acu-history-summary::-webkit-details-marker{display:none}.acu-history-summary::before{content:"▶";font-size:10px;transition:transform .2s}.acu-history-summary:hover{background:var(--acu-table-hover)}details[open]>.acu-history-summary::before{transform:rotate(90deg)}.acu-history-badge{padding:2px 6px;border-radius:4px;font-size:10px;font-weight:bold}.acu-history-badge.manual{background:var(--acu-highlight-manual-bg,rgba(211,84,0,0.15));color:var(--acu-highlight-manual,#d35400)}.acu-history-badge.ai{background:var(--acu-highlight-ai-bg,rgba(52,152,219,0.15));color:var(--acu-highlight-ai,#3498db)}.acu-history-title{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-history-time{font-size:11px;color:var(--acu-text-sub);font-weight:normal;flex-shrink:0}.acu-history-card-wrapper{padding:8px}.acu-history-card-wrapper .acu-data-card{width:100% !important;flex:none !important}.acu-current-card .acu-data-card,.acu-current-scroll .acu-data-card{width:100% !important;flex:none !important}.acu-current-card-label{display:flex;align-items:center;gap:8px;padding:8px 12px;font-size:13px;font-weight:600;color:var(--acu-text-main);background:var(--acu-table-head);border-radius:8px 8px 0 0;border:1px solid var(--acu-border);border-bottom:none}.acu-current-card-label i{color:var(--acu-title-color)}.acu-current-card-label .acu-changes-count{font-weight:normal;color:var(--acu-title-color)}.acu-current-card{flex:1;overflow-y:auto;border:1px solid var(--acu-border);border-top:none;border-radius:0 0 8px 8px;padding:8px;margin-bottom:12px}.acu-history-actions{display:flex;gap:8px;padding-top:12px;border-top:1px solid var(--acu-border);flex-wrap:wrap}.acu-history-actions .acu-btn-start-edit{flex:1}@media (max-width:768px){.acu-modal-container{align-items:flex-end;justify-content:stretch}.acu-modal{width:100%;max-width:none;max-height:85vh;border-radius:20px 20px 0 0;margin:0}.acu-settings-modal{max-width:none;max-height:85vh}.acu-settings-modal .acu-drag-handle{display:none}.acu-settings-modal .acu-modal-header{padding:10px 16px}.modal-enter-from .acu-modal,.modal-leave-to .acu-modal{transform:translateY(100%)}.acu-modal-header{position:relative;padding-top:24px}.acu-drag-handle{position:absolute;top:0;left:50%;transform:translateX(-50%);width:80px;height:20px;cursor:grab;touch-action:none;z-index:10}.acu-drag-handle::after{content:"";position:absolute;top:8px;left:50%;transform:translateX(-50%);width:36px;height:4px;background:var(--acu-border);border-radius:2px;transition:background .2s}.acu-drag-handle:active::after{background:var(--acu-title-color)}.acu-modal-header.dragging .acu-drag-handle::after{background:var(--acu-title-color)}.acu-modal-body{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch}.acu-modal-container.acu-center-modal{align-items:center !important;justify-content:center !important;padding:20px}.acu-modal-container.acu-center-modal .acu-modal{width:90%;max-width:400px;max-height:80vh;border-radius:16px;margin:0}.acu-modal-container.acu-center-modal .acu-modal-header{padding-top:16px}.acu-modal-container.acu-center-modal .acu-modal-header::before{display:none}}.acu-history-layout.acu-mobile-layout{display:none;flex-direction:column;height:calc(100vh - 60px);overflow:hidden}.acu-history-layout.acu-mobile-layout .acu-history-mobile-list{flex:1;min-height:0;overflow-y:auto;padding:12px}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-history-section{flex:1;display:flex;flex-direction:column;min-height:0;border-bottom:1px solid var(--acu-border)}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-history-section .acu-section-label{padding:8px 12px;font-size:12px;font-weight:600;color:var(--acu-text-sub);background:var(--acu-table-head);display:flex;align-items:center;gap:6px;flex-shrink:0}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-history-section .acu-section-label i{color:var(--acu-title-color)}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-history-section .acu-history-scroll{flex:1;overflow-y:auto;padding:8px}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section{flex:1.5;display:flex;flex-direction:column;min-height:0}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section .acu-section-label{padding:8px 12px;font-size:12px;font-weight:600;color:var(--acu-text-sub);background:var(--acu-table-head);display:flex;align-items:center;gap:6px;flex-shrink:0}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section .acu-section-label i{color:var(--acu-title-color)}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section .acu-section-label .acu-changes-count{color:var(--acu-title-color);font-weight:normal}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section .acu-current-scroll{flex:1;min-height:0;overflow-y:auto;padding:8px}.acu-history-layout.acu-mobile-layout .acu-mobile-actions{flex-shrink:0;padding:10px 12px;padding-bottom:calc(24px + var(--acu-safe-area-bottom,50px));background:var(--acu-bg-panel);border-top:1px solid var(--acu-border);display:flex;flex-wrap:wrap;gap:8px;box-shadow:0 -4px 12px rgba(0,0,0,.15)}.acu-history-layout.acu-mobile-layout .acu-mobile-actions button{flex:1;min-width:80px;min-height:42px;padding:8px 10px;border-radius:8px;border:1px solid var(--acu-border);background:var(--acu-btn-bg);color:var(--acu-text-main);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:4px;white-space:nowrap}.acu-history-layout.acu-mobile-layout .acu-mobile-actions button:disabled{opacity:.5;cursor:not-allowed}.acu-history-layout.acu-mobile-layout .acu-mobile-actions button.acu-btn-primary{background:var(--acu-title-color);color:#fff;border:none}.acu-history-layout.acu-mobile-layout .acu-mobile-actions button.acu-btn-preview{background:var(--acu-table-head)}.acu-history-layout.acu-mobile-layout .acu-mobile-actions button.acu-btn-done{flex-basis:100%;background:var(--acu-title-color);color:#fff;border:none}.acu-history-layout.acu-mobile-layout .acu-mobile-actions button i{font-size:12px}.acu-history-layout.acu-mobile-layout .acu-preview-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.85);z-index:2147483641;display:flex;align-items:center;justify-content:center;padding:20px;pointer-events:none}.acu-history-layout.acu-mobile-layout .acu-preview-overlay :deep(.acu-data-card){width:100%;max-height:80vh;overflow-y:auto;background:var(--acu-bg-panel);border-radius:12px;pointer-events:auto}@media (max-width:768px){.acu-history-modal{min-width:unset;max-width:none;width:100%;max-height:100vh;height:100vh;border-radius:0}.acu-history-modal .acu-pc-only{display:none !important}.acu-history-modal .acu-mobile-only{display:block !important}.acu-history-modal .acu-modal-header{border-radius:0}.acu-history-modal .acu-modal-body{flex:1;overflow:hidden}.acu-history-modal .acu-history-layout.acu-pc-layout{display:none !important}.acu-history-modal .acu-history-layout.acu-mobile-layout{display:flex !important;flex-direction:column !important;height:calc(100vh - 60px) !important}.acu-history-modal .acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode{display:flex !important;flex-direction:column !important}.acu-history-modal .acu-history-layout.acu-mobile-layout .acu-history-mobile-list{flex:1;overflow-y:auto;padding:12px;padding-bottom:calc(120px + env(safe-area-inset-bottom,20px))}.acu-history-modal .acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode{display:flex !important;flex-direction:column !important}.acu-history-modal .acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-history-section{flex:1;display:flex !important;flex-direction:column !important;min-height:0;border-bottom:1px solid var(--acu-border)}.acu-history-modal .acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-history-section .acu-section-label{padding:8px 12px;font-size:12px;font-weight:600;color:var(--acu-text-sub);background:var(--acu-table-head);display:flex;align-items:center;gap:6px;flex-shrink:0}.acu-history-modal .acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-history-section .acu-section-label i{color:var(--acu-title-color)}.acu-history-modal .acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-history-section .acu-history-scroll{flex:1;overflow-y:auto;padding:8px}.acu-history-modal .acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section{flex:1.5;display:flex !important;flex-direction:column !important;min-height:0}.acu-history-modal .acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section .acu-section-label{padding:8px 12px;font-size:12px;font-weight:600;color:var(--acu-text-sub);background:var(--acu-table-head);display:flex;align-items:center;gap:6px;flex-shrink:0}.acu-history-modal .acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section .acu-section-label i{color:var(--acu-title-color)}.acu-history-modal .acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section .acu-section-label .acu-changes-count{color:var(--acu-title-color);font-weight:normal}.acu-history-modal .acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section .acu-current-scroll{flex:1;min-height:0;overflow-y:auto;padding:8px}}.acu-ball-preview-fixed{position:sticky;top:-20px;margin:-20px -20px 16px;padding:28px 36px 12px 36px;z-index:10;display:flex;justify-content:center;align-items:center;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border)}.acu-reset-btn{position:absolute;top:24px;right:24px}.acu-settings-title-row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}.acu-settings-title-row .acu-settings-title{margin-bottom:0}.acu-preview-buttons{display:flex;gap:6px;flex-shrink:0}.acu-ball-preview{position:relative;display:flex;justify-content:center;align-items:center;width:var(--ball-size,48px);height:var(--ball-size,48px);border-radius:50%;background:var(--ball-bg-color,rgba(0,0,0,0.5));border:2px solid var(--ball-border-color-rgba,rgba(255,255,255,0.3));box-shadow:0 4px 16px rgba(0,0,0,.3);transition:transform .2s ease}.acu-ball-preview i{font-size:calc(var(--ball-size,48px)*.4);color:#fff}.acu-ball-preview img{width:70%;height:70%;border-radius:50%;object-fit:cover}.acu-anim-grid{display:flex;gap:8px;width:100%;transition:opacity .3s ease}.acu-anim-grid.disabled{opacity:.5;pointer-events:none}.acu-anim-option{flex:1;display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 12px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:10px;cursor:pointer;transition:all .2s ease}.acu-anim-option:hover{background:var(--acu-btn-hover);border-color:var(--acu-text-sub)}.acu-anim-option.active{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-anim-option .acu-anim-icon{font-size:18px;line-height:1}.acu-anim-option .acu-anim-name{font-size:12px;color:var(--acu-text-main)}.acu-color-picker-inline{display:flex;align-items:center;gap:8px}.acu-color-input{width:auto;min-width:75px;max-width:90px;padding:6px 10px;font-size:12px;font-family:monospace;text-transform:uppercase;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main)}.acu-color-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-icon-type-row{display:flex;gap:8px;width:100%}.acu-type-btn{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;padding:10px 8px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:10px;cursor:pointer;transition:all .2s ease}.acu-type-btn input[type=radio]{display:none}.acu-type-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-text-sub)}.acu-type-btn.active{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-type-btn i{font-size:16px;color:var(--acu-text-main)}.acu-type-btn .emoji-icon{font-size:16px;line-height:1}.acu-type-btn>span:last-child{font-size:12px;color:var(--acu-text-main);white-space:nowrap}.acu-image-preview-row{display:flex;align-items:center;gap:12px;margin-top:10px}.acu-preview-thumb{width:48px;height:48px;border-radius:50%;object-fit:cover;border:2px solid var(--acu-border)}.acu-preview-thumb-wrapper{width:48px;height:48px;border-radius:50%;border:2px solid var(--acu-border);background-size:cover;background-position:center;cursor:pointer;position:relative;overflow:hidden;transition:all .2s ease}.acu-preview-thumb-wrapper:hover{border-color:var(--acu-title-color)}.acu-preview-thumb-wrapper:hover .acu-edit-hint{opacity:1}.acu-preview-thumb-wrapper .acu-edit-hint{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5);color:#fff;font-size:14px;opacity:0;transition:opacity .2s ease}.acu-image-actions{display:flex;gap:8px}.acu-adjust-btn{display:flex;align-items:center;gap:4px;padding:6px 12px;background:var(--acu-title-color-bg);border:1px solid var(--acu-title-color);border-radius:6px;color:var(--acu-title-color);font-size:12px;cursor:pointer;transition:all .2s ease}.acu-adjust-btn:hover{background:var(--acu-title-color);color:#fff}.acu-adjust-btn i{font-size:10px}.acu-ball-appearance-panel{padding:0}.acu-preview-buttons{display:flex;gap:8px;margin-top:8px}.acu-anim-icon{font-size:20px;line-height:1}.acu-anim-name{font-size:11px;color:var(--acu-text-sub);margin-top:4px}.acu-theme-section{margin-bottom:24px}.acu-theme-section:last-child{margin-bottom:0}.acu-theme-section-title{display:flex;align-items:center;gap:8px;font-size:14px;font-weight:600;color:var(--acu-text-main);margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid var(--acu-border)}.acu-theme-section-title i{font-size:14px;color:var(--acu-title-color)}.acu-highlight-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}.acu-var-group{margin-bottom:16px}.acu-var-group:last-child{margin-bottom:0}.acu-var-group-header{display:flex;align-items:center;gap:8px;padding:10px 12px;background:var(--acu-table-head);border:1px solid var(--acu-border);border-radius:8px;cursor:pointer;transition:all .2s ease;-webkit-user-select:none;user-select:none}.acu-var-group-header:hover{background:var(--acu-btn-hover)}.acu-var-group-header .acu-var-group-icon{font-size:12px;color:var(--acu-text-sub);transition:transform .2s ease}.acu-var-group-header.expanded .acu-var-group-icon{transform:rotate(90deg)}.acu-css-editor{width:100%;min-height:150px;max-height:300px;padding:12px;font-family:"Consolas","Monaco",monospace;font-size:12px;line-height:1.5;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);resize:vertical}.acu-css-editor:focus{outline:none;border-color:var(--acu-title-color)}.acu-css-editor::placeholder{color:var(--acu-text-sub);opacity:.6}.acu-css-hint{margin-top:8px;padding:10px 12px;background:var(--acu-title-color-bg);border-radius:6px;font-size:11px;color:var(--acu-text-sub);line-height:1.5}.acu-css-hint p{margin:0 0 6px 0;font-weight:500;color:var(--acu-text-main)}.acu-css-hint code{display:inline-block;background:var(--acu-btn-bg);border:1px solid var(--acu-border);padding:3px 8px;border-radius:4px;font-size:11px;font-family:"Consolas","Monaco",monospace;color:var(--acu-title-color);margin:2px 4px 2px 0}.acu-theme-actions{display:flex;gap:10px;margin-top:16px;padding-top:16px;border-top:1px solid var(--acu-border)}.acu-theme-btn{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;padding:10px 12px;font-size:12px;border-radius:8px;cursor:pointer;transition:all .2s ease}.acu-theme-btn i{font-size:11px}.acu-theme-btn.btn-primary{background:var(--acu-title-color);border:1px solid var(--acu-title-color);color:#fff}.acu-theme-btn.btn-primary:hover{filter:brightness(1.1)}.acu-theme-btn.btn-secondary{background:rgba(0,0,0,0);border:1px solid var(--acu-border);color:var(--acu-text-main)}.acu-theme-btn.btn-secondary:hover{background:var(--acu-btn-hover);border-color:var(--acu-text-sub)}.acu-theme-btn.btn-danger{background:rgba(0,0,0,0);border:1px solid var(--acu-border);color:var(--acu-text-sub)}.acu-theme-btn.btn-danger:hover{background:rgba(231,76,60,.1);border-color:#e74c3c;color:#e74c3c}.acu-var-groups-container{border:1px solid var(--acu-border);border-radius:8px;overflow:hidden}.acu-var-group{margin-bottom:0;border-bottom:1px solid var(--acu-border)}.acu-var-group:last-child,.acu-var-group.last{border-bottom:none}.acu-var-group.first .acu-var-group-header{border-radius:7px 7px 0 0}.acu-var-group.last .acu-var-group-header{border-radius:0 0 7px 7px}.acu-var-group .acu-var-group-header{border-radius:0;border:none;background:var(--acu-btn-bg)}.acu-var-group .acu-var-group-header:hover{background:var(--acu-btn-hover)}.acu-var-group-body{padding:8px 12px;background:var(--acu-table-head)}.acu-var-row{display:flex;align-items:center;gap:10px;padding:10px 0}.acu-var-row:not(:last-child){border-bottom:1px solid var(--acu-border)}.acu-var-row .acu-var-label{flex:1;font-size:13px;font-weight:600;color:var(--acu-text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-var-row .acu-var-control{display:flex;align-items:center;gap:6px}.acu-var-row-tall{flex-direction:column;align-items:stretch;padding:10px 12px;gap:8px}.acu-var-line-primary{display:flex;align-items:center;justify-content:space-between;gap:10px}.acu-var-line-primary .acu-var-label{font-size:13px;font-weight:600;color:var(--acu-text-main);flex-shrink:0}.acu-var-line-secondary{display:flex;align-items:center;justify-content:space-between;gap:10px}.acu-var-name{font-size:10px;font-family:"Consolas","Monaco",monospace;color:var(--acu-text-sub);background:var(--acu-table-head);padding:2px 6px;border-radius:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline-block;max-width:-moz-fit-content;max-width:fit-content}.acu-var-color-row{display:flex;align-items:center;gap:6px;flex:1;justify-content:flex-end;min-width:0}.acu-var-color-row .acu-color-input{width:90px;padding:4px 8px;background:var(--acu-input-bg);border:1px solid var(--acu-border);border-radius:4px;color:var(--acu-text-main);font-size:12px;text-align:center;font-family:"Consolas",monospace}.acu-var-color-row .acu-color-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-var-opacity-row{display:flex;align-items:center;gap:8px}.acu-var-opacity-row .acu-range-input{-webkit-appearance:none;appearance:none;width:80px;height:6px;background:var(--acu-border);border-radius:3px;outline:none;cursor:pointer}.acu-var-opacity-row .acu-range-input::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:var(--acu-title-color);border-radius:50%;cursor:pointer;-webkit-transition:transform .2s;transition:transform .2s;filter:none !important}.acu-var-opacity-row .acu-range-input::-webkit-slider-thumb:hover{transform:scale(1.2)}.acu-var-opacity-row .acu-range-input::-moz-range-thumb{width:16px;height:16px;background:var(--acu-title-color);border-radius:50%;border:none;cursor:pointer;filter:none !important}.acu-var-opacity-row .acu-range-input::-moz-range-track{height:6px;background:var(--acu-border);border-radius:3px}.acu-opacity-value{min-width:28px;font-size:11px;color:var(--acu-text-sub);text-align:right}.acu-var-count{font-size:11px;color:var(--acu-text-sub);padding:2px 8px;background:var(--acu-btn-bg);border-radius:10px;margin-left:auto;margin-right:8px}.acu-var-reset{width:26px;height:26px;display:flex;align-items:center;justify-content:center;background:var(--acu-table-head);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-sub);cursor:pointer;transition:all .15s ease}.acu-var-reset:hover{background:var(--acu-title-color-bg);border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-var-reset i{font-size:10px}.acu-preset-save{display:flex;gap:10px;margin-top:12px}.acu-input{flex:1;padding:10px 12px;font-size:13px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);transition:border-color .2s ease}.acu-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-input::placeholder{color:var(--acu-text-sub);opacity:.7}.acu-btn{display:flex;align-items:center;justify-content:center;gap:6px;padding:10px 16px;font-size:13px;border-radius:8px;cursor:pointer;transition:all .2s ease;white-space:nowrap}.acu-btn i{font-size:12px}.acu-btn.acu-btn-primary{background:var(--acu-title-color);border:1px solid var(--acu-title-color);color:#fff}.acu-btn.acu-btn-primary:hover{filter:brightness(1.1)}.acu-btn.acu-btn-primary:disabled{opacity:.5;cursor:not-allowed}.acu-css-actions{display:flex;gap:8px;margin-bottom:10px}.acu-btn-danger:hover{background:rgba(231,76,60,.1) !important;border-color:#e74c3c !important;color:#e74c3c !important}@media (max-width:768px){.acu-highlight-grid{grid-template-columns:repeat(2,1fr)}.acu-var-row{flex-wrap:wrap}.acu-var-row .acu-var-label{width:100%;flex:none;margin-bottom:6px}.acu-var-row .acu-var-control{flex:1}.acu-var-row-tall{flex-direction:column;align-items:stretch;gap:8px}.acu-var-color-row,.acu-var-opacity-row{justify-content:flex-end}.acu-opacity-slider{flex:1;min-width:60px}.acu-preset-save{flex-direction:column}.acu-preset-save .acu-btn{width:100%}}.acu-color-input{flex:1;padding:8px 12px;font-size:13px;font-family:monospace;text-transform:uppercase;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main)}.acu-color-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-icon-option{display:flex;flex-direction:column;align-items:center;gap:6px;padding:14px 8px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:10px;cursor:pointer;transition:all .2s ease}.acu-icon-option input[type=radio]{display:none}.acu-icon-option:hover{background:var(--acu-btn-hover);border-color:var(--acu-text-sub)}.acu-icon-option.active{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-icon-option i{font-size:22px;color:var(--acu-text-main)}.acu-icon-option .emoji-icon{font-size:22px;line-height:1}.acu-icon-option>span:last-child{font-size:11px;color:var(--acu-text-sub)}.acu-icon-input-area{margin-top:12px}.acu-icon-input input,.acu-emoji-input input{width:100%;padding:10px 14px;font-size:14px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);transition:border-color .2s ease}.acu-icon-input input:focus,.acu-emoji-input input:focus{outline:none;border-color:var(--acu-title-color)}.acu-icon-input input::placeholder,.acu-emoji-input input::placeholder{color:var(--acu-text-sub);opacity:.6}.acu-emoji-input input{font-size:18px;text-align:center}.acu-input-hint{display:block;margin-top:6px;font-size:11px;color:var(--acu-text-sub);opacity:.7}.acu-image-preview{position:relative;display:inline-flex;align-items:center;justify-content:center;width:60px;height:60px;border-radius:50%;border:2px solid var(--acu-border);overflow:hidden;background:var(--acu-table-head)}.acu-image-preview img{width:100%;height:100%;object-fit:cover}@media (max-width:768px){.acu-anim-grid{grid-template-columns:repeat(2,1fr);gap:6px}.acu-anim-option,.acu-icon-option{padding:10px 6px}.acu-anim-option i,.acu-icon-option i{font-size:16px}.acu-anim-option span,.acu-icon-option span{font-size:10px}.acu-preview-buttons{flex-wrap:wrap;justify-content:center}}.acu-font-control{display:flex;align-items:center;gap:6px}.acu-font-control select{text-align:center;text-align-last:center}.acu-font-dialog-overlay{position:fixed;top:0;left:0;right:0;bottom:0;width:100vw !important;height:100vh !important;z-index:2147483647;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);padding:20px;box-sizing:border-box}@media (max-width:768px){.acu-font-dialog-overlay{padding:16px}.acu-font-dialog-overlay .acu-mini-dialog{width:100%;max-width:340px;max-height:calc(100vh - 100px);overflow-y:auto}}.acu-add-font-btn{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-sub);cursor:pointer;transition:all .2s ease;flex-shrink:0}.acu-add-font-btn:hover{background:var(--acu-title-color-bg);border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-add-font-btn i{font-size:12px}.acu-add-font-dialog{max-width:380px}.acu-font-form{display:flex;flex-direction:column;gap:14px}.acu-form-row{display:flex;flex-direction:column;gap:6px}.acu-form-row label{font-size:13px;font-weight:500;color:var(--acu-text-main)}.acu-form-row label .optional{font-weight:normal;font-size:11px;color:var(--acu-text-sub);opacity:.7}.acu-form-row input{width:100%;padding:10px 12px;font-size:13px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);transition:border-color .2s ease}.acu-form-row input:focus{outline:none;border-color:var(--acu-title-color)}.acu-form-row input::placeholder{color:var(--acu-text-sub);opacity:.6}.acu-tag-toolbar{display:flex;align-items:center;gap:8px;padding:8px;margin-bottom:8px;background:var(--acu-input-bg);border-radius:6px}.acu-displayed-tag{display:inline-flex;align-items:center;gap:4px;padding:4px 8px;background:var(--acu-title-color-bg);border:1px solid var(--acu-title-color);border-radius:4px;font-size:12px}.acu-wildcard-shortcuts{display:flex;align-items:center;gap:8px;margin-bottom:12px;flex-wrap:wrap}.acu-wildcard-shortcuts .hint{font-size:11px;color:var(--acu-text-sub)}.acu-wildcard-btn{padding:4px 8px;background:var(--acu-badge-bg);border:1px solid var(--acu-border);border-radius:4px;font-family:monospace;font-size:11px;cursor:pointer;transition:all .2s}.acu-wildcard-btn:hover{background:var(--acu-btn-hover)}.acu-mini-dialog{background:var(--acu-bg-panel);border-radius:12px;padding:16px;min-width:280px;max-width:400px;box-shadow:0 8px 32px rgba(0,0,0,.3)}.acu-mini-dialog-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--acu-border)}.acu-mini-dialog-header span{font-size:15px;font-weight:600;color:var(--acu-text-main)}.acu-mini-dialog-body{margin-bottom:16px}.acu-mini-dialog-footer{display:flex;align-items:center;justify-content:flex-end;gap:10px;padding-top:12px;border-top:1px solid var(--acu-border)}.acu-input-hint{display:block;margin-top:4px;font-size:10px;color:var(--acu-text-sub);opacity:.8}.acu-cell-menu{position:fixed;z-index:2147483647;min-width:160px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.25);padding:6px;animation:acu-scaleIn .15s ease;transform-origin:top left}.acu-menu-item{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;font-size:13px;color:var(--acu-text-main);cursor:pointer;transition:all .15s ease;white-space:nowrap}.acu-menu-item i{width:16px;text-align:center;font-size:14px;color:var(--acu-text-sub);transition:color .15s ease}.acu-menu-item:hover{background:var(--acu-btn-hover)}.acu-menu-item:hover i{color:var(--acu-title-color)}.acu-menu-item:active{transform:scale(0.98)}.acu-menu-item.danger{color:#e74c3c}.acu-menu-item.danger i{color:#e74c3c}.acu-menu-item.danger:hover{background:rgba(231,76,60,.15)}.acu-menu-item.success{color:#27ae60}.acu-menu-item.success i{color:#27ae60}.acu-menu-item.success:hover{background:rgba(46,204,113,.15)}.acu-menu-item.disabled{opacity:.5;cursor:not-allowed;pointer-events:none}.acu-menu-divider{height:1px;background:var(--acu-border);margin:6px 8px}.acu-cell-menu.compact{padding:4px}.acu-cell-menu.compact .acu-menu-item{padding:8px 12px;font-size:12px}.acu-cell-menu.compact .acu-menu-item i{font-size:12px}.acu-context-menu{position:fixed;z-index:var(--acu-z-menu,2147483648);min-width:160px;max-width:220px;background:var(--acu-menu-bg,#fff);border:1px solid var(--acu-border,#dcd0c0);border-radius:var(--acu-radius-md,12px);box-shadow:0 4px 16px rgba(0,0,0,.15),0 0 1px rgba(0,0,0,.1);padding:6px 0;outline:none;overflow:hidden;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);pointer-events:auto !important}.acu-context-menu .acu-menu-item{display:flex;align-items:center;gap:12px;padding:10px 16px;cursor:pointer;color:var(--acu-menu-text,#333);font-size:var(--acu-font-size,13px);transition:background var(--acu-transition-fast,0.15s),color var(--acu-transition-fast,0.15s);-webkit-user-select:none;user-select:none}.acu-context-menu .acu-menu-item i{width:16px;text-align:center;color:var(--acu-text-sub,#999);font-size:14px;transition:color var(--acu-transition-fast,0.15s)}.acu-context-menu .acu-menu-item span{flex:1}.acu-context-menu .acu-menu-item:hover{background:var(--acu-table-hover,#f0ebe0)}.acu-context-menu .acu-menu-item:active{background:var(--acu-btn-hover,#cbbba8)}.acu-context-menu .acu-menu-item.acu-menu-danger{color:var(--acu-danger,#e74c3c)}.acu-context-menu .acu-menu-item.acu-menu-danger i{color:var(--acu-danger,#e74c3c)}.acu-context-menu .acu-menu-item.acu-menu-danger:hover{background:rgba(231,76,60,.1)}.acu-context-menu .acu-menu-item.acu-menu-warning{color:var(--acu-warning,#f39c12)}.acu-context-menu .acu-menu-item.acu-menu-warning i{color:var(--acu-warning,#f39c12)}.acu-context-menu .acu-menu-item.acu-menu-warning:hover{background:rgba(243,156,18,.1)}.acu-context-menu .acu-menu-divider{height:1px;background:var(--acu-border,#dcd0c0);margin:6px 12px;opacity:.6}.acu-overlay{position:fixed;top:0;left:0;right:0;bottom:0;z-index:2147483640;background:rgba(0,0,0,.4);animation:acu-fadeIn .15s ease}.acu-overlay.transparent{background:rgba(0,0,0,0)}.acu-overlay.blur{backdrop-filter:blur(4px)}.acu-hidden-buttons-popup{position:absolute;bottom:calc(100% + 8px);left:0;right:0;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:8px;padding:8px;box-shadow:0 -4px 16px rgba(0,0,0,.3);z-index:100;pointer-events:auto}.acu-hidden-buttons-popup .popup-buttons-grid{display:flex;flex-wrap:wrap;gap:6px;justify-content:center}.acu-hidden-buttons-popup .popup-button{display:flex;align-items:center;justify-content:center;width:36px;height:36px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);cursor:pointer;transition:all .2s ease}.acu-hidden-buttons-popup .popup-button:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color)}.acu-hidden-buttons-popup .popup-button.btn-danger{color:#e74c3c}.acu-tabs-popup{position:absolute;bottom:calc(100% + 8px);left:0;right:0;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:12px;padding:12px;box-shadow:0 -8px 24px rgba(0,0,0,.35);z-index:100;pointer-events:auto;max-height:60vh;overflow-y:auto}.acu-tabs-popup .popup-tabs-grid{display:grid;grid-template-columns:var(--acu-nav-cols,repeat(auto-fill,minmax(90px,1fr)));gap:6px}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn{display:flex;align-items:center;justify-content:center;gap:6px;padding:8px 12px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);font-size:12px;cursor:pointer;transition:all .2s ease;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn i{font-size:14px;flex-shrink:0}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn span{overflow:hidden;text-overflow:ellipsis}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color)}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn.active{background:var(--acu-title-color-bg);border-color:var(--acu-title-color);color:var(--acu-title-color);font-weight:500}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn.has-issues{border-color:#e74c3c;box-shadow:0 0 0 2px rgba(231,76,60,.2)}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn.has-ai-changes{border-color:var(--acu-highlight-ai-color,#3498db);box-shadow:0 0 0 2px rgba(52,152,219,.2)}.acu-hidden-buttons-popup{position:absolute;bottom:calc(100% + 8px);left:0;right:0;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:8px;padding:8px;box-shadow:0 -4px 16px rgba(0,0,0,.3);z-index:100;pointer-events:auto}.acu-hidden-buttons-popup .popup-buttons-grid{display:flex;flex-wrap:wrap;gap:6px;justify-content:center}.acu-hidden-buttons-popup .popup-button{display:flex;align-items:center;justify-content:center;width:36px;height:36px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);cursor:pointer;transition:all .2s}.acu-hidden-buttons-popup .popup-button:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color);color:var(--acu-title-color);transform:translateY(-2px)}.acu-hidden-buttons-popup .popup-button:active{transform:scale(0.95)}.acu-hidden-buttons-popup .popup-button i{font-size:14px}.acu-hidden-buttons-popup .popup-button.btn-danger{color:#e74c3c}.acu-hidden-buttons-popup .popup-button.btn-danger:hover{border-color:#e74c3c;background:rgba(231,76,60,.1)}.acu-hidden-buttons-popup .popup-button.btn-toggle.active{background:var(--acu-title-color-bg,rgba(52,152,219,0.2));color:var(--acu-title-color,#3498db);border-color:var(--acu-title-color,#3498db)}.acu-more-btn.active{color:var(--acu-title-color);background:var(--acu-btn-hover)}.acu-more-btn.active i{transform:rotate(180deg)}.acu-more-btn i{transition:transform .2s ease}.acu-avatar-manager-dialog{width:90%;max-width:800px;max-height:85vh;display:flex;flex-direction:column}.acu-avatar-manager-dialog .acu-modal-body{flex:1;overflow-y:auto;padding:0;padding-bottom:var(--acu-safe-area-bottom,20px)}.acu-avatar-tab-bar{display:flex;gap:0;padding:0 12px;background:var(--acu-bg-panel);border-bottom:1px solid var(--acu-border)}.acu-avatar-tab-btn{display:flex;align-items:center;gap:6px;padding:12px 16px;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);font-size:13px;font-weight:500;cursor:pointer;position:relative;transition:all .2s ease}.acu-avatar-tab-btn i{font-size:14px}.acu-avatar-tab-btn:hover{color:var(--acu-text-main);background:var(--acu-btn-hover)}.acu-avatar-tab-btn.active{color:var(--acu-title-color);font-weight:600}.acu-avatar-tab-btn.active::after{content:"";position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:60%;height:3px;background:var(--acu-title-color);border-radius:3px 3px 0 0}.acu-avatar-search-bar{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--acu-bg-panel);border-bottom:1px solid var(--acu-border)}.acu-avatar-search-bar>i{color:var(--acu-text-sub);font-size:14px}.acu-avatar-search-input{flex:1;padding:8px 12px;font-size:13px;background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main)}.acu-avatar-search-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-avatar-search-input::placeholder{color:var(--acu-text-sub);opacity:.6}.acu-search-clear{background:none;border:none;padding:4px 8px;color:var(--acu-text-sub);cursor:pointer;font-size:12px}.acu-search-clear:hover{color:var(--acu-title-color)}.acu-avatar-loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;gap:12px;color:var(--acu-text-sub)}.acu-avatar-loading i{font-size:24px}.acu-avatar-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;gap:12px;color:var(--acu-text-sub)}.acu-avatar-empty i{font-size:32px;opacity:.5}.acu-avatar-empty p{margin:0}.acu-avatar-items{padding:8px}.acu-avatar-item{display:flex;align-items:flex-start;gap:12px;padding:12px;margin-bottom:8px;background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:12px;position:relative;transition:all .2s ease}.acu-avatar-item:last-child{margin-bottom:0}.acu-avatar-item:hover{background:var(--acu-table-hover)}.acu-avatar-item.selected{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-avatar-checkbox{display:flex;align-items:center;justify-content:center;width:24px;height:48px;cursor:pointer;color:var(--acu-text-sub)}.acu-avatar-checkbox:hover{color:var(--acu-title-color)}.acu-avatar-checkbox i{font-size:18px}.acu-avatar-column{display:flex;flex-direction:column;align-items:center;gap:4px;flex-shrink:0}.acu-avatar-preview{width:48px;height:48px;min-width:48px;border-radius:50%;background:var(--acu-btn-bg);border:2px solid var(--acu-border);display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;background-size:cover;background-position:center;background-repeat:no-repeat;transition:all .2s ease}.acu-avatar-preview:hover{border-color:var(--acu-title-color);transform:scale(1.05)}.acu-avatar-preview.has-image{border-color:var(--acu-title-color)}.acu-avatar-initial{font-size:18px;font-weight:bold;color:var(--acu-text-sub)}.acu-avatar-camera-hint{position:absolute;bottom:2px;right:2px;font-size:10px;color:var(--acu-text-sub);opacity:0;transition:opacity .2s}.acu-avatar-preview:hover .acu-avatar-camera-hint{opacity:.8}.acu-avatar-source{font-size:9px;padding:1px 4px;border-radius:3px;font-weight:500;white-space:nowrap}.acu-avatar-source.acu-source-local{background:var(--acu-title-color-bg);color:var(--acu-title-color)}.acu-avatar-source.acu-source-url{background:var(--acu-btn-bg);color:var(--acu-text-sub)}.acu-avatar-source.acu-source-auto{background:var(--acu-title-color-bg);color:var(--acu-title-color)}.acu-avatar-info{flex:1;min-width:0;display:flex;flex-direction:column;gap:8px}.acu-avatar-name-row{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}.acu-avatar-name-left{display:flex;align-items:center;gap:4px;flex:1;min-width:0}.acu-avatar-name{font-size:14px;font-weight:600;color:var(--acu-text-main);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-avatar-label-preview{font-size:12px;color:var(--acu-text-sub);flex-shrink:0}.acu-avatar-name-right{display:flex;align-items:center;gap:6px;flex-shrink:0}.acu-avatar-name-btn{padding:4px 10px;font-size:12px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);cursor:pointer;transition:all .15s}.acu-avatar-name-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color)}.acu-import-dropdown{position:relative}.acu-avatar-import-btn{padding:4px 10px;font-size:12px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);cursor:pointer;display:flex;align-items:center;gap:4px;transition:all .15s}.acu-avatar-import-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color)}.acu-avatar-import-btn i{font-size:10px}.acu-dropdown-menu{position:absolute;top:100%;right:0;margin-top:4px;background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:10;min-width:120px;overflow:hidden}.acu-dropdown-item{padding:10px 14px;font-size:13px;color:var(--acu-text-main);cursor:pointer;display:flex;align-items:center;gap:8px;transition:background .15s}.acu-dropdown-item:hover{background:var(--acu-table-hover)}.acu-dropdown-item.disabled{opacity:.5;cursor:not-allowed}.acu-dropdown-item.disabled:hover{background:rgba(0,0,0,0)}.acu-dropdown-item i{width:16px;text-align:center;color:var(--acu-text-sub)}.acu-avatar-url-row{display:flex;align-items:center;gap:8px}.acu-url-label{font-size:12px;color:var(--acu-text-sub);white-space:nowrap;min-width:35px}.acu-avatar-url-input{flex:1;padding:6px 10px;font-size:12px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);min-width:0}.acu-avatar-url-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-avatar-url-input::placeholder{color:var(--acu-text-sub);opacity:.6}.acu-avatar-alias-row{display:flex;align-items:center;gap:8px}.acu-alias-label{font-size:12px;color:var(--acu-text-sub);white-space:nowrap;min-width:35px}.acu-avatar-alias-input{flex:1;padding:6px 10px;font-size:12px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);min-width:0}.acu-avatar-alias-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-avatar-alias-input::placeholder{color:var(--acu-text-sub);opacity:.6}.acu-avatar-footer{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-top:1px solid var(--acu-border);background:var(--acu-bg-panel);gap:12px}.acu-footer-left,.acu-footer-right{display:flex;gap:8px}.acu-crop-dialog{width:90%;max-width:400px}.acu-crop-body{display:flex;flex-direction:column;gap:20px;padding:20px !important}.acu-crop-preview-wrapper{display:flex;justify-content:center}.acu-crop-preview{width:120px;height:120px;border-radius:50%;background:var(--acu-btn-bg);border:3px solid var(--acu-border);background-size:cover;background-position:center;background-repeat:no-repeat;display:flex;align-items:center;justify-content:center;position:relative;-webkit-user-select:none;user-select:none;touch-action:none}.acu-crop-preview.is-dragging{border-color:var(--acu-title-color)}.acu-crop-preview:hover:not(.is-dragging){border-color:var(--acu-title-color)}.acu-crop-placeholder{display:flex;flex-direction:column;align-items:center;gap:8px;color:var(--acu-text-sub)}.acu-crop-placeholder i{font-size:32px;opacity:.5}.acu-crop-placeholder span{font-size:12px}.acu-crop-controls{display:flex;flex-direction:column;gap:16px}.acu-crop-control-row{display:flex;align-items:center;gap:12px}.acu-crop-label{width:70px;font-size:13px;color:var(--acu-text-main);display:flex;align-items:center;gap:6px}.acu-crop-label i{width:16px;text-align:center;color:var(--acu-text-sub)}.acu-crop-slider{flex:1;height:6px;-webkit-appearance:none;background:var(--acu-border);border-radius:3px;outline:none}.acu-crop-slider::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--acu-title-color);cursor:pointer;border:2px solid var(--acu-card-bg);box-shadow:0 2px 4px rgba(0,0,0,.2)}.acu-crop-slider::-moz-range-thumb{width:18px;height:18px;border-radius:50%;background:var(--acu-title-color);cursor:pointer;border:2px solid var(--acu-card-bg);box-shadow:0 2px 4px rgba(0,0,0,.2)}.acu-crop-value{width:45px;text-align:right;font-size:12px !important;color:var(--acu-text-sub) !important;font-family:monospace !important;background:rgba(0,0,0,0) !important;border:none !important;padding:0 !important;margin:0 !important}.acu-crop-invert-section{padding:12px 0;border-top:1px solid var(--acu-border)}.acu-crop-invert-section .acu-settings-row{padding:0;border:none}.acu-crop-upload-section{display:flex;justify-content:center;padding-top:8px;border-top:1px solid var(--acu-border)}.acu-modal-footer{display:flex;justify-content:flex-end;gap:8px;padding:12px 16px;border-top:1px solid var(--acu-border)}@media (max-width:768px){.acu-avatar-manager-overlay.acu-modal-container{align-items:center;justify-content:center;padding:16px}.acu-avatar-manager-dialog{width:95%;max-height:70vh;margin:0}.acu-avatar-item{flex-wrap:wrap}.acu-avatar-name-row{flex-wrap:wrap}.acu-avatar-url-row{flex-wrap:wrap}.acu-crop-modal-overlay.acu-modal-container{align-items:center;justify-content:center;padding:16px}.acu-crop-dialog{width:95%;max-height:80vh;margin:0;display:flex;flex-direction:column}.acu-crop-body{flex:1;overflow-y:auto;padding:10px !important;gap:10px}.acu-crop-preview{width:90px;height:90px}.acu-crop-controls{gap:10px}.acu-crop-control-row{gap:8px}.acu-crop-label{width:55px;font-size:12px}.acu-crop-upload-section{padding-top:8px}}.acu-row-edit-modal{max-width:600px;max-height:85vh}.acu-row-edit-modal .acu-modal-body{padding:0;overflow:hidden}.acu-row-edit-content{padding:16px;max-height:calc(85vh - 120px);overflow-y:auto;overflow-x:hidden}.acu-row-edit-content .acu-data-card{overflow-y:visible !important;overflow-x:visible !important;max-height:none}.acu-row-edit-content .acu-data-card .acu-card-body,.acu-row-edit-content .acu-data-card .acu-card-main-grid,.acu-row-edit-content .acu-data-card .acu-card-full-area{overflow:visible}.acu-row-edit-content{scrollbar-width:thin;scrollbar-color:var(--acu-border) rgba(0,0,0,0)}.acu-row-edit-content::-webkit-scrollbar{width:6px}.acu-row-edit-content::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.acu-row-edit-content::-webkit-scrollbar-thumb{background:var(--acu-border);border-radius:3px}.acu-row-edit-content::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub)}@media (max-width:768px){.acu-modal-container:has(.acu-actions-config-modal){align-items:flex-start !important;justify-content:center !important;padding-top:10vh;padding-left:16px;padding-right:16px}.acu-actions-config-modal{width:95%;max-width:400px;max-height:55vh;border-radius:16px;margin:0;display:flex;flex-direction:column}.acu-actions-config-modal .acu-modal-body{flex:1;max-height:calc(55vh - 100px);overflow-y:auto}.acu-actions-config-modal .acu-drag-handle{display:none}.acu-actions-config-modal .acu-modal-header{padding-top:16px}}.acu-tag-manager-modal{width:90vw;max-width:1400px;height:85vh;max-height:900px;display:flex;flex-direction:column}@media (max-width:768px){.acu-tag-manager-modal{width:100vw;height:100vh;max-width:none;max-height:none;border-radius:0}}.acu-tag-manager-modal .acu-modal-body{flex:1;display:flex;flex-direction:column;min-height:0;padding:0}.acu-tag-manager-body{display:flex;flex-direction:column;flex:1;min-height:0}.acu-displayed-area{display:flex;flex-wrap:wrap;align-items:center;gap:8px;padding:12px 16px;border-bottom:1px solid var(--acu-border);min-height:50px;background:var(--acu-table-head)}.acu-displayed-area .acu-displayed-label{font-weight:500;color:var(--acu-text-sub);font-size:13px;margin-right:4px}.acu-displayed-area .acu-displayed-tag{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:16px;background:var(--acu-badge-bg);font-size:12px;cursor:pointer;transition:all .2s}.acu-displayed-area .acu-displayed-tag:hover{background:var(--acu-btn-hover)}.acu-displayed-area .acu-displayed-tag:hover .acu-remove-icon{opacity:1}.acu-displayed-area .acu-displayed-tag .acu-tag-icon{font-size:14px}.acu-displayed-area .acu-displayed-tag .acu-remove-icon{font-size:10px;opacity:.5;transition:opacity .2s}.acu-displayed-area .acu-empty-hint{color:var(--acu-text-sub);font-size:12px;font-style:italic}.acu-tag-search{display:flex;align-items:center;gap:8px;padding:8px 16px;border-bottom:1px solid var(--acu-border);background:var(--acu-card-bg)}.acu-tag-search i{color:var(--acu-text-sub)}.acu-tag-search input{flex:1;border:none;background:rgba(0,0,0,0);outline:none;font-size:13px;color:var(--acu-text-main)}.acu-tag-search input::placeholder{color:var(--acu-text-sub)}.acu-tag-search .acu-clear-search{padding:4px;border:none;background:rgba(0,0,0,0);cursor:pointer;color:var(--acu-text-sub);transition:color .2s}.acu-tag-search .acu-clear-search:hover{color:var(--acu-text-main)}.acu-mobile-only{display:none !important}@media (max-width:768px){.acu-mobile-only{display:inline-flex !important}}.acu-tag-toolbar{display:flex;align-items:center;gap:6px;padding:8px 16px;border-bottom:1px solid var(--acu-border);flex-wrap:wrap;background:var(--acu-bg-panel)}.acu-tag-toolbar .acu-mode-btn{display:inline-flex;align-items:center;gap:4px;padding:6px 12px;border-radius:6px;border:1px solid var(--acu-border);background:var(--acu-btn-bg);cursor:pointer;font-size:12px;color:var(--acu-text-main);transition:all .2s}.acu-tag-toolbar .acu-mode-btn:hover:not(:disabled){background:var(--acu-btn-hover)}.acu-tag-toolbar .acu-mode-btn:disabled{opacity:.5;cursor:not-allowed}.acu-tag-toolbar .acu-mode-btn.active{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color)}.acu-tag-toolbar .acu-mode-btn i{font-size:12px}@media (max-width:768px){.acu-tag-toolbar .acu-mode-btn .btn-label{display:none}}.acu-tag-manager{display:flex;flex:1;min-height:0;gap:0}.acu-tag-tree{width:240px;min-width:200px;overflow-y:auto;border-right:1px solid var(--acu-border);background:var(--acu-card-bg)}@media (max-width:768px){.acu-tag-tree{width:140px;min-width:120px}}.acu-tag-tree .acu-root-icon-editor{display:flex;align-items:center;gap:4px;padding:4px 8px;background:var(--acu-card-bg);border-bottom:1px solid var(--acu-border)}.acu-tag-tree .acu-root-icon-editor .acu-icon-input{width:40px;text-align:center;font-size:16px;padding:4px;border:1px solid var(--acu-border);border-radius:4px;background:var(--acu-bg-panel);color:var(--acu-text-main)}.acu-tag-tree .acu-root-icon-editor .acu-btn-small{padding:4px 8px;border:none;border-radius:4px;background:var(--acu-btn-bg);color:var(--acu-text-main);cursor:pointer}.acu-tag-tree .acu-root-icon-editor .acu-btn-small:hover{background:var(--acu-btn-hover)}.acu-tag-tree .acu-root-item{font-weight:500}.acu-tag-tree .acu-root-item .acu-edit-icon-btn{opacity:0;padding:2px 6px;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);cursor:pointer;transition:opacity .2s}.acu-tag-tree .acu-root-item .acu-edit-icon-btn:hover{color:var(--acu-title-color)}.acu-tag-tree .acu-root-item:hover .acu-edit-icon-btn{opacity:1}.acu-tag-tree .acu-tag-tree-item{display:flex;align-items:center;gap:6px;padding:10px 12px;cursor:pointer;transition:background .2s;border-left:3px solid rgba(0,0,0,0)}.acu-tag-tree .acu-tag-tree-item:hover{background:var(--acu-table-hover)}.acu-tag-tree .acu-tag-tree-item.active{background:var(--acu-title-color-bg);border-left-color:var(--acu-title-color)}.acu-tag-tree .acu-tag-tree-item.selected{outline:2px solid var(--acu-title-color);outline-offset:-2px}.acu-tag-tree .acu-tag-tree-item.sticky{position:sticky;top:0;z-index:1;background:var(--acu-bg-panel);border-bottom:1px solid var(--acu-border)}.acu-tag-tree .acu-tag-tree-item .acu-tree-toggle{width:16px;text-align:center;font-size:10px;color:var(--acu-text-sub);cursor:pointer;transition:transform .2s}.acu-tag-tree .acu-tag-tree-item .acu-tree-toggle-placeholder{width:0px}.acu-tag-tree .acu-tag-tree-item .acu-tree-icon{font-size:14px}.acu-tag-tree .acu-tag-tree-item .acu-tree-label{flex:1;font-size:13px;color:var(--acu-text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-tag-tree .acu-tag-tree-item .acu-tree-count{font-size:11px;color:var(--acu-text-sub)}.acu-tag-tree .acu-tag-tree-item .acu-add-btn,.acu-tag-tree .acu-tag-tree-item .acu-select-btn,.acu-tag-tree .acu-tag-tree-item .acu-migrate-btn,.acu-tag-tree .acu-tag-tree-item .acu-delete-btn{padding:4px 2px;border-radius:4px;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);cursor:pointer;opacity:.7;transition:all .2s;font-size:11px}.acu-tag-tree .acu-tag-tree-item .acu-add-btn:hover,.acu-tag-tree .acu-tag-tree-item .acu-select-btn:hover,.acu-tag-tree .acu-tag-tree-item .acu-migrate-btn:hover,.acu-tag-tree .acu-tag-tree-item .acu-delete-btn:hover{opacity:1;background:var(--acu-btn-hover)}.acu-tag-tree .acu-tag-tree-item .acu-add-btn.active,.acu-tag-tree .acu-tag-tree-item .acu-select-btn.active,.acu-tag-tree .acu-tag-tree-item .acu-migrate-btn.active,.acu-tag-tree .acu-tag-tree-item .acu-delete-btn.active{color:var(--acu-title-color);opacity:1}.acu-tag-tree .acu-tag-tree-item .acu-add-btn:hover{color:var(--acu-success,#28a745)}.acu-tag-tree .acu-tag-tree-item .acu-select-btn.active{color:var(--acu-title-color)}.acu-tag-tree .acu-tag-tree-item .acu-migrate-btn:hover{color:var(--acu-warning,#ffc107)}.acu-tag-tree .acu-tag-tree-item .acu-delete-btn:hover{color:var(--acu-danger,#dc3545)}.acu-tag-tree .acu-tag-tree-item:hover .acu-add-btn,.acu-tag-tree .acu-tag-tree-item:hover .acu-select-btn,.acu-tag-tree .acu-tag-tree-item:hover .acu-migrate-btn,.acu-tag-tree .acu-tag-tree-item:hover .acu-delete-btn,.acu-tag-tree .acu-tag-tree-item.migrate-target .acu-migrate-btn{opacity:1}.acu-tag-tree .acu-tree-divider{height:1px;margin:8px 12px;background:var(--acu-border)}.acu-tag-tree .acu-tree-empty{display:flex;flex-direction:column;align-items:center;gap:8px;padding:24px;color:var(--acu-text-sub);font-size:12px}.acu-tag-tree .acu-tree-empty i{font-size:24px;opacity:.5}.acu-tag-grid{flex:1;display:flex;flex-wrap:wrap;align-content:flex-start;gap:8px;padding:16px;overflow-y:auto;background:var(--acu-bg-panel)}.acu-tag-grid .acu-tag-badge{display:inline-flex;align-items:center;gap:6px;padding:8px 14px;border-radius:20px;background:var(--acu-badge-bg);font-size:13px;cursor:pointer;transition:all .2s;border:2px solid rgba(0,0,0,0)}.acu-tag-grid .acu-tag-badge:hover{transform:scale(1.05);background:var(--acu-btn-hover)}.acu-tag-grid .acu-tag-badge.selected{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-tag-grid .acu-tag-badge.added .added-icon{color:#27ae60}.acu-tag-grid .acu-tag-badge.mode-add .add-icon{color:var(--acu-text-sub);font-size:10px;transition:color .2s}.acu-tag-grid .acu-tag-badge.mode-add:hover .add-icon{color:var(--acu-title-color)}.acu-tag-grid .acu-tag-badge.mode-add.added{background-color:var(--acu-table-head);opacity:.8;cursor:default}.acu-tag-grid .acu-tag-badge.mode-add.added:hover{transform:none;background-color:var(--acu-table-head)}.acu-tag-grid .acu-tag-badge.mode-migrate,.acu-tag-grid .acu-tag-badge.mode-delete:hover{background:rgba(231,76,60,.1);border-color:#e74c3c}.acu-tag-grid .acu-tag-badge .acu-badge-icon{font-size:12px;display:flex;align-items:center}.acu-tag-grid .acu-tag-badge .acu-badge-label{color:var(--acu-text-main)}.acu-tag-grid .acu-tag-badge .acu-badge-delete{color:#e74c3c;font-size:11px}.acu-tag-grid .acu-tag-badge .acu-badge-action{font-size:11px;color:var(--acu-text-sub);transition:color .2s}.acu-tag-grid .acu-tag-badge .acu-badge-action.added{color:#27ae60}.acu-tag-grid .acu-tag-badge.mode-add:hover .acu-badge-action:not(.added){color:#27ae60}.acu-tag-grid .acu-grid-empty,.acu-tag-grid .acu-grid-create-hint{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;width:100%;padding:48px;color:var(--acu-text-sub)}.acu-tag-grid .acu-grid-empty i,.acu-tag-grid .acu-grid-create-hint i{font-size:36px;opacity:.5}.acu-tag-grid .acu-grid-empty span,.acu-tag-grid .acu-grid-create-hint span{font-size:14px}.acu-tag-grid .acu-grid-create-hint{cursor:pointer;border:2px dashed var(--acu-border);border-radius:12px;transition:all .2s}.acu-tag-grid .acu-grid-create-hint:hover{border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-tag-edit-modal{max-width:480px;width:90vw}@media (max-width:768px){.acu-tag-edit-modal{width:100vw;max-width:none;height:auto;max-height:90vh;margin:auto 0 0;border-radius:16px 16px 0 0}}.acu-tag-edit-modal .acu-header-actions{display:flex;align-items:center;gap:8px}.acu-tag-edit-modal .acu-modal-body{padding:0}.acu-tag-edit-modal .acu-modal-body input[type=text]{min-width:0;flex:1;width:100%}.acu-tag-edit-modal .acu-category-control{display:flex;gap:6px}@media (max-width:400px){.acu-tag-edit-modal .acu-category-control{flex-wrap:wrap;justify-content:flex-end;width:100%}.acu-tag-edit-modal .acu-category-control .acu-custom-select{flex:1;min-width:140px}}.acu-tag-edit-modal .acu-category-control select{flex:1;min-width:0}.acu-tag-edit-modal .acu-category-control .acu-add-btn{flex-shrink:0;padding:8px 10px;border:1px solid var(--acu-border);border-radius:6px;background:var(--acu-btn-bg);color:var(--acu-text-main);cursor:pointer;transition:all .2s}.acu-tag-edit-modal .acu-category-control .acu-add-btn:hover{background:var(--acu-btn-hover);color:var(--acu-title-color)}@media (max-width:400px){.acu-tag-edit-modal .acu-settings-row{flex-wrap:wrap}.acu-tag-edit-modal .acu-settings-row .acu-settings-label{width:100%;margin-bottom:4px}.acu-tag-edit-modal .acu-settings-row .acu-settings-control{width:100%;justify-content:flex-start}.acu-tag-edit-modal .acu-settings-row .acu-settings-control input{width:100%}.acu-tag-edit-modal .acu-settings-row.acu-category-row .acu-settings-control{justify-content:flex-end}}.acu-tag-edit-modal .acu-new-category-row{flex-direction:column !important;align-items:stretch !important;justify-content:flex-start !important;gap:8px !important;background:var(--acu-table-head);margin:-10px -16px;padding:10px 16px}.acu-tag-edit-modal .acu-new-category-row .acu-settings-label{flex:none !important;width:100% !important;flex-direction:row !important;align-items:center !important;gap:8px !important}.acu-tag-edit-modal .acu-new-category-row .acu-settings-label .hint{white-space:nowrap !important;display:inline !important}.acu-tag-edit-modal .acu-new-category-row .acu-settings-control{width:100% !important;margin-left:0}.acu-tag-edit-modal .acu-new-category-control{display:flex;gap:6px;flex-wrap:nowrap}.acu-tag-edit-modal .acu-new-category-control input[type=text]{flex:1;min-width:80px}.acu-tag-edit-modal .acu-new-category-control .acu-icon-input{width:50px !important;flex:none !important;text-align:center}.acu-tag-edit-modal .acu-textarea{width:100% !important;padding:10px 12px !important;border:1px solid var(--acu-border) !important;border-radius:6px !important;background:var(--acu-btn-bg) !important;color:var(--acu-text-main) !important;font-size:13px !important;font-family:inherit !important;resize:vertical !important;min-height:80px !important;outline:none !important;box-sizing:border-box !important;transition:border-color .2s}.acu-tag-edit-modal .acu-textarea:focus{border-color:var(--acu-title-color) !important;box-shadow:0 0 0 2px var(--acu-title-color-bg) !important}.acu-tag-edit-modal .acu-textarea::placeholder{color:var(--acu-text-sub) !important;opacity:.7 !important}.acu-tag-edit-modal .acu-wildcard-shortcuts{display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:8px 0}.acu-tag-edit-modal .acu-wildcard-shortcuts .hint{color:var(--acu-text-sub);font-size:12px}.acu-tag-edit-modal .acu-wildcard-shortcuts .acu-wildcard-btn{padding:4px 10px;border-radius:4px;background:rgba(0,0,0,0) !important;border:none !important;cursor:pointer;font-family:monospace;font-size:12px;color:var(--acu-text-sub) !important;transition:all .2s;opacity:.6}.acu-tag-edit-modal .acu-wildcard-shortcuts .acu-wildcard-btn:hover{opacity:1;color:var(--acu-title-color) !important}.acu-tag-edit-modal .acu-wildcard-shortcuts .acu-wildcard-btn code{font-family:inherit;background:rgba(0,0,0,0) !important;color:inherit !important;padding:0 !important;border:none !important}.acu-tag-edit-modal .acu-wildcard-help{background:var(--acu-table-head);border-radius:8px;overflow:hidden;margin-top:8px}.acu-tag-edit-modal .acu-wildcard-help .acu-help-header{display:flex;align-items:center;gap:8px;padding:10px 12px;cursor:pointer;transition:background .2s}.acu-tag-edit-modal .acu-wildcard-help .acu-help-header:hover{background:var(--acu-table-hover)}.acu-tag-edit-modal .acu-wildcard-help .acu-help-header i:first-child{color:#f39c12}.acu-tag-edit-modal .acu-wildcard-help .acu-help-header i:last-child{margin-left:auto;font-size:10px;color:var(--acu-text-sub)}.acu-tag-edit-modal .acu-wildcard-help ul{margin:0;padding:0 12px 12px 36px;font-size:12px;color:var(--acu-text-sub)}.acu-tag-edit-modal .acu-wildcard-help ul li{margin:6px 0}.acu-tag-edit-modal .acu-wildcard-help ul code{background:var(--acu-card-bg) !important;padding:2px 6px !important;border-radius:3px !important;font-family:monospace !important;font-size:11px !important;color:var(--acu-text-main) !important;border:none !important}.acu-import-modal{max-width:500px;width:90vw}.acu-import-upload .acu-upload-area{display:flex;flex-direction:column;align-items:center;gap:12px;padding:48px 24px;border:2px dashed var(--acu-border);border-radius:12px;cursor:pointer;transition:all .2s}.acu-import-upload .acu-upload-area:hover{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-import-upload .acu-upload-area i{font-size:48px;color:var(--acu-text-sub)}.acu-import-upload .acu-upload-area p{margin:0;font-size:14px;color:var(--acu-text-main)}.acu-import-upload .acu-upload-area .hint{font-size:12px;color:var(--acu-text-sub)}.acu-import-preview{display:flex;flex-direction:column;gap:16px;padding:16px}.acu-import-stats{display:flex;justify-content:center;gap:24px}.acu-import-stats .acu-stat-item{display:flex;flex-direction:column;align-items:center;gap:4px}.acu-import-stats .acu-stat-item i{font-size:24px;color:var(--acu-title-color)}.acu-import-stats .acu-stat-item .acu-stat-value{font-size:24px;font-weight:bold;color:var(--acu-text-main)}.acu-import-stats .acu-stat-item .acu-stat-label{font-size:12px;color:var(--acu-text-sub)}.acu-import-stats .acu-stat-item.acu-stat-conflict i{color:#f39c12}.acu-conflict-options{background:var(--acu-table-head);border-radius:8px;padding:12px}.acu-conflict-options .acu-radio-option{display:flex;align-items:flex-start;gap:8px;padding:8px;cursor:pointer;border-radius:6px;transition:background .2s}.acu-conflict-options .acu-radio-option:hover{background:var(--acu-table-hover)}.acu-conflict-options .acu-radio-option input{margin-top:2px}.acu-conflict-options .acu-radio-option span{display:block;font-size:13px}.acu-conflict-options .acu-radio-option span.hint{font-size:11px;color:var(--acu-text-sub);margin-top:2px}.acu-import-list .acu-preview-scroll{max-height:200px;overflow-y:auto}.acu-import-list .acu-preview-section{margin-bottom:12px}.acu-import-list .acu-preview-section .acu-preview-header{font-size:12px;font-weight:500;color:var(--acu-text-sub);margin-bottom:8px}.acu-import-list .acu-preview-section .acu-preview-items{display:flex;flex-wrap:wrap;gap:6px}.acu-import-list .acu-preview-section .acu-preview-items .acu-preview-item{padding:4px 10px;border-radius:12px;background:var(--acu-badge-bg);font-size:12px}.acu-import-list .acu-preview-section .acu-preview-items .acu-preview-item.conflict{background:rgba(243,156,18,.2);color:#f39c12}.acu-import-list .acu-preview-section .acu-preview-items .acu-preview-more{font-size:12px;color:var(--acu-text-sub);padding:4px}.acu-import-actions{display:flex;justify-content:flex-end;gap:12px}.acu-import-error{display:flex;align-items:center;gap:8px;padding:12px;border-radius:8px;background:rgba(231,76,60,.1);color:#e74c3c;font-size:13px}.acu-category-select-modal{max-width:600px;width:90vw;max-height:70vh;display:flex;flex-direction:column}.acu-category-select-modal.has-subcategories{max-width:800px}@media (max-width:768px){.acu-category-select-modal{width:100vw;max-width:none;max-height:80vh;margin:auto 0 0;border-radius:16px 16px 0 0}}.acu-category-select-modal .acu-modal-body{flex:1;min-height:0;padding:0}.acu-modal-btn.active{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color)}.acu-modal-btn.active .acu-mode-btn{display:inline-flex;align-items:center;gap:4px;padding:6px 12px;border-radius:6px;border:1px solid var(--acu-border);background:var(--acu-btn-bg);cursor:pointer;font-size:12px;color:var(--acu-text-main);transition:all .2s}.acu-modal-btn.active .acu-mode-btn:hover:not(:disabled){background:var(--acu-btn-hover)}.acu-modal-btn.active .acu-mode-btn.active{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color)}.acu-category-select-dual{display:flex;height:100%;min-height:300px}@media (max-width:768px){.acu-category-select-dual{flex-direction:column}}.acu-category-tree{width:180px;min-width:150px;border-right:1px solid var(--acu-border);overflow-y:auto;background:var(--acu-card-bg)}@media (max-width:768px){.acu-category-tree{width:100%;min-width:auto;border-right:none;border-bottom:1px solid var(--acu-border);max-height:120px;display:flex;flex-wrap:wrap;padding:8px;gap:6px}}.acu-category-tree .acu-tree-item{display:flex;align-items:center;gap:8px;padding:10px 12px;cursor:pointer;transition:background .2s;border-left:3px solid rgba(0,0,0,0)}@media (max-width:768px){.acu-category-tree .acu-tree-item{padding:6px 10px;border-left:none;border-radius:16px;background:var(--acu-badge-bg)}}.acu-category-tree .acu-tree-item:hover{background:var(--acu-table-hover)}.acu-category-tree .acu-tree-item.active{background:var(--acu-title-color-bg);border-left-color:var(--acu-title-color)}@media (max-width:768px){.acu-category-tree .acu-tree-item.active{border-left:none;background:var(--acu-title-color);color:#fff}.acu-category-tree .acu-tree-item.active .acu-tree-count{color:hsla(0,0%,100%,.8)}}.acu-category-tree .acu-tree-item .acu-tree-icon{font-size:14px}.acu-category-tree .acu-tree-item .acu-tree-icon i{color:var(--acu-text-sub)}.acu-category-tree .acu-tree-item .acu-tree-label{flex:1;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-category-tree .acu-tree-item .acu-tree-count{font-size:11px;color:var(--acu-text-sub)}.acu-category-tags-grid{flex:1;display:flex;flex-wrap:wrap;align-content:flex-start;gap:8px;padding:16px;overflow-y:auto;background:var(--acu-bg-panel)}@media (max-width:768px){.acu-category-tags-grid{min-height:200px}}.acu-category-tags-only{padding:16px;overflow-y:auto;max-height:400px}.acu-category-tags-only .acu-tags-scroll{display:flex;flex-wrap:wrap;gap:8px}.acu-tag-btn{padding:10px 16px;border:none;border-radius:20px;background:var(--acu-badge-bg);cursor:pointer;font-size:13px;color:var(--acu-text-main);transition:all .2s}.acu-tag-btn:hover{background:var(--acu-btn-hover);transform:scale(1.05)}.acu-tag-btn:active{transform:scale(0.98)}.acu-tags-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;width:100%;padding:32px;color:var(--acu-text-sub)}.acu-tags-empty i{font-size:32px;opacity:.5}.acu-tags-empty span{font-size:13px}.acu-pre-edit-modal{max-width:500px;width:90vw}@media (max-width:768px){.acu-pre-edit-modal{width:100vw;max-width:none;margin:auto 0 0;border-radius:16px 16px 0 0}}.acu-pre-edit-content{display:flex;flex-direction:column;gap:16px;padding:16px}.acu-pre-edit-content .acu-pre-edit-label{font-size:13px;font-weight:500;color:var(--acu-text-main)}.acu-pre-edit-content .acu-pre-edit-textarea{width:100%;min-height:120px;padding:12px;border:1px solid var(--acu-border);border-radius:8px;background:var(--acu-input-bg);color:var(--acu-text-main);font-size:14px;font-family:inherit;line-height:1.5;resize:vertical;outline:none;transition:border-color .2s}.acu-pre-edit-content .acu-pre-edit-textarea:focus{border-color:var(--acu-title-color)}.acu-pre-edit-content .acu-pre-edit-textarea::placeholder{color:var(--acu-text-sub)}.acu-pre-edit-content .acu-pre-edit-hint{display:flex;align-items:center;gap:8px;padding:10px 12px;background:var(--acu-table-head);border-radius:8px;font-size:12px;color:var(--acu-text-sub)}.acu-pre-edit-content .acu-pre-edit-hint i{color:#f39c12}.acu-companion-selector{display:flex;flex-direction:column;gap:8px;padding:12px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:8px}.acu-companion-selector .acu-companion-header{font-size:12px;font-weight:500;color:var(--acu-text-sub);display:flex;align-items:center;gap:6px}.acu-companion-selector .acu-avatar-list{display:flex;gap:8px;flex-wrap:wrap;max-height:200px;overflow-y:auto;padding-right:4px}@media (max-width:768px){.acu-companion-selector .acu-avatar-list{flex-wrap:nowrap;overflow-x:auto;overflow-y:hidden;max-height:none;padding-bottom:8px}}.acu-companion-selector .acu-avatar-list .acu-avatar-item{display:flex;flex-direction:column;align-items:center;gap:4px;width:60px;cursor:pointer;transition:transform .2s}.acu-companion-selector .acu-avatar-list .acu-avatar-item:hover{transform:scale(1.05)}.acu-companion-selector .acu-avatar-list .acu-avatar-item .acu-avatar-img-wrapper{width:48px;height:48px;border-radius:50%;overflow:hidden;border:2px solid rgba(0,0,0,0);transition:border-color .2s;background:var(--acu-table-head);display:flex;align-items:center;justify-content:center}.acu-companion-selector .acu-avatar-list .acu-avatar-item .acu-avatar-img-wrapper img{width:100%;height:100%;object-fit:cover}.acu-companion-selector .acu-avatar-list .acu-avatar-item .acu-avatar-img-wrapper.no-img{background:var(--acu-badge-bg)}.acu-companion-selector .acu-avatar-list .acu-avatar-item .acu-avatar-img-wrapper .acu-avatar-text-icon{font-size:20px;font-weight:bold;color:var(--acu-text-sub);text-transform:uppercase}.acu-companion-selector .acu-avatar-list .acu-avatar-item:hover .acu-avatar-img-wrapper{border-color:var(--acu-title-color)}.acu-companion-selector .acu-avatar-list .acu-avatar-item .acu-avatar-name{font-size:11px;color:var(--acu-text-main);text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%}.acu-companion-selector .acu-avatar-list .acu-avatar-empty{width:100%;text-align:center;padding:20px;color:var(--acu-text-sub);font-size:12px}.acu-tag-preview-tooltip{position:fixed;z-index:2147483647;max-width:300px;padding:10px 14px;border-radius:8px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);box-shadow:0 4px 16px rgba(0,0,0,.2);font-size:13px;line-height:1.5;color:var(--acu-text-main);word-wrap:break-word;white-space:pre-wrap;pointer-events:none;transform:translate(-50%,-100%);animation:acu-tooltip-fade-in .15s ease-out forwards}.acu-tag-preview-tooltip::after{content:"";position:absolute;bottom:-6px;left:50%;transform:translateX(-50%);border-left:6px solid rgba(0,0,0,0);border-right:6px solid rgba(0,0,0,0);border-top:6px solid var(--acu-bg-panel)}.acu-tag-preview-tooltip::before{content:"";position:absolute;bottom:-7px;left:50%;transform:translateX(-50%);border-left:7px solid rgba(0,0,0,0);border-right:7px solid rgba(0,0,0,0);border-top:7px solid var(--acu-border)}@keyframes acu-tooltip-fade-in{from{opacity:0;transform:translate(-50%,-100%) translateY(4px)}to{opacity:1;transform:translate(-50%,-100%) translateY(0)}}.acu-custom-select{position:relative;min-width:120px;max-width:100%;height:32px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:6px;display:flex;align-items:center;padding:0 10px;cursor:pointer;transition:all .2s;min-width:0}.acu-custom-select:hover{border-color:var(--acu-text-sub)}.acu-custom-select.active{border-color:var(--acu-title-color)}.acu-custom-select.active .arrow{transform:rotate(180deg)}.acu-custom-select .selected-value{flex:1;display:flex;align-items:center;gap:8px;overflow:hidden}.acu-custom-select .selected-value i,.acu-custom-select .selected-value span:not(.text):not(.placeholder){font-size:14px;width:16px;text-align:center;flex-shrink:0}.acu-custom-select .selected-value .text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:13px;color:var(--acu-text-main)}.acu-custom-select .selected-value .placeholder{color:var(--acu-text-sub);font-size:13px}.acu-custom-select .arrow{font-size:12px;color:var(--acu-text-sub);margin-left:8px;transition:transform .2s}.acu-custom-select .acu-custom-dropdown-menu{position:absolute;top:100%;left:0;min-width:100%;width:max-content;max-height:200px;overflow-y:auto;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:6px;margin-top:4px;z-index:100;box-shadow:0 4px 12px rgba(0,0,0,.15)}.acu-custom-select .acu-custom-dropdown-menu .dropdown-item{display:flex;align-items:center;gap:8px;padding:8px 10px;cursor:pointer;transition:background .2s}.acu-custom-select .acu-custom-dropdown-menu .dropdown-item:hover{background:var(--acu-table-hover)}.acu-custom-select .acu-custom-dropdown-menu .dropdown-item.selected{background:var(--acu-title-color-bg);color:var(--acu-title-color)}.acu-custom-select .acu-custom-dropdown-menu .dropdown-item.selected .text{color:var(--acu-title-color);font-weight:500}.acu-custom-select .acu-custom-dropdown-menu .dropdown-item i,.acu-custom-select .acu-custom-dropdown-menu .dropdown-item span:not(.text){font-size:14px;width:16px;text-align:center;flex-shrink:0}.acu-custom-select .acu-custom-dropdown-menu .dropdown-item .text{font-size:13px;color:var(--acu-text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.card-back{width:100%;height:100%;border-radius:12px;overflow:hidden;box-shadow:0 25px 50px -12px rgba(0,0,0,.5);border:6px solid #4a3222;position:relative}.card-back__image{width:100%;height:100%;object-fit:cover}.card-back__overlay{position:absolute;inset:0;border:2px solid rgba(139,94,60,.5);border-radius:8px;pointer-events:none}.card-front{width:100%;height:100%;background-color:#f9f2e6;border-radius:12px;overflow:hidden;box-shadow:0 25px 50px -12px rgba(0,0,0,.5);display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding:24px;border:6px solid #4a3728;position:relative}.card-front__texture{position:absolute;inset:0;background-image:url("https://grainy-gradients.vercel.app/noise.svg");opacity:.2;pointer-events:none;mix-blend-mode:multiply;z-index:0}.card-front__border-outer{position:absolute;inset:12px;border:1px solid #c6a664;border-radius:8px;pointer-events:none;z-index:10}.card-front__border-inner{position:absolute;inset:16px;border:1px solid rgba(139,94,60,.3);border-radius:6px;pointer-events:none;z-index:10}.card-front__content{position:relative;z-index:20;display:flex;flex-direction:column;align-items:center;height:100%;width:100%}.card-front__top-icon{margin-top:32px;margin-bottom:16px;color:#8b5e3c;animation:divination-pulse 2s ease-in-out infinite}.card-front__luck-name{font-family:"ZCOOL XiaoWei","Cinzel",serif;font-size:24px;color:#4a3728;font-weight:bold;text-align:center;letter-spacing:.2em;text-transform:uppercase;border-bottom:2px solid #c6a664;padding-bottom:8px;margin-bottom:8px;width:85%}@media (min-width:768px){.card-front__luck-name{font-size:28px}}.card-front__dimensions{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:8px;width:85%}.card-front__dimension-item{font-family:"Noto Serif SC","Cormorant Garamond",serif;font-size:13px;color:#4a3728;background-color:rgba(198,166,100,.15);padding:4px 12px;border-radius:12px;border:1px solid rgba(198,166,100,.3)}@media (min-width:768px){.card-front__dimension-item{font-size:14px}}.card-front__keywords{display:flex;flex-direction:column;gap:12px;width:100%;padding:0 16px;flex-grow:1;justify-content:center;padding-top:0;overflow-y:auto}.card-front__keywords::-webkit-scrollbar{display:none}.card-front__keywords{scrollbar-width:none;-ms-overflow-style:none}.card-front__keyword{display:flex;align-items:center;justify-content:center}.card-front__keyword-text{font-family:"ZCOOL XiaoWei","Cinzel",serif;color:#8b5e3c;font-size:18px;letter-spacing:.1em;text-transform:uppercase;font-weight:bold;white-space:normal;text-align:center;line-height:1.4}.card-front__corner{position:absolute;width:48px;height:48px;color:#c6a664;z-index:10}.card-front__corner--tl{top:12px;left:12px}.card-front__corner--tr{top:12px;right:12px;transform:scaleX(-1)}.card-front__corner--bl{bottom:12px;left:12px;transform:scaleY(-1)}.card-front__corner--br{bottom:12px;right:12px;transform:scale(-1)}.mystic-card-back{width:100%;height:100%;border-radius:12px;overflow:hidden;box-shadow:0 25px 50px -12px rgba(0,0,0,.5);position:relative}.mystic-card-back__image{width:100%;height:100%;object-fit:cover}.mystic-card-back__sheen{position:absolute;inset:0;background:linear-gradient(to top right,rgba(0,0,0,0.2),transparent,rgba(255,255,255,0.1));pointer-events:none}.mystic-card-front{width:100%;height:100%;background-color:#0b1026;border-radius:12px;overflow:hidden;box-shadow:0 0 30px rgba(199,210,254,.3);position:relative}.mystic-card-front__texture{position:absolute;inset:0;background:radial-gradient(circle at center,#1e293b 0%,#0f172a 40%,#020617 100%)}.mystic-card-front__border-outer{position:absolute;inset:12px;border:1px solid rgba(245,158,11,.3);border-radius:8px;pointer-events:none;z-index:10}.mystic-card-front__border-inner{position:absolute;inset:16px;border:2px solid rgba(252,211,77,.6);border-radius:8px;box-shadow:0 0 15px rgba(251,191,36,.2);pointer-events:none;z-index:10}.mystic-card-front__corner{position:absolute;width:64px;height:64px;border-style:solid;border-width:0;border-color:rgba(199,210,254,.8);z-index:10}.mystic-card-front__corner--tl{top:16px;left:16px;border-top-width:2px;border-left-width:2px;border-top-left-radius:16px}.mystic-card-front__corner--tr{top:16px;right:16px;border-top-width:2px;border-right-width:2px;border-top-right-radius:16px}.mystic-card-front__corner--bl{bottom:16px;left:16px;border-bottom-width:2px;border-left-width:2px;border-bottom-left-radius:16px}.mystic-card-front__corner--br{bottom:16px;right:16px;border-bottom-width:2px;border-right-width:2px;border-bottom-right-radius:16px}.mystic-card-front__glow{position:absolute;top:32px;left:50%;transform:translateX(-50%);width:128px;height:128px;opacity:.2;background:radial-gradient(circle,rgba(251,191,36,0.4) 0%,transparent 70%);filter:blur(40px);pointer-events:none;z-index:5}.mystic-card-front__content{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding:36px 24px;text-align:center;z-index:20;font-family:"Noto Serif SC","Cormorant Garamond",serif}.mystic-card-front__top-icon{color:rgba(252,211,77,.8);margin-bottom:8px;filter:drop-shadow(0 0 5px rgba(251,191,36,0.8))}.mystic-card-front__top-icon svg{opacity:.8}.mystic-card-front__loading{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;height:100%}.mystic-card-front__spinner{width:32px;height:32px;border:2px solid #f59e0b;border-top-color:rgba(0,0,0,0);border-radius:50%;animation:mystic-spin 1s linear infinite}.mystic-card-front__loading-text{color:#c7d2fe;font-size:14px;letter-spacing:.2em;animation:mystic-pulse 2s ease-in-out infinite}.mystic-card-front__title{position:relative}.mystic-card-front__luck-name{font-family:"Cinzel","ZCOOL XiaoWei",serif;font-size:32px;font-weight:bold;letter-spacing:.2em;background:linear-gradient(to bottom,#fef3c7,#f59e0b);-webkit-background-clip:text;-webkit-text-fill-color:rgba(0,0,0,0);background-clip:text;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3));margin:0}@media (max-width:768px){.mystic-card-front__luck-name{font-size:28px}}.mystic-card-front__divider{width:64px;height:1px;background:linear-gradient(to right,transparent,#818cf8,transparent);margin:8px auto 0}.mystic-card-front__dimensions{display:flex;flex-direction:column;gap:8px;margin:12px 0}.mystic-card-front__dimension-tag{color:#c7d2fe;font-size:14px;letter-spacing:.2em;text-transform:uppercase;border:1px solid rgba(99,102,241,.3);padding:4px 12px;border-radius:9999px;background:rgba(30,27,75,.3);backdrop-filter:blur(4px)}.mystic-card-front__message-box{position:relative;padding:24px 16px;background:radial-gradient(circle at center,rgba(255,255,255,0.03) 0%,transparent 70%);flex-grow:1;display:flex;flex-direction:column;width:110%;margin:8px -5%;overflow:hidden}.mystic-card-front__message-box::before,.mystic-card-front__message-box::after{content:"";position:absolute;left:20%;right:20%;height:1px;background:linear-gradient(90deg,transparent,rgba(245,158,11,0.3),transparent)}.mystic-card-front__message-box::before{top:0}.mystic-card-front__message-box::after{bottom:0}.mystic-card-front__word-list{display:flex;flex-direction:column;gap:12px;align-items:center;width:100%;height:100%;overflow-y:auto;padding:0 8px}.mystic-card-front__word-list::before,.mystic-card-front__word-list::after{content:"";flex-shrink:0;margin:auto}.mystic-card-front__word-list::-webkit-scrollbar{width:4px}.mystic-card-front__word-list::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.mystic-card-front__word-list::-webkit-scrollbar-thumb{background:rgba(245,158,11,.2);border-radius:4px}.mystic-card-front__word-list::-webkit-scrollbar-thumb:hover{background:rgba(245,158,11,.4)}.mystic-card-front__word-list{scrollbar-width:thin;scrollbar-color:rgba(245,158,11,.2) rgba(0,0,0,0)}.mystic-card-front__word-item{font-family:"Cinzel","ZCOOL XiaoWei",serif;font-size:16px;color:#fef3c7;text-shadow:0 0 10px rgba(253,224,71,.2);letter-spacing:.05em;line-height:1.4;position:relative;white-space:normal;text-align:center}.mystic-card-front__word-item:only-child{font-size:20px;color:#fcd34d;text-shadow:0 0 15px rgba(245,158,11,.3)}.mystic-card-front__bottom-icon{color:rgba(252,211,77,.5);margin-top:16px;transform:rotate(180deg)}@keyframes mystic-spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}@keyframes mystic-pulse{0%,100%{opacity:1}50%{opacity:.5}}@keyframes mystic-float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}@keyframes mystic-glow{0%,100%{box-shadow:0 0 20px rgba(199,210,254,.3)}50%{box-shadow:0 0 40px rgba(199,210,254,.5)}}.divination-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;height:100dvh;z-index:200000;display:flex;flex-direction:column;align-items:center;justify-content:center;background:radial-gradient(circle at center,#2a1b15 0%,#1a0f0e 40%,#050505 100%);overflow:hidden;font-family:"Noto Serif SC","Cormorant Garamond",serif;color:#f9f2e6}.divination-overlay::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background-image:url("https://www.transparenttextures.com/patterns/stardust.png");opacity:.3;pointer-events:none;z-index:0}.divination-grain{position:absolute;inset:0;background-image:url("https://grainy-gradients.vercel.app/noise.svg");opacity:.15;mix-blend-mode:overlay;pointer-events:none;z-index:1}.divination-starfield{position:absolute;inset:0;pointer-events:none;z-index:0}.divination-star{position:absolute;border-radius:50%;background-color:#f5e6d3;opacity:.6;animation:divination-twinkle var(--duration,3s) ease-in-out infinite;animation-delay:var(--delay,0s)}@keyframes divination-twinkle{0%,100%{opacity:.2;transform:scale(0.8)}50%{opacity:.8;transform:scale(1.2)}}.divination-nebula{position:absolute;border-radius:50%;pointer-events:none;z-index:0}.divination-nebula--purple{top:-10%;left:-10%;width:60%;height:60%;background:#3d2b4a;filter:blur(100px);opacity:.3;mix-blend-mode:screen;animation:divination-nebula-pulse 15s ease-in-out infinite}.divination-nebula--golden{bottom:-10%;right:-10%;width:70%;height:70%;background:#4a3728;filter:blur(120px);opacity:.2;mix-blend-mode:screen;animation:divination-nebula-drift 20s ease-in-out infinite}@keyframes divination-nebula-pulse{0%,100%{transform:scale(1);opacity:.2}50%{transform:scale(1.2);opacity:.4}}@keyframes divination-nebula-drift{0%,100%{transform:translateX(0) scale(1);opacity:.1}50%{transform:translateX(50px) scale(1.1);opacity:.3}}.divination-central-glow{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80vw;height:80vw;max-width:800px;max-height:800px;background:radial-gradient(circle,rgba(198,166,100,0.1) 0%,transparent 70%);filter:blur(48px);pointer-events:none;z-index:0}.divination-geometry{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none;z-index:0}.divination-geometry--outer{width:140vmin;height:140vmin;opacity:.15;animation:divination-spin-slow 60s linear infinite}.divination-geometry--inner{width:90vmin;height:90vmin;opacity:.1;animation:divination-spin-reverse 80s linear infinite}.divination-geometry svg{width:100%;height:100%}@keyframes divination-spin-slow{from{transform:translate(-50%,-50%) rotate(0deg)}to{transform:translate(-50%,-50%) rotate(360deg)}}@keyframes divination-spin-reverse{from{transform:translate(-50%,-50%) rotate(0deg)}to{transform:translate(-50%,-50%) rotate(-360deg)}}.divination-frame{position:absolute;top:8px;left:8px;right:8px;bottom:8px;width:auto;height:auto;pointer-events:none;z-index:50;border:1px solid rgba(212,175,55,.2);border-radius:12px;box-sizing:border-box}@media (min-width:768px){.divination-frame{top:16px;left:16px;right:16px;bottom:16px}}.divination-frame__corner{position:absolute;width:128px;height:128px;border-color:rgba(212,175,55,.6);border-style:solid;border-width:0}.divination-frame__corner--tl{top:0;left:0;border-top-width:2px;border-left-width:2px;border-top-left-radius:24px}.divination-frame__corner--tr{top:0;right:0;border-top-width:2px;border-right-width:2px;border-top-right-radius:24px}.divination-frame__corner--bl{bottom:0;left:0;border-bottom-width:2px;border-left-width:2px;border-bottom-left-radius:24px}.divination-frame__corner--br{bottom:0;right:0;border-bottom-width:2px;border-right-width:2px;border-bottom-right-radius:24px}.divination-frame__top-line{position:absolute;top:0;left:50%;transform:translateX(-50%);width:160px;height:1px;background:linear-gradient(to right,transparent,#d4af37,transparent);opacity:.8}.divination-frame__bottom-line{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:160px;height:1px;background:linear-gradient(to right,transparent,#d4af37,transparent);opacity:.8}.divination-content{position:relative;z-index:20;width:100%;display:flex;flex-direction:column;align-items:center;max-width:1280px;margin:0 auto;height:100%;justify-content:space-between;padding:16px 24px;gap:8px;box-sizing:border-box}@media (max-width:768px){.divination-content{padding:12px 16px;gap:4px}}.divination-header{text-align:center;animation:divination-fade-in-down 1s ease-out;flex-shrink:1;min-height:0}@media (max-width:768px){.divination-header{transform:scale(0.6);transform-origin:top center;margin-bottom:-16px}}.divination-header__title{display:inline-flex;flex-direction:column;align-items:center}.divination-header__sparkle--static{position:relative;display:block;color:#d4af37;opacity:.8;animation:divination-twinkle 4s ease-in-out infinite;filter:drop-shadow(0 0 10px rgba(212,175,55,0.5))}.divination-header__divider{height:2px;width:120px;background:linear-gradient(to right,transparent,#d4af37,transparent);margin-top:8px;opacity:.5}@media (max-width:768px){.divination-header__divider{margin-top:4px}}@keyframes divination-fade-in-down{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.divination-stage{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;position:relative;flex:1;min-height:0;padding:8px 0;overflow:hidden}.tarot-card{position:relative;cursor:pointer;perspective:1000px;width:auto;height:100%;max-height:100%;max-width:min(90vw,400px)}@media (max-width:768px){.tarot-card{height:auto;width:min(85vw,300px);max-height:calc(100dvh - 180px)}}@media (min-width:768px){.tarot-card{max-width:min(50vw,450px);max-height:75vh}}.tarot-card__inner{position:relative;width:100%;height:100%;transform-style:preserve-3d;transition:transform .8s ease-in-out}.tarot-card--flipped .tarot-card__inner{transform:rotateY(180deg)}.tarot-card__face{position:absolute;inset:0;width:100%;height:100%;backface-visibility:hidden;border-radius:12px;overflow:hidden}.tarot-card__back{z-index:2}.tarot-card__front{transform:rotateY(180deg);z-index:1}.tarot-card:not(.tarot-card--flipped) .tarot-card__back{animation:divination-float 4s ease-in-out infinite}@keyframes divination-float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}.divination-hint{text-align:center;pointer-events:none;animation:divination-fade-in .8s ease-out}.divination-hint__text{font-family:"ZCOOL XiaoWei","Cinzel",serif;color:#f5e6d3;font-size:18px;letter-spacing:.2em;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.5));animation:divination-bounce 2s ease-in-out infinite}@media (max-width:768px){.divination-hint__text{font-size:14px}}@keyframes divination-fade-in{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes divination-bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}.divination-btn{padding:12px 32px;font-family:"ZCOOL XiaoWei","Cinzel",serif;font-size:14px;letter-spacing:.2em;text-transform:uppercase;border:1px solid;border-radius:0;cursor:pointer;transition:all .3s ease;backdrop-filter:blur(4px);position:relative;overflow:hidden}.divination-btn::before{content:"";position:absolute;inset:0;transform:skewX(-10deg);z-index:-1}.divination-btn--primary{color:#d4af37;border-color:#d4af37;background:rgba(26,15,14,.6)}.divination-btn--primary::before{background:rgba(0,0,0,0)}.divination-btn--primary:hover{color:#f9f2e6;background:rgba(212,175,55,.2)}.divination-btn--secondary{color:rgba(212,175,55,.7);border-color:rgba(212,175,55,.4);background:rgba(0,0,0,0)}.divination-btn--secondary:hover{color:#d4af37;border-color:#d4af37}.divination-btn--retry{font-family:"ZCOOL XiaoWei","Cinzel",serif;color:#f5e6d3;font-size:18px;letter-spacing:.2em;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.5));animation:divination-bounce 2s ease-in-out infinite;border:1px solid hsla(0,0%,100%,.8);border-radius:24px;background:rgba(0,0,0,.3);padding:10px 32px}.divination-btn--retry::before{display:none}.divination-btn--retry:hover{background:hsla(0,0%,100%,.1);border-color:#fff}.divination-footer{height:auto;min-height:32px;display:flex;align-items:center;justify-content:center;flex-shrink:1;padding-bottom:4px}@media (max-width:768px){.divination-footer{min-height:24px;padding-bottom:0}}.divination-close{position:absolute;top:24px;right:24px;z-index:100;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:rgba(212,175,55,.6);border:1px solid rgba(212,175,55,.3);border-radius:50%;background:rgba(15,10,8,.5);backdrop-filter:blur(4px);cursor:pointer;transition:all .3s ease}.divination-close:hover{color:#d4af37;border-color:#d4af37;background:rgba(212,175,55,.1)}.divination-overlay-enter-active{animation:divination-overlay-in .5s ease-out}.divination-overlay-leave-active{animation:divination-overlay-out .3s ease-in forwards}@keyframes divination-overlay-in{from{opacity:0}to{opacity:1}}@keyframes divination-overlay-out{from{opacity:1}to{opacity:0}}.acu-prompt-editor-modal{max-width:600px}@media (max-width:768px){.acu-prompt-editor-modal{max-width:90vw}}.acu-prompt-editor-modal .acu-textarea-scrollable{background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:var(--acu-radius-md);padding:12px;font-size:14px;transition:border-color .2s}.acu-prompt-editor-modal .acu-textarea-scrollable:focus{border-color:var(--acu-title-color);box-shadow:none}.acu-prompt-editor-modal .acu-textarea-scrollable::placeholder{color:var(--acu-text-sub);opacity:.7}:root{--acu-neutral-50:#fafafa;--acu-neutral-100:#f5f5f5;--acu-neutral-200:#eeeeee;--acu-neutral-300:#e0e0e0;--acu-neutral-400:#bdbdbd;--acu-neutral-500:#9e9e9e;--acu-neutral-600:#757575;--acu-neutral-700:#616161;--acu-neutral-800:#424242;--acu-neutral-900:#212121;--acu-success:#27ae60;--acu-warning:#f39c12;--acu-danger:#e74c3c;--acu-info:#3498db;--acu-z-ball:2147483646;--acu-z-overlay:2147483647;--acu-z-menu:2147483648;--acu-radius-sm:6px;--acu-radius-md:12px;--acu-radius-lg:16px;--acu-shadow-sm:0 2px 8px rgba(0,0,0,0.1);--acu-shadow-md:0 4px 16px rgba(0,0,0,0.15);--acu-shadow-lg:0 15px 50px rgba(0,0,0,0.3);--acu-transition-fast:0.15s;--acu-transition-normal:0.3s;--acu-transition-slow:0.5s}.acu-wrapper,.acu-theme-retro{--acu-bg-nav:#e6e2d3;--acu-bg-panel:#e6e2d3;--acu-card-bg:#fffef9;--acu-table-head:#efebe4;--acu-table-hover:#f0ebe0;--acu-badge-bg:#efebe4;--acu-input-bg:rgba(255,255,255,0.5);--acu-menu-bg:#fff;--acu-overlay-bg:rgba(94,75,53,0.4);--acu-text-main:#5e4b35;--acu-text-sub:#999;--acu-menu-text:#333;--acu-border:#dcd0c0;--acu-btn-bg:#dcd0c0;--acu-btn-hover:#cbbba8;--acu-btn-active-bg:#8d7b6f;--acu-btn-active-text:#fdfaf5;--acu-shadow:rgba(0,0,0,0.1);--acu-card-width:280px;--acu-font-size:13px;--acu-highlight:#d35400;--acu-title-color-bg:rgba(211,84,0,0.08);--acu-title-color:#d35400;--acu-accent:#d35400;--acu-nav-cols:repeat(auto-fill,minmax(90px,1fr));--acu-text-max-height:80px;--acu-text-overflow:auto;--acu-win-width:400px;--acu-win-left:100px;--acu-win-bottom:100px}.acu-theme-dark{--acu-bg-nav:rgba(43,43,43,0.95);--acu-bg-panel:rgba(37,37,37,0.95);--acu-border:#444;--acu-text-main:#eee;--acu-text-sub:#aaa;--acu-btn-bg:rgba(58,58,58,0.5);--acu-btn-hover:#4a4a4a;--acu-btn-active-bg:#6a5acd;--acu-btn-active-text:#fff;--acu-table-head:rgba(51,51,51,0.8);--acu-table-hover:rgba(58,58,58,0.5);--acu-shadow:rgba(0,0,0,0.6);--acu-card-bg:rgba(45,48,53,0.8);--acu-badge-bg:#3a3f4b;--acu-menu-bg:#333;--acu-menu-text:#eee;--acu-input-bg:rgba(0,0,0,0.3);--acu-overlay-bg:rgba(0,0,0,0.75)}.acu-theme-modern{--acu-bg-nav:#ffffff;--acu-bg-panel:#f8f9fa;--acu-border:#e0e0e0;--acu-text-main:#333;--acu-text-sub:#888;--acu-btn-bg:#f1f3f5;--acu-btn-hover:#e9ecef;--acu-btn-active-bg:#007bff;--acu-btn-active-text:#fff;--acu-table-head:#f8f9fa;--acu-table-hover:#f1f3f5;--acu-shadow:rgba(0,0,0,0.08);--acu-card-bg:#ffffff;--acu-badge-bg:#f1f3f5;--acu-menu-bg:#fff;--acu-menu-text:#333;--acu-input-bg:#ffffff;--acu-overlay-bg:rgba(0,0,0,0.3)}.acu-theme-forest{--acu-bg-nav:#e8f5e9;--acu-bg-panel:#e8f5e9;--acu-border:#c8e6c9;--acu-text-main:#2e7d32;--acu-text-sub:#81c784;--acu-btn-bg:#c8e6c9;--acu-btn-hover:#a5d6a7;--acu-btn-active-bg:#43a047;--acu-btn-active-text:#fff;--acu-table-head:#dcedc8;--acu-table-hover:#f1f8e9;--acu-shadow:rgba(0,0,0,0.1);--acu-card-bg:#ffffff;--acu-badge-bg:#dcedc8;--acu-menu-bg:#fff;--acu-menu-text:#2e7d32;--acu-input-bg:rgba(255,255,255,0.7);--acu-overlay-bg:rgba(46,125,50,0.2)}.acu-theme-ocean{--acu-bg-nav:#e3f2fd;--acu-bg-panel:#e3f2fd;--acu-border:#bbdefb;--acu-text-main:#1565c0;--acu-text-sub:#64b5f6;--acu-btn-bg:#bbdefb;--acu-btn-hover:#90caf9;--acu-btn-active-bg:#1976d2;--acu-btn-active-text:#fff;--acu-table-head:#bbdefb;--acu-table-hover:#e1f5fe;--acu-shadow:rgba(0,0,0,0.15);--acu-card-bg:#ffffff;--acu-badge-bg:#e3f2fd;--acu-menu-bg:#fff;--acu-menu-text:#1565c0;--acu-input-bg:rgba(255,255,255,0.7);--acu-overlay-bg:rgba(21,101,192,0.2)}.acu-theme-cyber{--acu-bg-nav:#000000;--acu-bg-panel:#0a0a0a;--acu-border:#333;--acu-text-main:#00ffcc;--acu-text-sub:#ff00ff;--acu-btn-bg:#1a1a1a;--acu-btn-hover:#333;--acu-btn-active-bg:#ff00ff;--acu-btn-active-text:#fff;--acu-table-head:#111;--acu-table-hover:#1a1a1a;--acu-shadow:0 0 10px rgba(0,255,204,0.3);--acu-card-bg:#050505;--acu-badge-bg:#222;--acu-menu-bg:#111;--acu-menu-text:#00ffcc;--acu-input-bg:#111;--acu-overlay-bg:rgba(0,0,0,0.85)}.acu-theme-purple{--acu-bg-nav:#ede7f6;--acu-bg-panel:#ede7f6;--acu-border:#d1c4e9;--acu-text-main:#4a148c;--acu-text-sub:#7b1fa2;--acu-btn-bg:#d1c4e9;--acu-btn-hover:#b39ddb;--acu-btn-active-bg:#7b1fa2;--acu-btn-active-text:#fff;--acu-table-head:#f5f0fa;--acu-table-hover:#f3e5f5;--acu-shadow:rgba(74,20,140,0.1);--acu-card-bg:#faf8fc;--acu-badge-bg:#f5f0fa;--acu-menu-bg:#faf8fc;--acu-menu-text:#4a148c;--acu-input-bg:rgba(255,255,255,0.8);--acu-overlay-bg:rgba(74,20,140,0.3)}.acu-icon-select-modal{width:500px;max-width:90vw;height:600px;max-height:80vh;display:flex;flex-direction:column}.acu-icon-select-modal .acu-modal-body{flex:1;display:flex;flex-direction:column;overflow:hidden;padding:0}.acu-icon-select-modal .acu-icon-tabs{display:flex;border-bottom:1px solid var(--acu-border);background:var(--acu-bg-panel);padding:0 16px;flex-shrink:0}.acu-icon-select-modal .acu-icon-tabs .acu-icon-tab{padding:12px 16px;cursor:pointer;color:var(--acu-text-sub);font-size:14px;font-weight:500;border-bottom:2px solid rgba(0,0,0,0);transition:all .2s}.acu-icon-select-modal .acu-icon-tabs .acu-icon-tab:hover{color:var(--acu-text-main)}.acu-icon-select-modal .acu-icon-tabs .acu-icon-tab.active{color:var(--acu-title-color);border-bottom-color:var(--acu-title-color)}.acu-icon-select-modal .acu-icon-search-bar{padding:12px 16px;border-bottom:1px solid var(--acu-border);background:var(--acu-bg-panel);flex-shrink:0}.acu-icon-select-modal .acu-icon-search-bar .acu-search-input-wrapper{position:relative}.acu-icon-select-modal .acu-icon-search-bar .acu-search-input-wrapper i{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--acu-text-sub)}.acu-icon-select-modal .acu-icon-search-bar .acu-search-input-wrapper input{width:100%;padding:8px 12px 8px 32px;border:1px solid var(--acu-border);border-radius:var(--acu-radius-md);background:var(--acu-card-bg);color:var(--acu-text-main);font-size:13px}.acu-icon-select-modal .acu-icon-search-bar .acu-search-input-wrapper input:focus{border-color:var(--acu-title-color);outline:none}.acu-icon-select-modal .acu-icon-grid-container{flex:1;overflow-y:auto;padding:16px;background:var(--acu-card-bg)}.acu-icon-select-modal .acu-icon-grid-container .acu-icon-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(40px,1fr));gap:8px}.acu-icon-select-modal .acu-icon-grid-container .acu-icon-item{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:var(--acu-radius-sm);cursor:pointer;font-size:20px;color:var(--acu-text-main);transition:all .2s;border:1px solid rgba(0,0,0,0)}.acu-icon-select-modal .acu-icon-grid-container .acu-icon-item:hover{background:var(--acu-table-hover);border-color:var(--acu-border)}.acu-icon-select-modal .acu-icon-grid-container .acu-icon-item.selected{background:var(--acu-title-color-bg);border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-icon-select-modal .acu-icon-grid-container .acu-no-icons{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--acu-text-sub);gap:8px}.acu-icon-select-modal .acu-icon-grid-container .acu-no-icons i{font-size:24px;opacity:.5}.acu-icon-select-modal .acu-icon-manual-input{padding:12px 16px;border-top:1px solid var(--acu-border);background:var(--acu-bg-panel);flex-shrink:0;display:flex;align-items:center;gap:12px}.acu-icon-select-modal .acu-icon-manual-input .acu-manual-label{font-size:13px;color:var(--acu-text-sub);white-space:nowrap}.acu-icon-select-modal .acu-icon-manual-input .acu-manual-field{flex:1;display:flex;align-items:center;gap:8px;background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:var(--acu-radius-md);padding:6px 10px}.acu-icon-select-modal .acu-icon-manual-input .acu-manual-field .acu-preview-icon{width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:16px;color:var(--acu-text-main)}.acu-icon-select-modal .acu-icon-manual-input .acu-manual-field input{flex:1;border:none;background:rgba(0,0,0,0);color:var(--acu-text-main);font-size:13px;min-width:0}.acu-icon-select-modal .acu-icon-manual-input .acu-manual-field input:focus{outline:none}.acu-pre-edit-modal{max-width:600px}.acu-pre-edit-modal .acu-modal-header .acu-header-actions{display:flex;gap:8px;margin-left:auto}.acu-pre-edit-modal .acu-pre-edit-content{display:flex;flex-direction:column;gap:12px}.acu-pre-edit-modal .acu-pre-edit-info-row{display:flex;align-items:center;justify-content:space-between;gap:12px}.acu-pre-edit-modal .acu-pre-edit-info-row .acu-pre-edit-label{font-size:14px;color:var(--acu-text-sub);font-weight:500}.acu-pre-edit-modal .acu-pre-edit-textarea{width:100%;min-height:120px;padding:12px;border:1px solid var(--acu-border);border-radius:8px;background:var(--acu-input-bg);color:var(--acu-text-main);font-size:14px;line-height:1.5;resize:vertical;outline:none;transition:border-color .2s}.acu-pre-edit-modal .acu-pre-edit-textarea:focus{border-color:var(--acu-title-color)}.acu-pre-edit-modal .acu-companion-selector{border:1px solid var(--acu-border);border-radius:8px;background:var(--acu-card-bg);overflow:hidden}.acu-pre-edit-modal .acu-companion-selector .acu-companion-header{padding:8px 12px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);font-size:12px;color:var(--acu-text-sub);display:flex;align-items:center;gap:6px}.acu-pre-edit-modal .acu-companion-selector .acu-avatar-list{display:flex;flex-wrap:wrap;gap:8px;padding:12px;max-height:200px;overflow-y:auto;justify-content:center}.acu-pre-edit-modal .acu-companion-selector .acu-avatar-list .acu-avatar-item{display:flex;flex-direction:column;align-items:center;gap:4px;width:60px;cursor:pointer;transition:transform .2s}.acu-pre-edit-modal .acu-companion-selector .acu-avatar-list .acu-avatar-item:hover{transform:translateY(-2px)}.acu-pre-edit-modal .acu-companion-selector .acu-avatar-list .acu-avatar-item:hover .acu-avatar-name{color:var(--acu-title-color)}.acu-pre-edit-modal .acu-companion-selector .acu-avatar-list .acu-avatar-item .acu-avatar-img-wrapper{width:48px;height:48px;border-radius:50%;overflow:hidden;border:2px solid rgba(0,0,0,0);background:var(--acu-bg-panel);display:flex;align-items:center;justify-content:center}.acu-pre-edit-modal .acu-companion-selector .acu-avatar-list .acu-avatar-item .acu-avatar-img-wrapper img{width:100%;height:100%;object-fit:cover}.acu-pre-edit-modal .acu-companion-selector .acu-avatar-list .acu-avatar-item .acu-avatar-img-wrapper.no-img{background:var(--acu-table-head);border:1px solid var(--acu-border)}.acu-pre-edit-modal .acu-companion-selector .acu-avatar-list .acu-avatar-item .acu-avatar-img-wrapper.no-img .acu-avatar-text-icon{font-size:20px;font-weight:bold;color:var(--acu-text-sub)}.acu-pre-edit-modal .acu-companion-selector .acu-avatar-list .acu-avatar-item .acu-avatar-name{font-size:11px;color:var(--acu-text-main);text-align:center;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-pre-edit-modal .acu-companion-selector .acu-avatar-list .acu-avatar-empty{width:100%;text-align:center;padding:20px;color:var(--acu-text-sub);font-size:12px}.acu-pre-edit-modal .acu-pre-edit-hint{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--acu-text-sub)}.acu-pre-edit-modal .acu-pre-edit-hint i{color:var(--acu-warning,#f39c12)}',e.head.appendChild(r),n.value=r,console.info('[ACU Styles] Base styles injected')})(),C(),(()=>{const e=a(),t=`${b}-dynamic-${o.value}`;e.getElementById(t)?.remove();const n=e.createElement('style');n.id=t,n.setAttribute('data-source','acu-visualizer'),e.head.appendChild(n),r.value=n,console.info('[ACU Styles] Dynamic styles element created')})(),(()=>{const e=a(),t=`${x}-${o.value}`;e.getElementById(t)?.remove();const n=e.createElement('style');n.id=t,n.setAttribute('data-source','acu-visualizer-theme'),e.head.appendChild(n),l.value=n,console.info('[ACU Styles] Theme custom styles element created')})(),t.loadFromStorage(),p(),w(),c.value=!0,console.info('[ACU Styles] Style system initialized'))};return(0,m.watch)(()=>e.config,e=>{c.value&&(p(),y(e.theme),k(e.layout))},{deep:!0}),(0,m.watch)(()=>e.config.fontFamily,e=>{c.value&&C(e)}),(0,m.watch)([()=>t.currentThemeVars,()=>t.currentHighlight,()=>t.customCSS,()=>t.backgroundConfig],()=>{c.value&&w()},{deep:!0}),(0,m.onMounted)(()=>{V()}),(0,m.onUnmounted)(()=>{N()}),{isInitialized:c,init:V,cleanup:N,updateDynamicVariables:p,updateThemeCustomStyles:w,applyTheme:y,applyLayout:k,applyFont:C,applyAllStyles:()=>{p(),w(),y(),k(),C()},baseStyleEl:n,dynamicStyleEl:r,fontStyleEl:i,themeCustomStyleEl:l}}var y=u(4866),k=u(6964);function C(){const e='shujuku_v80_allSettings_v2';if(localStorage.getItem(e))return e;const t='shujuku_v70_allSettings_v2';if(localStorage.getItem(t))return t;return Object.keys(localStorage||{}).find(e=>/^shujuku_.*_allSettings_v2$/.test(e))||e}function N(){try{const e=C(),t=localStorage.getItem(e);return t?JSON.parse(t):{}}catch(e){return console.warn('[ACU] 读取 localStorage 设置失败:',e),{}}}function V(e){try{const t=C(),a=N();localStorage.setItem(t,JSON.stringify({...a,...e}))}catch(e){console.warn('[ACU] 写入 localStorage 设置失败:',e)}}function E(){const e=(0,m.ref)({}),t=(0,m.ref)(!1),a=(0,m.ref)(!1);async function o(t){try{const a=(0,v.M1)().getDB(),o={...e.value,...t};return a&&'function'==typeof a.updateSettings?(await a.updateSettings(o),e.value=o,console.info('[ACU] 通过 API 保存设置成功'),!0):(V(o),e.value=o,console.info('[ACU] 通过 localStorage 保存设置'),!0)}catch(a){console.error('[ACU] 保存设置失败:',a);try{return V({...e.value,...t}),e.value={...e.value,...t},!0}catch{return!1}}}async function n(){try{const e=(0,v.M1)().getDB();if(!e)return console.warn('[ACU] 数据库 API 不可用'),!1;if('function'==typeof e.manualUpdate)return await e.manualUpdate(),console.info('[ACU] 手动更新执行成功 (manualUpdate)'),!0;if('function'==typeof e.triggerUpdate){const t=await e.triggerUpdate();return console.info('[ACU] 手动更新执行成功 (triggerUpdate):',t),!!t}return console.warn('[ACU] 没有可用的更新方法'),!1}catch(e){return console.error('[ACU] 手动更新失败:',e),!1}}return{settings:e,isLoading:t,isInitialized:a,loadSettings:async function(){t.value=!0;try{const t=N();return e.value=t,console.info('[ACU] 从 localStorage 读取设置'),t}catch(t){return console.error('[ACU] 读取设置失败:',t),e.value={},{}}finally{t.value=!1,a.value=!0}},saveSettings:o,updateSetting:async function(e,t){await o({[e]:t})},executeManualUpdate:n,getTableList:function(){try{const e=(0,v.M1)().getDB();if(!e)return console.warn('[ACU] 数据库 API 不可用'),[];if('function'==typeof e.getTableList){const t=e.getTableList();return console.info('[ACU] 获取表格列表成功:',t?.length||0),t||[]}if('function'==typeof e.exportTableAsJson){const t=e.exportTableAsJson();if(t&&'object'==typeof t){const e=[];return Object.keys(t).forEach(a=>{if(!a.startsWith('sheet_'))return;const o=t[a],n=o?.name||a,r=n.includes('总结')||n.includes('大纲')||n.toLowerCase().includes('summary')||n.toLowerCase().includes('outline');e.push({key:a,name:n,isSummaryOrOutline:r})}),console.info('[ACU] 从 exportTableAsJson 解析表格列表:',e.length),e}}return console.warn('[ACU] 无法获取表格列表'),[]}catch(e){return console.error('[ACU] 获取表格列表失败:',e),[]}},executeWithPreset:async function(e,t=[],a=!1){try{const r=(0,v.M1)().getDB();if(!r)return{success:!1,message:'数据库 API 不可用'};if('function'==typeof r.executeWithPreset){const o=await r.executeWithPreset({settings:{autoUpdateThreshold:e.autoUpdateThreshold,updateBatchSize:e.updateBatchSize,skipUpdateFloors:e.skipUpdateFloors,autoUpdateFrequency:e.autoUpdateFrequency},targetTableNames:t.length>0?t:null,silent:a});return console.info('[ACU] executeWithPreset 结果:',o),o}console.info('[ACU] 回退到旧方式: saveSettings + executeManualUpdate'),await o(e);const i=await n();return{success:i,message:i?'更新成功':'更新失败'}}catch(e){return console.error('[ACU] 预设执行失败:',e),{success:!1,message:String(e)}}},findDatabaseSettingsKey:C}}var B=u(3833);function T(e){const t=e.match(/shujuku_v?(\d+)/i);return t?parseInt(t[1],10):0}function S(e,t){const a=e.filter(e=>t.test(e));return 0===a.length?null:(a.sort((e,t)=>T(t)-T(e)),a[0])}let D=null;function A(e){const t=e.toLowerCase();return e.includes('总结')||e.includes('大纲')||t.includes('summary')||t.includes('outline')}function I(e,t,a,o){const n=a.dataIsolationEnabled?a.dataIsolationCode:'';for(let r=t.length-1;r>=0;r--){const i=t[r];if(i.is_user)continue;let l=!1;const c=i.TavernDB_ACU_IsolatedData;if(c&&c[n]){const t=c[n],a=t.updateGroupKeys||[],o=t.modifiedKeys||[],r=t.independentData||{};a.length>0&&o.length>0?l=a.includes(e):(o.includes(e)||r[e])&&(l=!0)}if(!l){const t=i.TavernDB_ACU_Identity;let n=!1;if(n=a.dataIsolationEnabled?t===a.dataIsolationCode:!t,n){const t=i.TavernDB_ACU_ModifiedKeys||[],a=i.TavernDB_ACU_UpdateGroupKeys||[];a.length>0&&t.length>0?l=a.includes(e):(t.includes(e)||i.TavernDB_ACU_IndependentData&&i.TavernDB_ACU_IndependentData[e]||o&&i.TavernDB_ACU_SummaryData&&i.TavernDB_ACU_SummaryData[e]||!o&&i.TavernDB_ACU_Data&&i.TavernDB_ACU_Data[e])&&(l=!0)}}if(l){return{aiFloor:t.slice(0,r+1).filter(e=>!e.is_user).length,chatIndex:r,hasHistory:!0}}}return{aiFloor:0,chatIndex:-1,hasHistory:!1}}const M=(0,m.ref)([]),U=(0,m.ref)(!1),P=(0,m.ref)(null),L=(0,m.ref)(0),F=(0,m.ref)(0);function j(){return{statusList:(0,m.computed)(()=>M.value),isLoading:(0,m.computed)(()=>U.value),lastRefreshTime:(0,m.computed)(()=>P.value),currentTotalAiFloors:(0,m.computed)(()=>L.value),currentTotalFloors:(0,m.computed)(()=>F.value),refresh:async function(){if(U.value)return console.info('[ACU] 表格更新状态刷新进行中，跳过重复请求'),M.value;U.value=!0;const e=Date.now();try{const e=(0,v.M1)().getDB(),t=e?.exportTableAsJson?.();if(!t)return console.warn('[ACU] 无法获取表格数据'),M.value=[],[];const a=function(){const e=window.parent||window;try{const t=e.SillyTavern?.getContext?.(),a=t?.extensionSettings?.__userscripts;if(a){const e=S(Object.keys(a),/shujuku_v\d+__userscript_settings_v1/i);if(e&&a[e]){const t=a[e],o='string'==typeof t?JSON.parse(t):t,n=e.replace(/__userscript_settings_v1$/i,''),r=`${n}_globalMeta_v1`;let i='';if(o[r]){const e=o[r],t='string'==typeof e?JSON.parse(e):e;i=String(t.activeIsolationCode||'')}const l=`${n}_profile_v1__${encodeURIComponent(i)||'__default__'}__settings`;let c={};if(o[l]){const e=o[l];c='string'==typeof e?JSON.parse(e):e}return D={versionPrefix:n,isolationCode:i,userscripts:o},{dataIsolationEnabled:''!==i,dataIsolationCode:i,autoUpdateFrequency:Number(c.autoUpdateFrequency)||2,skipUpdateFloors:Number(c.skipUpdateFloors)||0}}}const o=e.localStorage;if(o){const e=S(Object.keys(o),/shujuku.*settings/i);if(e){const t=JSON.parse(o.getItem(e)||'{}');return{dataIsolationEnabled:!!t.dataIsolationEnabled,dataIsolationCode:String(t.dataIsolationCode||''),autoUpdateFrequency:Number(t.autoUpdateFrequency)||2,skipUpdateFloors:Number(t.skipUpdateFloors)||0}}}}catch(e){console.warn('[ACU] 读取全局设置失败:',e)}return D=null,{dataIsolationEnabled:!1,dataIsolationCode:'',autoUpdateFrequency:2,skipUpdateFloors:0}}();let o=null;o='function'==typeof e?.getTableTemplate?e.getTableTemplate():function(){if(!D)return null;try{const{versionPrefix:e,isolationCode:t,userscripts:a}=D,o=`${e}_profile_v1__${encodeURIComponent(t)||'__default__'}__template`;if(a[o]){const e=a[o];return'string'==typeof e?JSON.parse(e):e}}catch(e){console.warn('[ACU] 读取模板配置失败:',e)}return null}();const n=window.parent||window,r=n.SillyTavern?.getContext?.()?.chat||[],i=r.length,l=r.filter(e=>!e.is_user).length;F.value=i,L.value=l;const c=[],s=Object.keys(t).filter(e=>e.startsWith('sheet_')).sort((e,a)=>(o?.[e]?.orderNo??t[e]?._acu_orderNo??1/0)-(o?.[a]?.orderNo??t[a]?._acu_orderNo??1/0));for(const e of s){const n=t[e],s=o?.[e],d=s?.name||n?.name;if(!d)continue;const u=(s?.updateConfig||{}).updateFrequency??-1,p=-1===u?a.autoUpdateFrequency:u,m=A(d),{aiFloor:f,chatIndex:g,hasHistory:v}=I(e,r,a,m),b=v?l-f:l;c.push({sheetKey:e,name:d,updateFrequency:u,effectiveFrequency:p,lastUpdatedAiFloor:f,lastUpdatedChatIndex:g,unrecordedFloors:b,totalAiFloors:l,totalFloors:i,hasHistory:v,isSummaryOrOutline:m,orderNo:s?.orderNo??n?._acu_orderNo??999})}return M.value=c,P.value=new Date,console.info(`[ACU] 表格更新状态刷新完成，共 ${c.length} 个表格，全局频率: ${a.autoUpdateFrequency}`),c}catch(e){return console.error('[ACU] 获取表格更新状态失败:',e),M.value=[],[]}finally{const t=Date.now()-e;t<500&&await new Promise(e=>setTimeout(e,500-t)),U.value=!1}},formatLastUpdate:function(e){return e.hasHistory?`${e.lastUpdatedAiFloor}/${e.lastUpdatedChatIndex}`:'未初始'},getUnrecordedClass:function(e){if(!e.hasHistory)return'';if(0===e.effectiveFrequency)return'';const t=e.unrecordedFloors/e.effectiveFrequency;return t>=2?'danger':t>=1?'warning':'success'}}}var O=u(5604),R=u(4015);const H=z,W=H.z.object({autoUpdateThreshold:H.z.number().min(1).max(500).default(3),updateBatchSize:H.z.number().min(1).max(50).default(3),skipUpdateFloors:H.z.number().min(0).max(20).default(0),autoUpdateFrequency:H.z.number().min(1).max(100).default(1)}),Y=H.z.object({enabled:H.z.boolean().default(!1),onEmptyCell:H.z.boolean().default(!0),onIndexGap:H.z.boolean().default(!0),targetTables:H.z.array(H.z.string()).default(['总结表','大纲表']),updateTargetTables:H.z.array(H.z.string()).default([]),emptyCheckColumns:H.z.array(H.z.string()).default([])}),X=H.z.object({id:H.z.string(),name:H.z.string().min(1).max(50),createdAt:H.z.number(),settings:W,autoTrigger:Y.optional().transform(e=>Y.parse(e??{}))}),G=H.z.object({presets:H.z.array(X).default([]),activePresetId:H.z.string().nullable().default(null),autoFixPresetId:H.z.string().nullable().default(null),globalAutoTriggerEnabled:H.z.boolean().default(!1),globalAutoExecuteEnabled:H.z.boolean().default(!1)}),q='acu-visualizer',K='updatePresets',J={autoUpdateThreshold:3,updateBatchSize:3,skipUpdateFloors:0,autoUpdateFrequency:1},Z={enabled:!1,onEmptyCell:!0,onIndexGap:!0,targetTables:['总结表','大纲表'],updateTargetTables:[]};function Q(){try{if('function'==typeof getVariables)return getVariables({type:'script',script_id:q})||{}}catch(e){console.warn('[ACU Presets] getVariables 不可用，使用 localStorage 回退')}try{const e=localStorage.getItem(`acu_${K}`);return e?JSON.parse(e):{}}catch{return{}}}function ee(){const e=(0,m.ref)({presets:[],activePresetId:null,autoFixPresetId:null,globalAutoTriggerEnabled:!1,globalAutoExecuteEnabled:!1}),t=(0,m.ref)(!1),a=(0,m.computed)(()=>e.value.presets),o=(0,m.computed)(()=>{const t=e.value.activePresetId;return t&&e.value.presets.find(e=>e.id===t)||null}),n=(0,m.computed)(()=>{const t=e.value.autoFixPresetId;return t&&e.value.presets.find(e=>e.id===t)||null}),r=(0,m.computed)(()=>e.value.presets.length>0);function i(){try{const a=Q()[K];if(a){const t=G.safeParse(a);t.success?(e.value=t.data,console.info('[ACU Presets] 加载预设成功，数量:',t.data.presets.length)):(console.warn('[ACU Presets] 预设数据格式无效，使用默认值'),e.value=G.parse({}))}else e.value=G.parse({});t.value=!0}catch(a){console.error('[ACU Presets] 加载预设失败:',a),e.value=G.parse({}),t.value=!0}}function l(){try{const t=Q();t[K]=(0,R.klona)(e.value),function(e){try{if('function'==typeof replaceVariables)return void replaceVariables((0,R.klona)(e),{type:'script',script_id:q})}catch(e){console.warn('[ACU Presets] replaceVariables 不可用，使用 localStorage 回退')}try{localStorage.setItem(`acu_${K}`,JSON.stringify(e))}catch(e){console.error('[ACU Presets] 保存到 localStorage 失败:',e)}}(t),console.info('[ACU Presets] 保存预设成功')}catch(e){console.error('[ACU Presets] 保存预设失败:',e)}}function c(t){const a=t.trim();return e.value.presets.find(e=>e.name.trim()===a)||null}function s(t,a={},o={}){const n={id:`preset_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:t,createdAt:Date.now(),settings:W.parse({...J,...a}),autoTrigger:Y.parse({...Z,...o})};return e.value.presets.push(n),l(),console.info('[ACU Presets] 创建预设:',n.name),n}function d(t,a){const o=e.value.presets.findIndex(e=>e.id===t);if(-1===o)return console.warn('[ACU Presets] 预设不存在:',t),!1;const n=e.value.presets[o];return void 0!==a.name&&(n.name=a.name),void 0!==a.settings&&(n.settings=W.parse({...n.settings,...a.settings})),void 0!==a.autoTrigger&&(n.autoTrigger=Y.parse({...n.autoTrigger,...a.autoTrigger})),l(),console.info('[ACU Presets] 更新预设:',n.name),!0}const u=(0,m.computed)(()=>e.value.globalAutoTriggerEnabled),p=(0,m.computed)(()=>e.value.globalAutoExecuteEnabled);return t.value||i(),{storage:e,presets:a,activePreset:o,autoFixPreset:n,hasPresets:r,isLoaded:t,globalAutoTriggerEnabled:u,globalAutoExecuteEnabled:p,loadPresets:i,savePresets:l,createPreset:s,createOrUpdatePreset:function(e,t={},a={}){const o=c(e);return o?(d(o.id,{settings:W.parse({...J,...t}),autoTrigger:Y.parse({...Z,...a})}),console.info('[ACU Presets] 更新预设:',e),{preset:o,isNew:!1}):{preset:s(e,t,a),isNew:!0}},findPresetByName:c,updatePreset:d,deletePreset:function(t){const a=e.value.presets.findIndex(e=>e.id===t);if(-1===a)return console.warn('[ACU Presets] 预设不存在:',t),!1;const o=e.value.presets[a];return e.value.presets.splice(a,1),e.value.activePresetId===t&&(e.value.activePresetId=null),e.value.autoFixPresetId===t&&(e.value.autoFixPresetId=null),l(),console.info('[ACU Presets] 删除预设:',o.name),!0},setActivePreset:function(t){e.value.activePresetId=t,l()},setAutoFixPreset:function(t){e.value.autoFixPresetId=t,l()},duplicatePreset:function(t,a){const o=e.value.presets.find(e=>e.id===t);return o?s(a||`${o.name} (副本)`,(0,R.klona)(o.settings),(0,R.klona)(o.autoTrigger)):(console.warn('[ACU Presets] 源预设不存在:',t),null)},createFromCurrent:function(e,t){return s(e,t)},getPresetSettings:function(t){const a=e.value.presets.find(e=>e.id===t);return a?(0,R.klona)(a.settings):null},setGlobalAutoTrigger:function(t){e.value.globalAutoTriggerEnabled=t,t||(e.value.globalAutoExecuteEnabled=!1),l(),console.info('[ACU Presets] 全局问题检测提示:',t)},setGlobalAutoExecute:function(t){e.value.globalAutoExecuteEnabled=t,l(),console.info('[ACU Presets] 全局自动执行修复:',t)},UpdateSettingsSchema:W,AutoTriggerConfigSchema:Y,UpdatePresetSchema:X}}let te=null,ae=null,oe=!1;function ne(){const e=(0,y.D)(),t=(0,k.j_)(),a=ee(),o=E(),n=j();let r=0;let i=!1;function l(e,t){if(!e&&!t)return!1;if(!e||!t)return!0;if(e.length!==t.length)return!0;for(let a=0;a<e.length;a++){const o=String(e[a]??'').trim(),n=String(t[a]??'').trim();if(('null'===o||'undefined'===o?'':o)!==('null'===n||'undefined'===n?'':n))return!0}return!1}async function c(e,t){const a=function(){try{const e=window.SillyTavern||window.parent?.SillyTavern||window.top?.SillyTavern;if(e?.getCurrentChatId){const t=e.getCurrentChatId();if(t)return t}if(e?.chat_metadata?.chat_id)return String(e.chat_metadata.chat_id)}catch(e){console.warn('[ACU] 获取 chatId 失败:',e)}return'default'}();if(!a)return void console.warn('[ACU] 无法获取 chatId，跳过 AI 变更历史保存');let o=0;for(const n in t){if(!n.startsWith('sheet_'))continue;const r=t[n],i=e[n];if(!r?.content||!Array.isArray(r.content))continue;const c=r.name||n.replace('sheet_',''),s=r.content[0]||[];for(let e=1;e<r.content.length;e++){const t=e-1,n=r.content[e],d=i?.content?.[e];if(l(d,n)&&d&&Array.isArray(d)){const e={index:t,key:`${c}-row-${t}`,cells:d.map((e,t)=>({colIndex:t,key:String(s[t]||`col_${t}`),value:String(e??'')}))};try{await(0,B.O)(a,c,e,'ai'),o++}catch(e){console.warn('[ACU] 保存 AI 变更历史失败:',e)}}}}o>0&&console.info(`[ACU] 已保存 ${o} 行 AI 变更历史记录`)}function s(){const{getDB:o}=(0,v.M1)(),r=o();r?(oe=!1,r.registerTableUpdateCallback&&(te=async()=>{if(oe)return;if(t.isEditingOrder||e.isSaving)return;const o=e.snapshot,r=(0,v.tu)();if(r){o&&await c(o,r);const i=e.setStagedData(r);e.generateDiffMap(i),t.triggerAiNotify(),n.refresh(),a.globalAutoTriggerEnabled.value?(e.checkIntegrity(r),u()):e.clearIntegrityIssues()}},r.registerTableUpdateCallback(te),console.info('[ACU] 已注册表格更新回调')),r.registerTableFillStartCallback&&(ae=()=>{if(oe)return;if(e.saveLastState(),t.setAiGenerating(!0),e.diffMap&&e.diffMap.size>0)return void console.info('[ACU] 累积高亮：保留旧快照');const a=(0,v.tu)();a&&Object.keys(a).length>0&&(e.saveSnapshot(a),console.info('[ACU] 快照已更新'))},r.registerTableFillStartCallback(ae),console.info('[ACU] 已注册表格填充回调 (高亮逻辑)'))):console.warn('[ACU] 数据库 API 未就绪，跳过回调注册')}function d(){oe=!0;const{getDB:e}=(0,v.M1)(),t=e();if(t)try{t.registerTableUpdateCallback&&te&&('function'==typeof t.unregisterTableUpdateCallback&&t.unregisterTableUpdateCallback(te),te=null,console.info('[ACU] 已注销表格更新回调')),t.registerTableFillStartCallback&&ae&&('function'==typeof t.unregisterTableFillStartCallback&&t.unregisterTableFillStartCallback(ae),ae=null,console.info('[ACU] 已注销表格填充回调'))}catch(e){console.warn('[ACU] 注销回调时出错:',e)}}async function u(){if(!a.globalAutoTriggerEnabled.value)return;if(!e.hasIntegrityIssues)return;const t=Date.now();if(t-r<3e4)return;if(i)return;const n=a.autoFixPreset.value;if(n&&n.autoTrigger.enabled){let a=!1;const l=e.problematicTables;if(l&&l.length>0&&(a=!0),a){r=t;const a=e.getIntegritySummary();i=!0,O.toast.info(`🔧 检测到问题：${a}，正在自动修复...`),console.info('[ACU] 自动触发修复:',a);try{const e=n.autoTrigger.updateTargetTables||[],t=await o.executeWithPreset({autoUpdateThreshold:n.settings.autoUpdateThreshold,autoUpdateFrequency:n.settings.autoUpdateFrequency,updateBatchSize:n.settings.updateBatchSize,skipUpdateFloors:n.settings.skipUpdateFloors},e);t.success?O.toast.success('✅ 自动修复已完成'):O.toast.warning('⚠️ 自动修复失败：'+(t.message||'请手动更新'))}catch(e){console.error('[ACU] 自动修复失败:',e),O.toast.error('❌ 自动修复出错')}finally{i=!1}}}}return(0,m.onMounted)(()=>{s()}),(0,m.onUnmounted)(()=>{d()}),{registerCallbacks:s,unregisterCallbacks:d,checkAndNotifyIssues:u}}var re=u(6212);function ie(e){const t=Object.keys(e),a=t.find(e=>e.match(/^shujuku_v\d+_allSettings_v2$/)&&parseInt(e.match(/v(\d+)/)?.[1]||'0')>=100);if(a)return a;const o=t.find(e=>e.match(/^shujuku_v\d+_allSettings_v2$/));return o||null}function le(e){const t=e.match(/shujuku_v?(\d+)/i);return t?parseInt(t[1],10):0}function ce(){const e=window.parent||window;try{const t=e.SillyTavern?.getContext?.(),a=t?.extensionSettings?.__userscripts;if(a){const e=function(e,t){const a=e.filter(e=>t.test(e));return 0===a.length?null:(a.sort((e,t)=>le(t)-le(e)),a[0])}(Object.keys(a),/shujuku_v\d+__userscript_settings_v1/i);if(e&&a[e]){const t=a[e],o='string'==typeof t?JSON.parse(t):t,n=`${e.replace(/__userscript_settings_v1$/i,'')}_globalMeta_v1`;if(o[n]){const e=o[n],t='string'==typeof e?JSON.parse(e):e,a=String(t.activeIsolationCode||'');return a&&console.info(`[ACU] 使用隔离标签: "${a}" (from extensionSettings)`),a}}}let o=window.localStorage,n=ie(o);if(!n&&window.parent)try{o=window.parent.localStorage,n=ie(o)}catch{}if(n){const e=o.getItem(n);if(e){const t=JSON.parse(e);if(t.dataIsolationEnabled&&t.dataIsolationCode)return console.info(`[ACU] 使用隔离标签: "${t.dataIsolationCode}" (from localStorage: ${n})`),t.dataIsolationCode}}}catch(e){console.warn('[ACU] 读取隔离配置失败:',e)}return''}const se='TavernDB_ACU_InternalSheetGuide',de='orderNo';function ue(){const e=(0,y.D)(),t=(0,f.JH)();async function a(t,a,o=-1){const r=(0,R.klona)(t);if(a&&e.pendingDeletes.size>0)for(const t in r){if('mate'===t)continue;const a=r[t];if(!a||!a.name||!a.content)continue;const o=[a.content[0]];for(let t=1;t<a.content.length;t++){const n=t-1;e.pendingDeletes.has(`${a.name}-row-${n}`)||o.push(a.content[t])}a.content=o}try{let e=window.SillyTavern||(window.parent?window.parent.SillyTavern:null);!e&&window.top&&window.top.SillyTavern&&(e=window.top.SillyTavern);const t=ce();if(e&&e.chat&&e.chat.length>0){let a=null,i=-1;if(o>=0&&o<e.chat.length)i=o,a=e.chat[i];else{for(let t=e.chat.length-1;t>=0;t--)if(!e.chat[t].is_user&&e.chat[t].TavernDB_ACU_IsolatedData){i=t,a=e.chat[t];break}if(!a)for(let t=e.chat.length-1;t>=0;t--)if(!e.chat[t].is_user){i=t,a=e.chat[t];break}}if(a){let o=t;if(a.TavernDB_ACU_IsolatedData){const e=Object.keys(a.TavernDB_ACU_IsolatedData);e.length>0&&(o=e[0])}else a.TavernDB_ACU_IsolatedData={};a.TavernDB_ACU_IsolatedData[o]||(a.TavernDB_ACU_IsolatedData[o]={independentData:{},modifiedKeys:[],updateGroupKeys:[]});const l=a.TavernDB_ACU_IsolatedData[o];l.independentData||(l.independentData={});const c=Object.keys(r).filter(e=>e.startsWith('sheet_'));c.forEach(e=>{l.independentData[e]=(0,R.klona)(r[e])});const s=l.modifiedKeys||[];if(l.modifiedKeys=[...new Set([...s,...c])],c.length>0){const t=function(e){const t={mate:{type:'chatSheets',version:1}};return Object.keys(e).forEach(a=>{if(!a.startsWith('sheet_'))return;const o=e[a];if(!o||'object'!=typeof o)return;const n=o.content,r=Array.isArray(n)&&Array.isArray(n[0])?n[0]:[null];t[a]={uid:o.uid||a,name:o.name||a,sourceData:o.sourceData||{note:'',initNode:'',insertNode:'',updateNode:'',deleteNode:''},content:[r],updateConfig:o.updateConfig||{uiSentinel:-1,contextDepth:-1,updateFrequency:-1,batchSize:-1,skipFloors:-1},exportConfig:o.exportConfig||{enabled:!1,splitByRow:!1,entryName:o.name||a,entryType:'constant',keywords:'',preventRecursion:!0,injectionTemplate:''},[de]:o[de]??void 0}}),t}(r);Object.keys(t).some(e=>e.startsWith('sheet_'))&&function(e,t,a){if(!e?.chat||0===e.chat.length)return console.info('[ACU] 无法更新指导表：聊天记录为空'),!1;const o=e.chat[0];if(!o)return console.info('[ACU] 无法更新指导表：chat[0] 不存在'),!1;try{let e=null;const n=o[se];if(n)if('string'==typeof n)try{e=JSON.parse(n)}catch{e=null}else'object'==typeof n&&(e=n);return e&&'object'==typeof e||(e={version:1,tags:{}}),e.tags&&'object'==typeof e.tags||(e.tags={}),e.version=1,e.tags[t]={data:a,updatedAt:Date.now(),reason:'vue_visualizer_save'},o[se]=e,console.info(`[ACU] 已更新 chat[0] 指导表 (tag=${t||'无标签'}, tables=${Object.keys(a).filter(e=>e.startsWith('sheet_')).length})`),!0}catch(e){return console.warn('[ACU] 更新指导表失败:',e),!1}}(e,o,t)}if(e.saveChat)return await e.saveChat(),await n(),{...r,_savedToFloor:i}}}}catch(e){throw console.error('[ACU] Core save error:',e),e}return await n(),r}function o(e,t,a){if(!e||!e.chat)return-1;for(let o=e.chat.length-1;o>=0;o--){const n=e.chat[o];if(!n.is_user){if(n.TavernDB_ACU_IsolatedData&&'object'==typeof n.TavernDB_ACU_IsolatedData){const e=n.TavernDB_ACU_IsolatedData[a];if(e&&e.independentData&&e.independentData[t])return o;if(!a&&n.TavernDB_ACU_IsolatedData['']&&n.TavernDB_ACU_IsolatedData[''].independentData&&n.TavernDB_ACU_IsolatedData[''].independentData[t])return o}if(n.TavernDB_ACU_IndependentData&&n.TavernDB_ACU_IndependentData[t]){if(a&&n.TavernDB_ACU_Identity&&n.TavernDB_ACU_Identity!==a)continue;return o}}}return-1}async function n(){const e=(0,v.M1)().getDB();if(e&&e.syncWorldbookEntries)try{await e.syncWorldbookEntries({createIfNeeded:!0})}catch(e){console.warn('[ACU] Worldbook sync failed after save:',e)}else console.warn('[ACU] syncWorldbookEntries API not found, skipping sync.')}let r=null;function i(a=5e3){r&&(r(),r=null),r=(0,re.Th)(()=>e.tables,async()=>{if(e.hasChanges&&t.config.autoSave)try{console.info('[ACU] 自动保存触发...'),await e.saveToDatabase(),console.info('[ACU] 自动保存完成')}catch(e){console.error('[ACU] 自动保存失败:',e)}},{debounce:a,deep:!0}),console.info(`[ACU] 自动保存已启用，防抖延迟: ${a}ms`)}return{saveToDatabase:async function(t=null,r=!1,i=!1,l=-1){if(e.isSaving)return console.warn('[ACU] Save already in progress'),!1;let c=e.getStagedData();if(c||(c=t||(0,v.tu)()),!c)return console.warn('[ACU] 无数据可保存'),!1;const{$}=(0,v.M1)(),s=$?.('#acu-btn-save-global, #acu-parent-container #acu-btn-save-global');let d='';try{e.isSaving=!0,!r&&s?.length&&(d=s.html(),s.html('<i class="fa-solid fa-spinner fa-spin"></i>').prop('disabled',!0));let t=null;if(l>=0)console.info('[ACU] 执行全量保存 (另存为模式)...'),t=await a(c,i,l);else{console.info('[ACU] 执行增量保存 (默认模式)...');const a=e.getModifiedTableIds();if(0===a.length)return console.info('[ACU] 无变更，跳过保存'),!0;t=await async function(t,a,r){if(0===r.length)return null;console.info('[ACU] 开始增量保存，涉及表格:',r);const i=(0,R.klona)(t);if(a&&e.pendingDeletes.size>0)for(const t of r){if('mate'===t)continue;const a=i[t];if(!a||!a.name||!a.content)continue;const o=[a.content[0]];let n=!1;for(let t=1;t<a.content.length;t++){const r=t-1;e.pendingDeletes.has(`${a.name}-row-${r}`)?n=!0:o.push(a.content[t])}n&&(a.content=o)}try{let e=window.SillyTavern||(window.parent?window.parent.SillyTavern:null);!e&&window.top&&window.top.SillyTavern&&(e=window.top.SillyTavern);const t=ce(),a=new Map,l=new Set;for(const n of r){const r=o(e,n,t);-1!==r?(a.has(r)||a.set(r,new Set),a.get(r).add(n)):l.add(n)}if(l.size>0){let t=-1;for(let a=e.chat.length-1;a>=0;a--)if(!e.chat[a].is_user&&e.chat[a].TavernDB_ACU_IsolatedData){t=a;break}if(-1===t)for(let a=e.chat.length-1;a>=0;a--)if(!e.chat[a].is_user){t=a;break}-1!==t?(a.has(t)||a.set(t,new Set),l.forEach(e=>a.get(t).add(e)),console.info(`[ACU] 新增表格 ${Array.from(l).join(', ')} 将存入楼层 ${t}`)):console.warn('[ACU] 无法找到任何 AI 楼层来存放新表格')}let c=!1;for(const[o,n]of a.entries()){const a=e.chat[o];if(!a)continue;let r=a.TavernDB_ACU_IsolatedData;if('string'==typeof r)try{r=JSON.parse(r)}catch{r={}}r&&'object'==typeof r||(r={});const l=t||'';r[l]||(r[l]={independentData:{},modifiedKeys:[],updateGroupKeys:[]});const s=r[l];s.independentData||(s.independentData={});const d=Array.from(n);d.forEach(e=>{i[e]&&(s.independentData[e]=(0,R.klona)(i[e]))});const u=s.modifiedKeys||[];s.modifiedKeys=[...new Set([...u,...d])],a.TavernDB_ACU_IsolatedData=r,t&&(a.TavernDB_ACU_Identity=t),a.TavernDB_ACU_IndependentData=s.independentData,a.TavernDB_ACU_ModifiedKeys=s.modifiedKeys,a.TavernDB_ACU_UpdateGroupKeys=s.updateGroupKeys,c=!0,console.info(`[ACU] 已更新楼层 ${o}，涉及表格: ${d.join(', ')}`)}if(c&&e.saveChat)return await e.saveChat(),await n(),i}catch(e){throw console.error('[ACU] Incremental save error:',e),e}return await n(),i}(c,i,a)}if(!r){const a=t?._savedToFloor;void 0!==a?O.toast.success(`已更新至第 ${a} 层 (覆盖旧数据)`):t&&O.toast.success('保存成功');$(window.parent?.document||document).find('.acu-highlight-changed').removeClass('acu-highlight-changed'),s?.removeClass('acu-save-alert'),e.clearChanges(i),e.stagedData=null,t&&e.saveSnapshot(t)}return await n(),!0}catch(e){return console.error('[ACU] Save failed:',e),r||O.toast.error('保存失败: '+e.message),!1}finally{setTimeout(()=>{e.isSaving=!1,!r&&s?.length&&s.html(d||'<i class="fa-solid fa-save"></i>').prop('disabled',!1)},100)}},syncWorldbook:n,saveSnapshot:function(t){e.saveSnapshot(t)},loadSnapshot:function(){return e.loadSnapshot()},clearSnapshot:function(){e.clearSnapshot()},purgeFloorRange:async function(t,a){if(e.isSaving)return;let o=window.SillyTavern||(window.parent?window.parent.SillyTavern:null);if(!o&&window.top&&window.top.SillyTavern&&(o=window.top.SillyTavern),!o||!o.chat)return void O.toast.error('无法连接到 SillyTavern 核心数据');const r=o.chat.length-1;if(t=Math.max(0,t),a=Math.min(r,a),isNaN(t)||isNaN(a)||t>a)O.toast.warning('无效的楼层范围');else{e.isSaving=!0;try{console.log(`[ACU-Purge] 开始强力清洗楼层范围: ${t} - ${a}`);let r=0;const i=['TavernDB_ACU_Data','TavernDB_ACU_SummaryData','TavernDB_ACU_IndependentData','TavernDB_ACU_Identity','TavernDB_ACU_IsolatedData','TavernDB_ACU_ModifiedKeys','TavernDB_ACU_UpdateGroupKeys'];for(let e=t;e<=a;e++){const t=o.chat[e];if(!t)continue;let a=!1;for(const e of i)Object.prototype.hasOwnProperty.call(t,e)&&(delete t[e],a=!0);a&&r++}if(r>0){o.saveChat&&await o.saveChat(),await n();const t=(0,v.tu)();t?e.saveSnapshot(t):e.clearSnapshot(),e.clearChanges(!0),O.toast.success(`已强力清除 ${r} 个楼层的数据`)}else O.toast.info('指定范围内没有可清除的数据')}catch(e){console.error('[ACU] Purge Error:',e),O.toast.error('清除失败: '+e.message)}finally{e.isSaving=!1}}},purgeTableDataByRange:async function(t,a,o){const r=Array.isArray(t)?[...new Set(t.filter(e=>'string'==typeof e&&e.startsWith('sheet_')))]:[];if(0===r.length)return{changed:!1,changedCount:0};let i=window.SillyTavern||(window.parent?window.parent.SillyTavern:null);if(!i&&window.top&&window.top.SillyTavern&&(i=window.top.SillyTavern),!i?.chat||0===i.chat.length)return O.toast.error('无法连接到 SillyTavern 核心数据'),{changed:!1,changedCount:0};const l=i.chat.length-1;if(a=Math.max(0,a),o=Math.min(l,o),isNaN(a)||isNaN(o)||a>o)return O.toast.warning('无效的楼层范围'),{changed:!1,changedCount:0};if(e.isSaving)return O.toast.warning('保存操作进行中，请稍后再试'),{changed:!1,changedCount:0};e.isSaving=!0;const c=(e,t)=>{if(!Array.isArray(e)||0===e.length)return{arr:e,changed:!1};const a=e.filter(e=>e!==t);return{arr:a,changed:a.length!==e.length}};try{console.info(`[ACU-AdvancedPurge] 开始清除表格 [${r.join(', ')}] 在楼层 ${a}-${o} 的数据`);let t=!1,l=0;for(let e=a;e<=o;e++){const a=i.chat[e];if(!a||a.is_user)continue;let o=!1;a.TavernDB_ACU_IsolatedData&&'object'==typeof a.TavernDB_ACU_IsolatedData&&(Object.keys(a.TavernDB_ACU_IsolatedData).forEach(e=>{const t=a.TavernDB_ACU_IsolatedData[e];t&&'object'==typeof t&&(t.independentData&&'object'==typeof t.independentData&&r.forEach(e=>{t.independentData[e]&&(delete t.independentData[e],o=!0)}),Array.isArray(t.modifiedKeys)&&r.forEach(e=>{const a=c(t.modifiedKeys,e);a.changed&&(t.modifiedKeys=a.arr,o=!0)}),Array.isArray(t.updateGroupKeys)&&r.forEach(e=>{const a=c(t.updateGroupKeys,e);a.changed&&(t.updateGroupKeys=a.arr,o=!0)}),!t.independentData||0!==Object.keys(t.independentData).length||t.modifiedKeys&&0!==t.modifiedKeys.length||t.updateGroupKeys&&0!==t.updateGroupKeys.length||(delete a.TavernDB_ACU_IsolatedData[e],o=!0))}),0===Object.keys(a.TavernDB_ACU_IsolatedData).length&&(delete a.TavernDB_ACU_IsolatedData,o=!0)),a.TavernDB_ACU_IndependentData&&'object'==typeof a.TavernDB_ACU_IndependentData&&r.forEach(e=>{a.TavernDB_ACU_IndependentData[e]&&(delete a.TavernDB_ACU_IndependentData[e],o=!0)}),Array.isArray(a.TavernDB_ACU_ModifiedKeys)&&r.forEach(e=>{const t=c(a.TavernDB_ACU_ModifiedKeys,e);t.changed&&(a.TavernDB_ACU_ModifiedKeys=t.arr,o=!0)}),Array.isArray(a.TavernDB_ACU_UpdateGroupKeys)&&r.forEach(e=>{const t=c(a.TavernDB_ACU_UpdateGroupKeys,e);t.changed&&(a.TavernDB_ACU_UpdateGroupKeys=t.arr,o=!0)}),a.TavernDB_ACU_Data&&'object'==typeof a.TavernDB_ACU_Data&&r.forEach(e=>{a.TavernDB_ACU_Data[e]&&(delete a.TavernDB_ACU_Data[e],o=!0)}),a.TavernDB_ACU_SummaryData&&'object'==typeof a.TavernDB_ACU_SummaryData&&r.forEach(e=>{a.TavernDB_ACU_SummaryData[e]&&(delete a.TavernDB_ACU_SummaryData[e],o=!0)}),o&&(t=!0,l++)}if(t){i.saveChat&&await i.saveChat(),await n();const t=(0,v.tu)();t?e.saveSnapshot(t):e.clearSnapshot(),e.clearChanges(!0),console.info(`[ACU-AdvancedPurge] 清除完成，影响 ${l} 个楼层`)}return{changed:t,changedCount:l}}catch(e){throw console.error('[ACU-AdvancedPurge] 清除失败:',e),e}finally{e.isSaving=!1}},setupAutoSave:i,stopAutoSave:function(){r&&(r(),r=null,console.info('[ACU] 自动保存已停止'))},initDataPersistence:async function(){console.info('[ACU] 初始化数据持久化...'),await e.loadFromDatabase(),t.config.autoSave&&i(t.config.autoSaveDelay||5e3),console.info('[ACU] 数据持久化初始化完成')},getTableData:v.tu,dataStore:e}}void 0===window.__acu_hidden_prompt&&(window.__acu_hidden_prompt='');const pe=[];let me=!1;function fe(e){window.__acu_hidden_prompt=e,console.info('[ACU] 隐藏提示词已设置:',e.substring(0,50))}function ge(){return window.__acu_hidden_prompt||''}function ve(){be();const e=window.parent.document,t=e.getElementById('send_textarea'),a=e.getElementById('send_but');if(!t||!a)return console.warn('[ACU] 未找到输入框或发送按钮，1秒后重试'),void setTimeout(ve,1e3);const o=e=>{(async e=>{if(me)return;const o=ge();if(o.trim()){e.preventDefault(),e.stopImmediatePropagation(),me=!0;try{const e=t.value.trim(),n=`${o}`,r=e?`${n}\n${e}`:n;console.info('[ACU] 拼接消息:',r.substring(0,80));const i=window.parent;if(!i.TavernHelper||!i.TavernHelper.triggerSlash)throw console.error('[ACU] TavernHelper.triggerSlash 不可用'),new Error('TavernHelper API unavailable');await i.TavernHelper.triggerSlash(`/send as=user ${r}`),console.info('[ACU] ✓ 用户消息已创建'),fe(''),t.value='',t.dispatchEvent(new Event('input',{bubbles:!0})),await new Promise(e=>setTimeout(e,50)),a.click(),console.info('[ACU] ✓ 已触发生成')}catch(e){console.error('[ACU] 发送失败:',e),O.toast.error('隐藏提示词发送失败')}finally{setTimeout(()=>{me=!1},100)}}})(e)};a.addEventListener('click',o,{capture:!0}),pe.push(()=>a.removeEventListener('click',o,{capture:!0}));const n=e=>{if('Enter'===e.key&&!e.shiftKey){if(!ge().trim())return;e.preventDefault(),e.stopImmediatePropagation(),a.click()}};t.addEventListener('keydown',n,{capture:!0}),pe.push(()=>t.removeEventListener('keydown',n,{capture:!0})),console.info('[ACU] 发送拦截已设置')}function be(){pe.forEach(e=>e()),pe.length=0}function he(e,t='\n',a='#send_textarea'){const o=window.parent.document.querySelector(a),n=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(o){const r=o.value||'',i=r?r+t+e:e;o.value=i,o.dispatchEvent(new Event('input',{bubbles:!0})),n||(o.focus(),'setSelectionRange'in o&&o.setSelectionRange(i.length,i.length)),console.info('[ACU] 提示词已追加到输入框:',a)}else console.warn('[ACU] 未找到输入框:',a)}let xe=null,we=!1;function ye(){if(we)return;window.parent.document.addEventListener('focusin',e=>{const t=e.target;if(t&&('TEXTAREA'===t.tagName||'INPUT'===t.tagName&&'text'===t.type)){if(function(e){const t=e.id||'',a=e.className||'';return!(!t.startsWith('acu')&&!t.includes('-acu-'))||(!!a.includes('acu-')||!!e.closest('#acu-parent-container, .acu-wrapper, .acu-modal-container'))}(t))return void console.info('[ACU] 忽略 ACU 内部输入框:',t.id||t.className);xe=t,console.info('[ACU] 记录焦点输入框:',t.id||t.className)}},!0),we=!0,console.info('[ACU] 焦点追踪已设置')}function ke(){return xe}function Ce(e){xe=e}function Ne(e,t=' '){if(xe&&xe.isConnected){const a=xe,o=a.value||'',n=o?o+t+e:e;a.value=n,a.dispatchEvent(new Event('input',{bubbles:!0})),a.focus(),'setSelectionRange'in a&&a.setSelectionRange(n.length,n.length),console.info('[ACU] 提示词已追加到记录的输入框:',a.id||a.className)}else he(e,t)}function Ve(){return{setHiddenPrompt:fe,getHiddenPrompt:ge,setupSendIntercept:ve,cleanupSendIntercept:be,appendPromptToInput:he,appendToActiveInput:Ne,setupFocusTracking:ye,getLastFocusedInput:ke,setTargetInput:Ce}}function Ee(){const{saveToDatabase:e,getTableData:t,saveSnapshot:a,loadSnapshot:o}=ue(),n=(0,y.D)();return{insertRow:async(a,o)=>{let r=n.getStagedData();if(r||(r=t()),!r)return console.warn('[ACU insertRow] 无法获取数据'),void O.toast.error('无法获取数据');const i=r[a];if(!i?.content)return console.warn('[ACU insertRow] 未找到表格:',a,'可用表格:',Object.keys(r)),void O.toast.error('未找到目标表格');const l=i.content,c=l[0]?l[0].length:2,s=new Array(c).fill('');c>0&&(s[0]=String(l.length)),l.splice(o+2,0,s),O.toast.info('正在插入新行...'),n.setStagedData(r);const d=i.name||a.replace('sheet_',''),u=o+1,p=n.getRowKey(d,u);n.manualDiffMap.add(p),console.info(`[ACU insertRow] 已添加变更标记: ${p}`),n.saveLastState();await e(r,!1,!0)&&O.toast.success('新行已插入')},copyContent:e=>{const t=window.parent||window;if(t.TavernHelper&&t.TavernHelper.triggerSlash)try{const a=e.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\n/g,'\\n');return t.TavernHelper.triggerSlash(`/clipboard-set "${a}"`),void O.toast.success('已复制')}catch(e){console.warn('酒馆复制接口失败',e)}const a=document.createElement('textarea');a.value=e,a.style.position='fixed',a.style.left='-9999px',document.body.appendChild(a),a.select();try{document.execCommand('copy'),O.toast.success('已复制')}catch(t){prompt('请手动复制:',e)}document.body.removeChild(a)},toggleDelete:(e,t,a)=>{if(!a||!a.length){const{$}=(0,v.M1)();if($){const o=$(window.parent.document).find(`.acu-editable-title[data-tname="${e}"][data-row="${t}"]`);o.length&&(a=o.closest('.acu-data-card'))}}if(!a||!a.find)return void console.warn('[ACU] toggleDelete failed: card element not found',{tableName:e,rowIdx:t});const o=`${e}-row-${t}`;n.isPendingDelete(o)?(n.toggleDelete(o),a.find('.acu-badge-pending').remove(),O.toast.success('已取消删除')):(n.toggleDelete(o),0===a.find('.acu-badge-pending').length&&a.append('<div class="acu-badge-pending">待删除</div>'),O.toast.warning('整行已标记为删除'))},setInput:e=>{Ne(e,' ')},editCell:(e,r,i)=>{const{tableKey:l,rowIdx:c,colIdx:s,$cell:d}=e,{$}=(0,v.M1)(),u=i||document;let p=n.getStagedData();if(p||(p=t()),p||(p=o()),p){const e=p[l];e?.content&&e.content[c+1]&&(e.content[c+1][s]=r,n.setStagedData(p),a(p))}d.attr('data-val',encodeURIComponent(r)),d.data('val',encodeURIComponent(r));let m=d;d.hasClass('acu-grid-item')?m=d.find('.acu-grid-value'):d.hasClass('acu-full-item')&&(m=d.find('.acu-full-value'));const f=(0,v.n2)(r);f&&!d.hasClass('acu-editable-title')?m.html(`<span class="acu-badge ${f}">${r}</span>`):m.text(r),m.addClass('acu-highlight-changed'),d.hasClass('acu-editable-title')&&d.addClass('acu-highlight-changed'),n.updateCell(l,c,s,r);$(u).find('#acu-btn-save-global').addClass('acu-save-alert'),O.toast.info('修改已暂存')}}}var Be=u(7696);const Te=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;function Se(){if('undefined'!=typeof window){if(window.innerWidth<=768)return!0;if(window.innerWidth>1024)return!1}return Te.test(navigator.userAgent)}function De(){const e=(0,m.ref)(Se());if('undefined'!=typeof window){const t=()=>{e.value=Se()};window.addEventListener('resize',t),(0,m.onUnmounted)(()=>{window.removeEventListener('resize',t)})}return{isMobile:e,isTouchDevice:(0,m.computed)(()=>'ontouchstart'in window||navigator.maxTouchPoints>0)}}function Ae(e,t={}){const{initialX:a=100,initialY:o=100,edgePadding:n=10,elementWidth:r=50,onPositionChange:i,useParentWindow:l=!1}=t,c=()=>l&&window.parent&&window.parent!==window?window.parent:window,s=()=>{const e=c();return{width:e.innerWidth,height:e.innerHeight}},d=(0,m.ref)(!1);let u=0,p=0;const f=(0,m.computed)(()=>{if(l)try{return c().document}catch{return document}return document}),{x:g,y:v,isDragging:b}=(0,Be.PMY)(e,{initialValue:{x:a,y:o},draggingElement:f,onStart(e,t){d.value=!1,u=t.clientX,p=t.clientY},onMove(e,t){const a=t.clientX,o=t.clientY,n=Math.abs(a-u),r=Math.abs(o-p);(n>5||r>5)&&(d.value=!0)},onEnd(){if(d.value){const{width:e,height:t}=s();g.value<n&&(g.value=n),g.value>e-r-n&&(g.value=e-r-n),v.value<n&&(v.value=n),v.value>t-r-n&&(v.value=t-r-n),i?.(g.value,v.value)}}}),h=(0,m.computed)(()=>({left:`${g.value}px`,top:`${v.value}px`,cursor:b.value?'grabbing':'grab'}));return{x:g,y:v,isDragging:b,wasDragging:d,style:h,reset:()=>{g.value=a,v.value=o,i?.(g.value,v.value)}}}u(2134);const ze={clearTableOnSwipe:!0};function Ie(){const e=window.parent||window,t=e.SillyTavern||e.top?.SillyTavern;return t&&'function'==typeof t.getContext?t.getContext():null}function _e(){const e=(0,y.D)(),t=(0,f.JH)(),a=(0,m.ref)(!1),o=(0,m.ref)({...ze}),n=[];async function r(t){try{return await e.purgeFloorRange(t,t),console.info(`[ACU Swipe] 已清除第 ${t} 楼的表格数据`),!0}catch(e){return console.error('[ACU Swipe] 清除楼层数据失败:',e),!1}}function i(e){if(e.is_user)return!1;return(e.swipe_id??0)>=(e.swipes?.length??1)-1}function l(e){const t=e.TavernDB_ACU_IsolatedData;return!(!t||'object'!=typeof t)&&Object.keys(t).length>0}async function c(){if(console.info('[ACU Swipe] handleSwipeClearOnly 开始执行'),a.value)return void console.info('[ACU Swipe] 正在处理中，跳过');const e=Ie();if(!e?.chat?.length)return void console.warn('[ACU Swipe] SillyTavern context.chat 不可用');const t=e.chat.length-1,o=e.chat[t];if(console.info('[ACU Swipe] 检查最后一楼:',{index:t,is_user:o.is_user,swipe_id:o.swipe_id,swipes_length:o.swipes?.length}),!i(o))return void console.info('[ACU Swipe] 查看历史 swipe，跳过清除');const n=l(o);if(console.info('[ACU Swipe] 最后一楼是否有 ACU 数据:',n),n){a.value=!0;try{console.info('[ACU Swipe] 开始清除第',t,'楼的表格数据');await r(t)&&O.toast.info('Swipe: 已清除最后一楼表格数据')}finally{a.value=!1}}else console.info('[ACU Swipe] 最后一楼无 ACU 数据，跳过清除')}async function s(e){const a=t.config.clearTableOnSwipe??o.value.clearTableOnSwipe;console.info('[ACU Swipe] handleSwipe 调用',{clearEnabled:a}),a?(console.info('[ACU Swipe] 执行清除表格'),await c()):console.info('[ACU Swipe] 功能未启用，跳过')}function d(){n.forEach(e=>e()),n.length=0,console.info('[ACU Swipe] Swipe 增强功能已清理')}return(0,m.onUnmounted)(()=>{d()}),{isProcessing:a,config:o,updateConfig:function(e){o.value={...o.value,...e},console.info('[ACU Swipe] 配置已更新:',o.value)},getConfig:function(){return{...o.value}},clearFloorData:r,handleSwipe:s,handleSwipeClearOnly:c,willTriggerNewGeneration:i,init:function(){!function(){const{$}=(0,v.M1)();if(!$)return void console.warn('[ACU Swipe] jQuery 不可用，无法初始化桌面端监听');const e=window.parent.document,a=async e=>{const a=e.target.closest('.swipe_right');if(!a)return;if(e.__acu_processed)return;if(!(t.config.clearTableOnSwipe??o.value.clearTableOnSwipe))return;console.info('[ACU Swipe] 拦截 swipe_right 点击，准备清理数据'),e.preventDefault(),e.stopImmediatePropagation();try{await s()}catch(e){console.error('[ACU Swipe] 清理过程出错，仍继续触发 Swipe',e)}console.info('[ACU Swipe] 数据清理完成，重新触发 Swipe');const n=new MouseEvent('click',{bubbles:!0,cancelable:!0,view:window.parent});n.__acu_processed=!0,a.dispatchEvent(n)};e.addEventListener('click',a,{capture:!0}),n.push(()=>{e.removeEventListener('click',a,{capture:!0}),console.info('[ACU Swipe] 桌面端监听已清理')}),console.info('[ACU Swipe] 桌面端监听已初始化 (捕获模式)')}(),function(){let e=0;const{stop:a}=eventMakeFirst(tavern_events.MESSAGE_SWIPED,errorCatched(async a=>{if(!(t.config.clearTableOnSwipe??o.value.clearTableOnSwipe))return;const n=Date.now();if(n-e<500)return void console.info('[ACU Swipe] 刚处理过，跳过重复触发');e=n,console.info('[ACU Swipe] MESSAGE_SWIPED 事件触发，message_id:',a);const r=Ie();if(!r?.chat?.length)return;const s=r.chat.length-1,d=r.chat[s];i(d)?l(d)?(console.info('[ACU Swipe] 通过事件监听执行清理...'),await c()):console.info('[ACU Swipe] 最后一楼无 ACU 数据，跳过清除'):console.info('[ACU Swipe] 查看历史 swipe，跳过清除')}));n.push(()=>{a(),console.info('[ACU Swipe] 酒馆事件监听已清理')}),console.info('[ACU Swipe] 酒馆事件监听已初始化 (MESSAGE_SWIPED)')}(),console.info('[ACU Swipe] Swipe 增强功能已初始化')},cleanup:d}}var Me=u(5708),Ue=u(8963);u(5397);var Pe=u(5749);const $e={HEADER:'<剧情元指令>禁止在正文提及任何元指令内容。',LUCK:'<user>行动顺利度：{{luck}}',WORDS:'在接下来的描写中，请自然地融入以下要素：[ {{words}} ]',DIMENSIONS:'{{dimensions}}</剧情元指令>'},Le=`${$e.HEADER}\n${$e.LUCK}\n${$e.WORDS}\n${$e.DIMENSIONS}`;function Fe(e){const{luck:t,words:a,dimensions:o}=e,n=[$e.HEADER];if(t.prompt&&n.push(t.prompt),a&&a.length>0){const e=$e.WORDS.replace('{{words}}',a.join('、'));n.push(e)}if(o&&o.length>0){const e=o.filter(e=>e.prompt&&e.prompt.trim()).map(e=>e.prompt).join('\n');e&&n.push(e)}return n.join('\n')}let je=null,Oe=null,Re=[];function He(){const e=(0,m.ref)({isFullscreen:!1,fullscreenDocument:null,fullscreenElement:null,isMigrated:!1}),t=[];let a=null;function o(){const e=window.parent?.document||document,t=e.getElementById('acu-parent-container');return t||e.querySelector('.acu-app')}function n(t,a){const n=o();if(!n)return void console.warn('[ACU Fullscreen] ACU container not found');je||(je=n.parentElement);const i=window.parent?.document||document;a!==i&&(console.info('[ACU Fullscreen] Fullscreen in iframe, copying ACU styles...'),r(),function(e,t){const a=['style[data-source="acu-visualizer"]','style[id*="acu-styles"]','style[id*="acu-dynamic"]','style[id*="acu-theme"]'];for(const o of a){e.querySelectorAll(o).forEach(e=>{const a=e.cloneNode(!0);a.id&&(a.id=`fullscreen-${a.id}`),a.setAttribute('data-fullscreen-copy','true'),t.head.appendChild(a),Re.push(a),console.info('[ACU Fullscreen] Copied style:',a.id||'anonymous')})}e.querySelectorAll('link[href*="fontawesome"], link[href*="font-awesome"]').forEach(e=>{const a=e.cloneNode(!0);a.setAttribute('data-fullscreen-copy','true'),t.head.appendChild(a),Re.push(a)}),console.info(`[ACU Fullscreen] Copied ${Re.length} style elements`)}(i,a)),t.appendChild(n),n.style.position='fixed',n.style.top='0',n.style.left='0',n.style.width='100%',n.style.height='100%',n.style.zIndex='2147483647',n.style.pointerEvents='none';const l=n.querySelector('.acu-app');l&&(l.style.pointerEvents='auto'),e.value.isMigrated=!0,console.info('[ACU Fullscreen] ACU container migrated to fullscreen element'),(0,m.nextTick)(()=>{!function(e){const t=o();if(!t)return;const a=e.getBoundingClientRect(),n=a.height-50-20;t.style.setProperty('--acu-fullscreen-ball-left','20px'),t.style.setProperty('--acu-fullscreen-ball-top',`${n}px`),t.classList.add('acu-fullscreen-mode'),console.info(`[ACU Fullscreen] Adjusted ball position: left=20px, top=${n}px (fullscreen height=${a.height}px)`)}(t)})}function r(){for(const e of Re)try{e.remove()}catch(e){}Re=[]}function i(){const t=o();if(!t||!je)return;!function(){const e=o();e&&(e.classList.remove('acu-fullscreen-mode'),e.style.removeProperty('--acu-fullscreen-ball-left'),e.style.removeProperty('--acu-fullscreen-ball-top'),console.info('[ACU Fullscreen] Restored ball position'))}(),je.appendChild(t),r(),Oe&&(Oe(),Oe=null),t.style.position='',t.style.top='',t.style.left='',t.style.width='',t.style.height='',t.style.zIndex='',t.style.pointerEvents='';const a=t.querySelector('.acu-app');a&&(a.style.pointerEvents=''),e.value.isMigrated=!1,je=null,console.info('[ACU Fullscreen] ACU container restored from fullscreen')}function l(){const{doc:t,element:a}=function(){const e=window.parent?.document||document,t=e.fullscreenElement;if(t)return{doc:e,element:t};const a=e.querySelectorAll('.mes_streaming iframe');for(const e of a){const t=e;try{const e=t.contentDocument;if(e?.fullscreenElement)return{doc:e,element:e.fullscreenElement}}catch(e){console.warn('[ACU Fullscreen] Cannot access iframe:',e)}}return{doc:e,element:null}}();a?(e.value.isFullscreen=!0,e.value.fullscreenDocument=t,e.value.fullscreenElement=a,n(a,t)):(e.value.isFullscreen=!1,e.value.fullscreenDocument=null,e.value.fullscreenElement=null,i())}function c(e){const a=()=>l();e.addEventListener('fullscreenchange',a),t.push({doc:e,handler:a})}function s(){const e=(window.parent?.document||document).querySelectorAll('.mes_streaming iframe');for(const a of e){const e=a;try{const a=e.contentDocument;if(a){t.some(e=>e.doc===a)||(c(a),console.info('[ACU Fullscreen] Added listener to iframe:',e.id||'anonymous')),e.contentWindow.getACUMountPoint=()=>a.body,e.contentWindow.isFullscreen=()=>!!a.fullscreenElement}}catch(e){}}}function d(){const e=window.parent?.document||document;c(e),s(),a=new MutationObserver(e=>{for(const t of e)if('childList'===t.type){Array.from(t.addedNodes).some(e=>e instanceof Element&&(e.matches('.mes_streaming')||e.querySelector('.mes_streaming')))&&setTimeout(s,500)}});const t=e.querySelector('#chat');t&&a.observe(t,{childList:!0,subtree:!0}),console.info('[ACU Fullscreen] Initialized')}function u(){for(const{doc:e,handler:a}of t)try{e.removeEventListener('fullscreenchange',a)}catch(e){}t.length=0,a&&(a.disconnect(),a=null),r(),Oe&&(Oe(),Oe=null),e.value.isMigrated&&i(),console.info('[ACU Fullscreen] Cleaned up')}return(0,m.onMounted)(()=>{d()}),(0,m.onUnmounted)(()=>{u()}),{state:e,init:d,cleanup:u,checkFullscreen:l}}u(4797);var We=u(2867),Ye=u(6744);const Xe=['title'],Ge={class:'ball-emoji'},qe={key:1,class:'acu-issue-badge'},Ke=(0,m.defineComponent)({__name:'FloatingBall',setup(e,{expose:t}){const a=(0,Ye.j_)(),o=(0,Ye.D$)(),n=(0,Ye.MP)(),r=(0,m.computed)(()=>o.hasIntegrityIssues),i=(0,m.computed)(()=>r.value?o.getIntegritySummary():''),l=(0,m.computed)(()=>n.appearance),c=(0,m.computed)(()=>{const e=l.value;return'image'===e.type&&e.content?{backgroundImage:`url('${e.content}')`,backgroundPosition:`${e.imageOffsetX??50}% ${e.imageOffsetY??50}%`,backgroundSize:`${e.imageScale??150}%`,backgroundRepeat:'no-repeat'}:{}}),s=(0,m.ref)(!1),d=(0,m.computed)(()=>a.isAiGenerating);function u(){s.value=!0,console.info('[ACU FloatingBall] AI 填表完成，通知动画持续显示直到点击')}function p(){s.value=!1,console.info('[ACU FloatingBall] 通知动画已清除')}const f=(0,m.computed)(()=>{const e=(d.value||s.value)&&!1!==l.value.enableNotifyAnimation;return{docked:x.value,'has-issues':r.value,'ai-notify':e,'anim-ripple':e&&'ripple'===l.value.notifyAnimation,'anim-arc':e&&'arc'===l.value.notifyAnimation}}),g=(0,m.computed)(()=>{const e=l.value;return{'--ball-size':`${e.size}px`,'--ball-border-color':e.borderColor,'--ball-border-color-rgba':(0,v.j5)(e.borderColor,e.borderOpacity),'--ball-bg-color':(0,v.j5)(e.bgColor,e.bgOpacity),...N.value}});function b(){const e=window.parent&&window.parent!==window?window.parent:window;return{width:e.innerWidth,height:e.innerHeight}}const h=(0,m.ref)(),x=(0,m.ref)(!1);let w=null;const y=function(){const{height:e}=b();return{x:20,y:e-150}}(),{x:k,y:C,style:N,isDragging:V,wasDragging:E}=Ae(h,{initialX:y.x,initialY:y.y,edgePadding:10,elementWidth:(0,m.computed)(()=>l.value.size).value,useParentWindow:!0,onPositionChange:(e,t)=>{console.info('[ACU FloatingBall] 位置已保存:',e,t)}});function B(e){return console.log('[ACU FloatingBall] handleClick, wasDragging:',E.value,'isDragging:',V.value),E.value?(E.value=!1,e.stopPropagation(),void console.log('[ACU FloatingBall] 忽略拖拽后的点击')):(s.value&&p(),x.value?(x.value=!1,void e.stopPropagation()):void(w?(clearTimeout(w),w=null,x.value=!0,console.info('[ACU FloatingBall] 双击 - 进入停靠模式')):w=setTimeout(()=>{w=null,a.openPanel(),console.info('[ACU FloatingBall] 单击 - 打开面板')},250)))}return function(e,t,a){const o=window.parent&&window.parent!==window?window.parent:window;(0,Be.MLh)(o,e,t,a)}('resize',()=>{const{width:e,height:t}=b(),a=l.value.size,o=10;let n=!1;k.value>e-a-o&&(k.value=e-a-o,n=!0),C.value>t-a-o&&(C.value=t-a-o,n=!0),k.value<o&&(k.value=o,n=!0),C.value<o&&(C.value=o,n=!0),n&&console.info('[ACU FloatingBall] 窗口大小变化，位置已调整')}),(0,m.onMounted)(()=>{}),(0,m.watch)(()=>a.aiNotifySignal,()=>{console.info('[ACU FloatingBall] 收到 AI 通知信号，触发动画'),u()}),(0,m.onUnmounted)(()=>{w&&clearTimeout(w)}),t({resetPosition:()=>{const e=(window.parent?.innerHeight??window.innerHeight)-150;k.value=20,C.value=e},setDocked:e=>{x.value=e},triggerAiNotify:u,clearAiNotify:p,getAppearance:()=>l.value}),(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{ref_key:'ballRef',ref:h,class:(0,m.normalizeClass)(['acu-floating-ball-vue',f.value]),style:(0,m.normalizeStyle)(g.value),title:r.value?i.value:'点击打开面板',onClick:B},[(0,m.createCommentVNode)(' 图标内容 - 根据类型动态渲染 '),x.value?(0,m.createCommentVNode)('v-if',!0):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[(0,m.createCommentVNode)(' FontAwesome 图标 '),'icon'===l.value.type?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(['fa-solid',l.value.content])},null,2)):'emoji'===l.value.type?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' Emoji '),(0,m.createElementVNode)('span',Ge,(0,m.toDisplayString)(l.value.content),1)],2112)):'image'===l.value.type&&l.value.content?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:2},[(0,m.createCommentVNode)(' 图片 - 使用 div + background-image 支持裁剪参数 '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['ball-image',{'ball-image-invert':l.value.imageInvert}]),style:(0,m.normalizeStyle)(c.value)},null,6)],2112)):(0,m.createCommentVNode)('v-if',!0)],64)),(0,m.createCommentVNode)(' 问题徽章 '),r.value&&!x.value?((0,m.openBlock)(),(0,m.createElementBlock)('span',qe,'!')):(0,m.createCommentVNode)('v-if',!0)],14,Xe))}}),Je={class:'popup-buttons-grid'},Ze=['title','onClick'],Qe=(0,m.defineComponent)({__name:'HiddenButtonsPopup',props:{visible:{type:Boolean},buttons:{},isPinned:{type:Boolean,default:!1}},emits:['close','button-click'],setup(e,{emit:t}){const a=e,o=t,n=e=>{const t=[];return'purge'===e&&t.push('btn-danger'),'pin'===e&&(t.push('btn-toggle'),a.isPinned&&t.push('active')),t};return(t,a)=>((0,m.openBlock)(),(0,m.createBlock)(m.Transition,{name:'hidden-popup'},{default:(0,m.withCtx)(()=>[e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-hidden-buttons-popup',onClick:a[0]||(a[0]=(0,m.withModifiers)(()=>{},['stop']))},[(0,m.createElementVNode)('div',Je,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.buttons,e=>((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:e.id,class:(0,m.normalizeClass)(['popup-button',n(e.id)]),title:e.label,onClick:(0,m.withModifiers)(t=>{return a=e.id,o('button-click',a),void o('close');var a},['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fa-solid',e.icon])},null,2)],10,Ze))),128))])])):(0,m.createCommentVNode)('v-if',!0)]),_:1}))}});u(7261);var et=u(1667);const tt=(0,et.A)(Qe,[['__scopeId','data-v-5d2fcd0e']]),at={class:'acu-panel-content'},ot={class:'acu-nav-actions-area'},nt=['title','onClick','onMousedown','onTouchstartPassive'],rt={key:0,class:'secondary-indicator'},it=['title','onClick'],lt={key:0,class:'acu-action-btn-wrapper'},ct='acu_win_config',st=(0,m.defineComponent)({__name:'MainPanel',props:{title:{default:'ACU 可视化表格'},theme:{default:'retro'},layout:{default:'vertical'},isCollapsed:{type:Boolean,default:!1},isPinned:{type:Boolean,default:!1},isContentHidden:{type:Boolean,default:!1},lockPanel:{type:Boolean,default:!1},hasChanges:{type:Boolean,default:!1},panelType:{default:'normal'}},emits:['refresh','save','save-as','undo','manual-update','purge','settings','open-native','toggle-pin','toggle','close','hide-content','height-change','width-change','collapse-tab'],setup(e,{expose:t,emit:a}){const o=e,n=a,r=(0,Ye.j_)(),i=((0,Me.t)(),(0,Ye.JH)()),l=['save','refresh','settings','pin','toggle'],c=(0,m.computed)(()=>{const e=i.buttonsConfig;let t=e.buttonOrder||Ye.mu.map(e=>e.id);const a=e.visibleButtons?.length>0?[...e.visibleButtons]:[...l];if(i.config.collapseTabBar&&!1!==i.config.showCollapseTabButton){if(a.includes('collapseTab')||a.push('collapseTab'),!t.includes('collapseTab')){const e=t.indexOf('settings');t=e>=0?[...t.slice(0,e),'collapseTab',...t.slice(e)]:[...t,'collapseTab']}}else{const e=a.indexOf('collapseTab');e>-1&&a.splice(e,1)}return console.info('[ACU MainPanel] 计算可见按钮:',{order:t,visibleIds:a,buttonsConfigVisible:e.visibleButtons,collapseTabBar:i.config.collapseTabBar,showCollapseTabButton:i.config.showCollapseTabButton}),t.map(e=>Ye.mu.find(t=>t.id===e)).filter(e=>!!e&&a.includes(e.id))}),s=(0,m.computed)(()=>i.hiddenButtons),d=(0,m.computed)(()=>i.hasHiddenButtons),u=(0,m.ref)(!1),p=()=>{u.value=!u.value},f=e=>{u.value=!1,B(e)},g=(0,m.ref)(!1),v=e=>{const t=[];return'purge'===e&&t.push('acu-btn-danger'),'pin'===e&&(t.push('acu-btn-toggle'),o.isPinned&&t.push('active')),'save'===e&&o.hasChanges&&t.push('has-changes'),'refresh'===e&&g.value&&t.push('refreshing'),t},b=e=>{const t={};return'purge'===e&&(t.color='#e74c3c'),'pin'===e&&o.isPinned&&(t.color='var(--acu-title-color)',t.borderColor='var(--acu-title-color)',t.background='var(--acu-btn-hover)'),t};let h=null;const x=(0,m.ref)(!1),w=(0,m.ref)(null),y=e=>i.getSecondaryButtonId(e),k=e=>{const t=Ye.mu.find(t=>t.id===e);return t?.icon||'fa-circle'},C=e=>{const t=Ye.mu.find(t=>t.id===e);return t?.label||e},N=e=>{const t=C(e),a=y(e);if(a){return`${t} (长按: ${C(a)})`}return t},V=e=>{const t=y(e);console.log('[ACU MainPanel] startLongPress:',e,'secondaryId:',t,'groups:',i.buttonGroups),t?(x.value=!1,h=setTimeout(()=>{x.value=!0,console.log('[ACU MainPanel] Long press triggered for:',e,'directExec:',i.longPressDirectExec),i.longPressDirectExec?(console.log('[ACU MainPanel] Direct exec:',t),B(t)):(console.log('[ACU MainPanel] Popup button:',t),w.value=e,setTimeout(()=>{w.value===e&&(w.value=null)},3e3))},600)):console.log('[ACU MainPanel] No secondary button for:',e)},E=()=>{h&&(clearTimeout(h),h=null)},B=e=>{switch(e){case'save':n('save');break;case'saveAs':n('save-as');break;case'undo':n('undo');break;case'refresh':n('refresh');break;case'manualUpdate':n('manual-update');break;case'purge':n('purge');break;case'pin':n('toggle-pin');break;case'toggle':n('toggle');break;case'director':r.directorDialog=!0;break;case'settings':n('settings');break;case'openNative':n('open-native');break;case'collapseTab':n('collapse-tab');break;default:console.warn(`[MainPanel] 未知的动作 ID: ${e}`)}},T=(0,m.ref)(),S=(0,m.ref)(),D=(0,m.ref)(),A=(0,m.ref)(),I={width:400,left:'50%',bottom:'50%',isCentered:!0};let M=null,U=!1;try{const e=localStorage.getItem(ct);M=e?JSON.parse(e):null}catch(e){M=null}M?!M.isCentered&&'number'==typeof M.bottom&&M.bottom<100&&(U=!0,console.warn('[ACU MainPanel] 检测到无效位置配置 (bottom='+M.bottom+')，重置为居中')):(U=!0,console.info('[ACU MainPanel] 首次加载，设置默认居中配置')),U&&(localStorage.setItem(ct,JSON.stringify(I)),localStorage.removeItem('acu_active_tab'),console.info('[ACU MainPanel] 居中模式：清除 activeTab，只显示导航栏'));const P=(0,Be.rXt)(ct,I);function L(){return function(){const e='ontouchstart'in window||navigator.maxTouchPoints>0,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),a=window.innerWidth<768;return e&&(t||a)}()?i.config.mobileSafeAreaBottom??50:0}function F(){const e=P.value,{width:t,height:a}={width:window.parent?.innerWidth??window.innerWidth,height:window.parent?.innerHeight??window.innerHeight};if(console.info('[ACU MainPanel] 验证面板位置:',JSON.stringify(e),'parentHeight:',a),!e||void 0===e.left||void 0===e.bottom)return console.warn('[ACU MainPanel] 配置不完整，重置为居中模式'),void(P.value={width:e?.width||400,left:'50%',bottom:'50%',isCentered:!0});if(e.isCentered)return void('50%'===e.left&&'50%'===e.bottom||(console.warn('[ACU MainPanel] 居中模式下位置异常，修正为 50%'),P.value={...e,left:'50%',bottom:'50%'}));let o=!1,n=!1,r=e.left;const i=e.bottom,l=L(),c=Math.max(l,50);if('number'==typeof e.bottom?e.bottom<c?(console.warn(`[ACU MainPanel] 底部位置异常 (${e.bottom}px < ${c}px)，重置为居中模式`),n=!0):e.bottom>a-50&&(console.warn(`[ACU MainPanel] 顶部位置异常 (${e.bottom}px > ${a-50}px)，重置为居中模式`),n=!0):'50%'!==e.bottom&&(console.warn('[ACU MainPanel] 非居中模式下 bottom 格式无效，重置为居中模式'),n=!0),'number'==typeof e.left){const a=t-50;e.left<-200?(r=-200,o=!0):e.left>a&&(r=Math.max(0,a),o=!0)}else'50%'!==e.left&&(console.warn('[ACU MainPanel] 非居中模式下 left 格式无效，重置为居中模式'),n=!0);if(n)return P.value={width:e.width||400,left:'50%',bottom:'50%',isCentered:!0},void console.info('[ACU MainPanel] 面板已重置为居中模式');o&&(console.info('[ACU MainPanel] 面板位置越界，已自动修正'),P.value={...e,left:r,bottom:i})}function j(e){if(o.lockPanel)return;if(e.target.closest('.acu-resize-handle, .acu-slider, input'))return;if(0!==e.button)return;const t=D.value;if(!t||!T.value)return;const a=e.clientX,n=e.clientY,r=T.value.getBoundingClientRect(),i=r.left,l=window.parent?.innerHeight??window.innerHeight,c=l-r.bottom;let s=!1,d=!1;const u=e=>{const t=e.originalEvent,o=t.clientX-a,r=t.clientY-n;if(!s&&(Math.abs(o)>5||Math.abs(r)>5)&&(s=!0,d=!0,P.value.isCentered=!1),s){e.preventDefault();let t=i+o,a=c-r;const n=window.parent?.innerWidth??window.innerWidth,s=L(),d=n-50,u=l-50;t<-200&&(t=-200),t>d&&(t=d),a<s&&(a=s),a>u&&(a=u),P.value.left=t,P.value.bottom=a}},p=()=>{if($('body').off('pointermove',u),$('body').off('pointerup',p),d){const e=a=>{a.stopPropagation(),a.preventDefault(),t.removeEventListener('click',e,!0)};t.addEventListener('click',e,!0),console.info('[ACU MainPanel] 面板位置已更新')}};$('body').on('pointermove',u),$('body').on('pointerup',p)}(0,m.watchEffect)(()=>{if(!T.value)return;let e=P.value;e||(e={width:400,left:'50%',bottom:'50%',isCentered:!0});const t=T.value;if(e.width&&t.style.setProperty('--acu-win-width',`${e.width}px`),void 0!==e.left){const a='number'==typeof e.left?`${e.left}px`:e.left;t.style.setProperty('--acu-win-left',a)}if(void 0!==e.bottom){const a='number'==typeof e.bottom?`${e.bottom}px`:e.bottom;t.style.setProperty('--acu-win-bottom',a)}e.isCentered?(t.style.setProperty('--acu-win-left','50%'),t.style.removeProperty('--acu-win-bottom'),t.style.transform='translate(-50%, -50%)'):t.style.transform='none'});const O=(0,m.ref)(),R=(0,m.ref)(!1),H=(0,m.ref)(0),W=(0,m.computed)(()=>o.panelType),Y=(0,m.computed)(()=>i.config.showPagination);(0,m.onMounted)(()=>{F();const e=D.value;e&&(e.addEventListener('pointerdown',j),console.info('[ACU MainPanel] 导航栏拖拽事件已绑定'));const t=A.value;t&&(t.addEventListener('pointerdown',q),console.info('[ACU MainPanel] 宽度调节事件已绑定'))}),(0,m.onUnmounted)(()=>{const e=D.value;e&&e.removeEventListener('pointerdown',j);const t=A.value;t&&t.removeEventListener('pointerdown',q)}),(0,Be.MLh)(window.parent??window,'resize',()=>{F()});const{height:X,recalculate:G}=function(e,t,a,o={}){const{minHeight:n=200,maxHeightRatio:r=.8,headerHeight:i=42,paginationHeight:l=56,contentPadding:c=25,onHeightChange:s}=o,d=(0,m.ref)(n),u=()=>window.parent&&window.parent!==window?window.parent.innerHeight:window.innerHeight,p=()=>u()*r,f=()=>'string'==typeof t?t:t.value,g=()=>'boolean'==typeof a?a:a.value;(0,Be.wYm)(e,e=>{const t=e[0];if(!t)return;if('dashboard'===f()){const e=p();return console.info('[ACU useSmartHeight] 仪表盘高度计算:',{maxH:e,parentHeight:u(),ratio:r}),d.value=e,void s?.(e)}const a=t.contentRect.height,o=g()?l:0,m=i+a+c+o,v=p(),b=Math.max(n,Math.min(m,v));d.value=b,s?.(b)}),'string'!=typeof t&&(0,m.watch)(t,e=>{if('dashboard'===e){const e=p();console.info('[ACU useSmartHeight] 切换到仪表盘，设置高度:',e),d.value=e,s?.(e)}}),'boolean'!=typeof a&&(0,m.watch)(a,()=>{if(e.value){const t=e.value.scrollHeight;if('dashboard'!==f()){const e=g()?l:0,a=i+t+c+e,o=p(),r=Math.max(n,Math.min(a,o));d.value=r,s?.(r)}}});const v=(0,m.computed)(()=>({height:`${d.value}px`,maxHeight:`${p()}px`}));return{height:d,heightStyle:v,maxHeight:(0,m.computed)(()=>p()),reset:()=>{d.value=n,s?.(n)},maximize:()=>{const e=p();d.value=e,s?.(e)},recalculate:()=>{if(e.value)if('dashboard'===f()){const e=p();d.value=e,s?.(e)}else{const t=e.value.scrollHeight,a=g()?l:0,o=i+t+c+a,r=p(),u=Math.max(n,Math.min(o,r));d.value=u,s?.(u)}}}}(O,W,Y,{minHeight:200,maxHeightRatio:.8,headerHeight:42,paginationHeight:56,contentPadding:25,onHeightChange:e=>{!R.value&&S.value&&(H.value=e,n('height-change',e))}});function q(e){if(0!==e.button)return;e.preventDefault(),e.stopPropagation();if(!A.value||!T.value)return;const t=e.clientX,a=T.value.getBoundingClientRect().width,o=e=>{const o=e.originalEvent.clientX-t;let r=a+o;const i=(window.parent?.innerWidth??window.innerWidth)-10;r<300&&(r=300),r>i&&(r=i),P.value.width=r,n('width-change',r)},r=()=>{$('body').off('pointermove',o),$('body').off('pointerup',r),console.info('[ACU MainPanel] 宽度已更新:',P.value.width)};$('body').on('pointermove',o),$('body').on('pointerup',r)}return t({getPanelElement:()=>T.value,getDataAreaElement:()=>S.value,getCurrentHeight:()=>H.value,resetPosition:()=>{P.value={width:400,left:'50%',bottom:'50%',isCentered:!0}},exitCenteredMode:()=>{if(!P.value.isCentered)return;const e=window.parent?.innerWidth??window.innerWidth;P.value={...P.value,isCentered:!1,bottom:'number'==typeof P.value.bottom&&P.value.bottom>=50?P.value.bottom:100,left:'number'==typeof P.value.left?P.value.left:e/2-200},console.info('[ACU MainPanel] 退出居中模式，切换到底部定位')},resetHeight:()=>{S.value&&(R.value=!1,S.value.style.height='',S.value.style.minHeight='',S.value.style.maxHeight='',setTimeout(()=>{requestAnimationFrame(()=>{if(!S.value)return;const e=window.parent?.innerHeight??window.innerHeight,t=D.value,a=e-(t?t.offsetHeight:0)-20,o=S.value.querySelector('.acu-relationship-graph');if(o){const e=a;return S.value.style.height=`${e}px`,H.value=e,console.info(`[ACU] 关系图高度重置: 强制最大高度 ${e}`),void n('height-change',e)}const r='horizontal'===i.config.layout;let l;if(r){const e=S.value.querySelector('.acu-cards-container');if(e){const t=e.querySelectorAll('.acu-data-card');let a=0;t.forEach(e=>{const t=e.scrollHeight;t>a&&(a=t)});const o=S.value.querySelector('.acu-table-toolbar'),n=S.value.querySelector('.acu-pagination-container'),r=o?o.offsetHeight:0,i=n?n.offsetHeight:0,c=window.getComputedStyle(e),s=parseFloat(c.paddingTop)+parseFloat(c.paddingBottom);l=a+r+i+s,console.info(`[ACU] 横向布局高度计算: maxCard=${a}, toolbar=${r}, pagination=${i}, padding=${s}`)}else l=S.value.scrollHeight}else{const e=S.value.querySelector('.acu-panel-content');if(e){const t=e.firstElementChild;l=t?t.offsetHeight+20:e.scrollHeight}else l=S.value.scrollHeight}const c=Math.min(a,Math.max(200,l)),s=r&&S.value.querySelector('.acu-cards-container');if(o||s)S.value.style.height=`${c}px`,H.value=c,console.info(`[ACU] 高度已重置(Fixed): natural=${l}, max=${a}, final=${c}, horizontal=${r}`),n('height-change',c);else{S.value.style.height='';const e=S.value.offsetHeight;H.value=e,console.info(`[ACU] 高度已重置(Auto): actual=${e}, horizontal=${r}`),n('height-change',e)}})},50))},recalculateHeight:G}),(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{ref_key:'panelRef',ref:T,class:(0,m.normalizeClass)(['acu-wrapper',[`acu-theme-${e.theme}`,`acu-layout-${e.layout}`,{collapsed:e.isCollapsed,pinned:e.isPinned,'acu-centered-mode':(0,m.unref)(P).isCentered}]])},[(0,m.createCommentVNode)(' 1. 数据显示区（放在最前面） '),(0,m.createElementVNode)('div',{ref_key:'dataAreaRef',ref:S,class:(0,m.normalizeClass)(['acu-data-display',{visible:!e.isContentHidden,'acu-layout-horizontal':'horizontal'===e.layout,'acu-layout-vertical':'vertical'===e.layout}])},[(0,m.createCommentVNode)(' 内容区 '),(0,m.createElementVNode)('div',at,[(0,m.renderSlot)(t.$slots,'default')])],2),(0,m.createCommentVNode)(' 2. 宽度调节把手 '),(0,m.createCommentVNode)(' 注意：事件绑定在 onMounted 中手动进行，避免跨 iframe 生产构建事件绑定失效 '),e.lockPanel?(0,m.createCommentVNode)('v-if',!0):((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,ref_key:'resizeHandleRef',ref:A,class:'acu-resize-handle'},null,512)),(0,m.createCommentVNode)(' 3. 导航容器（放在最后，显示在底部） '),(0,m.createCommentVNode)(' 注意：拖拽事件绑定在 onMounted 中手动进行 '),(0,m.createElementVNode)('div',{ref_key:'navContainerRef',ref:D,class:(0,m.normalizeClass)(['acu-nav-container',{'acu-locked':e.lockPanel}])},[(0,m.createCommentVNode)(' Tab 区域 (由 slot 提供，TabBar 自带 .acu-nav-tabs-area) '),(0,m.renderSlot)(t.$slots,'tabs'),(0,m.createCommentVNode)(' 分隔线 '),a[2]||(a[2]=(0,m.createElementVNode)('div',{class:'acu-nav-separator'},null,-1)),(0,m.createCommentVNode)(' 动作按钮区（横排） '),(0,m.createElementVNode)('div',ot,[(0,m.createCommentVNode)(' 常规按钮（始终显示） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(c.value,e=>{return(0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:'acu-action-btn-wrapper'},[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-action-btn',v(e.id)]),title:N(e.id),style:(0,m.normalizeStyle)(b(e.id)),onClick:(0,m.withModifiers)(t=>{return a=e.id,void(x.value?x.value=!1:('refresh'===a&&(g.value=!0,setTimeout(()=>{g.value=!1},1e3)),B(a)));var a},['stop']),onMousedown:(0,m.withModifiers)(t=>V(e.id),['stop']),onMouseup:(0,m.withModifiers)(E,['stop']),onMouseleave:E,onTouchstartPassive:(0,m.withModifiers)(t=>V(e.id),['stop']),onTouchend:(0,m.withModifiers)(E,['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fa-solid',e.icon])},null,2),(0,m.createCommentVNode)(' 附属按钮指示点 '),(t=e.id,null!==y(t)?((0,m.openBlock)(),(0,m.createElementBlock)('span',rt)):(0,m.createCommentVNode)('v-if',!0))],46,nt),(0,m.createCommentVNode)(' 长按弹出的附属按钮 '),(0,m.createVNode)(m.Transition,{name:'popup'},{default:(0,m.withCtx)(()=>[w.value===e.id&&y(e.id)?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-action-btn acu-popup-btn',title:C(y(e.id)),onClick:(0,m.withModifiers)(t=>(e=>{const t=y(e);t&&B(t),w.value=null})(e.id),['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fa-solid',k(y(e.id))])},null,2)],8,it)):(0,m.createCommentVNode)('v-if',!0)]),_:2},1024)]);var t}),128)),(0,m.createCommentVNode)(' 更多按钮（仅当有隐藏按钮时显示） '),d.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',lt,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-action-btn acu-more-btn',{active:u.value}]),title:'更多按钮',onClick:(0,m.withModifiers)(p,['stop'])},[...a[1]||(a[1]=[(0,m.createElementVNode)('i',{class:'fa-solid fa-chevron-up'},null,-1)])],2)])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 隐藏按钮浮窗（放在 actions-area 内，贴着 action 按钮显示） '),(0,m.createVNode)(tt,{visible:u.value,buttons:s.value,'is-pinned':e.isPinned,onClose:a[0]||(a[0]=e=>u.value=!1),onButtonClick:f},null,8,['visible','buttons','is-pinned']),(0,m.createCommentVNode)(' Tab浮窗（放在 actions-area 内，贴着 action 按钮显示） '),(0,m.renderSlot)(t.$slots,'tabs-popup')])],2)],2))}}),dt={class:'acu-tab-bar'},ut=['title','draggable','onClick','onDragstart','onDragover','onDrop'],pt=(0,m.defineComponent)({__name:'TabBar',props:{tabs:{},activeTab:{},showDashboard:{type:Boolean,default:!0},hasOptionsTabs:{type:Boolean,default:!1},hasRelationshipGraph:{type:Boolean,default:!1},isEditingOrder:{type:Boolean,default:!1},gridColumns:{default:'repeat(auto-fill, minmax(90px, 1fr))'}},emits:['tab-change','order-change','exit-editing'],setup(e,{expose:t,emit:a}){const o=e,n=a,r=(0,k.j_)(),i=(0,y.D)(),l=(0,m.ref)([]);function c(e){return e===k.H6||e===k.$9||e===k.SC}const s=(0,m.computed)(()=>{const e=r.visibleTabs;if(!e||0===e.length){const e=[];return o.showDashboard&&e.push({id:k.H6,name:'仪表盘',icon:'fas fa-home'}),e.push(...l.value),o.hasRelationshipGraph&&e.push({id:k.SC,name:'关系图',icon:'fas fa-project-diagram'}),o.hasOptionsTabs&&e.push({id:k.$9,name:'选项',icon:'fas fa-sliders-h'}),e}return e.map(e=>{return(t=e)===k.H6?{id:k.H6,name:'仪表盘',icon:'fas fa-home'}:t===k.SC?{id:k.SC,name:'关系图',icon:'fas fa-project-diagram'}:t===k.$9?{id:k.$9,name:'选项',icon:'fas fa-sliders-h'}:l.value.find(e=>e.name===t);var t}).filter(e=>!!e&&(!(e.id===k.H6&&!o.showDashboard)&&(!(e.id===k.SC&&!o.hasRelationshipGraph)&&!(e.id===k.$9&&!o.hasOptionsTabs))))});function d(e){return i.hasTableIssues(e)}function u(e){if(d(e.name)){return`⚠️ 发现 ${i.getTableIssues(e.name).length} 个问题`}return e.name}let p=null,f=null;(0,m.watch)(()=>o.tabs,e=>{l.value=[...e]},{immediate:!0,deep:!0});const g=()=>{n('exit-editing')},v=e=>{e.target.classList.remove('dragging'),p=null,f=null};return t({getCurrentOrder:()=>l.value.map(e=>e.id),getVisibleTabs:()=>s.value.map(e=>e.id)}),(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',dt,[(0,m.createCommentVNode)(' 排序提示 '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-order-controls',{visible:e.isEditingOrder}])},[(0,m.createElementVNode)('span',null,[a[1]||(a[1]=(0,m.createElementVNode)('i',{class:'fas fa-info-circle'},null,-1)),a[2]||(a[2]=(0,m.createTextVNode)(' 拖拽调整顺序，完成后点击 ',-1)),(0,m.createElementVNode)('button',{class:'acu-order-done-btn',onClick:g},[...a[0]||(a[0]=[(0,m.createElementVNode)('i',{class:'fas fa-check'},null,-1),(0,m.createTextVNode)(' 完成',-1)])])])],2),(0,m.createCommentVNode)(' Tab 网格区域 '),(0,m.createElementVNode)('div',{class:'acu-nav-tabs-area',style:(0,m.normalizeStyle)({'--acu-nav-cols':e.gridColumns})},[(0,m.createCommentVNode)(' 统一 Tab 列表（包含仪表盘、普通表格、选项面板） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(s.value,t=>{return(0,m.openBlock)(),(0,m.createElementBlock)('button',{key:t.id,class:(0,m.normalizeClass)(['acu-nav-btn',{active:e.activeTab===t.id,'drag-handle':e.isEditingOrder,'has-issues':!c(t.id)&&d(t.name),'has-ai-changes':!c(t.id)&&!d(t.name)&&(a=t.name,i.hasTableAiChanges(a))}]),title:u(t),draggable:e.isEditingOrder,onClick:(0,m.withModifiers)(e=>{return a=t.id,void(o.isEditingOrder||n('tab-change',a));var a},['stop']),onDragstart:e=>((e,t)=>{o.isEditingOrder?(p=t,e.dataTransfer&&(e.dataTransfer.effectAllowed='move',e.dataTransfer.setData('text/plain',t.id)),e.target.classList.add('dragging')):e.preventDefault()})(e,t),onDragover:(0,m.withModifiers)(e=>((e,t)=>{o.isEditingOrder&&p&&(e.preventDefault(),f=t)})(e,t),['prevent']),onDrop:e=>((e,t)=>{if(!o.isEditingOrder||!p)return;e.preventDefault();const a=l.value.findIndex(e=>e.id===p.id),r=l.value.findIndex(e=>e.id===t.id);if(-1!==a&&-1!==r&&a!==r){const[e]=l.value.splice(a,1);l.value.splice(r,0,e),n('order-change',l.value.map(e=>e.id))}p=null,f=null})(e,t),onDragend:v},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(t.icon||(0,m.unref)(k.Sj)(t.name))},null,2),(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(t.name),1)],42,ut);var a}),128))],4)]))}}),mt=(0,m.defineComponent)({__name:'Badge',props:{value:{},type:{default:'default'}},setup(e){const t=e,a=(0,m.computed)(()=>{if('default'!==t.type)return t.type;const e=String(t.value);return/Lv\.?\s*\d+/i.test(e)?'level':/\d+(\.\d+)?%/.test(e)?'percent':'男'===e?'male':'女'===e?'female':/^[+-]?\d+(\.\d+)?$/.test(e.trim())?'number':'default'}),o=(0,m.computed)(()=>{const e=a.value;return['primary','secondary','outline','outline-primary'].includes(e),`acu-badge-${e}`}),n=(0,m.computed)(()=>{const e=t.value;return null==e||''===e?'-':String(e)});return(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{class:(0,m.normalizeClass)(['acu-badge',o.value])},(0,m.toDisplayString)(n.value),3))}}),ft=(0,m.defineComponent)({__name:'InlineEditor',props:{value:{},minHeight:{default:24}},emits:['save','cancel'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.ref)(),r=(0,m.ref)(String(a.value)),i=(0,m.ref)(!1),l=(0,m.ref)(!1),c=()=>{const e=window.getSelection();l.value=null!==e&&e.toString().length>0},s=()=>{const e=n.value;if(!e)return;const t=e.offsetHeight,o=e.style.visibility;e.style.visibility='hidden',e.style.height='0px';const r=e.scrollHeight,i=Math.max(r,a.minHeight);e.style.visibility=o,e.style.height=i===t&&t>0?`${t}px`:`${i}px`};(0,m.watch)(r,()=>{(0,m.nextTick)(s)});const d=()=>{if(i.value)return;i.value=!0;const e=String(a.value);r.value!==e?o('save',r.value):o('cancel')},u=e=>{'Escape'===e.key?(e.preventDefault(),e.stopPropagation(),i.value=!0,o('cancel')):'Enter'!==e.key||e.shiftKey||(e.preventDefault(),e.stopPropagation(),d())},p=e=>{e.stopPropagation()},f=e=>{c(),l.value,e.stopPropagation()};return(0,m.onMounted)(()=>{(0,m.nextTick)(()=>{const e=n.value;if(!e)return;const t=e.scrollHeight,o=Math.max(t,a.minHeight);e.style.height=`${o}px`,e.focus();const r=e.value.length;e.setSelectionRange(r,r)}),document.addEventListener('selectionchange',c)}),(0,m.onBeforeUnmount)(()=>{document.removeEventListener('selectionchange',c)}),(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{class:'acu-inline-editor',onClick:t[5]||(t[5]=(0,m.withModifiers)(()=>{},['stop'])),onMousedown:t[6]||(t[6]=(0,m.withModifiers)(()=>{},['stop'])),onPointerdown:t[7]||(t[7]=(0,m.withModifiers)(()=>{},['stop']))},[(0,m.withDirectives)((0,m.createElementVNode)('textarea',{ref_key:'textareaRef',ref:n,'onUpdate:modelValue':t[0]||(t[0]=e=>r.value=e),class:'acu-edit-textarea',onBlur:d,onKeydown:u,onClick:t[1]||(t[1]=(0,m.withModifiers)(()=>{},['stop'])),onMousedown:t[2]||(t[2]=(0,m.withModifiers)(()=>{},['stop'])),onPointerdown:t[3]||(t[3]=(0,m.withModifiers)(()=>{},['stop'])),onTouchstart:p,onTouchmove:f,onTouchend:t[4]||(t[4]=(0,m.withModifiers)(()=>{},['stop']))},null,544),[[m.vModelText,r.value]])],32))}}),gt={key:0,class:'acu-card-header'},vt={key:0,class:'acu-card-index'},bt={key:0,class:'fas fa-lock acu-title-lock-icon'},ht={key:4,class:'acu-history-btns'},xt=['disabled'],wt={class:'acu-card-main-grid'},yt=['onClick'],kt={class:'acu-grid-label'},Ct={class:'acu-grid-value'},Nt={key:0,class:'fas fa-lock acu-lock-icon'},Vt={key:0,class:'acu-card-full-area'},Et=['onClick'],Bt={class:'acu-full-label'},Tt={class:'acu-full-value'},St={key:1},Dt={key:0,class:'fas fa-lock acu-lock-icon'},At={class:'acu-card-body'},zt=['onClick'],It={class:'acu-card-label'},_t={class:'acu-card-value'},Mt={key:0,class:'fas fa-lock acu-lock-icon'},Ut={class:'acu-pull-icon'},Pt={class:'acu-pull-text'},$t={key:3,class:'acu-stamp-delete'},Lt=(0,m.defineComponent)({__name:'DataCard',props:{data:{},tableId:{},tableName:{},isChanged:{type:Boolean,default:!1},layout:{default:'vertical'},viewMode:{default:'card'},showIndex:{type:Boolean,default:!0},showHeader:{type:Boolean,default:!0},titleColIndex:{default:1},showHistoryButton:{type:Boolean,default:!0},customHighlights:{default:void 0},allowEdit:{type:Boolean,default:!0}},emits:['cellClick','insertRow','toggleDelete','contextMenu','showHistory'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.ref)(),r=(0,m.ref)(null),i=(0,m.ref)(!1),l=(0,y.D)(),c=(0,k.j_)(),s=(0,Me.t)(),d=(0,B.m)(),u=(0,m.ref)(),p=(0,m.ref)(),f=(0,m.ref)(),g=(0,m.ref)(),{isMobile:v}=De(),b=(0,m.ref)(!1),h=(0,m.ref)(null),x=(0,m.computed)(()=>`${a.tableName}-row-${a.data.index}`),w=(0,m.computed)(()=>l.pendingDeletes.has(x.value)),C=(0,m.computed)(()=>a.titleColIndex>=0&&a.data.cells.length>a.titleColIndex?a.data.cells[a.titleColIndex]:null),N=(0,m.computed)(()=>{let e=a.data.cells.filter((_,e)=>e>0);return a.showHeader&&C.value&&a.titleColIndex>0&&(e=e.filter((_,e)=>e+1!==a.titleColIndex)),e}),V=e=>{const t=String(e.value),a=e.key.toLowerCase();return t.length>50||a.includes('描述')||a.includes('说明')||a.includes('备注')||a.includes('内容')||a.includes('detail')||a.includes('description')},E=(0,m.computed)(()=>N.value.filter(e=>!V(e))),T=(0,m.computed)(()=>N.value.filter(e=>V(e))),S=(0,m.computed)(()=>{const e=a.data.cells.map(e=>e.key),t=a.data.cells.map(e=>String(e.value??''));return s.getRowKey(a.tableName,t,e,a.data.index)}),D=(0,m.computed)(()=>{if(!c.isLockEditMode)return!1;const e=S.value;return!!e&&s.isRowLockedPending(a.tableName,e)}),A=(0,m.computed)(()=>{if(!c.isLockEditMode||!C.value)return!1;const e=S.value;return!!e&&s.isCellLockedPending(a.tableName,e,C.value.key)});function I(e){if(a.customHighlights?.has(e))return{'acu-cell-changed':!0,'acu-cell-changed-manual':!0};const t=`${a.tableName}-${a.data.index}-${e}`,o=l.getCellChangeType(t);return{'acu-cell-changed':null!==o,'acu-cell-changed-manual':'manual'===o,'acu-cell-changed-ai':'ai'===o}}const M=(0,m.computed)(()=>{const e=l.getRowChangeType(a.tableName,a.data.index,a.data.cells.length);return'manual'===e?'acu-highlight-changed acu-highlight-manual':'ai'===e?'acu-highlight-changed acu-highlight-ai':''}),{isSelecting:U,shouldBlockInteraction:P,wasSelecting:L}=function(){const{text:e}=(0,Be.fOm)(),t=(0,m.computed)(()=>e.value.length>0),a=(0,m.ref)(!1),o=(0,m.ref)(null);return(0,m.watch)(t,e=>{!e&&a.value?o.value=setTimeout(()=>{a.value=!1},100):e&&(a.value=!0,o.value&&(clearTimeout(o.value),o.value=null))}),{selectedText:e,isSelecting:t,wasSelecting:(0,m.computed)(()=>a.value),shouldBlockInteraction:()=>t.value||a.value,clearSelection:()=>{const e=window.getSelection();e&&e.removeAllRanges()}}}(),{isSwiping:F,gestureType:j,atStart:R,atEnd:H,checkScrollEdge:W,lengthX:Y,lengthY:X}=function(e,t){const{layout:a,onInsertRow:o,onToggleDelete:n,horizontalThreshold:r=50,verticalThreshold:i=40,edgeThreshold:l=5,longPressDelay:c=400,longPressCancelThreshold:s=5}=t,d='horizontal'===a?r:i,{text:u}=(0,Be.fOm)(),p=(0,m.computed)(()=>u.value.length>0),f=(0,m.ref)(!1),g=(0,m.ref)(!1),v=(0,m.ref)(!1),b=(0,m.ref)(null),h=(0,m.ref)(!1),x=(0,m.ref)(0),w=(0,m.ref)(0),y=(0,m.ref)(0),k=(0,m.ref)(0),C=(0,m.ref)(null),N=(0,m.ref)(!1),V=(0,m.ref)(0),E=(0,m.ref)(0),B=(0,m.ref)(!1),T=(0,m.ref)(0),S=(0,m.ref)(null),D=(0,m.ref)(!1),A=(0,m.ref)(null),I=(0,m.ref)(!1),M=t=>{const o=t?.currentTarget,n=o||e.value;n&&('horizontal'===a?(g.value=n.scrollTop<=l,v.value=n.scrollTop+n.clientHeight>=n.scrollHeight-l):(g.value=n.scrollLeft<=l,v.value=n.scrollLeft+n.clientWidth>=n.scrollWidth-l),f.value=g.value||v.value)},U=()=>{const e=window.getSelection();return!!e&&e.toString().length>0},P=(0,m.computed)(()=>p.value||U()),L=t=>{const o=e.value;if(!o)return;D.value=!1,I.value=!1,b.value=null,C.value=null,N.value=!1,A.value&&(clearTimeout(A.value),A.value=null),U()&&(D.value=!0);const n=t.touches[0];if(x.value=n.clientX,w.value=n.clientY,y.value=0,k.value=0,h.value=!0,'horizontal'===a){const e=o.closest('.acu-data-display');S.value=e,T.value=e?.scrollLeft??0}M(),V.value=o.scrollHeight,E.value=o.clientHeight,B.value=o.scrollHeight<=o.clientHeight+2,A.value=setTimeout(()=>{I.value=!0,D.value=!0},c)},F=t=>{const o=e.value;if(!o||!h.value)return;const n=t.touches[0],r=n.clientX-x.value,i=n.clientY-w.value;y.value=r,k.value=i,(Math.abs(r)>s||Math.abs(i)>s)&&A.value&&(clearTimeout(A.value),A.value=null);const l=U();if(D.value||I.value||l)D.value=!0;else if(M(),!C.value&&(Math.abs(r)>10||Math.abs(i)>10)&&(C.value=Math.abs(r)>Math.abs(i)?'horizontal':'vertical',console.info('[ACU Card] 方向锁定为:',C.value)),'horizontal'===a){const e=o.scrollTop;if(B.value){if(!C.value&&(Math.abs(r)>10||Math.abs(i)>10)&&(C.value=Math.abs(r)>Math.abs(i)?'horizontal':'vertical',console.info('[ACU Card] 短卡片方向锁定为:',C.value)),'horizontal'===C.value)return N.value||(b.value=null),void(S.value&&(S.value.scrollLeft=T.value-r));if('vertical'===C.value||null===C.value&&Math.abs(i)>5){t.cancelable&&t.preventDefault(),t.stopPropagation();const e=i>0?'insert':'delete';.6*Math.abs(i)>30?(b.value=e,N.value=!0):N.value||(b.value=null)}return}if('horizontal'===C.value)return N.value||(b.value=null),void(S.value&&(S.value.scrollLeft=T.value-r));if('vertical'===C.value){const a=o.scrollHeight,n=o.clientHeight,r=i>0&&e<=0;if(r||i<0&&e+n>=a-2){t.cancelable&&t.preventDefault(),t.stopPropagation();const e=r?'insert':'delete';.6*Math.abs(i)>30?(b.value=e,N.value=!0):N.value||(b.value=null)}else N.value||(b.value=null)}}else if('vertical'===a&&Math.abs(r)>Math.abs(i)&&Math.abs(r)>10){t.cancelable&&t.preventDefault(),t.stopPropagation();const e=.7*Math.abs(r);b.value=r>0&&e>28?'delete':r<0&&e>28?'insert':null}},j=t=>{const r=e.value;if(!r)return;A.value&&(clearTimeout(A.value),A.value=null);const i=y.value,l=k.value;if('horizontal'===a&&'horizontal'===C.value)return console.info('[ACU Card TouchEnd] 方向锁定为横向，跳过纵向手势'),h.value=!1,b.value=null,void(N.value=!1);if(console.info('[ACU Card TouchEnd] 开始处理',{layout:a,deltaX:i.toFixed(1),deltaY:l.toFixed(1),threshold:d,isSelectionMode:I.value,hasNativeSelection:U(),shouldBlockClick:D.value,gestureType:b.value}),I.value||U())return console.info('[ACU Card TouchEnd] 选词模式，跳过手势'),D.value=!0,h.value=!1,void(b.value=null);if(D.value)return console.info('[ACU Card TouchEnd] shouldBlockClick 锁定，跳过手势'),h.value=!1,void(b.value=null);if('horizontal'===a){const e=r.scrollTop,t=r.scrollHeight,a=r.clientHeight,i=B.value,c=l>0&&(e<=0||i),s=l<0&&(e+a>=t-2||i);console.info('[ACU Card TouchEnd] 横向布局判定',{scrollTop:e,scrollHeight:t,clientHeight:a,isShortCard:i,isPullDown:c,isPullUp:s,deltaY:l.toFixed(1),threshold:d,应触发新增:c&&l>d,应触发删除:s&&Math.abs(l)>d}),c&&l>d?(console.info('[ACU Card] 下拉触发新增行 (deltaY:',l,')'),o()):s&&Math.abs(l)>d?(console.info('[ACU Card] 上划触发删除切换 (deltaY:',l,')'),n()):console.info('[ACU Card TouchEnd] 横向布局未触发任何操作')}else'vertical'===a&&(console.info('[ACU Card TouchEnd] 纵向布局判定',{deltaX:i.toFixed(1),threshold:d,'应触发删除(右滑)':i>d,'应触发新增(左滑)':i<-d}),i>d?(console.info('[ACU Card] 右滑触发删除切换 (deltaX:',i,')'),n()):i<-d?(console.info('[ACU Card] 左滑触发新增行 (deltaX:',i,')'),o()):console.info('[ACU Card TouchEnd] 纵向布局未触发任何操作'));setTimeout(()=>{b.value=null,N.value=!1},300),h.value=!1};return(0,m.watch)(e,(e,t)=>{t&&(t.removeEventListener('touchstart',L),t.removeEventListener('touchmove',F),t.removeEventListener('touchend',j)),e&&(e.addEventListener('touchstart',L,{passive:!0}),e.addEventListener('touchmove',F,{passive:!1}),e.addEventListener('touchend',j,{passive:!0}),M())},{immediate:!0}),(0,m.onUnmounted)(()=>{const t=e.value;t&&(t.removeEventListener('touchstart',L),t.removeEventListener('touchmove',F),t.removeEventListener('touchend',j)),A.value&&(clearTimeout(A.value),A.value=null)}),{isSelecting:P,scrolledToEdge:f,atStart:g,atEnd:v,isSwiping:h,gestureType:b,checkScrollEdge:M,lengthX:y,lengthY:k,shouldBlockClick:D,isSelectionMode:I}}(n,{layout:a.layout,horizontalThreshold:50,verticalThreshold:40,edgeThreshold:10,onInsertRow:()=>{console.info('[ACU DataCard] 手势触发新增行'),o('insertRow')},onToggleDelete:()=>{console.info('[ACU DataCard] 手势触发切换删除',{isDeleting:w.value}),o('toggleDelete')}}),G=(0,m.computed)(()=>{if('horizontal'!==a.layout)return 0;const e=Math.abs(X?.value||0);return Math.min(.6*e,120)}),q=(0,m.computed)(()=>Math.min(G.value/80,1)),K=(0,m.computed)(()=>{if('vertical'!==a.layout)return 0;const e=Math.abs(Y?.value||0);return Math.min(.7*e,120)}),J=(0,m.computed)(()=>Math.min(K.value/60,1));(0,m.watchEffect)(()=>{u.value&&(u.value.style.height=`${G.value}px`,u.value.style.opacity=String(q.value)),p.value&&(p.value.style.height=`${G.value}px`,p.value.style.opacity=String(q.value))}),(0,m.watchEffect)(()=>{f.value&&(f.value.style.width=`${K.value}px`,f.value.style.opacity=String(J.value)),g.value&&(g.value.style.width=`${K.value}px`,g.value.style.opacity=String(J.value))}),(0,m.watch)([R,H],([e,t])=>{v.value&&(e||t)&&(h.value&&clearTimeout(h.value),b.value=!0,h.value=setTimeout(()=>{b.value=!1},2e3))});const Z=e=>{W(e)};function Q(e){if(!c.isLockEditMode)return{};const t=a.data.cells[e];if(!t)return{};const o=S.value;if(!o)return{};const n=s.isCellLockedPending(a.tableName,o,t.key),r=s.isRowLockedPending(a.tableName,o);return{'acu-cell-locked':n||r,'acu-cell-row-locked':r}}const ee=()=>{const e=S.value;if(!e)return void console.warn('[ACU] 无法生成行键，跳过整行锁定');const t=a.data.cells.map(e=>e.key),o=a.data.cells.map(e=>String(e.value??'')),n=s.toggleRowLock(a.tableName,e,t,o);console.info(`[ACU] 整行锁定状态切换: ${e} -> ${n?'锁定':'解锁'}`)},te=e=>{if(P()||L.value)console.info('[ACU] 检测到选词操作或刚结束选词，阻止点击事件');else if(F.value)console.info('[ACU] 滑动中，阻止点击事件');else if(w.value)console.info('[ACU] 待删除行不能编辑');else if(a.allowEdit){if(c.isLockEditMode){const t=a.data.cells[e];if(!t)return;const o=S.value;if(!o)return void console.warn('[ACU] 无法生成行键，跳过锁定操作');const n=String(t.value??''),r=s.toggleCellLock(a.tableName,o,t.key,n);return void console.info(`[ACU] 单元格锁定状态切换: ${t.key} -> ${r?'锁定':'解锁'}`)}r.value=e,o('cellClick',a.data.index,e)}else o('cellClick',a.data.index,e)},ae=()=>{if(!(a.titleColIndex<0)&&C.value)if(w.value)console.info('[ACU] 待删除行不能操作标题');else if(a.allowEdit){if(c.isLockEditMode){const e=S.value;if(!e)return void console.warn('[ACU] 无法生成行键，跳过标题锁定操作');const t=String(C.value.value??''),o=s.toggleCellLock(a.tableName,e,C.value.key,t);return void console.info(`[ACU] 标题锁定状态切换: ${C.value.key} -> ${o?'锁定':'解锁'}`)}console.info('[ACU DataCard] 标题点击，触发编辑 colIndex:',a.titleColIndex),r.value=a.titleColIndex,o('cellClick',a.data.index,a.titleColIndex)}else o('cellClick',a.data.index,a.titleColIndex)},oe=(e,t)=>{l.updateCell(a.tableName,a.data.index,e,t);const o=a.data.cells[e],n=S.value;o&&n&&s.isCellLocked(a.tableName,n,o.key)&&(s.updateLockedValue(a.tableName,n,o.key,t),console.info('[ACU] 同步更新锁定值:',o.key,'->',t)),r.value=null},ne=async()=>{if(!i.value){i.value=!0;try{const e=await d.getSnapshots(a.tableName,a.data.index);if(0===e.length)return void O.toast.warning('该行没有历史记录');const t=e[0];let o=0;for(const[e,n]of Object.entries(t.cells)){const t=Number(e),r=a.data.cells[t]?.value;r!==n&&(l.updateCell(a.tableName,a.data.index,t,n,{skipHistory:!0}),o++)}o>0?O.toast.success(`已撤回 ${o} 个单元格到上一版本`):O.toast.info('当前数据与历史版本相同')}catch(e){console.error('[ACU] 撤回失败:',e),O.toast.error('撤回失败')}finally{i.value=!1}}},re=e=>{/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?console.info('[ACU] 移动端不触发右键菜单'):o('contextMenu',e,a.data.index)};return(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{ref_key:'cardRef',ref:n,class:(0,m.normalizeClass)(['acu-data-card',[M.value,{'acu-editing-lock':null!==r.value,'acu-style-list':'list'===e.viewMode,'acu-style-card':'card'===e.viewMode,'acu-swiping':(0,m.unref)(F)}]]),onContextmenu:(0,m.withModifiers)(re,['prevent']),onScroll:Z},[(0,m.createCommentVNode)(' 横向布局：顶部下拉新增提示（必须在最前面，与原版 prepend 一致） '),(0,m.createCommentVNode)(' 注意：使用 v-show 替代 v-if 保持 DOM 存在，配合 watchEffect 直接操作样式 '),(0,m.withDirectives)((0,m.createElementVNode)('div',{ref_key:'pullTopRef',ref:u,class:'acu-pull-overlay acu-pull-top'},[...a[6]||(a[6]=[(0,m.createElementVNode)('div',{class:'acu-pull-icon'},[(0,m.createElementVNode)('i',{class:'fa-solid fa-plus'}),(0,m.createElementVNode)('span',{class:'acu-pull-text'},'新增一行')],-1)])],512),[[m.vShow,'horizontal'===e.layout&&(0,m.unref)(v)&&'insert'===(0,m.unref)(j)]]),(0,m.createCommentVNode)(' 卡片头部（可选显示索引和标题） '),e.showHeader?((0,m.openBlock)(),(0,m.createElementBlock)('div',gt,[e.showIndex?((0,m.openBlock)(),(0,m.createElementBlock)('span',vt,'#'+(0,m.toDisplayString)(e.data.index+1),1)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 标题编辑模式 '),C.value&&r.value===e.titleColIndex&&!(0,m.unref)(c).isLockEditMode?((0,m.openBlock)(),(0,m.createBlock)(ft,{key:1,class:'acu-title-editor',value:C.value.value,onSave:a[0]||(a[0]=t=>oe(e.titleColIndex,t)),onCancel:a[1]||(a[1]=e=>r.value=null)},null,8,['value'])):C.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:2},[(0,m.createCommentVNode)(' 标题显示模式 '),(0,m.createElementVNode)('span',{class:(0,m.normalizeClass)(['acu-editable-title',{'acu-title-locked':A.value}]),onClick:ae},[(0,m.createTextVNode)((0,m.toDisplayString)(C.value.value||'未命名')+' ',1),A.value?((0,m.openBlock)(),(0,m.createElementBlock)('i',bt)):(0,m.createCommentVNode)('v-if',!0)],2)],2112)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 行锁定按钮（仅锁定编辑模式显示） '),(0,m.unref)(c).isLockEditMode?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:3,class:(0,m.normalizeClass)(['acu-row-lock-btn',{'acu-row-locked':D.value}]),title:'锁定/解锁整行',onClick:(0,m.withModifiers)(ee,['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(D.value?'fas fa-lock':'fas fa-lock-open')},null,2)],2)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 历史记录按钮组 '),e.showHistoryButton&&!(0,m.unref)(c).isLockEditMode?((0,m.openBlock)(),(0,m.createElementBlock)('div',ht,[(0,m.createCommentVNode)(' 撤回按钮 '),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-icon-btn',{'acu-loading':i.value}]),disabled:i.value,title:'撤回到上一版本',onClick:(0,m.withModifiers)(ne,['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(i.value?'fas fa-spinner fa-spin':'fas fa-undo')},null,2)],10,xt),(0,m.createCommentVNode)(' 查看历史按钮 '),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:'查看历史记录',onClick:a[2]||(a[2]=(0,m.withModifiers)(e=>o('showHistory'),['stop']))},[...a[7]||(a[7]=[(0,m.createElementVNode)('i',{class:'fas fa-search'},null,-1)])])])):(0,m.createCommentVNode)('v-if',!0)])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 卡片内容区 - Card 布局 '),'card'===e.viewMode?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' Card 单元格区域 '),(0,m.createElementVNode)('div',wt,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(E.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.colIndex,class:(0,m.normalizeClass)(['acu-grid-item',[I(e.colIndex),Q(e.colIndex)]]),onClick:t=>te(e.colIndex)},[(0,m.createElementVNode)('label',kt,(0,m.toDisplayString)(e.key),1),(0,m.createElementVNode)('div',Ct,[r.value!==e.colIndex||(0,m.unref)(c).isLockEditMode?((0,m.openBlock)(),(0,m.createBlock)(mt,{key:1,value:e.value},null,8,['value'])):((0,m.openBlock)(),(0,m.createBlock)(ft,{key:0,value:e.value,onSave:t=>oe(e.colIndex,t),onCancel:a[3]||(a[3]=e=>r.value=null)},null,8,['value','onSave']))]),(0,m.createCommentVNode)(' 锁定图标（仅锁定编辑模式下显示） '),(0,m.unref)(c).isLockEditMode&&Q(e.colIndex)['acu-cell-locked']?((0,m.openBlock)(),(0,m.createElementBlock)('i',Nt)):(0,m.createCommentVNode)('v-if',!0)],10,yt))),128))]),(0,m.createCommentVNode)(' Full-Width 单元格区域（长文本） '),T.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',Vt,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(T.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.colIndex,class:(0,m.normalizeClass)(['acu-full-item',[I(e.colIndex),Q(e.colIndex)]]),onClick:t=>te(e.colIndex)},[(0,m.createElementVNode)('label',Bt,(0,m.toDisplayString)(e.key),1),(0,m.createElementVNode)('div',Tt,[r.value!==e.colIndex||(0,m.unref)(c).isLockEditMode?((0,m.openBlock)(),(0,m.createElementBlock)('span',St,(0,m.toDisplayString)(e.value||'-'),1)):((0,m.openBlock)(),(0,m.createBlock)(ft,{key:0,value:e.value,'max-height':300,onSave:t=>oe(e.colIndex,t),onCancel:a[4]||(a[4]=e=>r.value=null)},null,8,['value','onSave']))]),(0,m.createCommentVNode)(' 锁定图标（仅锁定编辑模式下显示） '),(0,m.unref)(c).isLockEditMode&&Q(e.colIndex)['acu-cell-locked']?((0,m.openBlock)(),(0,m.createElementBlock)('i',Dt)):(0,m.createCommentVNode)('v-if',!0)],10,Et))),128))])):(0,m.createCommentVNode)('v-if',!0)],64)):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:2},[(0,m.createCommentVNode)(' 卡片内容区 - List 布局 '),(0,m.createElementVNode)('div',At,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(N.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.colIndex,class:(0,m.normalizeClass)(['acu-card-row',[I(e.colIndex),Q(e.colIndex)]]),onClick:t=>te(e.colIndex)},[(0,m.createElementVNode)('label',It,(0,m.toDisplayString)(e.key)+':',1),(0,m.createElementVNode)('div',_t,[r.value!==e.colIndex||(0,m.unref)(c).isLockEditMode?((0,m.openBlock)(),(0,m.createBlock)(mt,{key:1,value:e.value},null,8,['value'])):((0,m.openBlock)(),(0,m.createBlock)(ft,{key:0,value:e.value,onSave:t=>oe(e.colIndex,t),onCancel:a[5]||(a[5]=e=>r.value=null)},null,8,['value','onSave']))]),(0,m.createCommentVNode)(' 锁定图标（仅锁定编辑模式下显示） '),(0,m.unref)(c).isLockEditMode&&Q(e.colIndex)['acu-cell-locked']?((0,m.openBlock)(),(0,m.createElementBlock)('i',Mt)):(0,m.createCommentVNode)('v-if',!0)],10,zt))),128))])],64)),(0,m.createCommentVNode)(' 横向布局：底部上划删除提示（在内容区域之后，与原版 append 一致） '),(0,m.createCommentVNode)(' 注意：使用 v-show 替代 v-if 保持 DOM 存在，配合 watchEffect 直接操作样式 '),(0,m.withDirectives)((0,m.createElementVNode)('div',{ref_key:'pullBottomRef',ref:p,class:(0,m.normalizeClass)(['acu-pull-overlay acu-pull-bottom',{'acu-pull-restore':w.value}])},[(0,m.createElementVNode)('div',Ut,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(w.value?'fa-solid fa-undo':'fa-solid fa-trash')},null,2),(0,m.createElementVNode)('span',Pt,(0,m.toDisplayString)(w.value?'撤销删除':'删除本行'),1)])],2),[[m.vShow,'horizontal'===e.layout&&(0,m.unref)(v)&&'delete'===(0,m.unref)(j)]]),(0,m.createCommentVNode)(' 待删除印章 (圆形印章样式) '),w.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',$t,'待删除')):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 竖向布局：左右滑动反馈（与原版 .acu-swipe-overlay 一致） '),(0,m.createCommentVNode)(' 注意：使用 v-show 替代 v-if 保持 DOM 存在，配合 watchEffect 直接操作样式 '),'vertical'===e.layout&&(0,m.unref)(v)?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:4},[(0,m.createCommentVNode)(' 左侧右滑删除提示 '),(0,m.withDirectives)((0,m.createElementVNode)('div',{ref_key:'swipeLeftRef',ref:f,class:(0,m.normalizeClass)(['acu-swipe-overlay acu-swipe-left',{'acu-swipe-restore':w.value}])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(w.value?'fa-solid fa-undo':'fa-solid fa-trash')},null,2)],2),[[m.vShow,'delete'===(0,m.unref)(j)]]),(0,m.createCommentVNode)(' 右侧左滑新增提示 '),(0,m.withDirectives)((0,m.createElementVNode)('div',{ref_key:'swipeRightRef',ref:g,class:'acu-swipe-overlay acu-swipe-right'},[...a[8]||(a[8]=[(0,m.createElementVNode)('i',{class:'fa-solid fa-plus'},null,-1)])],512),[[m.vShow,'insert'===(0,m.unref)(j)]])],64)):(0,m.createCommentVNode)('v-if',!0)],34))}});var Ft=u(4674),jt=u(9800),Ot=u(9185);function Rt(){const e=(0,Ot.E)(),t=(0,k.j_)(),{setHiddenPrompt:a,setupSendIntercept:o}=Ve();function n(t){const a=t.dimensions.map(e=>({dimensionName:e.name,tierName:e.value,prompt:e.prompt})),o=e.config,n=o&&'object'==typeof o&&'value'in o?o.value?.customTemplate:o?.customTemplate;if(n&&n.trim()){let e=n;const a=t.luck.prompt||'',o=t.words.join('、'),r=new Map;t.dimensions.forEach(e=>{e.prompt&&e.prompt.trim()&&r.set(e.name,e.prompt)});const i=new Set;e=e.replace(/\{\{luck\}\}/gi,a),e=e.replace(/\{\{words\}\}/gi,o);for(const[t,a]of r.entries()){const o=t.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),n=new RegExp(`\\{\\{${o}\\}\\}`,'gi');n.test(e)&&(e=e.replace(n,a),i.add(t))}const l=[];for(const[e,t]of r.entries())i.has(e)||l.push(t);const c=l.join('\n');return e=e.replace(/\{\{dimensions\}\}/gi,c),e}return Fe({luck:t.luck,words:t.words,dimensions:a})}async function r(e){const t=window.parent,a=t.getChatMessages||t.TavernHelper?.getChatMessages,o=t.setChatMessages||t.TavernHelper?.setChatMessages,n=t.getLastMessageId||t.TavernHelper?.getLastMessageId;if(!a||!o)return console.error('[ACU] getChatMessages/setChatMessages not found in parent window or TavernHelper'),void O.toast.error('无法获取酒馆接口，请确保酒馆助手已正确安装');const r=n?.()??999,i=Math.max(0,r-50),l=a(`${i}-${r}`);let c;for(let e=l.length-1;e>=0;e--)if('user'===l[e].role){c=l[e];break}if(console.info('[ACU Divination] 搜索用户消息范围:',`${i}-${r}`,'总消息:',l.length,'条，最后一条用户消息 ID:',c?.message_id),!c)return O.toast.warning('未找到用户消息，已改为追加到输入框'),void Ne(e,'\n');const s=`<剧情元指令>\n${e.replace(/<剧情元指令[^>]*>/g,'').replace(/<\/剧情元指令>/g,'').trim()}\n</剧情元指令>`,d=/<剧情元指令[\s\S]*?<\/剧情元指令>/,u=c.message||'';let p;p=d.test(u)?u.replace(d,s):s+'\n'+u,await o([{message_id:c.message_id,message:p}]),O.toast.success('已替换用户消息中的剧情元指令，请点击重新生成')}return{performDivination:async function(){e.isLoaded||e.loadConfig(),await t.initDivinationSystem(),0===e.categories.length?(console.info('[ACU] 首次抽签，尝试加载词库...'),await e.loadFromWorldbook(),0===e.categories.length&&(console.info('[ACU] 词库为空，尝试从 ACU 表格同步...'),await e.syncFromACU(),await e.loadFromWorldbook())):e.loadFromWorldbook(),0===e.categories.length&&O.toast.warning('未找到随机词库。请确保存在名为 "Random" 或 "随机" 的表格。');const r=e.performDivination();if(r){const i=e.config;if('skip'===(i&&'object'==typeof i&&'value'in i?i.value?.flipMode:i?.flipMode)){const e=n(r);a(e),o(),O.toast.success('提示词已注入隐藏编辑框')}else t.openDivinationOverlay(r)}else O.toast.error('抽签失败，请检查配置')},confirmDivination:function(e,i='reveal'){const l=n(e);'reroll'===i?r(l):'hide'===i?(a(l),o(),O.toast.success('提示词已注入隐藏编辑框')):(Ne(l,'\n'),O.toast.success('提示词已追加到输入框')),t.closeDivinationOverlay()},triggerQuickReroll:async function(){e.isLoaded||e.loadConfig(),await t.initDivinationSystem(),0===e.categories.length?(await e.loadFromWorldbook(),0===e.categories.length&&(await e.syncFromACU(),await e.loadFromWorldbook())):e.loadFromWorldbook();const a=e.performDivination();if(a){const o=e.config;if('skip'===(o.value?.flipMode??o?.flipMode)){const e=n(a);await r(e)}else t.openDivinationOverlay(a,!0)}else O.toast.error('抽签失败，请检查配置')}}}var Ht=u(9623),Wt=u(9221);const Yt={class:'acu-embedded-options'},Xt={key:0,class:'acu-empty-hint'},Gt={class:'acu-embedded-options-list'},qt={class:'acu-embedded-option-rows'},Kt=['onClick'],Jt={key:0,class:'acu-embedded-option-tags'},Zt={class:'acu-embedded-option-text'},Qt=(0,m.defineComponent)({__name:'EmbeddedOptionsPanel',props:{tables:{}},setup(e){const t=e,{setInput:a}=Ee(),o=(0,m.computed)(()=>t.tables.filter(e=>(0,Wt.YP)(e.name)));function n(e){return(0,Wt.NX)(e)}return(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',Yt,[(0,m.createCommentVNode)(' 空状态 '),0===o.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',Xt,[...t[0]||(t[0]=[(0,m.createElementVNode)('i',{class:'fas fa-inbox'},null,-1),(0,m.createTextVNode)(' 未找到名称包含"选项"的表格 ',-1)])])):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 选项表格列表 '),(0,m.createElementVNode)('div',Gt,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(o.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:'acu-embedded-option-group'},[(0,m.createCommentVNode)(' 选项行列表 '),(0,m.createElementVNode)('div',qt,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(n(e),(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t,class:'acu-embedded-option-row',title:'点击追加',onClick:(0,m.withModifiers)(t=>{var o;(o=e.text).trim()&&(a(o.trim()),O.toast.success('已追加到输入框'))},['stop'])},[(0,m.createCommentVNode)(' 标签区域 (Tag 在上) '),e.tags.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',Jt,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.tags,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:t,class:'acu-badge'},(0,m.toDisplayString)(e),1))),128))])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 选项文本 (内容在下) '),(0,m.createElementVNode)('div',Zt,(0,m.toDisplayString)(e.text),1)],8,Kt))),128))])]))),128))])],2112))]))}}),ea={class:'acu-global-header'},ta={key:0,class:'acu-global-location'},aa={class:'location-path'},oa={class:'location-part'},na={key:0,class:'location-sep'},ra={key:1,class:'acu-global-time-group'},ia={key:0,class:'acu-global-time-primary'},la={class:'acu-global-time-secondary'},ca={key:0,class:'acu-badge-outline is-highlight'},sa={key:1,class:'acu-badge-outline',title:'上轮时间'},da={class:'acu-global-body'},ua={key:0,class:'acu-global-item layout-inline'},pa={class:'item-icon'},ma={class:'item-content'},fa={class:'item-label'},ga={class:'item-value'},va={class:'item-icon'},ba={class:'item-content'},ha={class:'item-label'},xa={class:'item-value'},wa={key:1,class:'acu-global-item layout-inline people-group'},ya={class:'item-content'},ka={class:'item-label'},Ca={class:'acu-global-person-list'},Na={key:0,class:'acu-global-footer'},Va={class:'acu-global-item layout-block system-notice'},Ea={class:'item-icon'},Ba={class:'item-content'},Ta={class:'item-label'},Sa={class:'item-value'},Da=(0,m.defineComponent)({__name:'GlobalStatusWidget',props:{tableData:{},isEditing:{type:Boolean}},emits:['row-click'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.computed)(()=>a.tableData&&0!==a.tableData.rows.length?a.tableData.rows[0]:null),r=(0,m.computed)(()=>{const e=n.value;if(!e)return null;const t={locationCols:[],timeCols:{current:null,passed:null,last:null},weatherCol:null,peopleCol:null,attributes:[],footer:null};e.cells.forEach(e=>{const a=e.key.toLowerCase();String(e.value||'')&&(['时','time','date','clock'].some(e=>a.includes(e))?['流逝','经过','passed','elapse'].some(e=>a.includes(e))?t.timeCols.passed=e:['上轮','last','prev'].some(e=>a.includes(e))?t.timeCols.last=e:!t.timeCols.current||a.length<t.timeCols.current.key.length?(t.timeCols.current&&t.attributes.push(t.timeCols.current),t.timeCols.current=e):t.attributes.push(e):!['场','地','位置','loc','place','area','zone'].some(e=>a.includes(e))||a.includes('在场')?['天','气','weather','climate'].some(e=>a.includes(e))?t.weatherCol=e:['人','npc','chara','在场','role'].some(e=>a.includes(e))?t.peopleCol=e:t.attributes.push(e):t.locationCols.push(e))});let a=0,o=-1;return t.attributes.forEach((e,t)=>{const n=String(e.value).length;(['系','统','知','sys','info'].some(t=>e.key.toLowerCase().includes(t))||n>30&&n>a)&&(a=n,o=t)}),-1!==o&&(t.footer=t.attributes[o],t.attributes.splice(o,1)),t}),i=(0,m.computed)(()=>{const e=r.value?.locationCols;return e&&0!==e.length?e.sort((e,t)=>e.colIndex-t.colIndex).map(e=>e.value).join(' › '):''}),l=(0,m.computed)(()=>{const e=r.value?.locationCols;return e&&0!==e.length?e.sort((e,t)=>e.colIndex-t.colIndex).map(e=>e.value):[]}),c=(0,m.computed)(()=>({current:r.value?.timeCols.current?.value,passed:r.value?.timeCols.passed?.value,last:r.value?.timeCols.last?.value})),s=(0,m.computed)(()=>{const e=r.value?.weatherCol;return e?{label:e.key,value:String(e.value)}:null});function d(e){const t=e.toLowerCase();return t.includes('晴')||t.includes('sun')||t.includes('clear')?'fa-sun':t.includes('阴')||t.includes('cloud')||t.includes('overcast')?'fa-cloud':t.includes('雨')||t.includes('rain')?'fa-cloud-showers-heavy':t.includes('雪')||t.includes('snow')?'fa-snowflake':t.includes('雷')||t.includes('thunder')||t.includes('storm')?'fa-bolt':t.includes('雾')||t.includes('fog')||t.includes('mist')?'fa-smog':t.includes('风')||t.includes('wind')?'fa-wind':t.includes('台风')||t.includes('hurricane')?'fa-hurricane':'fa-cloud-sun'}const u=(0,m.computed)(()=>r.value?.peopleCol),p=(0,m.computed)(()=>{const e=u.value;return e&&e.value?String(e.value).split(/[,，、/&]/).map(e=>e.trim()).filter(e=>e):[]}),f=(0,m.computed)(()=>r.value?r.value.attributes.map(e=>({key:e.key,value:String(e.value),isLong:String(e.value).length>15})):[]),g=(0,m.computed)(()=>{const e=r.value?.footer;return e?{key:e.key,value:String(e.value)}:null});function v(e){const t=e.toLowerCase();return['金','钱','币','money','gold','coin'].some(e=>t.includes(e))?'fa-coins':['系','统','知','sys','info','notice'].some(e=>t.includes(e))?'fa-bell':['态','state','status','hp','mp'].some(e=>t.includes(e))?'fa-heart-pulse':['级','level','lv','rank'].some(e=>t.includes(e))?'fa-layer-group':'fa-info-circle'}function b(){a.isEditing||n.value&&o('row-click',n.value)}return(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{class:(0,m.normalizeClass)(['acu-global-widget',{'is-editing':e.isEditing,'acu-dash-interactive':!e.isEditing}]),onClick:(0,m.withModifiers)(b,['stop'])},[(0,m.createCommentVNode)(' 头部区域 (Location + Time) '),(0,m.createElementVNode)('div',ea,[(0,m.createCommentVNode)(' Location (H1) '),i.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',ta,[a[0]||(a[0]=(0,m.createElementVNode)('i',{class:'fas fa-map-marker-alt'},null,-1)),(0,m.createElementVNode)('div',aa,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(l.value,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:t},[(0,m.createElementVNode)('span',oa,(0,m.toDisplayString)(e),1),t<l.value.length-1?((0,m.openBlock)(),(0,m.createElementBlock)('span',na,'›')):(0,m.createCommentVNode)('v-if',!0)],64))),128))])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' Time Group '),c.value.current||c.value.passed||c.value.last?((0,m.openBlock)(),(0,m.createElementBlock)('div',ra,[(0,m.createCommentVNode)(' Current Time '),c.value.current?((0,m.openBlock)(),(0,m.createElementBlock)('div',ia,[a[1]||(a[1]=(0,m.createElementVNode)('i',{class:'fas fa-clock'},null,-1)),(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(c.value.current),1)])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' Secondary Times '),(0,m.createElementVNode)('div',la,[(0,m.createCommentVNode)(' Passed Time Badge '),c.value.passed?((0,m.openBlock)(),(0,m.createElementBlock)('span',ca,[a[2]||(a[2]=(0,m.createElementVNode)('i',{class:'fas fa-hourglass-half'},null,-1)),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(c.value.passed),1)])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' Last Time '),c.value.last?((0,m.openBlock)(),(0,m.createElementBlock)('span',sa,[a[3]||(a[3]=(0,m.createElementVNode)('i',{class:'fas fa-history'},null,-1)),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(c.value.last),1)])):(0,m.createCommentVNode)('v-if',!0)])])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 内容区域 (Body) '),(0,m.createElementVNode)('div',da,[(0,m.createCommentVNode)(' 天气模块 '),s.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',ua,[(0,m.createElementVNode)('div',pa,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',d(s.value.value)])},null,2)]),(0,m.createElementVNode)('div',ma,[(0,m.createElementVNode)('div',fa,(0,m.toDisplayString)(s.value.label),1),(0,m.createElementVNode)('div',ga,(0,m.toDisplayString)(s.value.value),1)])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 其他属性 (流式排版) '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(f.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.key,class:(0,m.normalizeClass)(['acu-global-item',e.isLong?'layout-block':'layout-inline'])},[(0,m.createElementVNode)('div',va,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',v(e.key)])},null,2)]),(0,m.createElementVNode)('div',ba,[(0,m.createElementVNode)('div',ha,(0,m.toDisplayString)(e.key),1),(0,m.createElementVNode)('div',xa,(0,m.toDisplayString)(e.value),1)])],2))),128)),(0,m.createCommentVNode)(' 人物列表 (Tag Group) '),u.value&&p.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',wa,[a[4]||(a[4]=(0,m.createElementVNode)('div',{class:'item-icon'},[(0,m.createElementVNode)('i',{class:'fas fa-users'})],-1)),(0,m.createElementVNode)('div',ya,[(0,m.createElementVNode)('div',ka,(0,m.toDisplayString)(u.value.key),1),(0,m.createElementVNode)('div',Ca,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(p.value,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t,class:'person-tag'},(0,m.toDisplayString)(e),1))),128))])])])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 底部区域 (Footer: System Notice / Long Text) '),g.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Na,[(0,m.createElementVNode)('div',Va,[(0,m.createElementVNode)('div',Ea,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',v(g.value.key)])},null,2)]),(0,m.createElementVNode)('div',Ba,[(0,m.createElementVNode)('div',Ta,(0,m.toDisplayString)(g.value.key),1),(0,m.createElementVNode)('div',Sa,(0,m.toDisplayString)(g.value.value),1)])])])):(0,m.createCommentVNode)('v-if',!0)],2))}}),Aa={class:'acu-status-board'},za={class:'acu-status-board-header'},Ia={class:'acu-status-board-summary'},_a={class:'acu-status-board-actions'},Ma={key:0,class:'acu-status-toolbar'},Ua=['disabled'],Pa=['disabled'],$a=['disabled'],La=['disabled','title'],Fa=['disabled'],ja=['title'],Oa={class:'acu-status-table-wrapper'},Ra={class:'acu-status-table'},Ha=['onClick'],Wa=['onClick'],Ya={class:'acu-status-freq'},Xa=['value','onInput'],Ga={key:0,class:'acu-status-disabled'},qa={key:1},Ka={key:2,class:'acu-status-global-hint'},Ja={class:'acu-status-last-update'},Za={key:0},Qa={key:1},eo=(0,m.defineComponent)({__name:'TableStatusBoard',emits:['tableClick'],setup(e,{emit:t}){const a=t,o=(0,y.D)(),n=(0,k.j_)(),{statusList:r,isLoading:i,currentTotalAiFloors:l,refresh:c,formatLastUpdate:s,getUnrecordedClass:d}=j(),{purgeTableDataByRange:u}=ue(),p=(0,m.ref)(!1),f=(0,m.ref)(new Set),g=(0,m.ref)(new Map),b=(0,m.ref)([]),h=(0,m.computed)(()=>{if(0===f.value.size)return'disabled';const e=r.value.filter(e=>f.value.has(e.sheetKey)).map(e=>g.value.has(e.sheetKey)?g.value.get(e.sheetKey):e.effectiveFrequency),t=e.every(e=>0===e),a=e.every(e=>0!==e);return t?'enable':a?'disable':'mixed'}),x=(0,m.computed)(()=>g.value.size>0||b.value.length>0);function w(e){const t=o.aiDiffMap;if(!t||0===t.size)return!1;for(const a of t)if(a.startsWith(`${e}-`))return!0;return!1}const C=(0,m.computed)(()=>[...r.value].sort((e,t)=>{const a=w(e.name),o=w(t.name);return a!==o?o?1:-1:e.orderNo-t.orderNo}));function N(){p.value=!1,f.value.clear(),g.value.clear(),b.value=[]}function V(){f.value.size===r.value.length?f.value.clear():r.value.forEach(e=>f.value.add(e.sheetKey))}function E(e){return g.value.has(e.sheetKey)?g.value.get(e.sheetKey):e.updateFrequency}async function B(){await c()}function T(){if(0===f.value.size)return;const e=(0,v.M1)().getDB();if(e?.getTableTemplate)try{const t=e.getTableTemplate();if(!t)return void O.toast.error('无法获取当前模板');const a={mate:t.mate||{type:'chatSheets',version:1,updateConfigUiSentinel:-1}};f.value.forEach(e=>{t[e]&&(a[e]=t[e])});const o=JSON.stringify(a,null,2),n=new Blob([o],{type:'application/json'}),r=URL.createObjectURL(n),i=document.createElement('a');i.href=r,i.download=`tables_export_${Date.now()}.json`,i.click(),URL.revokeObjectURL(r),O.toast.success(`已导出 ${f.value.size} 个表格`)}catch(e){console.error('[ACU] 导出失败:',e),O.toast.error(`导出失败: ${e instanceof Error?e.message:String(e)}`)}else O.toast.error('数据库 API 不可用')}async function S(){if(0===f.value.size)return;if(!confirm(`确定要删除选中的 ${f.value.size} 个表格吗？\n\n此操作将：\n1. 从所有聊天记录中清除这些表格的数据\n2. 从模板中移除这些表格的定义\n\n操作不可撤销！`))return;const e=(0,v.M1)().getDB();if(e?.getTableTemplate&&e?.importTemplateFromData)try{O.toast.info('正在清除历史数据...');const t=Array.from(f.value),a=await u(t,0,9999999);a.changed&&O.toast.success(`已清除 ${a.changedCount} 层历史数据`);const o=e.getTableTemplate();if(!o)return void O.toast.error('无法获取当前模板');f.value.forEach(e=>{delete o[e]});const n=await e.importTemplateFromData(o);n.success?(O.toast.success(`已删除 ${f.value.size} 个表格定义`),f.value.clear(),await c()):O.toast.error(`删除失败: ${n.message}`)}catch(e){console.error('[ACU] 删除表格失败:',e),O.toast.error(`删除失败: ${e instanceof Error?e.message:String(e)}`)}else O.toast.error('数据库 API 不可用')}function D(){n.openAdvancedPurgeDialog({initialStartFloor:void 0,initialEndFloor:void 0},{onConfirm:async()=>{await c(),f.value.clear()}},{selectedTableKeys:Array.from(f.value)})}function A(){n.openAddTableDialog(e=>{b.value.push(...e),O.toast.success(`已添加 ${e.length} 个表格到待保存列表`)})}function I(){if(0===f.value.size)return;const e=h.value;if('mixed'===e)return;const t='enable'===e?-1:0;f.value.forEach(e=>{g.value.set(e,t)}),O.toast.success('enable'===e?'已设置为启用':'已设置为禁用')}function M(e){a('tableClick',e.sheetKey,e.name)}function U(e){var t;p.value?(t=e.sheetKey,f.value.has(t)?f.value.delete(t):f.value.add(t)):M(e)}return(0,m.onMounted)(()=>{c()}),(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',Aa,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',za,[(0,m.createElementVNode)('span',Ia,' 共 '+(0,m.toDisplayString)((0,m.unref)(r).length)+' 个表格 · AI楼层 '+(0,m.toDisplayString)((0,m.unref)(l)),1),(0,m.createElementVNode)('div',_a,[(0,m.createCommentVNode)(' 编辑模式工具栏 '),p.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Ma,[(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'全选',onClick:(0,m.withModifiers)(V,['stop'])},[...t[2]||(t[2]=[(0,m.createElementVNode)('i',{class:'fas fa-check-double'},null,-1)])]),(0,m.createElementVNode)('button',{class:'acu-tool-btn',disabled:0===f.value.size,title:'导出',onClick:(0,m.withModifiers)(T,['stop'])},[...t[3]||(t[3]=[(0,m.createElementVNode)('i',{class:'fas fa-file-export'},null,-1)])],8,Ua),(0,m.createElementVNode)('button',{class:'acu-tool-btn',disabled:0===f.value.size,title:'删除',onClick:(0,m.withModifiers)(S,['stop'])},[...t[4]||(t[4]=[(0,m.createElementVNode)('i',{class:'fas fa-trash'},null,-1)])],8,Pa),(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'添加',onClick:(0,m.withModifiers)(A,['stop'])},[...t[5]||(t[5]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])]),(0,m.createElementVNode)('button',{class:'acu-tool-btn',disabled:0===f.value.size,title:'清除',onClick:(0,m.withModifiers)(D,['stop'])},[...t[6]||(t[6]=[(0,m.createElementVNode)('i',{class:'fas fa-eraser'},null,-1)])],8,$a),(0,m.createElementVNode)('button',{class:'acu-tool-btn',disabled:'mixed'===h.value||0===f.value.size,title:'enable'===h.value?'启用':'禁用',onClick:(0,m.withModifiers)(I,['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas','enable'===h.value?'fa-play':'fa-ban'])},null,2)],8,La)])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 刷新按钮 '),(0,m.createElementVNode)('button',{class:'acu-icon-btn',disabled:(0,m.unref)(i),title:'刷新状态',onClick:(0,m.withModifiers)(B,['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas fa-redo',{'acu-animate-spin':(0,m.unref)(i)}])},null,2)],8,Fa),(0,m.createCommentVNode)(' 编辑/保存按钮 '),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:p.value?'保存':'编辑',onClick:t[0]||(t[0]=(0,m.withModifiers)(e=>p.value?async function(){if(!x.value&&0===g.value.size)return void N();const e=(0,v.M1)().getDB();if(e?.getTableTemplate&&e?.importTemplateFromData)try{const t=e.getTableTemplate();if(!t)return void O.toast.error('无法获取当前模板');let a=0;for(const[e,o]of g.value)t[e]?.updateConfig&&(t[e].updateConfig.updateFrequency=o,a++);for(const e of b.value)t[`sheet_${e.uid||Date.now()}_${Math.random().toString(36).slice(2,8)}`]=e,a++;const o=await e.importTemplateFromData(t);o.success?(O.toast.success(`保存成功，共 ${a} 项变更`),N(),await c()):O.toast.error(`保存失败: ${o.message}`)}catch(e){console.error('[ACU] 保存失败:',e),O.toast.error(`保存失败: ${e instanceof Error?e.message:String(e)}`)}else O.toast.error('数据库 API 不可用')}():(p.value=!0,void O.toast.info('可多选操作')),['stop']))},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',p.value?'fa-check':'fa-edit'])},null,2)],8,ja)])]),(0,m.createCommentVNode)(' 表格 '),(0,m.createElementVNode)('div',Oa,[(0,m.createElementVNode)('table',Ra,[t[9]||(t[9]=(0,m.createElementVNode)('thead',null,[(0,m.createElementVNode)('tr',null,[(0,m.createElementVNode)('th',{class:'acu-status-col-name'},'表格名称'),(0,m.createElementVNode)('th',{class:'acu-status-col-freq'},'更新频率'),(0,m.createElementVNode)('th',{class:'acu-status-col-unrecorded'},'未记录楼层'),(0,m.createElementVNode)('th',{class:'acu-status-col-last'},'上次更新')])],-1)),(0,m.createElementVNode)('tbody',null,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(C.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('tr',{key:e.sheetKey,class:(0,m.normalizeClass)({'acu-row-selected':p.value&&f.value.has(e.sheetKey),'acu-highlight-ai':w(e.name)&&!p.value}),onClick:(0,m.withModifiers)(t=>U(e),['stop'])},[(0,m.createElementVNode)('td',{class:(0,m.normalizeClass)(['acu-status-name',{'acu-highlight-ai':w(e.name)&&!p.value}])},[(0,m.createElementVNode)('span',{style:(0,m.normalizeStyle)({cursor:p.value?'default':'pointer'}),onClick:(0,m.withModifiers)(t=>p.value?null:M(e),['stop'])},(0,m.toDisplayString)(e.name),13,Wa)],2),(0,m.createElementVNode)('td',Ya,[(0,m.createCommentVNode)(' 编辑模式：显示输入框 '),p.value?((0,m.openBlock)(),(0,m.createElementBlock)('input',{key:0,type:'number',value:E(e),min:'-1',class:'acu-freq-input',onInput:t=>function(e,t){const a=t.target,o=parseInt(a.value,10);isNaN(o)||g.value.set(e,o)}(e.sheetKey,t),onClick:t[1]||(t[1]=(0,m.withModifiers)(()=>{},['stop']))},null,40,Xa)):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 普通模式：显示文本 '),0===e.effectiveFrequency?((0,m.openBlock)(),(0,m.createElementBlock)('span',Ga,'禁用')):((0,m.openBlock)(),(0,m.createElementBlock)('span',qa,(0,m.toDisplayString)(e.effectiveFrequency),1)),-1===e.updateFrequency?((0,m.openBlock)(),(0,m.createElementBlock)('span',Ka,'(全局)')):(0,m.createCommentVNode)('v-if',!0)],64))]),(0,m.createElementVNode)('td',{class:(0,m.normalizeClass)(['acu-status-unrecorded',(0,m.unref)(d)(e)])},(0,m.toDisplayString)(e.hasHistory?e.unrecordedFloors:'—'),3),(0,m.createElementVNode)('td',Ja,[(0,m.createCommentVNode)(' 显示格式: AI楼层号/实际楼层号 '),(0,m.createTextVNode)(' '+(0,m.toDisplayString)((0,m.unref)(s)(e)),1)])],10,Ha))),128)),(0,m.createCommentVNode)(' 空状态 '),0!==(0,m.unref)(r).length||(0,m.unref)(i)?(0,m.createCommentVNode)('v-if',!0):((0,m.openBlock)(),(0,m.createElementBlock)('tr',Za,[...t[7]||(t[7]=[(0,m.createElementVNode)('td',{colspan:'4',class:'acu-status-empty'},[(0,m.createElementVNode)('i',{class:'fas fa-inbox'}),(0,m.createTextVNode)(' 暂无表格数据 ')],-1)])])),(0,m.createCommentVNode)(' 加载中 '),(0,m.unref)(i)&&0===(0,m.unref)(r).length?((0,m.openBlock)(),(0,m.createElementBlock)('tr',Qa,[...t[8]||(t[8]=[(0,m.createElementVNode)('td',{colspan:'4',class:'acu-status-loading'},[(0,m.createElementVNode)('i',{class:'fas fa-spinner fa-spin'}),(0,m.createTextVNode)(' 加载中... ')],-1)])])):(0,m.createCommentVNode)('v-if',!0)])])])]))}}),to=eo,ao=['draggable'],oo={key:0,class:'acu-dash-count'},no={class:'acu-dash-actions'},ro=['title'],io=['title'],lo=['title','onClick'],co=['onClick'],so={class:'acu-dash-npc-text'},uo=['title','onClick'],po=['title','onClick'],mo=['title','onClick'],fo={key:1},go={class:'acu-dash-npc-grid'},vo=['onClick'],bo={class:'acu-dash-npc-text'},ho=['title','onClick'],xo=['title','onClick'],wo=['title','onClick'],yo={key:1},ko=['onClick'],Co={class:'acu-dash-list-text'},No=['title','onClick'],Vo=['title','onClick'],Eo=['title','onClick'],Bo=['title','onClick'],To={key:1},So={class:'acu-dash-list'},Do=['onClick'],Ao={class:'acu-dash-list-text'},zo=['title','onClick'],Io=['title','onClick'],_o=['title','onClick'],Mo=['title','onClick'],Uo={key:1},Po={class:'acu-dash-empty'},$o=(0,m.defineComponent)({__name:'DashboardWidget',props:{config:{},tableData:{},isEditing:{type:Boolean},diffMap:{},aiDiffMap:{},searchTerm:{},allTables:{}},emits:['navigate','row-click','row-edit','action','remove','resize','config-actions','drag-start','drag-end','drop'],setup(e,{emit:t}){const a=(0,k.j_)(),o=(0,Ht.A)(),{setInput:n}=Ee(),{performDivination:r}=Rt();(0,m.onMounted)(async()=>{await o.loadLibrary()});const i=e,l=(0,m.ref)(!1);let c=!1;const s=(0,m.ref)(1/0),d=(0,m.ref)(new Set);(0,m.watch)(()=>i.isEditing,e=>{e?(c=l.value,l.value=!0):l.value=c},{immediate:!0});const u=t,p=((0,m.computed)(()=>i.tableData?.rows.length??0),(0,m.computed)(()=>U.value.length)),f=(0,m.computed)(()=>i.tableData?.name?i.tableData.name:i.config.title),g=(0,m.computed)(()=>{if(i.config.icon&&'fa-table'!==i.config.icon)return i.config.icon;const e=i.tableData?.name||i.config.title;if(e){return(0,k.Sj)(e).replace('fas ','')}return'fa-table'}),v=(0,m.computed)(()=>i.tableData?i.tableData.headers.find(e=>e.includes('层级'))??null:null),b=(0,m.computed)(()=>!!v.value);function h(e){const t=ee(e);if(!v.value)return t;const a=e.cells.find(e=>e.key===v.value),o=a?.value?String(a.value).trim():'';if(!o)return t;return(o.split('/').pop()??'')===t?o:o+'/'+t}function x(e){const t=h(e);return t?(t.match(/\//g)||[]).length+1:1}function w(e){if(!i.tableData||!b.value)return!1;const t=h(e);return i.tableData.rows.some(a=>{if(a.key===e.key)return!1;return h(a).startsWith(t+'/')})}function y(e){const t=function(e){const t=h(e),a=t.lastIndexOf('/');return a>0?t.substring(0,a):''}(e);if(!t)return!1;const a=t.split('/');let o='';for(const e of a)if(o=o?o+'/'+e:e,d.value.has(o))return!0;return!1}function C(e){const t=h(e);d.value.has(t)?d.value.delete(t):d.value.add(t),d.value=new Set(d.value)}function N(e){const t=h(e);return!d.value.has(t)}const V=(0,m.computed)(()=>{if(!b.value||!i.tableData)return 1;let e=1;for(const t of i.tableData.rows){const a=x(t);a>e&&(e=a)}return e}),E=(0,m.computed)(()=>s.value>=V.value);function B(){s.value>1&&(s.value===1/0||s.value>V.value?s.value=V.value-1:s.value--)}function T(){if(E.value){if(s.value=1,i.tableData){const e=new Set;for(const t of i.tableData.rows)w(t)&&e.add(h(t));d.value=e}}else s.value=1/0,d.value=new Set}const S=(0,m.computed)(()=>s.value>1),D=(0,m.computed)(()=>b.value&&S.value),A=(0,m.computed)(()=>b.value&&V.value>1);function I(e){if(!i.tableData||!i.aiDiffMap)return!1;const t=i.tableData.name,a=`${t}-row-${e.index}`;if(i.aiDiffMap.has(a))return!0;for(let a=0;a<e.cells.length;a++){const o=`${t}-${e.index}-${a}`;if(i.aiDiffMap.has(o))return!0}return!1}const M=(0,m.computed)(()=>!(!i.tableData||!i.aiDiffMap)&&i.tableData.rows.some(e=>I(e)));const U=(0,m.computed)(()=>{if(!i.tableData)return[];let e=[...i.tableData.rows];return i.searchTerm&&(e=e.filter(e=>function(e){if(!i.searchTerm)return!1;const t=i.searchTerm.toLowerCase().trim();return!!t&&e.cells.some(e=>String(e.value).toLowerCase().includes(t))}(e))),b.value&&s.value!==1/0&&(e=e.filter(e=>x(e)<=s.value)),b.value&&d.value.size>0&&(e=e.filter(e=>!y(e))),b.value?(e=function(e){const t=new Map;for(const a of e)t.set(h(a),a.index);return[...e].sort((e,a)=>{const o=h(e),n=h(a);if(o===n)return e.index-a.index;if(n.startsWith(o+'/'))return-1;if(o.startsWith(n+'/'))return 1;const r=o.split('/'),i=n.split('/');let l=0;for(let e=0;e<Math.min(r.length,i.length)&&r[e]===i[e];e++)l=e+1;const c=r.slice(0,l+1).join('/'),s=i.slice(0,l+1).join('/'),d=t.get(c),u=t.get(s);return void 0!==d&&void 0!==u?d-u:c.localeCompare(s)})}(e),e):e.sort((e,t)=>{const a=I(e),o=I(t);return a!==o?o?1:-1:e.index-t.index})}),P=(0,m.computed)(()=>U.value.length>30),{list:L,containerProps:F,wrapperProps:j}=(O=U,(0,Be.niW)(O,{itemHeight:32,overscan:5}));var O;const{list:R,containerProps:H,wrapperProps:W}=function(e,t=3){const a=(0,m.computed)(()=>function(e,t){const a=[];for(let o=0;o<e.length;o+=t)a.push(e.slice(o,o+t));return a}(e.value,t));return{...(0,Be.niW)(a,{itemHeight:48,overscan:5}),rowGroups:a}}(U),Y=(0,m.computed)(()=>({'acu-dash-body-scrollable':!0})),X=(0,m.computed)(()=>{const e=i.config;return(e?.widgetTagConfig?.displayedTagIds||[]).map(e=>o.getTagById(e)).filter(e=>void 0!==e)}),G=(0,m.computed)(()=>{const e=i.config;return(e?.widgetTagConfig?.displayedCategoryIds||[]).map(e=>o.getCategoryById(e)).filter(e=>void 0!==e)});function q(e){const t=e.path.split('/');return t[t.length-1]}function K(e){return e.icon?e.icon:q(e)}function J(e){return e.startsWith('fa')||e.includes(' fa-')}(0,m.computed)(()=>i.config.actions.filter(e=>'goToTable'!==e));const Z=(0,m.computed)(()=>i.config.actions.filter(e=>'goToTable'!==e&&'settings'!==e));function Q(e){return ae(e).length+ne(e).length+X.value.length+G.value.length}function ee(e){const{titleColumn:t,displayColumns:a}=i.config;if(t){const a=e.cells.find(e=>e.key.toLowerCase()===t.toLowerCase()||e.key.toLowerCase().includes(t.toLowerCase()));if(a&&a.value)return String(a.value)}if(a.length>0)for(const t of a){const a=e.cells.find(e=>e.key.toLowerCase().includes(t.toLowerCase()));if(a&&a.value)return String(a.value)}const o=e.cells.find(e=>e.value&&String(e.value).trim());return o?String(o.value):`行 ${e.index+1}`}function te(e){if(!i.tableData)return!1;const t=i.tableData.name,a=`${t}-row-${e.index}`;if(i.diffMap.has(a))return!0;for(let a=0;a<e.cells.length;a++){const o=`${t}-${e.index}-${a}`;if(i.diffMap.has(o))return!0}return!1}function ae(e){const t=i.config.displayTagColumns;if(!t||0===t.length)return[];const a=[];for(const o of t){const t=e.cells.find(e=>e.key.toLowerCase()===o.toLowerCase()||e.key.toLowerCase().includes(o.toLowerCase()));if(t&&t.value){const e=String(t.value).trim();e&&a.push({column:o,value:e})}}return a}const oe=/[,，；;|/]/;function ne(e){const t=i.config.interactiveTagConfig;if(!t||0===t.sourceColumns.length)return[];const a=[],o=t.tagDefinitions||[];for(const n of t.sourceColumns){const t=e.cells.find(e=>e.key.toLowerCase()===n.toLowerCase()||e.key.toLowerCase().includes(n.toLowerCase()));if(t&&t.value){const e=String(t.value).trim();if(!e)continue;const n=e.split(oe).map(e=>e.trim()).filter(Boolean);for(const e of n){const t=o.find(t=>t.label.toLowerCase()===e.toLowerCase());if(t)a.push({tag:t,value:e,matchedDefinition:!0});else{const t={id:`dynamic_${e}`,label:e,promptTemplate:'{{value}}',isFixed:!1};a.push({tag:t,value:e,matchedDefinition:!1})}}}}return a}function re(e){if(!e.promptTemplate)return e.label;let t=e.promptTemplate;return t=t.replace(/\{\{value\}\}/gi,`[${e.label}]`),t=t.replace(/\{\{rowTitle\}\}/gi,'[行标题]'),t=t.replace(/\{\{playerName\}\}/gi,'[主角名]'),t.length>50?t.substring(0,50)+'...':t}function ie(e,t){let a=e.promptTemplate;a=a.replace(/\{\{value\}\}/gi,e.label);const o=ee(t);a=a.replace(/\{\{rowTitle\}\}/gi,o);const r=de();a=a.replace(/\{\{playerName\}\}/gi,r);const l=i.tableData?.name||i.config.title||'';a=a.replace(/\{\{tableName\}\}/gi,l),a&&n(a)}function le(e,t){const r=function(e,t){let a=e.promptTemplate;a=a.replace(/\{\{value\}\}/gi,e.label),a=t?.title?a.replace(/\{\{rowTitle\}\}/gi,t.title):a.replace(/\{\{rowTitle\}\}/gi,'');const o=de();a=a.replace(/\{\{playerName\}\}/gi,o);const n=i.tableData?.name||i.config.title||'';return a=a.replace(/\{\{tableName\}\}/gi,n),a.trim()}(e,t),l=o.getCategoryById(e.categoryId),c=!!l&&(l.path.includes('地点')||l.path.includes('Location'));e.allowPreEdit||c?a.openTagPreEditDialog({tagLabel:e.label,resolvedPrompt:r,showCompanions:c,widgetId:i.config.id}):r&&n(r)}function ce(e,t){a.openCategorySelectDialog({categoryId:e.id,rowContext:t,widgetId:i.config.id})}function se(e){if(!e.promptTemplate)return e.label;let t=e.promptTemplate;return t=t.replace(/\{\{value\}\}/gi,`[${e.label}]`),t=t.replace(/\{\{rowTitle\}\}/gi,'[行标题]'),t=t.replace(/\{\{playerName\}\}/gi,'[主角名]'),t=t.replace(/\{\{tableName\}\}/gi,'[表格名]'),t.length>50?t.substring(0,50)+'...':t}function de(){const e=window.parent||window;try{const t=e.SillyTavern?.getContext?.();if(t?.name1)return t.name1}catch(e){console.warn('[ACU] 获取主角名失败',e)}return'{{user}}'}function ue(){a.openWidgetActionsDialog({widgetId:i.config.id,currentActions:i.config.actions})}function pe(e){return jt.bT[e]?.icon??'fa-question'}function me(e){return!!jt.bT[e]?.secondaryIcon}function fe(e){return jt.bT[e]?.secondaryIcon??''}function ge(e){return jt.bT[e]?.tooltip??e}function ve(e){if('settings'===e){const e=i.tableData?.headers??[];return void a.openWidgetSettingsDialog({widgetId:i.config.id,widgetConfig:i.config,tableHeaders:e})}'nativeEdit'!==e?'divination'!==e?u('action',e,i.config.tableId||''):r():function(e){try{const t=(window.parent||window).AutoCardUpdaterAPI;e&&t?.openTableEditor?t.openTableEditor(e):t?.openVisualizer?(t.openVisualizer(),console.info('[ACU] 已打开原生编辑器'),a.isCollapsed=!0):t?.openModal?t.openModal():console.warn('[ACU] 无法打开原生编辑器：API 不可用')}catch(e){console.error('[ACU] 打开原生编辑器失败',e)}}(i.config.tableId)}function be(){i.config.tableId&&u('navigate',i.config.tableId)}function he(e){u('navigate',e)}function xe(){!i.isEditing&&i.config.tableId&&u('navigate',i.config.tableId)}function we(){i.isEditing||(l.value=!l.value)}function ye(e){i.config.tableId&&u('row-edit',i.config.tableId,e)}function ke(e){e.preventDefault();const t=1===i.config.colSpan?2:1;u('resize',i.config.id,t)}function Ce(e){i.isEditing?(e.dataTransfer?.setData('text/plain',i.config.id),u('drag-start',i.config.id)):e.preventDefault()}function Ne(){u('drag-end')}function Ve(e){e.preventDefault(),u('drop',i.config.id)}return(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{class:(0,m.normalizeClass)(['acu-dash-widget',{'acu-dash-widget-wide':2===e.config.colSpan,'acu-dash-widget-editing':e.isEditing,'acu-highlight-ai-table':M.value&&!e.searchTerm}]),draggable:e.isEditing,onDragstart:Ce,onDragend:Ne,onDragover:a[2]||(a[2]=(0,m.withModifiers)(()=>{},['prevent'])),onDrop:Ve},[(0,m.createCommentVNode)(' 编辑控件 (仅编辑态显示) '),e.isEditing?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[(0,m.createElementVNode)('button',{class:'acu-widget-remove',title:'移除组件',onClick:a[0]||(a[0]=(0,m.withModifiers)(t=>u('remove',e.config.id),['stop']))},[...a[3]||(a[3]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])]),(0,m.createElementVNode)('button',{class:'acu-widget-config',title:'配置快捷按钮',onClick:(0,m.withModifiers)(ue,['stop'])},[...a[4]||(a[4]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])]),(0,m.createElementVNode)('div',{class:'acu-widget-resize',title:'拖动改变大小',onMousedown:(0,m.withModifiers)(ke,['stop']),onTouchstart:(0,m.withModifiers)(ke,['stop'])},[...a[5]||(a[5]=[(0,m.createElementVNode)('i',{class:'fas fa-expand-alt'},null,-1)])],32)],64)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 头部 - 点击标题跳转，点击其他区域折叠/展开 '),(0,m.createCommentVNode)(' 全局状态组件在展示态隐藏表头 '),'global'!==e.config.displayStyle||e.isEditing?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:1,class:(0,m.normalizeClass)(['acu-dash-title',{'acu-dash-title-clickable':!e.isEditing}]),style:{'font-size':'1.2em !important'},onClick:we},[(0,m.createElementVNode)('span',{class:'acu-dash-title-text',onClick:(0,m.withModifiers)(xe,['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',g.value])},null,2),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(f.value)+' ',1),p.value>0?((0,m.openBlock)(),(0,m.createElementBlock)('span',oo,(0,m.toDisplayString)(p.value),1)):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 按钮区（包含折叠指示器） '),(0,m.createElementVNode)('div',no,[(0,m.createCommentVNode)(' 返回按钮（层级模式，非第1层时显示） '),D.value?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-icon-btn',title:'返回上一层级',onClick:(0,m.withModifiers)(B,['stop'])},[...a[6]||(a[6]=[(0,m.createElementVNode)('i',{class:'fas fa-arrow-left'},null,-1)])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 展开/收起按钮（层级模式下显示） '),A.value?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:1,class:'acu-icon-btn',title:E.value?'收起到第一层':'展开全部层级',onClick:(0,m.withModifiers)(T,['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',E.value?'fa-compress-alt':'fa-expand-alt'])},null,2)],8,ro)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 设置按钮常驻 (updateStatus 类型不显示) '),'updateStatus'!==e.config.type?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:2,class:'acu-icon-btn',title:ge('settings'),onClick:a[1]||(a[1]=(0,m.withModifiers)(e=>ve('settings'),['stop']))},[...a[7]||(a[7]=[(0,m.createElementVNode)('i',{class:'fas fa-cog'},null,-1)])],8,io)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 其他配置的快捷按钮 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(Z.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:e,class:(0,m.normalizeClass)(['acu-icon-btn',{'acu-dual-icon':me(e)}]),title:ge(e),onClick:(0,m.withModifiers)(t=>ve(e),['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',pe(e)])},null,2),me(e)?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(['fas icon-secondary',fe(e)])},null,2)):(0,m.createCommentVNode)('v-if',!0)],10,lo))),128)),(0,m.createCommentVNode)(' 折叠指示器放在按钮区最右边 '),(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas acu-dash-collapse-icon',l.value?'fa-chevron-down':'fa-chevron-up'])},null,2)])],2)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 内容区 (可滚动, 可折叠) '),(0,m.withDirectives)((0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-dash-body',Y.value])},[(0,m.createCommentVNode)(' 特殊组件: 表格更新状态 '),'updateStatus'===e.config.type?((0,m.openBlock)(),(0,m.createBlock)(to,{key:0,onTableClick:he})):'optionsPanel'===e.config.type?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 特殊组件: 选项聚合面板 '),(0,m.createVNode)(Qt,{tables:e.allTables??[],onNavigate:be},null,8,['tables'])],64)):'global'===e.config.displayStyle?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:2},[(0,m.createCommentVNode)(' 全局状态组件 (无表头，沉浸式) '),(0,m.createVNode)(Da,{'table-data':e.tableData,'is-editing':e.isEditing,onRowClick:ye},null,8,['table-data','is-editing'])],64)):e.tableData&&U.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:3},[(0,m.createCommentVNode)(' 普通表格组件 '),(0,m.createCommentVNode)(' ============================================================ '),(0,m.createCommentVNode)(' 网格式展示 (NPC风格) - 虚拟滚动版 '),(0,m.createCommentVNode)(' ============================================================ '),'grid'===e.config.displayStyle?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[(0,m.createCommentVNode)(' 虚拟滚动模式 '),P.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',(0,m.mergeProps)({key:0},(0,m.unref)(H),{class:'acu-dash-virtual-container'}),[(0,m.createElementVNode)('div',(0,m.normalizeProps)((0,m.guardReactiveProps)((0,m.unref)(W))),[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)((0,m.unref)(R),({data:t,index:a})=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:a,class:'acu-dash-npc-grid'},[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(t,t=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t.key,class:(0,m.normalizeClass)(['acu-dash-npc-item acu-dash-interactive',{'acu-highlight-changed':te(t),'acu-highlight-ai':I(t)&&!e.searchTerm}]),onClick:(0,m.withModifiers)(e=>ye(t),['stop'])},[(0,m.createElementVNode)('span',so,(0,m.toDisplayString)(ee(t)),1),(0,m.createCommentVNode)(' 展示标签 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(ae(t),e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.column,class:'acu-dash-display-tag'},(0,m.toDisplayString)(e.value),1))),128)),(0,m.createCommentVNode)(' 互动标签（旧系统） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(ne(t),e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.tag.id,class:(0,m.normalizeClass)(['acu-dash-interactive-tag',{fixed:e.tag.isFixed}]),title:re(e.tag),onClick:(0,m.withModifiers)(a=>ie(e.tag,t),['stop'])},(0,m.toDisplayString)(e.value),11,uo))),128)),(0,m.createCommentVNode)(' 互动标签（新系统 - 从全局标签库） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(X.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.id,class:'acu-dash-category-btn',title:se(e),onClick:(0,m.withModifiers)(a=>le(e,{title:ee(t),value:ee(t)}),['stop'])},(0,m.toDisplayString)(e.label),9,po))),128)),(0,m.createCommentVNode)(' 分类按钮 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(G.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.id,class:'acu-dash-category-btn',title:`点击选择 ${q(e)} 下的标签`,onClick:(0,m.withModifiers)(a=>ce(e,{title:ee(t),value:ee(t)}),['stop'])},[J(K(e))?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(K(e))},null,2)):((0,m.openBlock)(),(0,m.createElementBlock)('span',fo,(0,m.toDisplayString)(K(e)),1))],8,mo))),128))],10,co))),128))]))),128))],16)],16)):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 普通模式（数据量小时不使用虚拟滚动） '),(0,m.createElementVNode)('div',go,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(U.value,t=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t.key,class:(0,m.normalizeClass)(['acu-dash-npc-item acu-dash-interactive',{'acu-highlight-changed':te(t),'acu-highlight-ai':I(t)&&!e.searchTerm}]),onClick:(0,m.withModifiers)(e=>ye(t),['stop'])},[(0,m.createElementVNode)('span',bo,(0,m.toDisplayString)(ee(t)),1),(0,m.createCommentVNode)(' 展示标签 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(ae(t),e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.column,class:'acu-dash-display-tag'},(0,m.toDisplayString)(e.value),1))),128)),(0,m.createCommentVNode)(' 互动标签（旧系统） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(ne(t),e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.tag.id,class:(0,m.normalizeClass)(['acu-dash-interactive-tag',{fixed:e.tag.isFixed}]),title:re(e.tag),onClick:(0,m.withModifiers)(a=>ie(e.tag,t),['stop'])},(0,m.toDisplayString)(e.value),11,ho))),128)),(0,m.createCommentVNode)(' 互动标签（新系统 - 从全局标签库） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(X.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.id,class:'acu-dash-category-btn',title:se(e),onClick:(0,m.withModifiers)(a=>le(e,{title:ee(t),value:ee(t)}),['stop'])},(0,m.toDisplayString)(e.label),9,xo))),128)),(0,m.createCommentVNode)(' 分类按钮 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(G.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.id,class:'acu-dash-category-btn',title:`点击选择 ${q(e)} 下的标签`,onClick:(0,m.withModifiers)(a=>ce(e,{title:ee(t),value:ee(t)}),['stop'])},[J(K(e))?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(K(e))},null,2)):((0,m.openBlock)(),(0,m.createElementBlock)('span',yo,(0,m.toDisplayString)(K(e)),1))],8,wo))),128))],10,vo))),128))])],2112))],64)):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' ============================================================ '),(0,m.createCommentVNode)(' 列表式展示 (任务风格) - 虚拟滚动版 '),(0,m.createCommentVNode)(' ============================================================ '),(0,m.createCommentVNode)(' 虚拟滚动模式 '),P.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',(0,m.mergeProps)({key:0},(0,m.unref)(F),{class:'acu-dash-virtual-container'}),[(0,m.createElementVNode)('div',(0,m.mergeProps)((0,m.unref)(j),{class:'acu-dash-list'}),[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)((0,m.unref)(L),({data:t})=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t.key,class:(0,m.normalizeClass)(['acu-dash-list-item acu-dash-interactive',{'acu-highlight-changed':te(t),'acu-highlight-ai':I(t)&&!e.searchTerm,'acu-multi-tags':Q(t)>1}]),style:(0,m.normalizeStyle)({minHeight:(0,m.unref)(32)+'px'}),onClick:(0,m.withModifiers)(e=>ye(t),['stop'])},[a[8]||(a[8]=(0,m.createElementVNode)('i',{class:'fas fa-circle',style:{'font-size':'6px'}},null,-1)),(0,m.createElementVNode)('span',Co,(0,m.toDisplayString)(ee(t)),1),(0,m.createCommentVNode)(' 层级折叠按钮（有子层级时显示） '),b.value&&w(t)?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-icon-btn acu-dash-row-collapse-btn',title:N(t)?'收起子层级':'展开子层级',onClick:(0,m.withModifiers)(e=>C(t),['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',N(t)?'fa-chevron-down':'fa-chevron-right'])},null,2)],8,No)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 展示标签 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(ae(t),e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.column,class:'acu-dash-display-tag'},(0,m.toDisplayString)(e.value),1))),128)),(0,m.createCommentVNode)(' 互动标签（旧系统） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(ne(t),e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.tag.id,class:(0,m.normalizeClass)(['acu-dash-interactive-tag',{fixed:e.tag.isFixed}]),title:re(e.tag),onClick:(0,m.withModifiers)(a=>ie(e.tag,t),['stop'])},(0,m.toDisplayString)(e.value),11,Vo))),128)),(0,m.createCommentVNode)(' 互动标签（新系统 - 从全局标签库） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(X.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.id,class:'acu-dash-category-btn',title:se(e),onClick:(0,m.withModifiers)(a=>le(e,{title:ee(t),value:ee(t)}),['stop'])},(0,m.toDisplayString)(e.label),9,Eo))),128)),(0,m.createCommentVNode)(' 分类按钮 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(G.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.id,class:'acu-dash-category-btn',title:`点击选择 ${q(e)} 下的标签`,onClick:(0,m.withModifiers)(a=>ce(e,{title:ee(t),value:ee(t)}),['stop'])},[J(K(e))?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(K(e))},null,2)):((0,m.openBlock)(),(0,m.createElementBlock)('span',To,(0,m.toDisplayString)(K(e)),1))],8,Bo))),128))],14,ko))),128))],16)],16)):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 普通模式（数据量小时不使用虚拟滚动） '),(0,m.createElementVNode)('div',So,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(U.value,t=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t.key,class:(0,m.normalizeClass)(['acu-dash-list-item acu-dash-interactive',{'acu-highlight-changed':te(t),'acu-highlight-ai':I(t)&&!e.searchTerm,'acu-multi-tags':Q(t)>1}]),onClick:(0,m.withModifiers)(e=>ye(t),['stop'])},[a[9]||(a[9]=(0,m.createElementVNode)('i',{class:'fas fa-circle',style:{'font-size':'6px'}},null,-1)),(0,m.createElementVNode)('span',Ao,(0,m.toDisplayString)(ee(t)),1),(0,m.createCommentVNode)(' 层级折叠按钮（有子层级时显示） '),b.value&&w(t)?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-icon-btn acu-dash-row-collapse-btn',title:N(t)?'收起子层级':'展开子层级',onClick:(0,m.withModifiers)(e=>C(t),['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',N(t)?'fa-chevron-down':'fa-chevron-right'])},null,2)],8,zo)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 展示标签 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(ae(t),e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.column,class:'acu-dash-display-tag'},(0,m.toDisplayString)(e.value),1))),128)),(0,m.createCommentVNode)(' 互动标签（旧系统） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(ne(t),e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.tag.id,class:(0,m.normalizeClass)(['acu-dash-interactive-tag',{fixed:e.tag.isFixed}]),title:re(e.tag),onClick:(0,m.withModifiers)(a=>ie(e.tag,t),['stop'])},(0,m.toDisplayString)(e.value),11,Io))),128)),(0,m.createCommentVNode)(' 互动标签（新系统 - 从全局标签库） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(X.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.id,class:'acu-dash-category-btn',title:se(e),onClick:(0,m.withModifiers)(a=>le(e,{title:ee(t),value:ee(t)}),['stop'])},(0,m.toDisplayString)(e.label),9,_o))),128)),(0,m.createCommentVNode)(' 分类按钮 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(G.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.id,class:'acu-dash-category-btn',title:`点击选择 ${q(e)} 下的标签`,onClick:(0,m.withModifiers)(a=>ce(e,{title:ee(t),value:ee(t)}),['stop'])},[J(K(e))?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(K(e))},null,2)):((0,m.openBlock)(),(0,m.createElementBlock)('span',Uo,(0,m.toDisplayString)(K(e)),1))],8,Mo))),128))],10,Do))),128))])],2112))],64))],64)):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:4},[(0,m.createCommentVNode)(' 空状态 '),(0,m.createElementVNode)('div',Po,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',e.config.icon])},null,2),a[10]||(a[10]=(0,m.createElementVNode)('span',null,'暂无数据',-1))])],2112))],2),[[m.vShow,!l.value]])],42,ao))}});function Lo(){const e=(0,Ht.A)(),t=(0,f.JH)(),{success:a}=(0,O.d)();function o(t){try{if(!t||t.length<5)return!1;const a=String(t[1]||'').trim(),o=String(t[2]||'').trim(),n=String(t[3]||'').trim(),r=String(t[4]||'').trim(),i=t[5]?String(t[5]).trim():'';if(!o||!r)return!1;let l=i||r;const c=function(){const e=window.parent||window;try{const t=e.SillyTavern?.getContext?.();if(t?.name1)return t.name1}catch(e){console.warn('[InteractionImporter] 获取主角名失败',e)}return''}();c&&(l=l.split(c).join('{{user}}')),a&&(l=l.split(a).join('{{rowTitle}}'));const s=l,d=function(t){if(!t)return'';const a=e.getCategoryByPath(t);if(a)return a.id;const o=1===t.split('/').length?'fa-star':void 0;return e.addCategory(t,o).id}(n),u=e.library.tags.find(e=>e.label===o&&e.categoryId===d);return u?e.upsertTag({...u,promptTemplate:s}):e.createTag(o,d,s),!0}catch(e){return console.error('[InteractionImporter] Import row failed:',e),!1}}return{importFromRow:o,importAll:function(e,n=!1){if(n&&!t.config.autoImportInteractions)return 0;let r=0;return e&&Array.isArray(e)?(e.forEach(e=>{o(e)&&r++}),r>0&&a(`成功导入 ${r} 个交互动作`),r):0}}}const Fo=['draggable'],jo={key:0,class:'acu-dash-count'},Oo={key:0,class:'acu-dash-actions'},Ro=['title'],Ho=['title','onClick'],Wo={class:'acu-dash-body acu-dash-body-scrollable'},Yo={key:0,class:'acu-interaction-list'},Xo=['onClick'],Go={class:'acu-interaction-header'},qo={class:'acu-interaction-target'},Ko={class:'acu-interaction-actions'},Jo=['onClick'],Zo=['title','disabled','onClick'],Qo={class:'acu-interaction-meta'},en={class:'acu-badge acu-badge-primary'},tn={class:'acu-badge acu-badge-secondary'},an={key:0,class:'acu-badge acu-badge-secondary'},on={class:'acu-interaction-text'},nn={class:'acu-dash-empty'},rn=(0,m.defineComponent)({__name:'InteractionTableWidget',props:{config:{},tableData:{},isEditing:{type:Boolean},diffMap:{},aiDiffMap:{},searchTerm:{}},emits:['navigate','row-edit','action','remove','resize','drag-start','drag-end','drop'],setup(e,{emit:t}){const{setInput:a}=Ee(),{importFromRow:o,importAll:n}=Lo(),{success:r,error:i}=(0,O.d)(),l=(0,k.j_)(),c=e,s=t,d=(0,m.ref)(!1),u=(0,m.ref)(new Set),p=((0,m.computed)(()=>c.tableData?.rows.length??0),(0,m.computed)(()=>h.value.length)),f=(0,m.computed)(()=>c.tableData?.name||c.config.title),g=(0,m.computed)(()=>(c.config.actions||[]).filter(e=>'settings'!==e&&'goToTable'!==e)),v=(0,m.computed)(()=>{if(c.config.icon&&'fa-table'!==c.config.icon)return c.config.icon;const e=c.tableData?.name||c.config.title;if(e){return(0,k.Sj)(e).replace('fas ','')}return'fa-table'}),b=(0,m.computed)(()=>!(!c.tableData||!c.aiDiffMap)&&c.tableData.rows.some(e=>E(e))),h=(0,m.computed)(()=>{if(!c.tableData)return[];let e=[...c.tableData.rows];if(c.searchTerm){const t=c.searchTerm.toLowerCase().trim();e=e.filter(e=>e.cells.some(e=>String(e.value).toLowerCase().includes(t)))}return e});function x(e){return jt.bT[e]?.tooltip||''}function w(e){return jt.bT[e]?.icon??'fa-question'}function y(e){return!!jt.bT[e]?.secondaryIcon}function C(e){return jt.bT[e]?.secondaryIcon??''}function N(e,t){const a=e.cells.find(e=>e.key===t);return a?String(a.value):''}function V(e){if(!c.tableData)return!1;const t=`${c.tableData.name}-row-${e.index}`;return c.diffMap.has(t)}function E(e){if(!c.tableData||!c.aiDiffMap)return!1;const t=`${c.tableData.name}-row-${e.index}`;return c.aiDiffMap.has(t)}function B(e){return u.value.has(e.key)}function T(e){c.isEditing||e.target.closest('.acu-dash-actions')||(d.value=!d.value)}function S(){c.isEditing||c.config.tableId&&s('navigate',c.config.tableId)}function D(e){if('settings'===e){const e=c.tableData?.headers??[];return void l.openWidgetSettingsDialog({widgetId:c.config.id,widgetConfig:c.config,tableHeaders:e})}c.config.tableId&&s('action',e,c.config.tableId)}function A(){s('drag-start',c.config.id)}function I(){s('drag-end')}function M(){s('drop',c.config.id)}function U(){l.openWidgetActionsDialog({widgetId:c.config.id,currentActions:c.config.actions})}function P(e){e.preventDefault();const t=1===c.config.colSpan?2:1;s('resize',c.config.id,t)}function L(){if(!c.tableData)return;const e=c.tableData.rows.map(e=>[null,N(e,'交互对象'),N(e,'交互名称'),N(e,'交互类型'),N(e,'交互内容'),N(e,'交互简介')]);n(e)>0&&c.tableData.rows.forEach(e=>u.value.add(e.key))}(0,m.watch)(()=>c.aiDiffMap,e=>{if(!e||!c.tableData)return;if(c.tableData.rows.some(t=>{const a=`${c.tableData.name}-row-${t.index}`;return e.has(a)})){const e=c.tableData.rows.map(e=>[null,N(e,'交互对象'),N(e,'交互名称'),N(e,'交互类型'),N(e,'交互内容'),N(e,'交互简介')]);n(e,!0)>0&&c.tableData.rows.forEach(e=>u.value.add(e.key))}},{deep:!0});let F=!1;return(0,m.watch)(()=>c.isEditing,e=>{e?(F=d.value,d.value=!0):d.value=F},{immediate:!0}),(t,n)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{class:(0,m.normalizeClass)(['acu-dash-widget',{'acu-dash-widget-wide':2===e.config.colSpan,'acu-dash-widget-editing':e.isEditing,'acu-highlight-ai-table':b.value&&!e.searchTerm}]),draggable:e.isEditing,onDragstart:A,onDragend:I,onDragover:n[2]||(n[2]=(0,m.withModifiers)(()=>{},['prevent'])),onDrop:M},[(0,m.createCommentVNode)(' 编辑控件 (仅编辑态显示) '),e.isEditing?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[(0,m.createElementVNode)('button',{class:'acu-widget-remove',title:'移除组件',onClick:n[0]||(n[0]=(0,m.withModifiers)(t=>s('remove',e.config.id),['stop']))},[...n[3]||(n[3]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])]),(0,m.createElementVNode)('button',{class:'acu-widget-config',title:'配置快捷按钮',onClick:(0,m.withModifiers)(U,['stop'])},[...n[4]||(n[4]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])]),(0,m.createElementVNode)('div',{class:'acu-widget-resize',title:'拖动改变大小',onMousedown:(0,m.withModifiers)(P,['stop']),onTouchstart:(0,m.withModifiers)(P,['stop'])},[...n[5]||(n[5]=[(0,m.createElementVNode)('i',{class:'fas fa-expand-alt'},null,-1)])],32)],64)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-dash-title',{'acu-dash-title-clickable':!e.isEditing}]),onClick:T},[(0,m.createElementVNode)('span',{class:'acu-dash-title-text',onClick:(0,m.withModifiers)(S,['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',v.value])},null,2),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(f.value)+' ',1),p.value>0?((0,m.openBlock)(),(0,m.createElementBlock)('span',jo,(0,m.toDisplayString)(p.value),1)):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 按钮区 '),e.isEditing?(0,m.createCommentVNode)('v-if',!0):((0,m.openBlock)(),(0,m.createElementBlock)('div',Oo,[(0,m.createCommentVNode)(' 全部存入按钮 '),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:'将所有交互存入标签库',onClick:(0,m.withModifiers)(L,['stop'])},[...n[6]||(n[6]=[(0,m.createElementVNode)('i',{class:'fas fa-save'},null,-1)])]),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:x('settings'),onClick:n[1]||(n[1]=(0,m.withModifiers)(e=>D('settings'),['stop']))},[...n[7]||(n[7]=[(0,m.createElementVNode)('i',{class:'fas fa-cog'},null,-1)])],8,Ro),(0,m.createCommentVNode)(' 自定义快捷按钮 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(g.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:e,class:(0,m.normalizeClass)(['acu-icon-btn',{'acu-dual-icon':y(e)}]),title:x(e),onClick:(0,m.withModifiers)(t=>D(e),['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',w(e)])},null,2),y(e)?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(['fas icon-secondary',C(e)])},null,2)):(0,m.createCommentVNode)('v-if',!0)],10,Ho))),128)),(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas acu-dash-collapse-icon',d.value?'fa-chevron-down':'fa-chevron-up'])},null,2)]))],2),(0,m.createCommentVNode)(' 内容区 '),(0,m.withDirectives)((0,m.createElementVNode)('div',Wo,[h.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',Yo,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(h.value,t=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t.key,class:(0,m.normalizeClass)(['acu-interaction-item',{'acu-highlight-changed':V(t),'acu-highlight-ai':E(t)&&!e.searchTerm}]),onClick:e=>function(e){c.isEditing||c.config.tableId&&s('row-edit',c.config.tableId,e)}(t)},[(0,m.createCommentVNode)(' 第一行：交互对象 + 按钮 '),(0,m.createElementVNode)('div',Go,[(0,m.createElementVNode)('span',qo,(0,m.toDisplayString)(N(t,'交互对象')),1),(0,m.createElementVNode)('div',Ko,[(0,m.createCommentVNode)(' 追加到输入框 '),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:'追加到输入框',onClick:(0,m.withModifiers)(e=>async function(e){const t=N(e,'交互内容');t&&(a(t),r('已追加到输入框'))}(t),['stop'])},[...n[8]||(n[8]=[(0,m.createElementVNode)('i',{class:'fas fa-reply'},null,-1)])],8,Jo),(0,m.createCommentVNode)(' 单条存入 '),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-icon-btn',{'acu-btn-success':B(t)}]),title:B(t)?'已存入':'存入标签库',disabled:B(t),onClick:(0,m.withModifiers)(e=>function(e){const t=N(e,'交互对象'),a=N(e,'交互名称'),n=N(e,'交互类型'),l=N(e,'交互内容'),c=N(e,'交互简介');o([null,t,a,n,l,c])?(u.value.add(e.key),r('已存入标签库')):i('存入失败，数据不完整')}(t),['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',B(t)?'fa-check':'fa-download'])},null,2)],10,Zo)])]),(0,m.createCommentVNode)(' 第二行：Badge '),(0,m.createElementVNode)('div',Qo,[(0,m.createElementVNode)('span',en,(0,m.toDisplayString)(N(t,'交互名称')),1),(0,m.createElementVNode)('span',tn,(0,m.toDisplayString)(N(t,'交互类型')),1),N(t,'交互简介')?((0,m.openBlock)(),(0,m.createElementBlock)('span',an,(0,m.toDisplayString)(N(t,'交互简介')),1)):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 第三行：内容 '),(0,m.createElementVNode)('div',on,(0,m.toDisplayString)(N(t,'交互内容')),1)],10,Xo))),128))])):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 空状态 '),(0,m.createElementVNode)('div',nn,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',e.config.icon])},null,2),n[9]||(n[9]=(0,m.createElementVNode)('span',null,'暂无交互数据',-1))])],2112))],512),[[m.vShow,!d.value]])],42,Fo))}});u(3245);const ln=rn,cn=['draggable'],sn={class:'acu-dash-title-text'},dn={key:0,class:'acu-dash-count'},un={class:'acu-dash-actions'},pn=['title'],mn=['title','onClick'],fn={class:'acu-dash-body rwp-body'},gn={key:0,class:'acu-dash-empty'},vn=['onClick'],bn={class:'rwp-header-left'},hn={class:'rwp-column-name'},xn={class:'rwp-word-count'},wn={class:'rwp-limit-wrapper'},yn=['onClick'],kn={class:'popover-body'},Cn={class:'limit-control'},Nn=['value','onInput'],Vn={class:'limit-value'},En={class:'popover-actions'},Bn=['onClick'],Tn={class:'acu-switch small'},Sn=['checked','onChange'],Dn={class:'rwp-group-content'},An={key:0,class:'rwp-empty-hint'},zn=(0,m.defineComponent)({__name:'RandomWordPoolWidget',props:{isEditing:{type:Boolean},widgetId:{default:'random-word-pool'},colSpan:{default:1},config:{default:()=>({})}},emits:['remove','resize','action','drag-start','drag-end','drop'],setup(e,{emit:t}){const a=e,o=t,n=(0,Ot.E)(),r=(0,k.j_)(),i=(0,y.D)(),l=(0,m.ref)(!1),c=(0,m.ref)(!1),s=(0,m.reactive)({}),d=(0,m.ref)(null),u=(0,m.ref)([]),p=(0,m.computed)(()=>u.value.length),f=(0,m.computed)(()=>(a.config?.actions||[]).filter(e=>'settings'!==e)),g=(0,m.computed)(()=>0!==u.value.length&&u.value.every(e=>s[e.id]));function v(){const e=(0,Pe.dK)(),t=[];for(const a of e){const e=(0,Pe.o9)(a);if(e.length<=1)continue;const o=e[e.length-1],n=[];if(Array.isArray(o))for(const e of o)if(e&&'string'==typeof e){const t=e.trim();t&&n.push(t)}t.push({id:a,name:(0,Pe._V)(a),words:n})}u.value=t;for(const e of u.value)void 0===s[e.id]&&(s[e.id]=!1);console.info(`[RandomWordPoolWidget] 加载了 ${u.value.length} 个表数据`)}function b(e){const t=n.config.tablePoolConfig[e];return!t||t.enabled}function h(e){return n.config.tablePoolConfig[e]?.limit||0}function x(e){const t=h(e);return t>0?`限 ${t}`:'不限'}function w(e,t){const a=n.config.tablePoolConfig[e]||{enabled:!0,limit:0};n.config.tablePoolConfig[e]={...a,limit:t}}function C(){d.value=null}function N(){const e=!g.value;for(const t of u.value)s[t.id]=e}function V(){a.isEditing||(l.value=!l.value)}function E(){r.openDivinationSettingsDialog()}function B(e){return jt.bT[e]?.icon??'fa-question'}function T(e){return!!jt.bT[e]?.secondaryIcon}function S(e){return jt.bT[e]?.secondaryIcon??''}function D(e){return jt.bT[e]?.tooltip??e}function A(){r.openWidgetActionsDialog({widgetId:a.config.id||a.widgetId,currentActions:a.config.actions||[]})}function I(e){e.preventDefault();const t=1===a.colSpan?2:1;o('resize',a.widgetId,t)}function M(e){a.isEditing?(e.dataTransfer?.setData('text/plain',a.widgetId),o('drag-start',a.widgetId)):e.preventDefault()}function U(){o('drag-end')}function P(e){e.preventDefault(),o('drop',a.widgetId)}return(0,m.onMounted)(()=>{v(),window.addEventListener('click',C)}),(0,m.onUnmounted)(()=>{window.removeEventListener('click',C)}),(0,m.watch)(()=>n.config.tablePoolConfig,()=>{},{deep:!0}),(0,m.watch)(()=>a.isEditing,e=>{e?(c.value=l.value,l.value=!0):l.value=c.value}),(0,m.watch)(()=>i.tables,()=>{console.log('[RandomWordPoolWidget] 检测到数据变更，刷新词库...'),v()},{deep:!1}),(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{class:(0,m.normalizeClass)(['acu-dash-widget rwp-widget',{'acu-dash-widget-wide':2===e.colSpan,'acu-dash-widget-editing':e.isEditing}]),draggable:e.isEditing,onDragstart:M,onDragend:U,onDragover:a[3]||(a[3]=(0,m.withModifiers)(()=>{},['prevent'])),onDrop:P},[(0,m.createCommentVNode)(' 编辑控件 (仅编辑态显示) '),e.isEditing?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[(0,m.createElementVNode)('button',{class:'acu-widget-remove',title:'移除组件',onClick:a[0]||(a[0]=(0,m.withModifiers)(t=>o('remove',e.widgetId),['stop']))},[...a[4]||(a[4]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])]),(0,m.createElementVNode)('button',{class:'acu-widget-config',title:'配置快捷按钮',onClick:(0,m.withModifiers)(A,['stop'])},[...a[5]||(a[5]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])]),(0,m.createElementVNode)('div',{class:'acu-widget-resize',title:'点击切换单/双栏',onMousedown:(0,m.withModifiers)(I,['stop']),onTouchstart:(0,m.withModifiers)(I,['stop'])},[...a[6]||(a[6]=[(0,m.createElementVNode)('i',{class:'fas fa-expand-alt'},null,-1)])],32)],64)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',{class:'acu-dash-title rwp-header',onClick:V},[(0,m.createElementVNode)('span',sn,[a[7]||(a[7]=(0,m.createElementVNode)('i',{class:'fas fa-dice'},null,-1)),a[8]||(a[8]=(0,m.createTextVNode)(' 随机词表 ',-1)),p.value>0?((0,m.openBlock)(),(0,m.createElementBlock)('span',dn,(0,m.toDisplayString)(p.value),1)):(0,m.createCommentVNode)('v-if',!0)]),(0,m.withDirectives)((0,m.createElementVNode)('div',un,[(0,m.createCommentVNode)(' 一键展开/折叠 '),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:g.value?'全部折叠':'全部展开',onClick:(0,m.withModifiers)(N,['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',g.value?'fa-compress-alt':'fa-expand-alt'])},null,2)],8,pn),(0,m.createCommentVNode)(' 设置按钮 '),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:'抽词设置',onClick:(0,m.withModifiers)(E,['stop'])},[...a[9]||(a[9]=[(0,m.createElementVNode)('i',{class:'fas fa-cog'},null,-1)])]),(0,m.createCommentVNode)(' 自定义快捷按钮 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(f.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:e,class:(0,m.normalizeClass)(['acu-icon-btn',{'acu-dual-icon':T(e)}]),title:D(e),onClick:(0,m.withModifiers)(t=>function(e){o('action',e,'')}(e),['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',B(e)])},null,2),T(e)?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(['fas icon-secondary',S(e)])},null,2)):(0,m.createCommentVNode)('v-if',!0)],10,mn))),128)),(0,m.createCommentVNode)(' 折叠指示器 '),(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas acu-dash-collapse-icon',l.value?'fa-chevron-down':'fa-chevron-up'])},null,2)],512),[[m.vShow,!e.isEditing]])]),(0,m.createCommentVNode)(' 内容区 '),(0,m.withDirectives)((0,m.createElementVNode)('div',fn,[(0,m.createCommentVNode)(' 空状态 '),0===p.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',gn,[...a[10]||(a[10]=[(0,m.createElementVNode)('i',{class:'fas fa-dice'},null,-1),(0,m.createElementVNode)('span',null,'未检测到随机表',-1),(0,m.createElementVNode)('span',{class:'hint'},'表名需包含"随机"、"Random"等关键词',-1)])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 表分组 (V2: 按表名分组) '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(u.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:(0,m.normalizeClass)(['rwp-column-group',{collapsed:!s[e.id]}])},[(0,m.createCommentVNode)(' 表头 '),(0,m.createElementVNode)('div',{class:'rwp-group-header',onClick:t=>{return a=e.id,void(s[a]=!s[a]);var a}},[(0,m.createElementVNode)('div',bn,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',s[e.id]?'fa-chevron-down':'fa-chevron-right'])},null,2),(0,m.createElementVNode)('span',hn,(0,m.toDisplayString)(e.name),1),(0,m.createElementVNode)('span',xn,'('+(0,m.toDisplayString)(e.words.length)+')',1)]),(0,m.createElementVNode)('div',{class:'rwp-header-right',onClick:a[2]||(a[2]=(0,m.withModifiers)(()=>{},['stop']))},[(0,m.createCommentVNode)(' Limit 设置 Badge '),(0,m.createElementVNode)('div',wn,[(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-badge-pill acu-badge-interactive',d.value===e.id?'acu-badge-primary':'acu-badge-secondary']),title:'点击设置抽取数量限制',onClick:(0,m.withModifiers)(t=>{return a=e.id,void(d.value===a?d.value=null:d.value=a);var a},['stop'])},[a[11]||(a[11]=(0,m.createElementVNode)('i',{class:'fas fa-filter',style:{'margin-right':'4px','font-size':'11px'}},null,-1)),(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(x(e.id)),1)],10,yn),(0,m.createCommentVNode)(' Limit 设置 Popover '),d.value===e.id?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'rwp-limit-popover',onClick:a[1]||(a[1]=(0,m.withModifiers)(()=>{},['stop']))},[a[12]||(a[12]=(0,m.createElementVNode)('div',{class:'popover-header'},'抽取数量限制 (0=不限)',-1)),(0,m.createElementVNode)('div',kn,[(0,m.createElementVNode)('div',Cn,[(0,m.createElementVNode)('input',{type:'range',class:'acu-range-input',min:'0',max:'10',step:'1',value:h(e.id),onInput:t=>w(e.id,+t.target.value)},null,40,Nn),(0,m.createElementVNode)('span',Vn,(0,m.toDisplayString)(h(e.id)||'不限'),1)]),(0,m.createElementVNode)('div',En,[(0,m.createElementVNode)('button',{class:'acu-tool-btn small',onClick:t=>w(e.id,0)},'重置为不限',8,Bn)])])])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createElementVNode)('label',Tn,[(0,m.createElementVNode)('input',{type:'checkbox',checked:b(e.id),onChange:(0,m.withModifiers)(t=>function(e){const t=n.config.tablePoolConfig[e]||{enabled:!0,limit:0};n.config.tablePoolConfig[e]={...t,enabled:!t.enabled}}(e.id),['stop'])},null,40,Sn),a[13]||(a[13]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])])],8,vn),(0,m.createCommentVNode)(' 词列表 '),(0,m.withDirectives)((0,m.createElementVNode)('div',Dn,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.words,(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:a,class:(0,m.normalizeClass)(['rwp-word-badge',{disabled:!b(e.id)}])},(0,m.toDisplayString)(t),3))),128)),0===e.words.length?((0,m.openBlock)(),(0,m.createElementBlock)('span',An,' 暂无词条 ')):(0,m.createCommentVNode)('v-if',!0)],512),[[m.vShow,s[e.id]]])],2))),128))],512),[[m.vShow,!l.value]])],42,cn))}}),In={class:'acu-dash-container-new'},_n={class:'acu-dash-header'},Mn={class:'acu-dash-header-actions'},Un={key:0,class:'acu-dash-add-section'},Pn={key:0,class:'acu-switch-list acu-dash-add-list'},$n={class:'acu-switch-list-body'},Ln=['onClick'],Fn={class:'item-label'},jn=['onChange'],On=['onClick'],Rn={class:'item-label'},Hn=['onChange'],Wn=['onClick'],Yn={class:'item-label'},Xn=['onChange'],Gn={key:1,class:'acu-dash-empty-state'},qn=(0,m.defineComponent)({__name:'Dashboard',props:{tables:{}},emits:['navigate','rowClick','showRelationshipGraph','action','heightDragStart','heightReset'],setup(e,{emit:t}){const a=(0,O.d)(),o=e,n=t,r=(0,y.D)(),i=(0,Ft.f)(),l=(0,k.j_)(),c=(0,m.ref)(!1),s=(0,m.ref)(!1),d=(0,m.ref)(''),u=(0,m.ref)(null),p=(0,m.ref)(null),f=(0,m.ref)(null),g=(0,m.ref)(null);let v=null;const b=(0,m.computed)(()=>i.enabledWidgets),h=(0,m.computed)(()=>o.tables.filter(e=>!i.hasWidget(e.id))),x=(0,m.computed)(()=>{const e=i.config.widgets,t=[];return e.some(e=>'updateStatus'===e.type)||t.push({type:'updateStatus',name:'表格更新状态',icon:'fa-sync-alt'}),e.some(e=>'optionsPanel'===e.type)||t.push({type:'optionsPanel',name:'选项聚合面板',icon:'fa-list-check'}),e.some(e=>'randomWordPool'===e.type)||t.push({type:'randomWordPool',name:'随机词表',icon:'fa-dice'}),t}),w=(0,m.computed)(()=>r.diffMap),C=(0,m.computed)(()=>r.aiDiffMap),N=(0,m.computed)(()=>{const e=new Set;for(const t of i.enabledWidgets){if(!t.tableId)continue;const a=B(t.tableId);if(!a)continue;a.rows.some(e=>{const a=`${t.tableId}:${e.key}`;return r.aiDiffMap.has(a)})&&e.add(t.tableId)}return e});const V=(0,m.computed)(()=>{let e=[...i.enabledWidgets];return d.value?e=e.filter(e=>function(e){if(!d.value)return!0;const t=d.value.toLowerCase().trim();if(!t)return!0;if('updateStatus'===e.type||'optionsPanel'===e.type||'randomWordPool'===e.type)return!1;const a=B(e.tableId);return!!a&&(!!a.name.toLowerCase().includes(t)||a.rows.some(e=>e.cells.some(e=>String(e.value).toLowerCase().includes(t))))}(e)):e.sort((e,t)=>{const a=N.value.has(e.tableId||''),o=N.value.has(t.tableId||'');return a!==o?o?1:-1:e.order-t.order}),e}),E=(0,m.computed)(()=>o.tables);function B(e){return e?o.tables.find(t=>t.id===e)??null:null}function T(e){if('updateStatus'===e.type)return'表格更新状态';if('optionsPanel'===e.type)return'选项聚合面板';const t=o.tables.find(t=>t.id===e.tableId);return t?.name||e.title||e.tableId||'未知表格'}function S(e){const t=B(e),a=t?.name||e;for(const[t,o]of Object.entries(jt.JT))if(o.some(e=>a.toLowerCase().includes(e.toLowerCase()))){const a=i.config.widgets.find(t=>t.tableId===e);if(a?.icon)return a.icon;if('global'===t)return'fa-globe';if('task'===t)return'fa-tasks';if('item'===t)return'fa-box-open';if('character'===t)return'fa-user';if('location'===t)return'fa-map-marker-alt'}return'fa-table'}function D(){c.value=!0,a.info('拖动组件顶栏可排序')}function A(){c.value=!1,s.value=!1,u.value=null,p.value=null}function I(e){if(function(e){return i.hasWidget(e)}(e)){const t=i.findWidgetByTableId(e);t&&i.removeWidget(t.id)}else{const t=o.tables.find(t=>t.id===e);i.addWidget(e,t?.name)}}function M(e){!function(e){return i.hasSpecialWidget(e)}(e)?i.addSpecialWidget(e):i.removeSpecialWidget(e)}function U(e){i.removeWidget(e)}function P(e,t){i.updateWidget(e,{colSpan:t})}function L(e){u.value=e}function F(){u.value=null,p.value=null}function j(e){if(!u.value||u.value===e)return;const t=i.config.widgets.find(t=>t.id===e);t&&i.moveWidget(u.value,t.order),u.value=null,p.value=null}function R(e){g.value&&n('heightDragStart',e,g.value)}function H(){n('heightReset')}function W(){v&&(clearTimeout(v),v=null)}function Y(e){n('navigate',e)}function X(e,t){n('rowClick',e,t)}function G(e,t){const a=B(e);l.openRowEditDialog({tableId:e,tableName:a?.name??e,rowIndex:t.index,currentRowData:t})}function q(e,t){switch(e){case'goToTable':n('navigate',t);break;case'relationshipGraph':n('showRelationshipGraph');break;default:n('action',e,t)}}return(0,m.onMounted)(async()=>{await i.loadConfig(),0===i.config.widgets.length&&function(){for(const e of o.tables)for(const[t,a]of Object.entries(jt.JT))if(a.some(t=>e.id.toLowerCase().includes(t.toLowerCase())||e.name.includes(t))){i.addWidget(e.id,e.name,t);break}}()}),(0,m.watch)(()=>o.tables,()=>{}),(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',In,[(0,m.createCommentVNode)(' 顶栏 - 布局：标题 / (空) / 编辑按钮 / 高度拖手 / 搜索框 '),(0,m.createElementVNode)('div',_n,[(0,m.createCommentVNode)(' 左侧：标题 '),t[11]||(t[11]=(0,m.createElementVNode)('div',{class:'acu-dash-header-left'},[(0,m.createElementVNode)('span',{class:'acu-dash-header-title'},[(0,m.createElementVNode)('i',{class:'fas fa-th-large'}),(0,m.createTextVNode)(' 仪表盘 ')])],-1)),(0,m.createCommentVNode)(' 中间：弹性空间 '),t[12]||(t[12]=(0,m.createElementVNode)('div',{class:'acu-dash-header-spacer'},null,-1)),(0,m.createCommentVNode)(' 右侧：按钮区 '),(0,m.createElementVNode)('div',Mn,[(0,m.createCommentVNode)(' 编辑模式按钮组 '),c.value?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-icon-btn acu-btn-primary',title:'完成编辑',onClick:(0,m.withModifiers)(A,['stop'])},[...t[8]||(t[8]=[(0,m.createElementVNode)('i',{class:'fas fa-check'},null,-1)])])):((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:1,class:'acu-icon-btn',title:'编辑仪表盘',onClick:(0,m.withModifiers)(D,['stop'])},[...t[9]||(t[9]=[(0,m.createElementVNode)('i',{class:'fas fa-edit'},null,-1)])])),(0,m.createCommentVNode)(' 高度拖手 '),(0,m.createElementVNode)('button',{ref_key:'heightHandleRef',ref:g,class:'acu-icon-btn acu-height-handle',title:'拖动调整高度 / 双击重置',onPointerdown:R,onDblclick:H,onTouchend:(0,m.withModifiers)(W,['stop'])},[...t[10]||(t[10]=[(0,m.createElementVNode)('i',{class:'fas fa-grip-lines'},null,-1)])],544),(0,m.createCommentVNode)(' 搜索框 '),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>d.value=e),type:'text',class:'acu-search-input acu-search-inline',placeholder:'搜索...'},null,512),[[m.vModelText,d.value]]),d.value?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:2,class:'fas fa-times acu-search-clear',onClick:t[1]||(t[1]=e=>d.value='')})):(0,m.createCommentVNode)('v-if',!0)])]),(0,m.createCommentVNode)(' 组件网格 '),(0,m.createElementVNode)('div',{ref_key:'gridRef',ref:f,class:'acu-dash-grid'},[(0,m.createCommentVNode)(' 编辑模式：添加面板 '),c.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Un,[(0,m.createCommentVNode)(' 使用通用按钮样式 '),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-action-btn',{active:s.value}]),onClick:t[2]||(t[2]=(0,m.withModifiers)(e=>s.value=!s.value,['stop']))},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',s.value?'fa-chevron-up':'fa-plus'])},null,2),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(s.value?'收起':'添加表格'),1)],2),(0,m.createCommentVNode)(' 展开的添加面板：复用 switch-list '),s.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Pn,[(0,m.createElementVNode)('div',$n,[(0,m.createCommentVNode)(' 已添加的表格（排前面，switch 开启） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(b.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:'acu-switch-list-item is-selected',onClick:(0,m.withModifiers)(t=>U(e.id),['stop'])},[(0,m.createElementVNode)('span',Fn,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',e.icon])},null,2),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(T(e)),1)]),(0,m.createElementVNode)('label',{class:'acu-switch small',onClick:t[3]||(t[3]=(0,m.withModifiers)(()=>{},['stop']))},[(0,m.createElementVNode)('input',{type:'checkbox',checked:'',onChange:(0,m.withModifiers)(t=>U(e.id),['stop'])},null,40,jn),t[13]||(t[13]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])],8,Ln))),128)),(0,m.createCommentVNode)(' 未添加的特殊组件 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(x.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.type,class:'acu-switch-list-item',onClick:(0,m.withModifiers)(t=>M(e.type),['stop'])},[(0,m.createElementVNode)('span',Rn,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',e.icon])},null,2),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(e.name),1)]),(0,m.createElementVNode)('label',{class:'acu-switch small',onClick:t[4]||(t[4]=(0,m.withModifiers)(()=>{},['stop']))},[(0,m.createElementVNode)('input',{type:'checkbox',checked:!1,onChange:(0,m.withModifiers)(t=>M(e.type),['stop'])},null,40,Hn),t[14]||(t[14]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])],8,On))),128)),(0,m.createCommentVNode)(' 未添加的表格（排后面，switch 关闭） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(h.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:'acu-switch-list-item',onClick:(0,m.withModifiers)(t=>I(e.id),['stop'])},[(0,m.createElementVNode)('span',Yn,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',S(e.id)])},null,2),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(e.name),1)]),(0,m.createElementVNode)('label',{class:'acu-switch small',onClick:t[5]||(t[5]=(0,m.withModifiers)(()=>{},['stop']))},[(0,m.createElementVNode)('input',{type:'checkbox',onChange:(0,m.withModifiers)(t=>I(e.id),['stop'])},null,40,Xn),t[15]||(t[15]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])],8,Wn))),128))])])):(0,m.createCommentVNode)('v-if',!0)])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 动态配置的看板 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(V.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:e.id},[(0,m.createCommentVNode)(' 随机词表组件 '),'randomWordPool'===e.type?((0,m.openBlock)(),(0,m.createBlock)((0,m.unref)(zn),{key:0,'is-editing':c.value,'widget-id':e.id,'col-span':e.colSpan,config:e,class:(0,m.normalizeClass)({'acu-dash-widget-dragging':u.value===e.id,'acu-dash-widget-drop-target':p.value===e.id}),onRemove:U,onResize:P,onAction:q,onDragStart:L,onDragEnd:F,onDrop:j},null,8,['is-editing','widget-id','col-span','config','class'])):'interaction'===e.displayStyle?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 交互表格专用组件 '),(0,m.createVNode)((0,m.unref)(ln),{config:e,'table-data':B(e.tableId),'is-editing':c.value,'diff-map':w.value,'ai-diff-map':C.value,'search-term':d.value,class:(0,m.normalizeClass)({'acu-dash-widget-dragging':u.value===e.id,'acu-dash-widget-drop-target':p.value===e.id}),onNavigate:Y,onRowEdit:G,onAction:q,onRemove:U,onResize:P,onDragStart:L,onDragEnd:F,onDrop:j},null,8,['config','table-data','is-editing','diff-map','ai-diff-map','search-term','class'])],2112)):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:2},[(0,m.createCommentVNode)(' 普通看板组件 '),(0,m.createVNode)((0,m.unref)($o),{config:e,'table-data':B(e.tableId),'is-editing':c.value,'diff-map':w.value,'ai-diff-map':C.value,'search-term':d.value,'all-tables':E.value,class:(0,m.normalizeClass)({'acu-dash-widget-dragging':u.value===e.id,'acu-dash-widget-drop-target':p.value===e.id}),onNavigate:Y,onRowClick:X,onRowEdit:G,onAction:q,onRemove:U,onResize:P,onDragStart:L,onDragEnd:F,onDrop:j},null,8,['config','table-data','is-editing','diff-map','ai-diff-map','search-term','all-tables','class'])],2112))],64))),128)),(0,m.createCommentVNode)(' 空状态 '),0===V.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',Gn,[d.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[t[17]||(t[17]=(0,m.createElementVNode)('i',{class:'fas fa-search'},null,-1)),(0,m.createElementVNode)('p',null,'没有找到匹配 "'+(0,m.toDisplayString)(d.value)+'" 的内容',1),(0,m.createElementVNode)('button',{class:'acu-dash-add-first-btn',onClick:t[6]||(t[6]=(0,m.withModifiers)(e=>d.value='',['stop']))},[...t[16]||(t[16]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1),(0,m.createTextVNode)(' 清除搜索 ',-1)])])],64)):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[t[19]||(t[19]=(0,m.createElementVNode)('i',{class:'fas fa-layer-group'},null,-1)),t[20]||(t[20]=(0,m.createElementVNode)('p',null,'还没有配置任何看板',-1)),(0,m.createElementVNode)('button',{class:'acu-dash-add-first-btn',onClick:t[7]||(t[7]=(0,m.withModifiers)(e=>{D(),s.value=!0},['stop']))},[...t[18]||(t[18]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1),(0,m.createTextVNode)(' 添加第一个看板 ',-1)])])],64))])):(0,m.createCommentVNode)('v-if',!0)],512)]))}}),Kn=qn,Jn={class:'acu-table-toolbar'},Zn={class:'acu-toolbar-left'},Qn={class:'acu-table-title'},er={class:'acu-table-count'},tr={key:0,class:'acu-table-badge acu-badge-changed'},ar={key:1,class:'acu-table-badge acu-badge-deleting'},or={class:'acu-toolbar-right'},nr=['title'],rr={key:0,class:'acu-empty-state'},ir={key:0,class:'acu-pagination-container'},lr={class:'acu-pagination-numbers'},cr={key:0,class:'acu-page-dots'},sr=['onClick'],dr=(0,m.defineComponent)({__name:'DataTable',props:{tableId:{},tableName:{},rows:{},headers:{default:()=>[]},searchTerm:{default:''},showIndex:{type:Boolean,default:!0},showHeader:{type:Boolean,default:!0},showPagination:{type:Boolean,default:!0},emptyText:{default:'暂无数据'},isLoading:{type:Boolean,default:!1}},emits:['cellClick','insertRow','toggleDelete','contextMenu','searchChange','pageChange','close','heightDragStart','heightReset','showHistory'],setup(e,{emit:t}){const a=e,o=t,n=(0,y.D)(),r=(0,f.JH)(),i=(0,k.j_)(),l=(0,m.ref)(),c=(0,m.ref)(),s=(0,m.ref)(i.getTableStyle(a.tableName)),d=(0,m.ref)(a.searchTerm),u=(0,m.ref)(1),p=(0,m.computed)(()=>{if(a.tableName.includes('总结')||a.tableName.includes('大纲')){const e=a.headers.findIndex(e=>e&&(e.includes('索引')||e.includes('编号')||e.includes('代码')));if(e>0)return e}return 1}),g=(0,m.computed)(()=>i.isTableReversed(a.tableName)),v=(0,m.ref)(new Map);(0,m.onMounted)(()=>{!function(){const e=new Map;for(const t of a.rows){const o=n.getRowChangeType(a.tableName,t.index,t.cells.length);o&&e.set(t.index,o)}v.value=e}()});const b=(0,m.computed)(()=>{let e=a.rows;if(i.showLockedOnly&&i.isLockEditMode){const t=(0,Me.t)();e=e.filter(e=>{const o=e.cells.map(e=>e.key),n=e.cells.map(e=>String(e.value??'')),r=t.getRowKey(a.tableName,n,o,e.index);return!!r&&t.hasRowAnyLockPending(a.tableName,r)})}const t=d.value.toLowerCase().trim();return t?e.filter(e=>e.cells.some(e=>String(e.value).toLowerCase().includes(t))):e});function h(e){return v.value.get(e.index)??null}function x(e){return'manual'===e?2:'ai'===e?1:0}const w=(0,m.computed)(()=>[...b.value].sort((e,t)=>{const a=h(e),o=h(t),n=x(a),r=x(o);return n!==r?r-n:g.value?t.index-e.index:e.index-t.index})),C=(0,m.computed)(()=>r.config.itemsPerPage||20),N=(0,m.computed)(()=>Math.max(1,Math.ceil(w.value.length/C.value))),V=(0,m.computed)(()=>{const e=(u.value-1)*C.value;return w.value.slice(e,e+C.value)}),E=(0,m.computed)(()=>a.rows.length),B=(0,m.computed)(()=>a.rows.filter(e=>A(e)).length),T=(0,m.computed)(()=>a.rows.filter(e=>{const t=`${a.tableName}-row-${e.index}`;return n.pendingDeletes.has(t)}).length),S=(0,m.computed)(()=>a.showPagination&&!1!==r.config.showPagination),D=(0,m.computed)(()=>{const e=[],t=N.value,a=u.value;if(t<=7)for(let a=1;a<=t;a++)e.push(a);else{e.push(1),a>3&&e.push('...');const o=Math.max(2,a-1),n=Math.min(t-1,a+1);for(let t=o;t<=n;t++)e.push(t);a<t-2&&e.push('...'),e.push(t)}return e});function A(e){return n.isRowChanged(a.tableName,e.index,e.cells.length)}function I(){i.toggleTableReverse(a.tableName)}function M(){const e=(0,Me.t)();if(i.isLockEditMode){const t=e.pendingLockCount.value;e.savePendingLocks(),i.isLockEditMode=!1,O.toast.success(`已保存 ${t} 个单元格锁定`)}else e.initPendingLocks(),i.isLockEditMode=!0,O.toast.info('已进入批量锁定模式，请点击单元格进行锁定')}function U(){i.showLockedOnly=!i.showLockedOnly}function P(){o('close')}function L(){u.value=1,o('searchChange',d.value)}function F(){d.value='',u.value=1,o('searchChange','')}function j(e){e<1||e>N.value||(u.value=e,o('pageChange',e),(0,m.nextTick)(()=>{l.value?.scrollTo({top:0,behavior:'smooth'})}))}function R(e,t){o('cellClick',a.tableId,e,t)}function H(e,t){o('contextMenu',e,a.tableId,t)}function W(e){c.value&&o('heightDragStart',e,c.value)}function Y(){o('heightReset')}let X=0;function G(){const e=Date.now();e-X<300?(Y(),X=0):X=e}return(0,m.watch)(()=>a.searchTerm,e=>{d.value=e}),(0,m.watch)(s,e=>{i.setTableStyle(a.tableName,e)}),(0,m.watch)(N,e=>{u.value>e&&(u.value=Math.max(1,e))}),(t,n)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{class:(0,m.normalizeClass)(['acu-data-table',{'acu-table-loading':e.isLoading}])},[(0,m.createCommentVNode)(' 固定工具栏 '),(0,m.createElementVNode)('div',Jn,[(0,m.createCommentVNode)(' 左侧：表名 + (条数) '),(0,m.createElementVNode)('div',Zn,[(0,m.createElementVNode)('span',Qn,(0,m.toDisplayString)(e.tableName),1),(0,m.createElementVNode)('span',er,'('+(0,m.toDisplayString)(E.value)+')',1),B.value>0?((0,m.openBlock)(),(0,m.createElementBlock)('span',tr,(0,m.toDisplayString)(B.value),1)):(0,m.createCommentVNode)('v-if',!0),T.value>0?((0,m.openBlock)(),(0,m.createElementBlock)('span',ar,(0,m.toDisplayString)(T.value),1)):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 右侧：从右到左 - 关闭、搜索、高度拖手、倒序、锁定 '),(0,m.createElementVNode)('div',or,[(0,m.createCommentVNode)(' 锁定模式筛选按钮 '),(0,m.unref)(i).isLockEditMode?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:(0,m.normalizeClass)(['acu-icon-btn',{active:(0,m.unref)(i).showLockedOnly}]),title:'只显示锁定的卡片',onClick:(0,m.withModifiers)(U,['stop'])},[...n[3]||(n[3]=[(0,m.createElementVNode)('i',{class:'fas fa-filter'},null,-1)])],2)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 锁定单元格按钮 '),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-icon-btn',{active:(0,m.unref)(i).isLockEditMode}]),title:(0,m.unref)(i).isLockEditMode?'保存并退出锁定模式':'进入批量锁定模式',onClick:(0,m.withModifiers)(M,['stop'])},[...n[4]||(n[4]=[(0,m.createElementVNode)('i',{class:'fas fa-lock'},null,-1)])],10,nr),(0,m.createCommentVNode)(' 倒序按钮 '),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-icon-btn',{active:g.value}]),title:'倒序显示',onClick:I},[...n[5]||(n[5]=[(0,m.createElementVNode)('i',{class:'fas fa-sort-amount-down-alt'},null,-1)])],2),(0,m.createCommentVNode)(' 高度拖手 '),(0,m.createElementVNode)('button',{ref_key:'heightHandleRef',ref:c,class:'acu-icon-btn acu-height-handle',title:'拖动调整高度 / 双击重置',onPointerdown:W,onDblclick:Y,onTouchend:(0,m.withModifiers)(G,['stop'])},[...n[6]||(n[6]=[(0,m.createElementVNode)('i',{class:'fas fa-grip-lines'},null,-1)])],544),(0,m.createCommentVNode)(' 搜索框 '),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':n[0]||(n[0]=e=>d.value=e),type:'text',class:'acu-search-input acu-search-inline',placeholder:'搜索...',onInput:L},null,544),[[m.vModelText,d.value]]),d.value?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:1,class:'fas fa-times acu-search-clear',onClick:F})):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 关闭按钮 '),(0,m.createElementVNode)('button',{class:'acu-icon-btn acu-close-btn',title:'关闭数据区',onClick:(0,m.withModifiers)(P,['stop'])},[...n[7]||(n[7]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])])]),(0,m.createCommentVNode)(' 数据卡片列表 '),(0,m.createElementVNode)('div',{ref_key:'containerRef',ref:l,class:(0,m.normalizeClass)(['acu-cards-container',[`acu-view-${s.value}`]])},[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(V.value,t=>((0,m.openBlock)(),(0,m.createBlock)(Lt,{key:`${e.tableId}-${t.index}`,data:t,'table-id':e.tableId,'table-name':e.tableName,'is-changed':A(t),layout:(0,m.unref)(r).config.layout,'view-mode':s.value,'show-index':e.showIndex,'show-header':e.showHeader,'title-col-index':p.value,'show-history-button':!0,onCellClick:R,onInsertRow:e=>{return n=t.index,void o('insertRow',a.tableId,n);var n},onToggleDelete:e=>{return n=t.index,void o('toggleDelete',a.tableId,n);var n},onContextMenu:H,onShowHistory:e=>function(e){o('showHistory',a.tableId,a.tableName,e.index,e)}(t)},null,8,['data','table-id','table-name','is-changed','layout','view-mode','show-index','show-header','title-col-index','onInsertRow','onToggleDelete','onShowHistory']))),128)),(0,m.createCommentVNode)(' 空状态 '),0===b.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',rr,[n[8]||(n[8]=(0,m.createElementVNode)('i',{class:'fas fa-inbox'},null,-1)),(0,m.createElementVNode)('p',null,(0,m.toDisplayString)(e.emptyText),1)])):(0,m.createCommentVNode)('v-if',!0)],2),(0,m.createCommentVNode)(' 分页器 (读取全局配置) '),(0,m.renderSlot)(t.$slots,'pagination',{},()=>[S.value&&N.value>1?((0,m.openBlock)(),(0,m.createElementBlock)('div',ir,[(0,m.createCommentVNode)(' 上一页 (固定在最左) '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-page-btn acu-page-arrow',{disabled:1===u.value}]),title:'上一页',onClick:n[1]||(n[1]=e=>u.value>1&&j(u.value-1))},[...n[9]||(n[9]=[(0,m.createElementVNode)('i',{class:'fa-solid fa-chevron-left'},null,-1)])],2),(0,m.createCommentVNode)(' 中间数字区 (居中) '),(0,m.createElementVNode)('div',lr,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(D.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:e},['...'===e?((0,m.openBlock)(),(0,m.createElementBlock)('div',cr,'...')):((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:1,class:(0,m.normalizeClass)(['acu-page-btn',{active:e===u.value}]),onClick:t=>j(e)},(0,m.toDisplayString)(e),11,sr))],64))),128))]),(0,m.createCommentVNode)(' 下一页 (固定在最右) '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-page-btn acu-page-arrow',{disabled:u.value===N.value}]),title:'下一页',onClick:n[2]||(n[2]=e=>u.value<N.value&&j(u.value+1))},[...n[10]||(n[10]=[(0,m.createElementVNode)('i',{class:'fa-solid fa-chevron-right'},null,-1)])],2)])):(0,m.createCommentVNode)('v-if',!0)])],2))}}),ur={class:'acu-options-panel'},pr={class:'acu-panel-header acu-options-header'},mr={class:'acu-header-actions'},fr={class:'acu-options-count'},gr={class:'acu-panel-content acu-options-content'},vr={key:0,class:'acu-empty-state'},br={class:'acu-options-list'},hr={class:'acu-dash-title'},xr={class:'acu-option-rows'},wr=['onClick'],yr={class:'acu-embedded-option-tags'},kr={class:'acu-embedded-option-text'},Cr=(0,m.defineComponent)({__name:'OptionsPanel',props:{tables:{}},emits:['navigate','optionClick'],setup(e,{emit:t}){const a=e,o=t,{setInput:n}=Ee(),r=(0,Ye.j_)(),i=(0,m.computed)(()=>a.tables.filter(e=>(0,Wt.YP)(e.name)));function l(e){return(0,Wt.NX)(e)}function c(e,t){const a=e.currentTarget;t?(a.style.background='var(--acu-table-hover)',a.style.borderColor='var(--acu-title-color)'):(a.style.background='rgba(255,255,255,0.05)',a.style.borderColor='var(--acu-border)')}function s(){r.setActiveTab(Ye.H6)}return(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',ur,[(0,m.createCommentVNode)(' 面板头部 '),(0,m.createElementVNode)('div',pr,[t[5]||(t[5]=(0,m.createElementVNode)('div',{class:'acu-panel-title acu-options-title'},[(0,m.createElementVNode)('i',{class:'fa-solid fa-list-check'}),(0,m.createTextVNode)(' 选项聚合 ')],-1)),(0,m.createElementVNode)('div',mr,[(0,m.createElementVNode)('span',fr,(0,m.toDisplayString)(i.value.length)+' 个选项表',1),(0,m.createElementVNode)('button',{class:'acu-icon-btn acu-close-btn',title:'返回仪表盘',onClick:(0,m.withModifiers)(s,['stop'])},[...t[4]||(t[4]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])])]),(0,m.createCommentVNode)(' 内容滚动区域 '),(0,m.createElementVNode)('div',gr,[(0,m.createCommentVNode)(' 空状态 '),0===i.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',vr,'未找到名称包含"选项"的表格')):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 选项表格列表 '),(0,m.createElementVNode)('div',br,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(i.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:'acu-dash-card'},[(0,m.createCommentVNode)(' 表格标题 '),(0,m.createElementVNode)('div',hr,(0,m.toDisplayString)(e.name),1),(0,m.createCommentVNode)(' 选项行列表 '),(0,m.createElementVNode)('div',xr,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(l(e),(e,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:a,class:'acu-embedded-option-row',title:'点击追加',onClick:t=>{return a=e.text,n(a),o('optionClick',a),void O.toast.success('已追加到输入框');var a},onMouseover:t[0]||(t[0]=e=>c(e,!0)),onMouseout:t[1]||(t[1]=e=>c(e,!1)),onMousedown:t[2]||(t[2]=e=>{e.currentTarget.style.transform='translateY(1px)'}),onMouseup:t[3]||(t[3]=e=>{e.currentTarget.style.transform='translateY(0)'})},[(0,m.createCommentVNode)(' 标签区域 '),(0,m.createElementVNode)('div',yr,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.tags,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:t,class:'acu-badge'},(0,m.toDisplayString)(e),1))),128))]),(0,m.createCommentVNode)(' 选项文本 '),(0,m.createElementVNode)('div',kr,(0,m.toDisplayString)(e.text),1)],40,wr))),128))])]))),128))])],2112))])]))}}),Nr=(0,m.defineComponent)({__name:'ContextMenu',props:{visible:{type:Boolean},x:{},y:{},tableId:{},tableName:{},rowIndex:{},cellValue:{}},emits:['update:visible','insertRow','delete','undoDelete','copied'],setup(e,{expose:t,emit:a}){const o=e,n=a,r=(0,m.ref)(),i=(0,y.D)(),{copy:l,copied:c}=(0,Be.iDZ)(),s=(0,m.computed)(()=>{const e=`${o.tableName||o.tableId}-row-${o.rowIndex}`;return i.pendingDeletes.has(e)}),d=(0,m.computed)(()=>{const e=window.parent||window,t=e.innerWidth,a=e.innerHeight;let n=o.x,r=o.y;return n+180>t&&(n=t-180-10),r+200>a&&(r=a-200-10),n=Math.max(10,n),r=Math.max(10,r),{left:`${n}px`,top:`${r}px`}});let u=null,p=null;(0,m.onMounted)(()=>{const e=window.parent?.document||document;u=e=>{if(!o.visible||!r.value)return;const t=e.target;r.value.contains(t)||(console.info('[ACU] 点击外部关闭右键菜单'),f())},p=e=>{if(!o.visible||!r.value)return;const t=e.target;r.value.contains(t)||(console.info('[ACU] 右键点击外部关闭右键菜单'),f())},e.addEventListener('click',u,!0),e.addEventListener('contextmenu',p,!0),e.addEventListener('touchstart',u,!0)}),(0,m.onUnmounted)(()=>{const e=window.parent?.document||document;u&&(e.removeEventListener('click',u,!0),e.removeEventListener('touchstart',u,!0),u=null),p&&(e.removeEventListener('contextmenu',p,!0),p=null)}),(0,m.watch)(()=>o.visible,e=>{e&&(0,m.nextTick)(()=>{r.value?.focus()})});const f=()=>{n('update:visible',!1)},g=()=>{n('insertRow',o.tableId,o.rowIndex),f()},v=async()=>{if(o.cellValue)try{await l(o.cellValue),n('copied')}catch(e){console.error('[ACU] Copy failed:',e)}f()},b=()=>{n('delete',o.tableId,o.rowIndex),f()},h=()=>{n('undoDelete',o.tableId,o.rowIndex),f()};return t({close:f,copied:c}),(t,a)=>((0,m.openBlock)(),(0,m.createBlock)(m.Transition,{name:'acu-menu-fade'},{default:(0,m.withCtx)(()=>[e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,ref_key:'menuRef',ref:r,class:'acu-context-menu',style:(0,m.normalizeStyle)(d.value),tabindex:'-1',onKeydown:(0,m.withKeys)(f,['escape']),onClick:a[0]||(a[0]=(0,m.withModifiers)(()=>{},['stop'])),onMousedown:a[1]||(a[1]=(0,m.withModifiers)(()=>{},['stop'])),onTouchstart:a[2]||(a[2]=(0,m.withModifiers)(()=>{},['stop']))},[(0,m.createCommentVNode)(' 插入行 '),(0,m.createElementVNode)('div',{class:'acu-menu-item',onClick:(0,m.withModifiers)(g,['stop'])},[...a[3]||(a[3]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1),(0,m.createElementVNode)('span',null,'插入行',-1)])]),(0,m.createCommentVNode)(' 复制内容 '),(0,m.createElementVNode)('div',{class:'acu-menu-item',onClick:(0,m.withModifiers)(v,['stop'])},[...a[4]||(a[4]=[(0,m.createElementVNode)('i',{class:'fas fa-copy'},null,-1),(0,m.createElementVNode)('span',null,'复制内容',-1)])]),(0,m.createCommentVNode)(' 分隔线 '),a[7]||(a[7]=(0,m.createElementVNode)('div',{class:'acu-menu-divider'},null,-1)),(0,m.createCommentVNode)(' 删除行（未标记删除时显示） '),s.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 撤销删除（已标记删除时显示） '),(0,m.createElementVNode)('div',{class:'acu-menu-item acu-menu-warning',onClick:(0,m.withModifiers)(h,['stop'])},[...a[6]||(a[6]=[(0,m.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,m.createElementVNode)('span',null,'撤销删除',-1)])])],2112)):((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-menu-item acu-menu-danger',onClick:(0,m.withModifiers)(b,['stop'])},[...a[5]||(a[5]=[(0,m.createElementVNode)('i',{class:'fas fa-trash'},null,-1),(0,m.createElementVNode)('span',null,'删除整行',-1)])]))],36)):(0,m.createCommentVNode)('v-if',!0)]),_:1}))}}),Vr={class:'acu-pagination'},Er={class:'acu-pagination-info'},Br={class:'acu-pagination-current'},Tr={key:0,class:'acu-pagination-total'},Sr={class:'acu-pagination-controls'},Dr=['disabled'],Ar=['disabled'],zr={class:'acu-page-list'},Ir={key:0,class:'acu-page-ellipsis'},_r=['onClick'],Mr=['disabled'],Ur=['disabled'],Pr={key:0,class:'acu-pagination-jump'},$r=['max'];Boolean,Boolean;u(6094);const Lr={class:'acu-switch-list'},Fr={class:'acu-switch-list-header'},jr=['onClick'],Or={class:'item-label'},Rr={key:0,class:'item-badge'},Hr=['checked','onChange'],Wr={key:0,class:'acu-switch-list-empty'},Yr={class:'acu-switch-list-footer'},Xr={key:0,class:'empty-hint'},Gr=(0,m.defineComponent)({__name:'SwitchList',props:{modelValue:{},items:{},maxHeight:{default:'280px'},emptyText:{default:'暂无数据'},footerTemplate:{default:'已选择: {selected}/{total}'},emptyHint:{default:''}},emits:['update:modelValue'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.computed)(()=>0!==a.items.length&&a.modelValue.length===a.items.length),r=(0,m.computed)(()=>a.footerTemplate.replace('{selected}',String(a.modelValue.length)).replace('{total}',String(a.items.length)));function i(e){return a.modelValue.includes(e)}function l(e){const t=[...a.modelValue],n=t.indexOf(e);-1===n?t.push(e):t.splice(n,1),o('update:modelValue',t)}function c(){n.value?o('update:modelValue',[]):o('update:modelValue',a.items.map(e=>e.key))}function s(){o('update:modelValue',[])}return(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',Lr,[(0,m.createCommentVNode)(' 头部按钮区 '),(0,m.createElementVNode)('div',Fr,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-quick-select-btn',{active:n.value}]),onClick:(0,m.withModifiers)(c,['stop'])},[...a[1]||(a[1]=[(0,m.createElementVNode)('i',{class:'fas fa-check-double'},null,-1),(0,m.createTextVNode)(' 全选 ',-1)])],2),(0,m.createElementVNode)('button',{class:'acu-quick-select-btn',onClick:(0,m.withModifiers)(s,['stop'])},[...a[2]||(a[2]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1),(0,m.createTextVNode)(' 清空 ',-1)])])]),(0,m.createCommentVNode)(' 滚动列表区 '),(0,m.createElementVNode)('div',{class:'acu-switch-list-body',style:(0,m.normalizeStyle)({maxHeight:e.maxHeight})},[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.items,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.key,class:(0,m.normalizeClass)(['acu-switch-list-item',[e.class,{'is-selected':i(e.key)}]]),onClick:t=>l(e.key)},[(0,m.createElementVNode)('span',Or,[(0,m.createTextVNode)((0,m.toDisplayString)(e.label)+' ',1),e.badge?((0,m.openBlock)(),(0,m.createElementBlock)('span',Rr,(0,m.toDisplayString)(e.badge),1)):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createElementVNode)('label',{class:'acu-switch small',onClick:a[0]||(a[0]=(0,m.withModifiers)(()=>{},['stop']))},[(0,m.createElementVNode)('input',{type:'checkbox',checked:i(e.key),onChange:t=>l(e.key)},null,40,Hr),a[3]||(a[3]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])],10,jr))),128)),0===e.items.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',Wr,[a[4]||(a[4]=(0,m.createElementVNode)('i',{class:'fas fa-inbox'},null,-1)),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(e.emptyText),1)])):(0,m.createCommentVNode)('v-if',!0)],4),(0,m.createCommentVNode)(' 底部统计区 '),(0,m.createElementVNode)('div',Yr,[(0,m.createTextVNode)((0,m.toDisplayString)(r.value)+' ',1),0===e.modelValue.length&&e.emptyHint?((0,m.openBlock)(),(0,m.createElementBlock)('span',Xr,(0,m.toDisplayString)(e.emptyHint),1)):(0,m.createCommentVNode)('v-if',!0)])]))}}),qr={class:'acu-modal-header'},Kr={class:'acu-modal-body'},Jr={class:'acu-add-table-tabs'},Zr={key:0,class:'acu-add-table-paste'},Qr={class:'acu-add-table-file'},ei={class:'acu-file-label'},ti={key:2,class:'acu-add-table-error'},ai={key:3,class:'acu-add-table-list'},oi={class:'acu-modal-footer'},ni=['disabled'],ri=(0,m.defineComponent)({__name:'AddTableDialog',props:{visible:{type:Boolean}},emits:['update:visible','confirm'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.ref)('paste'),r=(0,m.ref)(''),i=(0,m.ref)(''),l=(0,m.ref)(''),c=(0,m.ref)([]),s=(0,m.ref)([]),d=(0,m.ref)(),u=(0,m.computed)(()=>c.value.map(e=>({key:e.key,label:e.template.name})));function p(){if(l.value='',c.value=[],s.value=[],r.value.trim())try{g(JSON.parse(r.value))}catch(e){l.value=`JSON 解析失败: ${e instanceof Error?e.message:String(e)}`}else l.value='请输入 JSON 内容'}function f(e){const t=e.target,a=t.files?.[0];if(!a)return;i.value=a.name,l.value='',c.value=[],s.value=[];const o=new FileReader;o.onload=e=>{try{const t=e.target?.result;g(JSON.parse(t))}catch(e){l.value=`文件解析失败: ${e instanceof Error?e.message:String(e)}`}},o.onerror=()=>{l.value='文件读取失败'},o.readAsText(a)}function g(e){if(!e||'object'!=typeof e)return void(l.value='无效的 JSON 格式');const t=[];for(const a of Object.keys(e)){if(!a.startsWith('sheet_'))continue;const o=e[a];o&&'object'==typeof o&&(o.name&&Array.isArray(o.content)?t.push({key:a,template:o}):console.warn(`[ACU] 跳过无效表格: ${a}`))}0!==t.length?(c.value=t,1===t.length&&(s.value=[t[0].key]),O.toast.success(`解析成功，找到 ${t.length} 个表格`)):l.value='未找到有效的表格定义 (需要 sheet_xxx 格式的键)'}function v(){o('update:visible',!1)}function b(){if(0===s.value.length)return;const e=c.value.filter(e=>s.value.includes(e.key)).map(e=>e.template);o('confirm',e),v()}return(0,m.watch)(()=>a.visible,e=>{e&&(r.value='',i.value='',l.value='',c.value=[],s.value=[],n.value='paste')}),(0,Be.X2F)(d,()=>{v()}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(v,['self'])},[(0,m.createElementVNode)('div',{ref_key:'dialogRef',ref:d,class:'acu-modal acu-add-table-modal'},[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',qr,[(0,m.createElementVNode)('button',{class:'acu-modal-back',onClick:(0,m.withModifiers)(v,['stop'])},[...a[4]||(a[4]=[(0,m.createElementVNode)('i',{class:'fas fa-arrow-left'},null,-1)])]),a[5]||(a[5]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},'添加表格',-1)),a[6]||(a[6]=(0,m.createElementVNode)('span',null,null,-1))]),(0,m.createCommentVNode)(' 内容区 '),(0,m.createElementVNode)('div',Kr,[(0,m.createCommentVNode)(' Tab 切换：粘贴 JSON / 导入文件 '),(0,m.createElementVNode)('div',Jr,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-tab-btn',{active:'paste'===n.value}]),onClick:a[0]||(a[0]=(0,m.withModifiers)(e=>n.value='paste',['stop']))},[...a[7]||(a[7]=[(0,m.createElementVNode)('i',{class:'fas fa-paste'},null,-1),(0,m.createTextVNode)(' 粘贴 JSON ',-1)])],2),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-tab-btn',{active:'file'===n.value}]),onClick:a[1]||(a[1]=(0,m.withModifiers)(e=>n.value='file',['stop']))},[...a[8]||(a[8]=[(0,m.createElementVNode)('i',{class:'fas fa-file-import'},null,-1),(0,m.createTextVNode)(' 导入文件 ',-1)])],2)]),(0,m.createCommentVNode)(' 粘贴模式 '),'paste'===n.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Zr,[(0,m.withDirectives)((0,m.createElementVNode)('textarea',{'onUpdate:modelValue':a[2]||(a[2]=e=>r.value=e),placeholder:'粘贴表格模板 JSON...',class:'acu-textarea-scrollable',rows:'8'},null,512),[[m.vModelText,r.value]]),(0,m.createElementVNode)('button',{class:'acu-modal-btn primary',onClick:(0,m.withModifiers)(p,['stop'])},[...a[9]||(a[9]=[(0,m.createElementVNode)('i',{class:'fas fa-search'},null,-1),(0,m.createTextVNode)(' 解析',-1)])])])):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 文件导入模式 '),(0,m.createElementVNode)('div',Qr,[(0,m.createElementVNode)('label',ei,[(0,m.createElementVNode)('input',{type:'file',accept:'.json',onChange:f,style:{display:'none'}},null,32),a[10]||(a[10]=(0,m.createElementVNode)('i',{class:'fas fa-upload'},null,-1)),(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(i.value||'点击选择 JSON 文件'),1)])])],2112)),(0,m.createCommentVNode)(' 错误提示 '),l.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',ti,[a[11]||(a[11]=(0,m.createElementVNode)('i',{class:'fas fa-exclamation-circle'},null,-1)),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(l.value),1)])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 解析结果：表格选择列表 '),c.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',ai,[a[12]||(a[12]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-table'}),(0,m.createTextVNode)(' 选择要添加的表格 ')],-1)),(0,m.createVNode)(Gr,{modelValue:s.value,'onUpdate:modelValue':a[3]||(a[3]=e=>s.value=e),items:u.value,'empty-text':'暂无可添加的表格','footer-template':'已选择: {selected}/{total} 个表格'},null,8,['modelValue','items'])])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 底部按钮 '),(0,m.createElementVNode)('div',oi,[(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:(0,m.withModifiers)(v,['stop'])},'取消'),(0,m.createElementVNode)('button',{class:'acu-modal-btn primary',disabled:0===s.value.length,onClick:(0,m.withModifiers)(b,['stop'])},[a[13]||(a[13]=(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1)),(0,m.createTextVNode)(' 添加 ('+(0,m.toDisplayString)(s.value.length)+') ',1)],8,ni)])],512)])):(0,m.createCommentVNode)('v-if',!0)}}),ii={class:'acu-modal-body'},li={class:'acu-settings-section'},ci={class:'acu-settings-group'},si={class:'acu-purge-range-row'},di={class:'acu-settings-section'},ui={class:'acu-modal-footer'},pi=['disabled'],mi={key:0,class:'fas fa-spinner fa-spin'},fi={key:1,class:'fas fa-trash-alt'},gi=(0,m.defineComponent)({__name:'AdvancedPurgeDialog',props:{visible:{type:Boolean},initialStartFloor:{default:void 0},initialEndFloor:{default:void 0},initialSelectedTables:{default:()=>[]}},emits:['update:visible','confirm'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.ref)(),r=(0,m.ref)(),i=(0,m.ref)(),l=(0,m.ref)(null),c=(0,m.ref)(null),s=(0,m.ref)([]),d=(0,m.ref)([]),u=(0,m.ref)(!1),{purgeTableDataByRange:p}=ue(),f=(0,m.computed)(()=>d.value.map(e=>({key:e.key,label:e.name}))),g=(0,m.computed)(()=>null!==l.value&&null!==c.value&&(!isNaN(l.value)&&!isNaN(c.value)&&(!(l.value<0||c.value<0)&&(!(l.value>c.value)&&0!==s.value.length))));function b(){l.value=0,c.value=9999999}function h(){i.value?.focus()}function x(){o('update:visible',!1)}async function w(){if(g.value&&!u.value){u.value=!0;try{const e=await p(s.value,l.value,c.value);if(e.changed){const t=s.value.map(e=>d.value.find(t=>t.key===e)?.name||e).join(', ');O.toast.success(`已清除 ${e.changedCount} 层数据 (${t})`),o('confirm',{changedCount:e.changedCount,tables:s.value}),x()}else O.toast.info('未找到需要清除的数据')}catch(e){console.error('[ACU] 高级清除失败:',e),O.toast.error('清除失败: '+(e instanceof Error?e.message:String(e)))}finally{u.value=!1}}}return(0,m.watch)(()=>a.visible,e=>{if(e){if(void 0!==a.initialStartFloor&&void 0!==a.initialEndFloor)l.value=a.initialStartFloor,c.value=a.initialEndFloor;else{const e=function(){let e=window.SillyTavern||(window.parent?window.parent.SillyTavern:null);!e&&window.top&&window.top.SillyTavern&&(e=window.top.SillyTavern);let t=-1,a=0;if(e&&e.chat){a=Math.max(0,e.chat.length-1);for(let a=e.chat.length-1;a>=0;a--){const o=e.chat[a];if(!o.is_user&&o.TavernDB_ACU_IsolatedData){const e=Object.keys(o.TavernDB_ACU_IsolatedData);let n=!1;for(const t of e){const e=o.TavernDB_ACU_IsolatedData[t];if(e&&e.independentData&&Object.keys(e.independentData).length>0){n=!0;break}}if(n){t=a;break}}}}return{start:-1!==t?t:a,end:-1!==t?t:a}}();l.value=e.start,c.value=e.end}a.initialSelectedTables&&a.initialSelectedTables.length>0?s.value=[...a.initialSelectedTables]:s.value=[],u.value=!1,function(){try{const e=(0,v.tu)();if(!e)return void(d.value=[]);const t=[];Object.keys(e).forEach(a=>{if(!a.startsWith('sheet_'))return;const o=e[a];o&&'object'==typeof o&&o.name&&t.push({key:a,name:o.name})}),d.value=t}catch(e){console.warn('[ACU] 加载表格列表失败:',e),d.value=[]}}()}}),(0,Be.X2F)(n,()=>{u.value||x()}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(x,['self'])},[(0,m.createElementVNode)('div',{ref_key:'dialogRef',ref:n,class:'acu-modal acu-advanced-purge-modal'},[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',{class:'acu-modal-header'},[(0,m.createElementVNode)('button',{class:'acu-modal-back',onClick:x},[...a[3]||(a[3]=[(0,m.createElementVNode)('i',{class:'fas fa-arrow-left'},null,-1)])]),a[4]||(a[4]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},'高级清除',-1)),a[5]||(a[5]=(0,m.createElementVNode)('span',null,null,-1))]),(0,m.createCommentVNode)(' 内容区 '),(0,m.createElementVNode)('div',ii,[(0,m.createCommentVNode)(' 楼层范围设置 '),(0,m.createElementVNode)('div',li,[a[8]||(a[8]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-layer-group'}),(0,m.createTextVNode)(' 楼层范围 ')],-1)),(0,m.createElementVNode)('div',ci,[(0,m.createElementVNode)('div',si,[(0,m.withDirectives)((0,m.createElementVNode)('input',{ref_key:'startInputRef',ref:r,'onUpdate:modelValue':a[0]||(a[0]=e=>l.value=e),type:'number',class:'acu-purge-input',placeholder:'起始',min:'0',onKeydown:(0,m.withKeys)(h,['enter'])},null,544),[[m.vModelText,l.value,void 0,{number:!0}]]),a[6]||(a[6]=(0,m.createElementVNode)('span',{class:'acu-purge-separator'},'—',-1)),(0,m.withDirectives)((0,m.createElementVNode)('input',{ref_key:'endInputRef',ref:i,'onUpdate:modelValue':a[1]||(a[1]=e=>c.value=e),type:'number',class:'acu-purge-input',placeholder:'结束',min:'0'},null,512),[[m.vModelText,c.value,void 0,{number:!0}]])]),a[7]||(a[7]=(0,m.createElementVNode)('div',{class:'acu-purge-range-hint'},[(0,m.createElementVNode)('i',{class:'fas fa-info-circle'}),(0,m.createTextVNode)(' 输入 Chat 索引（从 0 开始） ')],-1)),(0,m.createElementVNode)('div',{class:'acu-purge-quick-actions'},[(0,m.createElementVNode)('button',{class:'acu-tool-btn small',onClick:b},'所有楼层')])])]),(0,m.createCommentVNode)(' 表格选择 '),(0,m.createElementVNode)('div',di,[a[9]||(a[9]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-table'}),(0,m.createTextVNode)(' 选择要清除的表格 ')],-1)),(0,m.createVNode)(Gr,{modelValue:s.value,'onUpdate:modelValue':a[2]||(a[2]=e=>s.value=e),items:f.value,'empty-text':'暂无可用表格','footer-template':'已选择: {selected}/{total} 个表格'},null,8,['modelValue','items'])]),(0,m.createCommentVNode)(' 警告提示 '),a[10]||(a[10]=(0,m.createElementVNode)('div',{class:'acu-purge-warning'},[(0,m.createElementVNode)('i',{class:'fas fa-exclamation-triangle'}),(0,m.createElementVNode)('span',null,'此操作将从指定楼层范围内删除选中表格的数据，操作不可撤销！')],-1))]),(0,m.createCommentVNode)(' 底部按钮 '),(0,m.createElementVNode)('div',ui,[(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:x},'取消'),(0,m.createElementVNode)('button',{class:'acu-modal-btn danger',disabled:!g.value||u.value,onClick:w},[u.value?((0,m.openBlock)(),(0,m.createElementBlock)('i',mi)):((0,m.openBlock)(),(0,m.createElementBlock)('i',fi)),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(u.value?'执行中...':'确认清除'),1)],8,pi)])],512)])):(0,m.createCommentVNode)('v-if',!0)}}),vi={class:'acu-modal',style:{'max-width':'400px'}},bi={class:'acu-modal-header'},hi={class:'acu-modal-body'},xi={class:'acu-settings-row column'},wi={class:'acu-settings-control',style:{display:'flex',gap:'8px','align-items':'center'}},yi=['value'],ki=['value'],Ci={class:'acu-settings-row column'},Ni={class:'acu-settings-control',style:{display:'flex',gap:'8px','align-items':'center'}},Vi=['value'],Ei=['value'],Bi=(0,m.defineComponent)({__name:'DirectorDialog',props:{visible:{type:Boolean}},emits:['update:visible','close'],setup(e,{emit:t}){(0,k.j_)();const a=e,o=t,n=(0,m.ref)([]),r=(0,m.ref)([]),i=(0,m.ref)(''),l=(0,m.ref)(''),c=()=>{o('update:visible',!1),o('close')},s=async(e=0)=>{console.log('[DirectorDialog] loadData called, attempt:',e+1);const t=window.AutoCardUpdaterAPI||window.parent.AutoCardUpdaterAPI;if(!t)return console.warn('[DirectorDialog] AutoCardUpdaterAPI not found.'),void(e<5?setTimeout(()=>s(e+1),200):O.toast.error('API 初始化失败，无法加载数据。'));try{const e=t.getTemplatePresetNames()||[];n.value=e,console.log('[DirectorDialog] Templates loaded:',e)}catch(e){console.error('[DirectorDialog] Failed to load template presets:',e)}try{const e=t.getPlotPresetNames()||[];r.value=e;const a=t.getCurrentPlotPreset()||'';l.value=a,console.log('[DirectorDialog] Plots loaded:',e,'Current:',a)}catch(e){console.error('[DirectorDialog] Failed to load plot presets:',e)}};(0,m.watch)(()=>a.visible,e=>{e&&s()});const d=async e=>{const t=e.target,a=t.value,o=window.AutoCardUpdaterAPI||window.parent.AutoCardUpdaterAPI;if(a&&o)try{const e=await o.switchTemplatePreset(a);e.success?(i.value=a,O.toast.success(e.message)):(O.toast.error(e.message),t.value=i.value)}catch(e){O.toast.error('切换模板失败: '+e.message)}},u=e=>{const t=e.target,a=t.value,o=window.AutoCardUpdaterAPI||window.parent.AutoCardUpdaterAPI;if(a&&o)try{o.switchPlotPreset(a)?(l.value=a,O.toast.success(`已切换剧情风格: ${a}`)):(O.toast.error('切换剧情风格失败'),t.value=l.value)}catch(e){O.toast.error('切换剧情风格失败: '+e.message)}},p=async()=>{const e=prompt('请粘贴表格模板配置 (JSON):');if(!e||!e.trim())return;const t=window.AutoCardUpdaterAPI||window.parent.AutoCardUpdaterAPI;if(t)try{const a=await t.importTemplateFromData(e);a.success?(O.toast.success(a.message),s()):O.toast.error(a.message)}catch(e){O.toast.error('导入失败: '+e.message)}},f=async()=>{const e=prompt('请粘贴剧情推进预设 (JSON):');if(!e||!e.trim())return;const t=window.AutoCardUpdaterAPI||window.parent.AutoCardUpdaterAPI;if(t)try{const a=await t.importPlotPresetFromData(e,{switchTo:!0});a.success?(O.toast.success(a.message),s(),a.presetName&&(l.value=a.presetName)):O.toast.error(a.message)}catch(e){O.toast.error('导入失败: '+e.message)}};return(0,m.onMounted)(()=>{a.visible&&s()}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(c,['self'])},[(0,m.createElementVNode)('div',vi,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',bi,[a[0]||(a[0]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},'导演控制台',-1)),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(c,['stop'])},'完成')]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',hi,[(0,m.createCommentVNode)(' 表格模板设置 '),(0,m.createElementVNode)('div',xi,[a[3]||(a[3]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 表格模板 '),(0,m.createElementVNode)('span',{class:'hint'},'切换游戏数据结构')],-1)),(0,m.createElementVNode)('div',wi,[(0,m.createElementVNode)('select',{class:'acu-select',value:i.value,style:{flex:'1'},onChange:d},[a[1]||(a[1]=(0,m.createElementVNode)('option',{value:'',disabled:''},'选择模板...',-1)),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(n.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('option',{key:e,value:e},(0,m.toDisplayString)(e),9,ki))),128))],40,yi),(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'粘贴导入模板配置',onClick:(0,m.withModifiers)(p,['stop'])},[...a[2]||(a[2]=[(0,m.createElementVNode)('i',{class:'fas fa-file-import'},null,-1)])])])]),(0,m.createCommentVNode)(' 剧情推进设置 '),(0,m.createElementVNode)('div',Ci,[a[6]||(a[6]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 剧情推进 '),(0,m.createElementVNode)('span',{class:'hint'},'切换 AI 叙事风格')],-1)),(0,m.createElementVNode)('div',Ni,[(0,m.createElementVNode)('select',{class:'acu-select',value:l.value,style:{flex:'1'},onChange:u},[a[4]||(a[4]=(0,m.createElementVNode)('option',{value:'',disabled:''},'选择预设...',-1)),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(r.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('option',{key:e,value:e},(0,m.toDisplayString)(e),9,Ei))),128))],40,Vi),(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'粘贴导入剧情预设',onClick:(0,m.withModifiers)(f,['stop'])},[...a[5]||(a[5]=[(0,m.createElementVNode)('i',{class:'fas fa-file-import'},null,-1)])])])])])])])):(0,m.createCommentVNode)('v-if',!0)}}),Ti={class:'acu-modal-header'},Si={class:'acu-modal-title'},Di={class:'acu-history-layout acu-pc-layout'},Ai={key:0,class:'acu-loading-state'},zi={key:1,class:'acu-empty-hint'},Ii={key:2,class:'acu-history-list'},_i=['open','onToggle'],Mi={class:'acu-history-summary'},Ui={class:'acu-history-title'},Pi={class:'acu-history-time'},$i={class:'acu-history-card-wrapper'},Li={class:'acu-current-card-label'},Fi={key:0,class:'acu-changes-count'},ji={class:'acu-current-card'},Oi={class:'acu-history-actions'},Ri=['disabled'],Hi=['disabled'],Wi={class:'acu-config-hint'},Yi={key:0},Xi={key:1},Gi={class:'acu-history-mobile-list'},qi={key:0,class:'acu-loading-state'},Ki={key:1,class:'acu-empty-hint'},Ji={key:2,class:'acu-history-list'},Zi=['open','onToggle'],Qi={class:'acu-history-summary'},el={class:'acu-history-title'},tl={class:'acu-history-time'},al={class:'acu-history-card-wrapper'},ol={class:'acu-mobile-actions'},nl={class:'acu-mobile-history-section'},rl={class:'acu-history-scroll'},il={key:0,class:'acu-empty-hint'},ll={key:1,class:'acu-history-list'},cl=['open','onToggle'],sl={class:'acu-history-summary'},dl={class:'acu-history-title'},ul={class:'acu-history-time'},pl={class:'acu-history-card-wrapper'},ml={class:'acu-mobile-current-section'},fl={class:'acu-section-label'},gl={key:0,class:'acu-changes-count'},vl={class:'acu-current-scroll'},bl={class:'acu-mobile-actions'},hl=['disabled'],xl=['disabled'],wl={key:0,class:'acu-preview-overlay'},yl=(0,m.defineComponent)({__name:'HistoryDialog',props:{visible:{type:Boolean,default:!1},tableName:{},tableId:{},rowIndex:{},currentRowData:{default:null},titleColIndex:{default:-1},headers:{default:()=>[]}},emits:['update:visible','close','apply'],setup(e,{emit:t}){const a=e,o=t,n=(0,f.JH)(),{getSnapshots:r,snapshotToTableRow:i,tableRowToCells:l,formatRelativeTime:c,getDiff:s,getCurrentChatId:d}=((0,y.D)(),(0,B.m)()),{isMobile:u}=De(),p=(0,m.ref)([]),g=(0,m.ref)(!1),v=(0,m.ref)(!1),b=(0,m.ref)(new Map),h=(0,m.ref)([]),x=(0,m.ref)(null),w=(0,m.ref)(!1),k=(0,m.ref)(''),C=(0,m.ref)(-1),N=(0,m.computed)(()=>n.config.cardWidth||280),V=(0,m.computed)(()=>{if(a.titleColIndex>=0)return a.titleColIndex;if(a.tableName.includes('总结')||a.tableName.includes('大纲')){if(a.headers.length>0){const e=a.headers.findIndex(e=>e&&(e.includes('索引')||e.includes('编号')||e.includes('代码')));if(e>0)return e}if(a.currentRowData){const e=a.currentRowData.cells.findIndex(e=>e.key&&(e.key.includes('索引')||e.key.includes('编号')||e.key.includes('代码')));if(e>0)return e}}return 1}),E=(0,m.computed)(()=>{const e=function(e){if(!e)return'';const t=V.value;if(t>=0&&e.cells.length>t){const a=e.cells[t]?.value;return void 0!==a?String(a):''}return''}(a.currentRowData);return e?`${a.tableName} - ${e}`:a.tableName}),T=(0,m.computed)(()=>new Set(b.value.keys())),S=(0,m.computed)(()=>[...b.value.entries()].map(([e,t])=>`${e}:${t.substring(0,10)}`).join(',')),D=(0,m.computed)(()=>a.currentRowData?0===b.value.size?a.currentRowData:{index:a.currentRowData.index,key:a.currentRowData.key,cells:a.currentRowData.cells.map((e,t)=>b.value.has(t)?{...e,value:b.value.get(t)}:e)}:{index:0,key:'',cells:[]});function A(e){const t=V.value;return t>=0&&e.cells[t]?e.cells[t]:''}function I(e){return a.currentRowData?i(e,a.currentRowData):{index:0,key:'',cells:[]}}function M(e){const t=l(D.value);return s(e,t)}function U(e,t){t.target.open&&v.value&&(x.value=e)}function P(){v.value=!0,b.value=new Map,h.value=[],x.value=p.value.length>0?p.value[0]:null}function L(){v.value=!1,b.value=new Map,h.value=[],x.value=null}function F(e,t){if(!v.value)return;x.value=e,h.value.push(new Map(b.value));const a=e.cells[t];if(void 0!==a){const e=new Map(b.value);e.set(t,a),b.value=e}}function j(){if(!x.value)return;h.value.push(new Map(b.value));const e=new Map;for(const[t,a]of Object.entries(x.value.cells))e.set(Number(t),a);b.value=e}function O(){0!==h.value.length&&(b.value=new Map(h.value.pop()))}function R(){w.value=!0}function H(){w.value=!1}function W(){b.value.size>0&&o('apply',new Map(b.value)),o('update:visible',!1),o('close')}function Y(){p.value=[],v.value=!1,b.value=new Map,h.value=[],x.value=null,w.value=!1}async function X(){g.value=!0;try{console.info('[HistoryDialog] 加载历史快照, 参数:',{tableName:a.tableName,tableId:a.tableId,rowIndex:a.rowIndex}),p.value=await r(a.tableName,a.rowIndex),console.info('[HistoryDialog] 加载到快照数量:',p.value.length),p.value.length>0&&console.info('[HistoryDialog] 快照示例:',p.value[0])}catch(e){console.error('[HistoryDialog] 加载历史快照失败:',e),p.value=[]}finally{g.value=!1}}return(0,m.watch)(()=>a.visible,e=>{e?(console.info('[HistoryDialog] visible 变为 true，开始加载数据'),k.value=a.tableName,C.value=a.rowIndex,Y(),X()):Y()},{immediate:!0}),(0,m.watch)(()=>[a.tableName,a.rowIndex],([e,t])=>{a.visible&&(e===k.value&&t===C.value||(console.info('[HistoryDialog] 行参数变化，重新加载数据'),k.value=e,C.value=t,Y(),X()))}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container',onClick:(0,m.withModifiers)(W,['self'])},[(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-modal acu-history-modal',{'acu-mobile-edit-mode':v.value}])},[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',Ti,[(0,m.createCommentVNode)(' 移动端拖动把手 '),a[1]||(a[1]=(0,m.createElementVNode)('div',{class:'acu-drag-handle acu-mobile-only'},null,-1)),(0,m.createElementVNode)('span',Si,[a[0]||(a[0]=(0,m.createElementVNode)('i',{class:'fas fa-history'},null,-1)),(0,m.createTextVNode)(' 历史记录 - '+(0,m.toDisplayString)(E.value),1)]),(0,m.createCommentVNode)(' PC端在头部显示完成按钮 '),(0,m.createElementVNode)('button',{class:'acu-close-pill acu-pc-only',onClick:W},'完成')]),(0,m.createCommentVNode)(' PC 端布局：左右分栏（使用 CSS 媒体查询控制显示） '),(0,m.createElementVNode)('div',Di,[(0,m.createCommentVNode)(' 左侧：历史记录列表 '),(0,m.createElementVNode)('div',{class:'acu-history-sidebar',style:(0,m.normalizeStyle)({width:`${N.value+64}px`})},[g.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Ai,[...a[2]||(a[2]=[(0,m.createElementVNode)('i',{class:'fas fa-spinner fa-spin'},null,-1),(0,m.createElementVNode)('span',null,'加载历史记录...',-1)])])):0===p.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',zi,[...a[3]||(a[3]=[(0,m.createElementVNode)('i',{class:'fas fa-history'},null,-1),(0,m.createElementVNode)('span',null,'暂无历史记录',-1)])])):((0,m.openBlock)(),(0,m.createElementBlock)('div',Ii,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(p.value,(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('details',{key:t.id||t.timestamp,open:0===a,class:'acu-history-item',onToggle:e=>U(t,e)},[(0,m.createElementVNode)('summary',Mi,[(0,m.createElementVNode)('span',{class:(0,m.normalizeClass)(['acu-history-badge',t.source])},(0,m.toDisplayString)('manual'===t.source?'手动':'AI'),3),(0,m.createElementVNode)('span',Ui,' #'+(0,m.toDisplayString)(a+1)+' '+(0,m.toDisplayString)(A(t)),1),(0,m.createElementVNode)('span',Pi,(0,m.toDisplayString)((0,m.unref)(c)(t.timestamp)),1)]),(0,m.createElementVNode)('div',$i,[(0,m.createVNode)(Lt,{data:I(t),'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!1,'show-index':!1,'show-history-button':!1,'title-col-index':V.value,'custom-highlights':v.value?M(t):void 0,'allow-edit':!1,onCellClick:(e,a)=>F(t,a)},null,8,['data','table-name','table-id','title-col-index','custom-highlights','onCellClick'])])],40,_i))),128))]))],4),(0,m.createCommentVNode)(' 右侧：当前卡片 + 操作区 '),(0,m.createElementVNode)('div',{class:'acu-history-main',style:(0,m.normalizeStyle)({width:`${N.value+64}px`})},[(0,m.createElementVNode)('div',Li,[a[4]||(a[4]=(0,m.createElementVNode)('i',{class:'fas fa-file-alt'},null,-1)),a[5]||(a[5]=(0,m.createTextVNode)(' 当前版本 ',-1)),b.value.size>0?((0,m.openBlock)(),(0,m.createElementBlock)('span',Fi,' (已修改 '+(0,m.toDisplayString)(b.value.size)+' 处) ',1)):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createElementVNode)('div',ji,[((0,m.openBlock)(),(0,m.createBlock)(Lt,{key:`current-pc-${S.value}`,data:D.value,'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!0,'show-index':!0,'show-history-button':!1,'title-col-index':V.value,'custom-highlights':T.value},null,8,['data','table-name','table-id','title-col-index','custom-highlights']))]),(0,m.createCommentVNode)(' 操作按钮 '),(0,m.createElementVNode)('div',Oi,[v.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createElementVNode)('button',{class:'acu-modal-btn primary',disabled:!x.value,onClick:j},[...a[7]||(a[7]=[(0,m.createElementVNode)('i',{class:'fas fa-layer-group'},null,-1),(0,m.createTextVNode)(' 整卡覆盖 ',-1)])],8,Ri),(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary',disabled:0===h.value.length,onClick:O},[...a[8]||(a[8]=[(0,m.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,m.createTextVNode)(' 撤销 ',-1)])],8,Hi),(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:L},[...a[9]||(a[9]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1),(0,m.createTextVNode)(' 退出编辑',-1)])])],64)):((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-modal-btn primary acu-btn-start-edit',onClick:P},[...a[6]||(a[6]=[(0,m.createElementVNode)('i',{class:'fas fa-edit'},null,-1),(0,m.createTextVNode)(' 启动编辑 ',-1)])]))]),(0,m.createCommentVNode)(' 提示信息 '),(0,m.createElementVNode)('div',Wi,[a[10]||(a[10]=(0,m.createElementVNode)('i',{class:'fas fa-info-circle'},null,-1)),v.value?((0,m.openBlock)(),(0,m.createElementBlock)('span',Xi,'点击左侧历史卡片的单元格进行覆盖')):((0,m.openBlock)(),(0,m.createElementBlock)('span',Yi,'点击"启动编辑"开始修改'))])],4)]),(0,m.createCommentVNode)(' 移动端布局：全屏分区（使用 CSS 媒体查询控制显示） '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-history-layout acu-mobile-layout',{'acu-mobile-edit-mode':v.value}])},[(0,m.createCommentVNode)(' 非编辑模式：只显示历史列表 '),v.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 编辑模式：上下分屏 '),(0,m.createCommentVNode)(' 上半部分：历史记录滚动区 '),(0,m.createElementVNode)('div',nl,[a[17]||(a[17]=(0,m.createElementVNode)('div',{class:'acu-section-label'},[(0,m.createElementVNode)('i',{class:'fas fa-history'}),(0,m.createTextVNode)(' 历史记录（点击单元格覆盖）')],-1)),(0,m.createElementVNode)('div',rl,[0===p.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',il,[...a[16]||(a[16]=[(0,m.createElementVNode)('i',{class:'fas fa-history'},null,-1),(0,m.createElementVNode)('span',null,'暂无历史记录',-1)])])):((0,m.openBlock)(),(0,m.createElementBlock)('div',ll,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(p.value,(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('details',{key:t.id||t.timestamp,open:0===a,class:'acu-history-item',onToggle:e=>U(t,e)},[(0,m.createElementVNode)('summary',sl,[(0,m.createElementVNode)('span',{class:(0,m.normalizeClass)(['acu-history-badge',t.source])},(0,m.toDisplayString)('manual'===t.source?'手动':'AI'),3),(0,m.createElementVNode)('span',dl,' #'+(0,m.toDisplayString)(a+1)+' '+(0,m.toDisplayString)(A(t)),1),(0,m.createElementVNode)('span',ul,(0,m.toDisplayString)((0,m.unref)(c)(t.timestamp)),1)]),(0,m.createElementVNode)('div',pl,[(0,m.createVNode)(Lt,{data:I(t),'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!1,'show-index':!1,'show-history-button':!1,'title-col-index':V.value,'custom-highlights':M(t),'allow-edit':!1,onCellClick:(e,a)=>F(t,a)},null,8,['data','table-name','table-id','title-col-index','custom-highlights','onCellClick'])])],40,cl))),128))]))])]),(0,m.createCommentVNode)(' 下半部分：当前版本滚动区 '),(0,m.createElementVNode)('div',ml,[(0,m.createElementVNode)('div',fl,[a[18]||(a[18]=(0,m.createElementVNode)('i',{class:'fas fa-file-alt'},null,-1)),a[19]||(a[19]=(0,m.createTextVNode)(' 当前版本 ',-1)),b.value.size>0?((0,m.openBlock)(),(0,m.createElementBlock)('span',gl,'(已修改 '+(0,m.toDisplayString)(b.value.size)+' 处)',1)):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createElementVNode)('div',vl,[((0,m.openBlock)(),(0,m.createBlock)(Lt,{key:`current-mobile-${S.value}`,data:D.value,'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!0,'show-index':!0,'show-history-button':!1,'title-col-index':V.value,'custom-highlights':T.value},null,8,['data','table-name','table-id','title-col-index','custom-highlights']))])]),(0,m.createCommentVNode)(' 编辑模式底部按钮 '),(0,m.createElementVNode)('div',bl,[(0,m.createElementVNode)('button',{disabled:0===h.value.length,onClick:O},[...a[20]||(a[20]=[(0,m.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,m.createTextVNode)(' 撤销',-1)])],8,hl),(0,m.createElementVNode)('button',{class:'acu-btn-primary',disabled:!x.value,onClick:j},[...a[21]||(a[21]=[(0,m.createElementVNode)('i',{class:'fas fa-layer-group'},null,-1),(0,m.createTextVNode)(' 整卡覆盖 ',-1)])],8,xl),(0,m.createElementVNode)('button',{onClick:L},[...a[22]||(a[22]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1),(0,m.createTextVNode)(' 退出编辑',-1)])]),(0,m.createElementVNode)('button',{class:'acu-btn-done',onClick:W},[...a[23]||(a[23]=[(0,m.createElementVNode)('i',{class:'fas fa-check'},null,-1),(0,m.createTextVNode)(' 完成',-1)])])])],64)):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[(0,m.createElementVNode)('div',Gi,[g.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',qi,[...a[11]||(a[11]=[(0,m.createElementVNode)('i',{class:'fas fa-spinner fa-spin'},null,-1),(0,m.createElementVNode)('span',null,'加载历史记录...',-1)])])):0===p.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',Ki,[...a[12]||(a[12]=[(0,m.createElementVNode)('i',{class:'fas fa-history'},null,-1),(0,m.createElementVNode)('span',null,'暂无历史记录',-1)])])):((0,m.openBlock)(),(0,m.createElementBlock)('div',Ji,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(p.value,(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('details',{key:t.id||t.timestamp,open:0===a,class:'acu-history-item',onToggle:e=>U(t,e)},[(0,m.createElementVNode)('summary',Qi,[(0,m.createElementVNode)('span',{class:(0,m.normalizeClass)(['acu-history-badge',t.source])},(0,m.toDisplayString)('manual'===t.source?'手动':'AI'),3),(0,m.createElementVNode)('span',el,' #'+(0,m.toDisplayString)(a+1)+' '+(0,m.toDisplayString)(A(t)),1),(0,m.createElementVNode)('span',tl,(0,m.toDisplayString)((0,m.unref)(c)(t.timestamp)),1)]),(0,m.createElementVNode)('div',al,[(0,m.createVNode)(Lt,{data:I(t),'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!1,'show-index':!1,'show-history-button':!1,'title-col-index':V.value,'allow-edit':!1},null,8,['data','table-name','table-id','title-col-index'])])],40,Zi))),128))]))]),(0,m.createCommentVNode)(' 非编辑模式底部按钮 '),(0,m.createElementVNode)('div',ol,[(0,m.createElementVNode)('button',{class:'acu-btn-preview',onTouchstart:(0,m.withModifiers)(R,['prevent']),onTouchend:(0,m.withModifiers)(H,['prevent']),onMousedown:R,onMouseup:H,onMouseleave:H},[...a[13]||(a[13]=[(0,m.createElementVNode)('i',{class:'fas fa-eye'},null,-1),(0,m.createTextVNode)(' 预览最新 ',-1)])],32),(0,m.createElementVNode)('button',{class:'acu-btn-primary',onClick:P},[...a[14]||(a[14]=[(0,m.createElementVNode)('i',{class:'fas fa-edit'},null,-1),(0,m.createTextVNode)(' 启动编辑',-1)])]),(0,m.createElementVNode)('button',{class:'acu-btn-done',onClick:W},[...a[15]||(a[15]=[(0,m.createElementVNode)('i',{class:'fas fa-check'},null,-1),(0,m.createTextVNode)(' 完成',-1)])])])],64)),(0,m.createCommentVNode)(' 预览悬浮层 '),(0,m.createVNode)(m.Transition,{name:'preview-fade'},{default:(0,m.withCtx)(()=>[w.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',wl,[(0,m.createVNode)(Lt,{data:D.value,'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!0,'show-index':!0,'show-history-button':!1,'title-col-index':V.value},null,8,['data','table-name','table-id','title-col-index'])])):(0,m.createCommentVNode)('v-if',!0)]),_:1})],2)],2)])):(0,m.createCommentVNode)('v-if',!0)}}),kl=yl,Cl=['📦','🏷️','📁','📂','📄','📝','📌','📍','📎','🔒','🔓','🔑','⚙️','🔧','🔨','🛠️','⚖️','🛒','💰','💎','❤️','🧡','💛','💚','💙','💜','🖤','🤍','🤎','💔','⭐','🌟','✨','⚡','🔥','💧','❄️','🌈','☀️','🌙','😀','😃','😄','😁','😆','😅','😂','🤣','😊','😇','🙂','🙃','😉','😌','😍','🥰','😘','😗','😙','😚','😋','😛','😝','😜','🤪','🤨','🧐','🤓','😎','🤩','🥳','😏','😒','😞','😔','😟','😕','🙁','☹️','😣','😖','😫','😩','🥺','😢','😭','😤','😠','😡','🤬','🤯','😳','🥵','🥶','😱','😨','😰','😥','😓','🤗','🤔','🤭','🤫','🤥','😶','😐','😑','😬','🙄','😯','😦','😧','😮','😲','🥱','😴','🤤','😪','😵','🤐','🥴','🤢','🤮','🤧','😷','🤒','🤕','🤑','🤠','😈','👿','👹','👺','🤡','💩','👻','💀','☠️','👽','👾','🤖','🎃','😺','😸','😹','😻','😼','😽','🙀','😿','😾','👋','🤚','🖐️','✋','🖖','👌','🤏','✌️','🤞','🤟','🤘','🤙','👈','👉','👆','🖕','👇','☝️','👍','👎','✊','👊','🤛','🤜','👏','🙌','👐','🤲','🤝','🙏','✍️','💅','🤳','💪','🦾','🦿','🦵','🦶','👂','🦻','👃','🧠','🦷','🦴','👀','👁️','👅','👄','💋','👶','🧒','👦','👧','🧑','👱','👨','🧔','👨‍🦰','👨‍🦱','👨‍🦳','👨‍🦲','👩','👩‍🦰','👩‍🦱','👩‍🦳','👩‍🦲','👱‍♀️','👱‍♂️','🧓','👴','👵','🙍','🙍‍♂️','🙍‍♀️','🙎','🙎‍♂️','🙎‍♀️','🙅','🙅‍♂️','🙅‍♀️','🙆','🙆‍♂️','🙆‍♀️','💁','💁‍♂️','💁‍♀️','🙋','🙋‍♂️','🙋‍♀️','🙇','🙇‍♂️','🙇‍♀️','🤦','🤦‍♂️','🤦‍♀️','🤷','🤷‍♂️','🤷‍♀️','👨‍⚕️','👩‍⚕️','👨‍🎓','👩‍🎓','👨‍🏫','👩‍🏫','👨‍⚖️','👩‍⚖️','👨‍🌾','👩‍🌾','👨‍🍳','👩‍🍳','👨‍🔧','👩‍🔧','👨‍🏭','👩‍🏭','👨‍💼','👩‍💼','👨‍🔬','👩‍🔬','👨‍💻','👩‍💻','👨‍🎤','👩‍🎤','👨‍🎨','👩‍🎨','👨‍✈️','👩‍✈️','👨‍🚀','👩‍🚀','👨‍🚒','👩‍🚒','👮','👮‍♂️','👮‍♀️','🕵️','🕵️‍♂️','🕵️‍♀️','💂','💂‍♂️','💂‍♀️','👷','👷‍♂️','👷‍♀️','🤴','👸','👳','👳‍♂️','👳‍♀️','👲','🧕','🤵','👰','🤰','🤱','👼','🎅','🤶','🦸','🦸‍♂️','🦸‍♀️','🦹','🦹‍♂️','🦹‍♀️','🧙','🧙‍♂️','🧙‍♀️','🧚','🧚‍♂️','🧚‍♀️','🧛','🧛‍♂️','🧛‍♀️','🧜','🧜‍♂️','🧜‍♀️','🧝','🧝‍♂️','🧝‍♀️','🧞','🧞‍♂️','🧞‍♀️','🧟','🧟‍♂️','🧟‍♀️','💆','💆‍♂️','💆‍♀️','💇','💇‍♂️','💇‍♀️','🚶','🚶‍♂️','🚶‍♀️','🏃','🏃‍♂️','🏃‍♀️','💃','🕺','🕴️','👯','👯‍♂️','👯‍♀️','🧖','🧖‍♂️','🧖‍♀️','🧘','🧘‍♂️','🧘‍♀️','⚔️','🛡️','🏹','🔮','🧿','📿','🏺','📜','🩸','💊','🩹','🦠'],Nl=['fas fa-star','far fa-star','fas fa-heart','far fa-heart','fas fa-user','far fa-user','fas fa-check','fas fa-times','fas fa-plus','fas fa-minus','fas fa-cog','fas fa-home','fas fa-search','fas fa-envelope','far fa-envelope','fas fa-bell','far fa-bell','fas fa-calendar','far fa-calendar','fas fa-clock','far fa-clock','fas fa-camera','fas fa-image','far fa-image','fas fa-video','fas fa-music','fas fa-microphone','fas fa-headphones','fas fa-book','fas fa-bookmark','far fa-bookmark','fas fa-folder','far fa-folder','fas fa-folder-open','far fa-folder-open','fas fa-file','far fa-file','fas fa-file-alt','far fa-file-alt','fas fa-download','fas fa-upload','fas fa-cloud','fas fa-comment','far fa-comment','fas fa-comments','far fa-comments','fas fa-quote-left','fas fa-quote-right','fas fa-pen','fas fa-edit','far fa-edit','fas fa-trash','far fa-trash-alt','fas fa-save','far fa-save','fas fa-share','fas fa-share-alt','fas fa-reply','fas fa-history','fas fa-list','fas fa-list-ul','fas fa-list-ol','fas fa-th','fas fa-th-list','fas fa-bars','fas fa-ellipsis-h','fas fa-ellipsis-v','fas fa-arrow-right','fas fa-arrow-left','fas fa-arrow-up','fas fa-arrow-down','fas fa-chevron-right','fas fa-chevron-left','fas fa-chevron-up','fas fa-chevron-down','fas fa-caret-right','fas fa-caret-left','fas fa-caret-up','fas fa-caret-down','fas fa-angle-right','fas fa-angle-left','fas fa-angle-up','fas fa-angle-down','fas fa-play','fas fa-pause','fas fa-stop','fas fa-forward','fas fa-backward','fas fa-fast-forward','fas fa-fast-backward','fas fa-step-forward','fas fa-step-backward','fas fa-info-circle','fas fa-question-circle','fas fa-exclamation-circle','fas fa-exclamation-triangle','fas fa-lock','fas fa-unlock','fas fa-key','fas fa-shield-alt','fas fa-bug','fas fa-code','fas fa-terminal','fas fa-database','fas fa-server','fas fa-network-wired','fas fa-wifi','fas fa-signal','fas fa-battery-full','fas fa-power-off','fas fa-desktop','fas fa-laptop','fas fa-mobile-alt','fas fa-tablet-alt','fas fa-gamepad','fas fa-keyboard','fas fa-mouse','fas fa-print','fas fa-cube','fas fa-cubes','fas fa-puzzle-piece','fas fa-lightbulb','far fa-lightbulb','fas fa-magic','fas fa-crown','fas fa-gem','far fa-gem','fas fa-gift','fas fa-trophy','fas fa-medal','fas fa-certificate','fas fa-map-marker-alt','fas fa-map','far fa-map','fas fa-location-arrow','fas fa-compass','far fa-compass','fas fa-globe','fas fa-globe-americas','fas fa-flag','far fa-flag','fas fa-plane','fas fa-car','fas fa-bus','fas fa-train','fas fa-bicycle','fas fa-walking','fas fa-running','fas fa-wheelchair','fas fa-shopping-cart','fas fa-shopping-bag','fas fa-credit-card','far fa-credit-card','fas fa-money-bill-wave','fas fa-tag','fas fa-tags','fas fa-ticket-alt','fas fa-users','fas fa-user-friends','fas fa-user-plus','fas fa-user-minus','fas fa-user-check','fas fa-user-times','fas fa-user-circle','far fa-user-circle','fas fa-id-card','far fa-id-card','fas fa-address-book','far fa-address-book','fas fa-address-card','far fa-address-card','fas fa-smile','far fa-smile','fas fa-frown','far fa-frown','fas fa-meh','far fa-meh','fas fa-hand-paper','far fa-hand-paper','fas fa-thumbs-up','far fa-thumbs-up','fas fa-thumbs-down','far fa-thumbs-down','fas fa-sun','far fa-sun','fas fa-moon','far fa-moon','fas fa-cloud-sun','fas fa-cloud-moon','fas fa-umbrella','fas fa-snowflake','far fa-snowflake','fas fa-fire','fas fa-water','fas fa-leaf','fas fa-seedling','fas fa-tree','fas fa-paw','fas fa-dog','fas fa-cat','fas fa-fish','fas fa-dragon','fas fa-feather','fas fa-feather-alt'],Vl={class:'acu-modal acu-icon-select-modal'},El={class:'acu-modal-header'},Bl={class:'acu-header-actions'},Tl={class:'acu-icon-tabs'},Sl={class:'acu-icon-search-bar'},Dl={class:'acu-search-input-wrapper'},Al={class:'acu-modal-body'},zl={class:'acu-icon-grid-container'},Il={key:0,class:'acu-icon-grid'},_l=['title','onClick'],Ml={key:1},Ul={key:1,class:'acu-no-icons'},Pl={class:'acu-icon-manual-input'},$l={class:'acu-manual-field'},Ll={class:'acu-preview-icon'},Fl={key:1},jl=(0,m.defineComponent)({__name:'IconSelectDialog',props:{visible:{type:Boolean},currentIcon:{default:''}},emits:['update:visible','select','close'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.ref)('emoji'),r=(0,m.ref)(''),i=(0,m.ref)('');function l(e){return e.startsWith('fa')||e.includes(' fa-')}(0,m.watch)(()=>a.visible,e=>{e&&(i.value=a.currentIcon,r.value='',a.currentIcon&&l(a.currentIcon)?n.value='fa':n.value='emoji')});const c=(0,m.computed)(()=>{const e=r.value.toLowerCase().trim(),t='emoji'===n.value?Cl:Nl;return e?t.filter(t=>t.toLowerCase().includes(e)):t});function s(){o('update:visible',!1),o('close')}function d(e){o('select',e),s()}function u(){}function p(){const e=i.value.trim();e&&d(e)}return(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(s,['self'])},[(0,m.createElementVNode)('div',Vl,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',El,[a[4]||(a[4]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},'选择图标',-1)),(0,m.createElementVNode)('div',Bl,[(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(s,['stop'])},'取消')])]),(0,m.createCommentVNode)(' 顶部 Tab 栏 '),(0,m.createElementVNode)('div',Tl,[(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-icon-tab',{active:'emoji'===n.value}]),onClick:a[0]||(a[0]=e=>n.value='emoji')},' Emoji 表情 ',2),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-icon-tab',{active:'fa'===n.value}]),onClick:a[1]||(a[1]=e=>n.value='fa')},'FontAwesome',2)]),(0,m.createCommentVNode)(' 搜索栏 '),(0,m.createElementVNode)('div',Sl,[(0,m.createElementVNode)('div',Dl,[a[5]||(a[5]=(0,m.createElementVNode)('i',{class:'fas fa-search'},null,-1)),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[2]||(a[2]=e=>r.value=e),type:'text',placeholder:'搜索图标...',onInput:u},null,544),[[m.vModelText,r.value]])])]),(0,m.createCommentVNode)(' 内容区域 '),(0,m.createElementVNode)('div',Al,[(0,m.createElementVNode)('div',zl,[c.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',Il,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(c.value,t=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t,class:(0,m.normalizeClass)(['acu-icon-item',{selected:e.currentIcon===t}]),title:t,onClick:(0,m.withModifiers)(e=>d(t),['stop'])},['fa'===n.value?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(t)},null,2)):((0,m.openBlock)(),(0,m.createElementBlock)('span',Ml,(0,m.toDisplayString)(t),1))],10,_l))),128))])):((0,m.openBlock)(),(0,m.createElementBlock)('div',Ul,[...a[6]||(a[6]=[(0,m.createElementVNode)('i',{class:'fas fa-search'},null,-1),(0,m.createElementVNode)('span',null,'未找到相关图标',-1)])]))]),(0,m.createCommentVNode)(' 底部手动输入 '),(0,m.createElementVNode)('div',Pl,[a[8]||(a[8]=(0,m.createElementVNode)('span',{class:'acu-manual-label'},'手动输入:',-1)),(0,m.createElementVNode)('div',$l,[(0,m.createElementVNode)('div',Ll,[l(i.value)?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(i.value)},null,2)):((0,m.openBlock)(),(0,m.createElementBlock)('span',Fl,(0,m.toDisplayString)(i.value),1))]),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[3]||(a[3]=e=>i.value=e),type:'text',placeholder:'输入 Emoji 或 fa-class',onKeyup:(0,m.withKeys)(p,['enter'])},null,544),[[m.vModelText,i.value]])]),(0,m.createElementVNode)('button',{class:'acu-tool-btn',onClick:(0,m.withModifiers)(p,['stop'])},[...a[7]||(a[7]=[(0,m.createElementVNode)('i',{class:'fas fa-check'},null,-1)])])])])])])):(0,m.createCommentVNode)('v-if',!0)}}),Ol={class:'acu-modal-body'},Rl={class:'floor-input-group'},Hl={key:0,class:'floor-info'},Wl={key:1,class:'floor-error'},Yl={class:'acu-modal-footer'},Xl=['disabled'],Gl=(0,m.defineComponent)({__name:'InputFloorDialog',props:{visible:{type:Boolean},currentFloorInfo:{default:''},maxFloor:{default:999}},emits:['update:visible','confirm'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.ref)(),r=(0,m.ref)(),i=(0,m.ref)(null),l=(0,m.computed)(()=>{if(null===i.value||void 0===i.value)return!1;const e=i.value;return Number.isInteger(e)&&0!==e}),c=(0,m.computed)(()=>null===i.value||void 0===i.value?'':0===i.value?'楼层索引不能为 0':Number.isInteger(i.value)?Math.abs(i.value)>a.maxFloor?`楼层索引超出范围 (±${a.maxFloor})`:'':'请输入整数');(0,m.watch)(()=>a.visible,e=>{e&&(i.value=null,(0,m.nextTick)(()=>{r.value?.focus()}))}),(0,Be.X2F)(n,()=>{d()});const s=()=>{l.value&&null!==i.value&&(o('confirm',i.value),o('update:visible',!1))},d=()=>{o('update:visible',!1)};return(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(d,['self'])},[(0,m.createElementVNode)('div',{ref_key:'dialogRef',ref:n,class:'acu-modal acu-input-floor-modal'},[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',{class:'acu-modal-header'},[a[2]||(a[2]=(0,m.createElementVNode)('h3',null,[(0,m.createElementVNode)('i',{class:'fas fa-layer-group'}),(0,m.createTextVNode)(' 指定保存楼层 ')],-1)),(0,m.createElementVNode)('button',{class:'acu-modal-close',onClick:d},[...a[1]||(a[1]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',Ol,[(0,m.createElementVNode)('div',Rl,[a[5]||(a[5]=(0,m.createElementVNode)('p',{class:'floor-hint'},'输入目标楼层索引。正数为从头开始计数，负数为倒数计数（-1 表示最后一楼）。',-1)),(0,m.withDirectives)((0,m.createElementVNode)('input',{ref_key:'inputRef',ref:r,'onUpdate:modelValue':a[0]||(a[0]=e=>i.value=e),type:'number',class:'floor-input',placeholder:'例如: 5 或 -1',onKeydown:[(0,m.withKeys)(s,['enter']),(0,m.withKeys)(d,['escape'])]},null,544),[[m.vModelText,i.value,void 0,{number:!0}]]),e.currentFloorInfo?((0,m.openBlock)(),(0,m.createElementBlock)('div',Hl,[a[3]||(a[3]=(0,m.createElementVNode)('i',{class:'fas fa-info-circle'},null,-1)),(0,m.createElementVNode)('span',null,'当前自动目标楼层: '+(0,m.toDisplayString)(e.currentFloorInfo),1)])):(0,m.createCommentVNode)('v-if',!0),c.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Wl,[a[4]||(a[4]=(0,m.createElementVNode)('i',{class:'fas fa-exclamation-circle'},null,-1)),(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(c.value),1)])):(0,m.createCommentVNode)('v-if',!0)])]),(0,m.createCommentVNode)(' 底部 '),(0,m.createElementVNode)('div',Yl,[(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:d},'取消'),(0,m.createElementVNode)('button',{class:'acu-modal-btn primary',disabled:!l.value,onClick:s},[...a[6]||(a[6]=[(0,m.createElementVNode)('i',{class:'fas fa-save'},null,-1),(0,m.createTextVNode)(' 保存到此楼层 ',-1)])],8,Xl)])],512)])):(0,m.createCommentVNode)('v-if',!0)}}),ql={class:'acu-modal-body'},Kl={key:0,class:'acu-loading-state'},Jl={class:'acu-update-layout'},Zl={class:'acu-update-left'},Ql={class:'acu-settings-section'},ec={class:'acu-settings-row'},tc={class:'acu-settings-control acu-preset-control'},ac=['value'],oc={class:'acu-settings-row'},nc={class:'acu-settings-control'},rc=['value'],ic={class:'acu-settings-section'},lc={class:'acu-settings-row'},cc={class:'acu-settings-control'},sc={class:'acu-settings-row'},dc={class:'acu-settings-control'},uc={class:'acu-settings-row'},pc={class:'acu-settings-control'},mc={class:'acu-settings-row'},fc={class:'acu-settings-control'},gc={class:'acu-settings-section acu-show-mobile-only'},vc={class:'acu-collapse-indicator'},bc={class:'acu-table-selector-mobile'},hc={class:'acu-settings-section'},xc={class:'acu-settings-row'},wc={class:'acu-settings-control'},yc={class:'acu-switch'},kc={key:0,class:'acu-settings-row'},Cc={class:'acu-settings-control'},Nc={class:'acu-switch'},Vc={key:0,class:'acu-settings-section'},Ec={class:'acu-update-right acu-hide-mobile'},Bc={key:0,class:'acu-issue-alert'},Tc={class:'acu-update-action-group'},Sc=['disabled'],Dc={key:0,class:'fas fa-spinner fa-spin'},Ac={key:1,class:'fas fa-hand-sparkles'},zc=(0,m.defineComponent)({__name:'ManualUpdateDialog',props:{visible:{type:Boolean}},emits:['update:visible'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.ref)(),r=(0,m.ref)(!0),i=(0,m.ref)(!1),l=(0,m.reactive)({autoUpdateThreshold:void 0,autoUpdateFrequency:void 0,updateBatchSize:void 0,skipUpdateFloors:void 0}),c=(0,m.ref)(''),s=(0,m.ref)(''),d=(0,k.j_)(),u=(0,m.ref)(!1),p=(0,m.ref)(!1),f=(0,m.ref)([]),g=(0,m.ref)([]),v=(0,m.ref)(!1),b=(0,m.ref)([]),h=(0,m.ref)([]),{settings:x,loadSettings:w,saveSettings:C,executeManualUpdate:N,getTableList:V,executeWithPreset:B}=E(),T=ee(),S=(0,y.D)(),D=(0,m.computed)(()=>T.presets.value),A=(0,m.computed)(()=>S.hasIntegrityIssues),I=(0,m.computed)(()=>S.getIntegritySummary()),M=((0,m.computed)(()=>0!==f.value.length&&g.value.length===f.value.length),(0,m.computed)(()=>{const e=f.value.filter(e=>e.isSummaryOrOutline);return 0!==e.length&&(g.value.length===e.length&&e.every(e=>g.value.includes(e.name)))}),(0,m.computed)(()=>b.value.map(e=>({key:e,label:e})))),U=(0,m.computed)(()=>f.value.map(e=>({key:e.name,label:e.name,badge:e.isSummaryOrOutline?'★':void 0})));(0,m.computed)(()=>0!==b.value.length&&h.value.length===b.value.length);function P(){o('update:visible',!1)}async function L(e,t){if(void 0!==t&&!isNaN(t))try{await C({[e]:t}),console.info(`[ACU] 配置项 ${e} 已更新为:`,t)}catch(t){console.error(`[ACU] 保存配置项 ${e} 失败:`,t),O.toast.error('保存配置失败')}}async function F(){if(!c.value)return;const e=D.value.find(e=>e.id===c.value);e&&(Object.assign(l,e.settings),g.value=e.autoTrigger.updateTargetTables||[],await C(e.settings),T.setActivePreset(c.value),O.toast.success('已应用预设配置'))}function j(){T.setAutoFixPreset(s.value||null),O.toast.info(s.value?'已设置自动修复预设':'已禁用自动修复')}function R(){const e=[`上下文层数: ${l.autoUpdateThreshold}`,`更新频率: 每 ${l.autoUpdateFrequency} 层`,`批次大小: ${l.updateBatchSize}`,`跳过层数: ${l.skipUpdateFloors}`,`表格选择: ${g.value.length?g.value.join(', '):'全部表格'}`];d.openPresetSaveDialog({presetType:'manual-update',summaryItems:e,initialName:'',checkDuplicate:e=>null!==T.findPresetByName(e)},{onSave:e=>{const{preset:t,isNew:a}=T.createOrUpdatePreset(e,{autoUpdateThreshold:l.autoUpdateThreshold,updateBatchSize:l.updateBatchSize,skipUpdateFloors:l.skipUpdateFloors,autoUpdateFrequency:l.autoUpdateFrequency},{enabled:u.value,onEmptyCell:!0,onIndexGap:!0,targetTables:['总结表','大纲表'],updateTargetTables:g.value,emptyCheckColumns:h.value});a?O.toast.success(`预设"${e}"已创建`):O.toast.success(`预设"${e}"已更新`)}})}function H(){if(!c.value)return;const e=c.value,t=D.value.find(t=>t.id===e);t&&confirm(`确定删除预设"${t.name}"吗？`)&&(T.deletePreset(c.value),c.value='',O.toast.success('预设已删除'))}function W(){T.setGlobalAutoTrigger(u.value),c.value&&T.updatePreset(c.value,{autoTrigger:{enabled:u.value,onEmptyCell:!0,onIndexGap:!0,targetTables:['总结表','大纲表'],updateTargetTables:g.value,emptyCheckColumns:h.value}}),u.value||(p.value=!1,T.setAutoFixPreset(null),S.clearIntegrityIssues())}function Y(){if(T.setGlobalAutoExecute(p.value),p.value)if(!s.value&&D.value.length>0)s.value=D.value[0].id,T.setAutoFixPreset(s.value),O.toast.info(`已自动选择预设"${D.value[0].name}"用于自动修复`);else{if(0===D.value.length)return O.toast.warning('请先保存一个预设再启用自动执行'),p.value=!1,void T.setGlobalAutoExecute(!1);T.setAutoFixPreset(s.value)}else T.setAutoFixPreset(null),s.value=''}function X(e){c.value&&T.updatePreset(c.value,{autoTrigger:{enabled:u.value,onEmptyCell:!0,onIndexGap:!0,targetTables:['总结表','大纲表'],updateTargetTables:e,emptyCheckColumns:h.value}})}function G(){c.value&&T.updatePreset(c.value,{autoTrigger:{enabled:u.value,onEmptyCell:!0,onIndexGap:!0,targetTables:['总结表','大纲表'],updateTargetTables:g.value,emptyCheckColumns:h.value}})}async function q(){if(!i.value){i.value=!0;try{const e=await B({autoUpdateThreshold:l.autoUpdateThreshold,updateBatchSize:l.updateBatchSize,skipUpdateFloors:l.skipUpdateFloors,autoUpdateFrequency:l.autoUpdateFrequency},g.value);e.success?O.toast.success('✅ 手动更新已执行'):O.toast.warning('⚠️ '+(e.message||'更新执行完成，请检查结果'))}catch(e){console.error('[ACU] 手动更新执行失败:',e),O.toast.error('手动更新执行失败')}finally{i.value=!1}}}return(0,m.watch)(()=>a.visible,async e=>{if(e){r.value=!0;try{await w(),Object.assign(l,{autoUpdateThreshold:x.value.autoUpdateThreshold,autoUpdateFrequency:x.value.autoUpdateFrequency,updateBatchSize:x.value.updateBatchSize,skipUpdateFloors:x.value.skipUpdateFloors}),T.loadPresets();const e=T.autoFixPreset.value?.id;s.value=e||'',u.value=T.globalAutoTriggerEnabled.value,p.value=T.globalAutoExecuteEnabled.value;const t=T.activePreset.value;t&&(g.value=t.autoTrigger.updateTargetTables||[],h.value=t.autoTrigger.emptyCheckColumns||[]),f.value=V(),function(){const e=f.value.filter(e=>e.isSummaryOrOutline);if(0===e.length)return void(b.value=[]);try{const t=window.parent?.AutoCardUpdaterAPI||window.AutoCardUpdaterAPI;if(!t?.exportTableAsJson)return void(b.value=[]);const a=t.exportTableAsJson(),o=new Set;for(const t of e){const e=a[t.key];e?.content?.[0]&&e.content[0].forEach(e=>{const t=String(e).trim();t&&o.add(t)})}b.value=Array.from(o)}catch(e){console.warn('[ACU] 加载可用列失败:',e),b.value=[]}}()}catch(e){console.error('[ACU] 加载配置失败:',e),O.toast.error('加载配置失败')}finally{r.value=!1}}},{immediate:!0}),(0,Be.X2F)(n,()=>{P()}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(P,['self'])},[(0,m.createElementVNode)('div',{ref_key:'dialogRef',ref:n,class:'acu-modal acu-manual-update-modal'},[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',{class:'acu-modal-header'},[(0,m.createCommentVNode)(' 返回按钮 '),(0,m.createElementVNode)('button',{class:'acu-modal-back',onClick:P},[...a[16]||(a[16]=[(0,m.createElementVNode)('i',{class:'fas fa-arrow-left'},null,-1)])]),a[17]||(a[17]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},'手动更新配置',-1)),(0,m.createCommentVNode)(' 胶囊式完成按钮 '),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:P},'完成')]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',ql,[(0,m.createCommentVNode)(' 加载状态 '),r.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Kl,[...a[18]||(a[18]=[(0,m.createElementVNode)('i',{class:'fas fa-spinner fa-spin'},null,-1),(0,m.createElementVNode)('span',null,'加载配置中...',-1)])])):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 配置项 '),(0,m.createCommentVNode)(' PC端并排布局 '),(0,m.createElementVNode)('div',Jl,[(0,m.createCommentVNode)(' 左侧：参数设置 '),(0,m.createElementVNode)('div',Zl,[(0,m.createCommentVNode)(' 预设管理区域 '),(0,m.createElementVNode)('div',Ql,[a[25]||(a[25]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-bookmark'}),(0,m.createTextVNode)(' 预设管理 ')],-1)),(0,m.createCommentVNode)(' 预设选择 '),(0,m.createElementVNode)('div',ec,[a[22]||(a[22]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 选择预设 '),(0,m.createElementVNode)('span',{class:'hint'},'快速应用保存的配置')],-1)),(0,m.createElementVNode)('div',tc,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[0]||(a[0]=e=>c.value=e),class:'acu-config-select',onChange:F},[a[19]||(a[19]=(0,m.createElementVNode)('option',{value:''},'-- 当前配置 --',-1)),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(D.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('option',{key:e.id,value:e.id},(0,m.toDisplayString)(e.name),9,ac))),128))],544),[[m.vModelSelect,c.value]]),(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'保存为新预设',onClick:R},[...a[20]||(a[20]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])]),c.value?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-tool-btn acu-btn-danger',title:'删除预设',onClick:H},[...a[21]||(a[21]=[(0,m.createElementVNode)('i',{class:'fas fa-trash'},null,-1)])])):(0,m.createCommentVNode)('v-if',!0)])]),(0,m.createCommentVNode)(' 自动修复预设 '),(0,m.createElementVNode)('div',oc,[a[24]||(a[24]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 检测问题时使用 '),(0,m.createElementVNode)('span',{class:'hint'},'检测到问题时自动应用此预设')],-1)),(0,m.createElementVNode)('div',nc,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[1]||(a[1]=e=>s.value=e),class:'acu-config-select',onChange:j},[a[23]||(a[23]=(0,m.createElementVNode)('option',{value:''},'-- 禁用 --',-1)),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(D.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('option',{key:e.id,value:e.id},(0,m.toDisplayString)(e.name),9,rc))),128))],544),[[m.vModelSelect,s.value]])])])]),(0,m.createCommentVNode)(' 参数设置区域 '),(0,m.createElementVNode)('div',ic,[a[30]||(a[30]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-sliders-h'}),(0,m.createTextVNode)(' 更新参数设置 ')],-1)),(0,m.createCommentVNode)(' AI读取上下文层数 '),(0,m.createElementVNode)('div',lc,[a[26]||(a[26]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' AI读取上下文层数 '),(0,m.createElementVNode)('span',{class:'hint'},'AI阅读最近多少层来理解剧情')],-1)),(0,m.createElementVNode)('div',cc,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[2]||(a[2]=e=>l.autoUpdateThreshold=e),type:'number',class:'acu-config-input',min:'1',max:'500',onChange:a[3]||(a[3]=e=>L('autoUpdateThreshold',l.autoUpdateThreshold))},null,544),[[m.vModelText,l.autoUpdateThreshold,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 每N层自动更新一次 '),(0,m.createElementVNode)('div',sc,[a[27]||(a[27]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 每N层自动更新一次 '),(0,m.createElementVNode)('span',{class:'hint'},'设置自动触发更新的楼层间隔')],-1)),(0,m.createElementVNode)('div',dc,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[4]||(a[4]=e=>l.autoUpdateFrequency=e),type:'number',class:'acu-config-input',min:'1',max:'100',onChange:a[5]||(a[5]=e=>L('autoUpdateFrequency',l.autoUpdateFrequency))},null,544),[[m.vModelText,l.autoUpdateFrequency,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 每批次更新楼层数 '),(0,m.createElementVNode)('div',uc,[a[28]||(a[28]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 每批次更新楼层数 '),(0,m.createElementVNode)('span',{class:'hint'},'单次更新处理的最大楼层数')],-1)),(0,m.createElementVNode)('div',pc,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[6]||(a[6]=e=>l.updateBatchSize=e),type:'number',class:'acu-config-input',min:'1',max:'50',onChange:a[7]||(a[7]=e=>L('updateBatchSize',l.updateBatchSize))},null,544),[[m.vModelText,l.updateBatchSize,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 保留X层楼不更新 '),(0,m.createElementVNode)('div',mc,[a[29]||(a[29]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 保留X层楼不更新 '),(0,m.createElementVNode)('span',{class:'hint'},'最近的几层楼跳过更新')],-1)),(0,m.createElementVNode)('div',fc,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[8]||(a[8]=e=>l.skipUpdateFloors=e),type:'number',class:'acu-config-input',min:'0',max:'20',onChange:a[9]||(a[9]=e=>L('skipUpdateFloors',l.skipUpdateFloors))},null,544),[[m.vModelText,l.skipUpdateFloors,void 0,{number:!0}]])])])]),(0,m.createCommentVNode)(' 移动端：折叠式表格选择（放在智能检测之前） '),(0,m.createElementVNode)('div',gc,[(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-settings-title acu-collapsible',{'is-expanded':v.value}]),onClick:a[10]||(a[10]=e=>v.value=!v.value)},[a[31]||(a[31]=(0,m.createElementVNode)('i',{class:'fas fa-table'},null,-1)),a[32]||(a[32]=(0,m.createTextVNode)(' 更新表格选择 ',-1)),(0,m.createElementVNode)('span',vc,(0,m.toDisplayString)(v.value?'▲':'▼'),1)],2),(0,m.withDirectives)((0,m.createElementVNode)('div',bc,[(0,m.createVNode)((0,m.unref)(Gr),{modelValue:g.value,'onUpdate:modelValue':[a[11]||(a[11]=e=>g.value=e),X],items:U.value,'empty-text':'暂无可用表格','footer-template':'已选择: {selected}/{total} 个表格','empty-hint':'(更新全部)'},null,8,['modelValue','items'])],512),[[m.vShow,v.value]])]),(0,m.createCommentVNode)(' 智能检测设置 '),(0,m.createElementVNode)('div',hc,[a[37]||(a[37]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-magic'}),(0,m.createTextVNode)(' 智能检测 ')],-1)),(0,m.createCommentVNode)(' 启用智能检测 '),(0,m.createElementVNode)('div',xc,[a[34]||(a[34]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 启用问题检测提示 '),(0,m.createElementVNode)('span',{class:'hint'},'检测编码索引断裂或空单元格时显示警告')],-1)),(0,m.createElementVNode)('div',wc,[(0,m.createElementVNode)('label',yc,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[12]||(a[12]=e=>u.value=e),type:'checkbox',onChange:W},null,544),[[m.vModelCheckbox,u.value]]),a[33]||(a[33]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])])]),(0,m.createCommentVNode)(' 自动执行修复 '),u.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',kc,[a[36]||(a[36]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 检测到问题时自动执行 '),(0,m.createElementVNode)('span',{class:'hint'},'自动按选定预设触发手动更新')],-1)),(0,m.createElementVNode)('div',Cc,[(0,m.createElementVNode)('label',Nc,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[13]||(a[13]=e=>p.value=e),type:'checkbox',onChange:Y},null,544),[[m.vModelCheckbox,p.value]]),a[35]||(a[35]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])])])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 空值检测列设置（仅当启用智能检测时显示） '),u.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Vc,[a[38]||(a[38]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-columns'}),(0,m.createTextVNode)(' 空值检测列 ')],-1)),(0,m.createVNode)((0,m.unref)(Gr),{modelValue:h.value,'onUpdate:modelValue':[a[14]||(a[14]=e=>h.value=e),G],items:M.value,'empty-text':'暂无可用列（请先选择总结表/大纲表）','footer-template':'已选择: {selected}/{total} 列','empty-hint':'(检测全部)'},null,8,['modelValue','items'])])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 右侧：表格选择 (PC端显示) '),(0,m.createElementVNode)('div',Ec,[(0,m.createVNode)((0,m.unref)(Gr),{modelValue:g.value,'onUpdate:modelValue':[a[15]||(a[15]=e=>g.value=e),X],items:U.value,'empty-text':'暂无可用表格','footer-template':'已选择: {selected}/{total} 个表格','empty-hint':'(更新全部)'},null,8,['modelValue','items'])])]),(0,m.createCommentVNode)(' 问题提示 '),A.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Bc,[a[39]||(a[39]=(0,m.createElementVNode)('i',{class:'fas fa-exclamation-triangle'},null,-1)),(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(I.value),1)])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 执行按钮 '),(0,m.createElementVNode)('div',Tc,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-update-btn',{'is-updating':i.value}]),disabled:i.value,onClick:q},[i.value?((0,m.openBlock)(),(0,m.createElementBlock)('i',Dc)):((0,m.openBlock)(),(0,m.createElementBlock)('i',Ac)),(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(i.value?'正在更新...':'立即执行手动更新'),1)],10,Sc)])],64))])],512),(0,m.createCommentVNode)(' 预设保存弹窗已迁移到全局 App.vue 中 ')])):(0,m.createCommentVNode)('v-if',!0)}});u(6519);const Ic=(0,et.A)(zc,[['__scopeId','data-v-5df49713']]),_c={class:'acu-modal acu-preset-save-modal'},Mc={class:'acu-modal-header'},Uc={class:'acu-modal-body'},Pc={class:'acu-settings-group'},$c={key:0,class:'acu-preset-warning'},Lc={key:1,class:'acu-preset-summary'},Fc={class:'acu-preset-summary-list'},jc={class:'acu-modal-footer'},Oc=['disabled'],Rc=(0,m.defineComponent)({__name:'PresetSaveDialog',props:{visible:{type:Boolean},presetType:{default:'manual-update'},summaryItems:{default:()=>[]},initialName:{default:''},checkDuplicate:{type:Function,default:()=>!1}},emits:['update:visible','save'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.ref)(null),r=(0,m.ref)(''),i=(0,m.computed)(()=>r.value.trim().length>0),l=(0,m.computed)(()=>{const e=r.value.trim();return!!e&&(a.checkDuplicate?.(e)??!1)});function c(){o('update:visible',!1)}function s(){const e=r.value.trim();e&&(o('save',e),o('update:visible',!1))}return(0,m.watch)(()=>a.visible,e=>{e&&(r.value=a.initialName||'',(0,m.nextTick)(()=>{n.value?.focus()}))},{immediate:!0}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(c,['self'])},[(0,m.createElementVNode)('div',_c,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',Mc,[a[1]||(a[1]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},'保存为预设',-1)),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(c,['stop'])},'完成')]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',Uc,[(0,m.createCommentVNode)(' 预设名称输入 '),(0,m.createElementVNode)('div',Pc,[(0,m.withDirectives)((0,m.createElementVNode)('input',{ref_key:'inputRef',ref:n,'onUpdate:modelValue':a[0]||(a[0]=e=>r.value=e),type:'text',class:'acu-settings-input',placeholder:'输入预设名称',onKeyup:(0,m.withKeys)(s,['enter'])},null,544),[[m.vModelText,r.value]])]),(0,m.createCommentVNode)(' 重名警告 '),l.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',$c,[...a[2]||(a[2]=[(0,m.createElementVNode)('i',{class:'fas fa-exclamation-circle'},null,-1),(0,m.createTextVNode)(' 已存在同名预设，保存将覆盖原有配置 ',-1)])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 保存内容摘要 '),e.summaryItems.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',Lc,[a[3]||(a[3]=(0,m.createElementVNode)('div',{class:'acu-preset-summary-title'},'将保存以下配置：',-1)),(0,m.createElementVNode)('ul',Fc,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.summaryItems,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('li',{key:t},(0,m.toDisplayString)(e),1))),128))])])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 底部按钮 '),(0,m.createElementVNode)('div',jc,[(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:(0,m.withModifiers)(c,['stop'])},'取消'),(0,m.createElementVNode)('button',{class:'acu-modal-btn primary',disabled:!i.value,onClick:(0,m.withModifiers)(s,['stop'])},(0,m.toDisplayString)(l.value?'覆盖保存':'保存'),9,Oc)])])])):(0,m.createCommentVNode)('v-if',!0)}});u(8508);const Hc=(0,et.A)(Rc,[['__scopeId','data-v-619b7a49']]),Wc={class:'acu-purge-content'},Yc={class:'acu-purge-inputs'},Xc={class:'acu-purge-btns'},Gc={class:'acu-purge-btns-right'},qc=['disabled'],Kc=(0,m.defineComponent)({__name:'PurgeRangeDialog',props:{visible:{type:Boolean},maxFloor:{default:999}},emits:['update:visible','confirm','advanced-confirm'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.ref)(),r=(0,m.ref)(),i=(0,m.ref)(),l=(0,m.ref)(null),c=(0,m.ref)(null),s=(0,m.ref)(!1),d=(0,m.ref)(!1);const u=(0,m.computed)(()=>null!==l.value&&null!==c.value&&(!isNaN(l.value)&&!isNaN(c.value)&&(!(l.value<0||c.value<0)&&!(l.value>c.value))));(0,m.watch)(()=>a.visible,e=>{if(e){const e=function(){let e=window.SillyTavern||(window.parent?window.parent.SillyTavern:null);!e&&window.top&&window.top.SillyTavern&&(e=window.top.SillyTavern);let t=-1,a=0;if(e&&e.chat){a=Math.max(0,e.chat.length-1);for(let a=e.chat.length-1;a>=0;a--){const o=e.chat[a];if(!o.is_user&&o.TavernDB_ACU_IsolatedData){const e=Object.keys(o.TavernDB_ACU_IsolatedData);let n=!1;for(const t of e){const e=o.TavernDB_ACU_IsolatedData[t];if(e&&e.independentData&&Object.keys(e.independentData).length>0){n=!0;break}}if(n){t=a;break}}}}return{start:-1!==t?t:a,end:-1!==t?t:a}}();l.value=e.start,c.value=e.end,s.value=!1}}),(0,Be.X2F)(n,()=>{g()});const p=()=>{i.value?.focus()},f=()=>{u.value&&null!==l.value&&null!==c.value?(o('confirm',l.value,c.value),o('update:visible',!1)):(s.value=!0,setTimeout(()=>{s.value=!1},500),O.toast.warning('请输入有效的楼层范围 (Start <= End)'))},g=()=>{o('update:visible',!1)},v=()=>{d.value=!0},b=e=>{o('advanced-confirm',e),o('update:visible',!1)};return(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,null,[e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-purge-overlay',onClick:(0,m.withModifiers)(g,['self'])},[(0,m.createElementVNode)('div',{ref_key:'dialogRef',ref:n,class:'acu-modal acu-purge-range-modal'},[(0,m.createCommentVNode)(' 标题区 '),a[7]||(a[7]=(0,m.createElementVNode)('div',{class:'acu-purge-title'},'清除数据范围',-1)),(0,m.createCommentVNode)(' 内容区 '),(0,m.createElementVNode)('div',Wc,[(0,m.createCommentVNode)(' 装饰图标 '),a[4]||(a[4]=(0,m.createElementVNode)('div',{class:'acu-purge-icon'},[(0,m.createElementVNode)('i',{class:'fa-solid fa-eraser'})],-1)),(0,m.createCommentVNode)(' 提示文字 '),a[5]||(a[5]=(0,m.createElementVNode)('p',{class:'acu-purge-hint'},[(0,m.createTextVNode)(' 请输入要清除数据的楼层范围'),(0,m.createElementVNode)('br'),(0,m.createElementVNode)('span',{class:'acu-purge-hint-sub'},'(起始楼层 - 结束楼层)')],-1)),(0,m.createCommentVNode)(' 范围输入 '),(0,m.createElementVNode)('div',Yc,[(0,m.withDirectives)((0,m.createElementVNode)('input',{ref_key:'startInputRef',ref:r,'onUpdate:modelValue':a[0]||(a[0]=e=>l.value=e),type:'number',class:'acu-purge-input',placeholder:'Start',min:'0',onKeydown:(0,m.withKeys)(p,['enter'])},null,544),[[m.vModelText,l.value,void 0,{number:!0}]]),a[3]||(a[3]=(0,m.createElementVNode)('span',{class:'acu-purge-separator'},'-',-1)),(0,m.withDirectives)((0,m.createElementVNode)('input',{ref_key:'endInputRef',ref:i,'onUpdate:modelValue':a[1]||(a[1]=e=>c.value=e),type:'number',class:'acu-purge-input',placeholder:'End',min:'0',onKeydown:(0,m.withKeys)(f,['enter'])},null,544),[[m.vModelText,c.value,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 按钮区 '),(0,m.createElementVNode)('div',Xc,[(0,m.createElementVNode)('button',{class:'acu-purge-btn acu-purge-btn-advanced',onClick:v},[...a[6]||(a[6]=[(0,m.createElementVNode)('i',{class:'fas fa-cogs'},null,-1),(0,m.createTextVNode)(' 高级 ',-1)])]),(0,m.createElementVNode)('div',Gc,[(0,m.createElementVNode)('button',{class:'acu-purge-btn acu-purge-btn-cancel',onClick:g},'取消'),(0,m.createElementVNode)('button',{class:'acu-purge-btn acu-purge-btn-confirm',disabled:!u.value,onClick:f},' 确认清除 ',8,qc)])])],512)])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 高级清除弹窗 '),(0,m.createVNode)(gi,{visible:d.value,'onUpdate:visible':a[2]||(a[2]=e=>d.value=e),'initial-start-floor':l.value??void 0,'initial-end-floor':c.value??void 0,onConfirm:b},null,8,['visible','initial-start-floor','initial-end-floor'])],64))}}),Jc='8.3.6';Jc.split('.')[0];const Zc={class:'acu-ball-appearance-panel'},Qc={class:'acu-ball-preview-fixed'},es=['src'],ts={key:3,class:'fa-solid fa-image'},as={class:'acu-ball-scroll-content'},os={class:'acu-settings-section'},ns={class:'acu-settings-title-row'},rs={class:'acu-preview-buttons'},is={class:'acu-settings-control'},ls={class:'acu-switch'},cs={class:'acu-settings-section'},ss={class:'acu-settings-group'},ds={class:'acu-settings-row'},us={class:'acu-settings-control acu-color-picker-inline'},ps={class:'acu-settings-row'},ms={class:'acu-settings-label'},fs={class:'hint'},gs={class:'acu-settings-control'},vs={class:'acu-settings-section'},bs={class:'acu-settings-group'},hs={class:'acu-settings-row'},xs={class:'acu-settings-control acu-color-picker-inline'},ws={class:'acu-settings-row'},ys={class:'acu-settings-label'},ks={class:'hint'},Cs={class:'acu-settings-control'},Ns={class:'acu-settings-section'},Vs={class:'acu-settings-group'},Es={class:'acu-settings-row'},Bs={class:'acu-settings-label'},Ts={class:'hint'},Ss={class:'acu-settings-control'},Ds={class:'acu-settings-section'},As={class:'acu-icon-type-row'},zs={key:0,class:'acu-icon-input-area'},Is={class:'acu-icon-input'},_s={key:1,class:'acu-icon-input-area'},Ms={class:'acu-emoji-input'},Us={class:'acu-icon-input-area'},Ps={class:'acu-icon-input'},$s={key:0,class:'acu-image-preview-row',style:{'margin-top':'10px'}},Ls={class:'acu-image-actions'},Fs={class:'acu-icon-input-area'},js={class:'acu-image-preview-row'},Os={class:'acu-image-actions'},Rs=(0,m.defineComponent)({__name:'BallAppearancePanel',setup(e){const t=(0,Ye.MP)(),a=(0,Ye.j_)(),o=(0,m.reactive)({...t.appearance}),n=(0,m.ref)(!1),r=(0,m.ref)(!1),i=(0,m.ref)(),l=(0,m.ref)('local'),c=(0,m.ref)(''),s=(0,m.computed)(()=>'image'===o.type&&'url'===l.value);'image'===o.type&&o.content?.startsWith('http')&&(l.value='url',c.value=o.content),(0,m.watch)(o,e=>{t.updateAppearance(e)},{deep:!0});const d=(0,m.computed)(()=>({'p-anim-ripple':n.value&&'ripple'===o.notifyAnimation,'p-anim-arc':n.value&&'arc'===o.notifyAnimation,'p-notify':r.value})),u=(0,m.computed)(()=>({'--ball-size':`${o.size}px`,'--ball-border-color':o.borderColor,'--ball-border-color-rgba':(0,v.j5)(o.borderColor,o.borderOpacity),'--ball-bg-color':(0,v.j5)(o.bgColor,o.bgOpacity)})),p=(0,m.computed)(()=>o.content?{backgroundImage:`url('${o.content}')`,backgroundPosition:`${o.imageOffsetX??50}% ${o.imageOffsetY??50}%`,backgroundSize:`${o.imageScale??150}%`,backgroundRepeat:'no-repeat'}:{});function f(){n.value=!0,r.value=!1,setTimeout(()=>{n.value=!1},3e3)}function g(){r.value=!0,n.value=!1,setTimeout(()=>{r.value=!1},3e3)}function b(){o.type='image',l.value='local',i.value?.click()}function h(){o.type='image',l.value='url',o.content&&!o.content.startsWith('http')&&(o.content=''),o.content?.startsWith('http')&&(c.value=o.content)}function x(){const e=c.value.trim();e&&e.startsWith('http')&&(o.content=e,o.imageOffsetX=50,o.imageOffsetY=50,o.imageScale=150)}async function w(e){const t=e.target,a=t.files?.[0];if(a){try{let e=await(0,v.bB)(a);e=await(0,v.w4)(e,100,.8),o.content=e,o.imageOffsetX=50,o.imageOffsetY=50,o.imageScale=150,y()}catch(e){console.error('[ACU] 图片上传失败:',e)}t.value=''}}function y(){o.content&&a.openAvatarCropDialog({imageUrl:o.content,name:'悬浮球图片',initialOffsetX:o.imageOffsetX??50,initialOffsetY:o.imageOffsetY??50,initialScale:o.imageScale??150,initialInvert:o.imageInvert??!1,showInvertOption:!0},{onApply:e=>{o.imageOffsetX=e.offsetX,o.imageOffsetY=e.offsetY,o.imageScale=e.scale,void 0!==e.invert&&(o.imageInvert=e.invert)},onUpload:async e=>{try{let t=await(0,v.bB)(e);t=await(0,v.w4)(t,100,.8),o.content=t,o.imageOffsetX=50,o.imageOffsetY=50,o.imageScale=150}catch(e){console.error('[ACU] 图片上传失败:',e)}}})}function k(){o.content='',o.imageOffsetX=50,o.imageOffsetY=50,o.imageScale=150}function C(){Object.assign(o,Ye.$P)}return(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',Zc,[(0,m.createCommentVNode)(' 预览区域 - 固定在顶部（使用 position: absolute） '),(0,m.createElementVNode)('div',Qc,[(0,m.createElementVNode)('button',{class:'acu-icon-btn acu-reset-btn',title:'重置为默认',onClick:(0,m.withModifiers)(C,['stop'])},[...t[16]||(t[16]=[(0,m.createElementVNode)('i',{class:'fas fa-undo'},null,-1)])]),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-ball-preview',d.value]),style:(0,m.normalizeStyle)(u.value)},['icon'===o.type?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(['fa-solid',o.content])},null,2)):'emoji'===o.type?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createTextVNode)((0,m.toDisplayString)(o.content),1)],64)):'image'===o.type&&o.content?((0,m.openBlock)(),(0,m.createElementBlock)('img',{key:2,src:o.content,alt:''},null,8,es)):((0,m.openBlock)(),(0,m.createElementBlock)('i',ts))],6)]),(0,m.createCommentVNode)(' 可滚动内容区 '),(0,m.createElementVNode)('div',as,[(0,m.createCommentVNode)(' 通知动画类型 - 标题与按钮同行 '),(0,m.createElementVNode)('div',os,[(0,m.createElementVNode)('div',ns,[t[18]||(t[18]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-bell'}),(0,m.createTextVNode)(' AI 填表通知动画 ')],-1)),(0,m.createElementVNode)('div',rs,[(0,m.createElementVNode)('button',{class:'acu-tool-btn',onClick:(0,m.withModifiers)(f,['stop'])},'▶️ 播放'),(0,m.createElementVNode)('button',{class:'acu-tool-btn',onClick:(0,m.withModifiers)(g,['stop'])},'🔔 通知')]),(0,m.createElementVNode)('div',is,[(0,m.createElementVNode)('label',ls,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>o.enableNotifyAnimation=e),type:'checkbox'},null,512),[[m.vModelCheckbox,o.enableNotifyAnimation]]),t[17]||(t[17]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])])]),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-anim-grid',{disabled:!o.enableNotifyAnimation}])},[(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-anim-option',{active:'ripple'===o.notifyAnimation}]),onClick:t[1]||(t[1]=(0,m.withModifiers)(e=>o.notifyAnimation='ripple',['stop']))},[...t[19]||(t[19]=[(0,m.createElementVNode)('span',{class:'acu-anim-icon'},'🌊',-1),(0,m.createElementVNode)('span',{class:'acu-anim-name'},'脉冲波纹',-1)])],2),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-anim-option',{active:'arc'===o.notifyAnimation}]),onClick:t[2]||(t[2]=(0,m.withModifiers)(e=>o.notifyAnimation='arc',['stop']))},[...t[20]||(t[20]=[(0,m.createElementVNode)('span',{class:'acu-anim-icon'},'⚡',-1),(0,m.createElementVNode)('span',{class:'acu-anim-name'},'电磁闪烁',-1)])],2)],2)]),(0,m.createCommentVNode)(' 边框颜色 '),(0,m.createElementVNode)('div',cs,[t[23]||(t[23]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-palette'}),(0,m.createTextVNode)(' 边框颜色 ')],-1)),(0,m.createElementVNode)('div',ss,[(0,m.createElementVNode)('div',ds,[t[21]||(t[21]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},'颜色',-1)),(0,m.createElementVNode)('div',us,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[3]||(t[3]=e=>o.borderColor=e),type:'text',class:'acu-color-input',placeholder:'#RRGGBB'},null,512),[[m.vModelText,o.borderColor]]),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[4]||(t[4]=e=>o.borderColor=e),type:'color',class:'acu-color-swatch acu-dashed'},null,512),[[m.vModelText,o.borderColor]])])]),(0,m.createElementVNode)('div',ps,[(0,m.createElementVNode)('div',ms,[t[22]||(t[22]=(0,m.createTextVNode)(' 透明度 ',-1)),(0,m.createElementVNode)('span',fs,(0,m.toDisplayString)(o.borderOpacity)+'%',1)]),(0,m.createElementVNode)('div',gs,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[5]||(t[5]=e=>o.borderOpacity=e),type:'range',min:'0',max:'100',step:'5'},null,512),[[m.vModelText,o.borderOpacity,void 0,{number:!0}]])])])])]),(0,m.createCommentVNode)(' 背景颜色 '),(0,m.createElementVNode)('div',vs,[t[26]||(t[26]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-fill-drip'}),(0,m.createTextVNode)(' 背景颜色 ')],-1)),(0,m.createElementVNode)('div',bs,[(0,m.createElementVNode)('div',hs,[t[24]||(t[24]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},'颜色',-1)),(0,m.createElementVNode)('div',xs,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[6]||(t[6]=e=>o.bgColor=e),type:'text',class:'acu-color-input',placeholder:'#RRGGBB'},null,512),[[m.vModelText,o.bgColor]]),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[7]||(t[7]=e=>o.bgColor=e),type:'color',class:'acu-color-swatch'},null,512),[[m.vModelText,o.bgColor]])])]),(0,m.createElementVNode)('div',ws,[(0,m.createElementVNode)('div',ys,[t[25]||(t[25]=(0,m.createTextVNode)(' 透明度 ',-1)),(0,m.createElementVNode)('span',ks,(0,m.toDisplayString)(o.bgOpacity)+'%',1)]),(0,m.createElementVNode)('div',Cs,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[8]||(t[8]=e=>o.bgOpacity=e),type:'range',min:'0',max:'100',step:'5'},null,512),[[m.vModelText,o.bgOpacity,void 0,{number:!0}]])])])])]),(0,m.createCommentVNode)(' 尺寸 '),(0,m.createElementVNode)('div',Ns,[t[28]||(t[28]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-expand-arrows-alt'}),(0,m.createTextVNode)(' 尺寸 ')],-1)),(0,m.createElementVNode)('div',Vs,[(0,m.createElementVNode)('div',Es,[(0,m.createElementVNode)('div',Bs,[t[27]||(t[27]=(0,m.createTextVNode)(' 球体大小 ',-1)),(0,m.createElementVNode)('span',Ts,(0,m.toDisplayString)(o.size)+'px',1)]),(0,m.createElementVNode)('div',Ss,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[9]||(t[9]=e=>o.size=e),type:'range',min:'40',max:'100',step:'2'},null,512),[[m.vModelText,o.size,void 0,{number:!0}]])])])])]),(0,m.createCommentVNode)(' 图标类型 '),(0,m.createElementVNode)('div',Ds,[t[45]||(t[45]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-icons'}),(0,m.createTextVNode)(' 图标 ')],-1)),(0,m.createCommentVNode)(' 图标类型按钮 - 图标和文字同行 '),(0,m.createElementVNode)('div',As,[(0,m.createElementVNode)('label',{class:(0,m.normalizeClass)(['acu-type-btn',{active:'icon'===o.type}])},[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[10]||(t[10]=e=>o.type=e),type:'radio',value:'icon'},null,512),[[m.vModelRadio,o.type]]),t[29]||(t[29]=(0,m.createElementVNode)('i',{class:'fa-solid fa-icons'},null,-1)),t[30]||(t[30]=(0,m.createElementVNode)('span',null,'FA图标',-1))],2),(0,m.createElementVNode)('label',{class:(0,m.normalizeClass)(['acu-type-btn',{active:'emoji'===o.type}])},[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[11]||(t[11]=e=>o.type=e),type:'radio',value:'emoji'},null,512),[[m.vModelRadio,o.type]]),t[31]||(t[31]=(0,m.createElementVNode)('span',{class:'emoji-icon'},'😀',-1)),t[32]||(t[32]=(0,m.createElementVNode)('span',null,'Emoji',-1))],2),(0,m.createCommentVNode)(' 本地图片按钮 - 点击直接上传 '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-type-btn',{active:'image'===o.type&&!s.value}]),onClick:(0,m.withModifiers)(b,['stop'])},[(0,m.createElementVNode)('input',{ref_key:'imageInputRef',ref:i,type:'file',accept:'image/*',hidden:'',onChange:w},null,544),t[33]||(t[33]=(0,m.createElementVNode)('i',{class:'fa-solid fa-image'},null,-1)),t[34]||(t[34]=(0,m.createElementVNode)('span',null,'图片',-1))],2),(0,m.createCommentVNode)(' URL 图片按钮 '),(0,m.createElementVNode)('label',{class:(0,m.normalizeClass)(['acu-type-btn',{active:'image'===o.type&&s.value}])},[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[12]||(t[12]=e=>l.value=e),type:'radio',value:'url',onChange:h},null,544),[[m.vModelRadio,l.value]]),t[35]||(t[35]=(0,m.createElementVNode)('i',{class:'fa-solid fa-link'},null,-1)),t[36]||(t[36]=(0,m.createElementVNode)('span',null,'URL',-1))],2)]),(0,m.createCommentVNode)(' 根据类型显示不同输入（仅图标/Emoji需要输入，图片无需额外输入） '),'icon'===o.type?((0,m.openBlock)(),(0,m.createElementBlock)('div',zs,[(0,m.createElementVNode)('div',Is,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[13]||(t[13]=e=>o.content=e),placeholder:'fa-layer-group'},null,512),[[m.vModelText,o.content]]),t[37]||(t[37]=(0,m.createElementVNode)('span',{class:'acu-input-hint'},'输入 FontAwesome 图标类名',-1))])])):'emoji'===o.type?((0,m.openBlock)(),(0,m.createElementBlock)('div',_s,[(0,m.createElementVNode)('div',Ms,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[14]||(t[14]=e=>o.content=e),placeholder:'🎭'},null,512),[[m.vModelText,o.content]]),t[38]||(t[38]=(0,m.createElementVNode)('span',{class:'acu-input-hint'},'输入 Emoji 表情',-1))])])):'image'===o.type&&s.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:2},[(0,m.createCommentVNode)(' URL 图片模式：显示 URL 输入框 '),(0,m.createElementVNode)('div',Us,[(0,m.createElementVNode)('div',Ps,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[15]||(t[15]=e=>c.value=e),placeholder:'https://example.com/image.png',onBlur:x,onKeyup:(0,m.withKeys)(x,['enter'])},null,544),[[m.vModelText,c.value]])]),(0,m.createCommentVNode)(' 如果有图片，显示预览和调整按钮 '),o.content&&o.content.startsWith('http')?((0,m.openBlock)(),(0,m.createElementBlock)('div',$s,[(0,m.createElementVNode)('div',{class:'acu-preview-thumb-wrapper',style:(0,m.normalizeStyle)(p.value),onClick:(0,m.withModifiers)(y,['stop'])},[...t[39]||(t[39]=[(0,m.createElementVNode)('span',{class:'acu-edit-hint'},[(0,m.createElementVNode)('i',{class:'fas fa-crop-simple'})],-1)])],4),(0,m.createElementVNode)('div',Ls,[(0,m.createElementVNode)('button',{class:'acu-adjust-btn',onClick:(0,m.withModifiers)(y,['stop'])},[...t[40]||(t[40]=[(0,m.createElementVNode)('i',{class:'fas fa-crop-simple'},null,-1),(0,m.createTextVNode)(' 调整 ',-1)])]),(0,m.createElementVNode)('button',{class:'acu-adjust-btn',style:{'margin-left':'8px'},onClick:(0,m.withModifiers)(k,['stop'])},[...t[41]||(t[41]=[(0,m.createElementVNode)('i',{class:'fas fa-trash'},null,-1),(0,m.createTextVNode)(' 清除 ',-1)])])])])):(0,m.createCommentVNode)('v-if',!0)])],2112)):'image'===o.type&&o.content?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:3},[(0,m.createCommentVNode)(' 本地图片模式：已上传时显示调整和清除按钮 '),(0,m.createElementVNode)('div',Fs,[(0,m.createElementVNode)('div',js,[(0,m.createElementVNode)('div',{class:'acu-preview-thumb-wrapper',style:(0,m.normalizeStyle)(p.value),onClick:(0,m.withModifiers)(y,['stop'])},[...t[42]||(t[42]=[(0,m.createElementVNode)('span',{class:'acu-edit-hint'},[(0,m.createElementVNode)('i',{class:'fas fa-crop-simple'})],-1)])],4),(0,m.createElementVNode)('div',Os,[(0,m.createElementVNode)('button',{class:'acu-adjust-btn',onClick:(0,m.withModifiers)(y,['stop'])},[...t[43]||(t[43]=[(0,m.createElementVNode)('i',{class:'fas fa-crop-simple'},null,-1),(0,m.createTextVNode)(' 调整 ',-1)])]),(0,m.createElementVNode)('button',{class:'acu-adjust-btn',style:{'margin-left':'8px'},onClick:(0,m.withModifiers)(k,['stop'])},[...t[44]||(t[44]=[(0,m.createElementVNode)('i',{class:'fas fa-trash'},null,-1),(0,m.createTextVNode)(' 清除 ',-1)])])])])])],2112)):(0,m.createCommentVNode)('v-if',!0)])])]))}}),Hs={class:'acu-button-config-panel'},Ws={class:'acu-settings-row'},Ys={class:'acu-settings-control'},Xs={class:'acu-config-section acu-visible-area'},Gs={key:0,class:'acu-btn-visible-grid'},qs=['title','onClick','onDragstart','onDragover','onDrop'],Ks={key:0,class:'required-dot'},Js=['title','onClick'],Zs=['onClick'],Qs={key:1,class:'acu-empty-hint'},ed={class:'acu-config-section acu-hidden-area'},td={key:0,class:'acu-btn-hidden-grid'},ad=['title','onClick'],od={key:1,class:'acu-empty-hint'},nd={class:'picker-header'},rd={class:'picker-content'},id={class:'picker-hint'},ld={class:'picker-options'},cd=['onClick'],sd=(0,m.defineComponent)({__name:'NavButtonConfigPanel',setup(e){const t=(0,f.JH)(),a=e=>{const t=f.mu.find(t=>t.id===e);return t?.icon||'fa-circle'},o=e=>{const t=f.mu.find(t=>t.id===e);return t?.label||e},n=(0,m.computed)(()=>{const e=t.buttonsConfig.buttonOrder,a=t.buttonsConfig.visibleButtons,o=t.buttonsConfig.buttonGroups||[];return e.filter(e=>a.includes(e)).map(e=>{const t=f.mu.find(t=>t.id===e),a=o.find(t=>t.primaryId===e);return{id:e,icon:t?.icon||'fa-circle',label:t?.label||e,secondaryId:a?.secondaryId||null}})}),r=(0,m.computed)(()=>{const e=t.buttonsConfig.visibleButtons,a=(t.buttonsConfig.buttonGroups||[]).map(e=>e.secondaryId).filter(Boolean);return f.mu.filter(t=>!t.hidden&&!e.includes(t.id)&&!a.includes(t.id))}),i=(0,m.computed)(()=>{const e=(t.buttonsConfig.buttonGroups||[]).map(e=>e.secondaryId).filter(Boolean);return f.mu.filter(t=>t.id!==d.value&&!e.includes(t.id))}),l=(0,m.ref)(null),c=e=>{e.target.classList.remove('dragging');document.querySelectorAll('.acu-button-card').forEach(e=>e.classList.remove('drop-target')),l.value=null},s=(0,m.ref)(!1),d=(0,m.ref)(''),u=()=>{s.value=!1,d.value=''},p=()=>{t.resetButtonConfig()};return(e,f)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',Hs,[(0,m.createCommentVNode)(' 长按直接执行开关 - 使用设置面板的行开关样式 '),(0,m.createElementVNode)('div',Ws,[f[2]||(f[2]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 长按直接执行 '),(0,m.createElementVNode)('span',{class:'hint'},'开启后，长按将跳过弹出按钮，直接执行附属功能')],-1)),(0,m.createElementVNode)('div',Ys,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:(0,m.unref)(t).longPressDirectExec}]),onClick:f[0]||(f[0]=(0,m.withModifiers)(e=>(0,m.unref)(t).toggleLongPressDirectExec(),['stop']))},null,2)])]),(0,m.createCommentVNode)(' 展示区：网格布局，只显示图标 '),(0,m.createElementVNode)('div',Xs,[(0,m.createElementVNode)('h4',null,[f[4]||(f[4]=(0,m.createElementVNode)('i',{class:'fas fa-th-large'},null,-1)),(0,m.createTextVNode)(' 展示中 ('+(0,m.toDisplayString)(n.value.length)+') ',1),(0,m.createElementVNode)('button',{class:'acu-btn-text acu-btn-reset',onClick:(0,m.withModifiers)(p,['stop'])},[...f[3]||(f[3]=[(0,m.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,m.createTextVNode)(' 重置',-1)])])]),n.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',Gs,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(n.value,(e,n)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:(0,m.normalizeClass)(['acu-btn-config-item',{'is-required':'settings'===e.id}]),title:e.label+('settings'===e.id?' (必选)':' (点击移除)'),draggable:'true',onClick:(0,m.withModifiers)(a=>(e=>{if('settings'===e)return;const a=[...t.buttonsConfig.visibleButtons],o=a.indexOf(e);o>-1&&(a.splice(o,1),t.setVisibleButtons(a))})(e.id),['stop']),onDragstart:e=>((e,t)=>{l.value=t,e.dataTransfer&&(e.dataTransfer.effectAllowed='move',e.dataTransfer.setData('text/plain',String(t))),e.target.classList.add('dragging')})(e,n),onDragover:(0,m.withModifiers)(e=>((e,t)=>{if(e.preventDefault(),null===l.value||l.value===t)return;document.querySelectorAll('.acu-button-card').forEach(e=>e.classList.remove('drop-target')),e.currentTarget.classList.add('drop-target')})(e,n),['prevent']),onDrop:e=>((e,a)=>{if(e.preventDefault(),null===l.value||l.value===a)return;const o=[...t.buttonsConfig.buttonOrder],n=t.buttonsConfig.visibleButtons,r=o.filter(e=>n.includes(e)),[i]=r.splice(l.value,1);r.splice(a,0,i);const c=o.filter(e=>!n.includes(e));t.setButtonOrder([...r,...c]),document.querySelectorAll('.acu-button-card').forEach(e=>e.classList.remove('drop-target')),l.value=null})(e,n),onDragend:c},[(0,m.createCommentVNode)(' 主按钮图标 '),(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)([['fas',e.icon],'btn-icon'])},null,2),(0,m.createCommentVNode)(' 必选标记 '),'settings'===e.id?((0,m.openBlock)(),(0,m.createElementBlock)('span',Ks)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 附属按钮指示器/添加按钮 '),e.secondaryId?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:1,class:'attachment-indicator',title:'长按附属: '+o(e.secondaryId)+' (点击移除)',onClick:(0,m.withModifiers)(a=>{return o=e.id,void t.removeButtonGroupSecondary(o);var o},['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',a(e.secondaryId)])},null,2)],8,Js)):((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:2,class:'attachment-add-btn',title:'添加长按附属',onClick:(0,m.withModifiers)(t=>{return a=e.id,d.value=a,void(s.value=!0);var a},['stop'])},[...f[5]||(f[5]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])],8,Zs))],42,qs))),128))])):((0,m.openBlock)(),(0,m.createElementBlock)('div',Qs,[...f[6]||(f[6]=[(0,m.createElementVNode)('i',{class:'fas fa-exclamation-triangle'},null,-1),(0,m.createElementVNode)('span',null,'请至少保留一个按钮',-1)])]))]),(0,m.createCommentVNode)(' 隐藏区：可用按钮 '),(0,m.createElementVNode)('div',ed,[(0,m.createElementVNode)('h4',null,[f[7]||(f[7]=(0,m.createElementVNode)('i',{class:'fas fa-eye-slash'},null,-1)),(0,m.createTextVNode)(' 未展示 ('+(0,m.toDisplayString)(r.value.length)+') ',1)]),r.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',td,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(r.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:e.id,class:'acu-btn-hidden-item',title:e.label+' (点击添加)',onClick:(0,m.withModifiers)(a=>(e=>{const a=[...t.buttonsConfig.visibleButtons],o=[...t.buttonsConfig.buttonOrder];if(a.includes(e)||(a.push(e),t.setVisibleButtons(a)),!o.includes(e)){const a=o.indexOf('settings');a>=0?o.splice(a,0,e):o.push(e),t.setButtonOrder(o)}})(e.id),['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',e.icon])},null,2)],8,ad))),128))])):((0,m.openBlock)(),(0,m.createElementBlock)('div',od,[...f[8]||(f[8]=[(0,m.createElementVNode)('i',{class:'fas fa-check-circle'},null,-1),(0,m.createElementVNode)('span',null,'所有按钮都已展示',-1)])]))]),(0,m.createCommentVNode)(' 附属按钮选择弹窗 '),s.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-attachment-picker-overlay',onClick:(0,m.withModifiers)(u,['self'])},[(0,m.createElementVNode)('div',{class:'acu-attachment-picker',onClick:f[1]||(f[1]=(0,m.withModifiers)(()=>{},['stop']))},[(0,m.createElementVNode)('div',nd,[f[10]||(f[10]=(0,m.createElementVNode)('h4',null,'选择长按附属按钮',-1)),(0,m.createElementVNode)('button',{class:'btn-close',onClick:(0,m.withModifiers)(u,['stop'])},[...f[9]||(f[9]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])]),(0,m.createElementVNode)('div',rd,[(0,m.createElementVNode)('p',id,'选择一个按钮作为 "'+(0,m.toDisplayString)(o(d.value))+'" 的长按附属功能：',1),(0,m.createElementVNode)('div',ld,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(i.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:e.id,class:'picker-option',onClick:(0,m.withModifiers)(a=>{return o=e.id,t.addButtonGroup(d.value,o),void u();var o},['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',e.icon])},null,2),(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(e.label),1)],8,cd))),128))])])])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 提示信息（固定在底部） '),f[11]||(f[11]=(0,m.createElementVNode)('div',{class:'acu-config-hint acu-config-hint-fixed'},[(0,m.createElementVNode)('i',{class:'fas fa-info-circle'}),(0,m.createElementVNode)('span',null,'拖动排序 · 点击移除 · +号添加长按附属')],-1))]))}});u(773);const dd=(0,et.A)(sd,[['__scopeId','data-v-5e392364']]),ud={class:'acu-tab-config-panel'},pd={class:'acu-config-section acu-visible-area'},md=['onClick','onDragstart','onDragover','onDrop'],fd={key:1,class:'tab-type-badge-mini'},gd={key:1,class:'acu-empty-hint'},vd={class:'acu-config-section acu-hidden-area'},bd={key:0,class:'acu-tab-hidden-list'},hd=['title','onClick'],xd={class:'tab-name'},wd={key:1,class:'tab-type-badge'},yd={key:1,class:'acu-empty-hint'},kd=(0,m.defineComponent)({__name:'TabConfigPanel',setup(e){const t=(0,f.JH)(),a=(0,m.computed)(()=>{const e=t.config.gridColumns;return 0===e?{gridTemplateColumns:'repeat(auto-fill, minmax(90px, 1fr))'}:{gridTemplateColumns:`repeat(${e}, 1fr)`}}),o=(0,k.j_)(),n=(0,y.D)();function r(e){return'dashboard'===e.type||'graph'===e.type||'options'===e.type?e.id:e.name}const i=(0,m.computed)(()=>{const e=[];t.config.showDashboard&&e.push({id:k.H6,name:'仪表盘',icon:'fas fa-home',type:'dashboard'});const a=n.stagedData;if(a){const t=(0,v.tE)(a);if(t)for(const[a,o]of Object.entries(t)){const t=o.key,n=a.includes('选项');e.push({id:t,name:a,icon:n?'fas fa-sliders-h':void 0,type:n?'special':'normal'})}}e.some(e=>'normal'===e.type&&(0,v._C)(e.name,e.id))&&e.push({id:k.SC,name:'关系图',icon:'fas fa-project-diagram',type:'graph'});return e.some(e=>'special'===e.type)&&e.push({id:k.$9,name:'选项面板',icon:'fas fa-sliders-h',type:'options'}),e}),l=(0,m.computed)(()=>{const e=o.visibleTabs;return e&&0!==e.length?e.map(e=>i.value.find(t=>r(t)===e)).filter(e=>void 0!==e):[]}),c=(0,m.computed)(()=>{const e=o.visibleTabs;return e&&0!==e.length?i.value.filter(t=>!e.includes(r(t))):i.value}),s=e=>'dashboard'===e||'graph'===e||'options'===e,d=e=>{switch(e){case'dashboard':return'首页';case'graph':return'关系';case'options':return'聚合';default:return''}},u=(0,m.ref)(null),p=()=>{u.value=null},g=()=>{const e=i.value.map(e=>r(e));o.setVisibleTabs(e)},b=()=>{o.setVisibleTabs([])};return(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',ud,[(0,m.createCommentVNode)(' 展示区：当前显示的 Tab（网格布局，复用导航栏样式） '),(0,m.createElementVNode)('div',pd,[(0,m.createElementVNode)('h4',null,[t[1]||(t[1]=(0,m.createElementVNode)('i',{class:'fas fa-eye'},null,-1)),(0,m.createTextVNode)(' 展示中 ('+(0,m.toDisplayString)(l.value.length)+') ',1),(0,m.createElementVNode)('button',{class:'acu-btn-text acu-btn-reset',onClick:(0,m.withModifiers)(g,['stop'])},[...t[0]||(t[0]=[(0,m.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,m.createTextVNode)(' 重置',-1)])])]),l.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-tab-visible-grid',style:(0,m.normalizeStyle)(a.value)},[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(l.value,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:e.id,class:(0,m.normalizeClass)(['acu-nav-btn acu-tab-config-btn',{dragging:u.value===t}]),draggable:'true',title:'点击移除，拖拽排序',onClick:(0,m.withModifiers)(t=>(e=>{const t=i.value.find(t=>t.id===e);if(!t)return;const a=r(t),n=[...o.visibleTabs];if(0===n.length){const e=i.value.map(e=>r(e)).filter(e=>e!==a);return void(e.length>0&&o.setVisibleTabs(e))}const l=n.indexOf(a);l>-1&&n.length>1&&(n.splice(l,1),o.setVisibleTabs(n))})(e.id),['stop']),onDragstart:e=>((e,t)=>{u.value=t,e.dataTransfer&&(e.dataTransfer.effectAllowed='move',e.dataTransfer.setData('text/plain',String(t)))})(e,t),onDragover:(0,m.withModifiers)(e=>(e.preventDefault(),void(null!==u.value&&u.value)),['prevent']),onDrop:e=>((e,t)=>{if(e.preventDefault(),null===u.value||u.value===t)return;let a=[...o.visibleTabs];0===a.length&&(a=i.value.map(e=>r(e)));const[n]=a.splice(u.value,1);a.splice(t,0,n),o.setVisibleTabs(a),document.querySelectorAll('.acu-tab-config-btn').forEach(e=>e.classList.remove('drop-target')),u.value=null})(e,t),onDragend:p},[e.icon?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(e.icon)},null,2)):(0,m.createCommentVNode)('v-if',!0),(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(e.name),1),s(e.type)?((0,m.openBlock)(),(0,m.createElementBlock)('span',fd,(0,m.toDisplayString)(d(e.type)),1)):(0,m.createCommentVNode)('v-if',!0)],42,md))),128))],4)):((0,m.openBlock)(),(0,m.createElementBlock)('div',gd,[...t[2]||(t[2]=[(0,m.createElementVNode)('i',{class:'fas fa-info-circle'},null,-1),(0,m.createElementVNode)('span',null,'展示区为空时显示全部Tab，从下方添加需要的',-1)])]))]),(0,m.createCommentVNode)(' 不展示区：隐藏的 Tab '),(0,m.createElementVNode)('div',vd,[(0,m.createElementVNode)('h4',null,[t[4]||(t[4]=(0,m.createElementVNode)('i',{class:'fas fa-eye-slash'},null,-1)),(0,m.createTextVNode)(' 未展示 ('+(0,m.toDisplayString)(c.value.length)+') ',1),(0,m.createElementVNode)('button',{class:'acu-btn-text acu-btn-clear',title:'将展示区所有Tab移到未展示区',onClick:(0,m.withModifiers)(b,['stop'])},[...t[3]||(t[3]=[(0,m.createElementVNode)('i',{class:'fas fa-angle-double-down'},null,-1),(0,m.createTextVNode)(' 全部下移 ',-1)])])]),c.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',bd,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(c.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:e.id,class:(0,m.normalizeClass)(['acu-tab-hidden-item',{'is-special':s(e.type)}]),title:'添加 '+e.name,onClick:(0,m.withModifiers)(t=>(e=>{const t=i.value.find(t=>t.id===e);if(!t)return;const a=r(t),n=[...o.visibleTabs];n.includes(a)||(n.push(a),o.setVisibleTabs(n))})(e.id),['stop'])},[e.icon?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)([e.icon,'tab-icon'])},null,2)):(0,m.createCommentVNode)('v-if',!0),(0,m.createElementVNode)('span',xd,(0,m.toDisplayString)(e.name),1),s(e.type)?((0,m.openBlock)(),(0,m.createElementBlock)('span',wd,(0,m.toDisplayString)(d(e.type)),1)):(0,m.createCommentVNode)('v-if',!0),t[5]||(t[5]=(0,m.createElementVNode)('i',{class:'fas fa-plus add-icon'},null,-1))],10,hd))),128))])):((0,m.openBlock)(),(0,m.createElementBlock)('div',yd,[...t[6]||(t[6]=[(0,m.createElementVNode)('i',{class:'fas fa-check-circle'},null,-1),(0,m.createElementVNode)('span',null,'所有表格都已展示',-1)])]))]),(0,m.createCommentVNode)(' 提示信息（固定在底部） '),t[7]||(t[7]=(0,m.createElementVNode)('div',{class:'acu-config-hint acu-config-hint-fixed'},[(0,m.createElementVNode)('i',{class:'fas fa-info-circle'}),(0,m.createElementVNode)('span',null,'点击移除/添加，拖拽排序 | 展示区为空时主界面显示全部')],-1))]))}});u(8455);const Cd=(0,et.A)(kd,[['__scopeId','data-v-610a8a20']]);var Nd=u(5526);const Vd={class:'acu-settings-section'},Ed={class:'acu-settings-group'},Bd={class:'acu-settings-row'},Td={class:'acu-settings-control'},Sd={class:'acu-switch'},Dd={key:0,class:'acu-background-config-section'},Ad={class:'acu-background-preview-container'},zd={class:'acu-background-actions'},Id={key:0,class:'acu-settings-row acu-url-input-row'},_d={class:'acu-settings-row'},Md={class:'acu-settings-label'},Ud={class:'hint'},Pd={class:'acu-settings-control'},$d={class:'acu-settings-row'},Ld={class:'acu-settings-label'},Fd={class:'hint'},jd={class:'acu-settings-control'},Od={class:'acu-settings-row'},Rd={class:'acu-settings-control'},Hd={class:'acu-settings-row'},Wd={class:'acu-settings-label'},Yd={class:'hint'},Xd={class:'acu-settings-control'},Gd=2097152,qd=(0,m.defineComponent)({__name:'BackgroundConfigPanel',props:{storageKey:{},modelValue:{}},emits:['update:modelValue'],setup(e,{emit:t}){const a=e,o=(0,g.C)(),n=(0,m.computed)(()=>o.activePresetId||a.storageKey),r=t,i=(0,m.reactive)({...a.modelValue}),l=(0,m.ref)(i.imageUrl||''),c=(0,m.ref)(null),s=(0,m.ref)(!1),d=(0,m.ref)(null),u=(0,m.ref)(!1),p={x:0,y:0},f={x:0,y:0},v=(0,m.ref)(null),b=(0,m.computed)(()=>{if(!i.imageUrl)return{};const e=i.offsetX||0,t=i.offsetY||0,a=(i.scale||100)/100;return{backgroundImage:`url(${i.imageUrl})`,backgroundPosition:'center center',backgroundSize:'auto'===i.size?'100%':i.size,transform:`translate(${e}%, ${t}%) scale(${a})`,transformOrigin:'center center',backgroundRepeat:'no-repeat'}});function h(){r('update:modelValue',{...i})}function x(){h()}function w(e){return'touches'in e?{x:e.touches[0].clientX,y:e.touches[0].clientY}:{x:e.clientX,y:e.clientY}}function y(e){if(!i.imageUrl)return;u.value=!0;const t=w(e);p.x=t.x,p.y=t.y,f.x=i.offsetX||0,f.y=i.offsetY||0;const a=window.parent.document;a.addEventListener('mousemove',k),a.addEventListener('mouseup',C),a.addEventListener('touchmove',k,{passive:!1}),a.addEventListener('touchend',C)}function k(e){if(!u.value)return;e.preventDefault();const t=w(e),a=d.value;if(!a)return;const o=a.getBoundingClientRect(),n=(t.x-p.x)/o.width*100,r=(t.y-p.y)/o.height*100;i.offsetX=Math.max(-50,Math.min(50,f.x+n)),i.offsetY=Math.max(-50,Math.min(50,f.y+r))}function C(){if(!u.value)return;u.value=!1;const e=window.parent.document;e.removeEventListener('mousemove',k),e.removeEventListener('mouseup',C),e.removeEventListener('touchmove',k),e.removeEventListener('touchend',C),x()}function N(){c.value?.click()}function V(e){const t=e.target,o=t.files?.[0];o&&async function(e){if(!['image/jpeg','image/png','image/gif','image/webp'].includes(e.type))return void alert('不支持的图片格式，请使用 jpg/png/gif/webp 格式');if(e.size>Gd)return void alert('图片大小超过限制（最大 2MB）');try{const{blob:t,mimeType:o}=await(0,Nd.DZ)(e);await(0,Nd.saveBackground)(n.value,t,o),n.value!==a.storageKey&&await(0,Nd.saveBackground)(a.storageKey,t,o),v.value&&(0,Nd.dQ)(v.value);const r=await(0,Nd.$H)(n.value);r&&(v.value=r,i.imageUrl=r),i.hasIndexedDBImage=!0,i.externalUrl=void 0,l.value='',h(),console.info('[BackgroundConfigPanel] 背景图片已保存到 IndexedDB')}catch(e){console.error('[BackgroundConfigPanel] 保存背景图片失败:',e),alert('保存背景图片失败')}}(o),t.value=''}async function E(){const e=l.value.trim();if(e&&e!==i.imageUrl){if(e.startsWith('http://')||e.startsWith('https://'))return v.value&&((0,Nd.dQ)(v.value),v.value=null),i.imageUrl=e,i.externalUrl=e,i.hasIndexedDBImage=!1,h(),void console.info('[BackgroundConfigPanel] 使用外部 URL:',e);if(e.startsWith('data:'))try{const{blob:t,mimeType:o}=await(0,Nd.eO)(e);await(0,Nd.saveBackground)(n.value,t,o),n.value!==a.storageKey&&await(0,Nd.saveBackground)(a.storageKey,t,o),v.value&&(0,Nd.dQ)(v.value);const r=await(0,Nd.$H)(n.value);r&&(v.value=r,i.imageUrl=r),i.hasIndexedDBImage=!0,i.externalUrl=void 0,h(),console.info('[BackgroundConfigPanel] data URL 已保存到 IndexedDB')}catch(e){console.error('[BackgroundConfigPanel] 保存 data URL 失败:',e),alert('保存图片失败')}}}async function B(){v.value&&((0,Nd.dQ)(v.value),v.value=null);try{await(0,Nd.e$)(n.value)}catch(e){console.warn('[BackgroundConfigPanel] 删除背景图片失败:',e)}i.imageUrl='',i.hasIndexedDBImage=!1,i.externalUrl=void 0,l.value='',h()}return(0,m.watch)(()=>a.modelValue,e=>{Object.assign(i,e),e.externalUrl&&(l.value=e.externalUrl)},{deep:!0}),(0,m.watch)(()=>a.modelValue.imageUrl,e=>{e!==i.imageUrl&&(v.value&&v.value!==e&&((0,Nd.dQ)(v.value),v.value=null),i.imageUrl=e||'',e&&e.startsWith('blob:')&&(v.value=e),console.info('[BackgroundConfigPanel] imageUrl 已同步:',e?'有图片':'无图片'))}),(0,m.onMounted)(()=>{!async function(){if(i.imageUrl)i.imageUrl.startsWith('blob:')&&(v.value=i.imageUrl);else if(i.externalUrl)i.imageUrl=i.externalUrl,l.value=i.externalUrl;else if(i.hasIndexedDBImage)try{let e=await(0,Nd.$H)(n.value);e||n.value===a.storageKey||(e=await(0,Nd.$H)(a.storageKey)),e&&(v.value&&(0,Nd.dQ)(v.value),v.value=e,i.imageUrl=e)}catch(e){console.warn('[BackgroundConfigPanel] 加载背景图片失败:',e)}}()}),(0,m.onBeforeUnmount)(()=>{v.value&&((0,Nd.dQ)(v.value),v.value=null)}),(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',Vd,[t[18]||(t[18]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-image'}),(0,m.createTextVNode)(' 背景配置 '),(0,m.createElementVNode)('span',{style:{'font-weight':'400','font-size':'11px',color:'var(--acu-text-sub)','margin-left':'auto'}},' 自定义背景图片 ')],-1)),(0,m.createElementVNode)('div',Ed,[(0,m.createCommentVNode)(' 启用背景 '),(0,m.createElementVNode)('div',Bd,[t[8]||(t[8]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 启用背景 '),(0,m.createElementVNode)('span',{class:'hint'},'显示自定义背景图片')],-1)),(0,m.createElementVNode)('div',Td,[(0,m.createElementVNode)('label',Sd,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>i.enabled=e),type:'checkbox',onChange:x},null,544),[[m.vModelCheckbox,i.enabled]]),t[7]||(t[7]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])])])]),(0,m.createCommentVNode)(' 背景详细设置 '),i.enabled?((0,m.openBlock)(),(0,m.createElementBlock)('div',Dd,[(0,m.createCommentVNode)(' 图片预览区域 - 可拖动定位 '),(0,m.createElementVNode)('div',Ad,[(0,m.createElementVNode)('div',{ref_key:'previewRef',ref:d,class:(0,m.normalizeClass)(['acu-background-preview',{dragging:u.value,'has-image':!!i.imageUrl}]),onMousedown:(0,m.withModifiers)(y,['prevent']),onTouchstart:(0,m.withModifiers)(y,['prevent'])},[(0,m.createCommentVNode)(' 有图片时显示预览 '),i.imageUrl?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-preview-image',style:(0,m.normalizeStyle)(b.value)},null,4)):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 无图片时显示提示 '),t[9]||(t[9]=(0,m.createElementVNode)('div',{class:'acu-no-image-hint'},[(0,m.createElementVNode)('i',{class:'fas fa-image'}),(0,m.createElementVNode)('span',null,'暂无背景图片')],-1))],64))],34)]),(0,m.createCommentVNode)(' 操作按钮行 '),(0,m.createElementVNode)('div',zd,[(0,m.createElementVNode)('button',{class:'acu-action-btn',onClick:(0,m.withModifiers)(N,['stop'])},[...t[10]||(t[10]=[(0,m.createElementVNode)('i',{class:'fas fa-camera'},null,-1),(0,m.createTextVNode)(' 上传图片 ',-1)])]),(0,m.createElementVNode)('button',{class:'acu-action-btn',onClick:t[1]||(t[1]=(0,m.withModifiers)(e=>s.value=!s.value,['stop']))},[...t[11]||(t[11]=[(0,m.createElementVNode)('i',{class:'fas fa-link'},null,-1),(0,m.createTextVNode)(' 使用URL ',-1)])]),(0,m.createElementVNode)('button',{class:'acu-action-btn acu-action-btn-danger',onClick:(0,m.withModifiers)(B,['stop'])},[...t[12]||(t[12]=[(0,m.createElementVNode)('i',{class:'fas fa-trash'},null,-1),(0,m.createTextVNode)(' 清除 ',-1)])]),(0,m.createCommentVNode)(' 隐藏的文件输入 '),(0,m.createElementVNode)('input',{ref_key:'fileInputRef',ref:c,type:'file',accept:'image/jpeg,image/png,image/gif,image/webp',style:{display:'none'},onChange:V},null,544)]),(0,m.createCommentVNode)(' URL 输入框（可折叠） '),s.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Id,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[2]||(t[2]=e=>l.value=e),type:'text',placeholder:'输入图片 URL（https://...）',class:'acu-background-url-input',onBlur:E,onKeyup:(0,m.withKeys)(E,['enter'])},null,544),[[m.vModelText,l.value]])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 缩放 '),(0,m.createElementVNode)('div',_d,[(0,m.createElementVNode)('div',Md,[t[13]||(t[13]=(0,m.createTextVNode)(' 缩放 ',-1)),(0,m.createElementVNode)('span',Ud,(0,m.toDisplayString)(i.scale)+'%',1)]),(0,m.createElementVNode)('div',Pd,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[3]||(t[3]=e=>i.scale=e),type:'range',min:'50',max:'200',step:'5',onChange:x},null,544),[[m.vModelText,i.scale,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 透明度 '),(0,m.createElementVNode)('div',$d,[(0,m.createElementVNode)('div',Ld,[t[14]||(t[14]=(0,m.createTextVNode)(' 透明度 ',-1)),(0,m.createElementVNode)('span',Fd,(0,m.toDisplayString)(i.opacity)+'%',1)]),(0,m.createElementVNode)('div',jd,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[4]||(t[4]=e=>i.opacity=e),type:'range',min:'0',max:'100',step:'5',onChange:x},null,544),[[m.vModelText,i.opacity,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 填充方式 '),(0,m.createElementVNode)('div',Od,[t[16]||(t[16]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 填充方式 '),(0,m.createElementVNode)('span',{class:'hint'},'图片如何填充容器')],-1)),(0,m.createElementVNode)('div',Rd,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':t[5]||(t[5]=e=>i.size=e),class:'acu-select',onChange:x},[...t[15]||(t[15]=[(0,m.createElementVNode)('option',{value:'cover'},'覆盖',-1),(0,m.createElementVNode)('option',{value:'auto'},'自动',-1)])],544),[[m.vModelSelect,i.size]])])]),(0,m.createCommentVNode)(' 模糊度 '),(0,m.createElementVNode)('div',Hd,[(0,m.createElementVNode)('div',Wd,[t[17]||(t[17]=(0,m.createTextVNode)(' 模糊度 ',-1)),(0,m.createElementVNode)('span',Yd,(0,m.toDisplayString)(i.blur)+'px',1)]),(0,m.createElementVNode)('div',Xd,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t[6]||(t[6]=e=>i.blur=e),type:'range',min:'0',max:'20',step:'1',onChange:x},null,544),[[m.vModelText,i.blur,void 0,{number:!0}]])])])])):(0,m.createCommentVNode)('v-if',!0)]))}});u(2731);const Kd=(0,et.A)(qd,[['__scopeId','data-v-acd94642']]),Jd={class:'acu-preset-header'},Zd={class:'acu-settings-row'},Qd={class:'acu-settings-label'},eu={class:'hint'},tu={class:'acu-settings-control acu-preset-control'},au={class:'acu-preset-selected-name'},ou={class:'acu-preset-dropdown-menu'},nu={key:0,class:'acu-migrate-hint'},ru=['onClick'],iu={class:'acu-preset-option-name'},lu=['onClick'],cu=['onClick'],su={key:2,class:'acu-migrate-hint'},du={class:'acu-preset-actions'},uu={key:0,class:'acu-dimension-toolbar'},pu=['title'],mu={key:0,class:'toolbar-badge'},fu=(0,m.defineComponent)({__name:'PresetManagerHeader',props:{presets:{},activePresetId:{},title:{},hint:{},showToolbar:{type:Boolean,default:!1},isMigrating:{type:Boolean,default:!1},selectedCount:{default:0}},emits:['select','restore-default','delete','save','save-as','collapse-all','expand-all','import','export-current','export-all','toggle-migrate','migrate-to'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.ref)(!1),r=(0,m.computed)(()=>{if(!a.activePresetId)return'默认配置';const e=a.presets.find(e=>e.id===a.activePresetId);return e?e.name:'默认配置'});function i(){n.value=!n.value}function l(e){e.target.closest('.acu-preset-dropdown')||(n.value=!1)}return(0,m.onMounted)(()=>{document.addEventListener('click',l)}),(0,m.onUnmounted)(()=>{document.removeEventListener('click',l)}),(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',Jd,[(0,m.createElementVNode)('div',Zd,[(0,m.createElementVNode)('div',Qd,[(0,m.createTextVNode)((0,m.toDisplayString)(e.title||'预设管理')+' ',1),(0,m.createElementVNode)('span',eu,(0,m.toDisplayString)(e.hint||'保存和加载配置'),1)]),(0,m.createElementVNode)('div',tu,[(0,m.createCommentVNode)(' 下拉选择框 '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-preset-dropdown',{open:n.value}])},[(0,m.createElementVNode)('button',{class:'acu-preset-dropdown-btn',onClick:(0,m.withModifiers)(i,['stop'])},[(0,m.createElementVNode)('span',au,(0,m.toDisplayString)(r.value),1),a[9]||(a[9]=(0,m.createElementVNode)('i',{class:'fas fa-chevron-down'},null,-1))]),(0,m.withDirectives)((0,m.createElementVNode)('div',ou,[(0,m.createCommentVNode)(' 默认配置 '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-preset-option',{active:!e.activePresetId,'migrate-disabled':e.isMigrating}]),onClick:a[0]||(a[0]=(0,m.withModifiers)(t=>!e.isMigrating&&(o('restore-default'),void(n.value=!1)),['stop']))},[a[10]||(a[10]=(0,m.createElementVNode)('span',{class:'acu-preset-option-name'},'默认配置',-1)),e.isMigrating?((0,m.openBlock)(),(0,m.createElementBlock)('span',nu,'不可迁入')):(0,m.createCommentVNode)('v-if',!0)],2),(0,m.createCommentVNode)(' 用户预设 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.presets,r=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:r.id,class:(0,m.normalizeClass)(['acu-preset-option',{active:e.activePresetId===r.id,'migrate-target':e.isMigrating&&e.activePresetId!==r.id,'migrate-disabled':e.isMigrating&&e.activePresetId===r.id}]),onClick:(0,m.withModifiers)(t=>{return!e.isMigrating&&(a=r.id,o('select',a),void(n.value=!1));var a},['stop'])},[(0,m.createElementVNode)('span',iu,(0,m.toDisplayString)(r.name),1),(0,m.createCommentVNode)(' 正常模式：删除按钮 '),e.isMigrating||r.isBuiltin?(0,m.createCommentVNode)('v-if',!0):((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-preset-delete-btn',title:'删除',onClick:(0,m.withModifiers)(e=>{return t=r.id,void o('delete',t);var t},['stop'])},[...a[11]||(a[11]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])],8,lu)),(0,m.createCommentVNode)(' 迁移模式：迁入按钮（排除当前激活的预设） '),e.isMigrating&&e.activePresetId!==r.id?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:1,class:'acu-icon-btn migrate-in',title:'迁移选中的维度到此预设',onClick:(0,m.withModifiers)(e=>t.$emit('migrate-to',r.id),['stop'])},[...a[12]||(a[12]=[(0,m.createElementVNode)('i',{class:'fas fa-arrow-down'},null,-1)])],8,cu)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 迁移模式：当前预设提示 '),e.isMigrating&&e.activePresetId===r.id?((0,m.openBlock)(),(0,m.createElementBlock)('span',su,'当前')):(0,m.createCommentVNode)('v-if',!0)],10,ru))),128))],512),[[m.vShow,n.value]])],2),(0,m.createCommentVNode)(' 操作按钮组 '),(0,m.createElementVNode)('div',du,[(0,m.createCommentVNode)(' 另存为 '),(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'另存为新预设',onClick:a[1]||(a[1]=(0,m.withModifiers)(e=>t.$emit('save-as'),['stop']))},[...a[13]||(a[13]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])]),(0,m.createCommentVNode)(' 保存 '),(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'保存当前预设',onClick:a[2]||(a[2]=(0,m.withModifiers)(e=>t.$emit('save'),['stop']))},[...a[14]||(a[14]=[(0,m.createElementVNode)('i',{class:'fas fa-save'},null,-1)])]),(0,m.createCommentVNode)(' 插槽：允许父组件添加额外按钮 '),(0,m.renderSlot)(t.$slots,'actions')])])]),(0,m.createCommentVNode)(' 工具栏（可选显示） '),e.showToolbar?((0,m.openBlock)(),(0,m.createElementBlock)('div',uu,[a[21]||(a[21]=(0,m.createElementVNode)('span',{class:'toolbar-label'},'工具',-1)),a[22]||(a[22]=(0,m.createElementVNode)('span',{class:'toolbar-spacer'},null,-1)),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:'全部折叠',onClick:a[3]||(a[3]=(0,m.withModifiers)(e=>t.$emit('collapse-all'),['stop']))},[...a[15]||(a[15]=[(0,m.createElementVNode)('i',{class:'fas fa-compress-alt'},null,-1)])]),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:'全部展开',onClick:a[4]||(a[4]=(0,m.withModifiers)(e=>t.$emit('expand-all'),['stop']))},[...a[16]||(a[16]=[(0,m.createElementVNode)('i',{class:'fas fa-expand-alt'},null,-1)])]),a[23]||(a[23]=(0,m.createElementVNode)('span',{class:'toolbar-divider'},null,-1)),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:'导入预设',onClick:a[5]||(a[5]=(0,m.withModifiers)(e=>t.$emit('import'),['stop']))},[...a[17]||(a[17]=[(0,m.createElementVNode)('i',{class:'fas fa-file-import'},null,-1)])]),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:'导出当前预设',onClick:a[6]||(a[6]=(0,m.withModifiers)(e=>t.$emit('export-current'),['stop']))},[...a[18]||(a[18]=[(0,m.createElementVNode)('i',{class:'fas fa-file-export'},null,-1)])]),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:'备份所有预设',onClick:a[7]||(a[7]=(0,m.withModifiers)(e=>t.$emit('export-all'),['stop']))},[...a[19]||(a[19]=[(0,m.createElementVNode)('i',{class:'fas fa-archive'},null,-1)])]),a[24]||(a[24]=(0,m.createElementVNode)('span',{class:'toolbar-divider'},null,-1)),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-icon-btn',{active:e.isMigrating}]),title:e.isMigrating?`退出迁移 (已选${e.selectedCount}个)`:'迁移模式',onClick:a[8]||(a[8]=(0,m.withModifiers)(e=>t.$emit('toggle-migrate'),['stop']))},[...a[20]||(a[20]=[(0,m.createElementVNode)('i',{class:'fas fa-exchange-alt'},null,-1)])],10,pu),e.isMigrating?((0,m.openBlock)(),(0,m.createElementBlock)('span',mu,(0,m.toDisplayString)(e.selectedCount),1)):(0,m.createCommentVNode)('v-if',!0)])):(0,m.createCommentVNode)('v-if',!0)]))}}),gu={class:'acu-theme-panel'},vu={class:'acu-theme-scroll-content'},bu={class:'acu-settings-section'},hu={class:'acu-settings-group'},xu={class:'acu-settings-row'},wu={class:'acu-settings-control'},yu=['value'],ku={class:'acu-settings-section'},Cu={class:'acu-settings-group'},Nu={class:'acu-settings-row'},Vu={class:'acu-settings-control acu-color-picker-inline'},Eu={class:'acu-settings-row'},Bu={class:'acu-settings-control acu-color-picker-inline'},Tu={class:'acu-settings-row'},Su={class:'acu-settings-control acu-color-picker-inline'},Du={class:'acu-settings-section'},Au={class:'acu-var-groups-container'},zu=['onClick'],Iu={class:'acu-var-count'},_u={class:'acu-var-group-body'},Mu={class:'acu-var-line-primary'},Uu={class:'acu-var-label'},Pu={class:'acu-var-color-row'},$u=['onClick'],Lu=['value','onChange'],Fu=['value','onChange'],ju={class:'acu-var-line-secondary'},Ou={class:'acu-var-name'},Ru={class:'acu-var-opacity-row'},Hu=['value','onInput'],Wu={class:'acu-opacity-value'},Yu={class:'acu-settings-section'},Xu={class:'acu-settings-group'},Gu={class:'acu-settings-row'},qu={class:'acu-settings-label'},Ku={class:'hint'},Ju={class:'acu-settings-control acu-css-actions'},Zu=(0,m.defineComponent)({__name:'ThemePanel',setup(e){const t=(0,g.C)(),a=(0,f.JH)(),o=(0,k.j_)(),n=(0,O.d)();function r(){return t.presets||[]}function i(){return t.activePresetId}function l(){return t.currentThemeVars||{}}function c(){return t.currentHighlight}function s(){return t.customCSS||''}function d(){return t.currentThemeVarOpacities||{}}function u(){return t.getBackgroundConfig()}const p=(0,m.ref)('#d35400'),v=(0,m.ref)('#3498db'),b=(0,m.ref)('#d35400'),h=(0,m.ref)('retro'),x=(0,m.ref)([]),w=(0,m.ref)(''),y=(0,m.ref)();(0,m.computed)(()=>{const e=i();if(!e)return'默认配置';const t=r().find(t=>t.id===e);return t?.name||'默认配置'});function C(){p.value=t.manualHighlightColor,v.value=t.aiHighlightColor,b.value=t.titleColor}function N(){var e;e=null,t.activePresetId=e,t.clearThemeVars(),t.clearThemeVarOpacities(),C(),w.value='',t.clearCustomCSS(),n.success('已恢复默认配置')}function V(e){t.applyPreset(e),C(),w.value=s(),h.value=a.config.theme||'retro',n.success('预设已应用')}function E(e){const a=r().find(t=>t.id===e);a&&confirm(`确定要删除预设「${a.name}」吗？`)&&(t.deletePreset(e),n.info('预设已删除'))}function B(){try{const e=i();if(e){const a=r().find(t=>t.id===e);if(a)return t.saveCurrentToPreset(a.name),void n.success(`预设「${a.name}」已更新`)}T()}catch(e){console.error('保存失败:',e),n.error('保存失败，请查看控制台')}}function T(){o.openPresetSaveDialog({presetType:'theme',summaryItems:[],initialName:'',checkDuplicate:e=>r().some(t=>t.name===e)},{onSave:e=>{t.saveCurrentToPreset(e),n.success(`预设「${e}」已保存`)}})}function S(){a.setTheme(h.value),setTimeout(()=>{const e=p.value;p.value=e},100)}function D(){t.setManualHighlightColor('custom',p.value)}function A(){t.setAiHighlightColor('custom',v.value)}function I(){t.setTitleColor('custom',b.value)}function M(e){const t=l();return e.vars.filter(e=>t[e.key]).length}function U(e){return l()[e]||''}function P(e){const t=U(e);return t&&t.startsWith('#')&&(4===t.length||7===t.length)?t:'#888888'}function L(e,a){a.trim()?t.setThemeVar(e,a.trim()):t.removeThemeVar(e)}function F(e){const t=d();return void 0!==t[e]&&100!==t[e]}function j(e){return d()[e]??100}function R(){t.setCustomCSS(w.value)}function H(){confirm('确定要清空自定义 CSS 吗？')&&(w.value='',t.clearCustomCSS())}function W(){const e={type:'acu_theme_config',version:'1.1',timestamp:(new Date).toISOString(),theme:h.value,highlight:c(),themeVars:l(),themeVarOpacities:d(),backgroundConfig:u(),customCSS:s()},t=new Blob([JSON.stringify(e,null,2)],{type:'application/json'}),a=URL.createObjectURL(t),o=document.createElement('a');o.href=a,o.download=`acu-theme-${Date.now()}.json`,o.click(),URL.revokeObjectURL(a),n.success('配置已导出')}function Y(){y.value?.click()}function X(e){const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([0-9.]+))?\)/);if(t){const e=parseInt(t[1]),a=parseInt(t[2]),o=parseInt(t[3]),n=t[4]?parseFloat(t[4]):1,r=e=>{const t=e.toString(16);return 1===t.length?'0'+t:t};return{hex:`#${r(e)}${r(a)}${r(o)}`,opacity:Math.round(100*n)}}if(e.startsWith('#')&&9===e.length){const t=e.slice(0,7),a=e.slice(7,9),o=parseInt(a,16)/255;return{hex:t,opacity:Math.round(100*o)}}return null}function G(){if(!w.value.trim())return void n.info('CSS 内容为空');const e={};for(const[t,a]of Object.entries(jt.DR))e[a]=t;let a=w.value,o=0;const r=/(--acu-[a-z0-9-]+)\s*:\s*([^;]+?)\s*(?:!important)?\s*;/gi;let i;for(;null!==(i=r.exec(w.value));){const a=i[1],n=i[2].trim(),r=e[a];if(r){const e=n,a=X(e);a?(t.setThemeVar(r,a.hex),t.setThemeVarOpacity(r,a.opacity)):(t.setThemeVar(r,e),t.setThemeVarOpacity(r,100)),o++}}if(o>0){for(const[e,t]of Object.entries(jt.DR)){const e=new RegExp(`${t}\\s*:\\s*[^;]+?;`,'gi');a=a.replace(e,'')}a=a.replace(/\n\s*\n\s*\n/g,'\n\n').trim(),w.value=a,t.setCustomCSS(a),C(),n.success(`成功提取 ${o} 个变量到滑块设置`)}else n.info('未找到可同步的主题变量')}function q(e){const o=e.target.files?.[0];if(!o)return;const r=new FileReader;r.onload=e=>{try{const r=e.target?.result;if(o.name.endsWith('.json')){const e=JSON.parse(r);if('acu_theme_config'!==e.type)throw new Error('无效的配置文件格式');if(e.theme&&(h.value=e.theme,a.setTheme(e.theme)),e.highlight){const t=c();t.manualColor=e.highlight.manualColor||'custom',t.manualHex=e.highlight.manualHex,t.aiColor=e.highlight.aiColor||'custom',t.aiHex=e.highlight.aiHex,t.titleColor=e.highlight.titleColor||'custom',t.titleHex=e.highlight.titleHex}if(e.themeVars){const t=l();Object.assign(t,e.themeVars)}if(e.themeVarOpacities){const t=d();Object.assign(t,e.themeVarOpacities)}e.backgroundConfig&&t.setBackgroundConfig(e.backgroundConfig),e.customCSS&&(w.value=e.customCSS,t.setCustomCSS(e.customCSS)),C(),n.success('主题配置已导入')}else w.value=r,t.setCustomCSS(r),n.success('CSS 已导入')}catch(e){console.error('[ThemePanel] 导入失败:',e),n.error('导入失败：无效的文件格式')}},r.readAsText(o),e.target.value=''}return(0,m.onMounted)(async()=>{await t.loadFromStorage(),C(),h.value=a.config.theme||'retro',w.value=s()}),(0,m.watch)(()=>c(),()=>C(),{deep:!0}),(0,m.watch)(()=>a.config.theme,e=>{h.value=e||'retro'}),(e,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',gu,[(0,m.createCommentVNode)(' 固定区域：预设管理 '),(0,m.createVNode)(fu,{presets:r(),'active-preset-id':i(),title:'预设管理',hint:'保存和加载主题配置',onSelect:V,onRestoreDefault:N,onDelete:E,onSave:B,onSaveAs:T},null,8,['presets','active-preset-id']),(0,m.createCommentVNode)(' 可滚动区域 '),(0,m.createElementVNode)('div',vu,[(0,m.createCommentVNode)(' 主题风格选择 '),(0,m.createElementVNode)('div',bu,[a[10]||(a[10]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-palette'}),(0,m.createTextVNode)(' 主题风格 ')],-1)),(0,m.createElementVNode)('div',hu,[(0,m.createElementVNode)('div',xu,[a[9]||(a[9]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 界面配色 '),(0,m.createElementVNode)('span',{class:'hint'},'选择界面配色方案')],-1)),(0,m.createElementVNode)('div',wu,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[0]||(a[0]=e=>h.value=e),class:'acu-select',onChange:S},[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)((0,m.unref)(f.zG),e=>((0,m.openBlock)(),(0,m.createElementBlock)('option',{key:e.id,value:e.id},(0,m.toDisplayString)(e.name),9,yu))),128))],544),[[m.vModelSelect,h.value]])])])])]),(0,m.createCommentVNode)(' 背景配置 '),(0,m.createVNode)(Kd,{'storage-key':(0,m.unref)(Nd.Aq),'model-value':u(),'onUpdate:modelValue':a[1]||(a[1]=e=>(0,m.unref)(t).setBackgroundConfig(e))},null,8,['storage-key','model-value']),(0,m.createCommentVNode)(' 高亮颜色配置 '),(0,m.createElementVNode)('div',ku,[a[14]||(a[14]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-highlighter'}),(0,m.createTextVNode)(' 高亮颜色 ')],-1)),(0,m.createElementVNode)('div',Cu,[(0,m.createCommentVNode)(' 手动修改高亮颜色 '),(0,m.createElementVNode)('div',Nu,[a[11]||(a[11]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 手动修改高亮 '),(0,m.createElementVNode)('span',{class:'hint'},'手动编辑内容的标记颜色')],-1)),(0,m.createElementVNode)('div',Vu,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[2]||(a[2]=e=>p.value=e),type:'text',class:'acu-color-input',placeholder:'#RRGGBB',onChange:D},null,544),[[m.vModelText,p.value]]),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[3]||(a[3]=e=>p.value=e),type:'color',class:'acu-color-swatch',onChange:D},null,544),[[m.vModelText,p.value]])])]),(0,m.createCommentVNode)(' AI 填表高亮颜色 '),(0,m.createElementVNode)('div',Eu,[a[12]||(a[12]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' AI 填表高亮 '),(0,m.createElementVNode)('span',{class:'hint'},'AI 自动填写内容的标记颜色')],-1)),(0,m.createElementVNode)('div',Bu,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[4]||(a[4]=e=>v.value=e),type:'text',class:'acu-color-input',placeholder:'#RRGGBB',onChange:A},null,544),[[m.vModelText,v.value]]),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[5]||(a[5]=e=>v.value=e),type:'color',class:'acu-color-swatch',onChange:A},null,544),[[m.vModelText,v.value]])])]),(0,m.createCommentVNode)(' 标题颜色 '),(0,m.createElementVNode)('div',Tu,[a[13]||(a[13]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 标题颜色 '),(0,m.createElementVNode)('span',{class:'hint'},'表格标题的颜色')],-1)),(0,m.createElementVNode)('div',Su,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[6]||(a[6]=e=>b.value=e),type:'text',class:'acu-color-input',placeholder:'#RRGGBB',onChange:I},null,544),[[m.vModelText,b.value]]),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[7]||(a[7]=e=>b.value=e),type:'color',class:'acu-color-swatch',onChange:I},null,544),[[m.vModelText,b.value]])])])])]),(0,m.createCommentVNode)(' 主题变量自定义 '),(0,m.createElementVNode)('div',Du,[a[16]||(a[16]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-paint-brush'}),(0,m.createTextVNode)(' 主题变量自定义 '),(0,m.createElementVNode)('span',{class:'hint',style:{'margin-left':'auto','font-weight':'normal'}},'覆盖当前主题的 CSS 变量')],-1)),(0,m.createCommentVNode)(' 连续的可折叠组 '),(0,m.createElementVNode)('div',Au,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)((0,m.unref)(jt.j7),(e,o)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:(0,m.normalizeClass)(['acu-var-group',{first:0===o,last:o===(0,m.unref)(jt.j7).length-1}])},[(0,m.createElementVNode)('div',{class:'acu-var-group-header',onClick:(0,m.withModifiers)(t=>function(e){const t=x.value.indexOf(e);t>-1?x.value.splice(t,1):x.value.push(e)}(e.id),['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',e.icon])},null,2),(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(e.name),1),(0,m.createElementVNode)('span',Iu,(0,m.toDisplayString)(M(e))+'/'+(0,m.toDisplayString)(e.vars.length),1),(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',x.value.includes(e.id)?'fa-chevron-up':'fa-chevron-down'])},null,2)],8,zu),(0,m.withDirectives)((0,m.createElementVNode)('div',_u,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.vars,e=>{return(0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.key,class:'acu-var-row acu-var-row-tall'},[(0,m.createCommentVNode)(' 第一行：标签 + 颜色控件 '),(0,m.createElementVNode)('div',Mu,[(0,m.createElementVNode)('div',Uu,(0,m.toDisplayString)(e.label),1),(0,m.createElementVNode)('div',Pu,[(o=e.key,l()[o]||F(e.key)?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-var-reset',title:'恢复默认',onClick:(0,m.withModifiers)(a=>function(e){t.removeThemeVar(e),t.removeThemeVarOpacity(e)}(e.key),['stop'])},[...a[15]||(a[15]=[(0,m.createElementVNode)('i',{class:'fas fa-undo'},null,-1)])],8,$u)):(0,m.createCommentVNode)('v-if',!0)),(0,m.createElementVNode)('input',{value:U(e.key),type:'text',class:'acu-color-input',placeholder:'使用主题默认值',onChange:t=>L(e.key,t.target.value)},null,40,Lu),(0,m.createElementVNode)('input',{value:P(e.key),type:'color',class:'acu-color-swatch',onChange:t=>L(e.key,t.target.value)},null,40,Fu)])]),(0,m.createCommentVNode)(' 第二行：变量名 + 透明度滑块 '),(0,m.createElementVNode)('div',ju,[(0,m.createElementVNode)('code',Ou,(0,m.toDisplayString)((0,m.unref)(jt.DR)[e.key]),1),(0,m.createElementVNode)('div',Ru,[(0,m.createElementVNode)('input',{type:'range',class:'acu-range-input',min:'0',max:'100',value:j(e.key),onInput:a=>function(e,a){t.setThemeVarOpacity(e,a)}(e.key,Number(a.target.value))},null,40,Hu),(0,m.createElementVNode)('span',Wu,(0,m.toDisplayString)(j(e.key)),1)])])]);var o}),128))],512),[[m.vShow,x.value.includes(e.id)]])],2))),128))])]),(0,m.createCommentVNode)(' 自定义 CSS '),(0,m.createElementVNode)('div',Yu,[a[23]||(a[23]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-code'}),(0,m.createTextVNode)(' 自定义 CSS ')],-1)),(0,m.createElementVNode)('div',Xu,[(0,m.createElementVNode)('div',Gu,[(0,m.createElementVNode)('div',qu,[a[17]||(a[17]=(0,m.createTextVNode)(' CSS 代码 ',-1)),(0,m.createElementVNode)('span',Ku,(0,m.toDisplayString)(w.value.length)+' 字符',1)]),(0,m.createElementVNode)('div',Ju,[(0,m.createElementVNode)('button',{class:'acu-tool-btn',onClick:(0,m.withModifiers)(W,['stop'])},[...a[18]||(a[18]=[(0,m.createElementVNode)('i',{class:'fas fa-download'},null,-1),(0,m.createTextVNode)(' 导出 ',-1)])]),(0,m.createElementVNode)('button',{class:'acu-tool-btn',onClick:(0,m.withModifiers)(Y,['stop'])},[...a[19]||(a[19]=[(0,m.createElementVNode)('i',{class:'fas fa-upload'},null,-1),(0,m.createTextVNode)(' 导入 ',-1)])]),(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'将 CSS 中的变量提取到滑块设置中，并从 CSS 中移除',onClick:(0,m.withModifiers)(G,['stop'])},[...a[20]||(a[20]=[(0,m.createElementVNode)('i',{class:'fas fa-magic'},null,-1),(0,m.createTextVNode)(' 转为滑块 ',-1)])]),(0,m.createElementVNode)('button',{class:'acu-tool-btn acu-btn-danger',onClick:(0,m.withModifiers)(H,['stop'])},[...a[21]||(a[21]=[(0,m.createElementVNode)('i',{class:'fas fa-trash'},null,-1),(0,m.createTextVNode)(' 清空 ',-1)])])])]),a[22]||(a[22]=(0,m.createElementVNode)('div',{class:'acu-css-hint'},[(0,m.createElementVNode)('p',null,'常用选择器：'),(0,m.createElementVNode)('code',null,'.acu-app, .acu-wrapper'),(0,m.createTextVNode)(),(0,m.createElementVNode)('code',null,'.acu-floating-ball'),(0,m.createElementVNode)('code',null,'.acu-data-card')],-1)),(0,m.withDirectives)((0,m.createElementVNode)('textarea',{'onUpdate:modelValue':a[8]||(a[8]=e=>w.value=e),class:'acu-css-editor',placeholder:'/* 在此输入自定义 CSS */',rows:'8',onChange:R},null,544),[[m.vModelText,w.value]])])])]),(0,m.createCommentVNode)(' 预设保存弹窗已迁移到全局 App.vue 中 '),(0,m.createCommentVNode)(' 隐藏的文件输入 '),(0,m.createElementVNode)('input',{ref_key:'fileInputRef',ref:y,type:'file',accept:'.json,.css,.txt',style:{display:'none'},onChange:q},null,544)]))}}),Qu=Zu,ep={class:'acu-dimension-manager'},tp=['onClick'],ap=['onClick'],op={class:'header-left'},np=['onUpdate:modelValue'],rp={class:'header-right'},ip=['onUpdate:modelValue'],lp=['disabled','title','onClick'],cp={class:'dimension-content'},sp={class:'tier-list'},dp={class:'tier-row basic-info'},up={class:'tier-name-wrapper'},pp=['onUpdate:modelValue'],mp=['onUpdate:modelValue'],fp=['onClick'],gp={class:'tier-row weight-control'},vp=['onUpdate:modelValue'],bp={class:'acu-badge'},hp={class:'tier-row prompt-editor'},xp=['onUpdate:modelValue'],wp=['onClick'],yp={class:'acu-settings-section advanced-settings'},kp={class:'acu-settings-group template-settings-group'},Cp={class:'template-shortcuts-row'},Np={class:'template-editor-row'},Vp={class:'template-help-row'},Ep={class:'acu-wildcard-help'},Bp=(0,m.defineComponent)({__name:'DimensionManagerPanel',setup(e){const t=(0,Ot.E)(),a=(0,k.j_)(),o=(0,O.d)(),n=(0,m.ref)({}),r=(0,m.ref)(null),i=(0,m.ref)(null),l=(0,m.ref)(!0),s=(0,m.ref)(!1),d=(0,m.ref)(new Set),u=(0,m.toRef)(t.config,'customTemplate');(0,Be.AHd)({element:i,input:u});const p=()=>{l.value=!l.value};function f(e){t.applyPreset(e),o.success('已应用维度预设')}function g(){confirm('确定要恢复默认维度配置吗？当前未保存的修改将丢失。')&&(t.restoreDefaultDimensions(),o.success('已恢复默认维度配置'))}function v(e){const a=t.presets.find(t=>t.id===e);a&&confirm(`确定要删除预设「${a.name}」吗？`)&&(t.deletePreset(e),o.info('预设已删除'))}function b(){const e=t.activePresetId;if(e){const a=t.presets.find(t=>t.id===e);if(a)return t.saveCurrentToPreset(a.name),void o.success(`预设「${a.name}」已更新`)}h()}function h(){a.openPresetSaveDialog({presetType:'divination',summaryItems:[],initialName:'',checkDuplicate:e=>t.presets.some(t=>t.name===e)},{onSave:e=>{t.saveCurrentToPreset(e),o.success(`预设「${e}」已保存`)}})}function x(){const e=t.activePresetId;if(!e)return void o.warning('请先选择一个预设');const a=t.presets.find(t=>t.id===e);if(!a)return;y({type:'acu_divination_presets',version:'1.0',timestamp:(new Date).toISOString(),presets:[a]},`acu-preset-${a.name}-${Date.now()}.json`),o.success(`预设「${a.name}」已导出`)}function w(){y({type:'acu_divination_presets',version:'1.0',timestamp:(new Date).toISOString(),presets:t.presets},`acu-divination-backup-${Date.now()}.json`),o.success('所有预设已备份')}function y(e,t){const a=new Blob([JSON.stringify(e,null,2)],{type:'application/json'}),o=URL.createObjectURL(a),n=document.createElement('a');n.href=o,n.download=t,n.click(),URL.revokeObjectURL(o)}function C(){r.value?.click()}function N(e){const a=e.target.files?.[0];if(!a)return;const n=new FileReader;n.onload=e=>{try{const a=e.target?.result,n=JSON.parse(a);if('acu_divination_presets'===n.type&&Array.isArray(n.presets)){let e=0;n.presets.forEach(a=>{if(t.presets.find(e=>e.id===a.id)){const e=t.presets.findIndex(e=>e.id===a.id);t.presets[e]=a}else t.presets.push(a);e++}),t.saveConfig(),o.success(`成功导入 ${e} 个预设`)}else o.error('无效的预设文件格式')}catch(e){console.error('导入失败:',e),o.error('导入失败：文件格式错误')}},n.readAsText(a),e.target.value=''}(0,m.onMounted)(()=>{t.config.customTemplate||(t.config.customTemplate=Le)});function V(){t.config.dimensions.forEach(e=>{n.value[e.id]=!0})}function E(){t.config.dimensions.forEach(e=>{n.value[e.id]=!1})}function B(){s.value=!s.value,s.value?(d.value.clear(),o.info('迁移模式：点击选中要迁移的维度，然后选择目标预设')):d.value.clear()}function T(e){if(0===d.value.size)return void o.warning('请先选中要迁移的维度');const a=t.presets.find(t=>t.id===e);if(!a)return;const n=t.config.dimensions.filter(e=>d.value.has(e.id));t.migrateDimensionsToPreset(n,e),o.success(`已迁移 ${n.length} 个维度到「${a.name}」`),s.value=!1,d.value.clear()}const S=()=>{const e={id:c(),name:'新维度',enabled:!0,tiers:[{id:c(),name:'默认档位',weight:50,prompt:''}]};t.addDimension(e),n.value[e.id]=!1},D=e=>{const a=t.config.customTemplate||'';t.config.customTemplate=a+e;const o=i.value;o&&setTimeout(()=>{o.focus(),o.scrollTop=o.scrollHeight;const e=t.config.customTemplate.length;o.setSelectionRange(e,e)},0)};return(e,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',ep,[(0,m.createCommentVNode)(' 预设管理头部 '),(0,m.createVNode)(fu,{presets:(0,m.unref)(t).presets,'active-preset-id':(0,m.unref)(t).activePresetId,'show-toolbar':!0,'is-migrating':s.value,'selected-count':d.value.size,title:'维度预设',hint:'保存和加载维度配置',onSelect:f,onRestoreDefault:g,onDelete:v,onSave:b,onSaveAs:h,onCollapseAll:V,onExpandAll:E,onImport:C,onExportCurrent:x,onExportAll:w,onToggleMigrate:B,onMigrateTo:T},null,8,['presets','active-preset-id','is-migrating','selected-count']),(0,m.createCommentVNode)(' 维度列表 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)((0,m.unref)(t).config.dimensions,(e,o)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:(0,m.normalizeClass)(['acu-settings-section dimension-container',{'is-collapsed':n.value[e.id],'is-selected':s.value&&d.value.has(e.id)}]),onClick:t=>{return s.value?(a=e.id,d.value.has(a)?d.value.delete(a):d.value.add(a),void(d.value=new Set(d.value))):null;var a}},[(0,m.createCommentVNode)(' 维度标题行 '),(0,m.createElementVNode)('div',{class:'acu-settings-title dimension-header',onClick:t=>{return!s.value&&(a=e.id,void(n.value[a]=!n.value[a]));var a}},[(0,m.createElementVNode)('div',op,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas fa-chevron-right collapse-icon',{'is-expanded':!n.value[e.id]}])},null,2),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t=>e.name=t,class:'acu-input-minimal dimension-name-input',placeholder:'维度名称',onClick:a[0]||(a[0]=(0,m.withModifiers)(()=>{},['stop']))},null,8,np),[[m.vModelText,e.name]])]),(0,m.createElementVNode)('div',rp,[(0,m.createElementVNode)('label',{class:'acu-switch',onClick:a[1]||(a[1]=(0,m.withModifiers)(()=>{},['stop']))},[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':t=>e.enabled=t,type:'checkbox'},null,8,ip),[[m.vModelCheckbox,e.enabled]]),a[6]||(a[6]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))]),(0,m.createElementVNode)('button',{class:'acu-icon-btn danger',disabled:'luck'===e.id,title:'luck'===e.id?'运势维度不可删除':'删除维度',onClick:(0,m.withModifiers)(e=>{return a=o,void(confirm('确定要删除这个维度吗？此操作不可撤销。')&&t.removeDimension(a));var a},['stop'])},[...a[7]||(a[7]=[(0,m.createElementVNode)('i',{class:'fas fa-trash'},null,-1)])],8,lp)])],8,ap),(0,m.createCommentVNode)(' 档位列表 (展开区域) '),(0,m.withDirectives)((0,m.createElementVNode)('div',cp,[(0,m.createElementVNode)('div',sp,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.tiers,(n,r)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:n.id,class:'tier-item'},[(0,m.createCommentVNode)(' 第一行: 基本信息 '),(0,m.createElementVNode)('div',dp,[(0,m.createElementVNode)('div',up,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':e=>n.name=e,class:'acu-input-minimal tier-name-input',placeholder:'档位名称'},null,8,pp),[[m.vModelText,n.name]]),(0,m.createCommentVNode)(' 颜色选择器 (仅运势维度显示) '),'luck'===e.id?(0,m.withDirectives)(((0,m.openBlock)(),(0,m.createElementBlock)('input',{key:0,'onUpdate:modelValue':e=>n.color=e,type:'color',class:'acu-color-picker-mini',title:'档位颜色'},null,8,mp)),[[m.vModelText,n.color]]):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createElementVNode)('button',{class:'acu-icon-btn small danger',title:'删除档位',onClick:e=>((e,a)=>{t.config.dimensions[e].tiers.splice(a,1)})(o,r)},[...a[8]||(a[8]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])],8,fp)]),(0,m.createCommentVNode)(' 第二行: 权重调节 '),(0,m.createElementVNode)('div',gp,[a[9]||(a[9]=(0,m.createElementVNode)('span',{class:'label'},'权重',-1)),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':e=>n.weight=e,type:'range',min:'0',max:'100',step:'1',class:'acu-range-input'},null,8,vp),[[m.vModelText,n.weight,void 0,{number:!0}]]),(0,m.createElementVNode)('span',bp,(0,m.toDisplayString)(n.weight),1)]),(0,m.createCommentVNode)(' 第三行: 提示词 '),(0,m.createElementVNode)('div',hp,[(0,m.withDirectives)((0,m.createElementVNode)('textarea',{'onUpdate:modelValue':e=>n.prompt=e,class:'acu-textarea-scrollable compact',placeholder:'在此输入该档位的提示词...',rows:'2'},null,8,xp),[[m.vModelText,n.prompt]])])]))),128))]),(0,m.createCommentVNode)(' 添加档位按钮 '),(0,m.createElementVNode)('button',{class:'acu-btn-dashed full-width',onClick:e=>(e=>{const a={id:c(),name:'新档位',weight:10,prompt:'',color:'#808080'};t.config.dimensions[e].tiers.push(a)})(o)},[...a[10]||(a[10]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1),(0,m.createTextVNode)(' 添加新档位 ',-1)])],8,wp)],512),[[m.vShow,!n.value[e.id]]])],10,tp))),128)),(0,m.createCommentVNode)(' 新建维度按钮 '),(0,m.createElementVNode)('button',{class:'acu-btn-dashed full-width add-dimension-btn',onClick:S},[...a[11]||(a[11]=[(0,m.createElementVNode)('i',{class:'fas fa-layer-group'},null,-1),(0,m.createTextVNode)(' 新建维度 ',-1)])]),(0,m.createCommentVNode)(' 高级设置：自定义模板 '),(0,m.createElementVNode)('div',yp,[a[19]||(a[19]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('div',{class:'header-left'},[(0,m.createElementVNode)('i',{class:'fas fa-file-alt'}),(0,m.createTextVNode)(' 提示词模板 ')])],-1)),(0,m.createElementVNode)('div',kp,[(0,m.createCommentVNode)(' 1. 快捷按钮行 '),(0,m.createElementVNode)('div',Cp,[a[15]||(a[15]=(0,m.createElementVNode)('span',{class:'hint'},'快捷插入:',-1)),(0,m.createElementVNode)('button',{class:'acu-wildcard-btn',onClick:a[2]||(a[2]=e=>D('{{luck}}'))},[...a[12]||(a[12]=[(0,m.createElementVNode)('code',null,(0,m.toDisplayString)('{{luck}}'),-1)])]),(0,m.createElementVNode)('button',{class:'acu-wildcard-btn',onClick:a[3]||(a[3]=e=>D('{{words}}'))},[...a[13]||(a[13]=[(0,m.createElementVNode)('code',null,(0,m.toDisplayString)('{{words}}'),-1)])]),(0,m.createElementVNode)('button',{class:'acu-wildcard-btn',onClick:a[4]||(a[4]=e=>D('{{dimensions}}'))},[...a[14]||(a[14]=[(0,m.createElementVNode)('code',null,(0,m.toDisplayString)('{{dimensions}}'),-1)])])]),(0,m.createCommentVNode)(' 2. 文本框行 '),(0,m.createElementVNode)('div',Np,[(0,m.withDirectives)((0,m.createElementVNode)('textarea',{ref_key:'templateInputRef',ref:i,'onUpdate:modelValue':a[5]||(a[5]=e=>(0,m.unref)(t).config.customTemplate=e),class:'acu-edit-textarea template-textarea',placeholder:'在此输入自定义模板...',rows:'6'},null,512),[[m.vModelText,(0,m.unref)(t).config.customTemplate]])]),(0,m.createCommentVNode)(' 3. 说明行 '),(0,m.createElementVNode)('div',Vp,[(0,m.createElementVNode)('div',Ep,[(0,m.createElementVNode)('div',{class:'acu-help-header',onClick:p},[a[16]||(a[16]=(0,m.createElementVNode)('i',{class:'fas fa-lightbulb'},null,-1)),a[17]||(a[17]=(0,m.createElementVNode)('strong',null,'通配符说明',-1)),(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',l.value?'fa-chevron-up':'fa-chevron-down'])},null,2)]),(0,m.withDirectives)((0,m.createElementVNode)('ul',null,[...a[18]||(a[18]=[(0,m.createElementVNode)('li',null,[(0,m.createElementVNode)('code',null,(0,m.toDisplayString)('{{luck}}')),(0,m.createTextVNode)(' - 运势结果（如：大吉...） ')],-1),(0,m.createElementVNode)('li',null,[(0,m.createElementVNode)('code',null,(0,m.toDisplayString)('{{words}}')),(0,m.createTextVNode)(' - 随机词列表（如：苹果、香蕉） ')],-1),(0,m.createElementVNode)('li',null,[(0,m.createElementVNode)('code',null,(0,m.toDisplayString)('{{dimensions}}')),(0,m.createTextVNode)(' - 其他维度结果拼接 ')],-1)])],512),[[m.vShow,l.value]])])])])]),(0,m.createCommentVNode)(' 隐藏的文件输入 '),(0,m.createElementVNode)('input',{ref_key:'fileInputRef',ref:r,type:'file',accept:'.json',style:{display:'none'},onChange:N},null,544)]))}});u(8558);const Tp=(0,et.A)(Bp,[['__scopeId','data-v-2a4c34ca']]),Sp={class:'mystic-card-back'},Dp=['src'],Ap='https://i.postimg.cc/rmY9D1fL/wei-xin-tu-pian-20260121220508-79-297.jpg',zp=(0,m.defineComponent)({__name:'CardBack',props:{imageUrl:{default:''}},emits:['load'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.computed)(()=>a.imageUrl&&''!==a.imageUrl.trim()?a.imageUrl:Ap);function r(e){const t=e.target;if(t.naturalWidth&&t.naturalHeight){const e=t.naturalWidth/t.naturalHeight;o('load',e)}}function i(e){const t=e.target;t.src!==Ap&&(t.src=Ap)}return(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',Sp,[(0,m.createElementVNode)('img',{src:n.value,alt:'Mystic Tarot Card Back',class:'mystic-card-back__image',onLoad:r,onError:i},null,40,Dp),(0,m.createCommentVNode)(' 光泽遮罩 '),t[0]||(t[0]=(0,m.createElementVNode)('div',{class:'mystic-card-back__sheen'},null,-1))]))}}),Ip={class:'mystic-card-front'},_p={class:'mystic-card-front__content'},Mp={key:0,class:'mystic-card-front__loading'},Up={class:'mystic-card-front__title'},Pp={class:'mystic-card-front__luck-name'},$p={key:0,class:'mystic-card-front__dimensions'},Lp={key:1,class:'mystic-card-front__dimensions'},Fp={class:'mystic-card-front__message-box'},jp={key:0,class:'mystic-card-front__word-list'},Op=(0,m.defineComponent)({__name:'CardFront',props:{luckName:{},luckColor:{default:'#ffd700'},dimensions:{default:()=>[]},words:{},loading:{type:Boolean,default:!1},peepMode:{type:Boolean,default:!1}},setup(e){const t=e,a=(0,m.computed)(()=>t.peepMode?'???':t.luckName);function o(e){return e?e.split('').map(e=>/[\p{P}\s]/u.test(e)?e:Math.random()<.6?'...':e).join(''):''}const n=(0,m.computed)(()=>t.peepMode?t.words.map(o):t.words);return(t,o)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',Ip,[(0,m.createCommentVNode)(' 基础纹理/渐变 '),o[4]||(o[4]=(0,m.createElementVNode)('div',{class:'mystic-card-front__texture'},null,-1)),(0,m.createCommentVNode)(' 双层金边 '),o[5]||(o[5]=(0,m.createElementVNode)('div',{class:'mystic-card-front__border-outer'},null,-1)),o[6]||(o[6]=(0,m.createElementVNode)('div',{class:'mystic-card-front__border-inner'},null,-1)),(0,m.createCommentVNode)(' Art Nouveau 风格四角装饰 '),o[7]||(o[7]=(0,m.createElementVNode)('div',{class:'mystic-card-front__corner mystic-card-front__corner--tl'},null,-1)),o[8]||(o[8]=(0,m.createElementVNode)('div',{class:'mystic-card-front__corner mystic-card-front__corner--tr'},null,-1)),o[9]||(o[9]=(0,m.createElementVNode)('div',{class:'mystic-card-front__corner mystic-card-front__corner--bl'},null,-1)),o[10]||(o[10]=(0,m.createElementVNode)('div',{class:'mystic-card-front__corner mystic-card-front__corner--br'},null,-1)),(0,m.createCommentVNode)(' 中心光晕 '),o[11]||(o[11]=(0,m.createElementVNode)('div',{class:'mystic-card-front__glow'},null,-1)),(0,m.createCommentVNode)(' 内容区 '),(0,m.createElementVNode)('div',_p,[(0,m.createCommentVNode)(' 顶部星星装饰 '),o[2]||(o[2]=(0,m.createElementVNode)('div',{class:'mystic-card-front__top-icon'},[(0,m.createElementVNode)('svg',{width:'40',height:'40',viewBox:'0 0 24 24',fill:'currentColor'},[(0,m.createElementVNode)('path',{d:'M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z'})])],-1)),(0,m.createCommentVNode)(' 加载状态 '),e.loading?((0,m.openBlock)(),(0,m.createElementBlock)('div',Mp,[...o[0]||(o[0]=[(0,m.createElementVNode)('div',{class:'mystic-card-front__spinner'},null,-1),(0,m.createElementVNode)('p',{class:'mystic-card-front__loading-text'},'命运显现中...',-1)])])):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 内容 '),(0,m.createCommentVNode)(' 运势标题 '),(0,m.createElementVNode)('div',Up,[(0,m.createElementVNode)('h2',Pp,(0,m.toDisplayString)(a.value),1),o[1]||(o[1]=(0,m.createElementVNode)('div',{class:'mystic-card-front__divider'},null,-1))]),(0,m.createCommentVNode)(' 维度标签 '),!e.peepMode&&e.dimensions.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',$p,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.dimensions,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:t,class:'mystic-card-front__dimension-tag'},(0,m.toDisplayString)(e),1))),128))])):e.peepMode&&e.dimensions.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',Lp,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.dimensions,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:t,class:'mystic-card-front__dimension-tag'},' ??? '))),128))])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 主信息区 '),(0,m.createElementVNode)('div',Fp,[n.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',jp,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(n.value,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t,class:'mystic-card-front__word-item'},(0,m.toDisplayString)(e),1))),128))])):(0,m.createCommentVNode)('v-if',!0)])],64)),(0,m.createCommentVNode)(' 底部装饰 '),o[3]||(o[3]=(0,m.createElementVNode)('div',{class:'mystic-card-front__bottom-icon'},[(0,m.createElementVNode)('svg',{width:'24',height:'24',viewBox:'0 0 24 24',fill:'currentColor'},[(0,m.createElementVNode)('path',{d:'M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z'})])],-1))])]))}}),Rp={class:'card-back'},Hp=['src'],Wp='https://i.postimg.cc/j2MPbGv3/IMG-1590.jpg',Yp=(0,m.defineComponent)({__name:'CardBack',props:{imageUrl:{default:''}},emits:['load'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.computed)(()=>a.imageUrl&&''!==a.imageUrl.trim()?a.imageUrl:Wp);function r(e){const t=e.target;if(t.naturalWidth&&t.naturalHeight){const e=t.naturalWidth/t.naturalHeight;o('load',e)}}function i(e){const t=e.target;t.src!==Wp&&(t.src=Wp)}return(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',Rp,[(0,m.createElementVNode)('img',{src:n.value,alt:'Tarot Card Back',class:'card-back__image',onLoad:r,onError:i},null,40,Hp),t[0]||(t[0]=(0,m.createElementVNode)('div',{class:'card-back__overlay'},null,-1))]))}}),Xp={viewBox:'0 0 100 100',fill:'currentColor'},Gp=(0,m.defineComponent)({__name:'CornerOrnament',setup:e=>(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('svg',Xp,[...t[0]||(t[0]=[(0,m.createElementVNode)('path',{d:'M0,0 L40,0 C20,0 10,10 10,30 L10,0 Z',opacity:'0.5'},null,-1),(0,m.createElementVNode)('path',{d:'M5,5 L95,5 L95,20 C70,20 20,70 20,95 L5,95 Z'},null,-1),(0,m.createElementVNode)('circle',{cx:'15',cy:'15',r:'3',fill:'#8B5E3C'},null,-1)])]))}),qp={class:'card-front'},Kp={class:'card-front__content'},Jp={key:0,class:'card-front__dimensions'},Zp={key:1,class:'card-front__dimensions'},Qp={class:'card-front__keywords'},em={class:'card-front__keyword-text'},tm={wafuku:{id:'wafuku',name:'白塔罗',description:'传统日式御札风格，素雅淡黄纸质',defaultBackImage:'https://i.postimg.cc/j2MPbGv3/IMG-1590.jpg',CardFront:(0,m.defineComponent)({__name:'CardFront',props:{luckName:{},luckColor:{default:'#4A3728'},dimensions:{default:()=>[]},words:{},peepMode:{type:Boolean,default:!1}},setup(e){const t=e,a=(0,m.computed)(()=>t.peepMode?'???':t.luckName);function o(e){return e?e.split('').map(e=>/[\p{P}\s]/u.test(e)?e:Math.random()<.6?'...':e).join(''):''}const n=(0,m.computed)(()=>t.peepMode?t.words.map(o):t.words);return(t,o)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',qp,[(0,m.createCommentVNode)(' 纹理层 '),o[1]||(o[1]=(0,m.createElementVNode)('div',{class:'card-front__texture'},null,-1)),(0,m.createCommentVNode)(' 内边框 '),o[2]||(o[2]=(0,m.createElementVNode)('div',{class:'card-front__border-outer'},null,-1)),o[3]||(o[3]=(0,m.createElementVNode)('div',{class:'card-front__border-inner'},null,-1)),(0,m.createCommentVNode)(' 四角装饰 '),(0,m.createVNode)(Gp,{class:'card-front__corner card-front__corner--tl'}),(0,m.createVNode)(Gp,{class:'card-front__corner card-front__corner--tr'}),(0,m.createVNode)(Gp,{class:'card-front__corner card-front__corner--bl'}),(0,m.createVNode)(Gp,{class:'card-front__corner card-front__corner--br'}),(0,m.createCommentVNode)(' 内容区 '),(0,m.createElementVNode)('div',Kp,[(0,m.createCommentVNode)(' 顶部图标 '),o[0]||(o[0]=(0,m.createStaticVNode)('<div class="card-front__top-icon"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"></path><path d="M20 3v4"></path><path d="M22 5h-4"></path><path d="M4 17v2"></path><path d="M5 18H3"></path></svg></div>',1)),(0,m.createCommentVNode)(' 运势名称 '),(0,m.createElementVNode)('h2',{class:'card-front__luck-name',style:(0,m.normalizeStyle)({color:e.luckColor})},(0,m.toDisplayString)(a.value),5),(0,m.createCommentVNode)(' 维度展示区域 '),!e.peepMode&&e.dimensions.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',Jp,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.dimensions,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t,class:'card-front__dimension-item'},(0,m.toDisplayString)(e),1))),128))])):e.peepMode&&e.dimensions.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',Zp,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.dimensions,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t,class:'card-front__dimension-item'},'???'))),128))])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 关键词区域 '),(0,m.createElementVNode)('div',Qp,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(n.value,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t,class:'card-front__keyword'},[(0,m.createElementVNode)('span',em,(0,m.toDisplayString)(e),1)]))),128))])])]))}}),CardBack:Yp},mystic:{id:'mystic',name:'神秘塔罗',description:'西方塔罗风格，深蓝底金装饰',defaultBackImage:'https://i.postimg.cc/rmY9D1fL/wei-xin-tu-pian-20260121220508-79-297.jpg',CardFront:Op,CardBack:zp}};const am={class:'acu-settings-section'},om={class:'acu-settings-group'},nm={class:'acu-settings-group'},rm={class:'acu-settings-row'},im={class:'acu-settings-control'},lm=['value'],cm={class:'acu-settings-row'},sm={class:'acu-settings-control'},dm={class:'acu-settings-row'},um={class:'acu-settings-control'},pm={class:'acu-settings-row'},mm={class:'acu-settings-control'},fm={class:'acu-image-upload-container'},gm={class:'acu-settings-group'},vm={class:'acu-settings-row'},bm={class:'acu-settings-control'},hm={class:'acu-settings-row'},xm={class:'acu-settings-control'},wm={class:'acu-settings-row'},ym={class:'acu-settings-label'},km={class:'hint'},Cm={class:'acu-settings-control acu-mode-control'},Nm={key:0,class:'acu-range-wrapper'},Vm={class:'acu-range-value'},Em={key:0,class:'acu-settings-row'},Bm={class:'acu-settings-label'},Tm={class:'hint'},Sm={class:'acu-settings-control'},Dm={class:'acu-settings-control'},Am={key:1,style:{padding:'0 16px 16px 16px'}},zm=(0,m.defineComponent)({__name:'DivinationPanel',setup(e){const t=(0,m.inject)('settingsNavigation'),a=(0,Ot.E)(),{config:o}=(0,p.storeToRefs)(a),{show:n}=(0,O.d)(),r=(0,m.ref)(!1),i=()=>{r.value=!r.value},l=(0,m.computed)(()=>{const e=(0,v.tu)();if(!e)return[];const t=[];for(const a in e){const o=e[a];o.name&&(o.name.includes('Random')||o.name.includes('随机'))&&t.push({key:o.id||a,label:o.name})}return t}),c=(0,m.computed)({get(){const e=[];return l.value.forEach(t=>{const a=t.key;!1!==o.value.tableSyncConfig?.[a]&&e.push(a)}),e},set(e){o.value.tableSyncConfig||(o.value.tableSyncConfig={}),l.value.forEach(t=>{const a=t.key;e.includes(a)?void 0!==o.value.tableSyncConfig[a]&&delete o.value.tableSyncConfig[a]:o.value.tableSyncConfig[a]=!1})}}),s=(0,m.computed)(()=>Object.values(tm)),d=(0,m.computed)(()=>{switch(o.value.wordDrawMode){case'perItem':return'每项固定抽取，不受总数限制';case'custom':return'按 limit 控制，受总数限制';case'mixed':return'所有开启项混合抽取';default:return''}}),u=(0,m.ref)(null),f=()=>{u.value?.click()},g=async e=>{const t=e.target;if(t.files&&t.files[0])try{await a.uploadCardBack(t.files[0]),n('卡背图片上传成功','success')}catch(e){n('上传失败','error')}finally{t.value=''}};return(e,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',am,[a[27]||(a[27]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-star'}),(0,m.createTextVNode)(' 抽签系统设置 ')],-1)),(0,m.createCommentVNode)(' 基础设置 '),(0,m.createElementVNode)('div',om,[(0,m.createCommentVNode)(' 维度管理入口 '),(0,m.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:a[0]||(a[0]=e=>(0,m.unref)(t).navigateTo('divinationDimensions'))},[...a[13]||(a[13]=[(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 维度管理 '),(0,m.createElementVNode)('span',{class:'hint'},'配置运势、扭曲度等维度')],-1),(0,m.createElementVNode)('div',{class:'acu-settings-control'},[(0,m.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])])]),(0,m.createCommentVNode)(' 外观设置 '),a[28]||(a[28]=(0,m.createElementVNode)('div',{class:'acu-settings-title',style:{'margin-top':'16px'}},[(0,m.createElementVNode)('i',{class:'fas fa-palette'}),(0,m.createTextVNode)(' 外观与行为 ')],-1)),(0,m.createElementVNode)('div',nm,[(0,m.createCommentVNode)(' 卡面主题 '),(0,m.createElementVNode)('div',rm,[a[14]||(a[14]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 卡面主题 '),(0,m.createElementVNode)('span',{class:'hint'},'选择塔罗牌的视觉风格')],-1)),(0,m.createElementVNode)('div',im,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[1]||(a[1]=e=>(0,m.unref)(o).themeId=e),class:'acu-select'},[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(s.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('option',{key:e.id,value:e.id},(0,m.toDisplayString)(e.name),9,lm))),128))],512),[[m.vModelSelect,(0,m.unref)(o).themeId]])])]),(0,m.createCommentVNode)(' 翻牌模式 '),(0,m.createElementVNode)('div',cm,[a[16]||(a[16]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 翻牌模式 '),(0,m.createElementVNode)('span',{class:'hint'},'控制抽签时的动画表现')],-1)),(0,m.createElementVNode)('div',sm,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[2]||(a[2]=e=>(0,m.unref)(o).flipMode=e),class:'acu-select'},[...a[15]||(a[15]=[(0,m.createElementVNode)('option',{value:'auto'},'自动翻牌',-1),(0,m.createElementVNode)('option',{value:'manual'},'手动点击',-1),(0,m.createElementVNode)('option',{value:'skip'},'跳过动画',-1)])],512),[[m.vModelSelect,(0,m.unref)(o).flipMode]])])]),(0,m.createCommentVNode)(' 偷看模式 '),(0,m.createElementVNode)('div',dm,[a[17]||(a[17]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 偷看模式 '),(0,m.createElementVNode)('span',{class:'hint'},'模糊显示运势和内容')],-1)),(0,m.createElementVNode)('div',um,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:(0,m.unref)(o).peepMode}]),onClick:a[3]||(a[3]=e=>(0,m.unref)(o).peepMode=!(0,m.unref)(o).peepMode)},null,2)])]),(0,m.createCommentVNode)(' 卡背图片 '),(0,m.createElementVNode)('div',pm,[a[19]||(a[19]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 卡背图片 '),(0,m.createElementVNode)('span',{class:'hint'},'自定义塔罗牌背面图案')],-1)),(0,m.createElementVNode)('div',mm,[(0,m.createElementVNode)('div',fm,[(0,m.createCommentVNode)(' URL 输入 '),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[4]||(a[4]=e=>(0,m.unref)(o).cardBackImage=e),type:'text',class:'acu-settings-input',placeholder:'输入图片 URL'},null,512),[[m.vModelText,(0,m.unref)(o).cardBackImage]]),(0,m.createCommentVNode)(' 上传按钮 '),(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'上传图片',onClick:f},[...a[18]||(a[18]=[(0,m.createElementVNode)('i',{class:'fas fa-upload'},null,-1)])]),(0,m.createCommentVNode)(' 隐藏的文件输入 '),(0,m.createElementVNode)('input',{ref_key:'fileInput',ref:u,type:'file',accept:'image/*',class:'acu-hidden-input',onChange:g},null,544)])])])]),(0,m.createCommentVNode)(' 抽词设置 '),a[29]||(a[29]=(0,m.createElementVNode)('div',{class:'acu-settings-title',style:{'margin-top':'16px'}},[(0,m.createElementVNode)('i',{class:'fas fa-font'}),(0,m.createTextVNode)(' 抽词设置 ')],-1)),(0,m.createElementVNode)('div',gm,[(0,m.createCommentVNode)(' 表格随机词 '),(0,m.createElementVNode)('div',vm,[a[20]||(a[20]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 表格随机词 '),(0,m.createElementVNode)('span',{class:'hint'},'从含"随机"的表格抽词')],-1)),(0,m.createElementVNode)('div',bm,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:(0,m.unref)(o).enableTableWords}]),onClick:a[5]||(a[5]=e=>(0,m.unref)(o).enableTableWords=!(0,m.unref)(o).enableTableWords)},null,2)])]),(0,m.createCommentVNode)(' 世界书词库 '),(0,m.createElementVNode)('div',hm,[a[21]||(a[21]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 世界书词库 '),(0,m.createElementVNode)('span',{class:'hint'},'从同步的世界书抽词')],-1)),(0,m.createElementVNode)('div',xm,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:(0,m.unref)(o).enableWordPool}]),onClick:a[6]||(a[6]=e=>(0,m.unref)(o).enableWordPool=!(0,m.unref)(o).enableWordPool)},null,2)])]),(0,m.createCommentVNode)(' 抽词模式（任一开启时显示） '),(0,m.unref)(o).enableTableWords||(0,m.unref)(o).enableWordPool?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[(0,m.createElementVNode)('div',wm,[(0,m.createElementVNode)('div',ym,[a[22]||(a[22]=(0,m.createTextVNode)(' 抽词模式 ',-1)),(0,m.createElementVNode)('span',km,(0,m.toDisplayString)(d.value),1)]),(0,m.createElementVNode)('div',Cm,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[7]||(a[7]=e=>(0,m.unref)(o).wordDrawMode=e),class:'acu-select'},[...a[23]||(a[23]=[(0,m.createElementVNode)('option',{value:'perItem'},'每项抽 x 个',-1),(0,m.createElementVNode)('option',{value:'custom'},'自定义',-1),(0,m.createElementVNode)('option',{value:'mixed'},'混抽',-1)])],512),[[m.vModelSelect,(0,m.unref)(o).wordDrawMode]]),(0,m.createCommentVNode)(' perItem 模式：拖动条在同一行 '),'perItem'===(0,m.unref)(o).wordDrawMode?((0,m.openBlock)(),(0,m.createElementBlock)('div',Nm,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[8]||(a[8]=e=>(0,m.unref)(o).wordsPerItem=e),type:'range',min:'1',max:'10',step:'1',class:'acu-inline-range'},null,512),[[m.vModelText,(0,m.unref)(o).wordsPerItem,void 0,{number:!0}]]),(0,m.createElementVNode)('span',Vm,(0,m.toDisplayString)((0,m.unref)(o).wordsPerItem),1)])):(0,m.createCommentVNode)('v-if',!0)])]),(0,m.createCommentVNode)(' custom/mixed 模式：抽词总数（单独一行拖动条 1-20） '),'perItem'!==(0,m.unref)(o).wordDrawMode?((0,m.openBlock)(),(0,m.createElementBlock)('div',Em,[(0,m.createElementVNode)('div',Bm,[a[24]||(a[24]=(0,m.createTextVNode)(' 抽词总数 ',-1)),(0,m.createElementVNode)('span',Tm,'最多抽取 '+(0,m.toDisplayString)((0,m.unref)(o).drawCount)+' 个词',1)]),(0,m.createElementVNode)('div',Sm,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[9]||(a[9]=e=>(0,m.unref)(o).drawCount=e),type:'range',min:'1',max:'20',step:'1'},null,512),[[m.vModelText,(0,m.unref)(o).drawCount,void 0,{number:!0}]])])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 自动同步 '),(0,m.createElementVNode)('div',{class:'acu-settings-row',onClick:i},[a[25]||(a[25]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 自动同步 '),(0,m.createElementVNode)('span',{class:'hint'},'表格变动时自动更新世界书')],-1)),(0,m.createElementVNode)('div',Dm,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:(0,m.unref)(o).autoSync}]),onClick:a[10]||(a[10]=(0,m.withModifiers)(e=>(0,m.unref)(o).autoSync=!(0,m.unref)(o).autoSync,['stop']))},null,2),(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',r.value?'fa-chevron-up':'fa-chevron-down']),style:{'margin-left':'8px','font-size':'12px',color:'var(--acu-text-sub)'}},null,2)])]),(0,m.createCommentVNode)(' 同步表格列表 (可折叠) '),r.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Am,[(0,m.createVNode)(Gr,{modelValue:c.value,'onUpdate:modelValue':a[11]||(a[11]=e=>c.value=e),items:l.value,'empty-text':'没有找到包含\'随机\'的表格','footer-template':'已启用同步: {selected}/{total} 个表格','empty-hint':'(将自动扫描新表格)'},null,8,['modelValue','items'])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 词库管理入口 '),(0,m.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:a[12]||(a[12]=e=>(0,m.unref)(t).navigateTo('divinationWordPool'))},[...a[26]||(a[26]=[(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 词库管理 '),(0,m.createElementVNode)('span',{class:'hint'},'配置每项的 limit 和开关')],-1),(0,m.createElementVNode)('div',{class:'acu-settings-control'},[(0,m.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])])],64)):(0,m.createCommentVNode)('v-if',!0)])]))}}),Im={class:'acu-settings-section'},_m={class:'acu-settings-group'},Mm={class:'acu-settings-row'},Um={class:'acu-settings-control',style:{width:'100%',display:'flex'}},Pm={key:0,class:'acu-empty-hint',style:{padding:'20px','text-align':'center'}},$m={key:1,class:'acu-settings-group'},Lm={class:'acu-settings-row'},Fm={class:'acu-settings-label'},jm={style:{display:'flex','align-items':'center',gap:'8px'}},Om={key:0,class:'acu-badge acu-badge-success'},Rm={key:1,class:'acu-badge acu-badge-danger'},Hm={key:2,class:'acu-badge acu-badge-secondary'},Wm={class:'hint'},Ym={class:'acu-settings-control'},Xm=['onClick'],Gm=['onClick'],qm={key:0,style:{padding:'0 16px 16px'}},Km=['onUpdate:modelValue','onInput'],Jm={style:{display:'flex','justify-content':'space-between','margin-top':'8px','font-size':'12px',color:'var(--acu-text-sub)'}},Zm=(0,m.defineComponent)({__name:'WordPoolPanel',setup(e){const t=(0,Ot.E)(),a=(0,m.ref)(''),o=(0,m.ref)(null),n=(0,m.ref)({}),r=(0,m.ref)({}),i=(0,m.computed)(()=>{const e=a.value.toLowerCase().trim();return e?t.categories.filter(t=>t.name.toLowerCase().includes(e)||t.words.some(t=>t.toLowerCase().includes(e))):t.categories}),l=(0,re.Q0)(e=>{(async e=>{const a=n.value[e],o=t.categories.find(t=>t.id===e);if(o&&void 0!==a){r.value[e]=!0;try{const e=a.split(/[,，、\n]/).map(e=>e.trim()).filter(e=>e),n={...o,words:e};await t.updateCategory(n)}finally{setTimeout(()=>{r.value[e]=!1},500)}}})(e)},1e3);return(e,c)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',Im,[c[1]||(c[1]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-book'}),(0,m.createTextVNode)(' 随机词库管理 ')],-1)),(0,m.createCommentVNode)(' 搜索/过滤 '),(0,m.createElementVNode)('div',_m,[(0,m.createElementVNode)('div',Mm,[(0,m.createElementVNode)('div',Um,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':c[0]||(c[0]=e=>a.value=e),type:'text',class:'acu-word-pool-search',placeholder:'搜索词库名称...',style:{flex:'1',width:'100%'}},null,512),[[m.vModelText,a.value]])])])]),(0,m.createCommentVNode)(' 词库列表 '),0===i.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',Pm,' 暂无词库数据 ')):((0,m.openBlock)(),(0,m.createElementBlock)('div',$m,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(i.value,e=>{return(0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:'acu-word-pool-item',style:{'border-bottom':'1px solid var(--acu-border)',padding:'12px 0'}},[(0,m.createCommentVNode)(' 头部：名称与开关 '),(0,m.createElementVNode)('div',Lm,[(0,m.createElementVNode)('div',Fm,[(0,m.createElementVNode)('div',jm,[(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(e.name),1),(0,m.createCommentVNode)(' 倾向徽章 '),'positive'===e.bias?((0,m.openBlock)(),(0,m.createElementBlock)('span',Om,'吉')):'negative'===e.bias?((0,m.openBlock)(),(0,m.createElementBlock)('span',Rm,'凶')):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 强制抽取数量 '),e.limit>0?((0,m.openBlock)(),(0,m.createElementBlock)('span',Hm,' 强抽: '+(0,m.toDisplayString)(e.limit),1)):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createElementVNode)('span',Wm,(0,m.toDisplayString)(e.words.length)+' 个词条',1)]),(0,m.createElementVNode)('div',Ym,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:e.enabled}]),onClick:a=>(e=>{const a={...e,enabled:!e.enabled};t.updateCategory(a)})(e)},null,10,Xm),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-icon-btn',{active:o.value===e.id}]),style:{'margin-left':'8px'},onClick:a=>(e=>{if(o.value===e)o.value=null;else{o.value=e;const a=t.categories.find(t=>t.id===e);a&&(n.value[e]=a.words.join('\n'))}})(e.id)},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',o.value===e.id?'fa-chevron-up':'fa-chevron-down'])},null,2)],10,Gm)])]),(0,m.createCommentVNode)(' 展开内容：编辑区域 '),o.value===e.id?((0,m.openBlock)(),(0,m.createElementBlock)('div',qm,[(0,m.withDirectives)((0,m.createElementVNode)('textarea',{'onUpdate:modelValue':t=>n.value[e.id]=t,class:'acu-textarea-scrollable',rows:'5',placeholder:'输入词条，用逗号或换行分隔',onInput:t=>{return a=e.id,void l(a);var a}},null,40,Km),[[m.vModelText,n.value[e.id]]]),(0,m.createElementVNode)('div',Jm,[(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(r.value[e.id]?'保存中...':'自动保存'),1),(0,m.createElementVNode)('span',null,'当前词数: '+(0,m.toDisplayString)((a=n.value[e.id],a?a.split(/[,，、\n]/).map(e=>e.trim()).filter(e=>e).length:0)),1)])])):(0,m.createCommentVNode)('v-if',!0)]);var a}),128))]))]))}});u(652);const Qm=(0,et.A)(Zm,[['__scopeId','data-v-244ae7d6']]),ef={class:'acu-modal-header'},tf={class:'acu-modal-title'},af={class:'acu-modal-body'},of={class:'acu-settings-section'},nf={class:'acu-settings-group'},rf={class:'acu-settings-row'},lf={class:'acu-settings-control acu-font-control'},cf=['value'],sf={class:'acu-settings-row'},df={class:'acu-settings-control'},uf={class:'acu-settings-row'},pf={class:'acu-settings-label'},mf={class:'hint'},ff={class:'acu-settings-control'},gf={class:'acu-settings-row'},vf={class:'acu-settings-label'},bf={class:'hint'},hf={class:'acu-settings-control'},xf={class:'acu-settings-row'},wf={class:'acu-settings-label'},yf={class:'hint'},kf={class:'acu-settings-control'},Cf={class:'acu-settings-row'},Nf={class:'acu-settings-label'},Vf={class:'hint'},Ef={class:'acu-settings-control'},Bf={class:'acu-settings-section'},Tf={class:'acu-settings-group'},Sf={class:'acu-settings-section'},Df={class:'acu-settings-group'},Af={class:'acu-settings-row'},zf={class:'acu-settings-control'},If={class:'acu-settings-row'},_f={class:'acu-settings-control'},Mf={class:'acu-settings-row'},Uf={class:'acu-settings-control'},Pf={class:'acu-settings-row'},$f={class:'acu-settings-control'},Lf={key:0,class:'acu-settings-row'},Ff={class:'acu-settings-control'},jf={key:1,class:'acu-settings-row'},Of={class:'acu-settings-label'},Rf={class:'hint'},Hf={class:'acu-settings-control'},Wf={class:'acu-settings-row'},Yf={class:'acu-settings-control'},Xf={class:'acu-settings-row'},Gf={class:'acu-settings-control'},qf={class:'acu-mini-dialog-header'},Kf={class:'acu-mini-dialog-body'},Jf={class:'acu-font-form'},Zf={class:'acu-form-row'},Qf={class:'acu-form-row'},eg={class:'acu-mini-dialog-footer'},tg=['disabled'],ag={class:'acu-bottom-spacer'},og=(0,m.defineComponent)({__name:'SettingsDialog',props:{visible:{type:Boolean}},emits:['update:visible'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.ref)(),r=(0,f.JH)(),i=(0,f.MP)(),l=(0,O.d)(),c=(0,k.j_)(),s=((0,Me.t)(),(0,m.ref)(!1)),d=(0,m.ref)(''),u=(0,m.ref)(''),p=(0,m.ref)('main'),v=(0,m.ref)([]),b=(0,m.ref)({}),h=(0,m.reactive)({...r.config});(0,m.watch)(h,e=>{r.updateConfig(e)},{deep:!0});const x=(0,m.computed)(()=>{if(b.value[p.value])return b.value[p.value];switch(p.value){case'tabConfig':return'表格展示选择';case'buttonConfig':return'导航栏按钮配置';case'ballAppearance':return'悬浮球外观';case'themeConfig':return'主题美化与高亮配置';case'divination':return'抽签系统配置';case'divinationDimensions':return'维度管理';case'divinationWordPool':return'随机词库管理';default:return'设置'}}),w=(e,t)=>{t&&(b.value[e]=t),v.value.push(p.value),p.value=e},y=()=>{const e=v.value.pop();p.value=e||'main'},C=()=>{v.value=[],p.value='main',b.value={}},N=e=>{w(e)};(0,m.provide)('settingsNavigation',{navigateTo:w,goBack:y});(0,m.watch)(()=>a.visible,e=>{e&&(Object.assign(h,r.config),c.initialSettingsPanel?(C(),w(c.initialSettingsPanel),c.initialSettingsPanel=null):C())}),(0,Be.X2F)(n,()=>{E()});const V=()=>{if('ballAppearance'===p.value){const e=(0,g.C)();e.activePresetId&&e.activePreset&&(e.saveCurrentToPreset(e.activePreset.name),l.success('已保存至当前主题预设'))}o('update:visible',!1)},E=()=>{o('update:visible',!1)},B=(0,m.computed)(()=>i.allFonts),T=(0,m.computed)(()=>d.value.trim()&&u.value.trim()),S=()=>{if(!T.value)return;const e=d.value.trim(),t=`'${e}', sans-serif`;i.addFont({name:e,fontFamily:t,importUrl:u.value.trim()}),d.value='',u.value='',s.value=!1};return(t,a)=>((0,m.openBlock)(),(0,m.createBlock)(m.Transition,{name:'modal'},{default:(0,m.withCtx)(()=>[e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container',onClick:(0,m.withModifiers)(E,['self'])},[(0,m.createElementVNode)('div',{ref_key:'dialogRef',ref:n,class:'acu-modal acu-settings-modal'},[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',ef,[(0,m.createCommentVNode)(' 返回按钮（仅在子面板时显示） '),v.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-modal-back',onClick:(0,m.withModifiers)(y,['stop'])},[...a[26]||(a[26]=[(0,m.createElementVNode)('i',{class:'fas fa-arrow-left'},null,-1)])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createElementVNode)('span',tf,(0,m.toDisplayString)(x.value),1),(0,m.createCommentVNode)(' 胶囊式完成按钮 '),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(V,['stop'])},(0,m.toDisplayString)('ballAppearance'===p.value?'保存':'完成'),1)]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',af,[(0,m.createCommentVNode)(' ============ 主设置面板 ============ '),'main'===p.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[(0,m.createCommentVNode)(' 外观与布局（合并）'),(0,m.createElementVNode)('div',of,[a[35]||(a[35]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-palette'}),(0,m.createTextVNode)(' 外观与布局 ')],-1)),(0,m.createElementVNode)('div',nf,[(0,m.createCommentVNode)(' 字体选择 '),(0,m.createElementVNode)('div',rf,[a[28]||(a[28]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 显示字体 '),(0,m.createElementVNode)('span',{class:'hint'},'选择界面字体')],-1)),(0,m.createElementVNode)('div',lf,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[0]||(a[0]=e=>h.fontFamily=e)},[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(B.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('option',{key:e.id,value:e.id},(0,m.toDisplayString)(e.name),9,cf))),128))],512),[[m.vModelSelect,h.fontFamily]]),(0,m.createElementVNode)('button',{class:'acu-add-font-btn',title:'添加自定义字体',onClick:a[1]||(a[1]=(0,m.withModifiers)(e=>s.value=!0,['stop']))},[...a[27]||(a[27]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])])])]),(0,m.createCommentVNode)(' 布局模式 '),(0,m.createElementVNode)('div',sf,[a[30]||(a[30]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 布局模式 '),(0,m.createElementVNode)('span',{class:'hint'},'卡片排列方向')],-1)),(0,m.createElementVNode)('div',df,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[2]||(a[2]=e=>h.layout=e)},[...a[29]||(a[29]=[(0,m.createElementVNode)('option',{value:'vertical'},'纵向布局',-1),(0,m.createElementVNode)('option',{value:'horizontal'},'横向布局',-1)])],512),[[m.vModelSelect,h.layout]])])]),(0,m.createCommentVNode)(' 字体大小 '),(0,m.createElementVNode)('div',uf,[(0,m.createElementVNode)('div',pf,[a[31]||(a[31]=(0,m.createTextVNode)(' 字体大小 ',-1)),(0,m.createElementVNode)('span',mf,(0,m.toDisplayString)(h.fontSize)+'px',1)]),(0,m.createElementVNode)('div',ff,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[3]||(a[3]=e=>h.fontSize=e),type:'range',min:'12',max:'18',step:'1'},null,512),[[m.vModelText,h.fontSize,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 卡片宽度 '),(0,m.createElementVNode)('div',gf,[(0,m.createElementVNode)('div',vf,[a[32]||(a[32]=(0,m.createTextVNode)(' 卡片宽度 ',-1)),(0,m.createElementVNode)('span',bf,(0,m.toDisplayString)(h.cardWidth)+'px',1)]),(0,m.createElementVNode)('div',hf,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[4]||(a[4]=e=>h.cardWidth=e),type:'range',min:'200',max:'400',step:'10'},null,512),[[m.vModelText,h.cardWidth,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 表格按钮列数 '),(0,m.createElementVNode)('div',xf,[(0,m.createElementVNode)('div',wf,[a[33]||(a[33]=(0,m.createTextVNode)(' 表格按钮列数 ',-1)),(0,m.createElementVNode)('span',yf,(0,m.toDisplayString)(0===h.gridColumns?'自适应':`${h.gridColumns} 列`),1)]),(0,m.createElementVNode)('div',kf,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[5]||(a[5]=e=>h.gridColumns=e),type:'range',min:'0',max:'6',step:'1'},null,512),[[m.vModelText,h.gridColumns,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 每页显示数 '),(0,m.createElementVNode)('div',Cf,[(0,m.createElementVNode)('div',Nf,[a[34]||(a[34]=(0,m.createTextVNode)(' 每页显示条数 ',-1)),(0,m.createElementVNode)('span',Vf,(0,m.toDisplayString)(h.itemsPerPage)+' 条',1)]),(0,m.createElementVNode)('div',Ef,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[6]||(a[6]=e=>h.itemsPerPage=e),type:'range',min:'10',max:'100',step:'10'},null,512),[[m.vModelText,h.itemsPerPage,void 0,{number:!0}]])])])])]),(0,m.createCommentVNode)(' 界面配置入口（使用圆角容器）'),(0,m.createElementVNode)('div',Bf,[a[41]||(a[41]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-columns'}),(0,m.createTextVNode)(' 界面配置 ')],-1)),(0,m.createElementVNode)('div',Tf,[(0,m.createCommentVNode)(' 主题美化与高亮配置入口 '),(0,m.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:a[7]||(a[7]=e=>N('themeConfig'))},[...a[36]||(a[36]=[(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 主题美化与高亮配置 '),(0,m.createElementVNode)('span',{class:'hint'},'自定义主题变量、高亮颜色、CSS')],-1),(0,m.createElementVNode)('div',{class:'acu-settings-control'},[(0,m.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])]),(0,m.createCommentVNode)(' 悬浮球外观配置入口 '),(0,m.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:a[8]||(a[8]=e=>N('ballAppearance'))},[...a[37]||(a[37]=[(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 悬浮球外观 '),(0,m.createElementVNode)('span',{class:'hint'},'自定义悬浮球样式和AI填表通知动画')],-1),(0,m.createElementVNode)('div',{class:'acu-settings-control'},[(0,m.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])]),(0,m.createCommentVNode)(' 表格展示选择入口 '),(0,m.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:a[9]||(a[9]=e=>N('tabConfig'))},[...a[38]||(a[38]=[(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 表格自定义配置 '),(0,m.createElementVNode)('span',{class:'hint'},'选择要显示的表格及排序')],-1),(0,m.createElementVNode)('div',{class:'acu-settings-control'},[(0,m.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])]),(0,m.createCommentVNode)(' 导航栏按钮配置入口 '),(0,m.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:a[10]||(a[10]=e=>N('buttonConfig'))},[...a[39]||(a[39]=[(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 导航栏按钮自定义配置 '),(0,m.createElementVNode)('span',{class:'hint'},'自定义导航栏显示的按钮')],-1),(0,m.createElementVNode)('div',{class:'acu-settings-control'},[(0,m.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])]),(0,m.createCommentVNode)(' 抽签系统配置入口 '),(0,m.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:a[11]||(a[11]=e=>N('divination'))},[...a[40]||(a[40]=[(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 抽签系统配置 '),(0,m.createElementVNode)('span',{class:'hint'},'配置运势、维度和随机词库')],-1),(0,m.createElementVNode)('div',{class:'acu-settings-control'},[(0,m.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])])])]),(0,m.createCommentVNode)(' 行为设置 '),(0,m.createElementVNode)('div',Sf,[a[50]||(a[50]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-sliders-h'}),(0,m.createTextVNode)(' 行为 ')],-1)),(0,m.createElementVNode)('div',Df,[(0,m.createCommentVNode)(' 显示分页 (移除了仪表盘开关) '),(0,m.createElementVNode)('div',Af,[a[42]||(a[42]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 显示分页器 '),(0,m.createElementVNode)('span',{class:'hint'},'表格底部分页控件')],-1)),(0,m.createElementVNode)('div',zf,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:h.showPagination}]),onClick:a[12]||(a[12]=e=>h.showPagination=!h.showPagination)},null,2)])]),(0,m.createCommentVNode)(' 限制长文本 '),(0,m.createElementVNode)('div',If,[a[43]||(a[43]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 限制长文本 '),(0,m.createElementVNode)('span',{class:'hint'},'超长内容自动截断')],-1)),(0,m.createElementVNode)('div',_f,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:h.limitLongText}]),onClick:a[13]||(a[13]=e=>h.limitLongText=!h.limitLongText)},null,2)])]),(0,m.createCommentVNode)(' 锁定面板位置 '),(0,m.createElementVNode)('div',Mf,[a[44]||(a[44]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 锁定面板位置 '),(0,m.createElementVNode)('span',{class:'hint'},'禁止拖动面板')],-1)),(0,m.createElementVNode)('div',Uf,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:h.lockPanel}]),onClick:a[14]||(a[14]=e=>h.lockPanel=!h.lockPanel)},null,2)])]),(0,m.createCommentVNode)(' 收纳Tab栏 '),(0,m.createElementVNode)('div',Pf,[a[45]||(a[45]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 收纳Tab栏 '),(0,m.createElementVNode)('span',{class:'hint'},'将Tab栏收纳到导航按钮中')],-1)),(0,m.createElementVNode)('div',$f,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:h.collapseTabBar}]),onClick:a[15]||(a[15]=e=>h.collapseTabBar=!h.collapseTabBar)},null,2)])]),(0,m.createCommentVNode)(' 显示收纳Tab按钮 (仅在收纳Tab栏开启时显示) '),h.collapseTabBar?((0,m.openBlock)(),(0,m.createElementBlock)('div',Lf,[a[46]||(a[46]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 显示收纳Tab按钮 '),(0,m.createElementVNode)('span',{class:'hint'},'在导航栏显示打开Tab浮窗的按钮')],-1)),(0,m.createElementVNode)('div',Ff,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:!1!==h.showCollapseTabButton}]),onClick:a[16]||(a[16]=e=>h.showCollapseTabButton=!1===h.showCollapseTabButton)},null,2)])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 移动端底部安全区（仅移动端显示） '),(0,m.unref)(c).isMobile?((0,m.openBlock)(),(0,m.createElementBlock)('div',jf,[(0,m.createElementVNode)('div',Of,[a[47]||(a[47]=(0,m.createTextVNode)(' 移动端底部安全区 ',-1)),(0,m.createElementVNode)('span',Rf,(0,m.toDisplayString)(h.mobileSafeAreaBottom??50)+'px',1)]),(0,m.createElementVNode)('div',Hf,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[17]||(a[17]=e=>h.mobileSafeAreaBottom=e),type:'range',min:'0',max:'150',step:'10'},null,512),[[m.vModelText,h.mobileSafeAreaBottom,void 0,{number:!0}]])])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' Swipe 时清除表格 '),(0,m.createElementVNode)('div',Wf,[a[48]||(a[48]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' Swipe 清除表格 '),(0,m.createElementVNode)('span',{class:'hint'},'重 roll 时若最后一楼有表格数据则自动清除')],-1)),(0,m.createElementVNode)('div',Yf,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:h.clearTableOnSwipe}]),onClick:a[18]||(a[18]=e=>h.clearTableOnSwipe=!h.clearTableOnSwipe)},null,2)])]),(0,m.createCommentVNode)(' iOS 输入防缩放 '),(0,m.createElementVNode)('div',Xf,[a[49]||(a[49]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' iOS 输入防缩放 '),(0,m.createElementVNode)('span',{class:'hint'},'开启后输入框字体变大，防止 iOS 自动放大页面')],-1)),(0,m.createElementVNode)('div',Gf,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:h.enableIOSInputFix}]),onClick:a[19]||(a[19]=e=>h.enableIOSInputFix=!h.enableIOSInputFix)},null,2)])])])])],64)):'tabConfig'===p.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' ============ Tab 配置面板 ============ '),(0,m.createVNode)(Cd)],2112)):'buttonConfig'===p.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:2},[(0,m.createCommentVNode)(' ============ 导航栏按钮配置面板 ============ '),(0,m.createVNode)(dd)],2112)):'ballAppearance'===p.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:3},[(0,m.createCommentVNode)(' ============ 悬浮球外观配置面板 ============ '),(0,m.createVNode)(Rs)],2112)):'themeConfig'===p.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:4},[(0,m.createCommentVNode)(' ============ 主题美化与高亮配置面板 ============ '),(0,m.createVNode)(Qu)],2112)):'divination'===p.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:5},[(0,m.createCommentVNode)(' ============ 抽签系统配置面板 ============ '),(0,m.createVNode)(zm)],2112)):'divinationDimensions'===p.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:6},[(0,m.createCommentVNode)(' ============ 维度管理面板 ============ '),(0,m.createVNode)(Tp)],2112)):'divinationWordPool'===p.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:7},[(0,m.createCommentVNode)(' ============ 词库管理面板 ============ '),(0,m.createVNode)(Qm)],2112)):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' ============ 添加自定义字体弹窗（直接渲染，不使用 Teleport） ============ '),(0,m.createVNode)(m.Transition,{name:'modal'},{default:(0,m.withCtx)(()=>[s.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-font-dialog-overlay',onClick:a[25]||(a[25]=(0,m.withModifiers)(e=>s.value=!1,['self']))},[(0,m.createElementVNode)('div',{class:'acu-mini-dialog acu-add-font-dialog',onClick:a[24]||(a[24]=(0,m.withModifiers)(()=>{},['stop']))},[(0,m.createElementVNode)('div',qf,[a[52]||(a[52]=(0,m.createElementVNode)('span',null,'添加自定义字体',-1)),(0,m.createElementVNode)('button',{class:'acu-icon-btn',onClick:a[20]||(a[20]=(0,m.withModifiers)(e=>s.value=!1,['stop']))},[...a[51]||(a[51]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])]),(0,m.createElementVNode)('div',Kf,[(0,m.createElementVNode)('div',Jf,[(0,m.createElementVNode)('div',Zf,[a[53]||(a[53]=(0,m.createElementVNode)('label',null,'字体名称',-1)),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[21]||(a[21]=e=>d.value=e),type:'text',placeholder:'例如：霞鹜文楷'},null,512),[[m.vModelText,d.value]])]),(0,m.createElementVNode)('div',Qf,[a[54]||(a[54]=(0,m.createElementVNode)('label',null,'字体链接',-1)),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[22]||(a[22]=e=>u.value=e),type:'text',placeholder:'@import URL 或 CDN 链接'},null,512),[[m.vModelText,u.value]])])])]),(0,m.createElementVNode)('div',eg,[(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:a[23]||(a[23]=(0,m.withModifiers)(e=>s.value=!1,['stop']))},'取消'),(0,m.createElementVNode)('button',{class:'acu-modal-btn primary',disabled:!T.value,onClick:(0,m.withModifiers)(S,['stop'])},'添加',8,tg)])])])):(0,m.createCommentVNode)('v-if',!0)]),_:1}),(0,m.createCommentVNode)(' 底部留白适配移动端安全区 '),(0,m.createElementVNode)('div',ag,'—— ACU Visualizer v'+(0,m.toDisplayString)((0,m.unref)(Jc))+' ——',1)],512)])):(0,m.createCommentVNode)('v-if',!0)]),_:1}))}});u(639);const ng=(0,et.A)(og,[['__scopeId','data-v-e0ed2948']]),rg={class:'acu-modal acu-crop-dialog'},ig={class:'acu-modal-header'},lg={class:'acu-modal-title'},cg={class:'acu-modal-body acu-crop-body'},sg={class:'acu-crop-preview-wrapper'},dg={key:0,class:'acu-crop-placeholder'},ug={class:'acu-crop-controls'},pg={class:'acu-crop-control-row'},mg=['value'],fg={class:'acu-crop-value'},gg={class:'acu-crop-control-row'},vg=['value'],bg={class:'acu-crop-value'},hg={class:'acu-crop-control-row'},xg=['value'],wg={class:'acu-crop-value'},yg={key:0,class:'acu-crop-invert-section'},kg={class:'acu-settings-row'},Cg={class:'acu-settings-control'},Ng={class:'acu-switch'},Vg={class:'acu-crop-upload-section'},Eg={class:'acu-modal-footer'},Bg=(0,m.defineComponent)({__name:'AvatarCropDialog',props:{visible:{type:Boolean,default:!1},imageUrl:{default:''},name:{default:''},initialOffsetX:{default:50},initialOffsetY:{default:50},initialScale:{default:150},initialInvert:{type:Boolean,default:!1},showInvertOption:{type:Boolean,default:!1}},emits:['close','apply','upload'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.ref)(a.initialOffsetX),r=(0,m.ref)(a.initialOffsetY),i=(0,m.ref)(a.initialScale),l=(0,m.ref)(a.initialInvert),c=(0,m.ref)(null),s=(0,m.ref)(null),d=(0,m.ref)(!1),u=(0,m.ref)(0),p=(0,m.ref)(0),f=(0,m.ref)(0),g=(0,m.ref)(0),v=(0,m.computed)(()=>{if(!a.imageUrl)return{};const e={backgroundImage:`url('${a.imageUrl}')`,backgroundPosition:`${n.value}% ${r.value}%`,backgroundSize:`${i.value}%`};return l.value&&a.showInvertOption&&(e.filter='invert(1)'),e});function b(){o('close')}function h(){o('apply',{offsetX:n.value,offsetY:r.value,scale:i.value,invert:a.showInvertOption?l.value:void 0})}function x(){n.value=50,r.value=50,i.value=150,l.value=!1}function w(){c.value?.click()}function y(e){const t=e.target,a=t.files?.[0];a&&o('upload',a),t.value=''}function k(e){if(!a.imageUrl)return;d.value=!0,u.value=e.clientX,p.value=e.clientY,f.value=n.value,g.value=r.value;const t=window.parent?.document||document;t.addEventListener('mousemove',N),t.addEventListener('mouseup',B)}function C(e){if(!a.imageUrl||1!==e.touches.length)return;const t=e.touches[0];d.value=!0,u.value=t.clientX,p.value=t.clientY,f.value=n.value,g.value=r.value;const o=window.parent?.document||document;o.addEventListener('touchmove',V,{passive:!1}),o.addEventListener('touchend',T)}function N(e){if(!d.value)return;E(e.clientX-u.value,e.clientY-p.value)}function V(e){if(!d.value||1!==e.touches.length)return;e.preventDefault();const t=e.touches[0];E(t.clientX-u.value,t.clientY-p.value)}function E(e,t){const a=f.value-e/120*100*.8,o=g.value-t/120*100*.8;n.value=Math.max(0,Math.min(100,Math.round(a))),r.value=Math.max(0,Math.min(100,Math.round(o)))}function B(){d.value=!1;const e=window.parent?.document||document;e.removeEventListener('mousemove',N),e.removeEventListener('mouseup',B)}function T(){d.value=!1;const e=window.parent?.document||document;e.removeEventListener('touchmove',V),e.removeEventListener('touchend',T)}return(0,m.watch)(()=>a.visible,e=>{e&&(n.value=a.initialOffsetX,r.value=a.initialOffsetY,i.value=a.initialScale,l.value=a.initialInvert)}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-crop-modal-overlay',onClick:(0,m.withModifiers)(b,['self'])},[(0,m.createElementVNode)('div',rg,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',ig,[(0,m.createElementVNode)('span',lg,[a[4]||(a[4]=(0,m.createElementVNode)('i',{class:'fas fa-crop-simple'},null,-1)),(0,m.createTextVNode)(' 调整头像 - '+(0,m.toDisplayString)(e.name),1)]),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(b,['stop'])},[...a[5]||(a[5]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])]),(0,m.createCommentVNode)(' 内容区 '),(0,m.createElementVNode)('div',cg,[(0,m.createCommentVNode)(' 预览区 - 支持拖动 '),(0,m.createElementVNode)('div',sg,[(0,m.createElementVNode)('div',{ref_key:'previewRef',ref:s,class:(0,m.normalizeClass)(['acu-crop-preview',{'is-dragging':d.value}]),style:(0,m.normalizeStyle)(v.value),onMousedown:k,onTouchstart:(0,m.withModifiers)(C,['prevent'])},[(0,m.createCommentVNode)(' 无图片时显示占位 '),e.imageUrl?(0,m.createCommentVNode)('v-if',!0):((0,m.openBlock)(),(0,m.createElementBlock)('div',dg,[...a[6]||(a[6]=[(0,m.createElementVNode)('i',{class:'fas fa-image'},null,-1),(0,m.createElementVNode)('span',null,'暂无图片',-1)])]))],38)]),(0,m.createCommentVNode)(' 滑块控制 '),(0,m.createElementVNode)('div',ug,[(0,m.createCommentVNode)(' X 偏移 '),(0,m.createElementVNode)('div',pg,[a[7]||(a[7]=(0,m.createElementVNode)('label',{class:'acu-crop-label'},[(0,m.createElementVNode)('i',{class:'fas fa-arrows-left-right'}),(0,m.createTextVNode)(' X偏移 ')],-1)),(0,m.createElementVNode)('input',{type:'range',class:'acu-crop-slider',min:'0',max:'100',value:n.value,onInput:a[0]||(a[0]=e=>n.value=Number(e.target.value))},null,40,mg),(0,m.createElementVNode)('span',fg,(0,m.toDisplayString)(n.value)+'%',1)]),(0,m.createCommentVNode)(' Y 偏移 '),(0,m.createElementVNode)('div',gg,[a[8]||(a[8]=(0,m.createElementVNode)('label',{class:'acu-crop-label'},[(0,m.createElementVNode)('i',{class:'fas fa-arrows-up-down'}),(0,m.createTextVNode)(' Y偏移 ')],-1)),(0,m.createElementVNode)('input',{type:'range',class:'acu-crop-slider',min:'0',max:'100',value:r.value,onInput:a[1]||(a[1]=e=>r.value=Number(e.target.value))},null,40,vg),(0,m.createElementVNode)('span',bg,(0,m.toDisplayString)(r.value)+'%',1)]),(0,m.createCommentVNode)(' 缩放 '),(0,m.createElementVNode)('div',hg,[a[9]||(a[9]=(0,m.createElementVNode)('label',{class:'acu-crop-label'},[(0,m.createElementVNode)('i',{class:'fas fa-magnifying-glass-plus'}),(0,m.createTextVNode)(' 缩放 ')],-1)),(0,m.createElementVNode)('input',{type:'range',class:'acu-crop-slider',min:'100',max:'300',value:i.value,onInput:a[2]||(a[2]=e=>i.value=Number(e.target.value))},null,40,xg),(0,m.createElementVNode)('span',wg,(0,m.toDisplayString)(i.value)+'%',1)])]),(0,m.createCommentVNode)(' 反色选项 - 仅当 showInvertOption 为 true 时显示 '),e.showInvertOption?((0,m.openBlock)(),(0,m.createElementBlock)('div',yg,[(0,m.createElementVNode)('div',kg,[a[11]||(a[11]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createElementVNode)('i',{class:'fas fa-adjust'}),(0,m.createTextVNode)(' 反色效果 '),(0,m.createElementVNode)('span',{class:'hint'},'白变黑/黑变白')],-1)),(0,m.createElementVNode)('div',Cg,[(0,m.createElementVNode)('label',Ng,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[3]||(a[3]=e=>l.value=e),type:'checkbox'},null,512),[[m.vModelCheckbox,l.value]]),a[10]||(a[10]=(0,m.createElementVNode)('span',{class:'acu-switch-slider'},null,-1))])])])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 上传新图片按钮 '),(0,m.createElementVNode)('div',Vg,[(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:(0,m.withModifiers)(w,['stop'])},[...a[12]||(a[12]=[(0,m.createElementVNode)('i',{class:'fas fa-upload'},null,-1),(0,m.createTextVNode)(' 上传新图片 ',-1)])]),(0,m.createElementVNode)('input',{ref_key:'fileInputRef',ref:c,type:'file',accept:'image/*',style:{display:'none'},onChange:y},null,544)])]),(0,m.createCommentVNode)(' 底部按钮 '),(0,m.createElementVNode)('div',Eg,[(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:(0,m.withModifiers)(x,['stop'])},'重置'),(0,m.createElementVNode)('button',{class:'acu-modal-btn primary',onClick:(0,m.withModifiers)(h,['stop'])},'确定')])])])):(0,m.createCommentVNode)('v-if',!0)}}),Tg={class:'acu-modal acu-avatar-manager-dialog'},Sg={class:'acu-modal-header'},Dg={class:'acu-avatar-tab-bar'},Ag={class:'acu-avatar-search-bar'},zg=['placeholder'],Ig={class:'acu-modal-body acu-avatar-list'},_g={key:0,class:'acu-avatar-loading'},Mg={class:'acu-avatar-empty'},Ug={class:'acu-avatar-items'},Pg=['onClick'],$g={class:'acu-avatar-column'},Lg=['onClick'],Fg={key:0,class:'acu-avatar-initial'},jg={key:1,class:'fas fa-camera acu-avatar-camera-hint'},Og={class:'acu-avatar-info'},Rg={class:'acu-avatar-name-row'},Hg={class:'acu-avatar-name-left'},Wg={class:'acu-avatar-name'},Yg={key:0,class:'acu-avatar-label-preview'},Xg={class:'acu-avatar-name-right'},Gg=['onClick'],qg={class:'acu-import-dropdown'},Kg=['onClick'],Jg={key:0,class:'acu-dropdown-menu'},Zg=['onClick'],Qg=['onClick'],ev=['onClick'],tv={class:'acu-avatar-url-row'},av=['value','onChange','onBlur'],ov={class:'acu-avatar-alias-row'},nv=['value','onChange','onBlur'],rv={class:'acu-avatar-footer'},iv={class:'acu-footer-left'},lv=['disabled'],cv={class:'acu-footer-right'},sv=['disabled'],dv='acu_graph_config',uv=(0,m.defineComponent)({__name:'AvatarManagerDialog',props:{visible:{type:Boolean,default:!1},nodes:{default:()=>[]},factions:{default:()=>[]}},emits:['close','update','label-change'],setup(e,{emit:t}){function a(){try{return getVariables({type:'chat'})[dv]||{}}catch(e){return console.warn('[AvatarManager] 获取聊天变量失败:',e),{}}}function o(e){try{insertOrAssignVariables({[dv]:e},{type:'chat'})}catch(e){console.warn('[AvatarManager] 保存聊天变量失败:',e)}}const n=e,r=t,i=(0,Ue.o)(),l=(0,O.d)(),c=(0,k.j_)(),s=(0,m.ref)('character'),d=(0,m.ref)(!0),u=(0,m.ref)([]),p=(0,m.ref)([]),f=(0,m.ref)(new Map),g=(0,m.computed)(()=>f.value.size>0),b=(0,m.ref)(''),h=(0,m.ref)(!1),x=(0,m.ref)(new Set),w=(0,m.ref)(null),y=(0,m.ref)(null),C=(0,m.ref)(null),N=(0,m.ref)(null),V=(0,m.ref)(!1),E=(0,m.ref)(null),B=(0,m.computed)(()=>'character'===s.value?u.value:p.value),T=(0,m.computed)(()=>{if(!b.value.trim())return B.value;const e=b.value.toLowerCase().trim();return B.value.filter(t=>!!t.name.toLowerCase().includes(e)||(!!t.aliases.some(t=>t.toLowerCase().includes(e))||!!t.displayLabel?.toLowerCase().includes(e)))}),S=(0,m.computed)(()=>!!i.getSillyTavernCharacterAvatar()),D=(0,m.computed)(()=>!!i.getSillyTavernUserAvatar());async function A(e,t,a,o){const n=await i.getAvatar(t),r=await i.getAvatarUrl(t),l=!!n?.blob;let c=null;l?c='local':n?.url?c='url':r&&i.isPlayerNode(t)?c='auto':'faction'!==a||r?'faction'===a&&r&&(c='auto'):c=null;const s=o[t],d=s?.displayLabel,u=s?.selectedIndices,p=n?.aliases||[];return{id:e,name:t,label:d||t,type:a,avatarUrl:r,url:n?.url,offsetX:n?.offsetX??50,offsetY:n?.offsetY??50,scale:n?.scale??150,labelIndices:u,displayLabel:d,source:c,hasLocalBlob:l,aliases:p,aliasesText:p.join(', ')}}async function I(){d.value=!0;try{const e=[],t=[],o=new Set(n.factions.map(e=>e.name)),r=a().labels||{};for(const t of n.nodes){if(o.has(t.name))continue;const a=await A(t.id,t.name,t.type,r);e.push(a)}for(const e of n.factions){const a=await A(e.id,e.name,'faction',r);t.push(a)}if(f.value.size>0)for(const[a,o]of f.value){const n=e.findIndex(e=>e.name===a);if(-1!==n){const t=e[n];e[n]={...t,offsetX:o.offsetX??t.offsetX,offsetY:o.offsetY??t.offsetY,scale:o.scale??t.scale,url:o.url??t.url,avatarUrl:o.url??t.avatarUrl,source:o.url?'url':t.source,displayLabel:o.displayLabel??t.displayLabel,labelIndices:o.labelIndices??t.labelIndices,label:o.displayLabel??t.label,aliases:o.aliases??t.aliases,aliasesText:o.aliases?o.aliases.join(', '):t.aliasesText}}const r=t.findIndex(e=>e.name===a);if(-1!==r){const e=t[r];t[r]={...e,offsetX:o.offsetX??e.offsetX,offsetY:o.offsetY??e.offsetY,scale:o.scale??e.scale,url:o.url??e.url,avatarUrl:o.url??e.avatarUrl,source:o.url?'url':e.source,displayLabel:o.displayLabel??e.displayLabel,labelIndices:o.labelIndices??e.labelIndices,label:o.displayLabel??e.label,aliases:o.aliases??e.aliases,aliasesText:o.aliases?o.aliases.join(', '):e.aliasesText}}}u.value=e,p.value=t}catch(e){console.error('[AvatarManager] 加载数据失败:',e),l.error('加载数据失败')}finally{d.value=!1}}function M(e){s.value=e,b.value='',J()}function U(){g.value&&!confirm('有未保存的更改，确定要关闭吗？')||(f.value.clear(),r('close'))}function P(e){if(!e)return'?';if(/^[A-Za-z\s'-]+$/.test(e)&&e.includes(' ')){const t=e.split(' ')[0];return t.length>6?t.slice(0,6):t}return e[e.length-1]}function L(e){switch(e){case'local':return'本地';case'url':return'URL';case'auto':return'酒馆';default:return''}}function F(e){return e.avatarUrl?{backgroundImage:`url('${e.avatarUrl}')`,backgroundPosition:`${e.offsetX}% ${e.offsetY}%`,backgroundSize:`${e.scale}%`}:{}}function j(){w.value=null}async function R(e){const t=e.target,a=t.files?.[0];if(!a||!C.value)return void(t.value='');const o=C.value;try{const e=await(0,v.bB)(a),t=await(0,v.w4)(e,300,.85),n=await fetch(t),c=await n.blob();await i.saveAvatar({name:o.name,blob:c,offsetX:o.offsetX,offsetY:o.offsetY,scale:o.scale,aliases:[...(0,m.toRaw)(o.aliases)],updatedAt:Date.now()}),await I(),r('update'),l.success('头像已上传')}catch(e){console.error('[AvatarManager] 上传失败:',e),alert('上传失败')}t.value='',C.value=null}function H(e,t){const a=t.trim();Q(e.name,{url:a||void 0}),ee(e.id,{url:a||void 0,avatarUrl:a||e.avatarUrl,source:a?'url':e.source})}function W(e,t){const a=t.split(/[,，、\s]+/).map(e=>e.trim()).filter(Boolean);Q(e.name,{aliases:a}),ee(e.id,{aliases:a,aliasesText:a.join(', ')})}function Y(e){const t=a(),o=t.labels?.[e.name],n={...e,labelIndices:o?.selectedIndices||[],displayLabel:o?.displayLabel,label:o?.displayLabel||e.name};N.value=n,c.openNodeLabelDialog({fullName:n.name,initialIndices:n.labelIndices||[]},{onApply:e=>{const t=e.sort((e,t)=>e-t).map(e=>n.name[e]).join('');!function(e,t){Q(e.name,{displayLabel:t.displayLabel,labelIndices:t.selectedIndices}),ee(e.id,{displayLabel:t.displayLabel,labelIndices:t.selectedIndices,label:t.displayLabel})}(n,{displayLabel:t,selectedIndices:e})},onReset:()=>{!function(e){Q(e.name,{displayLabel:void 0,labelIndices:void 0}),ee(e.id,{displayLabel:void 0,labelIndices:void 0,label:e.name})}(n)}})}function X(){V.value=!1,E.value=null}function G(e){if(!E.value)return;const t=E.value;Q(t.name,{offsetX:e.offsetX,offsetY:e.offsetY,scale:e.scale}),ee(t.id,{offsetX:e.offsetX,offsetY:e.offsetY,scale:e.scale}),E.value={...t,offsetX:e.offsetX,offsetY:e.offsetY,scale:e.scale},X()}async function q(e){if(!E.value)return;C.value=E.value;const t=new DataTransfer;t.items.add(e);const a={target:{files:t.files,value:''}};await R(a),X()}function K(){h.value=!0,x.value.clear()}function J(){h.value=!1,x.value.clear()}async function Z(){if(0===x.value.size)return;const e=B.value.filter(e=>x.value.has(e.id)).map(e=>e.name);if(confirm(`确定要删除 ${e.length} 个头像配置吗？\n\n这将从 IndexedDB 中永久删除图片数据。`))try{await i.deleteAvatars(e);const t=a();if(t.labels){let a=!1;for(const o of e)t.labels[o]&&(delete t.labels[o],a=!0);a&&o(t)}await I(),J(),r('update'),l.success('删除成功')}catch(e){console.error('[AvatarManager] 删除失败:',e),l.error('删除失败')}}function Q(e,t){const a=f.value.get(e)||{};f.value.set(e,{...a,...t})}function ee(e,t){const a=u.value.findIndex(t=>t.id===e);-1!==a&&(u.value[a]={...u.value[a],...t});const o=p.value.findIndex(t=>t.id===e);-1!==o&&(p.value[o]={...p.value[o],...t})}async function te(){if(0!==f.value.size)try{const e=a();e.labels||(e.labels={});let t=!1;for(const[a,o]of f.value)if(void 0===o.displayLabel&&void 0===o.labelIndices||(o.displayLabel?e.labels[a]={displayLabel:o.displayLabel,selectedIndices:o.labelIndices||[]}:void 0===o.displayLabel&&void 0===o.labelIndices&&delete e.labels[a],t=!0),void 0!==o.url||void 0!==o.offsetX||void 0!==o.offsetY||void 0!==o.scale||void 0!==o.aliases){const e=await i.getAvatar(a);let t=[];void 0!==o.aliases?t=[...(0,m.toRaw)(o.aliases)]:e?.aliases&&(t=[...e.aliases]);const n={name:a,blob:e?.blob,url:void 0!==o.url?o.url:e?.url,offsetX:o.offsetX??e?.offsetX??50,offsetY:o.offsetY??e?.offsetY??50,scale:o.scale??e?.scale??150,aliases:t,updatedAt:Date.now()};await i.saveAvatar(n)}t&&o(e),f.value.clear(),l.success('保存成功'),r('update'),r('label-change')}catch(e){console.error('[AvatarManager] 保存失败:',e),l.error('保存失败: '+(e instanceof Error?e.message:String(e)))}}return(0,m.onMounted)(()=>{n.visible&&I()}),(0,m.watch)(()=>n.visible,e=>{e?I():(h.value=!1,x.value.clear(),w.value=null,s.value='character',f.value.clear())}),(0,m.watch)(w,e=>{if(e){const e=()=>{w.value=null,document.removeEventListener('click',e)};setTimeout(()=>{document.addEventListener('click',e)},0)}}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-avatar-manager-overlay',onClick:(0,m.withModifiers)(U,['self'])},[(0,m.createElementVNode)('div',Tg,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',Sg,[a[4]||(a[4]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},[(0,m.createElementVNode)('i',{class:'fas fa-user-circle'}),(0,m.createTextVNode)(' 头像管理 ')],-1)),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(U,['stop'])},'完成')]),(0,m.createCommentVNode)(' Tab 切换栏 '),(0,m.createElementVNode)('div',Dg,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-avatar-tab-btn',{active:'character'===s.value}]),onClick:a[0]||(a[0]=(0,m.withModifiers)(e=>M('character'),['stop']))},[...a[5]||(a[5]=[(0,m.createElementVNode)('i',{class:'fas fa-user'},null,-1),(0,m.createTextVNode)(' 人物头像 ',-1)])],2),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-avatar-tab-btn',{active:'faction'===s.value}]),onClick:a[1]||(a[1]=(0,m.withModifiers)(e=>M('faction'),['stop']))},[...a[6]||(a[6]=[(0,m.createElementVNode)('i',{class:'fas fa-users'},null,-1),(0,m.createTextVNode)(' 势力头像 ',-1)])],2)]),(0,m.createCommentVNode)(' 搜索框 '),(0,m.createElementVNode)('div',Ag,[a[8]||(a[8]=(0,m.createElementVNode)('i',{class:'fas fa-search'},null,-1)),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[2]||(a[2]=e=>b.value=e),type:'text',class:'acu-avatar-search-input',placeholder:'character'===s.value?'搜索角色名称或别名...':'搜索势力名称...'},null,8,zg),[[m.vModelText,b.value]]),b.value?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-search-clear',onClick:a[3]||(a[3]=(0,m.withModifiers)(e=>b.value='',['stop']))},[...a[7]||(a[7]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 内容区 - 可滚动 '),(0,m.createElementVNode)('div',Ig,[(0,m.createCommentVNode)(' 加载中 '),d.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',_g,[...a[9]||(a[9]=[(0,m.createElementVNode)('i',{class:'fas fa-spinner fa-spin'},null,-1),(0,m.createElementVNode)('span',null,'加载中...',-1)])])):0===T.value.length?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 空状态 '),(0,m.createElementVNode)('div',Mg,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)('character'===s.value?'fas fa-user-slash':'fas fa-users-slash')},null,2),(0,m.createElementVNode)('p',null,(0,m.toDisplayString)(b.value?'未找到匹配的数据':'character'===s.value?'暂无角色数据':'暂无势力数据'),1)])],2112)):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:2},[(0,m.createCommentVNode)(' 统一头像列表 '),(0,m.createElementVNode)('div',Ug,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(T.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:(0,m.normalizeClass)(['acu-avatar-item',{selected:x.value.has(e.id)}])},[(0,m.createCommentVNode)(' 批量删除选择框 '),h.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-avatar-checkbox',onClick:(0,m.withModifiers)(t=>function(e){const t=new Set(x.value);t.has(e)?t.delete(e):t.add(e),x.value=t}(e.id),['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(x.value.has(e.id)?'fas fa-check-square':'far fa-square')},null,2)],8,Pg)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 头像区：头像 + 来源标签 '),(0,m.createElementVNode)('div',$g,[(0,m.createCommentVNode)(' 头像预览 '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-avatar-preview',{'has-image':!!e.avatarUrl}]),style:(0,m.normalizeStyle)(F(e)),onClick:(0,m.withModifiers)(t=>function(e){if(!e.avatarUrl)return C.value=e,void y.value?.click();E.value=e,V.value=!0}(e),['stop'])},[e.avatarUrl?(0,m.createCommentVNode)('v-if',!0):((0,m.openBlock)(),(0,m.createElementBlock)('span',Fg,(0,m.toDisplayString)(e.displayLabel||P(e.name)),1)),e.avatarUrl?(0,m.createCommentVNode)('v-if',!0):((0,m.openBlock)(),(0,m.createElementBlock)('i',jg))],14,Lg),(0,m.createCommentVNode)(' 来源标签 '),e.source?((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:0,class:(0,m.normalizeClass)(['acu-avatar-source','acu-source-'+e.source])},(0,m.toDisplayString)(L(e.source)),3)):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 信息区 '),(0,m.createElementVNode)('div',Og,[(0,m.createCommentVNode)(' 名称行 '),(0,m.createElementVNode)('div',Rg,[(0,m.createCommentVNode)(' 左侧：全名 + 标签预览 '),(0,m.createElementVNode)('div',Hg,[(0,m.createElementVNode)('span',Wg,(0,m.toDisplayString)(e.name),1),e.displayLabel?((0,m.openBlock)(),(0,m.createElementBlock)('span',Yg,'('+(0,m.toDisplayString)(e.displayLabel)+')',1)):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 右侧：按钮区 '),(0,m.createElementVNode)('div',Xg,[(0,m.createCommentVNode)(' 名字配置按钮 '),(0,m.createElementVNode)('button',{class:'acu-avatar-name-btn',title:'配置头像显示名称',onClick:(0,m.withModifiers)(t=>Y(e),['stop'])},' 姓名显示 ',8,Gg),(0,m.createCommentVNode)(' 导入下拉 '),(0,m.createElementVNode)('div',qg,[(0,m.createElementVNode)('button',{class:'acu-avatar-import-btn',title:'导入头像',onClick:(0,m.withModifiers)(t=>{return a=e.id,void(w.value=w.value===a?null:a);var a},['stop'])},[...a[10]||(a[10]=[(0,m.createTextVNode)(' 导入 ',-1),(0,m.createElementVNode)('i',{class:'fas fa-caret-down'},null,-1)])],8,Kg),w.value===e.id?((0,m.openBlock)(),(0,m.createElementBlock)('div',Jg,[(0,m.createElementVNode)('div',{class:'acu-dropdown-item',onClick:(0,m.withModifiers)(t=>function(e){j(),C.value=e,y.value?.click()}(e),['stop'])},[...a[11]||(a[11]=[(0,m.createElementVNode)('i',{class:'fas fa-upload'},null,-1),(0,m.createTextVNode)(' 本地导入 ',-1)])],8,Zg),(0,m.createCommentVNode)(' 仅人物头像显示酒馆导入选项 '),'character'===s.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-dropdown-item',{disabled:!S.value}]),onClick:(0,m.withModifiers)(t=>function(e){j();const t=i.getSillyTavernCharacterAvatar();t?(Q(e.name,{url:t}),ee(e.id,{url:t,avatarUrl:t,source:'url'})):alert('未找到角色卡头像')}(e),['stop'])},[...a[12]||(a[12]=[(0,m.createElementVNode)('i',{class:'fas fa-user-circle'},null,-1),(0,m.createTextVNode)(' 角色卡头像 ',-1)])],10,Qg),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-dropdown-item',{disabled:!D.value}]),onClick:(0,m.withModifiers)(t=>function(e){j();const t=i.getSillyTavernUserAvatar();t?(Q(e.name,{url:t}),ee(e.id,{url:t,avatarUrl:t,source:'url'})):alert('未找到用户头像')}(e),['stop'])},[...a[13]||(a[13]=[(0,m.createElementVNode)('i',{class:'fas fa-user'},null,-1),(0,m.createTextVNode)(' 用户头像 ',-1)])],10,ev)],64)):(0,m.createCommentVNode)('v-if',!0)])):(0,m.createCommentVNode)('v-if',!0)])])]),(0,m.createCommentVNode)(' URL 输入 '),(0,m.createElementVNode)('div',tv,[a[14]||(a[14]=(0,m.createElementVNode)('span',{class:'acu-url-label'},'URL:',-1)),(0,m.createElementVNode)('input',{type:'text',class:'acu-avatar-url-input',placeholder:'粘贴图片URL...',value:e.url||'',onChange:t=>H(e,t.target.value),onBlur:t=>H(e,t.target.value)},null,40,av)]),(0,m.createCommentVNode)(' 别名输入 '),(0,m.createElementVNode)('div',ov,[a[15]||(a[15]=(0,m.createElementVNode)('span',{class:'acu-alias-label'},'别名:',-1)),(0,m.createElementVNode)('input',{type:'text',class:'acu-avatar-alias-input',placeholder:'输入别名，用逗号分隔...',value:e.aliasesText||'',onChange:t=>W(e,t.target.value),onBlur:t=>W(e,t.target.value)},null,40,nv)])])],2))),128))])],2112))]),(0,m.createCommentVNode)(' 底部固定栏 '),(0,m.createElementVNode)('div',rv,[(0,m.createElementVNode)('div',iv,[h.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:(0,m.withModifiers)(J,['stop'])},'取消'),(0,m.createElementVNode)('button',{class:'acu-modal-btn danger',disabled:0===x.value.size,onClick:(0,m.withModifiers)(Z,['stop'])},' 删除 ('+(0,m.toDisplayString)(x.value.size)+') ',9,lv)],64)):((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-modal-btn secondary',onClick:(0,m.withModifiers)(K,['stop'])},[...a[16]||(a[16]=[(0,m.createElementVNode)('i',{class:'fas fa-trash-alt'},null,-1),(0,m.createTextVNode)(' 批量删除 ',-1)])]))]),(0,m.createElementVNode)('div',cv,[(0,m.createElementVNode)('button',{class:'acu-modal-btn primary',disabled:!g.value,onClick:(0,m.withModifiers)(te,['stop'])},[...a[17]||(a[17]=[(0,m.createElementVNode)('i',{class:'fas fa-save'},null,-1),(0,m.createTextVNode)(' 保存 ',-1)])],8,sv)])])]),(0,m.createCommentVNode)(' 隐藏的文件输入 '),(0,m.createElementVNode)('input',{ref_key:'fileInputRef',ref:y,type:'file',accept:'image/*',style:{display:'none'},onChange:R},null,544),(0,m.createCommentVNode)(' 裁剪弹窗 '),V.value?((0,m.openBlock)(),(0,m.createBlock)(Bg,{key:0,visible:V.value,'image-url':E.value?.avatarUrl||'',name:E.value?.name||'','initial-offset-x':E.value?.offsetX??50,'initial-offset-y':E.value?.offsetY??50,'initial-scale':E.value?.scale??150,onClose:X,onApply:G,onUpload:q},null,8,['visible','image-url','name','initial-offset-x','initial-offset-y','initial-scale'])):(0,m.createCommentVNode)('v-if',!0)])):(0,m.createCommentVNode)('v-if',!0)}}),pv=uv;var mv=u(420);const fv={class:'acu-modal acu-faction-settings-modal'},gv={class:'acu-modal-header'},vv={class:'acu-modal-title'},bv={class:'acu-modal-body'},hv={class:'acu-settings-section'},xv={class:'acu-settings-group'},wv={class:'acu-settings-row'},yv={class:'acu-settings-control'},kv={class:'acu-settings-row'},Cv={class:'acu-settings-control'},Nv={class:'acu-settings-row'},Vv={class:'acu-settings-label'},Ev={class:'hint'},Bv={class:'acu-settings-control'},Tv={class:'acu-settings-section'},Sv={class:'acu-settings-group'},Dv={class:'acu-settings-row'},Av={class:'acu-settings-control'},zv={class:'acu-settings-row'},Iv={class:'acu-settings-label'},_v={class:'hint'},Mv={class:'acu-settings-control'},Uv={class:'acu-settings-section'},Pv={class:'acu-settings-group'},$v={class:'acu-settings-row acu-action-row'},Lv=(0,m.defineComponent)({__name:'FactionSettingsDialog',props:{visible:{type:Boolean,default:!1},factionId:{default:''},factionName:{default:''}},emits:['close','save'],setup(e,{emit:t}){const a=e,o=t,n=(0,mv.zI)(),r=(0,m.reactive)({borderColor:mv.X8.border,backgroundColor:i(mv.X8.background),backgroundOpacity:mv.X8.opacity??10,labelPosition:'top',labelFontSize:14});function i(e){if(e.startsWith('#'))return e;const t=e.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);if(t){const e=parseInt(t[1],10),a=parseInt(t[2],10),o=parseInt(t[3],10);return`#${e.toString(16).padStart(2,'0')}${a.toString(16).padStart(2,'0')}${o.toString(16).padStart(2,'0')}`}return'#808080'}function l(){const e=n.getFactionOverride(a.factionId);e?(r.borderColor=e.border||mv.X8.border,r.backgroundColor=i(e.background||mv.X8.background),r.backgroundOpacity=e.opacity??mv.X8.opacity??10,r.labelPosition=e.labelPosition??'top',r.labelFontSize=e.labelFontSize??n.config.factionLabelFontSize):(r.borderColor=mv.X8.border,r.backgroundColor=i(mv.X8.background),r.backgroundOpacity=mv.X8.opacity??10,r.labelPosition='top',r.labelFontSize=n.config.factionLabelFontSize)}function c(){o('close')}function s(){n.removeFactionOverride(a.factionId),r.borderColor=mv.X8.border,r.backgroundColor=i(mv.X8.background),r.backgroundOpacity=mv.X8.opacity??10,r.labelPosition='top',r.labelFontSize=n.config.factionLabelFontSize}return(0,m.watch)(()=>a.visible,e=>{e&&a.factionId&&l()}),(0,m.watch)(()=>a.factionId,e=>{e&&a.visible&&l()}),(0,m.watchEffect)(()=>{var e,t;a.visible&&a.factionId&&(n.setFactionOverride(a.factionId,{border:r.borderColor,background:(e=r.backgroundColor,t=r.backgroundOpacity,`rgba(${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}, ${t/100})`),opacity:r.backgroundOpacity,labelPosition:r.labelPosition,labelFontSize:r.labelFontSize}),o('save'))}),(t,a)=>((0,m.openBlock)(),(0,m.createBlock)(m.Transition,{name:'modal'},{default:(0,m.withCtx)(()=>[e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container',onClick:(0,m.withModifiers)(c,['self'])},[(0,m.createElementVNode)('div',fv,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',gv,[(0,m.createElementVNode)('span',vv,'势力设置 - '+(0,m.toDisplayString)(e.factionName),1),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(c,['stop'])},'完成')]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',bv,[(0,m.createCommentVNode)(' 颜色设置 '),(0,m.createElementVNode)('div',hv,[a[8]||(a[8]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-palette'}),(0,m.createTextVNode)(' 颜色设置 ')],-1)),(0,m.createElementVNode)('div',xv,[(0,m.createCommentVNode)(' 边框&tag颜色 '),(0,m.createElementVNode)('div',wv,[a[5]||(a[5]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 边框&tag颜色 '),(0,m.createElementVNode)('span',{class:'hint'},'虚线框颜色')],-1)),(0,m.createElementVNode)('div',yv,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[0]||(a[0]=e=>r.borderColor=e),type:'color',class:'acu-dashed',title:'边框颜色'},null,512),[[m.vModelText,r.borderColor]])])]),(0,m.createCommentVNode)(' 背景颜色 '),(0,m.createElementVNode)('div',kv,[a[6]||(a[6]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 背景颜色 '),(0,m.createElementVNode)('span',{class:'hint'},'容器填充色')],-1)),(0,m.createElementVNode)('div',Cv,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[1]||(a[1]=e=>r.backgroundColor=e),type:'color',title:'背景颜色'},null,512),[[m.vModelText,r.backgroundColor]])])]),(0,m.createCommentVNode)(' 背景透明度 '),(0,m.createElementVNode)('div',Nv,[(0,m.createElementVNode)('div',Vv,[a[7]||(a[7]=(0,m.createTextVNode)(' 背景透明度 ',-1)),(0,m.createElementVNode)('span',Ev,(0,m.toDisplayString)(r.backgroundOpacity)+'%',1)]),(0,m.createElementVNode)('div',Bv,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[2]||(a[2]=e=>r.backgroundOpacity=e),type:'range',min:'0',max:'100',step:'5'},null,512),[[m.vModelText,r.backgroundOpacity,void 0,{number:!0}]])])])])]),(0,m.createCommentVNode)(' 标签设置 '),(0,m.createElementVNode)('div',Tv,[a[12]||(a[12]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-tag'}),(0,m.createTextVNode)(' 标签设置 ')],-1)),(0,m.createElementVNode)('div',Sv,[(0,m.createCommentVNode)(' 标签位置 '),(0,m.createElementVNode)('div',Dv,[a[10]||(a[10]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 标签位置 '),(0,m.createElementVNode)('span',{class:'hint'},'势力名称显示位置')],-1)),(0,m.createElementVNode)('div',Av,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[3]||(a[3]=e=>r.labelPosition=e)},[...a[9]||(a[9]=[(0,m.createElementVNode)('option',{value:'top'},'顶部',-1),(0,m.createElementVNode)('option',{value:'bottom'},'底部',-1),(0,m.createElementVNode)('option',{value:'top-left'},'内部左上',-1),(0,m.createElementVNode)('option',{value:'top-right'},'内部右上',-1),(0,m.createElementVNode)('option',{value:'bottom-left'},'内部左下',-1),(0,m.createElementVNode)('option',{value:'bottom-right'},'内部右下',-1),(0,m.createElementVNode)('option',{value:'none'},'不显示',-1)])],512),[[m.vModelSelect,r.labelPosition]])])]),(0,m.createCommentVNode)(' 标签字体大小 '),(0,m.createElementVNode)('div',zv,[(0,m.createElementVNode)('div',Iv,[a[11]||(a[11]=(0,m.createTextVNode)(' 标签字体 ',-1)),(0,m.createElementVNode)('span',_v,(0,m.toDisplayString)(r.labelFontSize)+'px',1)]),(0,m.createElementVNode)('div',Mv,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[4]||(a[4]=e=>r.labelFontSize=e),type:'range',min:'10',max:'24',step:'1'},null,512),[[m.vModelText,r.labelFontSize,void 0,{number:!0}]])])])])]),(0,m.createCommentVNode)(' 操作按钮 '),(0,m.createElementVNode)('div',Uv,[(0,m.createElementVNode)('div',Pv,[(0,m.createElementVNode)('div',$v,[(0,m.createElementVNode)('button',{class:'acu-action-btn acu-action-btn-secondary',onClick:(0,m.withModifiers)(s,['stop'])},[...a[13]||(a[13]=[(0,m.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,m.createTextVNode)(' 重置为默认 ',-1)])])])])])])])])):(0,m.createCommentVNode)('v-if',!0)]),_:1}))}});u(1402);const Fv=Lv,jv={class:'acu-modal acu-graph-settings-modal'},Ov={class:'acu-modal-header'},Rv={class:'acu-modal-body'},Hv={class:'acu-settings-section'},Wv={class:'acu-settings-group'},Yv={class:'acu-settings-row'},Xv={class:'acu-settings-label'},Gv={class:'hint'},qv={class:'acu-settings-control'},Kv={class:'acu-settings-row'},Jv={class:'acu-settings-label'},Zv={class:'hint'},Qv={class:'acu-settings-control'},eb={class:'acu-settings-row'},tb={class:'acu-settings-control'},ab={class:'acu-switch'},ob={class:'acu-settings-section'},nb={class:'acu-settings-group'},rb={class:'acu-settings-row'},ib={class:'acu-settings-label'},lb={class:'hint'},cb={class:'acu-settings-control'},sb={class:'acu-settings-row'},db={class:'acu-settings-label'},ub={class:'hint'},pb={class:'acu-settings-control'},mb={class:'acu-settings-row'},fb={class:'acu-settings-label'},gb={class:'hint'},vb={class:'acu-settings-control'},bb={key:0,class:'acu-settings-section'},hb={class:'acu-settings-title'},xb={style:{'font-weight':'400','font-size':'11px',color:'var(--acu-text-sub)','margin-left':'auto'}},wb={class:'acu-faction-color-group acu-faction-color-scrollable'},yb={class:'acu-settings-label'},kb={class:'acu-settings-control acu-faction-color-control'},Cb=['value','onInput'],Nb=['value','onInput'],Vb=['value','title','onInput'],Eb={class:'acu-opacity-value'},Bb={class:'acu-settings-section'},Tb={class:'acu-settings-group'},Sb={class:'acu-settings-row'},Db={class:'acu-settings-control'},Ab={class:'acu-switch'},zb=['checked'],Ib={class:'acu-settings-section'},_b={class:'acu-settings-group'},Mb={class:'acu-settings-row'},Ub={class:'acu-settings-control'},Pb={class:'acu-switch'},$b={key:0,class:'acu-legend-items-section'},Lb={class:'acu-legend-items-header'},Fb={class:'acu-legend-items-list'},jb={key:0,class:'acu-legend-item-edit'},Ob={class:'acu-legend-edit-row'},Rb={class:'acu-legend-edit-row'},Hb={class:'acu-legend-edit-actions'},Wb={class:'acu-legend-item-display'},Yb={class:'acu-legend-emoji'},Xb={class:'acu-legend-label'},Gb={class:'acu-legend-keywords'},qb={key:0,class:'acu-legend-keyword-more'},Kb={class:'acu-legend-item-actions'},Jb=['onClick'],Zb=['onClick'],Qb={key:0,class:'acu-legend-empty'},eh={class:'acu-legend-reset-wrapper'},th={class:'acu-settings-section'},ah={class:'acu-settings-group'},oh={class:'acu-settings-row acu-action-row'},nh=(0,m.defineComponent)({__name:'GraphSettingsDialog',props:{visible:{type:Boolean},factions:{}},emits:['close','open-avatar-manager'],setup(e,{emit:t}){const a=e,o=t,n=(0,mv.zI)(),r=((0,k.j_)(),(0,m.computed)(()=>n.config)),i=(0,m.computed)(()=>a.factions||[]),l=(0,m.computed)(()=>n.getLegendConfig()),c=(0,m.ref)(null),s=(0,m.reactive)({label:'',color:'#888888',emoji:'',keywordsStr:''});function d(e){const t=n.config.factionColors[e];if(t)return t.border;const a=i.value.indexOf(e);return a>=0&&a<mv.TY.length?mv.TY[a].border:mv.X8.border}function u(e){const t=n.config.factionColors[e];if(t){const e=t.background.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(e){const t=parseInt(e[1]),a=parseInt(e[2]),o=parseInt(e[3]);return`#${t.toString(16).padStart(2,'0')}${a.toString(16).padStart(2,'0')}${o.toString(16).padStart(2,'0')}`}return t.background}const a=i.value.indexOf(e);let o;o=a>=0&&a<mv.TY.length?mv.TY[a].background:mv.X8.background;const r=o.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(r){const e=parseInt(r[1]),t=parseInt(r[2]),a=parseInt(r[3]);return`#${e.toString(16).padStart(2,'0')}${t.toString(16).padStart(2,'0')}${a.toString(16).padStart(2,'0')}`}return'#808080'}function p(e){const t=n.config.factionColors[e];if(t&&void 0!==t.opacity)return t.opacity;const a=i.value.indexOf(e);return a>=0&&a<mv.TY.length?mv.TY[a].opacity:mv.X8.opacity??10}function f(e,t){return`rgba(${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}, ${t})`}function g(){o('close'),o('open-avatar-manager')}function v(){o('close')}function b(){n.resetToDefault()}function h(){n.setLegendEnabled(l.value.enabled)}function x(){n.addLegendItem({label:'新图例',color:'#888888',emoji:'⚪',keywords:[]});const e=n.getLegendConfig().items,t=e[e.length-1];t&&w(t)}function w(e){c.value=e.id,s.label=e.label,s.color=e.color,s.emoji=e.emoji||'',s.keywordsStr=e.keywords.join(', ')}function y(){if(!c.value)return;const e=s.keywordsStr.split(/[,，]/).map(e=>e.trim()).filter(e=>e.length>0);n.updateLegendItem(c.value,{label:s.label,color:s.color,emoji:s.emoji||void 0,keywords:e}),c.value=null}function C(){c.value=null}function N(){n.resetLegendConfig()}return(t,a)=>((0,m.openBlock)(),(0,m.createBlock)(m.Transition,{name:'modal'},{default:(0,m.withCtx)(()=>[e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container',onClick:(0,m.withModifiers)(v,['self'])},[(0,m.createElementVNode)('div',jv,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',Ov,[a[12]||(a[12]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},'关系图设置',-1)),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(v,['stop'])},'完成')]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',Rv,[(0,m.createCommentVNode)(' 显示设置 '),(0,m.createElementVNode)('div',Hv,[a[18]||(a[18]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-eye'}),(0,m.createTextVNode)(' 显示设置 ')],-1)),(0,m.createElementVNode)('div',Wv,[(0,m.createCommentVNode)(' 节点大小 '),(0,m.createElementVNode)('div',Yv,[(0,m.createElementVNode)('div',Xv,[a[13]||(a[13]=(0,m.createTextVNode)(' 节点大小 ',-1)),(0,m.createElementVNode)('span',Gv,(0,m.toDisplayString)(r.value.nodeSize)+'px',1)]),(0,m.createElementVNode)('div',qv,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[0]||(a[0]=e=>r.value.nodeSize=e),type:'range',min:'30',max:'80',step:'5'},null,512),[[m.vModelText,r.value.nodeSize,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 边宽度 '),(0,m.createElementVNode)('div',Kv,[(0,m.createElementVNode)('div',Jv,[a[14]||(a[14]=(0,m.createTextVNode)(' 边宽度 ',-1)),(0,m.createElementVNode)('span',Zv,(0,m.toDisplayString)(r.value.edgeWidth.toFixed(1))+'px',1)]),(0,m.createElementVNode)('div',Qv,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[1]||(a[1]=e=>r.value.edgeWidth=e),type:'range',min:'1',max:'5',step:'0.5'},null,512),[[m.vModelText,r.value.edgeWidth,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 显示图例 '),(0,m.createElementVNode)('div',eb,[a[16]||(a[16]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 显示图例 '),(0,m.createElementVNode)('span',{class:'hint'},'关系颜色图例')],-1)),(0,m.createElementVNode)('div',tb,[(0,m.createElementVNode)('label',ab,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[2]||(a[2]=e=>r.value.showLegend=e),type:'checkbox'},null,512),[[m.vModelCheckbox,r.value.showLegend]]),a[15]||(a[15]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])])]),(0,m.createCommentVNode)(' 头像管理入口 '),(0,m.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:(0,m.withModifiers)(g,['stop'])},[...a[17]||(a[17]=[(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 头像管理 '),(0,m.createElementVNode)('span',{class:'hint'},'管理节点头像')],-1),(0,m.createElementVNode)('div',{class:'acu-settings-control'},[(0,m.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])])])]),(0,m.createCommentVNode)(' 字体设置 '),(0,m.createElementVNode)('div',ob,[a[22]||(a[22]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-font'}),(0,m.createTextVNode)(' 字体设置 ')],-1)),(0,m.createElementVNode)('div',nb,[(0,m.createCommentVNode)(' 关系标签字体 '),(0,m.createElementVNode)('div',rb,[(0,m.createElementVNode)('div',ib,[a[19]||(a[19]=(0,m.createTextVNode)(' 关系标签 ',-1)),(0,m.createElementVNode)('span',lb,(0,m.toDisplayString)(r.value.relationLabelFontSize)+'px',1)]),(0,m.createElementVNode)('div',cb,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[3]||(a[3]=e=>r.value.relationLabelFontSize=e),type:'range',min:'8',max:'16',step:'1'},null,512),[[m.vModelText,r.value.relationLabelFontSize,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 人名标签字体 '),(0,m.createElementVNode)('div',sb,[(0,m.createElementVNode)('div',db,[a[20]||(a[20]=(0,m.createTextVNode)(' 人名标签 ',-1)),(0,m.createElementVNode)('span',ub,(0,m.toDisplayString)(r.value.nameLabelFontSize)+'px',1)]),(0,m.createElementVNode)('div',pb,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[4]||(a[4]=e=>r.value.nameLabelFontSize=e),type:'range',min:'8',max:'18',step:'1'},null,512),[[m.vModelText,r.value.nameLabelFontSize,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 势力名标签字体 '),(0,m.createElementVNode)('div',mb,[(0,m.createElementVNode)('div',fb,[a[21]||(a[21]=(0,m.createTextVNode)(' 势力名标签 ',-1)),(0,m.createElementVNode)('span',gb,(0,m.toDisplayString)(r.value.factionLabelFontSize)+'px',1)]),(0,m.createElementVNode)('div',vb,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[5]||(a[5]=e=>r.value.factionLabelFontSize=e),type:'range',min:'10',max:'20',step:'1'},null,512),[[m.vModelText,r.value.factionLabelFontSize,void 0,{number:!0}]])])])])]),(0,m.createCommentVNode)(' 势力颜色设置 '),i.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',bb,[(0,m.createElementVNode)('div',hb,[a[23]||(a[23]=(0,m.createElementVNode)('i',{class:'fas fa-palette'},null,-1)),a[24]||(a[24]=(0,m.createTextVNode)(' 势力颜色 ',-1)),(0,m.createElementVNode)('span',xb,(0,m.toDisplayString)(i.value.length)+' 个势力 ',1)]),(0,m.createCommentVNode)(' 颜色提示 '),a[25]||(a[25]=(0,m.createElementVNode)('div',{class:'acu-faction-color-hint'},[(0,m.createElementVNode)('span',{class:'hint-item'},[(0,m.createElementVNode)('span',{class:'hint-box dashed'}),(0,m.createTextVNode)(' 边框色 ')]),(0,m.createElementVNode)('span',{class:'hint-item'},[(0,m.createElementVNode)('span',{class:'hint-box solid'}),(0,m.createTextVNode)(' 背景色 ')]),(0,m.createElementVNode)('span',{class:'hint-item'},[(0,m.createElementVNode)('i',{class:'fas fa-adjust',style:{'font-size':'12px','margin-right':'2px'}}),(0,m.createTextVNode)(' 透明度 ')])],-1)),(0,m.createCommentVNode)(' 可滚动的势力列表 '),(0,m.createElementVNode)('div',wb,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(i.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e,class:'acu-settings-row acu-faction-color-row'},[(0,m.createElementVNode)('div',yb,(0,m.toDisplayString)(e),1),(0,m.createElementVNode)('div',kb,[(0,m.createElementVNode)('input',{type:'color',class:'acu-dashed',value:d(e),title:'边框颜色（虚线框）',onInput:t=>function(e,t){const a=t.target.value,o=n.config.factionColors[e]||{border:d(e),background:f(u(e),.1)};n.setFactionColor(e,{...o,border:a})}(e,t)},null,40,Cb),(0,m.createElementVNode)('input',{type:'color',value:u(e),title:'背景颜色',onInput:t=>function(e,t){const a=t.target.value,o=p(e),r=n.config.factionColors[e]||{border:d(e),background:f(a,o/100),opacity:o};n.setFactionColor(e,{...r,background:f(a,o/100)})}(e,t)},null,40,Nb),(0,m.createElementVNode)('input',{type:'range',class:'acu-opacity-slider',value:p(e),min:'0',max:'100',step:'5',title:`透明度: ${p(e)}%`,onInput:t=>function(e,t){const a=t.target,o=parseInt(a.value,10),r=u(e),i=n.config.factionColors[e]||{border:d(e),background:f(r,o/100),opacity:o};n.setFactionColor(e,{...i,background:f(r,o/100),opacity:o})}(e,t)},null,40,Vb),(0,m.createElementVNode)('span',Eb,(0,m.toDisplayString)(p(e))+'%',1)])]))),128))])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 背景配置 '),(0,m.createElementVNode)('div',Bb,[a[29]||(a[29]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-image'}),(0,m.createTextVNode)(' 背景配置 ')],-1)),(0,m.createElementVNode)('div',Tb,[(0,m.createElementVNode)('div',Sb,[a[27]||(a[27]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 显示背景图片 '),(0,m.createElementVNode)('span',{class:'hint'},'使用全局主题背景')],-1)),(0,m.createElementVNode)('div',Db,[(0,m.createElementVNode)('label',Ab,[(0,m.createElementVNode)('input',{checked:r.value.showBackground,type:'checkbox',onChange:a[6]||(a[6]=e=>(0,m.unref)(n).setShowBackground(e.target.checked))},null,40,zb),a[26]||(a[26]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])])]),a[28]||(a[28]=(0,m.createElementVNode)('div',{class:'acu-settings-row',style:{'justify-content':'flex-start','padding-top':'0','padding-bottom':'8px'}},[(0,m.createElementVNode)('span',{style:{'font-size':'11px',color:'var(--acu-text-sub)'}},[(0,m.createElementVNode)('i',{class:'fas fa-info-circle',style:{'margin-right':'4px'}}),(0,m.createTextVNode)(' 如需更换背景图片，请前往"设置 > 主题配置" ')])],-1))])]),(0,m.createCommentVNode)(' 图例配置 '),(0,m.createElementVNode)('div',Ib,[a[40]||(a[40]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-th-list'}),(0,m.createTextVNode)(' 图例配置 '),(0,m.createElementVNode)('span',{style:{'font-weight':'400','font-size':'11px',color:'var(--acu-text-sub)','margin-left':'auto'}},' 自定义关系颜色 ')],-1)),(0,m.createElementVNode)('div',_b,[(0,m.createCommentVNode)(' 启用自定义图例 '),(0,m.createElementVNode)('div',Mb,[a[31]||(a[31]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 启用自定义图例 '),(0,m.createElementVNode)('span',{class:'hint'},'覆盖默认颜色规则')],-1)),(0,m.createElementVNode)('div',Ub,[(0,m.createElementVNode)('label',Pb,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[7]||(a[7]=e=>l.value.enabled=e),type:'checkbox',onChange:h},null,544),[[m.vModelCheckbox,l.value.enabled]]),a[30]||(a[30]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])])])]),(0,m.createCommentVNode)(' 图例项列表 '),l.value.enabled?((0,m.openBlock)(),(0,m.createElementBlock)('div',$b,[(0,m.createElementVNode)('div',Lb,[a[33]||(a[33]=(0,m.createElementVNode)('span',null,'图例项',-1)),(0,m.createElementVNode)('button',{class:'acu-action-btn acu-action-btn-small',onClick:(0,m.withModifiers)(x,['stop'])},[...a[32]||(a[32]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1),(0,m.createTextVNode)(' 添加 ',-1)])])]),(0,m.createElementVNode)('div',Fb,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(l.value.items,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:'acu-legend-item-row'},[(0,m.createCommentVNode)(' 编辑模式 '),c.value===e.id?((0,m.openBlock)(),(0,m.createElementBlock)('div',jb,[(0,m.createElementVNode)('div',Ob,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[8]||(a[8]=e=>s.label=e),type:'text',placeholder:'名称',class:'acu-legend-input'},null,512),[[m.vModelText,s.label]]),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[9]||(a[9]=e=>s.color=e),type:'color',class:'acu-legend-color-input',title:'颜色'},null,512),[[m.vModelText,s.color]]),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[10]||(a[10]=e=>s.emoji=e),type:'text',placeholder:'Emoji',class:'acu-legend-emoji-input',maxlength:'4'},null,512),[[m.vModelText,s.emoji]])]),(0,m.createElementVNode)('div',Rb,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[11]||(a[11]=e=>s.keywordsStr=e),type:'text',placeholder:'关键词（逗号分隔）',class:'acu-legend-keywords-input'},null,512),[[m.vModelText,s.keywordsStr]])]),(0,m.createElementVNode)('div',Hb,[(0,m.createElementVNode)('button',{class:'acu-action-btn acu-action-btn-small acu-action-btn-primary',onClick:(0,m.withModifiers)(y,['stop'])},[...a[34]||(a[34]=[(0,m.createElementVNode)('i',{class:'fas fa-check'},null,-1)])]),(0,m.createElementVNode)('button',{class:'acu-action-btn acu-action-btn-small',onClick:(0,m.withModifiers)(C,['stop'])},[...a[35]||(a[35]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])])])):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 显示模式 '),(0,m.createElementVNode)('div',Wb,[(0,m.createElementVNode)('span',{class:'acu-legend-color-dot',style:(0,m.normalizeStyle)({backgroundColor:e.color})},null,4),(0,m.createElementVNode)('span',Yb,(0,m.toDisplayString)(e.emoji||''),1),(0,m.createElementVNode)('span',Xb,(0,m.toDisplayString)(e.label),1),(0,m.createElementVNode)('div',Gb,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.keywords.slice(0,3),e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e,class:'acu-legend-keyword-tag'},(0,m.toDisplayString)(e),1))),128)),e.keywords.length>3?((0,m.openBlock)(),(0,m.createElementBlock)('span',qb,' +'+(0,m.toDisplayString)(e.keywords.length-3),1)):(0,m.createCommentVNode)('v-if',!0)])]),(0,m.createElementVNode)('div',Kb,[(0,m.createElementVNode)('button',{class:'acu-legend-action-btn',title:'编辑',onClick:(0,m.withModifiers)(t=>w(e),['stop'])},[...a[36]||(a[36]=[(0,m.createElementVNode)('i',{class:'fas fa-edit'},null,-1)])],8,Jb),(0,m.createElementVNode)('button',{class:'acu-legend-action-btn acu-legend-action-btn-danger',title:'删除',onClick:(0,m.withModifiers)(t=>{return a=e.id,void n.removeLegendItem(a);var a},['stop'])},[...a[37]||(a[37]=[(0,m.createElementVNode)('i',{class:'fas fa-trash'},null,-1)])],8,Zb)])],64))]))),128)),0===l.value.items.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',Qb,[...a[38]||(a[38]=[(0,m.createElementVNode)('span',null,'暂无图例项，点击上方"添加"按钮创建',-1)])])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 重置为默认图例 '),(0,m.createElementVNode)('div',eh,[(0,m.createElementVNode)('button',{class:'acu-action-btn acu-action-btn-secondary acu-action-btn-small',onClick:(0,m.withModifiers)(N,['stop'])},[...a[39]||(a[39]=[(0,m.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,m.createTextVNode)(' 重置为默认图例 ',-1)])])])])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 操作按钮 '),(0,m.createElementVNode)('div',th,[(0,m.createElementVNode)('div',ah,[(0,m.createElementVNode)('div',oh,[(0,m.createElementVNode)('button',{class:'acu-action-btn acu-action-btn-secondary',onClick:(0,m.withModifiers)(b,['stop'])},[...a[41]||(a[41]=[(0,m.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,m.createTextVNode)(' 恢复默认 ',-1)])])])])])])])])):(0,m.createCommentVNode)('v-if',!0)]),_:1}))}}),rh={class:'acu-modal acu-node-config-modal'},ih={class:'acu-modal-header'},lh={class:'acu-modal-title'},ch={class:'acu-modal-body'},sh={class:'acu-settings-section'},dh={class:'acu-settings-group'},uh={class:'acu-char-selector'},ph=['onClick'],mh={class:'acu-node-preview'},fh={class:'acu-node-config-actions'},gh={class:'acu-settings-section'},vh={class:'acu-settings-group'},bh={class:'acu-settings-row'},hh={class:'acu-settings-label'},xh={class:'hint'},wh={class:'acu-settings-control'},yh={class:'acu-settings-row'},kh={class:'acu-settings-control'},Ch={class:'acu-settings-row'},Nh={class:'acu-settings-label'},Vh={class:'hint'},Eh={class:'acu-settings-control'},Bh={class:'acu-settings-row'},Th={class:'acu-settings-control'},Sh={class:'acu-settings-section'},Dh={class:'acu-settings-group'},Ah={class:'acu-settings-row acu-action-row'},zh=(0,m.defineComponent)({__name:'NodeConfigDialog',props:{visible:{type:Boolean,default:!1},nodeId:{default:''},fullName:{default:''},currentLabel:{default:''},selectedIndices:{default:()=>[]}},emits:['close','confirm','reset-to-full-name','style-update'],setup(e,{emit:t}){const a=e,o=t,n=(0,mv.zI)(),r=(0,m.ref)(new Set);function i(){try{const e=(window.parent?.document||document).querySelector('.acu-wrapper');if(e){const t=getComputedStyle(e).getPropertyValue('--acu-text-main').trim();if(t)return t}return'#333333'}catch{return'#333333'}}const l=(0,m.reactive)({size:mv.nD.size??60,borderColor:i(),borderWidth:mv.nD.borderWidth??2,shape:mv.nD.shape??'ellipse'});function c(){const e=n.getNodeStyleOverride(a.nodeId),t=i();e?(l.size=e.size??mv.nD.size??60,l.borderColor=e.borderColor??t,l.borderWidth=e.borderWidth??mv.nD.borderWidth??2,l.shape=e.shape??mv.nD.shape??'ellipse'):(l.size=mv.nD.size??60,l.borderColor=t,l.borderWidth=mv.nD.borderWidth??2,l.shape=mv.nD.shape??'ellipse')}function s(e){return/^[A-Za-z\s'-]+$/.test(e)&&e.includes(' ')}function d(e){return s(e)?e.split(' ').filter(Boolean):e.split('')}(0,m.watch)(()=>a.selectedIndices,e=>{r.value=new Set(e)},{immediate:!0}),(0,m.watch)(()=>a.visible,e=>{e&&(a.selectedIndices.length>0?r.value=new Set(a.selectedIndices):r.value=new Set(function(e){const t=d(e);if(s(e))return[0];return t.length>0?[t.length-1]:[]}(a.fullName)),c())}),(0,m.watch)(()=>a.nodeId,e=>{e&&a.visible&&c()});const u=(0,m.computed)(()=>d(a.fullName)),p=(0,m.computed)(()=>{if(!a.fullName)return'';const e=u.value,t=Array.from(r.value).sort((e,t)=>e-t).map(t=>e[t]).filter(Boolean);return 0===t.length?function(e){if(s(e)){const t=e.split(' ')[0];return t.length>6?t.slice(0,6):t}return e.length>0?e[e.length-1]:e}(a.fullName):s(a.fullName)?t.join(' '):t.join('')});function f(){const e=Array.from(r.value);o('confirm',a.nodeId,p.value,e),o('close')}function g(){o('reset-to-full-name',a.nodeId,a.fullName)}function v(){n.removeNodeStyleOverride(a.nodeId),l.size=mv.nD.size??60,l.borderColor=i(),l.borderWidth=mv.nD.borderWidth??2,l.shape=mv.nD.shape??'ellipse',o('style-update',a.nodeId)}return(0,m.watchEffect)(()=>{a.visible&&a.nodeId&&(n.setNodeStyleOverride(a.nodeId,{size:l.size,borderColor:l.borderColor,borderWidth:l.borderWidth,shape:l.shape}),o('style-update',a.nodeId))}),(t,a)=>((0,m.openBlock)(),(0,m.createBlock)(m.Transition,{name:'modal'},{default:(0,m.withCtx)(()=>[e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container',onClick:(0,m.withModifiers)(f,['self'])},[(0,m.createElementVNode)('div',rh,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',ih,[(0,m.createElementVNode)('span',lh,'节点配置 - '+(0,m.toDisplayString)(e.fullName),1),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(f,['stop'])},'完成')]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',ch,[(0,m.createCommentVNode)(' 显示名称设置 '),(0,m.createElementVNode)('div',sh,[a[5]||(a[5]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-font'}),(0,m.createTextVNode)(' 显示名称 ')],-1)),(0,m.createElementVNode)('div',dh,[a[4]||(a[4]=(0,m.createElementVNode)('p',{class:'acu-node-hint'},'点击选择要显示的字符（可多选）',-1)),(0,m.createElementVNode)('div',uh,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(u.value,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:t,class:(0,m.normalizeClass)(['acu-char-btn',{active:r.value.has(t)}]),onClick:(0,m.withModifiers)(e=>function(e){const t=new Set(r.value);t.has(e)?t.delete(e):t.add(e),r.value=t}(t),['stop'])},(0,m.toDisplayString)(e),11,ph))),128))]),(0,m.createElementVNode)('p',mh,'预览：'+(0,m.toDisplayString)(p.value),1),(0,m.createElementVNode)('div',fh,[(0,m.createElementVNode)('button',{class:'acu-action-btn secondary',onClick:(0,m.withModifiers)(g,['stop'])},'显示全名')])])]),(0,m.createCommentVNode)(' 样式设置 '),(0,m.createElementVNode)('div',gh,[a[11]||(a[11]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-palette'}),(0,m.createTextVNode)(' 节点样式 ')],-1)),(0,m.createElementVNode)('div',vh,[(0,m.createCommentVNode)(' 节点大小 '),(0,m.createElementVNode)('div',bh,[(0,m.createElementVNode)('div',hh,[a[6]||(a[6]=(0,m.createTextVNode)(' 节点大小 ',-1)),(0,m.createElementVNode)('span',xh,(0,m.toDisplayString)(l.size)+'px',1)]),(0,m.createElementVNode)('div',wh,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[0]||(a[0]=e=>l.size=e),type:'range',min:'30',max:'120',step:'5'},null,512),[[m.vModelText,l.size,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 边框颜色 '),(0,m.createElementVNode)('div',yh,[a[7]||(a[7]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 边框颜色 '),(0,m.createElementVNode)('span',{class:'hint'},'头像边框色')],-1)),(0,m.createElementVNode)('div',kh,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[1]||(a[1]=e=>l.borderColor=e),type:'color',class:'acu-dashed',title:'边框颜色'},null,512),[[m.vModelText,l.borderColor]])])]),(0,m.createCommentVNode)(' 边框宽度 '),(0,m.createElementVNode)('div',Ch,[(0,m.createElementVNode)('div',Nh,[a[8]||(a[8]=(0,m.createTextVNode)(' 边框宽度 ',-1)),(0,m.createElementVNode)('span',Vh,(0,m.toDisplayString)(l.borderWidth)+'px',1)]),(0,m.createElementVNode)('div',Eh,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[2]||(a[2]=e=>l.borderWidth=e),type:'range',min:'0',max:'10',step:'0.5'},null,512),[[m.vModelText,l.borderWidth,void 0,{number:!0}]])])]),(0,m.createCommentVNode)(' 节点形状 '),(0,m.createElementVNode)('div',Bh,[a[10]||(a[10]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 头像形状 '),(0,m.createElementVNode)('span',{class:'hint'},'圆角样式')],-1)),(0,m.createElementVNode)('div',Th,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[3]||(a[3]=e=>l.shape=e)},[...a[9]||(a[9]=[(0,m.createElementVNode)('option',{value:'ellipse'},'圆形',-1),(0,m.createElementVNode)('option',{value:'round-rectangle'},'圆角矩形',-1),(0,m.createElementVNode)('option',{value:'rectangle'},'矩形',-1),(0,m.createElementVNode)('option',{value:'hexagon'},'六边形',-1)])],512),[[m.vModelSelect,l.shape]])])])])]),(0,m.createCommentVNode)(' 操作按钮 '),(0,m.createElementVNode)('div',Sh,[(0,m.createElementVNode)('div',Dh,[(0,m.createElementVNode)('div',Ah,[(0,m.createElementVNode)('button',{class:'acu-action-btn acu-action-btn-secondary',onClick:(0,m.withModifiers)(v,['stop'])},[...a[12]||(a[12]=[(0,m.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,m.createTextVNode)(' 重置样式 ',-1)])])])])])])])])):(0,m.createCommentVNode)('v-if',!0)]),_:1}))}});u(1873);const Ih=zh,_h={class:'acu-modal acu-node-config-modal'},Mh={class:'acu-modal-header'},Uh={class:'acu-modal-body'},Ph={class:'acu-node-fullname',style:{'margin-bottom':'8px','font-weight':'600'}},$h={class:'acu-char-selector'},Lh=['onClick'],Fh={class:'acu-node-preview'},jh={class:'acu-node-config-actions'},Oh=(0,m.defineComponent)({__name:'NodeLabelDialog',props:{visible:{type:Boolean,default:!1},fullName:{default:''},initialIndices:{default:()=>[]}},emits:['close','apply','reset'],setup(e,{expose:t,emit:a}){const o=e,n=a,r=(0,m.ref)(new Set);function i(e){return/^[A-Za-z\s'-]+$/.test(e)&&e.includes(' ')}function l(e){return e?i(e)?e.split(' ').filter(Boolean):e.split(''):[]}function c(e){const t=l(e);return i(e)?[0]:t.length>0?[t.length-1]:[]}function s(e){if(i(e)){const t=e.split(' ')[0];return t.length>6?t.slice(0,6):t}return e.length>0?e[e.length-1]:e}const d=(0,m.computed)(()=>l(o.fullName)),u=(0,m.computed)(()=>{if(!o.fullName)return'';const e=d.value,t=Array.from(r.value).sort((e,t)=>e-t).map(t=>e[t]).filter(Boolean);return 0===t.length?s(o.fullName):i(o.fullName)?t.join(' '):t.join('')});function p(){n('apply',{displayLabel:u.value,selectedIndices:Array.from(r.value)}),n('close')}function f(){n('reset'),n('close')}function g(){n('close')}return(0,m.watch)(()=>[o.visible,o.fullName,o.initialIndices],([e])=>{e&&(o.initialIndices&&o.initialIndices.length>0?r.value=new Set(o.initialIndices):r.value=new Set(c(o.fullName)))},{immediate:!0}),t({isEnglishName:i,getDisplayChars:l,getDefaultIndices:c,getDefaultLabel:s}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',style:{'z-index':'2147483647'},onClick:(0,m.withModifiers)(g,['self'])},[(0,m.createElementVNode)('div',_h,[(0,m.createElementVNode)('div',Mh,[a[0]||(a[0]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},'选择显示的字符',-1)),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(g,['stop'])},'取消')]),(0,m.createElementVNode)('div',Uh,[(0,m.createElementVNode)('p',Ph,'全名：'+(0,m.toDisplayString)(e.fullName),1),a[1]||(a[1]=(0,m.createElementVNode)('p',{class:'acu-node-hint'},'点击选择要显示的字符（可多选）',-1)),(0,m.createElementVNode)('div',$h,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(d.value,(e,t)=>((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:t,class:(0,m.normalizeClass)(['acu-char-btn',{active:r.value.has(t)}]),onClick:(0,m.withModifiers)(e=>function(e){const t=new Set(r.value);t.has(e)?t.delete(e):t.add(e),r.value=t}(t),['stop'])},(0,m.toDisplayString)(e),11,Lh))),128))]),(0,m.createElementVNode)('p',Fh,'预览：'+(0,m.toDisplayString)(u.value),1),(0,m.createElementVNode)('div',jh,[(0,m.createElementVNode)('button',{class:'acu-action-btn secondary',onClick:(0,m.withModifiers)(f,['stop'])},'显示全名'),(0,m.createElementVNode)('button',{class:'acu-action-btn primary',onClick:(0,m.withModifiers)(p,['stop'])},'确定')])])])])):(0,m.createCommentVNode)('v-if',!0)}}),Rh={class:'acu-modal acu-row-edit-modal'},Hh={class:'acu-modal-header'},Wh={class:'acu-modal-title'},Yh={class:'acu-modal-body'},Xh={class:'acu-row-edit-content'},Gh=(0,m.defineComponent)({__name:'RowEditDialog',props:{visible:{type:Boolean,default:!1},tableName:{},tableId:{},rowIndex:{},currentRowData:{default:null},titleColIndex:{default:1}},emits:['update:visible','close','showHistory'],setup(e,{emit:t}){const a=e,o=(0,f.JH)(),n=(0,m.computed)(()=>`acu-theme-${o.theme}`),r=t,i=(0,m.computed)(()=>{if(!a.currentRowData)return a.tableName;const e=a.titleColIndex;if(e>=0&&a.currentRowData.cells.length>e){const t=a.currentRowData.cells[e]?.value;if(t)return`${a.tableName} - ${t}`}return`${a.tableName} - 第 ${a.rowIndex+1} 行`});function l(){r('update:visible',!1),r('close')}function c(){l()}function s(){r('showHistory')}return(0,m.watch)(()=>a.visible,e=>{}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:(0,m.normalizeClass)(['acu-modal-container acu-row-edit-modal-container',n.value]),onClick:(0,m.withModifiers)(l,['self'])},[(0,m.createElementVNode)('div',Rh,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',Hh,[(0,m.createCommentVNode)(' 移动端拖动把手 '),a[1]||(a[1]=(0,m.createElementVNode)('div',{class:'acu-drag-handle acu-mobile-only'},null,-1)),(0,m.createElementVNode)('span',Wh,[a[0]||(a[0]=(0,m.createElementVNode)('i',{class:'fas fa-edit'},null,-1)),(0,m.createTextVNode)(' 编辑 - '+(0,m.toDisplayString)(i.value),1)]),(0,m.createCommentVNode)(' PC端在头部显示完成按钮 '),(0,m.createElementVNode)('button',{class:'acu-close-pill acu-pc-only',onClick:(0,m.withModifiers)(c,['stop'])},'完成')]),(0,m.createCommentVNode)(' 内容区 '),(0,m.createElementVNode)('div',Yh,[(0,m.createElementVNode)('div',Xh,[(0,m.createCommentVNode)(' 使用 DataCard 展示和编辑行数据 '),e.currentRowData?((0,m.openBlock)(),(0,m.createBlock)(Lt,{key:0,data:e.currentRowData,'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!0,'show-index':!0,'show-history-button':!0,'title-col-index':e.titleColIndex,onShowHistory:s},null,8,['data','table-name','table-id','title-col-index'])):(0,m.createCommentVNode)('v-if',!0)])]),(0,m.createCommentVNode)(' 底部留白适配移动端安全区 '),a[2]||(a[2]=(0,m.createElementVNode)('div',{class:'acu-bottom-spacer'},null,-1))])],2)):(0,m.createCommentVNode)('v-if',!0)}}),qh={class:'acu-modal acu-widget-actions-modal'},Kh={class:'acu-modal-header'},Jh={class:'acu-modal-body'},Zh={class:'acu-settings-section'},Qh={class:'acu-settings-group'},ex={class:'acu-settings-label'},tx={class:'hint'},ax={class:'acu-settings-control'},ox={class:'acu-switch'},nx=['checked','onChange'],rx={class:'acu-settings-section'},ix={class:'acu-settings-title'},lx={class:'acu-settings-group'},cx={key:0,class:'acu-empty-hint'},sx={key:1,class:'acu-selected-actions-list'},dx={class:'acu-settings-label'},ux={class:'acu-settings-control'},px=['onClick'],mx=(0,m.defineComponent)({__name:'WidgetActionsDialog',props:{visible:{type:Boolean},widgetId:{},currentActions:{default:()=>[]}},emits:['update:visible','close'],setup(e,{emit:t}){const a=e,o=t,n=(0,Ft.f)(),r=(0,m.ref)([]),i=(0,m.computed)(()=>Object.values(jt.bT).filter(e=>'settings'!==e.id&&'goToTable'!==e.id));function l(e){return jt.bT[e]?.icon||'fa-question'}function c(e){return jt.bT[e]?.label||e}function s(){a.widgetId&&n.updateWidget(a.widgetId,{actions:r.value}),o('update:visible',!1),o('close')}return(0,m.watch)(()=>a.visible,e=>{e&&(r.value=a.currentActions.filter(e=>'settings'!==e&&'goToTable'!==e))},{immediate:!0}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(s,['self'])},[(0,m.createElementVNode)('div',qh,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',Kh,[a[0]||(a[0]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},[(0,m.createElementVNode)('i',{class:'fas fa-plus'}),(0,m.createTextVNode)(' 配置快捷按钮 ')],-1)),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(s,['stop'])},'完成')]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',Jh,[(0,m.createElementVNode)('div',Zh,[a[2]||(a[2]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-bolt'}),(0,m.createTextVNode)(' 可用的快捷按钮 ')],-1)),(0,m.createElementVNode)('div',Qh,[(0,m.createCommentVNode)(' 按钮选择列表 - 使用标准设置行布局 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(i.value,e=>{return(0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:'acu-settings-row'},[(0,m.createElementVNode)('div',ex,[(0,m.createElementVNode)('span',null,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',e.icon]),style:{'margin-right':'8px',color:'var(--acu-title-color)'}},null,2),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(e.label),1)]),(0,m.createElementVNode)('span',tx,(0,m.toDisplayString)(e.tooltip),1)]),(0,m.createElementVNode)('div',ax,[(0,m.createCommentVNode)(' 使用标准 acu-switch 开关 '),(0,m.createElementVNode)('label',ox,[(0,m.createElementVNode)('input',{type:'checkbox',checked:(t=e.id,r.value.includes(t)),onChange:t=>function(e){const t=r.value.indexOf(e);t>-1?r.value.splice(t,1):r.value.push(e)}(e.id)},null,40,nx),a[1]||(a[1]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])])]);var t}),128))])]),(0,m.createCommentVNode)(' 已选按钮预览 '),(0,m.createElementVNode)('div',rx,[(0,m.createElementVNode)('div',ix,[a[3]||(a[3]=(0,m.createElementVNode)('i',{class:'fas fa-eye'},null,-1)),(0,m.createTextVNode)(' 已选按钮 ('+(0,m.toDisplayString)(r.value.length)+') ',1)]),(0,m.createElementVNode)('div',lx,[0===r.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',cx,'暂未选择任何快捷按钮')):((0,m.openBlock)(),(0,m.createElementBlock)('div',sx,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(r.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e,class:'acu-settings-row'},[(0,m.createElementVNode)('div',dx,[(0,m.createElementVNode)('span',null,[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',l(e)]),style:{'margin-right':'8px',color:'var(--acu-title-color)'}},null,2),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(c(e)),1)])]),(0,m.createElementVNode)('div',ux,[(0,m.createElementVNode)('button',{class:'acu-tool-btn acu-btn-danger',title:'移除',onClick:(0,m.withModifiers)(t=>function(e){const t=r.value.indexOf(e);t>-1&&r.value.splice(t,1)}(e),['stop'])},[...a[4]||(a[4]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])],8,px)])]))),128))]))])])])])])):(0,m.createCommentVNode)('v-if',!0)}}),fx={ref:'dialogRef',class:'acu-modal acu-widget-settings-modal'},gx={class:'acu-modal-header'},vx={class:'acu-modal-body'},bx={class:'acu-settings-section'},hx={class:'acu-settings-group'},xx={class:'acu-settings-row'},wx={class:'acu-settings-control'},yx=['value'],kx={class:'acu-settings-section'},Cx={class:'acu-settings-group'},Nx={class:'acu-settings-row'},Vx={class:'acu-settings-control'},Ex=['value'],Bx={class:'acu-settings-section'},Tx={class:'acu-settings-group'},Sx={class:'acu-settings-row'},Dx={class:'acu-settings-control'},Ax=['value'],zx={key:0,class:'acu-selected-tags'},Ix=['onClick'],_x={class:'acu-settings-section'},Mx={class:'acu-settings-group'},Ux={class:'acu-settings-label'},Px={key:0,class:'hint'},$x={key:1,class:'hint'},Lx={class:'acu-settings-row'},Fx={class:'acu-settings-control'},jx=(0,m.defineComponent)({__name:'WidgetSettingsDialog',props:{visible:{type:Boolean},widgetId:{},widgetConfig:{default:null},tableHeaders:{default:()=>[]}},emits:['update:visible','close'],setup(e,{emit:t}){const a=e,o=t,n=(0,f.JH)(),r=(0,Ft.f)(),i=(0,k.j_)(),l=(0,m.computed)(()=>g.widgetTagConfig?.displayedTagIds?.length||0),c=(0,m.computed)(()=>g.widgetTagConfig?.displayedCategoryIds?.length||0);function s(){i.openTagManagerDialog({widgetId:a.widgetId,displayedTagIds:g.widgetTagConfig?.displayedTagIds||[],displayedCategoryIds:g.widgetTagConfig?.displayedCategoryIds||[]},(e,t)=>{g.widgetTagConfig={displayedTagIds:e,displayedCategoryIds:t}})}const d=(0,m.ref)(''),u=(0,m.computed)(()=>a.tableHeaders.filter(e=>!g.displayTagColumns.includes(e)));function p(){d.value&&(g.displayTagColumns.push(d.value),d.value='')}const g=(0,m.reactive)({titleColumn:'',displayTagColumns:[],widgetTagConfig:{displayedTagIds:[],displayedCategoryIds:[]},displayStyle:'list'});function v(){o('update:visible',!1),o('close')}return(0,m.watch)(()=>a.visible,e=>{e&&(a.widgetConfig?(g.titleColumn=a.widgetConfig.titleColumn||'',g.displayTagColumns=[...a.widgetConfig.displayTagColumns||[]],g.displayStyle=a.widgetConfig.displayStyle||'list',g.widgetTagConfig={displayedTagIds:[...a.widgetConfig.widgetTagConfig?.displayedTagIds||[]],displayedCategoryIds:[...a.widgetConfig.widgetTagConfig?.displayedCategoryIds||[]]}):(g.titleColumn='',g.displayTagColumns=[],g.displayStyle='list',g.widgetTagConfig={displayedTagIds:[],displayedCategoryIds:[]}))},{immediate:!0}),(0,m.watch)(g,()=>{a.visible&&a.widgetId&&function(){if(!a.widgetId)return;const e=(g.widgetTagConfig.displayedTagIds?.length||0)>0||(g.widgetTagConfig.displayedCategoryIds?.length||0)>0;r.updateWidget(a.widgetId,{titleColumn:g.titleColumn||void 0,displayTagColumns:g.displayTagColumns.length>0?g.displayTagColumns:void 0,widgetTagConfig:e?g.widgetTagConfig:void 0,displayStyle:g.displayStyle})}()},{deep:!0}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(v,['self'])},[(0,m.createElementVNode)('div',fx,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',gx,[a[4]||(a[4]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},[(0,m.createElementVNode)('i',{class:'fas fa-cog'}),(0,m.createTextVNode)(' 组件设置 ')],-1)),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(v,['stop'])},'完成')]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',vx,[(0,m.createCommentVNode)(' 显示风格配置 '),(0,m.createElementVNode)('div',bx,[a[6]||(a[6]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-paint-brush'}),(0,m.createTextVNode)(' 显示风格 ')],-1)),(0,m.createElementVNode)('div',hx,[(0,m.createElementVNode)('div',xx,[a[5]||(a[5]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 组件模板 '),(0,m.createElementVNode)('span',{class:'hint'},'选择组件的展示方式')],-1)),(0,m.createElementVNode)('div',wx,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[0]||(a[0]=e=>g.displayStyle=e),class:'acu-select'},[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)((0,m.unref)(jt.Qo),e=>((0,m.openBlock)(),(0,m.createElementBlock)('option',{key:e.value,value:e.value},(0,m.toDisplayString)(e.label),9,yx))),128))],512),[[m.vModelSelect,g.displayStyle]])])])])]),(0,m.createCommentVNode)(' 行标题配置 '),(0,m.createElementVNode)('div',kx,[a[9]||(a[9]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-heading'}),(0,m.createTextVNode)(' 行标题列 ')],-1)),(0,m.createElementVNode)('div',Cx,[(0,m.createElementVNode)('div',Nx,[a[8]||(a[8]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 标题来源列 '),(0,m.createElementVNode)('span',{class:'hint'},'每行显示的主标题取自哪一列')],-1)),(0,m.createElementVNode)('div',Vx,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[1]||(a[1]=e=>g.titleColumn=e),class:'acu-select'},[a[7]||(a[7]=(0,m.createElementVNode)('option',{value:''},'默认（第一列）',-1)),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(e.tableHeaders,e=>((0,m.openBlock)(),(0,m.createElementBlock)('option',{key:e,value:e},(0,m.toDisplayString)(e),9,Ex))),128))],512),[[m.vModelSelect,g.titleColumn]])])])])]),(0,m.createCommentVNode)(' 展示标签配置 '),(0,m.createElementVNode)('div',Bx,[a[13]||(a[13]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-tags'}),(0,m.createTextVNode)(' 展示标签 ')],-1)),(0,m.createElementVNode)('div',Tx,[(0,m.createElementVNode)('div',Sx,[a[11]||(a[11]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 标签来源列 '),(0,m.createElementVNode)('span',{class:'hint'},'选中的列值将作为徽章显示在行上（纯展示）')],-1)),(0,m.createElementVNode)('div',Dx,[(0,m.withDirectives)((0,m.createElementVNode)('select',{'onUpdate:modelValue':a[2]||(a[2]=e=>d.value=e),class:'acu-select',onChange:p},[a[10]||(a[10]=(0,m.createElementVNode)('option',{value:''},'选择要添加的列...',-1)),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(u.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('option',{key:e,value:e},(0,m.toDisplayString)(e),9,Ax))),128))],544),[[m.vModelSelect,d.value]])])]),(0,m.createCommentVNode)(' 已选择的列标签 '),g.displayTagColumns.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',zx,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(g.displayTagColumns,e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e,class:'acu-selected-tag'},[(0,m.createTextVNode)((0,m.toDisplayString)(e)+' ',1),(0,m.createElementVNode)('button',{class:'acu-tag-remove',onClick:(0,m.withModifiers)(t=>function(e){const t=g.displayTagColumns.indexOf(e);t>-1&&g.displayTagColumns.splice(t,1)}(e),['stop'])},[...a[12]||(a[12]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])],8,Ix)]))),128))])):(0,m.createCommentVNode)('v-if',!0)])]),(0,m.createCommentVNode)(' 互动标签配置入口 '),(0,m.createElementVNode)('div',_x,[a[17]||(a[17]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-bolt'}),(0,m.createTextVNode)(' 互动标签 ')],-1)),(0,m.createElementVNode)('div',Mx,[(0,m.createCommentVNode)(' 导航行：点击打开标签管理器（含已配置预览） '),(0,m.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:(0,m.withModifiers)(s,['stop'])},[(0,m.createElementVNode)('div',Ux,[a[14]||(a[14]=(0,m.createTextVNode)(' 管理互动标签 ',-1)),l.value>0||c.value>0?((0,m.openBlock)(),(0,m.createElementBlock)('span',Px,' 已配置 '+(0,m.toDisplayString)(l.value)+' 个标签，'+(0,m.toDisplayString)(c.value)+' 个分类 ',1)):((0,m.openBlock)(),(0,m.createElementBlock)('span',$x,'点击配置可点击的互动标签'))]),a[15]||(a[15]=(0,m.createElementVNode)('div',{class:'acu-settings-control'},[(0,m.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1))]),(0,m.createCommentVNode)(' 自动存入互动标签 (全局设置) '),(0,m.createElementVNode)('div',Lx,[a[16]||(a[16]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 自动存入互动标签 '),(0,m.createElementVNode)('span',{class:'hint'},'AI 生成交互表格后自动存入标签库 (全局生效)')],-1)),(0,m.createElementVNode)('div',Fx,[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-switch',{active:(0,m.unref)(n).config.autoImportInteractions}]),onClick:a[3]||(a[3]=e=>(0,m.unref)(n).config.autoImportInteractions=!(0,m.unref)(n).config.autoImportInteractions)},null,2)])])])])])],512)])):(0,m.createCommentVNode)('v-if',!0)}});const Ox={class:'tarot-card__inner'},Rx={class:'tarot-card__face tarot-card__back'},Hx={class:'tarot-card__face tarot-card__front'},Wx=(0,m.defineComponent)({__name:'TarotCard',props:{themeId:{default:'wafuku'},isFlipped:{type:Boolean},result:{},cardBackImage:{default:''},peepMode:{type:Boolean,default:!1}},emits:['flip','confirm'],setup(e,{emit:t}){const a=e,o=t,n=(0,m.computed)(()=>{return e=a.themeId,tm[e]||tm.wafuku;var e}),r=(0,m.computed)(()=>a.cardBackImage||n.value.defaultBackImage||''),i=(0,m.ref)(220/385),l=(0,m.computed)(()=>({aspectRatio:`${i.value}`}));function c(e){const t=Math.max(.5,Math.min(1,e));i.value=t}const s=(0,m.computed)(()=>a.result?{luckName:a.result.luck.name,luckColor:a.result.luck.color,dimensions:a.result.dimensions.map(e=>e.value),words:a.result.words,peepMode:a.peepMode}:null);function d(){a.isFlipped?o('confirm'):o('flip')}return(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{class:(0,m.normalizeClass)(['tarot-card',[`tarot-card--theme-${e.themeId}`,{'tarot-card--flipped':e.isFlipped}]]),style:(0,m.normalizeStyle)(l.value),onClick:(0,m.withModifiers)(d,['stop'])},[(0,m.createElementVNode)('div',Ox,[(0,m.createCommentVNode)(' 卡背（初始显示） '),(0,m.createElementVNode)('div',Rx,[((0,m.openBlock)(),(0,m.createBlock)((0,m.resolveDynamicComponent)(n.value.CardBack),{'image-url':r.value,onLoad:c},null,40,['image-url']))]),(0,m.createCommentVNode)(' 卡面（翻转后显示） '),(0,m.createElementVNode)('div',Hx,[s.value?((0,m.openBlock)(),(0,m.createBlock)((0,m.resolveDynamicComponent)(n.value.CardFront),{key:0,'luck-name':s.value.luckName,'luck-color':s.value.luckColor,dimensions:s.value.dimensions,words:s.value.words,'peep-mode':s.value.peepMode},null,8,['luck-name','luck-color','dimensions','words','peep-mode'])):(0,m.createCommentVNode)('v-if',!0)])])],6))}}),Yx={class:'divination-starfield'},Xx={class:'divination-content'},Gx={class:'divination-stage'},qx={class:'divination-footer'},Kx={key:0,class:'divination-hint'},Jx=(0,m.defineComponent)({__name:'DivinationOverlay',props:{visible:{type:Boolean},result:{}},emits:['close','confirm','retry'],setup(e,{emit:t}){const a=e,o=t,n=(0,Ot.E)(),r=((0,f.JH)(),(0,k.j_)()),i=window.parent.document.body,l=(0,m.ref)(!1),c=(0,m.computed)(()=>Array.from({length:50}).map((_,e)=>({id:e,left:100*Math.random()+'%',top:100*Math.random()+'%',size:2*Math.random()+1,delay:5*Math.random(),duration:3*Math.random()+2})));function s(){o('close')}function d(){l.value&&p()}function u(){l.value=!0}function p(){const e=n.config;r.divinationOverlay.isQuickRerollMode?o('confirm','reroll'):e.peepMode?o('confirm','hide'):o('confirm','reveal')}function g(){o('retry')}return(0,m.watch)(()=>a.visible,e=>{e&&('auto'===n.config.flipMode?(l.value=!1,setTimeout(()=>{l.value=!0},500)):l.value=!1)}),(t,a)=>((0,m.openBlock)(),(0,m.createBlock)(m.Teleport,{to:(0,m.unref)(i)},[(0,m.createVNode)(m.Transition,{'enter-active-class':'divination-overlay-enter-active','leave-active-class':'divination-overlay-leave-active'},{default:(0,m.withCtx)(()=>[e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'divination-overlay',style:{zIndex:2147483647},onClick:d},[(0,m.createCommentVNode)(' 噪点纹理层 '),a[4]||(a[4]=(0,m.createElementVNode)('div',{class:'divination-grain'},null,-1)),(0,m.createCommentVNode)(' 动态星空 '),(0,m.createElementVNode)('div',Yx,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(c.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:'divination-star',style:(0,m.normalizeStyle)({left:e.left,top:e.top,width:`${e.size}px`,height:`${e.size}px`,'--duration':`${e.duration}s`,'--delay':`${e.delay}s`})},null,4))),128))]),(0,m.createCommentVNode)(' 流动星云 '),a[5]||(a[5]=(0,m.createElementVNode)('div',{class:'divination-nebula divination-nebula--purple'},null,-1)),a[6]||(a[6]=(0,m.createElementVNode)('div',{class:'divination-nebula divination-nebula--golden'},null,-1)),(0,m.createCommentVNode)(' 中心光晕 '),a[7]||(a[7]=(0,m.createElementVNode)('div',{class:'divination-central-glow'},null,-1)),(0,m.createCommentVNode)(' 神圣几何背景 '),a[8]||(a[8]=(0,m.createElementVNode)('div',{class:'divination-geometry divination-geometry--outer'},[(0,m.createElementVNode)('svg',{viewBox:'0 0 100 100',fill:'none',stroke:'#D4AF37','stroke-width':'0.05'},[(0,m.createElementVNode)('circle',{cx:'50',cy:'50',r:'48'}),(0,m.createElementVNode)('path',{d:'M50 0 L93 75 L6 75 Z',opacity:'0.5'}),(0,m.createElementVNode)('path',{d:'M50 100 L93 25 L6 25 Z',opacity:'0.5'})])],-1)),a[9]||(a[9]=(0,m.createElementVNode)('div',{class:'divination-geometry divination-geometry--inner'},[(0,m.createElementVNode)('svg',{viewBox:'0 0 100 100',fill:'none',stroke:'#C6A664','stroke-width':'0.1'},[(0,m.createElementVNode)('circle',{cx:'50',cy:'50',r:'45','stroke-dasharray':'2 1'}),(0,m.createElementVNode)('circle',{cx:'50',cy:'50',r:'30'}),(0,m.createElementVNode)('rect',{x:'29',y:'29',width:'42',height:'42',transform:'rotate(45 50 50)'}),(0,m.createElementVNode)('rect',{x:'29',y:'29',width:'42',height:'42',transform:'rotate(0 50 50)'})])],-1)),(0,m.createCommentVNode)(' 装饰边框 '),a[10]||(a[10]=(0,m.createElementVNode)('div',{class:'divination-frame'},[(0,m.createElementVNode)('div',{class:'divination-frame__corner divination-frame__corner--tl'}),(0,m.createElementVNode)('div',{class:'divination-frame__corner divination-frame__corner--tr'}),(0,m.createElementVNode)('div',{class:'divination-frame__corner divination-frame__corner--bl'}),(0,m.createElementVNode)('div',{class:'divination-frame__corner divination-frame__corner--br'}),(0,m.createElementVNode)('div',{class:'divination-frame__top-line'}),(0,m.createElementVNode)('div',{class:'divination-frame__bottom-line'})],-1)),(0,m.createCommentVNode)(' 关闭按钮 '),(0,m.createElementVNode)('button',{class:'divination-close',onClick:(0,m.withModifiers)(s,['stop'])},[...a[1]||(a[1]=[(0,m.createElementVNode)('svg',{xmlns:'http://www.w3.org/2000/svg',width:'20',height:'20',viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2','stroke-linecap':'round','stroke-linejoin':'round'},[(0,m.createElementVNode)('path',{d:'M18 6 6 18'}),(0,m.createElementVNode)('path',{d:'m6 6 12 12'})],-1)])]),(0,m.createCommentVNode)(' 内容区域 '),(0,m.createElementVNode)('div',Xx,[(0,m.createCommentVNode)(' 顶部装饰（移除文字，保留装饰元素） '),a[3]||(a[3]=(0,m.createElementVNode)('div',{class:'divination-header'},[(0,m.createElementVNode)('div',{class:'divination-header__title'},[(0,m.createElementVNode)('span',{class:'divination-header__sparkle divination-header__sparkle--static'},[(0,m.createElementVNode)('svg',{xmlns:'http://www.w3.org/2000/svg',width:'32',height:'32',viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'1.5','stroke-linecap':'round','stroke-linejoin':'round'},[(0,m.createElementVNode)('path',{d:'M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z'})])]),(0,m.createElementVNode)('div',{class:'divination-header__divider'})])],-1)),(0,m.createCommentVNode)(' 卡片舞台 '),(0,m.createElementVNode)('div',Gx,[(0,m.createVNode)(Wx,{'is-flipped':l.value,result:e.result,'card-back-image':(0,m.unref)(n).config.cardBackImage,'theme-id':(0,m.unref)(n).config.themeId,'peep-mode':(0,m.unref)(n).config.peepMode,onFlip:u,onConfirm:a[0]||(a[0]=e=>p())},null,8,['is-flipped','result','card-back-image','theme-id','peep-mode'])]),(0,m.createCommentVNode)(' 底部控制区：提示文字和再抽一次按钮共用同一位置 '),(0,m.createElementVNode)('div',qx,[(0,m.createCommentVNode)(' 翻牌前提示 '),l.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 翻牌后显示再抽一次按钮 '),(0,m.createElementVNode)('button',{class:'divination-btn divination-btn--retry',onClick:(0,m.withModifiers)(g,['stop'])},'再抽一次')],2112)):((0,m.openBlock)(),(0,m.createElementBlock)('div',Kx,[...a[2]||(a[2]=[(0,m.createElementVNode)('p',{class:'divination-hint__text'},'点击牌面 揭晓命运',-1)])]))])])])):(0,m.createCommentVNode)('v-if',!0)]),_:1})],8,['to']))}}),Zx={class:'acu-action-bar'},Qx=['title','onClick','onMousedown','onTouchstartPassive'],ew={key:0,class:'secondary-indicator'},tw=['title','onClick'];Boolean,Boolean;u(2720);const aw={key:0,class:'acu-toast'},ow={class:'acu-toast-message'},nw=(0,m.defineComponent)({__name:'Toast',props:{visible:{type:Boolean},message:{}},setup:e=>(t,a)=>((0,m.openBlock)(),(0,m.createBlock)(m.Transition,{name:'toast'},{default:(0,m.withCtx)(()=>[e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',aw,[a[0]||(a[0]=(0,m.createElementVNode)('i',{class:'fas fa-info-circle'},null,-1)),(0,m.createElementVNode)('span',ow,(0,m.toDisplayString)(e.message),1)])):(0,m.createCommentVNode)('v-if',!0)]),_:1}))});u(6146);const rw=['title','onClick'],iw=(0,m.defineComponent)({__name:'TabsPopup',props:{visible:{type:Boolean},tabs:{},activeTab:{},gridColumns:{default:'repeat(auto-fill, minmax(90px, 1fr))'},showDashboard:{type:Boolean,default:!0},showRelationshipGraph:{type:Boolean,default:!1},showOptionsPanel:{type:Boolean,default:!1}},emits:['close','tab-click'],setup(e,{emit:t}){const a=e,o=t,n=(0,y.D)(),r=(0,k.j_)();function i(e){return e===k.H6||e===k.$9||e===k.SC}const l=(0,m.computed)(()=>{const e=r.visibleTabs;if(!e||0===e.length){const e=[];return a.showDashboard&&e.push({id:k.H6,name:'仪表盘',icon:'fas fa-home'}),e.push(...a.tabs),a.showRelationshipGraph&&e.push({id:k.SC,name:'关系图',icon:'fas fa-project-diagram'}),a.showOptionsPanel&&e.push({id:k.$9,name:'选项',icon:'fas fa-sliders-h'}),e}return e.map(e=>{return(t=e)===k.H6?{id:k.H6,name:'仪表盘',icon:'fas fa-home'}:t===k.SC?{id:k.SC,name:'关系图',icon:'fas fa-project-diagram'}:t===k.$9?{id:k.$9,name:'选项',icon:'fas fa-sliders-h'}:a.tabs.find(e=>e.name===t);var t}).filter(e=>!!e&&(!(e.id===k.H6&&!a.showDashboard)&&(!(e.id===k.SC&&!a.showRelationshipGraph)&&!(e.id===k.$9&&!a.showOptionsPanel))))});function c(e){return n.hasTableIssues(e)}return(t,a)=>((0,m.openBlock)(),(0,m.createBlock)(m.Transition,{name:'hidden-popup'},{default:(0,m.withCtx)(()=>[e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-tabs-popup',onClick:a[0]||(a[0]=(0,m.withModifiers)(()=>{},['stop']))},[(0,m.createElementVNode)('div',{class:'popup-tabs-grid',style:(0,m.normalizeStyle)({'--acu-nav-cols':e.gridColumns})},[(0,m.createCommentVNode)(' 统一 Tab 列表（已过滤和排序） '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(l.value,t=>{return(0,m.openBlock)(),(0,m.createElementBlock)('button',{key:t.id,class:(0,m.normalizeClass)(['acu-nav-btn',{active:e.activeTab===t.id,'has-issues':!i(t.id)&&c(t.name),'has-ai-changes':!i(t.id)&&!c(t.name)&&(a=t.name,n.hasTableAiChanges(a))}]),title:t.name,onClick:(0,m.withModifiers)(e=>{return a=t.id,o('tab-click',a),void o('close');var a},['stop'])},[t.icon?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(t.icon)},null,2)):(0,m.createCommentVNode)('v-if',!0),(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(t.name),1)],10,rw);var a}),128))],4)])):(0,m.createCommentVNode)('v-if',!0)]),_:1}))}});u(402);const lw=(0,et.A)(iw,[['__scopeId','data-v-ba4c37fe']]),cw={class:'acu-modal acu-prompt-editor-modal'},sw={class:'acu-modal-header'},dw={class:'acu-modal-body'},uw={class:'acu-settings-section'},pw={class:'acu-settings-group'},mw={class:'acu-settings-row',style:{'flex-direction':'column','align-items':'flex-start'}},fw={class:'acu-modal-footer'},gw=(0,m.defineComponent)({__name:'PromptEditorDialog',props:{visible:{type:Boolean},prompt:{}},emits:['close','save'],setup(e,{emit:t}){const a=e,o=t,n=(0,k.j_)(),r=(0,f.JH)(),i=(0,O.d)(),l=(0,m.ref)(''),c=window.parent.document.body;function s(){o('close')}function d(){l.value='',i.info('提示词已清空（需点击保存生效）')}function u(){o('save',l.value),i.success('隐藏提示词已保存'),s()}return(0,m.watch)(()=>[a.visible,a.prompt],([e,t])=>{e&&(l.value=t||'')},{immediate:!0}),(t,a)=>((0,m.openBlock)(),(0,m.createBlock)(m.Teleport,{to:(0,m.unref)(c)},[(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(`acu-theme-${(0,m.unref)(r).config.theme}`)},[(0,m.createVNode)(m.Transition,{name:'modal'},{default:(0,m.withCtx)(()=>[e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:(0,m.normalizeClass)(['acu-modal-container',{'acu-center-modal':(0,m.unref)(n).isMobile}]),onClick:(0,m.withModifiers)(s,['self'])},[(0,m.createElementVNode)('div',cw,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',sw,[a[1]||(a[1]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},[(0,m.createElementVNode)('i',{class:'fas fa-eye-slash'}),(0,m.createTextVNode)(' 隐藏提示词 ')],-1)),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(s,['stop'])},'关闭')]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',dw,[(0,m.createElementVNode)('div',uw,[a[3]||(a[3]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-edit'}),(0,m.createTextVNode)(' 编辑提示词 ')],-1)),(0,m.createElementVNode)('div',pw,[(0,m.createElementVNode)('div',mw,[a[2]||(a[2]=(0,m.createElementVNode)('div',{class:'acu-settings-label',style:{'margin-bottom':'8px'}},[(0,m.createTextVNode)(' 提示词内容 '),(0,m.createElementVNode)('span',{class:'hint'},'发送消息时会自动注入到用户输入之前')],-1)),(0,m.withDirectives)((0,m.createElementVNode)('textarea',{'onUpdate:modelValue':a[0]||(a[0]=e=>l.value=e),class:'acu-textarea-scrollable',style:{width:'100%',height:'150px'},placeholder:'输入要隐藏的提示词...'},null,512),[[m.vModelText,l.value]])])])])]),(0,m.createCommentVNode)(' 底部按钮 '),(0,m.createElementVNode)('div',fw,[(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:(0,m.withModifiers)(d,['stop'])},'清空'),(0,m.createElementVNode)('button',{class:'acu-modal-btn primary',onClick:(0,m.withModifiers)(u,['stop'])},'保存')])])],2)):(0,m.createCommentVNode)('v-if',!0)]),_:1})],2)],8,['to']))}}),vw=gw,bw=['onClick','onMouseenter','onTouchstartPassive'],hw={class:'acu-badge-label'},xw={key:0,class:'acu-badge-icon'},ww={key:0,class:'fas fa-check added-icon'},yw={key:1,class:'fas fa-plus add-icon'},kw={key:1,class:'acu-badge-icon tap-icon'},Cw={key:2,class:'acu-badge-delete'},Nw={key:0,class:'acu-grid-empty'},Vw=(0,m.defineComponent)({__name:'TagBadgeGrid',props:{mode:{},displayedTagIds:{default:()=>[]}},emits:['tagClick','createTag','deleteTag','addTag'],setup(e,{emit:t}){const a=e,o=t,n=(0,Ht.A)(),r=(0,k.j_)(),i=(0,m.computed)(()=>n.filteredTags),l=(0,m.computed)(()=>n.selectedTagIds),c=(0,m.computed)(()=>new Set(a.displayedTagIds)),s=(0,m.computed)(()=>r.tagPreviewMode),d=(0,m.computed)(()=>{if(n.searchKeyword)return'未找到匹配的标签';if('uncategorized'===n.activeCategoryId)return'暂无未分类的标签';if(n.activeCategoryId){const e=n.getCategoryById(n.activeCategoryId);return`"${e?.path||'未知分类'}" 分类下暂无标签`}return'暂无标签，点击新建按钮创建'});function u(e){var t;if(!s.value)switch(a.mode){case'normal':case'create':o('tagClick',e);break;case'add':o('addTag',e.id);break;case'delete':o('deleteTag',e.id);break;case'migrate':case'export':t=e.id,n.toggleTagSelection(t)}}function p(){'create'===a.mode&&o('createTag')}function f(){r.hideTagPreviewTooltip()}function g(){s.value&&r.hideTagPreviewTooltip()}return(t,a)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{class:'acu-tag-grid',onClick:p},[(0,m.createCommentVNode)(' 标签列表 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(i.value,t=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t.id,class:(0,m.normalizeClass)(['acu-tag-badge',{selected:l.value.has(t.id),added:c.value.has(t.id),'mode-add':'add'===e.mode,'mode-delete':'delete'===e.mode,'mode-preview':s.value}]),onClick:(0,m.withModifiers)(e=>u(t),['stop']),onMouseenter:e=>function(e,t){if(!e.promptTemplate)return;const a=t.currentTarget.getBoundingClientRect();r.showTagPreviewTooltip(e.promptTemplate,a.left+a.width/2,a.top)}(t,e),onMouseleave:f,onTouchstartPassive:e=>function(e,t){if(!s.value)return;if(!e.promptTemplate)return;const a=t.touches[0];a&&r.showTagPreviewTooltip(e.promptTemplate,a.clientX,a.clientY)}(t,e),onTouchend:g,onTouchcancel:g},[(0,m.createCommentVNode)(' 标签文本 '),(0,m.createElementVNode)('span',hw,(0,m.toDisplayString)(t.label),1),(0,m.createCommentVNode)(' 添加模式：已添加显示✓，未添加显示+ '),'add'===e.mode?((0,m.openBlock)(),(0,m.createElementBlock)('span',xw,[c.value.has(t.id)?((0,m.openBlock)(),(0,m.createElementBlock)('i',ww)):((0,m.openBlock)(),(0,m.createElementBlock)('i',yw))])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 迁移/导出模式：手指点击图标 '),'migrate'===e.mode||'export'===e.mode?((0,m.openBlock)(),(0,m.createElementBlock)('span',kw,[...a[0]||(a[0]=[(0,m.createElementVNode)('i',{class:'fas fa-hand-pointer'},null,-1)])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 删除模式：删除图标（常驻） '),'delete'===e.mode?((0,m.openBlock)(),(0,m.createElementBlock)('span',Cw,[...a[1]||(a[1]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])):(0,m.createCommentVNode)('v-if',!0)],42,bw))),128)),(0,m.createCommentVNode)(' 空状态 '),0===i.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',Nw,[a[2]||(a[2]=(0,m.createElementVNode)('i',{class:'fas fa-tag'},null,-1)),(0,m.createElementVNode)('span',null,(0,m.toDisplayString)(d.value),1)])):(0,m.createCommentVNode)('v-if',!0)]))}}),Ew={class:'acu-tree-icon'},Bw={key:1},Tw={class:'acu-tree-count'},Sw={key:0,class:'acu-root-icon-editor'},Dw={class:'acu-tree-count'},Aw={key:1,class:'acu-tree-divider'},zw=['data-category-id','onClick'],Iw=['onClick'],_w={key:1,class:'acu-tree-toggle-placeholder'},Mw={key:2,class:'acu-tree-icon'},Uw={key:1},Pw={class:'acu-tree-label'},$w={class:'acu-tree-count'},Lw=['onClick'],Fw=['onClick'],jw=['onClick'],Ow=['onClick'],Rw={key:2,class:'acu-tree-empty'},Hw='acu_tag_library_root_icon',Ww=(0,m.defineComponent)({__name:'TagCategoryTree',props:{mode:{}},emits:['categoryClick','addCategory','migrateToCategory','deleteCategory'],setup(e,{emit:t}){const a=e,o=t,n=(0,Ht.A)(),r=((0,k.j_)(),(0,m.ref)(null)),i=(0,m.ref)(new Set),l=(0,m.ref)(null),c=(0,m.ref)(!1),s=(0,m.ref)(''),d=(0,m.ref)(localStorage.getItem(Hw)||'📂'),u=(0,m.computed)(()=>n.activeCategoryId),p=(0,m.computed)(()=>n.totalTags);function f(e,t){if(!u.value||'uncategorized'===u.value)return!1;if(u.value===e)return!0;const a=n.getCategoryById(u.value);return!!a&&t.startsWith(a.path+'/')}const g=(0,m.computed)(()=>n.uncategorizedCount),v=(0,m.computed)(()=>n.selectedCategoryIds),b=(0,m.computed)(()=>n.selectionType),h=(0,m.computed)(()=>{const e=[],t=n.library.categories,a=new Map;t.forEach(e=>{a.set(e.path,e)});const o=t.filter(e=>!e.path.includes('/')),r=new Map;function l(e,t){const a=r.get(e.path)||0,o=r.get(t.path)||0;return a!==o?a-o:e.path.localeCompare(t.path,'zh-CN')}t.forEach(e=>{const t=e.path.lastIndexOf('/');if(-1!==t){const a=e.path.slice(0,t);r.set(a,(r.get(a)||0)+1)}});function c(o,r,s){const d=a.get(o);if(!d)return;const u=t.filter(e=>{if(!e.path.startsWith(o+'/'))return!1;return!e.path.slice(o.length+1).includes('/')}),p=o.split('/');e.push({id:d.id,name:p[p.length-1],level1:p[0],path:d.path,icon:d.icon,depth:r,hasChildren:u.length>0,tagCount:n.getCategoryTagCount(d.id),parentId:s}),i.value.has(d.id)&&u.sort(l).forEach(e=>{c(e.path,r+1,d.id)})}return o.sort(l).forEach(e=>{c(e.path,0)}),e});function x(e){return e.startsWith('fa')||e.includes(' fa-')}function w(){s.value&&(d.value=s.value,localStorage.setItem(Hw,s.value),s.value='',c.value=!1)}function y(){n.selectCategory(''),o('categoryClick',null)}function C(){n.selectCategory('uncategorized'),o('categoryClick',null)}function N(e){o('migrateToCategory',e)}function V(e){const t=e.target,a=t.querySelectorAll('.acu-tag-tree-item'),o=t.getBoundingClientRect().top;let n=null;for(let e=0;e<a.length;e++){const t=a[e];if(!(t.getBoundingClientRect().top<o+10))break;n=t}if(!n)return void(l.value=null);const r=n.dataset.categoryId;if(!r)return void(l.value=null);const c=h.value.find(e=>e.id===r);c?c.hasChildren&&i.value.has(c.id)?l.value=c.id:c.parentId&&i.value.has(c.parentId)?l.value=c.parentId:l.value=null:l.value=null}return(0,m.watch)(()=>a.mode,e=>{'migrate'!==e&&n.clearSelection()}),(t,k)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{ref_key:'treeContainer',ref:r,class:'acu-tag-tree',onScroll:V},[(0,m.createCommentVNode)(' 根目录（原"全部"） '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-tag-tree-item acu-root-item',{active:''===u.value,'migrate-target':'migrate'===e.mode}]),onClick:y},[(0,m.createElementVNode)('span',Ew,[x(d.value)?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(d.value)},null,2)):((0,m.openBlock)(),(0,m.createElementBlock)('span',Bw,(0,m.toDisplayString)(d.value),1))]),k[11]||(k[11]=(0,m.createElementVNode)('span',{class:'acu-tree-label'},'根目录',-1)),(0,m.createElementVNode)('span',Tw,'('+(0,m.toDisplayString)(p.value)+')',1),(0,m.createCommentVNode)(' 添加模式：添加按钮 '),'add'===e.mode?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-add-btn',title:'添加根目录到展示区',onClick:k[0]||(k[0]=(0,m.withModifiers)(e=>o('addCategory','root'),['stop']))},[...k[7]||(k[7]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 迁移模式：迁入按钮（将分类迁移到根级=变成一级分类） '),'migrate'===e.mode&&'category'===b.value?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:1,class:'acu-migrate-btn',title:'迁入到根目录（变成一级分类）',onClick:k[1]||(k[1]=(0,m.withModifiers)(e=>N('root'),['stop']))},[...k[8]||(k[8]=[(0,m.createElementVNode)('i',{class:'fas fa-sign-in-alt'},null,-1)])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 删除模式：清空按钮 '),'delete'===e.mode?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:2,class:'acu-delete-btn',title:'清空所有标签和分类',onClick:k[2]||(k[2]=(0,m.withModifiers)(e=>o('deleteCategory','root'),['stop']))},[...k[9]||(k[9]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 编辑图标按钮（普通模式） '),'normal'===e.mode?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:3,class:'acu-edit-icon-btn',title:'修改图标',onClick:k[3]||(k[3]=(0,m.withModifiers)(e=>c.value=!c.value,['stop']))},[...k[10]||(k[10]=[(0,m.createElementVNode)('i',{class:'fas fa-palette'},null,-1)])])):(0,m.createCommentVNode)('v-if',!0)],2),(0,m.createCommentVNode)(' 根目录图标编辑器 '),c.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Sw,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':k[4]||(k[4]=e=>s.value=e),type:'text',class:'acu-icon-input',placeholder:'输入emoji',maxlength:'2',onKeyup:(0,m.withKeys)(w,['enter'])},null,544),[[m.vModelText,s.value]]),(0,m.createElementVNode)('button',{class:'acu-btn-small',onClick:(0,m.withModifiers)(w,['stop'])},[...k[12]||(k[12]=[(0,m.createElementVNode)('i',{class:'fas fa-check'},null,-1)])]),(0,m.createElementVNode)('button',{class:'acu-btn-small',onClick:k[5]||(k[5]=(0,m.withModifiers)(e=>c.value=!1,['stop']))},[...k[13]||(k[13]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 未分类 '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-tag-tree-item',{active:'uncategorized'===u.value,'migrate-target':'migrate'===e.mode&&'tag'===b.value}]),onClick:C},[k[15]||(k[15]=(0,m.createElementVNode)('span',{class:'acu-tree-icon'},'📦',-1)),k[16]||(k[16]=(0,m.createElementVNode)('span',{class:'acu-tree-label'},'未分类',-1)),(0,m.createElementVNode)('span',Dw,'('+(0,m.toDisplayString)(g.value)+')',1),(0,m.createCommentVNode)(' 迁移模式：迁入按钮 '),'migrate'===e.mode&&'tag'===b.value?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-migrate-btn',title:'迁入此分类',onClick:k[6]||(k[6]=(0,m.withModifiers)(e=>N(''),['stop']))},[...k[14]||(k[14]=[(0,m.createElementVNode)('i',{class:'fas fa-sign-in-alt'},null,-1)])])):(0,m.createCommentVNode)('v-if',!0)],2),(0,m.createCommentVNode)(' 分隔线 '),h.value.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',Aw)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 自定义分类 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(h.value,t=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:t.id,class:(0,m.normalizeClass)(['acu-tag-tree-item',{active:f(t.id,t.path),expanded:i.value.has(t.id),sticky:l.value===t.id,selected:v.value.has(t.id),'migrate-target':'migrate'===e.mode}]),'data-category-id':t.id,onClick:e=>function(e){if('migrate'===a.mode&&'category'===n.selectionType)return void n.toggleCategorySelection(e.id);const t=u.value===e.id;if(n.selectCategory(e.id),e.hasChildren){let a=!1;i.value.has(e.id)?t&&(i.value.delete(e.id),a=!0):(i.value.add(e.id),a=!0),a&&(i.value=new Set(i.value))}o('categoryClick',n.getCategoryById(e.id)||null)}(t)},[(0,m.createCommentVNode)(' 展开/折叠按钮 '),t.hasChildren?((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:0,class:'acu-tree-toggle',onClick:(0,m.withModifiers)(e=>{return a=t.id,i.value.has(a)?i.value.delete(a):i.value.add(a),void(i.value=new Set(i.value));var a},['stop'])},(0,m.toDisplayString)(i.value.has(t.id)?'▼':'▶'),9,Iw)):((0,m.openBlock)(),(0,m.createElementBlock)('span',_w)),(0,m.createCommentVNode)(' 图标 '),t.icon?((0,m.openBlock)(),(0,m.createElementBlock)('span',Mw,[x(t.icon)?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(t.icon)},null,2)):((0,m.openBlock)(),(0,m.createElementBlock)('span',Uw,(0,m.toDisplayString)(t.icon),1))])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 名称 '),(0,m.createElementVNode)('span',Pw,(0,m.toDisplayString)(t.name),1),(0,m.createCommentVNode)(' 计数 '),(0,m.createElementVNode)('span',$w,'('+(0,m.toDisplayString)(t.tagCount)+')',1),(0,m.createCommentVNode)(' 添加模式：添加按钮（常驻） '),'add'===e.mode?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:3,class:'acu-add-btn',title:'添加到展示区',onClick:(0,m.withModifiers)(e=>{return a=t.id,void o('addCategory',a);var a},['stop'])},[...k[17]||(k[17]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])],8,Lw)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 迁移模式：选中按钮 + 迁入按钮 '),'migrate'===e.mode?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:4},[(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-select-btn',{active:v.value.has(t.id)}]),title:'选中此分类',onClick:(0,m.withModifiers)(e=>{return a=t.id,void n.toggleCategorySelection(a);var a},['stop'])},[(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(v.value.has(t.id)?'fas fa-check-square':'far fa-square')},null,2)],10,Fw),(0,m.createElementVNode)('button',{class:'acu-migrate-btn',title:'迁入到此分类',onClick:(0,m.withModifiers)(e=>N(t.id),['stop'])},[...k[18]||(k[18]=[(0,m.createElementVNode)('i',{class:'fas fa-sign-in-alt'},null,-1)])],8,jw)],64)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 删除模式：删除按钮 '),'delete'===e.mode?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:5,class:'acu-delete-btn',title:'删除分类',onClick:(0,m.withModifiers)(e=>{return a=t.id,void o('deleteCategory',a);var a},['stop'])},[...k[19]||(k[19]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])],8,Ow)):(0,m.createCommentVNode)('v-if',!0)],10,zw))),128)),(0,m.createCommentVNode)(' 空状态 '),0===h.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',Rw,[...k[20]||(k[20]=[(0,m.createElementVNode)('i',{class:'fas fa-folder-open'},null,-1),(0,m.createElementVNode)('span',null,'暂无自定义分类',-1)])])):(0,m.createCommentVNode)('v-if',!0)],544))}}),Yw={class:'acu-modal acu-tag-edit-modal'},Xw={class:'acu-modal-header'},Gw={class:'acu-modal-title'},qw={class:'acu-header-actions'},Kw=['disabled'],Jw={class:'acu-modal-body'},Zw={class:'acu-settings-section'},Qw={class:'acu-settings-group'},ey={class:'acu-settings-row'},ty={class:'acu-settings-control'},ay={class:'acu-settings-row acu-category-row'},oy={class:'acu-settings-control acu-category-control'},ny={class:'selected-value'},ry={key:1},iy={class:'text'},ly={key:1,class:'placeholder'},cy={key:0,class:'acu-custom-dropdown-menu'},sy=['onClick'],dy={key:1},uy={class:'text'},py={class:'acu-settings-row'},my={class:'acu-settings-control'},fy={class:'selected-value'},gy={key:1},vy={class:'text'},by={key:1,class:'placeholder'},hy={key:0,class:'acu-custom-dropdown-menu'},xy=['onClick'],wy={key:1},yy={class:'text'},ky={class:'acu-settings-row acu-new-category-row'},Cy={class:'acu-settings-control acu-new-category-control'},Ny={key:1},Vy={class:'acu-settings-row'},Ey={class:'acu-settings-control'},By={class:'acu-switch'},Ty={class:'acu-settings-section'},Sy={class:'acu-settings-group'},Dy={class:'acu-settings-row column'},Ay={class:'acu-settings-control'},zy={class:'acu-wildcard-shortcuts'},Iy=['textContent'],_y=['textContent'],My=['textContent'],Uy={class:'acu-wildcard-help'},Py={key:0},$y=['textContent'],Ly=['textContent'],Fy=['textContent'],jy=(0,m.defineComponent)({__name:'TagEditDialog',props:{visible:{type:Boolean},tag:{},defaultCategoryId:{default:''}},emits:['update:visible','saved','close'],setup(e,{emit:t}){const a=e,o=t,n=(0,Ht.A)(),r=(0,k.j_)(),i=(0,m.ref)(null),l=(0,m.ref)(null),c=(0,m.ref)({label:'',categoryId:'',promptTemplate:'',allowPreEdit:!1}),s=(0,m.ref)(!1),d=(0,m.ref)(''),u=(0,m.ref)(''),p=(0,m.ref)(!0),f=(0,m.ref)(!1),g=(0,m.ref)(!1),v=(0,m.ref)(''),b='{{value}}',h='{{rowTitle}}',x='{{user}}',w=(0,m.computed)(()=>!a.tag),y=(0,m.computed)(()=>n.library.categories),C=(0,m.computed)(()=>c.value.label.trim().length>0),N=(0,m.computed)(()=>c.value.categoryId&&y.value.find(e=>e.id===c.value.categoryId)||null),V=(0,m.computed)(()=>v.value&&y.value.find(e=>e.id===v.value)||null);function E(){o('update:visible',!1),o('close')}function B(){if(!C.value)return;const e={id:a.tag?.id||`tag_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,label:c.value.label.trim(),categoryId:c.value.categoryId,promptTemplate:c.value.promptTemplate,createdAt:a.tag?.createdAt||(new Date).toISOString(),allowPreEdit:c.value.allowPreEdit};n.upsertTag(e),o('saved',e),E()}function T(e){if(!l.value)return;const t=l.value,a=t.selectionStart,o=t.selectionEnd,n=c.value.promptTemplate;c.value.promptTemplate=n.slice(0,a)+e+n.slice(o),(0,m.nextTick)(()=>{t.focus(),t.setSelectionRange(a+e.length,a+e.length)})}function S(){let e=d.value.trim();if(!e)return;V.value&&(e=V.value.path+'/'+e);const t=n.addCategory(e,u.value||void 0);c.value.categoryId=t.id,s.value=!1,d.value='',u.value='',v.value=''}function D(){r.openIconSelectDialog({currentIcon:u.value},{onSelect:e=>{u.value=e}})}function A(e){return e.startsWith('fa')||e.includes(' fa-')}function I(){f.value=!f.value}function M(e){c.value.categoryId=e,f.value=!1}function U(){g.value=!g.value}function P(e){v.value=e,g.value=!1}function L(){f.value=!1,g.value=!1}return(0,m.watch)(()=>a.visible,e=>{e&&(a.tag?c.value={label:a.tag.label,categoryId:a.tag.categoryId,promptTemplate:a.tag.promptTemplate,allowPreEdit:a.tag.allowPreEdit||!1}:c.value={label:'',categoryId:a.defaultCategoryId,promptTemplate:'',allowPreEdit:!1},s.value=!1,d.value='',u.value='',f.value=!1,g.value=!1,v.value='')}),(0,m.watch)([f,g],([e,t])=>{e||t?setTimeout(()=>window.addEventListener('click',L),0):window.removeEventListener('click',L)}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(E,['self'])},[(0,m.createElementVNode)('div',Yw,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',Xw,[(0,m.createElementVNode)('span',Gw,(0,m.toDisplayString)(w.value?'新建标签':'编辑标签'),1),(0,m.createElementVNode)('div',qw,[(0,m.createElementVNode)('button',{class:'acu-close-pill',disabled:!C.value,onClick:(0,m.withModifiers)(B,['stop'])},'保存',8,Kw),(0,m.createElementVNode)('button',{class:'acu-icon-btn',title:'关闭',onClick:(0,m.withModifiers)(E,['stop'])},[...a[12]||(a[12]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])])]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',Jw,[(0,m.createCommentVNode)(' 标签文本 '),(0,m.createElementVNode)('div',Zw,[a[26]||(a[26]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-tag'}),(0,m.createTextVNode)(' 基本信息 ')],-1)),(0,m.createElementVNode)('div',Qw,[(0,m.createCommentVNode)(' 标签文本 '),(0,m.createElementVNode)('div',ey,[a[13]||(a[13]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 标签文本 '),(0,m.createElementVNode)('span',{class:'hint'},'标签显示的文字内容')],-1)),(0,m.createElementVNode)('div',ty,[(0,m.withDirectives)((0,m.createElementVNode)('input',{ref_key:'labelInput',ref:i,'onUpdate:modelValue':a[0]||(a[0]=e=>c.value.label=e),type:'text',placeholder:'输入标签文本'},null,512),[[m.vModelText,c.value.label]])])]),(0,m.createCommentVNode)(' 分类选择 '),(0,m.createElementVNode)('div',ay,[a[17]||(a[17]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 所属分类 '),(0,m.createElementVNode)('span',{class:'hint'},'选择或创建分类')],-1)),(0,m.createElementVNode)('div',oy,[(0,m.createCommentVNode)(' 自定义下拉框 '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-custom-select',{active:f.value}]),onClick:(0,m.withModifiers)(I,['stop'])},[(0,m.createElementVNode)('div',ny,[N.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[A(N.value.icon||'')?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(N.value.icon)},null,2)):N.value.icon?((0,m.openBlock)(),(0,m.createElementBlock)('span',ry,(0,m.toDisplayString)(N.value.icon),1)):(0,m.createCommentVNode)('v-if',!0),(0,m.createElementVNode)('span',iy,(0,m.toDisplayString)(N.value.path),1)],64)):((0,m.openBlock)(),(0,m.createElementBlock)('span',ly,'未分类'))]),a[15]||(a[15]=(0,m.createElementVNode)('i',{class:'fas fa-chevron-down arrow'},null,-1)),(0,m.createCommentVNode)(' 下拉菜单 '),f.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',cy,[(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['dropdown-item',{selected:''===c.value.categoryId}]),onClick:a[1]||(a[1]=(0,m.withModifiers)(e=>M(''),['stop']))},[...a[14]||(a[14]=[(0,m.createElementVNode)('span',{class:'text'},'未分类',-1)])],2),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(y.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:(0,m.normalizeClass)(['dropdown-item',{selected:c.value.categoryId===e.id}]),onClick:(0,m.withModifiers)(t=>M(e.id),['stop'])},[A(e.icon||'')?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(e.icon)},null,2)):e.icon?((0,m.openBlock)(),(0,m.createElementBlock)('span',dy,(0,m.toDisplayString)(e.icon),1)):(0,m.createCommentVNode)('v-if',!0),(0,m.createElementVNode)('span',uy,(0,m.toDisplayString)(e.path),1)],10,sy))),128))])):(0,m.createCommentVNode)('v-if',!0)],2),(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'新增分类',onClick:a[2]||(a[2]=(0,m.withModifiers)(e=>s.value=!0,['stop']))},[...a[16]||(a[16]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])])])]),(0,m.createCommentVNode)(' 新增分类输入（条件显示） '),s.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[(0,m.createCommentVNode)(' 上级分类选择 '),(0,m.createElementVNode)('div',py,[a[20]||(a[20]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 上级分类 '),(0,m.createElementVNode)('span',{class:'hint'},'可选：在此分类下创建子分类')],-1)),(0,m.createElementVNode)('div',my,[(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-custom-select',{active:g.value}]),onClick:(0,m.withModifiers)(U,['stop'])},[(0,m.createElementVNode)('div',fy,[V.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[A(V.value.icon||'')?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(V.value.icon)},null,2)):V.value.icon?((0,m.openBlock)(),(0,m.createElementBlock)('span',gy,(0,m.toDisplayString)(V.value.icon),1)):(0,m.createCommentVNode)('v-if',!0),(0,m.createElementVNode)('span',vy,(0,m.toDisplayString)(V.value.path),1)],64)):((0,m.openBlock)(),(0,m.createElementBlock)('span',by,'无'))]),a[19]||(a[19]=(0,m.createElementVNode)('i',{class:'fas fa-chevron-down arrow'},null,-1)),g.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',hy,[(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['dropdown-item',{selected:''===v.value}]),onClick:a[3]||(a[3]=(0,m.withModifiers)(e=>P(''),['stop']))},[...a[18]||(a[18]=[(0,m.createElementVNode)('span',{class:'text'},'无',-1)])],2),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(y.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:(0,m.normalizeClass)(['dropdown-item',{selected:v.value===e.id}]),onClick:(0,m.withModifiers)(t=>P(e.id),['stop'])},[A(e.icon||'')?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(e.icon)},null,2)):e.icon?((0,m.openBlock)(),(0,m.createElementBlock)('span',wy,(0,m.toDisplayString)(e.icon),1)):(0,m.createCommentVNode)('v-if',!0),(0,m.createElementVNode)('span',yy,(0,m.toDisplayString)(e.path),1)],10,xy))),128))])):(0,m.createCommentVNode)('v-if',!0)],2)])]),(0,m.createElementVNode)('div',ky,[a[23]||(a[23]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 新分类 '),(0,m.createElementVNode)('span',{class:'hint'},'路径格式如：互动/日常')],-1)),(0,m.createElementVNode)('div',Cy,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[4]||(a[4]=e=>d.value=e),type:'text',placeholder:'分类路径',onKeyup:(0,m.withKeys)(S,['enter'])},null,544),[[m.vModelText,d.value]]),(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'选择图标',onClick:(0,m.withModifiers)(D,['stop'])},[A(u.value)?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(u.value)},null,2)):((0,m.openBlock)(),(0,m.createElementBlock)('span',Ny,(0,m.toDisplayString)(u.value||'图标'),1))]),(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'确认',onClick:(0,m.withModifiers)(S,['stop'])},[...a[21]||(a[21]=[(0,m.createElementVNode)('i',{class:'fas fa-check'},null,-1)])]),(0,m.createElementVNode)('button',{class:'acu-tool-btn',title:'取消',onClick:a[5]||(a[5]=(0,m.withModifiers)(e=>s.value=!1,['stop']))},[...a[22]||(a[22]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])])])],64)):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 二次编辑开关 '),(0,m.createElementVNode)('div',Vy,[a[25]||(a[25]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 追加前二次编辑 '),(0,m.createElementVNode)('span',{class:'hint'},'点击标签时弹出编辑器，可修改后再追加')],-1)),(0,m.createElementVNode)('div',Ey,[(0,m.createElementVNode)('label',By,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[6]||(a[6]=e=>c.value.allowPreEdit=e),type:'checkbox'},null,512),[[m.vModelCheckbox,c.value.allowPreEdit]]),a[24]||(a[24]=(0,m.createElementVNode)('span',{class:'slider'},null,-1))])])])])]),(0,m.createCommentVNode)(' 提示词模板 '),(0,m.createElementVNode)('div',Ty,[a[34]||(a[34]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-file-alt'}),(0,m.createTextVNode)(' 提示词模板 ')],-1)),(0,m.createElementVNode)('div',Sy,[(0,m.createElementVNode)('div',Dy,[a[27]||(a[27]=(0,m.createElementVNode)('div',{class:'acu-settings-label'},[(0,m.createTextVNode)(' 模板内容 '),(0,m.createElementVNode)('span',{class:'hint'},'支持通配符替换')],-1)),(0,m.createElementVNode)('div',Ay,[(0,m.withDirectives)((0,m.createElementVNode)('textarea',{ref_key:'promptInput',ref:l,'onUpdate:modelValue':a[7]||(a[7]=e=>c.value.promptTemplate=e),class:'acu-textarea',placeholder:'输入提示词模板，支持通配符',rows:'4'},null,512),[[m.vModelText,c.value.promptTemplate]])])]),(0,m.createCommentVNode)(' 通配符快捷按钮 '),(0,m.createElementVNode)('div',zy,[a[28]||(a[28]=(0,m.createElementVNode)('span',{class:'hint'},'点击插入:',-1)),(0,m.createElementVNode)('button',{class:'acu-wildcard-btn',onClick:a[8]||(a[8]=(0,m.withModifiers)(e=>T(b),['stop']))},[(0,m.createElementVNode)('code',{textContent:(0,m.toDisplayString)(b)},null,8,Iy)]),(0,m.createElementVNode)('button',{class:'acu-wildcard-btn',onClick:a[9]||(a[9]=(0,m.withModifiers)(e=>T(h),['stop']))},[(0,m.createElementVNode)('code',{textContent:(0,m.toDisplayString)(h)},null,8,_y)]),(0,m.createElementVNode)('button',{class:'acu-wildcard-btn',onClick:a[10]||(a[10]=(0,m.withModifiers)(e=>T(x),['stop']))},[(0,m.createElementVNode)('code',{textContent:(0,m.toDisplayString)(x)},null,8,My)])]),(0,m.createCommentVNode)(' 通配符说明 '),(0,m.createElementVNode)('div',Uy,[(0,m.createElementVNode)('div',{class:'acu-help-header',onClick:a[11]||(a[11]=e=>p.value=!p.value)},[a[29]||(a[29]=(0,m.createElementVNode)('i',{class:'fas fa-lightbulb'},null,-1)),a[30]||(a[30]=(0,m.createElementVNode)('strong',null,'通配符说明',-1)),(0,m.createElementVNode)('i',{class:(0,m.normalizeClass)(['fas',p.value?'fa-chevron-up':'fa-chevron-down'])},null,2)]),p.value?((0,m.openBlock)(),(0,m.createElementBlock)('ul',Py,[(0,m.createElementVNode)('li',null,[(0,m.createElementVNode)('code',{textContent:(0,m.toDisplayString)(b)},null,8,$y),a[31]||(a[31]=(0,m.createTextVNode)(' - 标签本身的值（label）',-1))]),(0,m.createElementVNode)('li',null,[(0,m.createElementVNode)('code',{textContent:(0,m.toDisplayString)(h)},null,8,Ly),a[32]||(a[32]=(0,m.createTextVNode)(' - 当前行标题',-1))]),(0,m.createElementVNode)('li',null,[(0,m.createElementVNode)('code',{textContent:(0,m.toDisplayString)(x)},null,8,Fy),a[33]||(a[33]=(0,m.createTextVNode)(' - 主角名（酒馆宏）',-1))])])):(0,m.createCommentVNode)('v-if',!0)])])])])])])):(0,m.createCommentVNode)('v-if',!0)}}),Oy={class:'acu-modal acu-import-modal'},Ry={class:'acu-modal-header'},Hy={class:'acu-modal-body'},Wy={key:0,class:'acu-import-upload'},Yy={class:'acu-import-preview'},Xy={class:'acu-import-stats'},Gy={class:'acu-stat-item'},qy={class:'acu-stat-value'},Ky={class:'acu-stat-item'},Jy={class:'acu-stat-value'},Zy={key:0,class:'acu-stat-item acu-stat-conflict'},Qy={class:'acu-stat-value'},ek={key:0,class:'acu-conflict-options'},tk={class:'acu-settings-group'},ak={class:'acu-radio-option'},ok={class:'acu-radio-option'},nk={class:'acu-import-list'},rk={class:'acu-preview-scroll'},ik={key:0,class:'acu-preview-section'},lk={class:'acu-preview-header'},ck={class:'acu-preview-items'},sk={key:0,class:'acu-preview-more'},dk={key:1,class:'acu-preview-section'},uk={class:'acu-preview-header'},pk={class:'acu-preview-items'},mk={key:0,class:'acu-preview-more'},fk={class:'acu-import-actions'},gk={key:2,class:'acu-import-error'},vk=(0,m.defineComponent)({__name:'TagImportDialog',props:{visible:{type:Boolean}},emits:['update:visible','imported'],setup(e,{emit:t}){const a=t,o=(0,Ht.A)(),n=(0,m.ref)(null),r=(0,m.ref)(null),i=(0,m.ref)('rename'),l=(0,m.ref)(''),c=(0,m.computed)(()=>{if(!r.value)return{categories:0,tags:0,conflicts:0};let e=0;return r.value.tags.forEach(t=>{g(t)&&e++}),{categories:r.value.categories.length,tags:r.value.tags.length,conflicts:e}});function s(){v(),a('update:visible',!1)}function d(){n.value?.click()}function u(e){const t=e.target,a=t.files?.[0];a&&f(a)}function p(e){const t=e.dataTransfer?.files?.[0];t&&'application/json'===t.type?f(t):l.value='请选择 JSON 文件'}async function f(e){l.value='';try{const t=await e.text(),a=JSON.parse(t);if(!a.version||!Array.isArray(a.categories)||!Array.isArray(a.tags))throw new Error('无效的标签库文件格式');r.value=a}catch(e){l.value=e instanceof Error?e.message:'解析文件失败',r.value=null}}function g(e){const t=o.getCategoryByPath(e.category)?.id||'';return o.library.tags.some(a=>a.label===e.label&&a.categoryId===t)}function v(){r.value=null,l.value='',i.value='rename',n.value&&(n.value.value='')}function b(){if(!r.value)return;const e=o.importLibrary(r.value,{conflictStrategy:i.value});e.success?(a('imported',{addedTags:e.addedTags+e.renamedTags,addedCategories:e.addedCategories}),s()):l.value=e.error||'导入失败'}return(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(s,['self'])},[(0,m.createElementVNode)('div',Oy,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',Ry,[a[3]||(a[3]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},[(0,m.createElementVNode)('i',{class:'fas fa-file-import'}),(0,m.createTextVNode)(' 导入标签库 ')],-1)),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(s,['stop'])},'关闭')]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',Hy,[(0,m.createCommentVNode)(' 文件选择 '),r.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 导入预览 '),(0,m.createElementVNode)('div',Yy,[(0,m.createCommentVNode)(' 统计信息 '),(0,m.createElementVNode)('div',Xy,[(0,m.createElementVNode)('div',Gy,[a[5]||(a[5]=(0,m.createElementVNode)('i',{class:'fas fa-folder'},null,-1)),(0,m.createElementVNode)('span',qy,(0,m.toDisplayString)(c.value.categories),1),a[6]||(a[6]=(0,m.createElementVNode)('span',{class:'acu-stat-label'},'分类',-1))]),(0,m.createElementVNode)('div',Ky,[a[7]||(a[7]=(0,m.createElementVNode)('i',{class:'fas fa-tag'},null,-1)),(0,m.createElementVNode)('span',Jy,(0,m.toDisplayString)(c.value.tags),1),a[8]||(a[8]=(0,m.createElementVNode)('span',{class:'acu-stat-label'},'标签',-1))]),c.value.conflicts>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',Zy,[a[9]||(a[9]=(0,m.createElementVNode)('i',{class:'fas fa-exclamation-triangle'},null,-1)),(0,m.createElementVNode)('span',Qy,(0,m.toDisplayString)(c.value.conflicts),1),a[10]||(a[10]=(0,m.createElementVNode)('span',{class:'acu-stat-label'},'冲突',-1))])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 冲突处理选项 '),c.value.conflicts>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',ek,[a[15]||(a[15]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-cog'}),(0,m.createTextVNode)(' 冲突处理 ')],-1)),(0,m.createElementVNode)('div',tk,[(0,m.createElementVNode)('label',ak,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[1]||(a[1]=e=>i.value=e),type:'radio',value:'overwrite'},null,512),[[m.vModelRadio,i.value]]),a[11]||(a[11]=(0,m.createElementVNode)('span',null,'覆盖现有标签',-1)),a[12]||(a[12]=(0,m.createElementVNode)('span',{class:'hint'},'用导入的内容替换同名标签',-1))]),(0,m.createElementVNode)('label',ok,[(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[2]||(a[2]=e=>i.value=e),type:'radio',value:'rename'},null,512),[[m.vModelRadio,i.value]]),a[13]||(a[13]=(0,m.createElementVNode)('span',null,'重命名导入标签',-1)),a[14]||(a[14]=(0,m.createElementVNode)('span',{class:'hint'},'为冲突的标签添加序号后缀',-1))])])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 预览列表 '),(0,m.createElementVNode)('div',nk,[a[16]||(a[16]=(0,m.createElementVNode)('div',{class:'acu-settings-title'},[(0,m.createElementVNode)('i',{class:'fas fa-list'}),(0,m.createTextVNode)(' 导入内容预览 ')],-1)),(0,m.createElementVNode)('div',rk,[(0,m.createCommentVNode)(' 分类 '),r.value.categories.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',ik,[(0,m.createElementVNode)('div',lk,'分类 ('+(0,m.toDisplayString)(r.value.categories.length)+')',1),(0,m.createElementVNode)('div',ck,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(r.value.categories.slice(0,10),e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.id,class:'acu-preview-item'},(0,m.toDisplayString)(e.icon?e.icon+' ':'')+(0,m.toDisplayString)(e.path),1))),128)),r.value.categories.length>10?((0,m.openBlock)(),(0,m.createElementBlock)('span',sk,' 还有 '+(0,m.toDisplayString)(r.value.categories.length-10)+' 个... ',1)):(0,m.createCommentVNode)('v-if',!0)])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 标签 '),r.value.tags.length>0?((0,m.openBlock)(),(0,m.createElementBlock)('div',dk,[(0,m.createElementVNode)('div',uk,'标签 ('+(0,m.toDisplayString)(r.value.tags.length)+')',1),(0,m.createElementVNode)('div',pk,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(r.value.tags.slice(0,20),e=>((0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.id,class:(0,m.normalizeClass)(['acu-preview-item',{conflict:g(e)}])},(0,m.toDisplayString)(e.label),3))),128)),r.value.tags.length>20?((0,m.openBlock)(),(0,m.createElementBlock)('span',mk,' 还有 '+(0,m.toDisplayString)(r.value.tags.length-20)+' 个... ',1)):(0,m.createCommentVNode)('v-if',!0)])])):(0,m.createCommentVNode)('v-if',!0)])]),(0,m.createCommentVNode)(' 操作按钮 '),(0,m.createElementVNode)('div',fk,[(0,m.createElementVNode)('button',{class:'acu-btn-secondary',onClick:(0,m.withModifiers)(v,['stop'])},[...a[17]||(a[17]=[(0,m.createElementVNode)('i',{class:'fas fa-redo'},null,-1),(0,m.createTextVNode)(' 重新选择',-1)])]),(0,m.createElementVNode)('button',{class:'acu-btn-primary',onClick:(0,m.withModifiers)(b,['stop'])},[...a[18]||(a[18]=[(0,m.createElementVNode)('i',{class:'fas fa-check'},null,-1),(0,m.createTextVNode)(' 确认导入',-1)])])])])],2112)):((0,m.openBlock)(),(0,m.createElementBlock)('div',Wy,[(0,m.createElementVNode)('div',{class:'acu-upload-area',onClick:d,onDragover:a[0]||(a[0]=(0,m.withModifiers)(()=>{},['prevent'])),onDrop:(0,m.withModifiers)(p,['prevent'])},[...a[4]||(a[4]=[(0,m.createElementVNode)('i',{class:'fas fa-cloud-upload-alt'},null,-1),(0,m.createElementVNode)('p',null,'点击选择文件或拖拽 JSON 文件到此处',-1),(0,m.createElementVNode)('span',{class:'hint'},'支持从其他设备导出的标签库文件',-1)])],32),(0,m.createElementVNode)('input',{ref_key:'fileInput',ref:n,type:'file',accept:'.json',style:{display:'none'},onChange:u},null,544)])),(0,m.createCommentVNode)(' 错误提示 '),l.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',gk,[a[19]||(a[19]=(0,m.createElementVNode)('i',{class:'fas fa-exclamation-circle'},null,-1)),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(l.value),1)])):(0,m.createCommentVNode)('v-if',!0)])])])):(0,m.createCommentVNode)('v-if',!0)}}),bk={class:'acu-modal-header'},hk={class:'acu-modal-body acu-tag-manager-body'},xk={class:'acu-displayed-area'},wk=['onClick'],yk={key:0,class:'acu-tag-icon'},kk={key:1},Ck={key:1,class:'acu-empty-hint'},Nk={class:'acu-tag-search'},Vk={class:'acu-tag-toolbar'},Ek={key:0,class:'mode-actions'},Bk=['disabled'],Tk={class:'acu-tag-manager'},Sk=(0,m.defineComponent)({__name:'TagManagerDialog',props:{visible:{type:Boolean},displayedTagIds:{},displayedCategoryIds:{default:()=>[]}},emits:['update:visible','save','close'],setup(e,{emit:t}){const a=e,o=t,n=(0,Ht.A)(),r=(0,f.JH)(),i=(0,k.j_)(),l=(0,m.ref)(''),c=(0,m.ref)(!1),s=(0,m.ref)(!1),d=(0,m.ref)(null),u=(0,m.ref)(''),p=(0,m.ref)([]),g=(0,m.ref)([]),v=(0,m.computed)(()=>n.currentMode),b=(0,m.computed)(()=>n.selectedTagIds),h=(0,m.computed)(()=>n.filteredTags),x=(0,m.computed)(()=>0!==h.value.length&&h.value.every(e=>b.value.has(e.id))),w=(0,m.computed)(()=>{const e=[];return g.value.forEach(t=>{const a=n.getCategoryById(t);a&&e.push({id:t,type:'category',label:a.path,icon:a.icon})}),p.value.forEach(t=>{const a=n.getTagById(t);a&&e.push({id:t,type:'tag',label:a.label})}),e}),y=(0,m.computed)(()=>p.value);function C(){n.setMode('normal'),o('save',[...p.value],[...g.value]),o('update:visible',!1),o('close')}function N(e){v.value===e?(n.setMode('normal'),E('已退出'+V(e)+'模式')):(n.setMode(e),E(V(e)+'模式已启用'))}function V(e){return{normal:'普通',create:'新建',add:'展示',delete:'删除',migrate:'迁移',export:'导出'}[e]||e}function E(e){'undefined'!=typeof toastr&&toastr.info(e,'',{timeOut:2e3})}function B(){n.searchKeyword=l.value}function T(){l.value='',n.searchKeyword=''}function S(e){'add'===v.value&&e&&F(e.id)}function D(e){const t=n.selectedCategoryIds,a=b.value.size,o=t.size;if(0===a&&0===o)return void E('请先选中要迁移的标签或分类');'root'===e?n.migrateSelectedItems(''):n.migrateSelectedItems(e);const r=[];a>0&&r.push(`${a} 个标签`),o>0&&r.push(`${o} 个分类`);const i='root'===e?'根目录':'目标分类';E('已迁移 '+r.join(' 和 ')+' 到'+i),n.setMode('normal')}function A(e){if('root'===e)return void(confirm('确定要清空所有标签和分类吗？此操作不可撤销！')&&(n.clearAll(),p.value=[],g.value=[],E('已清空所有标签和分类')));const t=n.getCategoryById(e);t&&(n.deleteCategory(e),E('已删除分类：'+t.path),O(e))}function I(e){'add'===v.value?P(e.id):'normal'!==v.value&&'create'!==v.value||(d.value=e,c.value=!0)}function M(){d.value=null;const e=n.selectedLevel1;if(e&&'全部'!==e&&'未分类'!==e){const t=n.getCategoryByPath(e);u.value=t?.id||''}else u.value='';c.value=!0}function U(e){const t=n.getTagById(e);t&&(n.deleteTag(e),E('已删除标签：'+t.label),j(e))}function P(e){if(p.value.includes(e))E('该标签已在展示区');else{p.value=[...p.value,e];const t=n.getTagById(e);t&&E('已添加：'+t.label)}}function L(e){'root'!==e?F(e):g.value.includes('root')?E('根目录已在展示区'):(g.value=[...g.value,'root'],E('已添加：根目录'))}function F(e){if(g.value.includes(e))E('该分类已在展示区');else{g.value=[...g.value,e];const t=n.getCategoryById(e);t&&E('已添加分类：'+t.path)}}function j(e){p.value=p.value.filter(t=>t!==e)}function O(e){g.value=g.value.filter(t=>t!==e)}function R(e){E('已保存：'+e.label)}function H(){d.value=null}function W(){s.value=!0}function Y(e){E(`已导入 ${e.addedCategories} 个分类，${e.addedTags} 个标签`)}function X(){x.value?h.value.forEach(e=>{b.value.has(e.id)&&n.toggleTagSelection(e.id)}):h.value.forEach(e=>{b.value.has(e.id)||n.toggleTagSelection(e.id)})}function G(){K(n.exportLibrary('all'),'tag-library-all.json'),n.setMode('normal')}function q(){K(n.exportLibrary('selected'),'tag-library-selected.json'),n.setMode('normal')}function K(e,t){const a=new Blob([JSON.stringify(e,null,2)],{type:'application/json'}),o=URL.createObjectURL(a),n=document.createElement('a');n.href=o,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o),E('导出成功')}return(0,m.onMounted)(async()=>{await n.loadLibrary()}),(0,m.onUnmounted)(()=>{i.tagPreviewMode&&i.toggleTagPreviewMode(),i.hideTagPreviewTooltip()}),(0,m.watch)(()=>a.visible,e=>{e&&(n.setMode('normal'),n.resetSelection(),l.value='',p.value=[...a.displayedTagIds],g.value=[...a.displayedCategoryIds])}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(C,['self'])},[(0,m.createElementVNode)('div',{class:'acu-modal acu-tag-manager-modal',style:(0,m.normalizeStyle)({paddingBottom:`${(0,m.unref)(r).config.mobileSafeAreaBottom??0}px`})},[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',bk,[a[8]||(a[8]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},[(0,m.createElementVNode)('i',{class:'fas fa-tags'}),(0,m.createTextVNode)(' 标签管理器 ')],-1)),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(C,['stop'])},'完成')]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',hk,[(0,m.createCommentVNode)(' 已展示区（顶部） '),(0,m.createElementVNode)('div',xk,[a[10]||(a[10]=(0,m.createElementVNode)('span',{class:'acu-displayed-label'},'已展示：',-1)),w.value.length>0?((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,{key:0},(0,m.renderList)(w.value,e=>{return(0,m.openBlock)(),(0,m.createElementBlock)('span',{key:e.id,class:'acu-displayed-tag',onClick:(0,m.withModifiers)(t=>function(e){'tag'===e.type?j(e.id):O(e.id)}(e),['stop'])},[e.icon?((0,m.openBlock)(),(0,m.createElementBlock)('span',yk,[(t=e.icon,t.startsWith('fa')||t.includes(' fa-')?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(e.icon)},null,2)):((0,m.openBlock)(),(0,m.createElementBlock)('span',kk,(0,m.toDisplayString)(e.icon),1)))])):(0,m.createCommentVNode)('v-if',!0),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(e.label)+' ',1),a[9]||(a[9]=(0,m.createElementVNode)('i',{class:'fas fa-times acu-remove-icon'},null,-1))],8,wk);var t}),128)):((0,m.openBlock)(),(0,m.createElementBlock)('span',Ck,'点击下方标签或分类添加到展示区'))]),(0,m.createCommentVNode)(' 搜索栏 '),(0,m.createElementVNode)('div',Nk,[a[12]||(a[12]=(0,m.createElementVNode)('i',{class:'fas fa-search'},null,-1)),(0,m.withDirectives)((0,m.createElementVNode)('input',{'onUpdate:modelValue':a[0]||(a[0]=e=>l.value=e),type:'text',placeholder:'搜索标签...',onInput:B},null,544),[[m.vModelText,l.value]]),l.value?((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:0,class:'acu-clear-search',onClick:(0,m.withModifiers)(T,['stop'])},[...a[11]||(a[11]=[(0,m.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 工具栏 '),(0,m.createElementVNode)('div',Vk,[(0,m.createCommentVNode)(' 预览模式按钮（通过 CSS 媒体查询控制，仅移动端显示） '),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-mode-btn acu-mobile-only',{active:(0,m.unref)(i).tagPreviewMode}]),title:'预览模式：点按标签查看提示词',onClick:a[1]||(a[1]=(0,m.withModifiers)(e=>(0,m.unref)(i).toggleTagPreviewMode(),['stop']))},[...a[13]||(a[13]=[(0,m.createElementVNode)('i',{class:'fas fa-search'},null,-1),(0,m.createElementVNode)('span',{class:'btn-label'},'预览',-1)])],2),(0,m.createCommentVNode)(' 模式按钮 '),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-mode-btn',{active:'add'===v.value}]),title:'展示模式：点击标签/分类添加到展示区',onClick:a[2]||(a[2]=(0,m.withModifiers)(e=>N('add'),['stop']))},[...a[14]||(a[14]=[(0,m.createElementVNode)('i',{class:'fas fa-eye'},null,-1),(0,m.createElementVNode)('span',{class:'btn-label'},'展示',-1)])],2),(0,m.createElementVNode)('button',{class:'acu-mode-btn',title:'新建标签',onClick:(0,m.withModifiers)(M,['stop'])},[...a[15]||(a[15]=[(0,m.createElementVNode)('i',{class:'fas fa-plus'},null,-1),(0,m.createElementVNode)('span',{class:'btn-label'},'新建',-1)])]),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-mode-btn',{active:'delete'===v.value}]),title:'删除模式：点击标签/分类立即删除',onClick:a[3]||(a[3]=(0,m.withModifiers)(e=>N('delete'),['stop']))},[...a[16]||(a[16]=[(0,m.createElementVNode)('i',{class:'fas fa-trash'},null,-1),(0,m.createElementVNode)('span',{class:'btn-label'},'删除',-1)])],2),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-mode-btn',{active:'migrate'===v.value}]),title:'迁移模式：选中标签后点击目标分类迁入',onClick:a[4]||(a[4]=(0,m.withModifiers)(e=>N('migrate'),['stop']))},[...a[17]||(a[17]=[(0,m.createElementVNode)('i',{class:'fas fa-arrows-alt'},null,-1),(0,m.createElementVNode)('span',{class:'btn-label'},'迁移',-1)])],2),(0,m.createElementVNode)('button',{class:'acu-mode-btn',title:'导入标签库',onClick:(0,m.withModifiers)(W,['stop'])},[...a[18]||(a[18]=[(0,m.createElementVNode)('i',{class:'fas fa-file-import'},null,-1),(0,m.createElementVNode)('span',{class:'btn-label'},'导入',-1)])]),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-mode-btn',{active:'export'===v.value}]),title:'导出模式：选择要导出的标签',onClick:a[5]||(a[5]=(0,m.withModifiers)(e=>N('export'),['stop']))},[...a[19]||(a[19]=[(0,m.createElementVNode)('i',{class:'fas fa-file-export'},null,-1),(0,m.createElementVNode)('span',{class:'btn-label'},'导出',-1)])],2),(0,m.createCommentVNode)(' 迁移/导出模式额外按钮 '),'migrate'===v.value||'export'===v.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Ek,[(0,m.createElementVNode)('button',{class:'acu-mode-btn',onClick:(0,m.withModifiers)(X,['stop'])},[a[20]||(a[20]=(0,m.createElementVNode)('i',{class:'fas fa-check-double'},null,-1)),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(x.value?'取消全选':'全选当前'),1)]),'export'===v.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:0},[(0,m.createElementVNode)('button',{class:'acu-mode-btn',onClick:(0,m.withModifiers)(G,['stop'])},[...a[21]||(a[21]=[(0,m.createElementVNode)('i',{class:'fas fa-download'},null,-1),(0,m.createTextVNode)(' 全部导出 ',-1)])]),(0,m.createElementVNode)('button',{class:'acu-mode-btn',disabled:0===b.value.size,onClick:(0,m.withModifiers)(q,['stop'])},[a[22]||(a[22]=(0,m.createElementVNode)('i',{class:'fas fa-check'},null,-1)),(0,m.createTextVNode)(' 导出选中 ('+(0,m.toDisplayString)(b.value.size)+') ',1)],8,Bk)],64)):(0,m.createCommentVNode)('v-if',!0)])):(0,m.createCommentVNode)('v-if',!0)]),(0,m.createCommentVNode)(' 双栏布局 '),(0,m.createElementVNode)('div',Tk,[(0,m.createCommentVNode)(' 左侧：目录树 '),(0,m.createVNode)(Ww,{mode:v.value,onCategoryClick:S,onAddCategory:L,onMigrateToCategory:D,onDeleteCategory:A},null,8,['mode']),(0,m.createCommentVNode)(' 右侧：标签网格 '),(0,m.createVNode)(Vw,{mode:v.value,'displayed-tag-ids':y.value,onTagClick:I,onCreateTag:M,onDeleteTag:U,onAddTag:P},null,8,['mode','displayed-tag-ids'])])])],4),(0,m.createCommentVNode)(' 编辑弹窗 '),(0,m.createVNode)(jy,{visible:c.value,'onUpdate:visible':a[6]||(a[6]=e=>c.value=e),tag:d.value,'default-category-id':u.value,onSaved:R,onClose:H},null,8,['visible','tag','default-category-id']),(0,m.createCommentVNode)(' 导入弹窗 '),s.value?((0,m.openBlock)(),(0,m.createBlock)(vk,{key:0,visible:s.value,'onUpdate:visible':a[7]||(a[7]=e=>s.value=e),onImported:Y},null,8,['visible'])):(0,m.createCommentVNode)('v-if',!0)])):(0,m.createCommentVNode)('v-if',!0)}}),Dk={class:'acu-modal-header'},Ak={class:'acu-modal-title'},zk={key:0,class:'acu-category-icon'},Ik={key:1},_k={class:'acu-modal-body'},Mk={key:0,class:'acu-category-select-dual'},Uk={class:'acu-category-tree'},Pk={class:'acu-tree-count'},$k=['onClick'],Lk={key:0,class:'acu-tree-icon'},Fk={key:1},jk={key:1,class:'acu-tree-icon'},Ok={class:'acu-tree-label'},Rk={class:'acu-tree-count'},Hk={class:'acu-category-tags-grid'},Wk=['onClick','onMouseenter','onTouchstartPassive'],Yk={key:0,class:'acu-tags-empty'},Xk={class:'acu-category-tags-only'},Gk={class:'acu-tags-scroll'},qk=['onClick','onMouseenter','onTouchstartPassive'],Kk={key:0,class:'acu-tags-empty'},Jk={class:'acu-modal-footer',style:{'justify-content':'space-between','margin-top':'0','padding-top':'12px','border-top':'1px solid var(--acu-border)'}},Zk=(0,m.defineComponent)({__name:'CategorySelectPopup',props:{visible:{type:Boolean},categoryId:{},rowContext:{default:()=>({title:'',value:''})},widgetId:{default:''}},emits:['update:visible','select','close'],setup(e,{emit:t}){const a=e,o=t,n=(0,Ht.A)(),r=(0,k.j_)(),i=(0,Ft.f)(),l=(0,m.ref)(null),c=(0,m.computed)(()=>n.getCategoryById(a.categoryId)),s=(0,m.computed)(()=>{if(!c.value)return'未知分类';const e=c.value.path.split('/');return e[e.length-1]}),d=(0,m.computed)(()=>{if(!c.value)return[];const e=c.value.path;return n.library.categories.filter(t=>{if(!t.path.startsWith(e+'/'))return!1;return!t.path.slice(e.length+1).includes('/')})}),u=(0,m.computed)(()=>d.value.length>0),p=(0,m.computed)(()=>{if(!c.value)return[];const e=new Set;return n.library.categories.forEach(t=>{(t.path===c.value.path||t.path.startsWith(c.value.path+'/'))&&e.add(t.id)}),n.library.tags.filter(t=>e.has(t.categoryId))}),f=(0,m.computed)(()=>p.value.length),g=(0,m.computed)(()=>{if(null===l.value)return p.value;const e=n.getCategoryById(l.value);if(!e)return[];const t=new Set;return n.library.categories.forEach(a=>{(a.path===e.path||a.path.startsWith(e.path+'/'))&&t.add(a.id)}),n.library.tags.filter(e=>t.has(e.categoryId))});function v(e){const t=e.path.split('/');return t[t.length-1]}function b(e){const t=n.getCategoryById(e);if(!t)return 0;const a=new Set;return n.library.categories.forEach(e=>{(e.path===t.path||e.path.startsWith(t.path+'/'))&&a.add(e.id)}),n.library.tags.filter(e=>a.has(e.categoryId)).length}function h(e){l.value=e}function x(){o('update:visible',!1),o('close')}function w(e){r.tagPreviewMode||o('select',e,a.rowContext)}function y(e,t){if(!e.promptTemplate)return;const a=t.currentTarget.getBoundingClientRect();r.showTagPreviewTooltip(e.promptTemplate,a.left+a.width/2,a.top)}function C(){r.hideTagPreviewTooltip()}function N(e,t){if(!r.tagPreviewMode)return;if(!e.promptTemplate)return;const a=t.touches[0];a&&r.showTagPreviewTooltip(e.promptTemplate,a.clientX,a.clientY)}function V(){r.tagPreviewMode&&r.hideTagPreviewTooltip()}function E(){x();let e=[],t=[];if(a.widgetId){const o=i.getWidgetById(a.widgetId);o&&o.widgetTagConfig&&(e=o.widgetTagConfig.displayedTagIds||[],t=o.widgetTagConfig.displayedCategoryIds||[])}0===t.length&&a.categoryId&&(t=[a.categoryId]),r.openTagManagerDialog({widgetId:a.widgetId||'',displayedTagIds:e,displayedCategoryIds:t},(e,t)=>{if(a.widgetId){const o=i.getWidgetById(a.widgetId);o&&i.updateWidget(a.widgetId,{widgetTagConfig:{...o.widgetTagConfig,displayedTagIds:e,displayedCategoryIds:t}})}})}function B(e){return e.startsWith('fa')||e.includes(' fa-')}return(0,m.onUnmounted)(()=>{r.tagPreviewMode&&r.toggleTagPreviewMode(),r.hideTagPreviewTooltip()}),(0,m.watch)(()=>a.visible,e=>{e&&(l.value=null)}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(x,['self'])},[(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-modal acu-category-select-modal',{'has-subcategories':u.value}])},[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',Dk,[(0,m.createElementVNode)('span',Ak,[c.value?.icon?((0,m.openBlock)(),(0,m.createElementBlock)('span',zk,[B(c.value.icon)?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(c.value.icon)},null,2)):((0,m.openBlock)(),(0,m.createElementBlock)('span',Ik,(0,m.toDisplayString)(c.value.icon),1))])):(0,m.createCommentVNode)('v-if',!0),(0,m.createTextVNode)(' '+(0,m.toDisplayString)(s.value),1)]),(0,m.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,m.withModifiers)(x,['stop'])},'完成')]),(0,m.createCommentVNode)(' 内容区 '),(0,m.createElementVNode)('div',_k,[(0,m.createCommentVNode)(' 有子分类：左右布局 '),u.value?((0,m.openBlock)(),(0,m.createElementBlock)('div',Mk,[(0,m.createCommentVNode)(' 左侧：子分类目录树 '),(0,m.createElementVNode)('div',Uk,[(0,m.createCommentVNode)(' 全部（显示所有标签） '),(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-tree-item',{active:null===l.value}]),onClick:a[0]||(a[0]=(0,m.withModifiers)(e=>h(null),['stop']))},[a[2]||(a[2]=(0,m.createElementVNode)('span',{class:'acu-tree-icon'},'📦',-1)),a[3]||(a[3]=(0,m.createElementVNode)('span',{class:'acu-tree-label'},'全部',-1)),(0,m.createElementVNode)('span',Pk,(0,m.toDisplayString)(f.value),1)],2),(0,m.createCommentVNode)(' 子分类列表 '),((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(d.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.id,class:(0,m.normalizeClass)(['acu-tree-item',{active:l.value===e.id}]),onClick:(0,m.withModifiers)(t=>h(e.id),['stop'])},[e.icon?((0,m.openBlock)(),(0,m.createElementBlock)('span',Lk,[B(e.icon)?((0,m.openBlock)(),(0,m.createElementBlock)('i',{key:0,class:(0,m.normalizeClass)(e.icon)},null,2)):((0,m.openBlock)(),(0,m.createElementBlock)('span',Fk,(0,m.toDisplayString)(e.icon),1))])):((0,m.openBlock)(),(0,m.createElementBlock)('span',jk,[...a[4]||(a[4]=[(0,m.createElementVNode)('i',{class:'fas fa-folder'},null,-1)])])),(0,m.createElementVNode)('span',Ok,(0,m.toDisplayString)(v(e)),1),(0,m.createElementVNode)('span',Rk,(0,m.toDisplayString)(b(e.id)),1)],10,$k))),128))]),(0,m.createCommentVNode)(' 右侧：标签网格 '),(0,m.createElementVNode)('div',Hk,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(g.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:e.id,class:(0,m.normalizeClass)(['acu-tag-btn',{'mode-preview':(0,m.unref)(r).tagPreviewMode}]),onClick:(0,m.withModifiers)(t=>w(e),['stop']),onMouseenter:t=>y(e,t),onMouseleave:C,onTouchstartPassive:t=>N(e,t),onTouchend:V,onTouchcancel:V},(0,m.toDisplayString)(e.label),43,Wk))),128)),(0,m.createCommentVNode)(' 空状态 '),0===g.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',Yk,[...a[5]||(a[5]=[(0,m.createElementVNode)('i',{class:'fas fa-tag'},null,-1),(0,m.createElementVNode)('span',null,'暂无标签',-1)])])):(0,m.createCommentVNode)('v-if',!0)])])):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 无子分类：只显示标签滚动框 '),(0,m.createElementVNode)('div',Xk,[(0,m.createElementVNode)('div',Gk,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(p.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('button',{key:e.id,class:(0,m.normalizeClass)(['acu-tag-btn',{'mode-preview':(0,m.unref)(r).tagPreviewMode}]),onClick:(0,m.withModifiers)(t=>w(e),['stop']),onMouseenter:t=>y(e,t),onMouseleave:C,onTouchstartPassive:t=>N(e,t),onTouchend:V,onTouchcancel:V},(0,m.toDisplayString)(e.label),43,qk))),128))]),(0,m.createCommentVNode)(' 空状态 '),0===p.value.length?((0,m.openBlock)(),(0,m.createElementBlock)('div',Kk,[...a[6]||(a[6]=[(0,m.createElementVNode)('i',{class:'fas fa-tag'},null,-1),(0,m.createElementVNode)('span',null,'该分类下暂无标签',-1)])])):(0,m.createCommentVNode)('v-if',!0)])],2112))]),(0,m.createCommentVNode)(' 底部：操作按钮 '),(0,m.createElementVNode)('div',Jk,[(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:(0,m.withModifiers)(E,['stop'])},[...a[7]||(a[7]=[(0,m.createElementVNode)('i',{class:'fas fa-tags'},null,-1),(0,m.createTextVNode)(' 管理标签 ',-1)])]),(0,m.createCommentVNode)(' 预览模式按钮（通过 CSS 媒体查询控制，仅移动端显示） '),(0,m.createElementVNode)('button',{class:(0,m.normalizeClass)(['acu-modal-btn secondary acu-mobile-only',{active:(0,m.unref)(r).tagPreviewMode}]),onClick:a[1]||(a[1]=(0,m.withModifiers)(e=>(0,m.unref)(r).toggleTagPreviewMode(),['stop']))},[a[8]||(a[8]=(0,m.createElementVNode)('i',{class:'fas fa-search'},null,-1)),(0,m.createTextVNode)(' '+(0,m.toDisplayString)((0,m.unref)(r).tagPreviewMode?'退出预览':'预览模式'),1)],2)])],2)])):(0,m.createCommentVNode)('v-if',!0)}}),Qk={class:'acu-modal acu-pre-edit-modal'},eC={class:'acu-modal-header'},tC={class:'acu-header-actions'},aC=['disabled'],oC={class:'acu-modal-body'},nC={class:'acu-pre-edit-content'},rC={class:'acu-pre-edit-info-row'},iC={class:'acu-pre-edit-label'},lC=['onKeydown'],cC={key:0,class:'acu-companion-selector'},sC={class:'acu-avatar-list'},dC=['onClick'],uC=['src','alt'],pC={key:1,class:'acu-avatar-text-icon'},mC={class:'acu-avatar-name'},fC={key:0,class:'acu-avatar-empty'},gC=(0,m.defineComponent)({__name:'TagPreEditDialog',props:{visible:{type:Boolean},tagLabel:{default:''},resolvedPrompt:{default:''},showCompanions:{type:Boolean,default:!1},widgetId:{default:''}},emits:['update:visible','confirm','close'],setup(e,{emit:t}){const a=e,o=t,{setInput:n}=Ee(),{getAvatarUrl:r}=(0,Ue.o)(),i=((0,k.j_)(),(0,m.inject)('allTables')),l=(0,m.ref)(null),c=(0,m.ref)(''),s=(0,m.ref)([]),d=(0,m.ref)(!1);function u(){o('update:visible',!1),o('close')}function p(){const e=c.value.trim();e&&(n(e),o('confirm',e),u())}return(0,m.watch)(()=>a.visible,async e=>{e&&(c.value=a.resolvedPrompt,a.showCompanions&&async function(){d.value=!0;try{const e=new Set,t=i?i():[];i||console.warn('[TagPreEditDialog] getAllTables injection failed'),console.log('[TagPreEditDialog] Loading avatars. Tables:',t.length),t.length>0&&t.forEach(t=>{if((0,v._C)(t.name,t.id)){console.log('[TagPreEditDialog] Found character table:',t.name);let a=t.headers.findIndex(e=>['name','名称','姓名','角色'].includes(e.toLowerCase()));-1===a&&(a=t.headers.length>1?1:0),t.rows.forEach(t=>{const o=t.cells.find(e=>e.colIndex===a);o&&o.value&&String(o.value).trim()&&e.add(String(o.value).trim())})}});const a='undefined'!=typeof getVariables?getVariables({type:'chat'}):{},o=(a.acu_graph_config||{}).labels||{},n=await Promise.all(Array.from(e).map(async e=>{const t=await r(e),a=o[e];let n='';if(a?.selectedIndices&&a.selectedIndices.length>0)n=a.selectedIndices.map(t=>e[t]).join('');else{n=(a?.displayLabel||e).charAt(0)}return{name:e,displayUrl:t||'',textAvatar:n}}));s.value=n}catch(e){console.error('Failed to load avatars:',e)}finally{d.value=!1}}(),await(0,m.nextTick)(),l.value?.focus(),l.value?.setSelectionRange(c.value.length,c.value.length))}),(t,a)=>e.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,m.withModifiers)(u,['self'])},[(0,m.createElementVNode)('div',Qk,[(0,m.createCommentVNode)(' 头部 '),(0,m.createElementVNode)('div',eC,[a[2]||(a[2]=(0,m.createElementVNode)('span',{class:'acu-modal-title'},[(0,m.createElementVNode)('i',{class:'fas fa-edit'}),(0,m.createTextVNode)(' 编辑提示词 ')],-1)),(0,m.createElementVNode)('div',tC,[(0,m.createElementVNode)('button',{class:'acu-modal-btn secondary small',onClick:(0,m.withModifiers)(u,['stop'])},'取消'),(0,m.createElementVNode)('button',{class:'acu-modal-btn primary small',disabled:!c.value.trim(),onClick:(0,m.withModifiers)(p,['stop'])},[...a[1]||(a[1]=[(0,m.createElementVNode)('i',{class:'fas fa-paper-plane'},null,-1),(0,m.createTextVNode)(' 追加 ',-1)])],8,aC)])]),(0,m.createCommentVNode)(' 内容 '),(0,m.createElementVNode)('div',oC,[(0,m.createElementVNode)('div',nC,[(0,m.createCommentVNode)(' 标签信息 '),(0,m.createElementVNode)('div',rC,[(0,m.createElementVNode)('div',iC,'标签：'+(0,m.toDisplayString)(e.tagLabel),1)]),(0,m.createCommentVNode)(' 编辑区 '),(0,m.withDirectives)((0,m.createElementVNode)('textarea',{ref_key:'textareaRef',ref:l,'onUpdate:modelValue':a[0]||(a[0]=e=>c.value=e),class:'acu-pre-edit-textarea',placeholder:'输入要追加的内容...',onKeydown:[(0,m.withKeys)((0,m.withModifiers)(p,['ctrl']),['enter']),(0,m.withKeys)((0,m.withModifiers)(p,['meta']),['enter'])]},null,40,lC),[[m.vModelText,c.value]]),(0,m.createCommentVNode)(' 同伴选择器 '),e.showCompanions?((0,m.openBlock)(),(0,m.createElementBlock)('div',cC,[a[3]||(a[3]=(0,m.createElementVNode)('div',{class:'acu-companion-header'},[(0,m.createElementVNode)('i',{class:'fas fa-user-friends'}),(0,m.createTextVNode)(' 选择同伴 (点击插入) ')],-1)),(0,m.createElementVNode)('div',sC,[((0,m.openBlock)(!0),(0,m.createElementBlock)(m.Fragment,null,(0,m.renderList)(s.value,e=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:e.name,class:'acu-avatar-item',onClick:t=>function(e){const t=`和${e.name}`,a=c.value;if(a.includes('{{user}}')){const e=a.lastIndexOf('{{user}}')+8;c.value=a.slice(0,e)+t+a.slice(e)}else c.value=t+a;(0,m.nextTick)(()=>{l.value?.focus()})}(e)},[(0,m.createElementVNode)('div',{class:(0,m.normalizeClass)(['acu-avatar-img-wrapper',{'no-img':!e.displayUrl}])},[e.displayUrl?((0,m.openBlock)(),(0,m.createElementBlock)('img',{key:0,src:e.displayUrl,alt:e.name,loading:'lazy'},null,8,uC)):((0,m.openBlock)(),(0,m.createElementBlock)('span',pC,(0,m.toDisplayString)(e.textAvatar),1))],2),(0,m.createElementVNode)('span',mC,(0,m.toDisplayString)(e.name),1)],8,dC))),128)),0!==s.value.length||d.value?(0,m.createCommentVNode)('v-if',!0):((0,m.openBlock)(),(0,m.createElementBlock)('div',fC,'暂无头像数据'))])])):(0,m.createCommentVNode)('v-if',!0),(0,m.createCommentVNode)(' 提示 '),a[4]||(a[4]=(0,m.createElementVNode)('div',{class:'acu-pre-edit-hint'},[(0,m.createElementVNode)('i',{class:'fas fa-lightbulb'}),(0,m.createElementVNode)('span',null,'按 Ctrl+Enter 快速追加')],-1))])])])])):(0,m.createCommentVNode)('v-if',!0)}}),vC=(0,m.defineComponent)({__name:'TagPreviewTooltip',setup(e){const t=(0,k.j_)(),a=(0,m.computed)(()=>{const{x:e,y:a}=t.tagPreviewTooltip,o=window.parent?.innerWidth||window.innerWidth;let n=e;return n+150>o-20&&(n=o-150-20),n-150<20&&(n=170),{left:`${n}px`,top:a-10+'px'}});return(e,o)=>(0,m.unref)(t).tagPreviewTooltip.visible?((0,m.openBlock)(),(0,m.createElementBlock)('div',{key:0,class:'acu-tag-preview-tooltip',style:(0,m.normalizeStyle)(a.value)},(0,m.toDisplayString)((0,m.unref)(t).tagPreviewTooltip.content),5)):(0,m.createCommentVNode)('v-if',!0)}}),bC=(0,m.defineComponent)({__name:'App',setup(e){const t=(0,m.defineAsyncComponent)({loader:()=>Promise.resolve().then(u.bind(u,6146)),loadingComponent:{template:'\n      <div class="acu-graph-loading">\n        <i class="fas fa-spinner fa-spin"></i>\n        <span>正在加载关系图...</span>\n      </div>\n    '},delay:200}),a=(0,k.j_)(),o=(0,y.D)(),n=(0,Ft.f)(),r=(0,f.JH)(),i=(0,Ht.A)(),l=(0,Ot.E)(),{init:c,cleanup:s}=w(),{saveToDatabase:d,getTableData:p,purgeFloorRange:g,stopAutoSave:b}=ue(),{refresh:h}=j(),{state:x}=(0,O.d)(),{setInput:C}=Ee(),{setHiddenPrompt:N,setupSendIntercept:V,cleanupSendIntercept:E}=Ve(),{performDivination:T,confirmDivination:S,triggerQuickReroll:D}=Rt();!function(){const e=(0,m.ref)(0),t=(0,m.ref)(0);let a=null,o=null;function n(a){const o=a.target;if(!o.closest?.('.acu-layout-horizontal .acu-panel-content'))return;const n=a.touches[0];e.value=n.clientX,t.value=n.clientY}function r(a){const o=a.target;if(!o.closest?.('.acu-layout-horizontal .acu-panel-content'))return;if('INPUT'===o.tagName||'TEXTAREA'===o.tagName||o.isContentEditable)return;let n=o,r=!1;for(;n&&n.classList&&!n.classList.contains('acu-panel-content');){if(n.scrollHeight>n.clientHeight){const e=window.getComputedStyle(n);if(['auto','scroll'].includes(e.overflowY)){r=!0;break}}n=n.parentElement}if(r)return;const i=a.touches[0],l=i.clientX-e.value,c=i.clientY-t.value;Math.abs(c)>Math.abs(l)&&a.cancelable&&a.preventDefault()}function i(){const e=window.parent?.document;e?(a=n,o=r,e.addEventListener('touchstart',a,{capture:!0,passive:!1}),e.addEventListener('touchmove',o,{capture:!0,passive:!1}),console.info('[ACU] 触摸滚动修复已安装（composable 管理）')):console.warn('[ACU] 无法访问父窗口 document，触摸滚动修复未安装')}function l(){const e=window.parent?.document;e&&(a&&(e.removeEventListener('touchstart',a,{capture:!0}),a=null),o&&(e.removeEventListener('touchmove',o,{capture:!0}),o=null),console.info('[ACU] 触摸滚动修复已卸载'))}(0,m.onMounted)(()=>{i()}),(0,m.onUnmounted)(()=>{l()})}(),ne(),He();const A=_e(),I=(0,m.ref)(),M=(0,m.ref)(),U=(0,m.ref)();(0,m.provide)('allTables',()=>W.value);const P=(0,m.ref)(''),L=(0,m.ref)(!1),F=(0,m.reactive)({visible:!1,x:0,y:0,tableId:'',tableName:'',rowIndex:0,isDeleting:!1}),R=(0,m.computed)(()=>[`acu-theme-${r.config.theme}`,`acu-font-${r.config.fontFamily.replace(/\s+/g,'-').toLowerCase()}`,{'acu-mobile':a.isMobile,'acu-layout-horizontal':'horizontal'===r.config.layout,'acu-layout-vertical':'vertical'===r.config.layout,'acu-fix-ios-zoom':r.config.enableIOSInputFix}]),H=(0,m.computed)(()=>a.activeTab===k.H6?'ACU 仪表盘':a.activeTab===k.$9?'ACU 选项面板':`ACU - ${a.activeTab||'可视化表格'}`),W=(0,m.computed)(()=>{const e=o.stagedData;if(!e)return[];const t=(0,v.tE)(e);return t?Object.entries(t).map(([e,t])=>{const{key:a,headers:o,rows:n}=t,r=n.map((t,a)=>{const n=t.map((e,t)=>({colIndex:t,key:o[t]||`col_${t}`,value:String(e??'')}));return{index:a,key:`${e}-row-${a}`,cells:n}});return{id:a,name:e,headers:o.map(e=>String(e)),rows:r}}):[]}),Y=(0,m.computed)(()=>W.value.map(e=>({id:e.id,name:e.name,icon:re(e.name)}))),X=(0,m.computed)(()=>W.value.some(e=>e.name.includes('选项')||e.name.toLowerCase().includes('option'))),G=(0,m.computed)(()=>!0===r.config.collapseTabBar),q=(0,m.computed)(()=>W.value.filter(e=>e.name.includes('选项')||e.name.toLowerCase().includes('option'))),K=(0,m.computed)(()=>W.value.some(e=>(0,v._C)(e.name,e.id))),J=(0,m.computed)(()=>W.value.find(e=>{const t=e.name.toLowerCase(),a=e.id.toLowerCase();return t.includes('关系')||a.includes('relationship')||a.includes('relation')})||null),Z=(0,m.computed)(()=>W.value.filter(e=>(0,v._C)(e.name,e.id))),Q=(0,m.computed)(()=>{const e=['势力','faction','组织','organization','阵营','帮派','宗门','门派','派系'];return W.value.find(t=>{const a=t.name.toLowerCase(),o=t.id.toLowerCase();return e.some(e=>a.includes(e)||o.includes(e))})||null}),ee=((0,m.computed)(()=>{const e=new Set;for(const t of Z.value){const a=t.headers.findIndex(e=>{const t=e.toLowerCase();return t.includes('势力')||t.includes('阵营')||t.includes('faction')});if(a>=0)for(const o of t.rows){const t=o.cells.find(e=>e.colIndex===a);t&&t.value&&String(t.value).trim()&&e.add(String(t.value).trim())}}return Array.from(e)}),(0,m.computed)(()=>a.activeTab&&W.value.find(e=>e.id===a.activeTab)||null)),te=(0,m.computed)(()=>{const{tableId:e,rowIndex:t}=a.rowEditDialog.props;if(!e)return null;const o=W.value.find(t=>t.id===e);return o?t<0||t>=o.rows.length?null:o.rows[t]:null}),ae=(0,m.computed)(()=>0),oe=(0,m.computed)(()=>{const e=window.SillyTavern?.chat;return Array.isArray(e)?e.length-1:0});function re(e){const t=e.toLowerCase();if(t.includes('主角')||t.includes('player'))return'fas fa-user';if(t.includes('任务')||t.includes('quest'))return'fas fa-tasks';if(t.includes('物品')||t.includes('item'))return'fas fa-box-open';if(t.includes('装备')||t.includes('equip'))return'fas fa-shield-alt';if(t.includes('状态')||t.includes('status'))return'fas fa-heart';if(t.includes('事件')||t.includes('event'))return'fas fa-calendar-alt';if(t.includes('选项')||t.includes('option'))return'fas fa-sliders-h';const a=(0,k.Sj)(e);return'fas fa-table'!==a?a:'fas fa-table'}function ie(){a.closePanel(),console.info('[ACU] 面板已关闭')}function le(){L.value=!L.value}function ce(){a.isCollapsed=!0,console.info('[ACU] 面板已收起为悬浮球')}function se(e){e&&M.value&&M.value.exitCenteredMode();const t=M.value?.getDataAreaElement();t&&(t.style.height='',t.style.minHeight='',t.style.maxHeight=''),a.setActiveTab(e),P.value='',L.value=!1,console.info(`[ACU] 切换到 Tab: ${e}`),(0,m.nextTick)(()=>{setTimeout(()=>{requestAnimationFrame(()=>{de(e)})},50)})}function de(e){const t=M.value?.getDataAreaElement();if(!t)return;const o=a.getTableHeight(e);o?(t.style.height=`${o}px`,console.info(`[ACU] 恢复高度: ${e} = ${o}px`)):M.value?.resetHeight()}function pe(e){a.setTableOrder(e),console.info('[ACU] Tab 顺序已更新')}function me(){a.toggleTabsPopup(),console.info('[ACU] Tab浮窗: '+(a.tabsPopup?'显示':'隐藏'))}function fe(e){a.closeTabsPopup(),se(e)}function ge(e){const t=M.value?.getDataAreaElement();t&&(t.style.height='',t.style.minHeight='',t.style.maxHeight=''),a.setActiveTab(e),console.info(`[ACU] 导航到表格: ${e}`),(0,m.nextTick)(()=>{setTimeout(()=>{requestAnimationFrame(()=>{de(e)})},50)})}function ve(){K.value?(a.setActiveTab(k.SC),console.info('[ACU] 导航到关系图 Tab')):O.toast.warning('未找到人物关系数据')}function be(){U.value&&U.value.openAvatarManager()}function he(){a.openInputFloorDialog(ae.value)}function xe(){a.openPurgeRangeDialog(oe.value)}function we(e,t){switch(e){case'clear':xe();break;case'undo':De();break;case'manualUpdate':Xe();break;case'console':a.openDirectorDialog();break;case'quickReroll':D();break;default:console.log('[ACU Dashboard] 未处理的动作:',e,t)}}function ye(){se(k.H6),console.info('[ACU] 返回仪表盘')}function ke(e,t){let o=String(e.promptTemplate||'');o=o.replace(/\{\{value\}\}/gi,e.label),o=t?.title?o.replace(/\{\{rowTitle\}\}/gi,t.title):o.replace(/\{\{rowTitle\}\}/gi,'');const n=function(){const e=window.parent||window;try{const t=e.SillyTavern?.getContext?.();if(t?.name1)return t.name1}catch(e){console.warn('[ACU] 获取主角名失败',e)}return'{{user}}'}();o=o.replace(/\{\{playerName\}\}/gi,n),o=o.replace(/\{\{tableName\}\}/gi,'');const r=o.trim(),l=i.getCategoryById(e.categoryId),c=!!l&&(l.path.includes('地点')||l.path.includes('Location'));e.allowPreEdit||c?a.openTagPreEditDialog({tagLabel:e.label,resolvedPrompt:r,showCompanions:c}):r&&C(r)}function Ce(e,t){const o=M.value?.getDataAreaElement();if(!o||!t)return;if(0!==e.button)return;e.preventDefault(),e.stopPropagation(),t.setPointerCapture(e.pointerId);const n=e.clientY,r=o.offsetHeight,i=e=>{const t=n-e.clientY;let a=r+t;a=Math.max(200,a),o.style.height=`${a}px`},l=e=>{t.releasePointerCapture(e.pointerId),t.removeEventListener('pointermove',i),t.removeEventListener('pointerup',l);const n=a.activeTab;if(n&&o){const e=o.offsetHeight;a.setTableHeight(n,e),console.info(`[ACU] 保存高度: ${n} = ${e}px`)}};t.addEventListener('pointermove',i),t.addEventListener('pointerup',l)}function Ne(){const e=a.activeTab;e&&(a.resetTableHeight(e),console.info(`[ACU] 清除高度记忆: ${e}`)),M.value?.resetHeight(),console.info('[ACU] 高度已重置为自适应')}async function Be(){const e=p();if(e){const t=o.setStagedData(e);o.saveSnapshot(t);const a=Object.keys(e).filter(e=>e.startsWith('sheet_'));n.cleanupInvalidWidgets(a),o.clearChanges(!0),n.ensureDefaultWidgets().catch(e=>{console.warn('[ACU] 补充默认组件失败（非阻塞）:',e)}),h().catch(e=>{console.warn('[ACU] 刷新表格更新状态失败（非阻塞）:',e)})}}async function Te(){try{await Be(),console.info('[ACU] 数据已刷新')}catch(e){console.error('[ACU] 刷新失败:',e)}}async function Se(){try{o.saveLastState();await d(null,!1,!0)&&(console.info('[ACU] 数据已保存'),await Be())}catch(e){console.error('[ACU] 保存失败:',e)}}function De(){if(!o.hasUndoData)return void O.toast.warning('没有可撤回的数据');o.undoToLastSave()?(O.toast.success('已撤回到上次保存前的状态（需手动保存）'),console.info('[ACU] 已撤回到上次保存前的状态, hasUnsavedChanges:',o.hasUnsavedChanges)):O.toast.error('撤回失败')}function Ae(e,t,a){console.info(`[ACU] 单元格点击: ${e}[${t}][${a}]`)}function ze(e,t){console.info(`[ACU] 行点击: ${e}[${t.index}]`)}async function Ie(e,t){console.info(`[ACU] 插入行: ${e} 在索引 ${t} 之后`);if(!W.value.find(t=>t.id===e))return void console.warn('[ACU] 未找到表格:',e);const{insertRow:a}=Ee();await a(e,t),await Be()}function Me(e,t){const a=W.value.find(t=>t.id===e),n=`${a?.name||e}-row-${t}`;o.toggleDelete(n),console.info(`[ACU] 切换删除状态: ${n}`)}function Ue(e,t,a){const n=W.value.find(e=>e.id===t),r=n?.name||t,i=`${r}-row-${a}`;F.visible=!0,F.x=e.clientX,F.y=e.clientY,F.tableId=t,F.tableName=r,F.rowIndex=a,F.isDeleting=o.pendingDeletes.has(i)}function Pe(){Ie(F.tableId,F.rowIndex),F.visible=!1}function $e(){const e=W.value.find(e=>e.id===F.tableId),t=e?.rows[F.rowIndex];if(t){const e=t.cells.map(e=>`${e.key}: ${e.value}`).join('\n');navigator.clipboard.writeText(e).then(()=>{console.info('[ACU] 内容已复制')})}F.visible=!1}function Le(){Me(F.tableId,F.rowIndex),F.visible=!1}function Fe(){Me(F.tableId,F.rowIndex),F.visible=!1}function je(e,t,o,n){const r=W.value.find(t=>t.id===e);let i=1;if(r&&(t.includes('总结')||t.includes('大纲'))){const e=r.headers.findIndex(e=>e&&(e.includes('索引')||e.includes('编号')||e.includes('代码')));i=e>0?e:1}a.openHistoryDialog({tableId:e,tableName:t,rowIndex:o,currentRowData:n,titleColIndex:i}),console.info(`[ACU] 打开历史记录: ${t}[${o}], titleColIndex=${i}`)}async function Oe(e){const{tableId:t,tableName:n,rowIndex:r,currentRowData:i}=a.historyDialog.props;if(!i||0===e.size)return void a.closeHistoryDialog();const{saveSnapshot:l,getCurrentChatId:c}=(0,B.m)();c()&&(await l(n,r,function(e){const t={};return e.cells.forEach((e,a)=>{t[a]=String(e.value)}),t}(i),'manual'),console.info('[ACU] 已保存历史记录（批量操作前）'));for(const[t,a]of e)o.updateCell(n,r,t,a,{skipHistory:!0});console.info(`[ACU] 应用历史更改: ${e.size} 个单元格`),a.closeHistoryDialog()}function Re(e='reveal'){const t=a.divinationOverlay.result;t?S(t,e):console.error('[ACU] Confirm divination failed: No result found')}function We(e){N(e),V()}function Ye(){console.info('[ACU] 设置已保存')}function Xe(){a.openManualUpdateDialog()}function Ge(){try{const e=(window.parent||window).AutoCardUpdaterAPI||window.AutoCardUpdaterAPI;e&&'function'==typeof e.openVisualizer?(e.openVisualizer(),console.info('[ACU] 已打开原生编辑器')):console.warn('[ACU] AutoCardUpdaterAPI.openVisualizer 不可用')}catch(e){console.error('[ACU] 打开原生编辑器失败:',e)}}async function qe(e){try{await d(null,!1,!1,e)&&(console.info(`[ACU] 数据已保存到第 ${e} 楼`),await Be())}catch(e){console.error('[ACU] 保存到指定楼层失败:',e)}}async function Je(e,t){try{await g(e,t),console.info(`[ACU] 已清除第 ${e} 到 ${t} 楼的数据`),await Be()}catch(e){console.error('[ACU] 清除范围失败:',e)}}async function Ze(e){console.info(`[ACU] 高级清除完成，影响 ${e.changedCount} 楼层，表格:`,e.tables),await Be()}return(0,m.onMounted)(async()=>{console.info('[ACU] App 组件已挂载'),c();try{A.init(),console.info('[ACU] Swipe 增强功能初始化成功')}catch(e){console.error('[ACU] Swipe 增强功能初始化失败:',e)}a.setMobile(window.innerWidth<=768),window.addEventListener('resize',()=>{a.setMobile(window.innerWidth<=768)});try{await Be(),await n.loadConfig(),l.loadConfig(),await l.loadFromWorldbook(),a.setInitialized(!0);let e=!1;try{const t=localStorage.getItem('acu_win_config'),o=t?JSON.parse(t):null;!0===o?.isCentered&&(e=!0,a.setActiveTab(null),a.isCollapsed=!1,console.info('[ACU] 居中模式（首次加载）：强制清除 Tab，展开面板，只显示导航栏'))}catch(e){}!e&&!a.activeTab&&W.value.length>0&&a.setActiveTab(k.H6)}catch(e){console.error('[ACU] 初始化数据加载失败:',e)}}),(0,m.onUnmounted)(()=>{console.info('[ACU] App 组件已卸载'),b(),E(),s()}),(0,m.onMounted)(()=>{const e=window.parent?.document||document,t=e=>{if(!a.isPanelVisible||a.isPinned)return;(function(e){const t=window.parent?.document||document;if(t.querySelector('.acu-inline-editor'))return console.info('[ACU] 检测到 InlineEditor 存在，阻止收起面板'),!0;if(t.querySelector('.acu-editing-lock'))return console.info('[ACU] 检测到编辑锁定状态，阻止收起面板'),!0;const o=t.activeElement;return!o||'TEXTAREA'!==o.tagName&&'INPUT'!==o.tagName||!o.closest('.acu-wrapper')&&!o.closest('.acu-inline-editor')?!!(a.settingsDialog||a.inputFloorDialog.visible||a.purgeRangeDialog.visible||a.manualUpdateDialog||a.historyDialog.visible||a.presetSaveDialog.visible)||!!(e.closest('.acu-wrapper')||e.closest('.acu-floating-ball-vue')||e.closest('.acu-context-menu')||e.closest('.acu-modal-overlay')||e.closest('.acu-modal')||e.closest('.acu-modal-container')||e.closest('.acu-history-modal')||e.closest('.acu-dialog')||e.closest('[class*="acu-settings"]')||e.closest('#acu_visualizer_vue-root')||e.closest('.acu-inline-editor')||e.closest('.acu-editing-lock')||e.closest('.acu-edit-textarea')):(console.info('[ACU] 检测到 ACU 内的输入框活动，阻止收起面板'),!0)})(e.target)||(a.closePanel(),console.info('[ACU] 点击外部，面板已收起'))};e.addEventListener('click',t),(0,m.onUnmounted)(()=>{e.removeEventListener('click',t)})}),(0,m.watchEffect)(()=>{const e=a.isMobile?r.config.mobileSafeAreaBottom??50:0;window.parent?.document?.documentElement&&window.parent.document.documentElement.style.setProperty('--acu-safe-area-bottom',`${e}px`)}),(0,m.watch)(()=>o.stagedData,e=>{e&&o.generateDiffMap(e)},{deep:!0}),(e,n)=>((0,m.openBlock)(),(0,m.createElementBlock)('div',{class:(0,m.normalizeClass)(['acu-app',R.value])},[(0,m.createCommentVNode)(' 悬浮球 (面板隐藏时显示) '),(0,m.createVNode)((0,m.unref)(Ke),{ref_key:'floatingBallRef',ref:I,style:(0,m.normalizeStyle)({display:(0,m.unref)(a).isPanelVisible?'none':'block'})},null,8,['style']),(0,m.createCommentVNode)(' 主面板 '),(0,m.createVNode)((0,m.unref)(st),{ref_key:'mainPanelRef',ref:M,style:(0,m.normalizeStyle)({display:(0,m.unref)(a).isPanelVisible?'flex':'none'}),title:H.value,theme:(0,m.unref)(r).config.theme,layout:(0,m.unref)(r).config.layout,'is-collapsed':(0,m.unref)(a).isCollapsed,'is-pinned':(0,m.unref)(a).isPinned,'is-content-hidden':L.value,'lock-panel':(0,m.unref)(r).config.lockPanel,'has-changes':(0,m.unref)(o).hasUnsavedChanges,onRefresh:Te,onSave:Se,onSaveAs:he,onUndo:De,onManualUpdate:Xe,onPurge:xe,onOpenNative:Ge,onSettings:(0,m.unref)(a).openSettingsDialog,onTogglePin:(0,m.unref)(a).togglePin,onToggle:ce,onClose:ie,onHideContent:le,onCollapseTab:me},{tabs:(0,m.withCtx)(()=>[G.value?(0,m.createCommentVNode)('v-if',!0):((0,m.openBlock)(),(0,m.createBlock)((0,m.unref)(pt),{key:0,tabs:Y.value,'active-tab':(0,m.unref)(a).activeTab,'show-dashboard':!0,'has-options-tabs':X.value,'has-relationship-graph':K.value,'is-editing-order':(0,m.unref)(a).isEditingOrder,'grid-columns':(0,m.unref)(r).gridColumnsCss,onTabChange:se,onOrderChange:pe,onExitEditing:n[0]||(n[0]=e=>(0,m.unref)(a).setEditingOrder(!1))},null,8,['tabs','active-tab','has-options-tabs','has-relationship-graph','is-editing-order','grid-columns']))]),'tabs-popup':(0,m.withCtx)(()=>[(0,m.createVNode)((0,m.unref)(lw),{visible:(0,m.unref)(a).tabsPopup,tabs:Y.value,'active-tab':(0,m.unref)(a).activeTab,'grid-columns':(0,m.unref)(r).gridColumnsCss,'show-dashboard':!0,'show-options-panel':X.value,'show-relationship-graph':K.value,onTabClick:fe,onClose:(0,m.unref)(a).closeTabsPopup},null,8,['visible','tabs','active-tab','grid-columns','show-options-panel','show-relationship-graph','onClose'])]),default:(0,m.withCtx)(()=>[(0,m.createCommentVNode)(' 仪表盘视图 '),(0,m.unref)(a).activeTab===(0,m.unref)(k.H6)?((0,m.openBlock)(),(0,m.createBlock)((0,m.unref)(Kn),{key:0,tables:W.value,onNavigate:ge,onRowClick:ze,onShowRelationshipGraph:ve,onAction:we,onHeightDragStart:Ce,onHeightReset:Ne},null,8,['tables'])):(0,m.unref)(a).activeTab===(0,m.unref)(k.$9)?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:1},[(0,m.createCommentVNode)(' 选项面板视图 '),(0,m.createVNode)((0,m.unref)(Cr),{tables:q.value,onCellClick:Ae,onToggleDelete:Me},null,8,['tables'])],2112)):(0,m.unref)(a).activeTab===(0,m.unref)(k.SC)?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:2},[(0,m.createCommentVNode)(' 关系图视图 '),(0,m.createVNode)((0,m.unref)(t),{ref_key:'relationshipGraphRef',ref:U,'relationship-table':J.value,'character-tables':Z.value,'faction-table':Q.value,'all-tables':W.value,'show-legend':!0},null,8,['relationship-table','character-tables','faction-table','all-tables'])],2112)):ee.value?((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:3},[(0,m.createCommentVNode)(' 普通表格视图 '),((0,m.openBlock)(),(0,m.createBlock)((0,m.unref)(dr),{key:ee.value.id,'table-id':ee.value.id,'table-name':ee.value.name,rows:ee.value.rows,headers:ee.value.headers,'search-term':P.value,onCellClick:Ae,onInsertRow:Ie,onToggleDelete:Me,onContextMenu:Ue,onSearchChange:n[1]||(n[1]=e=>P.value=e),onClose:ye,onHeightDragStart:Ce,onHeightReset:Ne,onShowHistory:je},null,8,['table-id','table-name','rows','headers','search-term']))],2112)):((0,m.openBlock)(),(0,m.createElementBlock)(m.Fragment,{key:4},[(0,m.createCommentVNode)(' 无数据状态 '),n[15]||(n[15]=(0,m.createElementVNode)('div',{class:'acu-no-data'},[(0,m.createElementVNode)('i',{class:'fas fa-inbox'}),(0,m.createElementVNode)('p',null,'请选择一个表格')],-1))],2112))]),_:1},8,['style','title','theme','layout','is-collapsed','is-pinned','is-content-hidden','lock-panel','has-changes','onSettings','onTogglePin']),(0,m.createCommentVNode)(' 右键菜单 '),(0,m.createVNode)((0,m.unref)(Nr),{visible:F.visible,'onUpdate:visible':n[2]||(n[2]=e=>F.visible=e),x:F.x,y:F.y,'table-id':F.tableId,'table-name':F.tableName,'row-index':F.rowIndex,onInsertRow:Pe,onCopy:$e,onDelete:Le,onUndoDelete:Fe},null,8,['visible','x','y','table-id','table-name','row-index']),(0,m.createCommentVNode)(' 设置弹窗 '),(0,m.createVNode)((0,m.unref)(ng),{visible:(0,m.unref)(a).settingsDialog,'onUpdate:visible':n[3]||(n[3]=e=>(0,m.unref)(a).settingsDialog=e),onSave:Ye},null,8,['visible']),(0,m.createCommentVNode)(' 导演控制台弹窗 '),(0,m.createVNode)((0,m.unref)(Bi),{visible:(0,m.unref)(a).directorDialog,'onUpdate:visible':n[4]||(n[4]=e=>(0,m.unref)(a).directorDialog=e)},null,8,['visible']),(0,m.createCommentVNode)(' 输入楼层弹窗 '),(0,m.createVNode)((0,m.unref)(Gl),{visible:(0,m.unref)(a).inputFloorDialog.visible,'onUpdate:visible':n[5]||(n[5]=e=>(0,m.unref)(a).inputFloorDialog.visible=e),'current-floor':(0,m.unref)(a).inputFloorDialog.props.currentFloor,onConfirm:qe},null,8,['visible','current-floor']),(0,m.createCommentVNode)(' 清除范围弹窗 '),(0,m.createVNode)((0,m.unref)(Kc),{visible:(0,m.unref)(a).purgeRangeDialog.visible,'onUpdate:visible':n[6]||(n[6]=e=>(0,m.unref)(a).purgeRangeDialog.visible=e),'max-floor':(0,m.unref)(a).purgeRangeDialog.props.maxFloor,onConfirm:Je,onAdvancedConfirm:Ze},null,8,['visible','max-floor']),(0,m.createCommentVNode)(' 高级清除弹窗 (全局) '),(0,m.createVNode)((0,m.unref)(gi),{visible:(0,m.unref)(a).advancedPurgeDialog.visible,'onUpdate:visible':n[7]||(n[7]=e=>(0,m.unref)(a).advancedPurgeDialog.visible=e),'initial-start-floor':(0,m.unref)(a).advancedPurgeDialog.props.initialStartFloor,'initial-end-floor':(0,m.unref)(a).advancedPurgeDialog.props.initialEndFloor,'initial-selected-tables':(0,m.unref)(a).advancedPurgeDialog.state.selectedTableKeys,onConfirm:(0,m.unref)(a).handleAdvancedPurgeConfirm},null,8,['visible','initial-start-floor','initial-end-floor','initial-selected-tables','onConfirm']),(0,m.createCommentVNode)(' 手动更新配置弹窗 '),(0,m.createVNode)((0,m.unref)(Ic),{visible:(0,m.unref)(a).manualUpdateDialog,'onUpdate:visible':n[8]||(n[8]=e=>(0,m.unref)(a).manualUpdateDialog=e)},null,8,['visible']),(0,m.createCommentVNode)(' 历史记录弹窗 (DataTable 使用) '),(0,m.createVNode)((0,m.unref)(kl),{visible:(0,m.unref)(a).historyDialog.visible,'onUpdate:visible':n[9]||(n[9]=e=>(0,m.unref)(a).historyDialog.visible=e),'table-name':(0,m.unref)(a).historyDialog.props.tableName,'table-id':(0,m.unref)(a).historyDialog.props.tableId,'row-index':(0,m.unref)(a).historyDialog.props.rowIndex,'current-row-data':(0,m.unref)(a).historyDialog.props.currentRowData,'title-col-index':(0,m.unref)(a).historyDialog.props.titleColIndex,onApply:Oe},null,8,['visible','table-name','table-id','row-index','current-row-data','title-col-index']),(0,m.createCommentVNode)(' 行编辑弹窗 (Dashboard 使用) '),(0,m.createVNode)((0,m.unref)(Gh),{visible:(0,m.unref)(a).rowEditDialog.visible,'onUpdate:visible':n[10]||(n[10]=e=>(0,m.unref)(a).rowEditDialog.visible=e),'table-name':(0,m.unref)(a).rowEditDialog.props.tableName,'table-id':(0,m.unref)(a).rowEditDialog.props.tableId,'row-index':(0,m.unref)(a).rowEditDialog.props.rowIndex,'current-row-data':te.value,onClose:(0,m.unref)(a).closeRowEditDialog,onShowHistory:(0,m.unref)(a).switchFromRowEditToHistory},null,8,['visible','table-name','table-id','row-index','current-row-data','onClose','onShowHistory']),(0,m.createCommentVNode)(' 历史记录弹窗 (Dashboard 使用) '),(0,m.createVNode)((0,m.unref)(kl),{visible:(0,m.unref)(a).dashboardHistoryDialog.visible,'onUpdate:visible':n[11]||(n[11]=e=>(0,m.unref)(a).dashboardHistoryDialog.visible=e),'table-name':(0,m.unref)(a).dashboardHistoryDialog.props.tableName,'table-id':(0,m.unref)(a).dashboardHistoryDialog.props.tableId,'row-index':(0,m.unref)(a).dashboardHistoryDialog.props.rowIndex,'current-row-data':(0,m.unref)(a).dashboardHistoryDialog.props.currentRowData,'title-col-index':(0,m.unref)(a).dashboardHistoryDialog.props.titleColIndex,onClose:(0,m.unref)(a).closeDashboardHistoryDialog},null,8,['visible','table-name','table-id','row-index','current-row-data','title-col-index','onClose']),(0,m.createCommentVNode)(' 组件设置弹窗 (Dashboard 使用) '),(0,m.createVNode)((0,m.unref)(jx),{visible:(0,m.unref)(a).widgetSettingsDialog.visible,'onUpdate:visible':n[12]||(n[12]=e=>(0,m.unref)(a).widgetSettingsDialog.visible=e),'widget-id':(0,m.unref)(a).widgetSettingsDialog.props.widgetId,'widget-config':(0,m.unref)(a).widgetSettingsDialog.props.widgetConfig,'table-headers':(0,m.unref)(a).widgetSettingsDialog.props.tableHeaders,onClose:(0,m.unref)(a).closeWidgetSettingsDialog},null,8,['visible','widget-id','widget-config','table-headers','onClose']),(0,m.createCommentVNode)(' 头像裁剪弹窗 (全局) '),(0,m.createVNode)((0,m.unref)(Bg),{visible:(0,m.unref)(a).avatarCropDialog.visible,'image-url':(0,m.unref)(a).avatarCropDialog.props.imageUrl,name:(0,m.unref)(a).avatarCropDialog.props.name,'initial-offset-x':(0,m.unref)(a).avatarCropDialog.props.initialOffsetX,'initial-offset-y':(0,m.unref)(a).avatarCropDialog.props.initialOffsetY,'initial-scale':(0,m.unref)(a).avatarCropDialog.props.initialScale,'initial-invert':(0,m.unref)(a).avatarCropDialog.props.initialInvert,'show-invert-option':(0,m.unref)(a).avatarCropDialog.props.showInvertOption,onClose:(0,m.unref)(a).closeAvatarCropDialog,onApply:(0,m.unref)(a).handleAvatarCropApply,onUpload:(0,m.unref)(a).handleAvatarCropUpload},null,8,['visible','image-url','name','initial-offset-x','initial-offset-y','initial-scale','initial-invert','show-invert-option','onClose','onApply','onUpload']),(0,m.createCommentVNode)(' 快捷按钮配置弹窗 (Dashboard 使用) '),(0,m.createVNode)((0,m.unref)(mx),{visible:(0,m.unref)(a).widgetActionsDialog.visible,'onUpdate:visible':n[13]||(n[13]=e=>(0,m.unref)(a).widgetActionsDialog.visible=e),'widget-id':(0,m.unref)(a).widgetActionsDialog.props.widgetId,'current-actions':(0,m.unref)(a).widgetActionsDialog.props.currentActions,onClose:(0,m.unref)(a).closeWidgetActionsDialog},null,8,['visible','widget-id','current-actions','onClose']),(0,m.createCommentVNode)(' 头像管理弹窗 (RelationshipGraph 使用) '),(0,m.createVNode)((0,m.unref)(pv),{visible:(0,m.unref)(a).avatarManagerDialog.visible,nodes:(0,m.unref)(a).avatarManagerDialog.props.nodes,factions:(0,m.unref)(a).avatarManagerDialog.props.factions,onClose:(0,m.unref)(a).closeAvatarManagerDialog,onUpdate:(0,m.unref)(a).handleAvatarManagerUpdate,onLabelChange:(0,m.unref)(a).handleAvatarManagerLabelChange},null,8,['visible','nodes','factions','onClose','onUpdate','onLabelChange']),(0,m.createCommentVNode)(' 节点配置弹窗 (RelationshipGraph 使用) '),(0,m.createVNode)((0,m.unref)(Ih),{visible:(0,m.unref)(a).nodeConfigDialog.visible,'node-id':(0,m.unref)(a).nodeConfigDialog.props.nodeId,'full-name':(0,m.unref)(a).nodeConfigDialog.props.fullName,'current-label':(0,m.unref)(a).nodeConfigDialog.props.currentLabel,'selected-indices':(0,m.unref)(a).nodeConfigDialog.props.selectedIndices,onClose:(0,m.unref)(a).closeNodeConfigDialog,onConfirm:(0,m.unref)(a).handleNodeConfigConfirm,onResetToFullName:(0,m.unref)(a).handleNodeConfigResetToFullName,onStyleUpdate:(0,m.unref)(a).handleNodeConfigStyleUpdate},null,8,['visible','node-id','full-name','current-label','selected-indices','onClose','onConfirm','onResetToFullName','onStyleUpdate']),(0,m.createCommentVNode)(' 姓名选择弹窗 (AvatarManagerDialog 使用) '),(0,m.createVNode)((0,m.unref)(Oh),{visible:(0,m.unref)(a).nodeLabelDialog.visible,'full-name':(0,m.unref)(a).nodeLabelDialog.props.fullName,'initial-indices':(0,m.unref)(a).nodeLabelDialog.props.initialIndices,onClose:(0,m.unref)(a).closeNodeLabelDialog,onApply:(0,m.unref)(a).handleNodeLabelApply,onReset:(0,m.unref)(a).handleNodeLabelReset},null,8,['visible','full-name','initial-indices','onClose','onApply','onReset']),(0,m.createCommentVNode)(' 关系图设置弹窗 (RelationshipGraph 使用) '),(0,m.createVNode)((0,m.unref)(nh),{visible:(0,m.unref)(a).graphSettingsDialog.visible,factions:(0,m.unref)(a).graphSettingsDialog.props.factions,onClose:(0,m.unref)(a).closeGraphSettingsDialog,onOpenAvatarManager:be},null,8,['visible','factions','onClose']),(0,m.createCommentVNode)(' 势力设置弹窗 (RelationshipGraph 使用) '),(0,m.createVNode)((0,m.unref)(Fv),{visible:(0,m.unref)(a).factionSettingsDialog.visible,'faction-id':(0,m.unref)(a).factionSettingsDialog.props.factionId,'faction-name':(0,m.unref)(a).factionSettingsDialog.props.factionName,onClose:(0,m.unref)(a).closeFactionSettingsDialog},null,8,['visible','faction-id','faction-name','onClose']),(0,m.createCommentVNode)(' 标签管理器弹窗 (WidgetSettingsDialog 使用) '),(0,m.createVNode)((0,m.unref)(Sk),{visible:(0,m.unref)(a).tagManagerDialog.visible,'widget-id':(0,m.unref)(a).tagManagerDialog.props.widgetId,'displayed-tag-ids':(0,m.unref)(a).tagManagerDialog.props.displayedTagIds,'displayed-category-ids':(0,m.unref)(a).tagManagerDialog.props.displayedCategoryIds,onClose:(0,m.unref)(a).closeTagManagerDialog,onSave:(0,m.unref)(a).handleTagManagerSave},null,8,['visible','widget-id','displayed-tag-ids','displayed-category-ids','onClose','onSave']),(0,m.createCommentVNode)(' 分类选择弹窗 (DashboardWidget 使用) '),(0,m.createVNode)((0,m.unref)(Zk),{visible:(0,m.unref)(a).categorySelectDialog.visible,'category-id':(0,m.unref)(a).categorySelectDialog.props.categoryId,'row-context':(0,m.unref)(a).categorySelectDialog.props.rowContext,'widget-id':(0,m.unref)(a).categorySelectDialog.props.widgetId,onClose:(0,m.unref)(a).closeCategorySelectDialog,onSelect:ke},null,8,['visible','category-id','row-context','widget-id','onClose']),(0,m.createCommentVNode)(' 标签二次编辑弹窗 (DashboardWidget 使用) '),(0,m.createVNode)((0,m.unref)(gC),{visible:(0,m.unref)(a).tagPreEditDialog.visible,'tag-label':(0,m.unref)(a).tagPreEditDialog.props.tagLabel,'resolved-prompt':(0,m.unref)(a).tagPreEditDialog.props.resolvedPrompt,'show-companions':(0,m.unref)(a).tagPreEditDialog.props.showCompanions,'widget-id':(0,m.unref)(a).tagPreEditDialog.props.widgetId,onClose:(0,m.unref)(a).closeTagPreEditDialog},null,8,['visible','tag-label','resolved-prompt','show-companions','widget-id','onClose']),(0,m.createCommentVNode)(' 预设保存弹窗 (全局) '),(0,m.createVNode)((0,m.unref)(Hc),{visible:(0,m.unref)(a).presetSaveDialog.visible,'preset-type':(0,m.unref)(a).presetSaveDialog.props.presetType,'summary-items':(0,m.unref)(a).presetSaveDialog.props.summaryItems,'initial-name':(0,m.unref)(a).presetSaveDialog.props.initialName,'check-duplicate':(0,m.unref)(a).presetSaveDialog.props.checkDuplicate,'onUpdate:visible':(0,m.unref)(a).closePresetSaveDialog,onSave:(0,m.unref)(a).handlePresetSave},null,8,['visible','preset-type','summary-items','initial-name','check-duplicate','onUpdate:visible','onSave']),(0,m.createCommentVNode)(' 抽签覆盖层 '),(0,m.createVNode)((0,m.unref)(Jx),{visible:(0,m.unref)(a).divinationOverlay.visible,result:(0,m.unref)(a).divinationOverlay.result,onClose:(0,m.unref)(a).closeDivinationOverlay,onRetry:(0,m.unref)(T),onConfirm:Re},null,8,['visible','result','onClose','onRetry']),(0,m.createCommentVNode)(' 隐藏提示词编辑弹窗 '),(0,m.createVNode)((0,m.unref)(vw),{visible:(0,m.unref)(a).promptEditorDialog.visible,prompt:(0,m.unref)(a).promptEditorDialog.props.prompt,onClose:(0,m.unref)(a).closePromptEditorDialog,onSave:We},null,8,['visible','prompt','onClose']),(0,m.createCommentVNode)(' 添加表格弹窗 (TableStatusBoard 使用) '),(0,m.createVNode)((0,m.unref)(ri),{visible:(0,m.unref)(a).addTableDialog.visible,'onUpdate:visible':n[14]||(n[14]=e=>(0,m.unref)(a).addTableDialog.visible=e),onConfirm:(0,m.unref)(a).handleAddTableConfirm},null,8,['visible','onConfirm']),(0,m.createCommentVNode)(' 全局图标选择弹窗 '),(0,m.createVNode)((0,m.unref)(jl),{visible:(0,m.unref)(a).iconSelectDialog.visible,'current-icon':(0,m.unref)(a).iconSelectDialog.props.currentIcon,'onUpdate:visible':(0,m.unref)(a).closeIconSelectDialog,onSelect:(0,m.unref)(a).handleIconSelect},null,8,['visible','current-icon','onUpdate:visible','onSelect']),(0,m.createCommentVNode)(' 标签预览浮窗 (全局) '),(0,m.createVNode)((0,m.unref)(vC)),(0,m.createCommentVNode)(' 全局 Toast 通知 '),(0,m.createVNode)((0,m.unref)(nw),{visible:(0,m.unref)(x).visible,message:(0,m.unref)(x).message,type:(0,m.unref)(x).type},null,8,['visible','message','type'])],2))}}),hC=bC;i({holdToDrag:300,dragImageTranslateOverride:l}),window.$=window.parent.$;const xC='acu-parent-container',wC='acu_win_config',yC='acu_active_tab',kC='acu_ui_collapse_state';let CC=null,NC=null,VC=null,EC=!1,BC=!1;function TC(){!function(){try{const e=localStorage.getItem(wC);if(!e){const e={width:400,left:'50%',bottom:'50%',isCentered:!0};return localStorage.setItem(wC,JSON.stringify(e)),localStorage.removeItem(yC),localStorage.setItem(kC,'false'),void console.info('[ACU] 首次加载：设置居中模式，清除 activeTab')}const t=JSON.parse(e);!0===t?.isCentered&&(localStorage.removeItem(yC),localStorage.setItem(kC,'false'),console.info('[ACU] 居中模式：清除 activeTab，确保面板展开'))}catch(e){const t={width:400,left:'50%',bottom:'50%',isCentered:!0};localStorage.setItem(wC,JSON.stringify(t)),localStorage.removeItem(yC),localStorage.setItem(kC,'false'),console.warn('[ACU] 解析 win_config 失败，重置为居中模式:',e)}}();(0,We.X0)().loadConfig(),console.info('[ACU] 配置已同步加载'),new Promise(e=>{let t=0;const a=()=>{if(EC)return void console.info('[ACU] 脚本正在卸载，停止数据库 API 检查');const{$,getDB:o}=(0,v.M1)(),n=o();if(n&&'function'==typeof n.exportTableAsJson&&$){const o=n.exportTableAsJson();if(!(o&&Object.keys(o).length>0)&&t<10)return t++,console.info(`[ACU] 数据库 API 就绪但无数据，等待中... (${t}/10)`),void(VC=setTimeout(a,1e3));VC=null,BC=!0,e()}else VC=setTimeout(a,1e3)};a()}).then(()=>{console.info('[ACU] 数据库 API 就绪')}),function(){const e=window.parent.document;if(e.getElementById(xC))return void console.warn('[ACU] Vue 应用已存在，跳过重复初始化');NC=e.createElement('div'),NC.id=xC,e.body.appendChild(NC);const t=(0,p.createPinia)();CC=(0,m.createApp)(hC),CC.use(t),CC.mount(NC),console.info(`[ACU] Vue 应用已挂载到父窗口 (${xC})`)}()}$(()=>{console.info(`[ACU] v${Jc} 脚本加载`),replaceScriptButtons([{name:'🎴 隐藏提示词',visible:!0}]),eventOn(getButtonEvent('🎴 隐藏提示词'),()=>{if(!CC)return void console.warn('[ACU] Vue 应用尚未初始化');const e=(0,k.j_)(),t=window.__acu_hidden_prompt||'';e.openPromptEditorDialog(t)}),eventOn('generation_started',()=>{if(!CC)return;const e=(0,Ot.E)();e.config.enableWordPool&&e.config.autoSync&&(console.info('[ACU] 酒馆 AI 生成开始，触发随机词库同步...'),e.syncFromACU())}),setTimeout(()=>{ve(),ye()},500),errorCatched(TC)(),$(window).on('pagehide',()=>{console.info('[ACU] 页面卸载，执行清理'),be(),console.info('[ACU] 开始清理资源...'),EC=!0,null!==VC&&(clearTimeout(VC),VC=null,console.info('[ACU] 数据库检查定时器已清除')),CC&&(CC.unmount(),CC=null,console.info('[ACU] Vue 应用已卸载')),NC&&(NC.remove(),NC=null,console.info('[ACU] 挂载点已移除')),console.info('[ACU] 资源清理完成')})});
//# sourceMappingURL=index.js.map