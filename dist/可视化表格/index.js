import{createPinia as e,defineStore as a}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';import{klona as t}from'https://testingcf.jsdelivr.net/npm/klona/+esm';import{default as o}from'https://testingcf.jsdelivr.net/npm/cytoscape/+esm';import{default as n}from'https://testingcf.jsdelivr.net/npm/cytoscape-fcose/+esm';var r={61(e){e.exports=Vue},66(e,a,t){t.r(a),t.d(a,{default:()=>c});var o=t(492),n=t.n(o),r=t(748),i=t.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const c=i},99(e,a,t){t.d(a,{d:()=>d,toast:()=>p});var o=t(61);const n=(0,o.ref)({visible:!1,message:'',type:'info',timer:null});function r(e,a='info',t=3e3){n.value.timer&&clearTimeout(n.value.timer),n.value.visible=!0,n.value.message=e,n.value.type=a,n.value.timer=setTimeout(()=>{n.value.visible=!1,n.value.timer=null},t)}function i(){n.value.timer&&clearTimeout(n.value.timer),n.value.visible=!1,n.value.timer=null}function c(e,a=3e3){r(e,'success',a)}function l(e,a=4e3){r(e,'error',a)}function s(e,a=3500){r(e,'warning',a)}function u(e,a=3e3){r(e,'info',a)}function d(){return{state:n,show:r,hide:i,success:c,error:l,warning:s,info:u}}const p={show:r,hide:i,success:c,error:l,warning:s,info:u}},104(e,a,t){t.r(a),t.d(a,{default:()=>c});var o=t(492),n=t.n(o),r=t(748),i=t.n(r)()(n());i.push([e.id,'.acu-dashboard-sort-modal{width:400px;max-width:90vw;display:flex;flex-direction:column;max-height:80vh}.acu-dashboard-sort-modal .acu-modal-body{flex:1;overflow-y:auto;padding:var(--acu-space-md)}.acu-dashboard-sort-modal .acu-sort-hint{color:var(--acu-text-sub);font-size:.9em;margin-bottom:var(--acu-space-sm);text-align:center}','',{version:3,sources:['webpack://./src/可视化表格/components/dialogs/DashboardSortDialog.vue'],names:[],mappings:'AAGA,0BACE,WAAA,CACA,cAAA,CACA,YAAA,CACA,qBAAA,CACA,eAAA,CAEA,0CACE,MAAA,CACA,eAAA,CACA,2BAAA,CAGF,yCACE,yBAAA,CACA,cAAA,CACA,iCAAA,CACA,iBAAA',sourcesContent:['\n/* 样式将通过 styles/overlays/dialogs.scss 统一管理，\n   或者在此处使用非 scoped 样式但需注意命名空间 */\n.acu-dashboard-sort-modal {\n  width: 400px;\n  max-width: 90vw;\n  display: flex;\n  flex-direction: column;\n  max-height: 80vh;\n\n  .acu-modal-body {\n    flex: 1;\n    overflow-y: auto;\n    padding: var(--acu-space-md);\n  }\n\n  .acu-sort-hint {\n    color: var(--acu-text-sub);\n    font-size: 0.9em;\n    margin-bottom: var(--acu-space-sm);\n    text-align: center;\n  }\n}\n'],sourceRoot:''}]);const c=i},219(e,a,t){var o=t(462);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,t(424).A)('62c2674a',o,!1,{ssrId:!0})},245(e,a,t){var o=t(66);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,t(424).A)('a73032ac',o,!1,{ssrId:!0})},286(e,a,t){t.r(a),t.d(a,{default:()=>c});var o=t(492),n=t.n(o),r=t(748),i=t.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const c=i},294(e,a,t){var o=t(695);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,t(424).A)('0671e0e2',o,!1,{ssrId:!0})},295(e,a,t){t.r(a),t.d(a,{default:()=>c});var o=t(492),n=t.n(o),r=t(748),i=t.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const c=i},319(e,a,t){t.r(a),t.d(a,{default:()=>c});var o=t(492),n=t.n(o),r=t(748),i=t.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const c=i},393(e,a,t){t.r(a),t.d(a,{default:()=>c});var o=t(492),n=t.n(o),r=t(748),i=t.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const c=i},424(e,a,t){function o(e,a){for(var t=[],o={},n=0;n<a.length;n++){var r=a[n],i=r[0],c={id:e+':'+n,css:r[1],media:r[2],sourceMap:r[3]};o[i]?o[i].parts.push(c):t.push(o[i]={id:i,parts:[c]})}return t}t.d(a,{A:()=>g});var n='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!n)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var r={},i=n&&(document.head||document.getElementsByTagName('head')[0]),c=null,l=0,s=!1,u=function(){},d=null,p='data-vue-ssr-id',m='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function g(e,a,t,n){s=t,d=n||{};var i=o(e,a);return b(i),function(a){for(var t=[],n=0;n<i.length;n++){var c=i[n];(l=r[c.id]).refs--,t.push(l)}a?b(i=o(e,a)):i=[];for(n=0;n<t.length;n++){var l;if(0===(l=t[n]).refs){for(var s=0;s<l.parts.length;s++)l.parts[s]();delete r[l.id]}}}}function b(e){for(var a=0;a<e.length;a++){var t=e[a],o=r[t.id];if(o){o.refs++;for(var n=0;n<o.parts.length;n++)o.parts[n](t.parts[n]);for(;n<t.parts.length;n++)o.parts.push(v(t.parts[n]));o.parts.length>t.parts.length&&(o.parts.length=t.parts.length)}else{var i=[];for(n=0;n<t.parts.length;n++)i.push(v(t.parts[n]));r[t.id]={id:t.id,refs:1,parts:i}}}}function f(){var e=document.createElement('style');return e.type='text/css',i.appendChild(e),e}function v(e){var a,t,o=document.querySelector('style['+p+'~="'+e.id+'"]');if(o){if(s)return u;o.parentNode.removeChild(o)}if(m){var n=l++;o=c||(c=f()),a=w.bind(null,o,n,!1),t=w.bind(null,o,n,!0)}else o=f(),a=y.bind(null,o),t=function(){o.parentNode.removeChild(o)};return a(e),function(o){if(o){if(o.css===e.css&&o.media===e.media&&o.sourceMap===e.sourceMap)return;a(e=o)}else t()}}var h,x=(h=[],function(e,a){return h[e]=a,h.filter(Boolean).join('\n')});function w(e,a,t,o){var n=t?'':o.css;if(e.styleSheet)e.styleSheet.cssText=x(a,n);else{var r=document.createTextNode(n),i=e.childNodes;i[a]&&e.removeChild(i[a]),i.length?e.insertBefore(r,i[a]):e.appendChild(r)}}function y(e,a){var t=a.css,o=a.media,n=a.sourceMap;if(o&&e.setAttribute('media',o),d.ssrId&&e.setAttribute(p,a.id),n&&(t+='\n/*# sourceURL='+n.sources[0]+' */',t+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+' */'),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},428(e,a,t){t.r(a),t.d(a,{default:()=>c});var o=t(492),n=t.n(o),r=t(748),i=t.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const c=i},455(e,a){a.A=(e,a)=>{const t=e.__vccOpts||e;for(const[e,o]of a)t[e]=o;return t}},462(e,a,t){t.r(a),t.d(a,{default:()=>c});var o=t(492),n=t.n(o),r=t(748),i=t.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const c=i},492(e){e.exports=function(e){var a=e[1],t=e[3];if(!t)return a;if('function'==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),n='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(o),r='/*# '.concat(n,' */');return[a].concat([r]).join('\n')}return[a].join('\n')}},499(e,a,t){var o=t(428);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,t(424).A)('6fa54390',o,!1,{ssrId:!0})},574(e,a,t){var o=t(393);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,t(424).A)('101ec2bd',o,!1,{ssrId:!0})},586(e,a,t){var o=t(295);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,t(424).A)('3470240e',o,!1,{ssrId:!0})},695(e,a,t){t.r(a),t.d(a,{default:()=>c});var o=t(492),n=t.n(o),r=t(748),i=t.n(r)()(n());i.push([e.id,'','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const c=i},727(e,a,t){var o=t(104);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,t(424).A)('4313c879',o,!1,{ssrId:!0})},748(e){e.exports=function(e){var a=[];return a.toString=function(){return this.map(function(a){var t='',o=void 0!==a[5];return a[4]&&(t+='@supports ('.concat(a[4],') {')),a[2]&&(t+='@media '.concat(a[2],' {')),o&&(t+='@layer'.concat(a[5].length>0?' '.concat(a[5]):'',' {')),t+=e(a),o&&(t+='}'),a[2]&&(t+='}'),a[4]&&(t+='}'),t}).join('')},a.i=function(e,t,o,n,r){'string'==typeof e&&(e=[[null,e,void 0]]);var i={};if(o)for(var c=0;c<this.length;c++){var l=this[c][0];null!=l&&(i[l]=!0)}for(var s=0;s<e.length;s++){var u=[].concat(e[s]);o&&i[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]='@layer'.concat(u[5].length>0?' '.concat(u[5]):'',' {').concat(u[1],'}')),u[5]=r),t&&(u[2]?(u[1]='@media '.concat(u[2],' {').concat(u[1],'}'),u[2]=t):u[2]=t),n&&(u[4]?(u[1]='@supports ('.concat(u[4],') {').concat(u[1],'}'),u[4]=n):u[4]=''.concat(n)),a.push(u))}},a}},773(e,a,t){var o=t(286);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,t(424).A)('37294153',o,!1,{ssrId:!0})},791(e,a,t){t.r(a),t.d(a,{default:()=>c});var o=t(492),n=t.n(o),r=t(748),i=t.n(r)()(n());i.push([e.id,'\n','',{version:3,sources:[],names:[],mappings:'',sourceRoot:''}]);const c=i},872(e,a,t){var o=t(319);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,t(424).A)('1a484ef4',o,!1,{ssrId:!0})},939(e,a,t){var o=t(791);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,t(424).A)('cc241a6e',o,!1,{ssrId:!0})}},i={};function c(e){var a=i[e];if(void 0!==a)return a.exports;var t=i[e]={id:e,exports:{}};return r[e](t,t.exports,c),t.exports}c.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return c.d(a,{a}),a},c.d=(e,a)=>{for(var t in a)c.o(a,t)&&!c.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})},c.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),c.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};var l=c(61);function s(e){return!!(0,l.getCurrentScope)()&&((0,l.onScopeDispose)(e),!0)}const u='undefined'!=typeof window&&'undefined'!=typeof document,d=('undefined'!=typeof WorkerGlobalScope&&(globalThis,WorkerGlobalScope),Object.prototype.toString),p=e=>'[object Object]'===d.call(e),m=()=>{},g=b();function b(){var e,a;return u&&(null==(e=null==window?void 0:window.navigator)?void 0:e.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||(null==(a=null==window?void 0:window.navigator)?void 0:a.maxTouchPoints)>2&&/iPad|Macintosh/.test(null==window?void 0:window.navigator.userAgent))}function f(...e){if(1!==e.length)return(0,l.toRef)(...e);const a=e[0];return'function'==typeof a?(0,l.readonly)((0,l.customRef)(()=>({get:a,set:m}))):(0,l.ref)(a)}function v(e,a){return function(...t){return new Promise((o,n)=>{Promise.resolve(e(()=>a.apply(this,t),{fn:a,thisArg:this,args:t})).then(o).catch(n)})}}const h=e=>e();function x(e,a={}){let t,o,n=m;const r=e=>{clearTimeout(e),n(),n=m};let i;return c=>{const s=(0,l.toValue)(e),u=(0,l.toValue)(a.maxWait);return t&&r(t),s<=0||void 0!==u&&u<=0?(o&&(r(o),o=void 0),Promise.resolve(c())):new Promise((e,l)=>{n=a.rejectOnCancel?l:e,i=c,u&&!o&&(o=setTimeout(()=>{t&&r(t),o=void 0,e(i())},u)),t=setTimeout(()=>{o&&r(o),o=void 0,e(c())},s)})}}function w(e){return Array.isArray(e)?e:[e]}function y(e){const a=Object.create(null);return t=>a[t]||(a[t]=e(t))}const k=/\B([A-Z])/g,C=(y(e=>e.replace(k,'-$1').toLowerCase()),/-(\w)/g);y(e=>e.replace(C,(_,e)=>e?e.toUpperCase():''));function N(e){return e||(0,l.getCurrentInstance)()}function V(e,a=200,t={}){return v(x(a,t),e)}function E(e,a,t={}){const{eventFilter:o=h,...n}=t;return(0,l.watch)(e,v(o,a),n)}function B(e,a,t={}){const{eventFilter:o,initialState:n='active',...r}=t,{eventFilter:i,pause:c,resume:s,isActive:u}=function(e=h,a={}){const{initialState:t='active'}=a,o=f('active'===t);return{isActive:(0,l.readonly)(o),pause:function(){o.value=!1},resume:function(){o.value=!0},eventFilter:(...a)=>{o.value&&e(...a)}}}(o,{initialState:n});return{stop:E(e,a,{...r,eventFilter:i}),pause:c,resume:s,isActive:u}}function S(e,a={}){if(!(0,l.isRef)(e))return(0,l.toRefs)(e);const t=Array.isArray(e.value)?Array.from({length:e.value.length}):{};for(const o in e.value)t[o]=(0,l.customRef)(()=>({get:()=>e.value[o],set(t){var n;if(null==(n=(0,l.toValue)(a.replaceRef))||n)if(Array.isArray(e.value)){const a=[...e.value];a[o]=t,e.value=a}else{const a={...e.value,[o]:t};Object.setPrototypeOf(a,Object.getPrototypeOf(e.value)),e.value=a}else e.value[o]=t}}));return t}function A(e,a,t={}){const{immediate:o=!0,immediateCallback:n=!1}=t,r=(0,l.shallowRef)(!1);let i;function c(){i&&(clearTimeout(i),i=void 0)}function d(){r.value=!1,c()}function p(...t){n&&e(),c(),r.value=!0,i=setTimeout(()=>{r.value=!1,i=void 0,e(...t)},(0,l.toValue)(a))}return o&&(r.value=!0,u&&p()),s(d),{isPending:(0,l.shallowReadonly)(r),start:p,stop:d}}const T=u?window:void 0,U=(u&&window.document,u?window.navigator:void 0);u&&window.location;function D(e){var a;const t=(0,l.toValue)(e);return null!=(a=null==t?void 0:t.$el)?a:t}function I(...e){const a=[],t=()=>{a.forEach(e=>e()),a.length=0},o=(0,l.computed)(()=>{const a=w((0,l.toValue)(e[0])).filter(e=>null!=e);return a.every(e=>'string'!=typeof e)?a:void 0}),n=(r=()=>{var a,t;return[null!=(t=null==(a=o.value)?void 0:a.map(e=>D(e)))?t:[T].filter(e=>null!=e),w((0,l.toValue)(o.value?e[1]:e[0])),w((0,l.unref)(o.value?e[2]:e[1])),(0,l.toValue)(o.value?e[3]:e[2])]},i=([e,o,n,r])=>{if(t(),!(null==e?void 0:e.length)||!(null==o?void 0:o.length)||!(null==n?void 0:n.length))return;const i=p(r)?{...r}:r;a.push(...e.flatMap(e=>o.flatMap(a=>n.map(t=>((e,a,t,o)=>(e.addEventListener(a,t,o),()=>e.removeEventListener(a,t,o)))(e,a,t,i)))))},c={flush:'post'},(0,l.watch)(r,i,{...c,immediate:!0}));var r,i,c;return s(t),()=>{n(),t()}}let M=!1;function j(e,a,t={}){const{window:o=T,ignore:n=[],capture:r=!0,detectIframe:i=!1,controls:c=!1}=t;if(!o)return c?{stop:m,cancel:m,trigger:m}:m;if(g&&!M){M=!0;const e={passive:!0};Array.from(o.document.body.children).forEach(a=>a.addEventListener('click',m,e)),o.document.documentElement.addEventListener('click',m,e)}let s=!0;const u=e=>(0,l.toValue)(n).some(a=>{if('string'==typeof a)return Array.from(o.document.querySelectorAll(a)).some(a=>a===e.target||e.composedPath().includes(a));{const t=D(a);return t&&(e.target===t||e.composedPath().includes(t))}});const d=t=>{const o=D(e);null!=t.target&&(o instanceof Element||!function(e){const a=(0,l.toValue)(e);return a&&16===a.$.subTree.shapeFlag}(e)||!function(e,a){const t=(0,l.toValue)(e),o=t.$.subTree&&t.$.subTree.children;return!(null==o||!Array.isArray(o))&&o.some(e=>e.el===a.target||a.composedPath().includes(e.el))}(e,t))&&o&&o!==t.target&&!t.composedPath().includes(o)&&('detail'in t&&0===t.detail&&(s=!u(t)),s?a(t):s=!0)};let p=!1;const b=[I(o,'click',e=>{p||(p=!0,setTimeout(()=>{p=!1},0),d(e))},{passive:!0,capture:r}),I(o,'pointerdown',a=>{const t=D(e);s=!u(a)&&!(!t||a.composedPath().includes(t))},{passive:!0}),i&&I(o,'blur',t=>{setTimeout(()=>{var n;const r=D(e);'IFRAME'!==(null==(n=o.document.activeElement)?void 0:n.tagName)||(null==r?void 0:r.contains(o.document.activeElement))||a(t)},0)},{passive:!0})].filter(Boolean),f=()=>b.forEach(e=>e());return c?{stop:f,cancel:()=>{s=!1},trigger:e=>{s=!0,d(e),s=!1}}:f}function F(e){const a=function(){const e=(0,l.shallowRef)(!1),a=(0,l.getCurrentInstance)();return a&&(0,l.onMounted)(()=>{e.value=!0},a),e}();return(0,l.computed)(()=>(a.value,Boolean(e())))}Symbol('vueuse-ssr-width');function P(e,a={}){const{controls:t=!1,navigator:o=U}=a,n=F(()=>o&&'permissions'in o),r=(0,l.shallowRef)(),i='string'==typeof e?{name:e}:e,c=(0,l.shallowRef)(),s=()=>{var e,a;c.value=null!=(a=null==(e=r.value)?void 0:e.state)?a:'prompt'};I(r,'change',s,{passive:!0});const u=function(e){let a;function t(){return a||(a=e()),a}return t.reset=async()=>{const e=a;a=void 0,e&&await e},t}(async()=>{if(n.value){if(!r.value)try{r.value=await o.permissions.query(i)}catch(e){r.value=void 0}finally{s()}return t?(0,l.toRaw)(r.value):void 0}});return u(),t?{state:c,isSupported:n,query:u}:c}function L(e={}){const{navigator:a=U,read:t=!1,source:o,copiedDuring:n=1500,legacy:r=!1}=e,i=F(()=>a&&'clipboard'in a),c=P('clipboard-read'),s=P('clipboard-write'),u=(0,l.computed)(()=>i.value||r),d=(0,l.shallowRef)(''),p=(0,l.shallowRef)(!1),m=A(()=>p.value=!1,n,{immediate:!1});function g(e){return'granted'===e||'prompt'===e}return u.value&&t&&I(['copy','cut'],async function(){let e=!(i.value&&g(c.value));if(!e)try{d.value=await a.clipboard.readText()}catch(a){e=!0}var t,o,n;e&&(d.value=null!=(n=null==(o=null==(t=null==document?void 0:document.getSelection)?void 0:t.call(document))?void 0:o.toString())?n:'')},{passive:!0}),{isSupported:u,text:d,copied:p,copy:async function(e=(0,l.toValue)(o)){if(u.value&&null!=e){let t=!(i.value&&g(s.value));if(!t)try{await a.clipboard.writeText(e)}catch(e){t=!0}t&&function(e){const a=document.createElement('textarea');a.value=null!=e?e:'',a.style.position='absolute',a.style.opacity='0',document.body.appendChild(a),a.select(),document.execCommand('copy'),a.remove()}(e),d.value=e,p.value=!0,m.start()}}}}const R='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:'undefined'!=typeof globalThis?globalThis:'undefined'!=typeof self?self:{},O='__vueuse_ssr_handlers__',H=G();function G(){return O in R||(R[O]=R[O]||{}),R[O]}function Y(e,a){return H[e]||a}function W(e){return null==e?'any':e instanceof Set?'set':e instanceof Map?'map':e instanceof Date?'date':'boolean'==typeof e?'boolean':'string'==typeof e?'string':'object'==typeof e?'object':Number.isNaN(e)?'any':'number'}const q={boolean:{read:e=>'true'===e,write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},X='vueuse-storage';function K(e,a,t,o={}){var n;const{flush:r='pre',deep:i=!0,listenToStorageChanges:c=!0,writeDefaults:s=!0,mergeDefaults:u=!1,shallow:d,window:p=T,eventFilter:m,onError:g=e=>{console.error(e)},initOnMounted:b}=o,f=(d?l.shallowRef:l.ref)('function'==typeof a?a():a),v=(0,l.computed)(()=>(0,l.toValue)(e));if(!t)try{t=Y('getDefaultStorage',()=>{var e;return null==(e=T)?void 0:e.localStorage})()}catch(e){g(e)}if(!t)return f;const h=(0,l.toValue)(a),x=W(h),w=null!=(n=o.serializer)?n:q[x],{pause:y,resume:k}=B(f,e=>function(e){try{const a=t.getItem(v.value);if(null==e)E(a,null),t.removeItem(v.value);else{const o=w.write(e);a!==o&&(t.setItem(v.value,o),E(a,o))}}catch(e){g(e)}}(e),{flush:r,deep:i,eventFilter:m});(0,l.watch)(v,()=>S(),{flush:r});let C=!1;const V=e=>{b&&!C||S(e.detail)};function E(e,a){if(p){const o={key:v.value,oldValue:e,newValue:a,storageArea:t};p.dispatchEvent(t instanceof Storage?new StorageEvent('storage',o):new CustomEvent(X,{detail:o}))}}function S(e){if(!e||e.storageArea===t)if(e&&null==e.key)f.value=h;else if(!e||e.key===v.value){y();try{const a=w.write(f.value);void 0!==e&&(null==e?void 0:e.newValue)===a||(f.value=function(e){const a=e?e.newValue:t.getItem(v.value);if(null==a)return s&&null!=h&&t.setItem(v.value,w.write(h)),h;if(!e&&u){const e=w.read(a);return'function'==typeof u?u(e,h):'object'!==x||Array.isArray(e)?e:{...h,...e}}return'string'!=typeof a?a:w.read(a)}(e))}catch(e){g(e)}finally{e?(0,l.nextTick)(k):k()}}}return p&&c&&(t instanceof Storage?I(p,'storage',e=>{b&&!C||S(e)},{passive:!0}):I(p,X,V)),b?function(e,a=!0,t){N(t)?(0,l.onMounted)(e,t):a?e():(0,l.nextTick)(e)}(()=>{C=!0,S()}):S(),f}function J(e,a,t={}){const{window:o=T,...n}=t;let r;const i=F(()=>o&&'ResizeObserver'in o),c=()=>{r&&(r.disconnect(),r=void 0)},u=(0,l.computed)(()=>{const a=(0,l.toValue)(e);return Array.isArray(a)?a.map(e=>D(e)):[D(a)]}),d=(0,l.watch)(u,e=>{if(c(),i.value&&o){r=new ResizeObserver(a);for(const a of e)a&&r.observe(a,n)}},{immediate:!0,flush:'post'}),p=()=>{c(),d()};return s(p),{isSupported:i,stop:p}}function Q(e={}){const{window:a=T}=e,t=(0,l.ref)(null),o=(0,l.computed)(()=>{var e,a;return null!=(a=null==(e=t.value)?void 0:e.toString())?a:''}),n=(0,l.computed)(()=>t.value?function(e){var a;const t=null!=(a=e.rangeCount)?a:0;return Array.from({length:t},(_,a)=>e.getRangeAt(a))}(t.value):[]),r=(0,l.computed)(()=>n.value.map(e=>e.getBoundingClientRect()));return a&&I(a.document,'selectionchange',function(){t.value=null,a&&(t.value=a.getSelection())},{passive:!0}),{text:o,rects:r,ranges:n,selection:t}}Number.POSITIVE_INFINITY;const Z='acu_visualizer_ui',ee={type:'icon',content:'fa-layer-group',size:50,notifyAnimation:'ripple',borderColor:'#ffffff',borderOpacity:40,bgColor:'#ffffff',bgOpacity:25},ae=[{id:'save',icon:'fa-save',label:'保存'},{id:'saveAs',icon:'fa-file-export',label:'另存为'},{id:'undo',icon:'fa-undo',label:'撤回'},{id:'refresh',icon:'fa-sync-alt',label:'刷新'},{id:'manualUpdate',icon:'fa-hand-sparkles',label:'手动更新'},{id:'purge',icon:'fa-eraser',label:'清除范围'},{id:'pin',icon:'fa-thumbtack',label:'固定面板'},{id:'toggle',icon:'fa-compress',label:'收起面板'},{id:'openNative',icon:'fa-external-link-alt',label:'原生编辑器'},{id:'collapseTab',icon:'fa-box-open',label:'收纳Tab'},{id:'settings',icon:'fa-cog',label:'设置'}],te=['save','refresh','settings','toggle'],oe=['save','saveAs','undo','refresh','manualUpdate','purge','pin','toggle','openNative','collapseTab','settings'],ne=[],re={theme:'retro',fontFamily:'default',cardWidth:280,fontSize:13,itemsPerPage:20,highlightNew:!0,highlightColor:'orange',highlightManualColor:'orange',highlightAiColor:'blue',customTitleColor:!1,titleColor:'orange',layout:'vertical',limitLongText:!0,showDashboard:!0,showPagination:!0,lockPanel:!1,purgeConfirmation:!0,gridColumns:0,autoSave:!1,autoSaveDelay:5e3,visibleButtons:te,buttonOrder:oe,buttonGroups:ne,longPressDirectExec:!1,clearTableOnSwipe:!0,collapseTabBar:!1},ie=[{id:'retro',name:'复古羊皮',icon:'fa-scroll'},{id:'dark',name:'极夜深空',icon:'fa-moon'},{id:'modern',name:'现代清爽',icon:'fa-sun'},{id:'forest',name:'森之物语',icon:'fa-tree'},{id:'ocean',name:'深海幽蓝',icon:'fa-water'},{id:'cyber',name:'赛博霓虹',icon:'fa-bolt'},{id:'purple',name:'梦幻浅紫',icon:'fa-magic'}],ce=[{id:'default',name:'系统默认 (Modern)',val:'\'Segoe UI\', \'Microsoft YaHei\', sans-serif'},{id:'hanchan',name:'寒蝉全圆体',val:'"寒蝉全圆体", sans-serif'},{id:'maple',name:'Maple Mono (代码风)',val:'"Maple Mono NF CN", monospace'},{id:'huiwen',name:'汇文明朝体 (Huiwen)',val:'"Huiwen-mincho", serif'},{id:'cooper',name:'Cooper正楷',val:'"CooperZhengKai", serif'},{id:'yffyt',name:'YFFYT (艺术体)',val:'"YFFYT", sans-serif'},{id:'fusion',name:'Fusion Pixel (像素风)',val:'"Fusion Pixel 12px M latin", monospace'},{id:'wenkai',name:'霞鹜文楷 (WenKai)',val:'"LXGW WenKai", serif'},{id:'notosans',name:'思源黑体 (Noto Sans)',val:'"Noto Sans CJK", sans-serif'},{id:'zhuque',name:'朱雀仿宋 (Zhuque)',val:'"Zhuque Fangsong (technical preview)", serif'}],le={orange:{main:'#d35400',bg:'rgba(211, 84, 0, 0.1)',name:'活力橙'},red:{main:'#e74c3c',bg:'rgba(231, 76, 60, 0.1)',name:'警示红'},blue:{main:'#3498db',bg:'rgba(52, 152, 219, 0.1)',name:'天空蓝'},green:{main:'#27ae60',bg:'rgba(39, 174, 96, 0.1)',name:'自然绿'},purple:{main:'#9b59b6',bg:'rgba(155, 89, 182, 0.1)',name:'罗兰紫'},teal:{main:'#1abc9c',bg:'rgba(26, 188, 156, 0.1)',name:'青绿'},pink:{main:'#e91e63',bg:'rgba(233, 30, 99, 0.1)',name:'少女粉'},lime:{main:'#82c91e',bg:'rgba(130, 201, 30, 0.1)',name:'酸橙'},indigo:{main:'#3f51b5',bg:'rgba(63, 81, 181, 0.1)',name:'靛蓝'},cyan:{main:'#00bcd4',bg:'rgba(0, 188, 212, 0.1)',name:'青色'},brown:{main:'#795548',bg:'rgba(121, 85, 72, 0.1)',name:'咖啡'},grey:{main:'#607d8b',bg:'rgba(96, 125, 139, 0.1)',name:'蓝灰'}},se=a('acu-config',()=>{const e=K('acu_ui_config_v18',re,localStorage,{mergeDefaults:!0}),a=(0,l.computed)(()=>e.value.theme),t=(0,l.computed)(()=>e.value.fontFamily),o=(0,l.computed)(()=>{const a=ce.find(a=>a.id===e.value.fontFamily);return a?.val||ce[0].val});function n(e){const a=e.startsWith('#')?e:`#${e}`,t=parseInt(a.slice(1,3),16),o=parseInt(a.slice(3,5),16),n=parseInt(a.slice(5,7),16);return{main:a,bg:`rgba(${t}, ${o}, ${n}, 0.1)`,name:'自定义颜色'}}const r=(0,l.computed)(()=>le[e.value.highlightColor]||le.orange),i=(0,l.computed)(()=>{if('custom'===e.value.highlightManualColor&&e.value.customHighlightManualHex)return n(e.value.customHighlightManualHex);const a=e.value.highlightManualColor||e.value.highlightColor;return le[a]||le.orange}),c=(0,l.computed)(()=>{if('custom'===e.value.highlightAiColor&&e.value.customHighlightAiHex)return n(e.value.customHighlightAiHex);const a=e.value.highlightAiColor||'blue';return le[a]||le.blue}),s=(0,l.computed)(()=>e.value.customTitleColor?'custom'===e.value.titleColor&&e.value.customTitleHex?n(e.value.customTitleHex):le[e.value.titleColor]||le.orange:i.value),u=(0,l.computed)(()=>e.value.gridColumns&&e.value.gridColumns>0?`repeat(${e.value.gridColumns}, 1fr)`:'repeat(auto-fill, minmax(110px, 1fr))');function d(a){e.value={...e.value,...a}}const p=(0,l.computed)(()=>{const a=e.value.buttonOrder,t=e.value.visibleButtons;return a.filter(e=>t.includes(e))}),m=(0,l.computed)(()=>{const a=e.value.visibleButtons,t=(e.value.buttonGroups||[]).map(e=>e.secondaryId).filter(Boolean);return ae.filter(e=>!e.hidden&&!a.includes(e.id)&&!t.includes(e.id))}),g=(0,l.computed)(()=>m.value.length>0);const b=(0,l.computed)(()=>e.value.buttonGroups||[]),f=(0,l.computed)(()=>e.value.longPressDirectExec||!1);return{config:e,theme:a,fontFamily:t,fontFamilyValue:o,highlightColorObj:r,highlightManualColorObj:i,highlightAiColorObj:c,titleColorObj:s,gridColumnsCss:u,updateConfig:d,resetConfig:function(){e.value={...re}},setTheme:function(e){d({theme:e})},setFontFamily:function(e){d({fontFamily:e})},setLayout:function(e){d({layout:e})},setHighlightColor:function(e){d({highlightColor:e,highlightManualColor:e})},setHighlightManualColor:function(e){d({highlightManualColor:e,highlightColor:e})},setHighlightAiColor:function(e){d({highlightAiColor:e})},setTitleColor:function(e){d({titleColor:e})},toggleHighlightNew:function(){d({highlightNew:!e.value.highlightNew})},toggleCustomTitleColor:function(){d({customTitleColor:!e.value.customTitleColor})},toggleShowDashboard:function(){d({showDashboard:!e.value.showDashboard})},toggleShowPagination:function(){d({showPagination:!e.value.showPagination})},toggleLockPanel:function(){d({lockPanel:!e.value.lockPanel})},toggleLimitLongText:function(){d({limitLongText:!e.value.limitLongText})},setVisibleButtons:function(a){e.value.visibleButtons=a},setButtonOrder:function(a){e.value.buttonOrder=a},isButtonVisible:function(a){return e.value.visibleButtons.includes(a)},toggleButtonVisibility:function(a){const t=[...e.value.visibleButtons],o=t.indexOf(a);o>-1?t.splice(o,1):t.push(a),e.value.visibleButtons=t},sortedVisibleButtons:p,hiddenButtons:m,hasHiddenButtons:g,getButtonConfig:function(e){return ae.find(a=>a.id===e)},buttonGroups:b,longPressDirectExec:f,setButtonGroups:function(a){e.value.buttonGroups=a},addButtonGroup:function(a,t){const o=(e.value.buttonGroups||[]).filter(e=>e.secondaryId!==t&&e.primaryId!==a);o.push({primaryId:a,secondaryId:t}),e.value.buttonGroups=[...o],console.log('[ACU] addButtonGroup:',a,'->',t,'groups:',e.value.buttonGroups)},removeButtonGroupSecondary:function(a){const t=(e.value.buttonGroups||[]).filter(e=>e.primaryId!==a);e.value.buttonGroups=[...t],console.log('[ACU] removeButtonGroupSecondary:',a,'groups:',e.value.buttonGroups)},getSecondaryButtonId:function(a){const t=(e.value.buttonGroups||[]).find(e=>e.primaryId===a);return t?.secondaryId||null},isSecondaryButton:function(a){return(e.value.buttonGroups||[]).some(e=>e.secondaryId===a)},toggleLongPressDirectExec:function(){e.value.longPressDirectExec=!e.value.longPressDirectExec},setLongPressDirectExec:function(a){e.value.longPressDirectExec=a},resetButtonConfig:function(){e.value.visibleButtons=[...te],e.value.buttonOrder=[...oe],e.value.buttonGroups=[...ne],e.value.longPressDirectExec=!1}}}),ue=a('acu-ball-appearance',()=>{const e=(0,l.ref)({...ee}),a=(0,l.ref)([]),t=(0,l.ref)(!1);function o(){try{if('function'!=typeof getVariables||'function'!=typeof replaceVariables)return void console.warn('[ACU] 脚本变量 API 不可用');const t={...getVariables({type:'script',script_id:Z}),configVersion:1,ballAppearance:e.value,customFonts:a.value};replaceVariables(t,{type:'script',script_id:Z}),console.info('[ACU] 已保存配置到脚本变量')}catch(e){console.error('[ACU] 保存脚本变量失败:',e)}}(0,l.watch)([e,a],()=>{t.value&&o()},{deep:!0});const n=(0,l.computed)(()=>a.value.filter(e=>e.importUrl).map(e=>e.importUrl)),r=(0,l.computed)(()=>[...ce,...a.value.map(e=>({id:e.id,name:e.name,val:e.fontFamily}))]);function i(e,a){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!t)return e;return`rgba(${parseInt(t[1],16)}, ${parseInt(t[2],16)}, ${parseInt(t[3],16)}, ${a/100})`}const c=(0,l.computed)(()=>{const a=e.value;return{'--ball-size':`${a.size}px`,'--ball-border-color':a.borderColor,'--ball-border-color-rgba':i(a.borderColor,a.borderOpacity),'--ball-bg-color':i(a.bgColor,a.bgOpacity)}});return{appearance:e,customFonts:a,isLoaded:t,loadFromScriptVariables:function(){try{if('function'!=typeof getVariables)return console.warn('[ACU] getVariables 不可用，使用默认配置'),void(t.value=!0);const o=getVariables({type:'script',script_id:Z});o?.ballAppearance&&(e.value={...ee,...o.ballAppearance}),o?.customFonts&&(a.value=o.customFonts),t.value=!0,console.info('[ACU] 已从脚本变量加载配置')}catch(e){console.error('[ACU] 加载脚本变量失败:',e),t.value=!0}},saveToScriptVariables:o,updateAppearance:function(a){e.value={...e.value,...a}},setIcon:function(a,t){e.value.type=a,e.value.content=t},setSize:function(a){e.value.size=Math.max(40,Math.min(100,a))},setBorderColor:function(a,t){e.value.borderColor=a,void 0!==t&&(e.value.borderOpacity=t)},setBgColor:function(a,t){e.value.bgColor=a,void 0!==t&&(e.value.bgOpacity=t)},setNotifyAnimation:function(a){e.value.notifyAnimation=a},resetAppearance:function(){e.value={...ee}},addFont:function(e){const t={...e,id:`custom_${Date.now()}`};return a.value.push(t),t},removeFont:function(e){const t=a.value.findIndex(a=>a.id===e);t>-1&&a.value.splice(t,1)},fontImportUrls:n,allFonts:r,cssVariables:c,hexToRgba:i}}),de={bgNav:'--acu-bg-nav',bgPanel:'--acu-bg-panel',cardBg:'--acu-card-bg',tableHead:'--acu-table-head',tableHover:'--acu-table-hover',badgeBg:'--acu-badge-bg',inputBg:'--acu-input-bg',menuBg:'--acu-menu-bg',overlayBg:'--acu-overlay-bg',textMain:'--acu-text-main',textSub:'--acu-text-sub',menuText:'--acu-menu-text',border:'--acu-border',btnBg:'--acu-btn-bg',btnHover:'--acu-btn-hover',btnActiveBg:'--acu-btn-active-bg',btnActiveText:'--acu-btn-active-text',shadow:'--acu-shadow'},pe=[{id:'background',name:'背景色',icon:'fa-fill-drip',vars:[{key:'bgNav',label:'导航栏背景'},{key:'bgPanel',label:'面板背景'},{key:'cardBg',label:'卡片背景'},{key:'tableHead',label:'表头背景'},{key:'tableHover',label:'悬浮背景'},{key:'badgeBg',label:'徽章背景'},{key:'inputBg',label:'输入框背景'},{key:'menuBg',label:'菜单背景'},{key:'overlayBg',label:'遮罩背景'}]},{id:'text',name:'文本色',icon:'fa-font',vars:[{key:'textMain',label:'主文本色'},{key:'textSub',label:'次要文本色'},{key:'menuText',label:'菜单文本色'}]},{id:'button',name:'边框与按钮',icon:'fa-square',vars:[{key:'border',label:'边框色'},{key:'btnBg',label:'按钮背景'},{key:'btnHover',label:'按钮悬浮'},{key:'btnActiveBg',label:'按钮激活背景'},{key:'btnActiveText',label:'按钮激活文本'}]},{id:'effect',name:'效果',icon:'fa-magic',vars:[{key:'shadow',label:'阴影色'}]}],me={goToTable:{id:'goToTable',icon:'fa-external-link-alt',label:'跳转',tooltip:'跳转到表格'},clear:{id:'clear',icon:'fa-eraser',label:'清除',tooltip:'清除表格数据'},undo:{id:'undo',icon:'fa-undo',label:'撤回',tooltip:'撤回上次修改'},manualUpdate:{id:'manualUpdate',icon:'fa-hand-sparkles',label:'更新',tooltip:'手动更新'},relationshipGraph:{id:'relationshipGraph',icon:'fa-project-diagram',label:'关系图',tooltip:'人物关系图'},settings:{id:'settings',icon:'fa-cog',label:'设置',tooltip:'看板设置'}},ge={npc:{type:'table',title:'NPC',icon:'fa-users',displayColumns:['名称','姓名','name','Name','状态','好感度'],maxRows:8,actions:['goToTable','relationshipGraph'],colSpan:1,displayStyle:'grid'},task:{type:'table',title:'任务',icon:'fa-tasks',displayColumns:['名称','任务名','name','Name','类型','状态'],maxRows:5,actions:['goToTable'],colSpan:1,displayStyle:'list'},item:{type:'table',title:'物品',icon:'fa-box-open',displayColumns:['名称','物品名','name','Name','数量'],maxRows:12,actions:['goToTable','clear'],colSpan:1,displayStyle:'grid'},character:{type:'table',title:'主角',icon:'fa-user',displayColumns:[],maxRows:1,actions:['goToTable'],colSpan:2,displayStyle:'list'},location:{type:'table',title:'地点',icon:'fa-map-marker-alt',displayColumns:['名称','地点','name','Name','描述'],maxRows:5,actions:['goToTable'],colSpan:1,displayStyle:'list'}},be={npc:['NPC','npc','人物','角色','关系','好感','重要人物'],task:['任务','Task','task','Quest','quest','日程'],item:['物品','道具','Item','item','背包','库存','装备'],character:['主角','玩家','Player','player','属性','protagonist'],location:['地点','位置','Location','location','场景']},fe='acu_visualizer_ui',ve='acu_theme_presets_v1',he='acu_custom_css_v1',xe={manualColor:'orange',manualHex:'#d35400',aiColor:'blue',aiHex:'#3498db',titleColor:'orange',titleHex:'#d35400'};function we(e,a=.1){const t=e.startsWith('#')?e:`#${e}`;return`rgba(${parseInt(t.slice(1,3),16)}, ${parseInt(t.slice(3,5),16)}, ${parseInt(t.slice(5,7),16)}, ${a})`}function ye(e,a){if('custom'===e&&a)return a;const t=le[e];return t?.main||'#d35400'}const ke=a('acu-theme',()=>{const e=(0,l.ref)([]),a=(0,l.ref)(null),t=(0,l.ref)({}),o=(0,l.ref)({...xe}),n=(0,l.ref)(''),r=(0,l.ref)(!1),i=se(),c=(0,l.computed)(()=>i.config.theme),s=(0,l.computed)(()=>ye(o.value.manualColor,o.value.manualHex)),u=(0,l.computed)(()=>ye(o.value.aiColor,o.value.aiHex)),d=(0,l.computed)(()=>ye(o.value.titleColor,o.value.titleHex)),p=(0,l.computed)(()=>we(d.value,.08)),m=(0,l.computed)(()=>a.value&&e.value.find(e=>e.id===a.value)||null);function g(){try{if(localStorage.setItem(ve,JSON.stringify(e.value)),localStorage.setItem(he,n.value),'function'==typeof getVariables&&'function'==typeof replaceVariables){const t={...getVariables({type:'script',script_id:fe}),themePresets:e.value,activePresetId:a.value||void 0};replaceVariables(t,{type:'script',script_id:fe})}f(),console.info('[ACU Theme] 已保存主题配置')}catch(e){console.error('[ACU Theme] 保存配置失败:',e)}}function b(){const e=i.config;o.value={manualColor:e.highlightManualColor||e.highlightColor||'orange',manualHex:e.customHighlightManualHex,aiColor:e.highlightAiColor||'blue',aiHex:e.customHighlightAiHex,titleColor:e.titleColor||'orange',titleHex:e.customTitleHex}}function f(){i.updateConfig({highlightManualColor:o.value.manualColor,highlightColor:o.value.manualColor,customHighlightManualHex:o.value.manualHex,highlightAiColor:o.value.aiColor,customHighlightAiHex:o.value.aiHex,titleColor:o.value.titleColor,customTitleHex:o.value.titleHex,highlightNew:!0,customTitleColor:!0})}function v(a){const r={id:`preset_${Date.now()}`,name:a,createdAt:(new Date).toISOString(),baseTheme:c.value,themeVars:{...t.value},highlight:{...o.value},customCSS:n.value};return e.value.push(r),g(),r}function h(a,t){const o=e.value.findIndex(e=>e.id===a);o>-1&&(e.value[o]={...e.value[o],...t},g())}function x(){const e=[];for(const[a,o]of Object.entries(t.value))if(o){const t=de[a];t&&e.push(`${t}: ${o};`)}return e.push(`--acu-highlight: ${s.value};`),e.push(`--acu-highlight-manual: ${s.value};`),e.push(`--acu-highlight-manual-bg: ${we(s.value)};`),e.push(`--acu-highlight-ai: ${u.value};`),e.push(`--acu-highlight-ai-bg: ${we(u.value)};`),e.push(`--acu-title-color: ${d.value};`),e.push(`--acu-title-color-bg: ${p.value};`),e.push(`--acu-accent: ${d.value};`),0===e.length?'':`.acu-wrapper { ${e.join(' ')} }`}return(0,l.watch)([o,t,n],()=>{r.value&&g()},{deep:!0}),{presets:e,activePresetId:a,currentThemeVars:t,currentHighlight:o,customCSS:n,isLoaded:r,baseTheme:c,manualHighlightColor:s,aiHighlightColor:u,titleColor:d,titleBgColor:p,activePreset:m,loadFromStorage:function(){try{const t=localStorage.getItem(ve);t&&(e.value=JSON.parse(t));const o=localStorage.getItem(he);if(o&&(n.value=o),'function'==typeof getVariables){const t=getVariables({type:'script',script_id:fe});t?.activePresetId&&(a.value=t.activePresetId),t?.themePresets&&(e.value=t.themePresets)}b(),r.value=!0,console.info('[ACU Theme] 已加载主题配置')}catch(e){console.error('[ACU Theme] 加载配置失败:',e),r.value=!0}},saveToStorage:g,syncFromConfigStore:b,syncToConfigStore:f,createPreset:v,saveCurrentToPreset:function(e){return v(e)},deletePreset:function(t){const o=e.value.findIndex(e=>e.id===t);o>-1&&(e.value.splice(o,1),a.value===t&&(a.value=null),g())},applyPreset:function(r){const c=e.value.find(e=>e.id===r);c&&(i.setTheme(c.baseTheme),t.value={...c.themeVars},o.value={...c.highlight},n.value=c.customCSS||'',a.value=r,g())},updatePreset:h,renamePreset:function(e,a){h(e,{name:a})},setManualHighlightColor:function(e,a){o.value.manualColor=e,o.value.manualHex=a,g()},setAiHighlightColor:function(e,a){o.value.aiColor=e,o.value.aiHex=a,g()},setTitleColor:function(e,a){o.value.titleColor=e,o.value.titleHex=a,g()},setThemeVar:function(e,a){t.value[e]=a},removeThemeVar:function(e){delete t.value[e]},clearThemeVars:function(){t.value={}},setCustomCSS:function(e){n.value=e,g()},clearCustomCSS:function(){n.value='',g()},getInjectedStyles:x,getFullInjectedCSS:function(){return[x(),n.value].filter(Boolean).join('\n\n')}}}),Ce=[{level:'S',name:'爱/沉迷',color:'#E91E63',keywords:['恋','恋人','男友','女友','爱','暧昧','暗恋','情人','伴侣','老婆','老公','丈夫','妻子','粉丝','迷','爱慕','倾心','心上人','挚爱','深爱','相恋','热恋','初恋','单恋','苦恋','痴迷','迷恋','倾慕']},{level:'A',name:'亲属',color:'#2196F3',keywords:['父','母','兄','哥','弟','姐','妹','爷','奶','叔','姑','舅','姨','义兄','义妹','义父','义子','义弟','义姐','义母','义女','养父','养母','养子','养女','亲人','家人','至亲','血亲','族人','堂兄','堂弟','表兄','表弟','表姐','表妹','外公','外婆','祖父','祖母','曾祖','儿子','女儿','孙子','孙女']},{level:'B',name:'师/友/同伴',color:'#4CAF50',keywords:['友','盟','朋友','挚友','知己','故交','青梅竹马','发小','闺蜜','死党','战友','伙伴','同窗','师徒','弟子','师傅','老师','学生','队友','搭档','同伴','好友','密友','旧友','故友','同门','师兄','师姐','师弟','师妹','徒弟','徒儿','恩师','导师','教官','学徒','盟友','向导','哨兵']},{level:'C',name:'社会关系/未分类',color:'#9E9E9E',keywords:['同事','邻居','舍友','室友','顾客','客户','上司','下属','同学','路人','熟人','认识','相识','同乡','老乡','房东','租客','店员','老板','员工','主管','经理','助手','秘书','管家','仆人','侍从','护卫','保镖']},{level:'D',name:'利益关系',color:'#FF9800',keywords:['合作','雇佣','交易','债务','炮友','利用','工具人','棋子','操控','傀儡','买卖','债主','欠债','商业','合伙','投资','赞助','金主','资助','包养','契约','协议']},{level:'E',name:'敌对关系',color:'#F44336',keywords:['仇','敌','死','对手','竞争','仇敌','死敌','宿敌','威胁','敌对','仇人','仇家','敌人','对头','冤家','杀父','杀母','血仇','深仇','世仇','夙敌','劲敌','强敌','死对头','眼中钉','宿主','夺舍','寄生']}],Ne='?',Ve='复杂/未知',Ee='#9C27B0';function ze(e,a){return a.keywords.some(a=>e.includes(a))}function Be(e){const a=e.split(/[,，、;；|]/).map(e=>e.trim()).filter(e=>e.length>0);if(0===a.length)return{color:Ce.find(e=>'C'===e.level).color,level:'C',typeName:'社会关系',isComplex:!1};const t=new Set;if(a.forEach(e=>{for(const a of Ce)if(ze(e,a)){t.add(a.level);break}}),0===t.size)return{color:Ce.find(e=>'C'===e.level).color,level:'C',typeName:'社会关系',isComplex:!1};const o=['S','A','B'].some(e=>t.has(e)),n=t.has('E');if(o&&n)return{color:Ee,level:Ne,typeName:Ve,isComplex:!0};const r=['S','A','E','D','B','C'];for(const e of r)if(t.has(e)){const a=Ce.find(a=>a.level===e);return{color:a.color,level:a.level,typeName:a.name,isComplex:!1}}return{color:Ce.find(e=>'C'===e.level).color,level:'C',typeName:'社会关系',isComplex:!1}}function Se(e,a){const t=(e||'')+(a||'');return['过去','过往','从前','曾经','曾','前','原','故','昔','已故','已逝','前任','旧','暗','秘','隐','伪','假','表面','疑','可能','潜在','疑似'].some(e=>t.includes(e))}function Ae(e){return e?e.replace(/[。.]+$/,'').replace(/\s+/g,'').trim():''}function Te(e,a){const t=e.cells.find(e=>e.colIndex===a);return t?String(t.value??'').trim():''}function Ue(e,a){const t=e.map(e=>e.toLowerCase());for(const e of a){const a=t.findIndex(a=>a.includes(e.toLowerCase()));if(-1!==a)return a}return-1}function De(e,a){const t=e.toLowerCase(),o=a.toLowerCase();return['人物','角色','npc','character','主角','protagonist','player'].some(e=>t.includes(e)||o.includes(e))}function Ie(e){if(/^[A-Za-z\s'-]+$/.test(a=e)&&a.includes(' ')){const a=e.split(' ')[0];return a.length>6?a.slice(0,6):a}var a;return e.length>0?e[e.length-1]:e}function Me(e,a=[],t){const o=[],n=[],r=[],i=new Set;if(!e||0===e.rows.length)return{elements:[],nodeCount:0,edgeCount:0,warnings:['关系表为空或不存在']};const c=e.headers,l=Ue(c,['source','源','主体','发起方','from']),s=Ue(c,['target','目标','客体','接收方','to']),u=Ue(c,['关系','relation','关系词']),d=Ue(c,['备注','note','说明','remark']);if(-1===l||-1===s)return{elements:[],nodeCount:0,edgeCount:0,warnings:['关系表缺少 source/target 列，无法解析']};const p=new Set,m=new Set,g=new Set;if(a.forEach(e=>{const a=e.name.toLowerCase(),t=a.includes('主角')||a.includes('protagonist'),o=Ue(e.headers,['姓名','name','名称','角色名']);-1!==o&&e.rows.forEach(e=>{const a=Te(e,o);a&&(t?p.add(a):m.add(a))})}),t){const e=Ue(t.headers,['名称','name','势力名']);-1!==e&&t.rows.forEach(a=>{const t=Te(a,e);t&&g.add(t)})}function b(e){if(!e||i.has(e))return;i.add(e);const a=function(e){return p.has(e)?'protagonist':m.has(e)?'character':g.has(e)?'faction':'unknown'}(e),t=Ie(e);n.push({data:{id:e,label:t,type:a},classes:a})}return e.rows.forEach((e,a)=>{const t=Te(e,l),n=Te(e,s),i=-1!==u?Te(e,u):'',c=-1!==d?Te(e,d):'';if(!t||!n)return void((t||n)&&o.push(`第 ${a+1} 行数据不完整（source: "${t}", target: "${n}"）`));b(t),b(n);const p=Be(i);r.push({data:{id:`edge-${a}`,source:t,target:n,label:i||'关系',note:c,color:p.color,lineStyle:Se(c)?'dashed':'solid',level:p.level}})}),{elements:[...n,...r],nodeCount:n.length,edgeCount:r.length,warnings:o}}function _e(e=[],a){const t=[],o=[],n=[],r=new Set;let i=0;const c=new Set,l=new Set,s=new Set;function u(e){if(!e||r.has(e))return;r.add(e);const a=function(e){return l.has(e)?'protagonist':s.has(e)?'character':'unknown'}(e),t=Ie(e);o.push({data:{id:e,label:t,type:a},classes:a})}e.forEach(e=>{const a=e.name.toLowerCase(),t=a.includes('主角')||a.includes('protagonist'),o=Ue(e.headers,['姓名','name','名称','角色名']);-1!==o&&e.rows.forEach(e=>{const a=Te(e,o);a&&(c.add(a),t?l.add(a):s.add(a))})});const d=new Map;e.forEach(e=>{const a=Ue(e.headers,['姓名','name','名称','角色名']),t=Ue(e.headers,['人际关系','关系','relationship','relations']);-1!==a&&-1!==t&&e.rows.forEach(e=>{const o=Te(e,a),n=Te(e,t);if(!o||!n)return;u(o);const r=function(e){if(!e||'string'!=typeof e)return[];const a=[],t=e.split(/[；;]/).map(e=>e.trim()).filter(Boolean);for(const e of t){let t='',o=e;const n=e.match(/[（(]([^）)]+)[）)]/);n&&(t=n[1],o=e.replace(/[（(][^）)]+[）)]/g,'').trim()),o=o.replace(/[""]([^""]+)[""]/g,'$1');const r=o.match(/^(.+?)与(.+?)的(.+)$/);if(r){const e=r[1].trim(),o=r[2].trim(),n=r[3].split(/[、,，]/).map(e=>e.trim()).filter(Boolean);for(const r of n){const n=Ae(r);n&&a.push({targets:[e,o],relation:n,note:t})}continue}const i=o.match(/^(.+?)的(.+)$/);if(i){const e=i[1].trim(),o=i[2];let n;n=o.includes('与')?o.split(/与/).map(e=>e.trim()).filter(Boolean):o.split(/[、,，]/).map(e=>e.trim()).filter(Boolean);for(const o of n){const n=Ae(o);n&&a.push({targets:[e],relation:n,note:t})}continue}console.info(`[RelationshipParser] 无法解析: "${e}"`)}return a}(n,c);for(const e of r){const a=Ae(e.relation);if(a)for(const t of e.targets){u(t);const n=`${o}->${t}`,r=Be(a),i=Se(e.note,a);if(d.has(n)){const t=d.get(n);t.relations.includes(a)||t.relations.push(a),e.note&&!t.notes.includes(e.note)&&t.notes.push(e.note);const o=['S','A','E','D','B','C','?'],c=o.indexOf(t.level);(o.indexOf(r.level)<c||-1===c)&&(t.color=r.color,t.level=r.level),i&&(t.useDashed=!0)}else d.set(n,{relations:[e.relation],notes:e.note?[e.note]:[],color:r.color,level:r.level,useDashed:i})}}})});const p=new Set;return d.forEach((e,a)=>{const[t,o]=a.split('->'),r=[t,o].sort().join('<->');if(p.has(r))return;const c=`${o}->${t}`,l=d.get(c);let s=!1;if(l){s=[...e.relations].sort().join(',')===[...l.relations].sort().join(',')}const u=e.relations.join('/'),m=e.notes.join('; ');s?(p.add(r),n.push({data:{id:'edge-'+i++,source:t,target:o,label:u||'关系',note:m,color:e.color,lineStyle:e.useDashed?'dashed':'solid',level:e.level,bidirectional:!0}})):n.push({data:{id:'edge-'+i++,source:t,target:o,label:u||'关系',note:m,color:e.color,lineStyle:e.useDashed?'dashed':'solid',level:e.level,bidirectional:!1}})}),0===o.length&&t.push('未能从角色表中解析出任何人际关系数据'),{elements:[...o,...n],nodeCount:o.length,edgeCount:n.length,warnings:t}}function $e(e){return new Promise((a,t)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=()=>a(o.result),o.onerror=t})}function je(e,a=100,t=.8){return new Promise((o,n)=>{const r=new Image;r.onload=()=>{try{const e=document.createElement('canvas'),i=Math.min(1,a/Math.max(r.width,r.height));e.width=r.width*i,e.height=r.height*i;const c=e.getContext('2d');if(!c)return void n(new Error('无法创建 canvas context'));c.drawImage(r,0,0,e.width,e.height),o(e.toDataURL('image/jpeg',t))}catch(e){n(e)}},r.onerror=()=>n(new Error('图片加载失败')),r.src=e})}function Fe(e,a){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!t)return e;return`rgba(${parseInt(t[1],16)}, ${parseInt(t[2],16)}, ${parseInt(t[3],16)}, ${a/100})`}function Pe(){const e=window.parent||window;return{$:window.jQuery||e.jQuery,getDB:()=>e.AutoCardUpdaterAPI||window.AutoCardUpdaterAPI}}function Le(){const e=Pe().getDB();try{return e&&e.exportTableAsJson?e.exportTableAsJson():null}catch(e){return console.warn('[ACU] getTableData error:',e),null}}function Re(e){if(!e||'object'!=typeof e)return{};const a={};for(const t in e)if(e[t]?.name){const o=e[t];a[o.name]={key:t,headers:o.content?.[0]||[],rows:o.content?.slice(1)||[]}}return Object.keys(a).length>0?a:null}const Oe='acu-styles',He='acu-dynamic-font',Ge='acu-theme-custom';function Ye(){const e=se(),a=ke(),{$}=Pe(),t=()=>{try{return window.parent?.document||document}catch{return document}},o=(0,l.computed)(()=>{try{return getScriptId()}catch{return'acu-visualizer'}}),n=(0,l.ref)(null),r=(0,l.ref)(null),i=(0,l.ref)(null),c=(0,l.ref)(null),s=(0,l.ref)(!1),u=()=>{const a=t(),n=`${He}-${o.value}`;a.getElementById(n)?.remove();const r=a.createElement('style');r.id=n,r.setAttribute('data-source','acu-visualizer');const c=(()=>{const a=e.config.fontFamily||'default',t=ce.find(e=>e.id===a);return t?.val||ce[0].val})();r.textContent=`\n      \n      @import url("https://fontsapi.zeoseven.com/3/main/result.css");   /* 寒蝉全圆体 */\n      @import url("https://fontsapi.zeoseven.com/442/main/result.css"); /* Maple Mono */\n      @import url("https://fontsapi.zeoseven.com/256/main/result.css"); /* 汇文明朝 */\n      @import url("https://fontsapi.zeoseven.com/482/main/result.css"); /* Cooper正楷 */\n      @import url("https://fontsapi.zeoseven.com/446/main/result.css"); /* YFFYT */\n      @import url("https://fontsapi.zeoseven.com/570/main/result.css"); /* Fusion Pixel */\n      @import url("https://fontsapi.zeoseven.com/292/main/result.css"); /* 霞鹜文楷 */\n      @import url("https://fontsapi.zeoseven.com/69/main/result.css");  /* 思源黑体 */\n      @import url("https://fontsapi.zeoseven.com/7/main/result.css");   /* 朱雀仿宋 */\n    \n\n      /* 主容器字体 */\n      .acu-wrapper,\n      .acu-modal-container,\n      .acu-attachment-picker-overlay,\n      .acu-toast,\n      .acu-edit-dialog,\n      .acu-cell-menu,\n      .acu-nav-container,\n      #acu-ghost-preview {\n        font-family: ${c} !important;\n      }\n\n      /* 所有文本元素字体（排除图标） */\n      .acu-wrapper p,\n      .acu-wrapper div:not(.fa):not(.fas):not(.far):not(.fab),\n      .acu-wrapper span:not(.fa):not(.fas):not(.far):not(.fab),\n      .acu-wrapper label,\n      .acu-wrapper button,\n      .acu-wrapper a,\n      .acu-wrapper input,\n      .acu-wrapper select,\n      .acu-wrapper textarea,\n      .acu-wrapper th,\n      .acu-wrapper td,\n      .acu-modal-container p,\n      .acu-modal-container div:not(.fa):not(.fas):not(.far):not(.fab),\n      .acu-modal-container span:not(.fa):not(.fas):not(.far):not(.fab),\n      .acu-modal-container label,\n      .acu-modal-container button,\n      .acu-modal-container a,\n      .acu-modal-container input,\n      .acu-modal-container select,\n      .acu-modal-container textarea,\n      .acu-modal-container th,\n      .acu-modal-container td {\n        font-family: ${c} !important;\n      }\n\n      /* Toast - 字体跟随设置，颜色使用主文本色 */\n      .acu-toast,\n      .acu-toast p,\n      .acu-toast div,\n      .acu-toast span,\n      .acu-toast-message,\n      .acu-toast.acu-toast-success,\n      .acu-toast.acu-toast-success span,\n      .acu-toast.acu-toast-error,\n      .acu-toast.acu-toast-error span,\n      .acu-toast.acu-toast-warning,\n      .acu-toast.acu-toast-warning span,\n      .acu-toast.acu-toast-info,\n      .acu-toast.acu-toast-info span {\n        font-family: ${c} !important;\n        color: var(--acu-text-main) !important;\n        text-shadow: none !important;\n      }\n\n      /* Toast 图标 */\n      .acu-toast i {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n        color: var(--acu-text-main) !important;\n      }\n\n      /* Tab/导航按钮 - 普通态：主文本色 */\n      .acu-tab-btn,\n      .acu-tab-btn span,\n      .acu-tab-btn i,\n      .acu-nav-btn,\n      .acu-nav-btn span,\n      .acu-nav-btn i {\n        font-family: ${c} !important;\n        text-shadow: none !important;\n        color: var(--acu-text-main) !important;\n      }\n\n      /* 导航按钮激活状态 - 背景使用主文本色，文字使用面板背景色(反色) */\n      .acu-nav-btn.active,\n      .acu-nav-btn.active span,\n      .acu-nav-btn.active i {\n        background: var(--acu-text-main) !important;\n        background-color: var(--acu-text-main) !important;\n        color: var(--acu-bg-panel) !important;\n      }\n\n      /* 卡片文本 */\n      .acu-data-card,\n      .acu-data-card p,\n      .acu-data-card div:not(.fa):not(.fas):not(.far):not(.fab),\n      .acu-data-card span:not(.fa):not(.fas):not(.far):not(.fab),\n      .acu-card-label,\n      .acu-card-value,\n      .acu-grid-label,\n      .acu-grid-value,\n      .acu-full-label,\n      .acu-full-value,\n      .acu-editable-title {\n        font-family: ${c} !important;\n        text-shadow: none !important;\n      }\n\n      /* 其他组件 */\n      .acu-panel-title,\n      .acu-settings-label,\n      .acu-btn-block,\n      .acu-nav-btn,\n      .acu-edit-textarea {\n        font-family: ${c} !important;\n      }\n\n      /* 保护 Font Awesome 图标字体 */\n      .acu-wrapper i.fa,\n      .acu-wrapper i.fas,\n      .acu-wrapper i.far,\n      .acu-wrapper i.fab,\n      .acu-wrapper .fa,\n      .acu-wrapper .fas,\n      .acu-wrapper .far,\n      .acu-wrapper .fab,\n      .acu-modal-container i.fa,\n      .acu-modal-container i.fas,\n      .acu-modal-container i.far,\n      .acu-modal-container i.fab,\n      .acu-modal-container .fa,\n      .acu-modal-container .fas,\n      .acu-modal-container .far,\n      .acu-modal-container .fab {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n      }\n\n      /* 颜色污染防护 - 只重置 text-shadow，不覆盖颜色 */\n      .acu-wrapper p,\n      .acu-wrapper div,\n      .acu-wrapper span,\n      .acu-wrapper label,\n      .acu-wrapper button,\n      .acu-modal-container p,\n      .acu-modal-container div,\n      .acu-modal-container span,\n      .acu-modal-container label,\n      .acu-modal-container button {\n        text-shadow: none !important;\n      }\n\n      /* 卡片标题 - 使用主题色 + 用户字体 */\n      .acu-editable-title,\n      .acu-panel-title {\n        color: var(--acu-title-color) !important;\n        font-family: ${c} !important;\n      }\n\n      /* 仪表盘标题和内容 */\n      .acu-dash-title,\n      .acu-dash-title span,\n      .acu-dash-title-text {\n        font-family: ${c} !important;\n        color: var(--acu-title-color) !important;\n        text-shadow: none !important;\n      }\n\n      /* 仪表盘图标 */\n      .acu-dash-title i,\n      .acu-dash-empty i,\n      .acu-dash-card i,\n      .acu-dash-npc-item i {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n        color: var(--acu-text-sub) !important;\n      }\n\n      /* 仪表盘空状态 */\n      .acu-dash-empty,\n      .acu-dash-empty span {\n        font-family: ${c} !important;\n        color: var(--acu-text-sub) !important;\n        text-shadow: none !important;\n      }\n\n      /* 表格空状态"暂无数据" */\n      .acu-empty-state,\n      .acu-empty-state p,\n      .acu-empty-state span,\n      .acu-no-data {\n        font-family: ${c} !important;\n        color: var(--acu-text-sub) !important;\n        text-shadow: none !important;\n      }\n\n      /* 空状态图标 */\n      .acu-empty-state i {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n        color: var(--acu-text-sub) !important;\n      }\n\n      /* 卡片列名 label - 字体大小受设置控制 */\n      label.acu-card-label,\n      label.acu-grid-label,\n      label.acu-full-label,\n      .acu-data-card label.acu-card-label,\n      .acu-data-card label.acu-grid-label,\n      .acu-data-card label.acu-full-label,\n      .acu-wrapper label.acu-card-label,\n      .acu-wrapper label.acu-grid-label,\n      .acu-wrapper label.acu-full-label {\n        font-family: ${c} !important;\n        font-size: calc(var(--acu-font-size, 13px) - 2px) !important;\n        text-shadow: none !important;\n      }\n\n      /* hint文本 - 使用次要文本色，字体大小受设置控制 */\n      .acu-wrapper .hint,\n      .acu-wrapper .acu-text-sub,\n      .acu-modal-container .hint,\n      .acu-modal-container .acu-text-sub,\n      .acu-settings-label .hint {\n        color: var(--acu-text-sub) !important;\n        font-size: calc(var(--acu-font-size, 13px) - 2px) !important;\n      }\n\n      /* Tab/Nav 图标使用 Font Awesome */\n      .acu-tab-btn i,\n      .acu-nav-btn i {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n      }\n\n      /* 手动更新弹窗文本 */\n      .acu-manual-update-dialog p,\n      .acu-manual-update-dialog div,\n      .acu-manual-update-dialog span,\n      .acu-manual-update-dialog label,\n      .acu-modal-body p,\n      .acu-modal-body div,\n      .acu-modal-body span,\n      .acu-modal-body label {\n        color: var(--acu-text-main) !important;\n        text-shadow: none !important;\n      }\n\n      /* 设置面板返回按钮 - 使用主文本色 */\n      .acu-modal-back,\n      .acu-modal-back i,\n      .acu-back-btn,\n      .acu-back-btn i {\n        color: var(--acu-text-main) !important;\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n      }\n\n      /* 设置面板关闭按钮 */\n      .acu-modal-close i,\n      .acu-close-pill i {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n        color: inherit !important;\n      }\n\n      /* 所有按钮字体 - 统一使用用户设置的字体 */\n      .acu-wrapper button,\n      .acu-modal-container button,\n      .acu-close-pill,\n      .acu-tool-btn,\n      .acu-btn,\n      .acu-btn-primary,\n      .acu-btn-secondary,\n      .acu-btn-danger,\n      .acu-btn-save,\n      .btn-cancel,\n      .btn-confirm,\n      .acu-preset-dropdown-btn,\n      .acu-modal-btn,\n      .acu-action-btn,\n      .acu-page-btn,\n      .acu-dialog-btn {\n        font-family: ${c} !important;\n      }\n\n      /* 主题面板CSS按钮 */\n      .acu-theme-panel button,\n      .acu-css-actions button,\n      .acu-css-actions .acu-tool-btn {\n        font-family: ${c} !important;\n      }\n\n      /* 头像管理弹窗 */\n      .acu-avatar-manager-modal button,\n      .acu-avatar-manager-modal label,\n      .acu-avatar-manager-modal span,\n      .acu-avatar-manager button,\n      .acu-avatar-manager label,\n      .acu-avatar-manager span,\n      .acu-avatar-dialog button,\n      .acu-avatar-dialog label,\n      .acu-avatar-dialog span {\n        font-family: ${c} !important;\n      }\n\n      /* 设置面板标题图标 - 使用主文本色 */\n      .acu-modal-header i:not(.acu-close-pill i),\n      .acu-settings-title i {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n        color: var(--acu-text-main) !important;\n      }\n    `,a.head.appendChild(r),i.value=r,console.info('[ACU Styles] Font styles injected')},d=()=>{if(!r.value)return;const a=e.config,t=e.highlightColorObj,o=e.highlightManualColorObj,n=e.highlightAiColorObj,i=e.titleColorObj,c=a.gridColumns&&a.gridColumns>0?`repeat(${a.gridColumns}, 1fr)`:'repeat(auto-fill, minmax(110px, 1fr))',l=`\n      .acu-wrapper,\n      .acu-modal-container,\n      .acu-attachment-picker-overlay,\n      .acu-toast,\n      .acu-cell-menu {\n        /* 卡片配置 */\n        --acu-card-width: ${a.cardWidth||280}px;\n        --acu-font-size: ${a.fontSize||13}px;\n\n        /* 高亮色 (兼容旧样式) */\n        --acu-highlight: ${t.main};\n        --acu-highlight-bg: ${t.bg};\n        --acu-accent: ${t.main};\n\n        /* 手动修改高亮色 */\n        --acu-highlight-manual: ${o.main};\n        --acu-highlight-manual-bg: ${o.bg};\n\n        /* AI填表高亮色 */\n        --acu-highlight-ai: ${n.main};\n        --acu-highlight-ai-bg: ${n.bg};\n\n        /* 标题色 */\n        --acu-title-color: ${i.main};\n        --acu-title-color-bg: ${i.bg};\n        --acu-title-color-rgb: ${function(e){const a=e.replace('#',''),t=parseInt(a,16);return`${t>>16&255}, ${t>>8&255}, ${255&t}`}(i.main)};\n\n        /* 导航栏 */\n        --acu-nav-cols: ${c};\n\n        /* 文本限制 */\n        --acu-text-max-height: ${!1!==a.limitLongText?'80px':'none'};\n        --acu-text-overflow: ${!1!==a.limitLongText?'auto':'visible'};\n      }\n\n      /* ============================================================\n       * 双色高亮样式 (已移除背景色和动画效果)\n       * ============================================================ */\n\n      /* 手动修改高亮 (橙色系) - 覆盖值元素及其所有子元素 */\n      .acu-cell-changed-manual .acu-grid-value,\n      .acu-cell-changed-manual .acu-full-value,\n      .acu-cell-changed-manual .acu-card-value,\n      .acu-cell-changed-manual .acu-grid-value *,\n      .acu-cell-changed-manual .acu-full-value *,\n      .acu-cell-changed-manual .acu-card-value *,\n      .acu-row-changed-manual .acu-editable-title {\n        color: var(--acu-highlight-manual) !important;\n        font-weight: 600;\n      }\n\n      /* AI填表高亮 (蓝色系) - 覆盖值元素及其所有子元素 */\n      .acu-cell-changed-ai .acu-grid-value,\n      .acu-cell-changed-ai .acu-full-value,\n      .acu-cell-changed-ai .acu-card-value,\n      .acu-cell-changed-ai .acu-grid-value *,\n      .acu-cell-changed-ai .acu-full-value *,\n      .acu-cell-changed-ai .acu-card-value *,\n      .acu-row-changed-ai .acu-editable-title {\n        color: var(--acu-highlight-ai) !important;\n        font-weight: 600;\n      }\n\n      /* 通用变更高亮 (兼容旧样式) */\n      .acu-cell-changed:not(.acu-cell-changed-manual):not(.acu-cell-changed-ai) .acu-grid-value,\n      .acu-cell-changed:not(.acu-cell-changed-manual):not(.acu-cell-changed-ai) .acu-full-value,\n      .acu-cell-changed:not(.acu-cell-changed-manual):not(.acu-cell-changed-ai) .acu-card-value,\n      .acu-cell-changed:not(.acu-cell-changed-manual):not(.acu-cell-changed-ai) .acu-grid-value *,\n      .acu-cell-changed:not(.acu-cell-changed-manual):not(.acu-cell-changed-ai) .acu-full-value *,\n      .acu-cell-changed:not(.acu-cell-changed-manual):not(.acu-cell-changed-ai) .acu-card-value *,\n      .acu-highlight-changed {\n        color: var(--acu-title-color) !important;\n        font-weight: 600;\n      }\n\n      /* ============================================================\n       * 酒馆主题污染防护 - 最高优先级覆盖\n       * 使用全局选择器 + !important 确保优先级高于酒馆主题\n       * ============================================================ */\n\n      /* 滑块 (Range Input) 完全重置 */\n      .acu-wrapper input[type="range"],\n      .acu-modal-container input[type="range"],\n      .acu-settings-control input[type="range"] {\n        -webkit-appearance: none !important;\n        -moz-appearance: none !important;\n        appearance: none !important;\n        background: transparent !important;\n        background-color: transparent !important;\n        background-image: none !important;\n        border: none !important;\n        box-shadow: none !important;\n        outline: none !important;\n        width: 120px !important;\n        height: 20px !important;\n      }\n\n      /* 滑块圆点 - Webkit */\n      .acu-wrapper input[type="range"]::-webkit-slider-thumb,\n      .acu-modal-container input[type="range"]::-webkit-slider-thumb,\n      .acu-settings-control input[type="range"]::-webkit-slider-thumb {\n        -webkit-appearance: none !important;\n        appearance: none !important;\n        width: 16px !important;\n        height: 16px !important;\n        background: var(--acu-title-color) !important;\n        background-color: var(--acu-title-color) !important;\n        background-image: none !important;\n        border-radius: 50% !important;\n        border: none !important;\n        margin-top: -5px !important;\n        cursor: pointer !important;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) !important;\n      }\n\n      /* 滑块轨道 - Webkit */\n      .acu-wrapper input[type="range"]::-webkit-slider-runnable-track,\n      .acu-modal-container input[type="range"]::-webkit-slider-runnable-track,\n      .acu-settings-control input[type="range"]::-webkit-slider-runnable-track {\n        -webkit-appearance: none !important;\n        width: 100% !important;\n        height: 6px !important;\n        background: var(--acu-border) !important;\n        background-color: var(--acu-border) !important;\n        background-image: none !important;\n        border-radius: 3px !important;\n        border: none !important;\n        cursor: pointer !important;\n        box-shadow: none !important;\n      }\n\n      /* 滑块圆点 - Firefox */\n      .acu-wrapper input[type="range"]::-moz-range-thumb,\n      .acu-modal-container input[type="range"]::-moz-range-thumb,\n      .acu-settings-control input[type="range"]::-moz-range-thumb {\n        -moz-appearance: none !important;\n        width: 16px !important;\n        height: 16px !important;\n        background: var(--acu-title-color) !important;\n        background-color: var(--acu-title-color) !important;\n        background-image: none !important;\n        border-radius: 50% !important;\n        border: none !important;\n        cursor: pointer !important;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) !important;\n      }\n\n      /* 滑块轨道 - Firefox */\n      .acu-wrapper input[type="range"]::-moz-range-track,\n      .acu-modal-container input[type="range"]::-moz-range-track,\n      .acu-settings-control input[type="range"]::-moz-range-track {\n        -moz-appearance: none !important;\n        width: 100% !important;\n        height: 6px !important;\n        background: var(--acu-border) !important;\n        background-color: var(--acu-border) !important;\n        background-image: none !important;\n        border-radius: 3px !important;\n        border: none !important;\n        cursor: pointer !important;\n        box-shadow: none !important;\n      }\n\n      /* 输入框/选择框 污染防护 */\n      .acu-wrapper input[type="text"],\n      .acu-wrapper input[type="number"],\n      .acu-wrapper input[type="password"],\n      .acu-wrapper select,\n      .acu-wrapper textarea,\n      .acu-modal-container input[type="text"],\n      .acu-modal-container input[type="number"],\n      .acu-modal-container input[type="password"],\n      .acu-modal-container select,\n      .acu-modal-container textarea,\n      .acu-settings-control input[type="text"],\n      .acu-settings-control input[type="number"],\n      .acu-settings-control select {\n        background: var(--acu-card-bg) !important;\n        background-color: var(--acu-card-bg) !important;\n        background-image: none !important;\n        border: 1px solid var(--acu-border) !important;\n        border-radius: 6px !important;\n        color: var(--acu-text-main) !important;\n        font-family: inherit !important;\n        font-size: 13px !important;\n        text-shadow: none !important;\n        box-shadow: none !important;\n        backdrop-filter: none !important;\n        filter: none !important;\n      }\n\n      .acu-wrapper input[type="text"]:hover,\n      .acu-wrapper input[type="number"]:hover,\n      .acu-wrapper select:hover,\n      .acu-modal-container input[type="text"]:hover,\n      .acu-modal-container input[type="number"]:hover,\n      .acu-modal-container select:hover,\n      .acu-settings-control input:hover,\n      .acu-settings-control select:hover {\n        border-color: var(--acu-title-color) !important;\n        background: var(--acu-card-bg) !important;\n        background-color: var(--acu-card-bg) !important;\n        background-image: none !important;\n        box-shadow: 0 0 0 2px var(--acu-title-color-bg) !important;\n      }\n\n      .acu-wrapper input[type="text"]:focus,\n      .acu-wrapper input[type="number"]:focus,\n      .acu-wrapper select:focus,\n      .acu-modal-container input[type="text"]:focus,\n      .acu-modal-container input[type="number"]:focus,\n      .acu-modal-container select:focus,\n      .acu-settings-control input:focus,\n      .acu-settings-control select:focus {\n        border-color: var(--acu-title-color) !important;\n        background: var(--acu-card-bg) !important;\n        background-color: var(--acu-card-bg) !important;\n        background-image: none !important;\n        box-shadow: 0 0 0 2px var(--acu-title-color-bg) !important;\n        outline: none !important;\n      }\n\n      /* 选择框下拉箭头 */\n      .acu-wrapper select,\n      .acu-modal-container select,\n      .acu-settings-control select {\n        -webkit-appearance: none !important;\n        -moz-appearance: none !important;\n        appearance: none !important;\n        padding-right: 30px !important;\n        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E") !important;\n        background-repeat: no-repeat !important;\n        background-position: right 8px center !important;\n        background-size: 16px !important;\n      }\n\n      /* 滚动条 污染防护 */\n      .acu-wrapper::-webkit-scrollbar,\n      .acu-wrapper *::-webkit-scrollbar,\n      .acu-modal-container::-webkit-scrollbar,\n      .acu-modal-container *::-webkit-scrollbar {\n        width: 6px !important;\n        height: 6px !important;\n      }\n\n      .acu-wrapper::-webkit-scrollbar-track,\n      .acu-wrapper *::-webkit-scrollbar-track,\n      .acu-modal-container::-webkit-scrollbar-track,\n      .acu-modal-container *::-webkit-scrollbar-track {\n        background: transparent !important;\n        background-color: transparent !important;\n      }\n\n      .acu-wrapper::-webkit-scrollbar-thumb,\n      .acu-wrapper *::-webkit-scrollbar-thumb,\n      .acu-modal-container::-webkit-scrollbar-thumb,\n      .acu-modal-container *::-webkit-scrollbar-thumb {\n        background: var(--acu-border) !important;\n        background-color: var(--acu-border) !important;\n        background-image: none !important;\n        border-radius: 3px !important;\n        border: none !important;\n        box-shadow: none !important;\n      }\n\n      .acu-wrapper::-webkit-scrollbar-thumb:hover,\n      .acu-wrapper *::-webkit-scrollbar-thumb:hover,\n      .acu-modal-container::-webkit-scrollbar-thumb:hover,\n      .acu-modal-container *::-webkit-scrollbar-thumb:hover {\n        background: var(--acu-text-sub) !important;\n        background-color: var(--acu-text-sub) !important;\n      }\n\n      /* 文本元素 污染防护 - 必须同时重置 font-family */\n      .acu-wrapper,\n      .acu-wrapper p,\n      .acu-wrapper div,\n      .acu-wrapper span,\n      .acu-wrapper label,\n      .acu-wrapper li,\n      .acu-wrapper a,\n      .acu-wrapper button,\n      .acu-wrapper th,\n      .acu-wrapper td,\n      .acu-modal-container,\n      .acu-modal-container p,\n      .acu-modal-container div,\n      .acu-modal-container span,\n      .acu-modal-container label,\n      .acu-modal-container li,\n      .acu-modal-container a,\n      .acu-modal-container button,\n      .acu-modal-container th,\n      .acu-modal-container td {\n        font-family: var(--acu-font-family) !important;\n        font-size: var(--acu-font-size, 13px) !important;\n        text-shadow: none !important;\n        line-height: 1.5 !important;\n      }\n\n      /* 普通文本颜色 - 特定选择器 */\n      .acu-settings-label,\n      .acu-card-label,\n      .acu-grid-label,\n      .acu-full-label,\n      .acu-wrapper .acu-card-value,\n      .acu-wrapper .acu-grid-value,\n      .acu-modal-container .acu-modal-body {\n        color: var(--acu-text-main) !important;\n        font-size: var(--acu-font-size, 13px) !important;\n      }\n\n      /* 次要文本颜色 */\n      .acu-wrapper .hint,\n      .acu-wrapper .acu-text-sub,\n      .acu-modal-container .hint,\n      .acu-modal-container .acu-text-sub,\n      .acu-settings-label .hint {\n        color: var(--acu-text-sub) !important;\n        font-size: 11px !important;\n      }\n\n      /* 标题 - 使用 --acu-title-color 防止酒馆污染 */\n      .acu-wrapper h1,\n      .acu-wrapper h2,\n      .acu-wrapper h3,\n      .acu-wrapper h4,\n      .acu-wrapper h5,\n      .acu-wrapper h6,\n      .acu-modal-container h1,\n      .acu-modal-container h2,\n      .acu-modal-container h3,\n      .acu-modal-container h4,\n      .acu-modal-container h5,\n      .acu-modal-container h6 {\n        color: var(--acu-title-color) !important;\n        text-shadow: none !important;\n        font-weight: 600 !important;\n      }\n\n      /* 弹窗标题 - 使用 --acu-text-main */\n      .acu-settings-title,\n      .acu-modal-title {\n        color: var(--acu-text-main) !important;\n        text-shadow: none !important;\n        font-weight: 600 !important;\n      }\n\n      /* 面板标题和行标题 - 使用 --acu-title-color + 用户字体 */\n      .acu-panel-title,\n      .acu-editable-title,\n      .acu-card-label,\n      .acu-grid-label,\n      .acu-full-label {\n        color: var(--acu-title-color) !important;\n        font-family: var(--acu-font-family) !important;\n        text-shadow: none !important;\n        font-weight: 600 !important;\n      }\n\n      /* Tab 按钮 - 精确保护 */\n      .acu-tab-btn,\n      .acu-tab-btn span,\n      .acu-nav-btn,\n      .acu-action-btn {\n        font-family: var(--acu-font-family) !important;\n        font-size: var(--acu-font-size, 13px) !important;\n        text-shadow: none !important;\n      }\n\n      /* Toast 消息 - 精确保护 */\n      .acu-toast,\n      .acu-toast-message,\n      .acu-toast span {\n        font-family: var(--acu-font-family) !important;\n        font-size: var(--acu-font-size, 13px) !important;\n        text-shadow: none !important;\n        color: #fff !important;\n      }\n\n      /* Tab 按钮字体 */\n      .acu-tab-btn,\n      .acu-nav-btn,\n      .acu-action-btn {\n        font-family: var(--acu-font-family) !important;\n        font-size: var(--acu-font-size, 13px) !important;\n        text-shadow: none !important;\n      }\n\n      /* 折叠栏标题 */\n      .acu-settings-section .acu-settings-title,\n      .acu-config-section h4,\n      .acu-collapse-header,\n      .acu-collapse-title,\n      summary {\n        font-family: var(--acu-font-family) !important;\n        font-size: var(--acu-font-size, 13px) !important;\n        color: var(--acu-text-main) !important;\n        text-shadow: none !important;\n      }\n\n      /* 图标字体保护 - Font Awesome 不应被覆盖 */\n      .acu-wrapper i.fa,\n      .acu-wrapper i.fas,\n      .acu-wrapper i.far,\n      .acu-wrapper i.fab,\n      .acu-wrapper .fa,\n      .acu-wrapper .fas,\n      .acu-wrapper .far,\n      .acu-wrapper .fab,\n      .acu-modal-container i.fa,\n      .acu-modal-container i.fas,\n      .acu-modal-container i.far,\n      .acu-modal-container i.fab,\n      .acu-modal-container .fa,\n      .acu-modal-container .fas,\n      .acu-modal-container .far,\n      .acu-modal-container .fab {\n        font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important;\n      }\n    `;r.value.textContent=l},p=()=>{if(!c.value)return;const e=a.getFullInjectedCSS();c.value.textContent=e,console.info('[ACU Styles] Theme custom styles updated')},m=a=>{const o=t().querySelector('.acu-wrapper');if(!o)return;const n=a||e.config.theme||'retro';ie.forEach(e=>{o.classList.remove(`acu-theme-${e.id}`)}),o.classList.add(`acu-theme-${n}`),console.info(`[ACU Styles] Theme applied: ${n}`)},g=a=>{const o=t().querySelector('.acu-data-display');if(!o)return;const n=a||e.config.layout||'vertical';o.classList.remove('acu-layout-vertical','acu-layout-horizontal'),o.classList.add(`acu-layout-${n}`),console.info(`[ACU Styles] Layout applied: ${n}`)},b=a=>{u(),console.info(`[ACU Styles] Font applied: ${a||e.config.fontFamily}`)},f=()=>{const e=t(),a=o.value;e.getElementById(`${Oe}-base-${a}`)?.remove(),e.getElementById(`${Oe}-dynamic-${a}`)?.remove(),e.getElementById(`${He}-${a}`)?.remove(),e.getElementById(`${Ge}-${a}`)?.remove(),n.value=null,r.value=null,i.value=null,c.value=null,s.value=!1,console.info('[ACU Styles] Styles cleaned up')},v=()=>{s.value?console.info('[ACU Styles] Already initialized'):((()=>{const e=t(),a=`${Oe}-base-${o.value}`;if(e.getElementById(a))return console.info('[ACU Styles] Base styles already injected'),void(n.value=e.getElementById(a));const r=e.createElement('style');r.id=a,r.setAttribute('data-source','acu-visualizer'),r.textContent='/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */@import "https://fontsapi.zeoseven.com/69/main/result.css";@import "https://fontsapi.zeoseven.com/3/main/result.css";@import "https://fontsapi.zeoseven.com/442/main/result.css";@import "https://fontsapi.zeoseven.com/256/main/result.css";@import "https://fontsapi.zeoseven.com/482/main/result.css";@import "https://fontsapi.zeoseven.com/446/main/result.css";@import "https://fontsapi.zeoseven.com/570/main/result.css";@import "https://fontsapi.zeoseven.com/292/main/result.css";@import "https://fontsapi.zeoseven.com/7/main/result.css";:root{--acu-neutral-50:#fafafa;--acu-neutral-100:#f5f5f5;--acu-neutral-200:#eeeeee;--acu-neutral-300:#e0e0e0;--acu-neutral-400:#bdbdbd;--acu-neutral-500:#9e9e9e;--acu-neutral-600:#757575;--acu-neutral-700:#616161;--acu-neutral-800:#424242;--acu-neutral-900:#212121;--acu-success:#27ae60;--acu-warning:#f39c12;--acu-danger:#e74c3c;--acu-info:#3498db;--acu-z-ball:2147483646;--acu-z-overlay:2147483647;--acu-z-menu:2147483648;--acu-radius-sm:6px;--acu-radius-md:12px;--acu-radius-lg:16px;--acu-shadow-sm:0 2px 8px rgba(0,0,0,0.1);--acu-shadow-md:0 4px 16px rgba(0,0,0,0.15);--acu-shadow-lg:0 15px 50px rgba(0,0,0,0.3);--acu-transition-fast:0.15s;--acu-transition-normal:0.3s;--acu-transition-slow:0.5s}.acu-wrapper,.acu-theme-retro{--acu-bg-nav:#e6e2d3;--acu-bg-panel:#e6e2d3;--acu-card-bg:#fffef9;--acu-table-head:#efebe4;--acu-table-hover:#f0ebe0;--acu-badge-bg:#efebe4;--acu-input-bg:rgba(255,255,255,0.5);--acu-menu-bg:#fff;--acu-overlay-bg:rgba(94,75,53,0.4);--acu-text-main:#5e4b35;--acu-text-sub:#999;--acu-menu-text:#333;--acu-border:#dcd0c0;--acu-btn-bg:#dcd0c0;--acu-btn-hover:#cbbba8;--acu-btn-active-bg:#8d7b6f;--acu-btn-active-text:#fdfaf5;--acu-shadow:rgba(0,0,0,0.1);--acu-card-width:280px;--acu-font-size:13px;--acu-highlight:#d35400;--acu-title-color-bg:rgba(211,84,0,0.08);--acu-title-color:#d35400;--acu-accent:#d35400;--acu-nav-cols:repeat(auto-fill,minmax(90px,1fr));--acu-text-max-height:80px;--acu-text-overflow:auto;--acu-win-width:400px;--acu-win-left:100px;--acu-win-bottom:100px}.acu-theme-dark{--acu-bg-nav:rgba(43,43,43,0.95);--acu-bg-panel:rgba(37,37,37,0.95);--acu-border:#444;--acu-text-main:#eee;--acu-text-sub:#aaa;--acu-btn-bg:rgba(58,58,58,0.5);--acu-btn-hover:#4a4a4a;--acu-btn-active-bg:#6a5acd;--acu-btn-active-text:#fff;--acu-table-head:rgba(51,51,51,0.8);--acu-table-hover:rgba(58,58,58,0.5);--acu-shadow:rgba(0,0,0,0.6);--acu-card-bg:rgba(45,48,53,0.8);--acu-badge-bg:#3a3f4b;--acu-menu-bg:#333;--acu-menu-text:#eee;--acu-input-bg:rgba(0,0,0,0.3);--acu-overlay-bg:rgba(0,0,0,0.75)}.acu-theme-modern{--acu-bg-nav:#ffffff;--acu-bg-panel:#f8f9fa;--acu-border:#e0e0e0;--acu-text-main:#333;--acu-text-sub:#888;--acu-btn-bg:#f1f3f5;--acu-btn-hover:#e9ecef;--acu-btn-active-bg:#007bff;--acu-btn-active-text:#fff;--acu-table-head:#f8f9fa;--acu-table-hover:#f1f3f5;--acu-shadow:rgba(0,0,0,0.08);--acu-card-bg:#ffffff;--acu-badge-bg:#f1f3f5;--acu-menu-bg:#fff;--acu-menu-text:#333;--acu-input-bg:#ffffff;--acu-overlay-bg:rgba(0,0,0,0.3)}.acu-theme-forest{--acu-bg-nav:#e8f5e9;--acu-bg-panel:#e8f5e9;--acu-border:#c8e6c9;--acu-text-main:#2e7d32;--acu-text-sub:#81c784;--acu-btn-bg:#c8e6c9;--acu-btn-hover:#a5d6a7;--acu-btn-active-bg:#43a047;--acu-btn-active-text:#fff;--acu-table-head:#dcedc8;--acu-table-hover:#f1f8e9;--acu-shadow:rgba(0,0,0,0.1);--acu-card-bg:#ffffff;--acu-badge-bg:#dcedc8;--acu-menu-bg:#fff;--acu-menu-text:#2e7d32;--acu-input-bg:rgba(255,255,255,0.7);--acu-overlay-bg:rgba(46,125,50,0.2)}.acu-theme-ocean{--acu-bg-nav:#e3f2fd;--acu-bg-panel:#e3f2fd;--acu-border:#bbdefb;--acu-text-main:#1565c0;--acu-text-sub:#64b5f6;--acu-btn-bg:#bbdefb;--acu-btn-hover:#90caf9;--acu-btn-active-bg:#1976d2;--acu-btn-active-text:#fff;--acu-table-head:#bbdefb;--acu-table-hover:#e1f5fe;--acu-shadow:rgba(0,0,0,0.15);--acu-card-bg:#ffffff;--acu-badge-bg:#e3f2fd;--acu-menu-bg:#fff;--acu-menu-text:#1565c0;--acu-input-bg:rgba(255,255,255,0.7);--acu-overlay-bg:rgba(21,101,192,0.2)}.acu-theme-cyber{--acu-bg-nav:#000000;--acu-bg-panel:#0a0a0a;--acu-border:#333;--acu-text-main:#00ffcc;--acu-text-sub:#ff00ff;--acu-btn-bg:#1a1a1a;--acu-btn-hover:#333;--acu-btn-active-bg:#ff00ff;--acu-btn-active-text:#fff;--acu-table-head:#111;--acu-table-hover:#1a1a1a;--acu-shadow:0 0 10px rgba(0,255,204,0.3);--acu-card-bg:#050505;--acu-badge-bg:#222;--acu-menu-bg:#111;--acu-menu-text:#00ffcc;--acu-input-bg:#111;--acu-overlay-bg:rgba(0,0,0,0.85)}.acu-theme-purple{--acu-bg-nav:#ede7f6;--acu-bg-panel:#ede7f6;--acu-border:#d1c4e9;--acu-text-main:#4a148c;--acu-text-sub:#7b1fa2;--acu-btn-bg:#d1c4e9;--acu-btn-hover:#b39ddb;--acu-btn-active-bg:#7b1fa2;--acu-btn-active-text:#fff;--acu-table-head:#f5f0fa;--acu-table-hover:#f3e5f5;--acu-shadow:rgba(74,20,140,0.1);--acu-card-bg:#faf8fc;--acu-badge-bg:#f5f0fa;--acu-menu-bg:#faf8fc;--acu-menu-text:#4a148c;--acu-input-bg:rgba(255,255,255,0.8);--acu-overlay-bg:rgba(74,20,140,0.3)}.acu-wrapper{--acu-font-family:Source Han Sans SC,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif}.acu-wrapper[data-font=hanchan]{--acu-font-family:\'HanChanQuanYuan\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=maple]{--acu-font-family:\'Maple Mono\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=huiwen]{--acu-font-family:\'HuiWenMingChao\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=cooper]{--acu-font-family:\'Cooper Zhengkai\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=yffyt]{--acu-font-family:\'YFFYT\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=fusion]{--acu-font-family:\'Fusion Pixel\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=lxgw]{--acu-font-family:\'LXGW WenKai\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=siyuan]{--acu-font-family:\'Source Han Sans SC\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-wrapper[data-font=zhuque]{--acu-font-family:\'Zhuque Fangsong\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif}.acu-font-hanchan{--acu-font-family:\'HanChanQuanYuan\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif !important}.acu-font-maple{--acu-font-family:\'Maple Mono\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif !important}.acu-font-huiwen{--acu-font-family:\'HuiWenMingChao\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif !important}.acu-font-cooper{--acu-font-family:\'Cooper Zhengkai\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif !important}.acu-font-yffyt{--acu-font-family:\'YFFYT\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif !important}.acu-font-fusion{--acu-font-family:\'Fusion Pixel\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif !important}.acu-font-lxgw{--acu-font-family:\'LXGW WenKai\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif !important}.acu-font-siyuan{--acu-font-family:\'Source Han Sans SC\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif !important}.acu-font-zhuque{--acu-font-family:\'Zhuque Fangsong\',-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif !important}.acu-wrapper,.acu-edit-dialog,.acu-cell-menu,.acu-nav-container,.acu-data-card,.acu-panel-title,.acu-settings-label,.acu-btn-block,.acu-nav-btn,.acu-edit-textarea,#acu-ghost-preview{font-family:var(--acu-font-family)}.acu-text-xs{font-size:11px}.acu-text-sm{font-size:12px}.acu-text-base{font-size:13px}.acu-text-md{font-size:14px}.acu-text-lg{font-size:15px}.acu-text-xl{font-size:16px}.acu-text-2xl{font-size:18px}.acu-text-3xl{font-size:20px}.acu-font-normal{font-weight:400}.acu-font-medium{font-weight:500}.acu-font-semibold{font-weight:600}.acu-font-bold{font-weight:700}.acu-font-extrabold{font-weight:800}.acu-leading-none{line-height:1}.acu-leading-tight{line-height:1.25}.acu-leading-snug{line-height:1.35}.acu-leading-normal{line-height:1.5}.acu-leading-relaxed{line-height:1.625}.acu-leading-loose{line-height:2}.acu-title{font-weight:700;color:var(--acu-title-color);line-height:1.35}.acu-subtitle{font-weight:500;color:var(--acu-text-sub);font-size:.9em}.acu-label{font-size:11px;font-weight:600;color:var(--acu-title-color);text-transform:uppercase;letter-spacing:.5px}.acu-value{font-weight:500;color:var(--acu-text-main)}.acu-mono{font-family:"Maple Mono","Consolas","Monaco","Courier New",monospace}.acu-wrapper[data-font=fusion],.acu-font-fusion{-webkit-font-smoothing:none;-moz-osx-font-smoothing:unset;font-smooth:never;text-rendering:optimizeSpeed}.acu-wrapper input,.acu-wrapper select,.acu-wrapper textarea,.acu-modal-container input,.acu-modal-container select,.acu-modal-container textarea{background:var(--acu-card-bg) !important;background-color:var(--acu-card-bg) !important;background-image:none !important;border:1px solid var(--acu-border) !important;border-radius:6px !important;font-family:inherit !important;font-size:inherit !important;color:var(--acu-text-main) !important;text-shadow:none !important;box-shadow:none !important;backdrop-filter:none !important;filter:none !important;transition:border-color .2s ease !important}.acu-wrapper input:hover,.acu-wrapper input:focus,.acu-wrapper select:hover,.acu-wrapper select:focus,.acu-wrapper textarea:hover,.acu-wrapper textarea:focus,.acu-modal-container input:hover,.acu-modal-container input:focus,.acu-modal-container select:hover,.acu-modal-container select:focus,.acu-modal-container textarea:hover,.acu-modal-container textarea:focus{background:var(--acu-card-bg) !important;background-color:var(--acu-card-bg) !important;background-image:none !important;border-color:var(--acu-title-color) !important;box-shadow:0 0 0 2px rgba(var(--acu-title-color-rgb,52,152,219),0.15) !important;outline:none !important}.acu-wrapper input[type=range],.acu-modal-container input[type=range]{-webkit-appearance:none !important;appearance:none !important;background:rgba(0,0,0,0) !important;background-color:rgba(0,0,0,0) !important;background-image:none !important;border:none !important;box-shadow:none !important;height:20px !important}.acu-wrapper input[type=range]::-webkit-slider-thumb,.acu-modal-container input[type=range]::-webkit-slider-thumb{-webkit-appearance:none !important;appearance:none !important;width:16px !important;height:16px !important;background:var(--acu-title-color) !important;background-color:var(--acu-title-color) !important;background-image:none !important;border-radius:50% !important;border:none !important;margin-top:-5px !important;cursor:pointer !important;box-shadow:0 1px 3px rgba(0,0,0,.2) !important}.acu-wrapper input[type=range]::-webkit-slider-runnable-track,.acu-modal-container input[type=range]::-webkit-slider-runnable-track{-webkit-appearance:none !important;width:100% !important;height:6px !important;background:var(--acu-border) !important;background-color:var(--acu-border) !important;background-image:none !important;border-radius:3px !important;border:none !important;cursor:pointer !important;box-shadow:none !important}.acu-wrapper input[type=range]::-moz-range-thumb,.acu-modal-container input[type=range]::-moz-range-thumb{-moz-appearance:none !important;width:16px !important;height:16px !important;background:var(--acu-title-color) !important;background-color:var(--acu-title-color) !important;background-image:none !important;border-radius:50% !important;border:none !important;cursor:pointer !important;box-shadow:0 1px 3px rgba(0,0,0,.2) !important}.acu-wrapper input[type=range]::-moz-range-track,.acu-modal-container input[type=range]::-moz-range-track{-moz-appearance:none !important;width:100% !important;height:6px !important;background:var(--acu-border) !important;background-color:var(--acu-border) !important;background-image:none !important;border-radius:3px !important;border:none !important;cursor:pointer !important;box-shadow:none !important}.acu-wrapper select,.acu-modal-container select{-webkit-appearance:none !important;appearance:none !important;padding-right:30px !important;background-image:url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23666\'%3E%3Cpath d=\'M7 10l5 5 5-5z\'/%3E%3C/svg%3E") !important;background-repeat:no-repeat !important;background-position:right 8px center !important;background-size:16px !important}.acu-wrapper,.acu-wrapper p,.acu-wrapper div,.acu-wrapper span,.acu-wrapper label,.acu-wrapper li,.acu-wrapper a,.acu-wrapper button,.acu-wrapper input,.acu-wrapper select,.acu-wrapper textarea,.acu-wrapper th,.acu-wrapper td,.acu-modal-container,.acu-modal-container p,.acu-modal-container div,.acu-modal-container span,.acu-modal-container label,.acu-modal-container li,.acu-modal-container a,.acu-modal-container button,.acu-modal-container input,.acu-modal-container select,.acu-modal-container textarea,.acu-modal-container th,.acu-modal-container td{font-family:var(--acu-font-family,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif) !important;font-size:var(--acu-font-size,13px) !important;text-shadow:none !important;line-height:1.5 !important}.acu-wrapper>p,.acu-wrapper>div:not([class*=title]):not([class*=Title]),.acu-wrapper>span:not([class*=title]):not([class*=Title]),.acu-wrapper .acu-settings-label,.acu-wrapper .acu-card-label,.acu-wrapper .acu-grid-label,.acu-wrapper .acu-full-label,.acu-modal-container>p,.acu-modal-container>div:not([class*=title]):not([class*=Title]),.acu-modal-container>span:not([class*=title]):not([class*=Title]),.acu-modal-container .acu-settings-label,.acu-modal-container .acu-card-label,.acu-modal-container .acu-grid-label,.acu-modal-container .acu-full-label{color:var(--acu-text-main) !important;font-size:var(--acu-font-size,13px) !important}.acu-wrapper .hint,.acu-wrapper .acu-text-sub,.acu-wrapper .acu-settings-label .hint,.acu-modal-container .hint,.acu-modal-container .acu-text-sub,.acu-modal-container .acu-settings-label .hint{color:var(--acu-text-sub) !important;font-size:11px !important}.acu-wrapper h1,.acu-wrapper h2,.acu-wrapper h3,.acu-wrapper h4,.acu-wrapper h5,.acu-wrapper h6,.acu-modal-container h1,.acu-modal-container h2,.acu-modal-container h3,.acu-modal-container h4,.acu-modal-container h5,.acu-modal-container h6{color:var(--acu-title-color) !important;font-family:var(--acu-font-family,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif) !important;text-shadow:none !important;font-weight:600 !important}.acu-wrapper .acu-modal-title,.acu-wrapper .acu-settings-title,.acu-modal-container .acu-modal-title,.acu-modal-container .acu-settings-title{color:var(--acu-text-main) !important;font-family:var(--acu-font-family,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif) !important;text-shadow:none !important;font-weight:600 !important}.acu-wrapper .acu-panel-title,.acu-wrapper .acu-editable-title,.acu-wrapper .acu-card-label,.acu-wrapper .acu-grid-label,.acu-wrapper .acu-full-label,.acu-modal-container .acu-panel-title,.acu-modal-container .acu-editable-title,.acu-modal-container .acu-card-label,.acu-modal-container .acu-grid-label,.acu-modal-container .acu-full-label{color:var(--acu-title-color) !important;font-family:var(--acu-font-family,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif) !important;text-shadow:none !important;font-weight:600 !important}.acu-wrapper .acu-tab-btn,.acu-wrapper .acu-tab-btn span,.acu-wrapper .acu-nav-btn,.acu-wrapper .acu-action-btn,.acu-modal-container .acu-tab-btn,.acu-modal-container .acu-tab-btn span,.acu-modal-container .acu-nav-btn,.acu-modal-container .acu-action-btn{font-family:var(--acu-font-family,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif) !important;font-size:var(--acu-font-size,13px) !important;text-shadow:none !important}.acu-wrapper .acu-toast,.acu-wrapper .acu-toast-message,.acu-wrapper .acu-toast span,.acu-modal-container .acu-toast,.acu-modal-container .acu-toast-message,.acu-modal-container .acu-toast span{font-family:var(--acu-font-family,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif) !important;font-size:var(--acu-font-size,13px) !important;text-shadow:none !important;color:#fff !important}.acu-wrapper .acu-settings-section .acu-settings-title,.acu-wrapper .acu-config-section h4,.acu-wrapper .acu-collapse-header,.acu-wrapper .acu-collapse-title,.acu-wrapper summary,.acu-modal-container .acu-settings-section .acu-settings-title,.acu-modal-container .acu-config-section h4,.acu-modal-container .acu-collapse-header,.acu-modal-container .acu-collapse-title,.acu-modal-container summary{font-family:var(--acu-font-family,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif) !important;font-size:var(--acu-font-size,13px) !important;color:var(--acu-text-main) !important;text-shadow:none !important}.acu-wrapper i.fa,.acu-wrapper i.fas,.acu-wrapper i.far,.acu-wrapper i.fab,.acu-wrapper .fa,.acu-wrapper .fas,.acu-wrapper .far,.acu-wrapper .fab,.acu-modal-container i.fa,.acu-modal-container i.fas,.acu-modal-container i.far,.acu-modal-container i.fab,.acu-modal-container .fa,.acu-modal-container .fas,.acu-modal-container .far,.acu-modal-container .fab{font-family:"Font Awesome 6 Free","Font Awesome 5 Free",FontAwesome !important}.acu-wrapper,.acu-modal-container,.acu-wrapper *,.acu-modal-container *{scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-wrapper::-webkit-scrollbar,.acu-modal-container::-webkit-scrollbar,.acu-wrapper *::-webkit-scrollbar,.acu-modal-container *::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-wrapper::-webkit-scrollbar-track,.acu-modal-container::-webkit-scrollbar-track,.acu-wrapper *::-webkit-scrollbar-track,.acu-modal-container *::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important;background-color:rgba(0,0,0,0) !important}.acu-wrapper::-webkit-scrollbar-thumb,.acu-modal-container::-webkit-scrollbar-thumb,.acu-wrapper *::-webkit-scrollbar-thumb,.acu-modal-container *::-webkit-scrollbar-thumb{background:var(--acu-border) !important;background-color:var(--acu-border) !important;background-image:none !important;border-radius:3px !important;border:none !important;box-shadow:none !important}.acu-wrapper::-webkit-scrollbar-thumb:hover,.acu-modal-container::-webkit-scrollbar-thumb:hover,.acu-wrapper *::-webkit-scrollbar-thumb:hover,.acu-modal-container *::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important;background-color:var(--acu-text-sub) !important}.acu-wrapper::-webkit-scrollbar-corner,.acu-modal-container::-webkit-scrollbar-corner,.acu-wrapper *::-webkit-scrollbar-corner,.acu-modal-container *::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-wrapper,.acu-wrapper *,.acu-wrapper *::before,.acu-wrapper *::after{box-sizing:border-box}.acu-wrapper{font-family:var(--acu-font-family,Source Han Sans SC,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif);font-size:var(--acu-font-size,13px);color:var(--acu-text-main);line-height:1.5;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.acu-wrapper{scrollbar-width:thin !important;scrollbar-color:var(--acu-title-color,var(--acu-border)) rgba(0,0,0,0) !important}.acu-wrapper::-webkit-scrollbar,.acu-wrapper *::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-wrapper::-webkit-scrollbar-track,.acu-wrapper *::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-wrapper::-webkit-scrollbar-thumb,.acu-wrapper *::-webkit-scrollbar-thumb{background:var(--acu-border) !important;border-radius:3px !important}.acu-wrapper::-webkit-scrollbar-thumb:hover,.acu-wrapper *::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important}.acu-wrapper::-webkit-scrollbar-corner,.acu-wrapper *::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-wrapper *{scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-panel-content{scrollbar-width:thin !important;scrollbar-color:var(--acu-title-color) rgba(0,0,0,0) !important}.acu-panel-content::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-panel-content::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-panel-content::-webkit-scrollbar-thumb{background-color:var(--acu-title-color) !important;border-radius:3px !important}.acu-panel-content::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-modal-container{scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-modal-container::-webkit-scrollbar,.acu-modal-container *::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-modal-container::-webkit-scrollbar-track,.acu-modal-container *::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-modal-container::-webkit-scrollbar-thumb,.acu-modal-container *::-webkit-scrollbar-thumb{background:var(--acu-border) !important;border-radius:3px !important}.acu-modal-container::-webkit-scrollbar-thumb:hover,.acu-modal-container *::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important}.acu-modal-container::-webkit-scrollbar-corner,.acu-modal-container *::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-modal-container *{scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-wrapper ::selection{background:var(--acu-title-color);color:#fff}.acu-wrapper ::-moz-selection{background:var(--acu-title-color);color:#fff}.acu-no-select{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.acu-selectable{user-select:text !important;-webkit-user-select:text !important;cursor:text}.acu-clickable{cursor:pointer;transition:opacity var(--acu-transition-fast)}.acu-clickable:hover{opacity:.8}.acu-clickable:active{opacity:.6}.acu-flex-center{display:flex;align-items:center;justify-content:center}.acu-flex-between{display:flex;align-items:center;justify-content:space-between}#acu-parent-container{position:fixed !important;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;z-index:var(--acu-z-overlay);pointer-events:none !important;display:flex;flex-direction:column-reverse;justify-content:flex-start}#acu-parent-container .acu-wrapper{position:absolute !important;width:var(--acu-win-width,600px) !important;left:var(--acu-win-left,50%) !important;bottom:var(--acu-win-bottom,50%) !important;max-width:98vw;pointer-events:none;display:flex;flex-direction:column-reverse;transform-origin:bottom center;will-change:transform;transition:none !important;touch-action:none}body.acu-dragging #acu-parent-container,body.acu-resizing #acu-parent-container{pointer-events:auto !important;cursor:grabbing}body.acu-resizing *{cursor:ew-resize !important;-webkit-user-select:none !important;user-select:none !important}.acu-text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-text-wrap{white-space:pre-wrap;word-break:break-word}.acu-hidden{display:none !important}.acu-invisible{visibility:hidden}.acu-grid-value,.acu-full-value,.acu-card-value,.acu-editable-title,.acu-grid-label,.acu-full-label,.acu-card-label{user-select:text !important;-webkit-user-select:text !important;cursor:text}.acu-app{font-family:var(--acu-font-family,"Microsoft YaHei",sans-serif);font-size:var(--acu-font-size,13px);color:var(--acu-text-main,#333);position:relative;z-index:2147483640}.acu-no-data{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 24px;color:var(--acu-text-muted,#999);text-align:center}.acu-no-data i{font-size:48px;margin-bottom:16px;opacity:.5}.acu-no-data p{margin:0;font-size:var(--acu-font-size,13px)}@keyframes acu-shake{0%,100%{transform:rotate(0deg)}25%{transform:rotate(10deg)}50%{transform:rotate(0deg)}75%{transform:rotate(-10deg)}}@keyframes acu-shake-x{0%,100%{transform:translateX(0)}10%,30%,50%,70%,90%{transform:translateX(-4px)}20%,40%,60%,80%{transform:translateX(4px)}}@keyframes acu-fade-in{from{opacity:0}to{opacity:1}}@keyframes acu-fade-out{from{opacity:1}to{opacity:0}}@keyframes acu-pop-up{from{opacity:0;transform:scale(0.9) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}@keyframes acu-pop-down{from{opacity:1;transform:scale(1) translateY(0)}to{opacity:0;transform:scale(0.9) translateY(10px)}}@keyframes acu-slide-in-right{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}@keyframes acu-slide-in-left{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}@keyframes acu-slide-in-up{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes acu-slide-in-down{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}@keyframes acu-spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}@keyframes acu-bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}.acu-animate-shake{animation:acu-shake .4s ease-in-out infinite}.acu-animate-shake-x{animation:acu-shake-x .5s ease-in-out}.acu-animate-fade-in{animation:acu-fade-in var(--acu-transition-normal,0.3s) ease-out}.acu-animate-fade-out{animation:acu-fade-out var(--acu-transition-normal,0.3s) ease-out}.acu-animate-pop-up{animation:acu-pop-up var(--acu-transition-normal,0.3s) cubic-bezier(0.34,1.56,0.64,1)}.acu-animate-slide-right{animation:acu-slide-in-right var(--acu-transition-normal,0.3s) ease-out}.acu-animate-slide-up{animation:acu-slide-in-up var(--acu-transition-normal,0.3s) ease-out}.acu-animate-spin{animation:acu-spin 1s linear infinite}.acu-animate-bounce{animation:acu-bounce 1s ease}.acu-highlight-changed:not(.acu-data-card){color:var(--acu-title-color) !important;font-weight:bold}.acu-save-alert{animation:acu-shake .4s ease-in-out infinite;color:#fff !important;background-color:#e74c3c !important;text-shadow:0 0 5px rgba(231,76,60,.5);border-color:#c0392b !important}.acu-row-deleted{opacity:.6;filter:grayscale(0.8);transition:all var(--acu-transition-normal)}.acu-row-deleted .acu-card-body,.acu-row-deleted .acu-card-header{text-decoration:line-through}.acu-row-deleted .acu-card-body{pointer-events:none}.acu-badge-pending{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-15deg);width:80px;height:80px;border:4px solid #e74c3c;border-radius:50%;color:#e74c3c;font-size:20px;font-weight:900;display:flex;align-items:center;justify-content:center;z-index:50;pointer-events:none;opacity:.6;box-shadow:inset 0 0 10px rgba(231,76,60,.2);background:hsla(0,0%,100%,.1)}.acu-transition-fast{transition:all var(--acu-transition-fast,0.15s) ease}.acu-transition-normal{transition:all var(--acu-transition-normal,0.3s) ease}.acu-transition-slow{transition:all var(--acu-transition-slow,0.5s) ease}.acu-transition-transform{transition:transform var(--acu-transition-normal,0.3s) ease}.acu-transition-opacity{transition:opacity var(--acu-transition-normal,0.3s) ease}.acu-transition-color{transition:color var(--acu-transition-fast,0.15s) ease,background-color var(--acu-transition-fast,0.15s) ease}.acu-wrapper{position:fixed;left:var(--acu-win-left,100px);bottom:var(--acu-win-bottom,100px);width:var(--acu-win-width,400px);display:flex;flex-direction:column-reverse;z-index:2147483645;pointer-events:auto !important}.acu-wrapper.collapsed{display:none}#acu-parent-container{position:fixed !important;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;z-index:2147483647;pointer-events:none !important;display:flex;flex-direction:column-reverse;justify-content:flex-start}#acu-parent-container .acu-wrapper{position:relative;max-width:98vw;pointer-events:auto !important;display:flex;flex-direction:column-reverse;transform-origin:bottom center;will-change:transform;transition:none !important}#acu-parent-container .acu-wrapper{position:absolute !important;width:min(var(--acu-win-width,600px),100vw - 20px) !important;left:min(var(--acu-win-left,50%),100vw - 100px) !important;bottom:var(--acu-win-bottom,50%) !important;touch-action:none;max-width:calc(100vw - 10px)}body.acu-dragging #acu-parent-container,body.acu-resizing #acu-parent-container{pointer-events:auto !important;cursor:grabbing}body.acu-resizing *{cursor:ew-resize !important;-webkit-user-select:none !important;user-select:none !important}.acu-data-display{order:2;flex:0 1 auto;max-height:80vh;margin-bottom:3px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:12px;display:none;flex-direction:column;backdrop-filter:blur(8px);box-shadow:0 -5px 25px rgba(0,0,0,.3);width:100%;overscroll-behavior:contain;isolation:isolate;pointer-events:auto !important;overflow:hidden}.acu-data-display.visible{display:flex}.acu-data-display.has-modal{z-index:100;overflow:visible !important}.acu-data-display.acu-layout-horizontal{touch-action:pan-x pan-y !important;overflow:hidden}.acu-data-display.acu-layout-vertical{touch-action:pan-y !important;overflow:hidden}.acu-panel-content{flex:1;display:flex;flex-direction:column;min-height:0;overflow:hidden;padding:0;scrollbar-width:thin;scrollbar-color:var(--acu-title-color) rgba(0,0,0,0)}.acu-panel-content::-webkit-scrollbar{width:6px;height:6px}.acu-panel-content::-webkit-scrollbar-thumb{background-color:var(--acu-title-color);border-radius:3px}.acu-panel-header{flex:0 0 auto;display:flex;justify-content:space-between;align-items:center;padding:4px 12px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);border-radius:12px 12px 0 0}.acu-panel-title{font-weight:bold;color:var(--acu-text-main);display:flex;align-items:center;gap:8px;white-space:nowrap;font-size:15px}.acu-header-actions{display:flex;align-items:center;gap:10px}.acu-height-control{display:flex;align-items:center;gap:5px;margin-right:10px;opacity:.8;transition:opacity .2s}.acu-height-drag-handle{cursor:ns-resize;padding:5px;border-radius:4px;transition:all .2s;color:var(--acu-text-sub)}.acu-height-drag-handle:hover,.acu-height-drag-handle.active{color:var(--acu-title-color);background:var(--acu-table-hover)}.acu-resize-handle{display:block !important;pointer-events:auto !important;position:absolute;right:-12px;top:0;bottom:0;width:14px;cursor:ew-resize;z-index:2147483650;touch-action:none}.acu-resize-handle::after{content:"";position:absolute;left:0;top:0;bottom:0;width:2px;background:var(--acu-border);opacity:.3;transition:opacity .2s}.acu-resize-handle:hover::after{background:var(--acu-title-color);opacity:1;width:4px;left:0}.acu-close-btn{background:none;border:none;color:var(--acu-text-sub);cursor:pointer;font-size:16px;padding:4px;transition:color .2s}.acu-close-btn:hover{color:#e74c3c}.acu-layout-horizontal .acu-panel-content{overflow:hidden !important;min-height:150px}.acu-data-display.acu-layout-horizontal{min-height:200px}.acu-data-display.acu-layout-horizontal.visible{display:flex;flex-direction:column}.acu-scrollable-layout{display:flex;flex-direction:column;min-height:0;height:100%}.acu-scrollable-layout>.acu-fixed-top{flex-shrink:0;z-index:10}.acu-scrollable-layout>.acu-scroll-middle{flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;overscroll-behavior:contain;scrollbar-width:thin;scrollbar-color:var(--acu-title-color,#667eea) rgba(0,0,0,0)}.acu-scrollable-layout>.acu-scroll-middle::-webkit-scrollbar{width:6px;height:6px}.acu-scrollable-layout>.acu-scroll-middle::-webkit-scrollbar-thumb{background-color:var(--acu-title-color,#667eea);border-radius:3px}.acu-scrollable-layout>.acu-fixed-bottom{flex-shrink:0;z-index:10}.acu-scrollable-layout.acu-scroll-horizontal>.acu-scroll-middle{overflow-x:auto;overflow-y:hidden;display:flex;flex-wrap:nowrap;white-space:nowrap}@media (max-width:768px){#acu-btn-pin{display:none !important}.acu-panel-header{padding:4px 10px !important;min-height:38px !important}.acu-panel-title{font-size:13px !important;margin-right:auto}.acu-search-wrapper{margin-right:5px !important}.acu-search-input{height:28px !important;width:80px !important;font-size:12px !important}.acu-search-input:focus{width:120px !important}.acu-nav-container{padding:8px 6px !important;gap:0 !important}.acu-nav-separator{margin:1px 0 !important;opacity:.2}.acu-nav-tabs-area{gap:1px !important}.acu-nav-btn{padding:6px 2px !important;font-size:12px !important;min-height:32px !important}.acu-nav-actions-area{padding-top:2px !important;gap:8px !important;display:flex !important;width:100% !important}.acu-action-btn{width:auto !important;flex:1 !important;height:40px !important;border-radius:8px !important;background:var(--acu-btn-bg);margin:0 !important}.acu-action-btn i{font-size:18px !important}.acu-action-btn:active{background:var(--acu-btn-active-bg);color:#fff}}@media (max-width:700px){.acu-dash-container{grid-template-columns:1fr}}.acu-floating-ball-vue{--ball-size:50px;--ball-border-color:#ffffff;--ball-border-color-rgba:rgba(255,255,255,0.4);--ball-bg-color:rgba(255,255,255,0.25);position:fixed;width:var(--ball-size);height:var(--ball-size);font-size:calc(var(--ball-size)*.4);background:var(--ball-bg-color);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:2px solid var(--ball-border-color-rgba);border-radius:50%;box-shadow:0 4px 15px rgba(0,0,0,.3);z-index:2147483647;display:flex;align-items:center;justify-content:center;cursor:pointer;touch-action:none;color:var(--acu-text-main,#333);-webkit-user-select:none;user-select:none;transition:all .3s cubic-bezier(0.18,0.89,0.32,1.28);pointer-events:auto !important;overflow:visible;box-sizing:border-box}.acu-floating-ball-vue i{display:flex;align-items:center;justify-content:center;width:100%;height:100%;line-height:1;position:relative;z-index:2}.acu-floating-ball-vue .ball-emoji{display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:calc(var(--ball-size)*.46);position:relative;z-index:2}.acu-floating-ball-vue img{width:100%;height:100%;object-fit:cover;border-radius:50%;pointer-events:none;position:relative;z-index:2}.acu-floating-ball-vue:active{transform:scale(0.9);background:var(--ball-bg-color);filter:brightness(1.2)}.acu-floating-ball-vue.has-issues{animation:pulse-warning 1.5s ease-in-out infinite;border-color:rgba(245,108,108,.6);box-shadow:0 4px 15px rgba(245,108,108,.4)}.acu-floating-ball-vue.has-issues .acu-issue-badge{position:absolute;top:-4px;right:-4px;width:18px;height:18px;background:#f56c6c;border-radius:50%;font-size:12px;font-weight:bold;color:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(245,108,108,.5);animation:badge-bounce 1s ease-in-out infinite}.acu-floating-ball-vue.has-issues:hover{box-shadow:0 6px 20px rgba(245,108,108,.5)}.acu-floating-ball-vue.docked{left:0 !important;width:20px !important;height:50px !important;border-radius:0 8px 8px 0 !important;opacity:.3;background:#000;border:1px solid #666;border-left:none;font-size:0 !important;transform:none !important}.acu-floating-ball-vue.docked::after{content:"›";color:#fff;font-size:16px;font-weight:bold;display:block}.acu-floating-ball-vue.docked:hover,.acu-floating-ball-vue.docked:active{opacity:.8;width:30px !important}.acu-floating-ball-vue.docked .acu-issue-badge{display:none}@keyframes pulse-warning{0%,100%{box-shadow:0 4px 15px rgba(245,108,108,.4),0 0 0 0 rgba(245,108,108,.4)}50%{box-shadow:0 4px 15px rgba(245,108,108,.4),0 0 0 10px rgba(245,108,108,0)}}@keyframes badge-bounce{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}@keyframes acu-notify-ripple-1{0%{transform:scale(1);opacity:.8}100%{transform:scale(2.5);opacity:0}}@keyframes acu-notify-ripple-2{0%{transform:scale(1);opacity:.6}100%{transform:scale(2.2);opacity:0}}@keyframes acu-notify-ripple-3{0%{transform:scale(1);opacity:.4}100%{transform:scale(1.9);opacity:0}}.acu-floating-ball-vue.ai-notify.anim-ripple{border-color:var(--ball-border-color-rgba)}.acu-floating-ball-vue.ai-notify.anim-ripple::before,.acu-floating-ball-vue.ai-notify.anim-ripple::after{content:"";position:absolute;width:100%;height:100%;border-radius:50%;border:2px solid var(--ball-border-color,#90cdf4);animation:acu-notify-ripple-1 1.5s ease-out infinite;pointer-events:none}.acu-floating-ball-vue.ai-notify.anim-ripple::after{animation:acu-notify-ripple-2 1.5s ease-out .5s infinite}@keyframes acu-arc-rotate{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes acu-arc-flash-1{0%,90%,100%{opacity:0}92%,95%{opacity:1}}@keyframes acu-arc-flash-2{0%,80%,100%{opacity:0}82%,88%{opacity:1}}.acu-floating-ball-vue.ai-notify.anim-arc{border-color:var(--ball-border-color-rgba)}.acu-floating-ball-vue.ai-notify.anim-arc::before{content:"";position:absolute;width:120%;height:120%;border-radius:50%;background:radial-gradient(circle at 20% 0%,var(--ball-border-color,#a29bfe) 0%,transparent 30%),radial-gradient(circle at 80% 100%,var(--ball-border-color,#a29bfe) 0%,transparent 30%);animation:acu-arc-rotate 1s linear infinite,acu-arc-flash-1 .3s ease infinite;opacity:.8;pointer-events:none}.acu-floating-ball-vue.ai-notify.anim-arc::after{content:"";position:absolute;width:130%;height:130%;border-radius:50%;background:radial-gradient(circle at 50% 0%,var(--ball-border-color,#74b9ff) 0%,transparent 25%),radial-gradient(circle at 50% 100%,var(--ball-border-color,#74b9ff) 0%,transparent 25%);animation:acu-arc-rotate 1.5s linear infinite reverse,acu-arc-flash-2 .5s ease infinite;opacity:.6;pointer-events:none}.acu-ball-preview{--ball-size:56px;--ball-border-color:#90cdf4;--ball-border-color-rgba:rgba(144,205,244,1);--ball-bg-color:rgba(43,43,43,1);width:var(--ball-size);height:var(--ball-size);font-size:calc(var(--ball-size)*.46);background:var(--ball-bg-color);border:2px solid var(--ball-border-color-rgba);border-radius:50%;display:flex;align-items:center;justify-content:center;position:relative;overflow:visible;box-sizing:border-box;transition:all .2s ease}.acu-ball-preview i{position:relative;z-index:2}.acu-ball-preview img{width:100%;height:100%;object-fit:cover;border-radius:50%;position:relative;z-index:2}.acu-ball-preview.p-anim-ripple{border-color:var(--ball-border-color-rgba)}.acu-ball-preview.p-anim-ripple::before,.acu-ball-preview.p-anim-ripple::after{content:"";position:absolute;width:100%;height:100%;border-radius:50%;border:2px solid var(--ball-border-color);animation:acu-notify-ripple-1 1.5s ease-out infinite;pointer-events:none}.acu-ball-preview.p-anim-ripple::after{animation:acu-notify-ripple-2 1.5s ease-out .5s infinite}.acu-ball-preview.p-anim-arc{border-color:var(--ball-border-color-rgba)}.acu-ball-preview.p-anim-arc::before{content:"";position:absolute;width:120%;height:120%;border-radius:50%;background:radial-gradient(circle at 20% 0%,var(--ball-border-color) 0%,transparent 30%),radial-gradient(circle at 80% 100%,var(--ball-border-color) 0%,transparent 30%);animation:acu-arc-rotate 1s linear infinite,acu-arc-flash-1 .3s ease infinite;opacity:.8;pointer-events:none}.acu-ball-preview.p-anim-arc::after{content:"";position:absolute;width:130%;height:130%;border-radius:50%;background:radial-gradient(circle at 50% 0%,var(--ball-border-color) 0%,transparent 25%),radial-gradient(circle at 50% 100%,var(--ball-border-color) 0%,transparent 25%);animation:acu-arc-rotate 1.5s linear infinite reverse,acu-arc-flash-2 .5s ease infinite;opacity:.6;pointer-events:none}.acu-ball-preview.p-notify{animation:acu-notify-glow 2s infinite ease-in-out}@keyframes acu-notify-glow{0%,100%{box-shadow:0 0 5px var(--ball-border-color,#55efc4);border-color:var(--ball-border-color,#55efc4)}50%{box-shadow:0 0 25px var(--ball-border-color,#55efc4);border-color:var(--ball-border-color,#55efc4)}}.acu-tab-bar{width:100%}.acu-nav-container{position:relative;order:1;flex:0 0 auto;display:flex;flex-direction:column;gap:0;padding:6px 10px;background:var(--acu-bg-nav);border-top:1px solid var(--acu-border);border-radius:14px 14px 0 0;backdrop-filter:blur(5px);box-shadow:0 -4px 20px rgba(0,0,0,.2);transition:transform .2s;touch-action:pan-y;width:100%;pointer-events:auto !important;cursor:move;z-index:10}.acu-nav-container.lock-mode{cursor:default !important}.acu-nav-container.editing-order .acu-nav-btn{border:1px dashed #f0ad4e;cursor:grab;opacity:.8}.acu-nav-tabs-area{display:grid;grid-template-columns:var(--acu-nav-cols,repeat(auto-fill,minmax(110px,1fr)));gap:5px;width:100%}.acu-nav-btn{width:100%;display:flex;align-items:center;justify-content:center;gap:6px;padding:5px 3px;border:1px solid rgba(0,0,0,0);border-radius:8px;background:var(--acu-btn-bg);color:var(--acu-text-main);font-weight:600;font-size:13px;cursor:pointer;transition:all .2s ease;-webkit-user-select:none;user-select:none;text-align:center;white-space:nowrap;overflow:hidden}.acu-nav-btn span{overflow:hidden;text-overflow:ellipsis}.acu-nav-btn:hover{background:var(--acu-btn-hover);transform:translateY(-2px)}.acu-nav-btn.active{background:var(--acu-btn-active-bg);color:var(--acu-btn-active-text);box-shadow:0 2px 6px rgba(0,0,0,.15)}.acu-nav-separator{width:100%;height:1px;border-top:1px dashed var(--acu-border);margin:5px 0;opacity:.6}.acu-nav-actions-area{position:relative;display:flex;width:100%;justify-content:space-between;align-items:stretch;background:rgba(0,0,0,0);padding-top:0;gap:8px}.acu-order-controls{display:none;width:100%;text-align:center;background:var(--acu-table-head);padding:5px;margin-bottom:5px;border-radius:4px;border:1px dashed var(--acu-border)}.acu-order-controls.visible{display:block}.acu-order-controls{font-size:12px;color:var(--acu-text-sub)}.acu-order-done-btn{background:var(--acu-btn-active-bg);color:var(--acu-btn-active-text);border:none;border-radius:4px;padding:2px 8px;margin-left:8px;cursor:pointer;font-size:12px;transition:all .2s}.acu-order-done-btn:hover{opacity:.9;transform:scale(1.05)}.acu-nav-btn.drag-handle{border:1px dashed #f0ad4e;cursor:grab;opacity:.8}.acu-nav-btn.drag-handle:active{cursor:grabbing}.acu-nav-btn.dragging{opacity:.5;border:2px solid var(--acu-title-color)}.acu-nav-btn.has-ai-changes{border:2px solid var(--acu-highlight-ai,#3498db)}.acu-nav-btn.has-ai-changes:hover{border-color:var(--acu-highlight-ai,#3498db)}.acu-nav-btn.has-ai-changes.active{border-color:var(--acu-highlight-ai,#3498db)}.acu-nav-btn.has-issues{border:2px solid #f56c6c;animation:tab-issue-pulse 2s ease-in-out infinite;position:relative}.acu-nav-btn.has-issues::before{content:"";position:absolute;top:-3px;right:-3px;width:8px;height:8px;background:#f56c6c;border-radius:50%;box-shadow:0 0 4px rgba(245,108,108,.6)}.acu-nav-btn.has-issues:hover{border-color:#f56c6c;box-shadow:0 2px 8px rgba(245,108,108,.3)}.acu-nav-btn.has-issues.active{border-color:#f56c6c;box-shadow:0 2px 10px rgba(245,108,108,.4)}@keyframes tab-issue-pulse{0%,100%{border-color:#f56c6c}50%{border-color:rgba(245,108,108,.4)}}.acu-action-btn{display:flex;align-items:center;justify-content:center;flex:1;min-width:36px;height:36px;border:1px solid var(--acu-border);border-radius:8px;background:var(--acu-btn-bg);color:var(--acu-text-main);font-size:14px;cursor:pointer;transition:all .2s ease}.acu-action-btn:hover{background:var(--acu-btn-hover);transform:translateY(-1px)}.acu-action-btn:active{transform:translateY(0)}.acu-action-btn.refreshing i{animation:acu-spin 1s linear infinite}.acu-action-btn.has-changes{animation:acu-pulse 1.5s ease-in-out infinite;border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-action-btn.acu-btn-danger{color:#e74c3c}.acu-action-btn.acu-btn-danger:hover{background:rgba(231,76,60,.1);border-color:#e74c3c}.acu-action-btn.acu-btn-toggle.active{background:var(--acu-btn-hover);color:var(--acu-title-color);border-color:var(--acu-title-color)}@keyframes acu-spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}@keyframes acu-pulse{0%,100%{box-shadow:0 0 0 0 rgba(var(--acu-title-color-rgb,211,84,0),0.4)}50%{box-shadow:0 0 0 8px rgba(var(--acu-title-color-rgb,211,84,0),0)}}.acu-data-card{background:var(--acu-card-bg);border:none;box-shadow:0 2px 8px var(--acu-shadow);border-radius:12px;transition:all .25s ease;display:flex;flex-direction:column;position:relative;-webkit-user-select:none;user-select:none;touch-action:pan-x pan-y;overflow-y:auto;overflow-x:hidden;overscroll-behavior:contain;scrollbar-width:thin;scrollbar-color:hsla(0,0%,100%,.2) rgba(0,0,0,0)}.acu-data-card::-webkit-scrollbar{width:4px;height:4px}.acu-data-card::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.acu-data-card::-webkit-scrollbar-thumb{background:hsla(0,0%,100%,.2);border-radius:2px;-webkit-transition:background .2s ease;transition:background .2s ease}.acu-data-card::-webkit-scrollbar-thumb:hover{background:hsla(0,0%,100%,.4)}.acu-data-card.acu-editing-lock{border-color:var(--acu-title-color) !important;box-shadow:0 0 0 1px var(--acu-title-color) !important;z-index:5;-webkit-user-select:text !important;user-select:text !important;touch-action:none !important}.acu-data-card.pending-delete{border:2px solid #f44 !important;background:rgba(255,68,68,.1);animation:acu-shake .3s ease-in-out}@keyframes acu-shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-4px)}75%{transform:translateX(4px)}}.acu-grid-value,.acu-full-value,.acu-card-value,.acu-editable-title,.acu-grid-label,.acu-full-label,.acu-card-label{user-select:text !important;-webkit-user-select:text !important;cursor:text}.acu-layout-vertical .acu-card-grid{display:flex;flex-wrap:wrap;justify-content:center;gap:14px}.acu-layout-vertical .acu-data-card{flex:0 0 var(--acu-card-width,280px);width:var(--acu-card-width,280px)}.acu-layout-vertical .acu-data-card:hover{transform:translateY(-4px);box-shadow:0 8px 25px var(--acu-shadow);z-index:5}.acu-layout-horizontal .acu-card-grid{display:inline-flex;flex-wrap:nowrap;gap:14px;height:100%;align-items:flex-start;padding-bottom:10px;min-width:100%}.acu-layout-horizontal .acu-data-card{flex:0 0 var(--acu-card-width,280px);width:var(--acu-card-width,280px);max-height:98%;overflow-y:auto;white-space:normal;touch-action:pan-x pan-y !important}.acu-card-header{padding:10px 15px;background:rgba(0,0,0,0);border-bottom:1px solid rgba(0,0,0,.05);font-weight:bold;color:var(--acu-title-color);font-size:14px;display:flex;justify-content:center;align-items:center;position:relative;flex:0 0 auto}.acu-editable-title{cursor:pointer;border-bottom:1px dashed rgba(0,0,0,0);transition:all .2s;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:15px;font-weight:800;text-align:center;width:100%;padding:2px 5px;border-radius:4px;display:inline-flex;align-items:center;justify-content:center;gap:6px}.acu-editable-title:hover{background:var(--acu-table-hover);color:var(--acu-title-color)}.acu-editable-title.acu-title-locked{background:var(--acu-title-color-bg);border:1px solid var(--acu-title-color)}.acu-title-lock-icon{font-size:10px;opacity:.8;flex-shrink:0}.acu-title-editor{flex:1;min-width:0}.acu-title-editor .acu-inline-input,.acu-title-editor textarea{width:100%;font-size:15px;font-weight:800;text-align:center;background:hsla(0,0%,100%,.15);border:1px solid var(--acu-title-color,#667eea);border-radius:4px;padding:4px 8px;color:var(--acu-title-color)}.acu-title-editor .acu-inline-input:focus,.acu-title-editor textarea:focus{outline:none;box-shadow:0 0 0 2px var(--acu-title-color-bg,rgba(102,126,234,0.2))}.acu-card-index{position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:10px;color:var(--acu-text-sub);font-weight:normal;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;opacity:.8}.acu-row-lock-btn{position:absolute;right:10px;top:50%;transform:translateY(-50%);width:26px;height:26px;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:50%;color:var(--acu-text-sub);cursor:pointer;font-size:12px;transition:all .2s ease}.acu-row-lock-btn:hover{background:var(--acu-title-color-bg);color:var(--acu-title-color);border-color:var(--acu-title-color)}.acu-row-lock-btn.acu-row-locked{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color)}.acu-row-lock-btn.acu-row-locked:hover{background:var(--acu-title-color);filter:brightness(1.1)}.acu-card-body{padding:0;display:flex;flex-direction:column;gap:0;font-size:var(--acu-font-size,13px)}.acu-card-main-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:12px}.acu-grid-item{display:flex;flex-direction:column;gap:2px;padding:5px;border-radius:6px;cursor:pointer;overflow:hidden}.acu-grid-item:hover{background:var(--acu-table-hover)}.acu-grid-label{font-size:11px;color:var(--acu-title-color);text-transform:uppercase;letter-spacing:.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-grid-value{font-size:var(--acu-font-size,13px);color:var(--acu-text-main);font-weight:500;white-space:pre-wrap;word-break:break-word;line-height:1.35}.acu-card-full-area{display:flex;flex-direction:column;gap:8px;padding:0 12px 10px 12px}.acu-full-item{display:flex;flex-direction:column;gap:3px;padding:6px;border-radius:6px;border-top:1px dashed rgba(0,0,0,.05);cursor:pointer}.acu-full-item:hover{background:var(--acu-table-hover)}.acu-full-label{font-size:11px;color:var(--acu-title-color);font-weight:bold}.acu-full-value{font-size:var(--acu-font-size,13px);color:var(--acu-text-main);line-height:1.4;word-break:break-all;white-space:pre-wrap;max-height:var(--acu-text-max-height,80px);overflow-y:var(--acu-text-overflow,auto);scrollbar-width:none}.acu-data-card.acu-style-list .acu-card-body{padding:6px 12px;display:flex;flex-direction:column;gap:0}.acu-data-card.acu-style-list .acu-card-row{display:block !important;padding:6px 0 !important;border-bottom:1px dashed var(--acu-border);cursor:pointer;overflow:hidden}.acu-data-card.acu-style-list .acu-card-row:last-child{border-bottom:none}.acu-data-card.acu-style-list .acu-card-row:hover{background:var(--acu-table-hover)}.acu-data-card.acu-style-list .acu-card-label{float:left !important;clear:left;width:auto !important;margin-right:8px !important;color:var(--acu-title-color);font-size:.9em;font-weight:bold;line-height:1.5}.acu-data-card.acu-style-list .acu-card-value{display:block !important;width:auto !important;margin:0 !important;text-align:left !important;word-break:break-all !important;white-space:pre-wrap !important;line-height:1.5 !important;color:var(--acu-text-main);max-height:var(--acu-text-max-height,80px);overflow-y:var(--acu-text-overflow,auto);scrollbar-width:none}.acu-data-card.acu-style-list .acu-card-value::-webkit-scrollbar{display:none}.acu-data-card.acu-style-list .acu-highlight-changed{display:inline-block;width:auto;line-height:1.4}.acu-inline-input{width:100%;height:100%;box-sizing:border-box;background:hsla(0,0%,100%,.1);border:none;outline:none;font-family:inherit;font-size:inherit;line-height:1.5;color:inherit;resize:none;overflow:hidden;padding:2px;margin:0;display:block;border-radius:4px}.acu-delete-stamp,.acu-badge-pending{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-15deg);width:80px;height:80px;border:4px solid #e74c3c;border-radius:50%;color:#e74c3c;font-size:20px;font-weight:900;display:flex;align-items:center;justify-content:center;z-index:50;pointer-events:none;opacity:.6;box-shadow:inset 0 0 10px rgba(231,76,60,.2);background:hsla(0,0%,100%,.1);text-align:center;line-height:1.2}.acu-delete-stamp i,.acu-badge-pending i{display:none}.acu-cell-changed .acu-grid-value,.acu-cell-changed .acu-full-value,.acu-cell-changed .acu-card-value{font-weight:600}.acu-cell-changed-manual .acu-grid-value,.acu-cell-changed-manual .acu-full-value,.acu-cell-changed-manual .acu-card-value{color:var(--acu-highlight-manual,#d35400) !important;font-weight:600}.acu-cell-changed-ai .acu-grid-value,.acu-cell-changed-ai .acu-full-value,.acu-cell-changed-ai .acu-card-value{color:var(--acu-highlight-ai,#3498db) !important;font-weight:600}.acu-lock-mode .acu-grid-cell,.acu-lock-mode .acu-full-row,.acu-lock-mode .acu-card-row{cursor:pointer;transition:background-color .15s ease,border-color .15s ease}.acu-lock-mode .acu-grid-cell:hover,.acu-lock-mode .acu-full-row:hover,.acu-lock-mode .acu-card-row:hover{background:rgba(var(--acu-title-color-rgb,52,152,219),0.08)}.acu-cell-locked{position:relative;background:rgba(231,76,60,.08) !important;border-left:3px solid #e74c3c !important}.acu-cell-locked::after{content:"";font-family:"Font Awesome 6 Free","Font Awesome 5 Free",FontAwesome;font-weight:900;position:absolute;top:4px;right:6px;font-size:10px;color:#e74c3c;opacity:.7;pointer-events:none}.acu-cell-locked .acu-grid-value,.acu-cell-locked .acu-full-value,.acu-cell-locked .acu-card-value{color:#c0392b !important}.acu-cell-locked .acu-grid-label,.acu-cell-locked .acu-full-label,.acu-cell-locked .acu-card-label{color:#e74c3c;font-weight:600}.acu-cell-pending-lock{position:relative;background:rgba(46,204,113,.12) !important;border-left:3px solid #27ae60 !important}.acu-cell-pending-lock::after{content:"";font-family:"Font Awesome 6 Free","Font Awesome 5 Free",FontAwesome;font-weight:900;position:absolute;top:4px;right:6px;font-size:10px;color:#27ae60;opacity:.8;pointer-events:none}.acu-cell-pending-lock .acu-grid-value,.acu-cell-pending-lock .acu-full-value,.acu-cell-pending-lock .acu-card-value{color:#27ae60 !important}.acu-row-locked{background:rgba(231,76,60,.05) !important;border:1px solid rgba(231,76,60,.3) !important}.acu-row-locked .acu-card-header{background:rgba(231,76,60,.1);color:#c0392b}.acu-row-locked .acu-card-header::after{content:"已锁定";font-family:"Font Awesome 6 Free","Font Awesome 5 Free",FontAwesome,inherit;font-weight:600;font-size:11px;color:#e74c3c;margin-left:8px;opacity:.8}.acu-lock-mode-hint{display:flex;align-items:center;justify-content:center;gap:8px;padding:8px 16px;background:linear-gradient(135deg,rgba(231,76,60,0.1),rgba(192,57,43,0.05));border:1px solid rgba(231,76,60,.3);border-radius:8px;margin:8px 12px;font-size:12px;color:#c0392b}.acu-lock-mode-hint i{font-size:14px}.acu-pull-overlay{display:flex;align-items:center;justify-content:center;overflow:hidden;width:100%;flex:0 0 auto;height:0;transition:height .1s linear}.acu-pull-top{background:rgba(46,204,113,.15);border-bottom:2px dashed #27ae60;color:#27ae60}.acu-pull-bottom{background:rgba(231,76,60,.15);border-top:2px dashed #c0392b;color:#c0392b}.acu-pull-restore{background:rgba(52,152,219,.15) !important;border-top:2px dashed #2980b9 !important;color:#2980b9 !important}.acu-pull-icon{display:flex;flex-direction:column;align-items:center;gap:5px;opacity:.8}.acu-pull-text{font-size:12px;opacity:.9}.acu-swipe-overlay{position:absolute;top:0;bottom:0;width:0;display:flex;align-items:center;justify-content:center;overflow:hidden;pointer-events:none;z-index:10;font-size:18px;font-weight:bold;transition:width .1s linear;white-space:nowrap}.acu-swipe-right{left:0;background:rgba(46,204,113,.2);border-right:2px dashed #27ae60;color:#27ae60}.acu-swipe-left{right:0;background:rgba(231,76,60,.2);border-left:2px dashed #c0392b;color:#c0392b}.acu-swipe-restore{background:rgba(52,152,219,.2) !important;border-left:2px dashed #2980b9 !important;color:#2980b9 !important}.acu-data-table{display:flex;flex-direction:column;flex:1;min-height:0;height:100%;gap:0}.acu-data-table.acu-table-loading{opacity:.6;pointer-events:none}.acu-data-table.acu-show-graph{min-height:450px;height:auto !important;max-height:none !important;flex:1 1 auto}.acu-table-toolbar{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--acu-table-head,rgba(0,0,0,0.03));border-bottom:1px solid var(--acu-border,rgba(0,0,0,0.06));border-radius:0;gap:12px;z-index:10;flex-shrink:0}.acu-toolbar-left{display:flex;align-items:center;gap:8px;flex-shrink:0;min-width:0}.acu-table-title{font-weight:600;font-size:calc(var(--acu-font-size,13px) + 1px);color:var(--acu-title-color,var(--acu-text-main,#333));white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-table-count{font-size:calc(var(--acu-font-size,13px) - 2px);color:var(--acu-text-muted,#999);white-space:nowrap}.acu-table-badge{font-size:11px;padding:2px 6px;border-radius:10px;white-space:nowrap}.acu-table-badge.acu-badge-changed{background:rgba(102,126,234,.15);color:var(--acu-title-color,#667eea)}.acu-table-badge.acu-badge-deleting{background:rgba(231,76,60,.15);color:var(--acu-danger,#e74c3c)}.acu-toolbar-right{display:flex;align-items:center;gap:8px;flex-shrink:0}.acu-toolbar-btn{display:flex;align-items:center;justify-content:center;width:26px;height:26px;border:none;border-radius:var(--acu-radius-sm,4px);background:rgba(0,0,0,0);color:var(--acu-text-sub,#666);cursor:pointer;transition:all .15s ease}.acu-toolbar-btn:hover{background:var(--acu-btn-hover,rgba(0,0,0,0.06));color:var(--acu-text-main,#333)}.acu-toolbar-btn.active{background:var(--acu-title-color-bg,rgba(102,126,234,0.15));color:var(--acu-title-color,#667eea)}.acu-toolbar-btn i{font-size:12px}.acu-toolbar-btn.acu-height-handle{cursor:ns-resize;color:var(--acu-text-muted,#999)}.acu-toolbar-btn.acu-height-handle:hover{color:var(--acu-title-color,#667eea)}.acu-toolbar-btn.acu-close-btn:hover{background:rgba(231,76,60,.1);color:var(--acu-danger,#e74c3c)}.acu-search-box{position:relative;display:flex;align-items:center}.acu-search-icon{position:absolute;left:8px;color:var(--acu-text-muted,#999);font-size:12px;pointer-events:none}.acu-search-input{width:140px;padding:5px 28px 5px 28px;border:1px solid var(--acu-border,rgba(0,0,0,0.1));border-radius:var(--acu-radius-sm,4px);background:var(--acu-bg-panel,#fff);color:var(--acu-text-main,#333);font-size:calc(var(--acu-font-size,13px) - 1px);outline:none;transition:all .2s}.acu-search-input:focus{width:180px;border-color:var(--acu-title-color,#667eea)}.acu-search-input::placeholder{color:var(--acu-text-muted,#999)}.acu-search-clear{position:absolute;right:8px;color:var(--acu-text-muted,#999);cursor:pointer;font-size:11px}.acu-search-clear:hover{color:var(--acu-text-main,#333)}.acu-cards-container{flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;overscroll-behavior:contain;padding:12px}.acu-cards-container.acu-view-card{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-content:start}.acu-cards-container.acu-view-card>.acu-data-card{flex:0 0 var(--acu-card-width,280px);width:var(--acu-card-width,280px)}.acu-cards-container.acu-view-list{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-content:start}.acu-cards-container.acu-view-list>.acu-data-card{flex:0 0 var(--acu-card-width,280px);width:var(--acu-card-width,280px)}.acu-layout-horizontal .acu-cards-container{flex:1;min-height:0;display:flex !important;flex-wrap:nowrap !important;gap:14px;align-items:flex-start;justify-content:flex-start;white-space:nowrap;overflow-x:auto !important;overflow-y:hidden !important;touch-action:pan-x pan-y !important;padding:12px;padding-bottom:8px;overscroll-behavior-x:contain}.acu-layout-horizontal .acu-cards-container.acu-view-card,.acu-layout-horizontal .acu-cards-container.acu-view-list{display:flex !important;flex-wrap:nowrap !important}.acu-layout-horizontal .acu-data-card{flex:0 0 var(--acu-card-width,280px) !important;width:var(--acu-card-width,280px) !important;min-width:var(--acu-card-width,280px);max-height:calc(100% - 8px);overflow-y:auto;white-space:normal;touch-action:pan-x pan-y !important;display:flex !important}.acu-layout-horizontal .acu-data-table{height:100%;min-height:200px;display:flex;flex-direction:column;overflow:hidden}.acu-layout-horizontal .acu-table-toolbar{flex-shrink:0;position:relative;z-index:10}.acu-layout-horizontal .acu-pagination-container{flex-shrink:0;position:relative;z-index:10}.acu-layout-horizontal .acu-panel-content{overflow:hidden !important;min-height:150px}.acu-empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 24px;color:var(--acu-text-muted,#999);grid-column:1/-1}.acu-empty-state i{font-size:48px;margin-bottom:16px;opacity:.5}.acu-empty-state p{margin:0;font-size:var(--acu-font-size,13px)}.acu-pagination{display:flex;justify-content:center;align-items:center;gap:4px;padding:12px;flex-wrap:wrap}.acu-btn-page{min-width:32px;padding:4px 8px;font-size:calc(var(--acu-font-size,13px) - 1px)}.acu-btn-page.active{font-weight:600}.acu-page-ellipsis{padding:4px 8px;color:var(--acu-text-muted,#999)}.acu-page-info{margin-left:12px;color:var(--acu-text-muted,#666);font-size:calc(var(--acu-font-size,13px) - 1px)}.acu-action-btn{flex:1;height:36px;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border-radius:8px;color:var(--acu-text-sub);cursor:pointer;border:1px solid rgba(0,0,0,0);transition:all .2s;font-size:16px;-webkit-user-select:none;user-select:none}.acu-action-btn:hover{background:var(--acu-btn-hover);color:var(--acu-text-main);transform:translateY(-2px);border-color:var(--acu-border)}#acu-btn-save-global{color:var(--acu-title-color)}#acu-btn-save-global:hover{background:var(--acu-btn-active-bg);color:var(--acu-btn-active-text)}#acu-btn-save-specific{color:#9b59b6;display:none}.acu-dialog-btn{background:none;border:none;cursor:pointer;font-size:14px;font-weight:bold;display:flex;align-items:center;gap:6px;color:var(--acu-text-sub);transition:color .2s}.acu-page-btn{padding:0;border:1px solid var(--acu-border);background:var(--acu-btn-bg);color:var(--acu-title-color);border-radius:6px;cursor:pointer;font-size:12px;min-width:32px;height:32px;display:flex;align-items:center;justify-content:center;transition:all .2s;-webkit-user-select:none;user-select:none;font-weight:500;flex-shrink:0}.acu-page-btn:not(.disabled):not(.active):hover{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color);transform:translateY(-2px);box-shadow:0 2px 5px rgba(0,0,0,.1)}.acu-page-btn.active{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color);font-weight:bold;cursor:default}.acu-page-btn.disabled{opacity:.5;cursor:not-allowed;background:var(--acu-text-sub)}.acu-page-arrow{width:36px;font-size:14px}.acu-tab-btn{padding:6px 12px;cursor:pointer;font-size:13px;font-weight:bold;color:var(--acu-text-sub);border-bottom:2px solid rgba(0,0,0,0);transition:all .2s}.acu-tab-btn:hover{color:var(--acu-text-main);background:var(--acu-table-hover);border-radius:4px 4px 0 0}.acu-tab-btn.active{color:var(--acu-title-color);border-bottom-color:var(--acu-title-color)}.acu-action-bar{display:flex;align-items:center;gap:4px;padding:4px}.acu-action-bar .acu-action-btn{flex:none;width:32px;height:32px;padding:0;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);cursor:pointer;border-radius:6px;transition:all .2s ease}.acu-action-bar .acu-action-btn:hover{background:var(--acu-hover-bg,rgba(255,255,255,0.1));color:var(--acu-text-main);transform:none;border-color:rgba(0,0,0,0)}.acu-action-bar .acu-action-btn:active{transform:scale(0.95)}.acu-action-bar .acu-action-btn.acu-btn-active{background:var(--acu-title-color-bg,rgba(52,152,219,0.2));color:var(--acu-title-color,#3498db);border-color:var(--acu-title-color)}.acu-action-bar .acu-action-btn i{font-size:14px}.acu-btn-danger{color:#e74c3c}.acu-btn-danger:hover{background:rgba(231,76,60,.2)}.acu-btn-toggle.active{color:var(--acu-primary-color,#3498db);background:rgba(52,152,219,.2)}.has-changes{color:#f39c12;animation:pulse 1.5s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}.acu-action-btn-wrapper{position:relative;display:flex;align-items:center;flex:1}.acu-action-bar .acu-action-btn-wrapper{flex:none}.has-secondary{position:relative}.secondary-indicator{position:absolute;top:2px;right:2px;width:6px;height:6px;background:var(--acu-primary-color,#3498db);border-radius:50%;pointer-events:none}.acu-popup-btn{position:absolute;top:100%;left:50%;transform:translateX(-50%);margin-top:4px;z-index:100;background:var(--acu-panel-bg,#2a2a2a) !important;border:1px solid var(--acu-primary-color,#3498db) !important;box-shadow:0 4px 12px rgba(0,0,0,.3)}.acu-popup-btn:hover{background:var(--acu-primary-color,#3498db) !important;color:#fff !important}.popup-enter-active,.popup-leave-active{transition:all .2s ease}.popup-enter-from,.popup-leave-to{opacity:0;transform:translateX(-50%) translateY(-8px)}.popup-enter-to,.popup-leave-from{opacity:1;transform:translateX(-50%) translateY(0)}.acu-lock-mode-btns{display:flex;align-items:center;gap:4px;flex:none;margin-right:8px;padding-right:8px;border-right:1px solid var(--acu-border)}.acu-btn-success{color:#27ae60 !important;background:rgba(39,174,96,.15) !important;border:1px solid rgba(39,174,96,.3) !important}.acu-btn-success:hover{background:rgba(39,174,96,.25) !important;color:#2ecc71 !important}.acu-btn-cancel{color:#e74c3c !important;background:rgba(231,76,60,.15) !important;border:1px solid rgba(231,76,60,.3) !important}.acu-btn-cancel:hover{background:rgba(231,76,60,.25) !important;color:#ff6b6b !important}.acu-lock-count{display:inline-flex;align-items:center;justify-content:center;min-width:20px;height:20px;padding:0 6px;background:var(--acu-title-color);color:#fff;border-radius:10px;font-size:11px;font-weight:600;margin-left:4px}.acu-search-wrapper{position:relative;display:flex;align-items:center}.acu-search-input{background:var(--acu-btn-bg);border:1px solid var(--acu-border);color:var(--acu-text-main);padding:2px 2px 3px 22px;border-radius:16px;font-size:12px;width:100px;transition:all .2s}.acu-search-input:focus{width:140px;outline:none;border-color:var(--acu-title-color);background:var(--acu-input-bg)}.acu-search-icon{position:absolute;left:10px;font-size:10px;color:var(--acu-text-sub);pointer-events:none}.acu-inline-editor{width:100%;position:relative;touch-action:manipulation}.acu-edit-textarea{width:100%;min-height:24px;padding:6px 8px;border:2px solid var(--acu-title-color,#667eea);border-radius:var(--acu-radius-sm,4px);background:var(--acu-input-bg,#fff);color:var(--acu-text-main,#333);font-size:var(--acu-font-size,13px);font-family:inherit;line-height:1.5;resize:none;outline:none;box-sizing:border-box;overflow:hidden;user-select:text !important;-webkit-user-select:text !important;touch-action:manipulation}.acu-edit-textarea:focus{box-shadow:0 0 0 3px var(--acu-title-color-bg,rgba(102,126,234,0.2))}.acu-editing-lock .acu-inline-editor{touch-action:manipulation}.acu-edit-textarea-legacy{width:100%;min-height:100px;background:var(--acu-input-bg);border:1px solid var(--acu-border);border-radius:8px;padding:12px;font-size:inherit;font-family:inherit;color:var(--acu-text-main);resize:vertical;transition:border-color .2s}.acu-edit-textarea-legacy:focus{outline:none;border-color:var(--acu-title-color)}.acu-settings-input{background:var(--acu-input-bg);border:1px solid var(--acu-border);border-radius:6px;padding:8px 12px;color:var(--acu-text-main);font-size:14px;transition:border-color .2s}.acu-settings-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-range-input{-webkit-appearance:none;appearance:none;width:100%;height:6px;background:var(--acu-border);border-radius:3px;outline:none;cursor:pointer}.acu-range-input::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:var(--acu-title-color);border-radius:50%;cursor:pointer;-webkit-transition:transform .2s;transition:transform .2s}.acu-range-input::-webkit-slider-thumb:hover{transform:scale(1.2)}.acu-range-input::-moz-range-thumb{width:16px;height:16px;background:var(--acu-title-color);border-radius:50%;border:none;cursor:pointer}.acu-select{background:var(--acu-input-bg);border:1px solid var(--acu-border);border-radius:6px;padding:8px 12px;color:var(--acu-text-main);font-size:14px;cursor:pointer;transition:border-color .2s}.acu-select:focus{outline:none;border-color:var(--acu-title-color)}.acu-select option{background:var(--acu-bg-panel);color:var(--acu-text-main)}.acu-checkbox{display:flex;align-items:center;gap:8px;cursor:pointer;-webkit-user-select:none;user-select:none}.acu-checkbox input[type=checkbox]{width:18px;height:18px;accent-color:var(--acu-title-color);cursor:pointer}.acu-checkbox label{color:var(--acu-text-main);font-size:14px;cursor:pointer}.acu-search-box{display:flex;align-items:center;gap:12px}.acu-search-input-wrapper{position:relative;display:flex;align-items:center;flex:1;max-width:300px;min-width:180px}.acu-search-box .acu-search-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--acu-text-sub,#999);font-size:14px;pointer-events:none;transition:color var(--acu-transition-fast,0.15s);z-index:1}.focused .acu-search-box .acu-search-icon{color:var(--acu-title-color,#d35400)}.acu-search-box .acu-search-input{width:100%;height:36px;padding:0 36px;border:1px solid var(--acu-border,#dcd0c0);border-radius:var(--acu-radius-md,12px);background:var(--acu-input-bg,rgba(255,255,255,0.5));color:var(--acu-text-main,#5e4b35);font-size:var(--acu-font-size,13px);outline:none;transition:border-color var(--acu-transition-fast,0.15s),box-shadow var(--acu-transition-fast,0.15s),background var(--acu-transition-fast,0.15s)}.acu-search-box .acu-search-input::placeholder{color:var(--acu-text-sub,#999);opacity:.7}.acu-search-box .acu-search-input:focus{border-color:var(--acu-title-color,#d35400);box-shadow:0 0 0 3px var(--acu-title-color-bg,rgba(211,84,0,0.08));background:var(--acu-card-bg,#fffef9)}.has-value .acu-search-box .acu-search-input{padding-right:40px}.acu-search-clear{position:absolute;right:8px;display:flex;align-items:center;justify-content:center;width:24px;height:24px;border:none;border-radius:50%;background:var(--acu-badge-bg,#efebe4);color:var(--acu-text-sub,#999);cursor:pointer;transition:background var(--acu-transition-fast,0.15s),color var(--acu-transition-fast,0.15s),transform var(--acu-transition-fast,0.15s)}.acu-search-clear i{font-size:12px}.acu-search-clear:hover{background:var(--acu-danger,#e74c3c);color:#fff;transform:scale(1.1)}.acu-search-clear:active{transform:scale(0.95)}.acu-search-result{font-size:.85em;color:var(--acu-text-sub,#999);white-space:nowrap}.acu-search-result strong{color:var(--acu-title-color,#d35400);font-weight:600}.acu-search-result .no-result{color:var(--acu-warning,#f39c12)}.acu-fade-enter-active,.acu-fade-leave-active{transition:opacity .15s ease,transform .15s ease}.acu-fade-enter-from,.acu-fade-leave-to{opacity:0;transform:scale(0.8)}.acu-fade-enter-to,.acu-fade-leave-from{opacity:1;transform:scale(1)}@media (max-width:480px){.acu-search-box{flex-direction:column;align-items:stretch;gap:8px}.acu-search-input-wrapper{max-width:none;min-width:auto}.acu-search-box .acu-search-input{height:40px}.acu-search-result{text-align:center;font-size:.8em}}.acu-badge{display:inline-block;padding:2px 8px;border-radius:var(--acu-radius-sm,4px);font-size:calc(var(--acu-font-size,13px) - 1px);background:var(--acu-badge-bg,rgba(0,0,0,0.05));color:var(--acu-text-main,#333);line-height:1.4;word-break:break-word;white-space:pre-wrap}.acu-badge-default{background:rgba(0,0,0,0);padding:0;color:inherit}.acu-badge-pending{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-15deg);width:80px;height:80px;border:4px solid #e74c3c;border-radius:50%;color:#e74c3c;font-size:20px;font-weight:900;display:flex;align-items:center;justify-content:center;z-index:50;pointer-events:none;opacity:.6;box-shadow:inset 0 0 10px rgba(231,76,60,.2);background:hsla(0,0%,100%,.1)}.acu-badge-success{background:rgba(46,204,113,.15);color:#27ae60;border:1px solid rgba(46,204,113,.3)}.acu-badge-warning{background:rgba(241,196,15,.15);color:#f39c12;border:1px solid rgba(241,196,15,.3)}.acu-badge-danger{background:rgba(231,76,60,.15);color:#e74c3c;border:1px solid rgba(231,76,60,.3)}.acu-badge-info{background:rgba(52,152,219,.15);color:#3498db;border:1px solid rgba(52,152,219,.3)}.acu-badge-level{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;font-weight:bold;text-shadow:0 1px 2px rgba(0,0,0,.2)}.acu-badge-percent{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:#fff;font-weight:500}.acu-badge-male{background:rgba(0,0,0,0);color:inherit;padding:0}.acu-badge-female{background:rgba(0,0,0,0);color:inherit;padding:0}.acu-badge-number{background:var(--acu-title-color-bg,rgba(102,126,234,0.1));color:var(--acu-title-color,#667eea);font-weight:500;font-variant-numeric:tabular-nums}.acu-badge-count{min-width:20px;height:20px;padding:0 6px;border-radius:10px;font-size:11px;font-weight:bold;background:var(--acu-title-color);color:#fff}.acu-badge-tag{padding:4px 10px;border-radius:4px;font-size:11px;background:var(--acu-btn-bg);color:var(--acu-text-sub);border:1px solid var(--acu-border)}.acu-badge-tag:hover{background:var(--acu-btn-hover);color:var(--acu-text-main)}.acu-pagination-container{flex:0 0 auto;flex-shrink:0;width:100%;display:flex;justify-content:space-between;align-items:center;padding:6px 8px;background:var(--acu-bg-panel);border-top:1px solid var(--acu-border);z-index:10;box-sizing:border-box}.acu-pagination-container.hidden{display:none !important}.acu-pagination-numbers{display:flex;justify-content:center;align-items:center;gap:4px;flex:1;overflow:hidden}.acu-page-btn{padding:0;border:1px solid var(--acu-border);background:var(--acu-btn-bg);color:var(--acu-title-color);border-radius:5px;cursor:pointer;font-size:11px;min-width:26px;height:26px;display:flex;align-items:center;justify-content:center;transition:all .2s;-webkit-user-select:none;user-select:none;font-weight:500;flex-shrink:0}.acu-page-btn:not(.disabled):not(.active):hover{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color);transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.1)}.acu-page-btn.active{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color);font-weight:bold;cursor:default}.acu-page-btn.disabled{opacity:.5;cursor:not-allowed;background:var(--acu-text-sub)}.acu-page-arrow{width:30px;font-size:12px}.acu-page-dots{color:var(--acu-text-sub);font-size:11px;padding:0 2px;letter-spacing:1px}.acu-pagination-info{color:var(--acu-text-sub);font-size:11px;white-space:nowrap}.acu-pagination{display:flex;align-items:center;justify-content:center;padding:8px 15px;gap:5px;flex-wrap:nowrap;font-size:var(--acu-font-size,13px);background:var(--acu-bg-panel);border-top:1px solid var(--acu-border);box-sizing:border-box;width:100%;flex:0 0 auto}.acu-pagination .acu-pagination-info{display:flex;align-items:center;gap:4px;color:var(--acu-text-sub,#999);white-space:nowrap}.acu-pagination .acu-pagination-info strong{color:var(--acu-text-main,#5e4b35);font-weight:600}.acu-pagination .acu-pagination-info .acu-pagination-total{opacity:.7;font-size:.9em}.acu-pagination-controls{display:flex;align-items:center;gap:4px}.acu-page-list{display:flex;align-items:center;gap:4px}.acu-pagination .acu-btn{display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--acu-border,#dcd0c0);background:var(--acu-btn-bg,#dcd0c0);color:var(--acu-text-main,#5e4b35);cursor:pointer;transition:background var(--acu-transition-fast,0.15s),border-color var(--acu-transition-fast,0.15s),color var(--acu-transition-fast,0.15s),transform var(--acu-transition-fast,0.15s);-webkit-user-select:none;user-select:none;flex-shrink:0}.acu-pagination .acu-btn:hover:not(:disabled){background:var(--acu-title-color,#5e4b35);color:#fff;border-color:var(--acu-title-color,#5e4b35);transform:translateY(-2px);box-shadow:0 2px 5px rgba(0,0,0,.1)}.acu-pagination .acu-btn:active:not(:disabled){transform:scale(0.95)}.acu-pagination .acu-btn:disabled,.acu-pagination .acu-btn.disabled{opacity:.5;cursor:not-allowed;background:var(--acu-text-sub,#999)}.acu-pagination .acu-btn-icon{width:32px;height:32px;padding:0;border-radius:var(--acu-radius-sm,6px)}.acu-pagination .acu-btn-icon i{font-size:14px}.acu-pagination .acu-btn-page{min-width:32px;height:32px;padding:0;border-radius:6px;font-size:12px;font-weight:500;flex-shrink:0}.acu-pagination .acu-btn-page.active{background:var(--acu-title-color,#5e4b35);border-color:var(--acu-title-color,#5e4b35);color:#fff;font-weight:bold;cursor:default}.acu-pagination .acu-btn-page.active:hover{transform:none}.acu-pagination .acu-btn-page i{font-size:14px}.acu-pagination .acu-btn-sm{height:28px;padding:0 12px;font-size:12px;border-radius:var(--acu-radius-sm,6px)}.acu-page-ellipsis{display:flex;align-items:center;justify-content:center;min-width:24px;height:32px;color:var(--acu-text-sub,#999);font-size:12px;padding:0 2px;letter-spacing:1px;flex-shrink:0}.acu-page-ellipsis i{font-size:12px}.acu-page-info{display:flex;align-items:center;color:var(--acu-text-sub,#999);font-size:12px;white-space:nowrap;margin-left:8px;flex-shrink:0}.acu-pagination-jump{display:flex;align-items:center;gap:8px;color:var(--acu-text-sub,#999);white-space:nowrap}.acu-pagination-jump .acu-input-sm{width:56px;height:28px;padding:0 8px;border:1px solid var(--acu-border,#dcd0c0);border-radius:var(--acu-radius-sm,6px);background:var(--acu-input-bg,rgba(255,255,255,0.5));color:var(--acu-text-main,#5e4b35);font-size:var(--acu-font-size,13px);text-align:center;outline:none;transition:border-color var(--acu-transition-fast,0.15s),box-shadow var(--acu-transition-fast,0.15s);-moz-appearance:textfield}.acu-pagination-jump .acu-input-sm::-webkit-outer-spin-button,.acu-pagination-jump .acu-input-sm::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.acu-pagination-jump .acu-input-sm:focus{border-color:var(--acu-title-color,#d35400);box-shadow:0 0 0 3px var(--acu-title-color-bg,rgba(211,84,0,0.08))}@media (max-width:480px){.acu-pagination{flex-direction:column;gap:12px}.acu-pagination .acu-pagination-info{order:-1}.acu-pagination-jump{font-size:12px}.acu-pagination-jump .acu-input-sm{width:48px;height:26px}.acu-pagination-jump .acu-btn-sm{height:26px;padding:0 10px}}.acu-dash-container{display:grid;grid-template-columns:1fr 2fr;gap:16px;height:100%;padding:5px;overflow-y:auto;font-size:var(--acu-font-size);touch-action:pan-y}@media (max-width:700px){.acu-dash-container{grid-template-columns:1fr}}.acu-dash-card{background:var(--acu-card-bg);border-radius:12px;border:1px solid var(--acu-border);padding:16px;display:flex;flex-direction:column;gap:12px;box-shadow:0 4px 12px var(--acu-shadow)}.acu-dash-title{font-size:1.2em;font-weight:bold;color:var(--acu-title-color);border-bottom:1px dashed var(--acu-border);padding-bottom:8px;margin-bottom:4px;display:flex;justify-content:space-between;align-items:center}.acu-dash-title-text{display:flex;align-items:center;gap:8px}.acu-dash-title-text i{font-size:.9em}.acu-dash-actions{display:flex;gap:4px}.acu-dash-action-btn{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border:1px solid rgba(0,0,0,0);border-radius:6px;color:var(--acu-text-sub);cursor:pointer;transition:all .2s}.acu-dash-action-btn:hover{background:var(--acu-btn-hover);color:var(--acu-title-color);border-color:var(--acu-border)}.acu-dash-char-info{display:flex;flex-direction:column;gap:10px}.acu-dash-stat-row{display:flex;justify-content:space-between;align-items:center;padding:8px;background:var(--acu-btn-bg);border-radius:8px}.acu-dash-stat-label{color:var(--acu-text-sub);font-size:.9em}.acu-dash-stat-val{color:var(--acu-text-main);font-weight:bold;font-size:1.1em}.acu-dash-npc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px}.acu-dash-npc-item{background:var(--acu-table-head);padding:10px;border-radius:8px;cursor:default;text-align:center;border:1px solid rgba(0,0,0,0);transition:all .2s;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--acu-text-main);font-size:1em}.acu-dash-npc-item:hover{border-color:var(--acu-highlight);color:var(--acu-highlight);background:var(--acu-btn-bg)}.acu-dash-sub-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:auto}.acu-dash-list-item{padding:6px 0;border-bottom:1px solid var(--acu-border);color:var(--acu-text-sub);font-size:1em;display:flex;align-items:center;gap:6px;cursor:default}.acu-dash-list-item:hover{color:var(--acu-text-main);padding-left:4px}.acu-dash-list-item i{font-size:.8em;color:var(--acu-highlight)}.acu-dash-interactive{cursor:pointer !important;position:relative}.acu-dash-interactive:hover::after{content:"";font-family:"Font Awesome 6 Free";font-weight:900;position:absolute;right:5px;top:50%;transform:translateY(-50%);opacity:.5;font-size:10px}.acu-tab-header{display:flex;gap:5px;border-bottom:1px solid var(--acu-border);margin-bottom:10px}.acu-tab-btn{padding:6px 12px;cursor:pointer;font-size:13px;font-weight:bold;color:var(--acu-text-sub);transition:all .2s;background:rgba(0,0,0,0);border:none;border-bottom:2px solid rgba(0,0,0,0)}.acu-tab-btn:hover{color:var(--acu-text-main);background:var(--acu-table-hover);border-radius:4px 4px 0 0}.acu-tab-btn.active{color:var(--acu-highlight);border-bottom-color:var(--acu-highlight)}.acu-tab-pane{display:none;animation:fadeIn .3s}.acu-tab-pane.active{display:block}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.acu-dash-npc-item.acu-highlight-changed,.acu-dash-list-item.acu-highlight-changed{color:var(--acu-highlight) !important;background-color:var(--acu-highlight-bg);font-weight:bold;animation:pulse-highlight 2s infinite}.acu-dash-more-btn{display:block;width:100%;padding:8px;text-align:center;background:rgba(0,0,0,0);border:none;color:var(--acu-text-sub);cursor:pointer;font-size:.9em;transition:color .2s}.acu-dash-more-btn:hover{color:var(--acu-title-color)}.acu-dash-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;color:var(--acu-text-sub);text-align:center}.acu-dash-empty i{font-size:24px;margin-bottom:8px;opacity:.5}.acu-dash-add-btn{display:flex;align-items:center;justify-content:center;min-height:120px;background:var(--acu-btn-bg);border:2px dashed var(--acu-border);border-radius:12px;cursor:pointer;transition:all .2s;color:var(--acu-text-sub);font-size:24px}.acu-dash-add-btn:hover{border-color:var(--acu-title-color);color:var(--acu-title-color);background:var(--acu-table-hover)}.acu-dash-col-left,.acu-dash-col-right{display:flex;flex-direction:column;gap:16px}.acu-dash-widget{position:relative;background:var(--acu-card-bg);border-radius:12px;border:1px solid var(--acu-border);padding:16px;display:flex;flex-direction:column;gap:12px;box-shadow:0 4px 12px var(--acu-shadow);transition:all .2s ease}.acu-dash-widget.acu-dash-widget-wide{grid-column:span 2}@media (max-width:700px){.acu-dash-widget.acu-dash-widget-wide{grid-column:span 1}}.acu-dash-widget-editing{border:2px dashed var(--acu-title-color);cursor:grab;background:linear-gradient(var(--acu-card-bg),var(--acu-card-bg)) padding-box,linear-gradient(45deg,var(--acu-title-color),var(--acu-border)) border-box}.acu-dash-widget-editing:active{cursor:grabbing}.acu-widget-remove{position:absolute;top:-10px;left:-10px;width:24px;height:24px;border-radius:50%;background:#e74c3c;color:#fff;border:2px solid var(--acu-card-bg);cursor:pointer;z-index:10;display:flex;align-items:center;justify-content:center;font-size:12px;box-shadow:0 2px 6px rgba(0,0,0,.2);transition:transform .15s ease}.acu-widget-remove:hover{transform:scale(1.1)}.acu-widget-config{position:absolute;top:-10px;right:-10px;width:24px;height:24px;border-radius:50%;background:var(--acu-title-color);color:#fff;border:2px solid var(--acu-card-bg);cursor:pointer;z-index:10;display:flex;align-items:center;justify-content:center;font-size:12px;box-shadow:0 2px 6px rgba(0,0,0,.2);transition:transform .15s ease}.acu-widget-config:hover{transform:scale(1.1)}.acu-widget-resize{position:absolute;bottom:-10px;right:-10px;width:24px;height:24px;border-radius:50%;background:var(--acu-btn-bg);color:var(--acu-text-sub);border:2px solid var(--acu-border);cursor:nwse-resize;z-index:10;display:flex;align-items:center;justify-content:center;font-size:10px;box-shadow:0 2px 6px rgba(0,0,0,.2);transition:all .15s ease}.acu-widget-resize:hover{background:var(--acu-title-color);color:#fff;border-color:var(--acu-title-color)}.acu-dash-body-scrollable{max-height:200px;overflow-y:auto;overflow-x:hidden}.acu-dash-body-scrollable::-webkit-scrollbar{width:4px}.acu-dash-body-scrollable::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.acu-dash-body-scrollable::-webkit-scrollbar-thumb{background:var(--acu-border);border-radius:2px}.acu-dash-body-scrollable::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub)}.acu-dash-count{display:inline-flex;align-items:center;justify-content:center;min-width:18px;height:18px;padding:0 5px;font-size:11px;font-weight:600;color:var(--acu-title-color);background:var(--acu-title-color-bg,rgba(var(--acu-title-color-rgb),0.15));border-radius:9px}.acu-dash-list-text{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-dash-list-badge{padding:2px 6px;font-size:11px;background:var(--acu-table-head);border-radius:4px;color:var(--acu-text-sub)}.acu-dash-compact{display:flex;flex-direction:column;gap:8px}.acu-dash-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--acu-border);background:var(--acu-bg-nav);flex-shrink:0}.acu-dash-header-title{font-size:1.1em;font-weight:600;color:var(--acu-text-main)}.acu-dash-header-actions{display:flex;gap:8px;align-items:center}.acu-dash-sort-btn{padding:6px 12px;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s;background:var(--acu-btn-bg);color:var(--acu-text-sub);border:1px solid var(--acu-border)}.acu-dash-sort-btn:hover{background:var(--acu-btn-hover);color:var(--acu-text-main);border-color:var(--acu-border)}.acu-dash-sort-btn i{margin-right:0}.acu-dash-edit-btn,.acu-dash-done-btn,.acu-dash-add-widget-btn{padding:6px 12px;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s;border:1px solid rgba(0,0,0,0)}.acu-dash-edit-btn{background:var(--acu-btn-bg);color:var(--acu-text-sub);border-color:var(--acu-border)}.acu-dash-edit-btn:hover{background:var(--acu-btn-hover);color:var(--acu-text-main)}.acu-dash-done-btn{background:var(--acu-title-color);color:#fff}.acu-dash-done-btn:hover{opacity:.9}.acu-dash-add-widget-btn{background:var(--acu-btn-bg);color:var(--acu-title-color);border-color:var(--acu-title-color)}.acu-dash-add-widget-btn:hover{background:var(--acu-title-color);color:#fff}.acu-dash-add-widget-btn i{margin-right:4px}.acu-dash-grid{flex:1;overflow-y:auto;display:grid;grid-template-columns:repeat(2,1fr);gap:16px;padding:16px;align-content:start}@media (max-width:700px){.acu-dash-grid{grid-template-columns:1fr}}.acu-dash-widget-dragging{opacity:.5}.acu-dash-widget-drop-target{border:2px dashed var(--acu-title-color);background:var(--acu-title-color-bg,rgba(var(--acu-title-color-rgb),0.1))}.acu-dash-container-new{display:flex;flex-direction:column;height:100%;overflow:hidden}.acu-dash-empty-state{grid-column:1/-1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 24px;text-align:center;color:var(--acu-text-sub)}.acu-dash-empty-state i{font-size:48px;margin-bottom:16px;opacity:.5}.acu-dash-empty-state p{margin:0 0 16px;font-size:14px}.acu-dash-add-first-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:var(--acu-title-color);color:#fff;border:none;border-radius:8px;font-size:14px;cursor:pointer;transition:opacity .2s}.acu-dash-add-first-btn:hover{opacity:.9}.acu-add-widget-modal{max-width:400px}@media (max-width:500px){.acu-add-widget-modal{max-width:95%}}.acu-add-widget-hint{font-size:13px;color:var(--acu-text-sub);margin-bottom:12px}.acu-add-widget-list{display:flex;flex-direction:column;gap:8px;max-height:300px;overflow-y:auto}.acu-add-widget-item{display:flex;align-items:center;gap:12px;padding:12px;background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:8px;cursor:pointer;transition:all .2s}.acu-add-widget-item:hover{border-color:var(--acu-title-color);background:var(--acu-table-hover)}.acu-add-widget-item i{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:var(--acu-table-head);border-radius:6px;color:var(--acu-title-color)}.acu-add-widget-item-added{opacity:.5;cursor:not-allowed}.acu-add-widget-item-added:hover{border-color:var(--acu-border);background:var(--acu-card-bg)}.acu-add-widget-name{flex:1;font-weight:500;color:var(--acu-text-main)}.acu-add-widget-count{font-size:12px;color:var(--acu-text-sub)}.acu-add-widget-badge{font-size:11px;padding:2px 8px;background:var(--acu-table-head);border-radius:4px;color:var(--acu-text-sub)}.acu-actions-config-modal{max-width:320px}@media (max-width:400px){.acu-actions-config-modal{max-width:95%}}.acu-actions-list{display:flex;flex-direction:column;gap:8px}.acu-action-checkbox{display:flex;align-items:center;gap:12px;padding:10px 12px;background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:8px;cursor:pointer;transition:all .2s}.acu-action-checkbox input[type=checkbox]{width:18px;height:18px;accent-color:var(--acu-title-color)}.acu-action-checkbox i{width:24px;color:var(--acu-text-sub);text-align:center}.acu-action-checkbox span{flex:1;font-size:13px;color:var(--acu-text-main)}.acu-action-checkbox:hover{border-color:var(--acu-title-color)}.acu-action-checkbox.active{border-color:var(--acu-title-color);background:var(--acu-title-color-bg,rgba(var(--acu-title-color-rgb),0.1))}.acu-action-checkbox.active i{color:var(--acu-title-color)}.acu-dash-config-list{display:flex;flex-direction:column;gap:8px}.acu-dash-config-item{display:flex;align-items:center;gap:12px;padding:12px;background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:8px}.acu-dash-config-item .acu-dash-config-icon{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:var(--acu-table-head);border-radius:6px;color:var(--acu-title-color)}.acu-dash-config-item .acu-dash-config-info{flex:1}.acu-dash-config-item .acu-dash-config-info .title{font-weight:600;color:var(--acu-text-main)}.acu-dash-config-item .acu-dash-config-info .subtitle{font-size:.85em;color:var(--acu-text-sub)}.acu-dash-config-item .acu-dash-config-actions{display:flex;gap:8px}.acu-tab-container{display:flex;flex-direction:column;height:100%;overflow:hidden}.acu-tab-header{display:flex;align-items:center;padding:0 8px;background:var(--acu-bg-panel);border-bottom:1px solid var(--acu-border);flex-shrink:0}.acu-tab-scroll{display:flex;overflow-x:auto;scrollbar-width:none;-ms-overflow-style:none;flex:1}.acu-tab-scroll::-webkit-scrollbar{display:none}.acu-tab-btn{display:flex;align-items:center;gap:6px;padding:10px 16px;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);font-size:13px;cursor:pointer;white-space:nowrap;position:relative;transition:all .2s ease}.acu-tab-btn i{font-size:14px}.acu-tab-btn:hover{color:var(--acu-text-main);background:var(--acu-btn-hover)}.acu-tab-btn.active{color:var(--acu-title-color);font-weight:600}.acu-tab-btn.active::after{content:"";position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:60%;height:3px;background:var(--acu-title-color);border-radius:3px 3px 0 0}.acu-tab-content{flex:1;overflow-y:auto;overflow-x:hidden;padding:8px}.acu-tab-panel{display:none;height:100%}.acu-tab-panel.active{display:block}.acu-tab-sortable .acu-tab-btn{cursor:move}.acu-tab-sortable .acu-tab-btn:hover{background:var(--acu-title-color);color:#fff}.acu-tab-sortable .acu-tab-btn.sortable-ghost{opacity:.5;background:var(--acu-title-color)}.acu-tab-sortable .acu-tab-btn.sortable-chosen{background:var(--acu-title-color);color:#fff}.acu-tab-actions{display:flex;align-items:center;gap:4px;margin-left:auto;padding-left:8px;border-left:1px solid var(--acu-border)}.acu-tab-action-btn{width:28px;height:28px;display:flex;align-items:center;justify-content:center;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);border-radius:6px;cursor:pointer;transition:all .2s ease}.acu-tab-action-btn:hover{background:var(--acu-btn-hover);color:var(--acu-text-main)}.acu-tab-action-btn.active{background:var(--acu-title-color);color:#fff}.acu-tab-badge{display:inline-flex;align-items:center;justify-content:center;min-width:18px;height:18px;padding:0 5px;background:var(--acu-title-color);color:#fff;font-size:10px;font-weight:bold;border-radius:9px;margin-left:4px}.acu-tab-close{display:flex;align-items:center;justify-content:center;width:16px;height:16px;margin-left:6px;border-radius:50%;font-size:10px;opacity:0;transition:all .2s ease}.acu-tab-btn:hover .acu-tab-close{opacity:.7}.acu-tab-close:hover{opacity:1 !important;background:rgba(231,76,60,.3);color:#e74c3c}.acu-tab-add{width:32px;height:32px;display:flex;align-items:center;justify-content:center;margin-left:8px;border:1px dashed var(--acu-border);border-radius:6px;color:var(--acu-text-sub);cursor:pointer;transition:all .2s ease}.acu-tab-add:hover{border-color:var(--acu-title-color);color:var(--acu-title-color);background:rgba(var(--acu-title-color-rgb),0.1)}.acu-options-panel{display:flex;flex-direction:column;height:100%;min-height:0}.acu-options-header{flex:0 0 auto;padding:8px 12px;-webkit-user-select:none;user-select:none}.acu-options-title{font-size:1.2em;font-weight:800;color:var(--acu-title-color,#333);display:flex;align-items:center;gap:8px}.acu-options-title i{color:var(--acu-title-color,#667eea)}.acu-options-count{color:var(--acu-text-sub,#666);font-size:.9em}.acu-options-content{flex:1;overflow-y:auto !important;min-height:0;padding:10px;touch-action:pan-y;-webkit-overflow-scrolling:touch;position:relative;z-index:10}.acu-options-list{display:flex;flex-direction:column;gap:12px;padding-bottom:20px}.acu-empty-state{text-align:center;color:var(--acu-text-sub,#666);padding:30px;font-size:.9em}.acu-option-rows{display:flex;flex-direction:column;gap:6px}.acu-option-row{display:flex;align-items:flex-start;gap:10px;padding:12px;background:hsla(0,0%,100%,.05);border-radius:8px;border:1px solid var(--acu-border,rgba(255,255,255,0.1));cursor:pointer;transition:background .1s,transform .1s;-webkit-user-select:none;user-select:none;touch-action:pan-y}.acu-option-row:hover{background:var(--acu-table-hover,rgba(255,255,255,0.1));border-color:var(--acu-title-color,#667eea)}.acu-option-row:active{transform:translateY(1px)}.acu-option-tags{display:flex;flex-wrap:wrap;gap:4px;max-width:35%;flex-shrink:0;margin-top:2px}.acu-option-tag{background:var(--acu-btn-bg,rgba(255,255,255,0.1));color:var(--acu-title-color,#fff);border:1px solid rgba(0,0,0,.1);opacity:.9;font-size:.85em;padding:2px 6px;border-radius:4px;line-height:1.3;font-weight:bold}.acu-option-text{flex:1;color:var(--acu-text-main,#333);font-weight:500;font-size:var(--acu-font-size,14px);line-height:1.5;word-break:break-word;white-space:pre-wrap}.acu-options-grid{display:flex;flex-direction:column;gap:12px}.acu-option-group{background:var(--acu-bg-elevated,#fff);border-radius:var(--acu-radius-md,8px);box-shadow:0 2px 8px rgba(0,0,0,.08);overflow:hidden}.acu-option-header{display:flex;align-items:center;gap:8px;padding:12px 16px;background:var(--acu-bg-header,rgba(0,0,0,0.02));cursor:pointer;transition:background .2s;-webkit-user-select:none;user-select:none}.acu-option-header:hover{background:var(--acu-hover-bg,rgba(0,0,0,0.05))}.acu-option-header>i:first-child{color:var(--acu-text-muted,#666);transition:transform .2s}.acu-option-header .acu-option-name{flex:1;font-weight:600;color:var(--acu-text-main,#333)}.acu-option-header .acu-btn-icon{padding:4px 6px;color:var(--acu-text-muted,#999)}.acu-option-header .acu-btn-icon:hover{color:var(--acu-title-color,#667eea)}.acu-option-content{padding:16px;border-top:1px solid var(--acu-border,rgba(0,0,0,0.05))}.acu-matrix-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px;margin-bottom:12px}.acu-matrix-cell{display:flex;align-items:center;justify-content:space-between;gap:4px;padding:10px 12px;background:var(--acu-bg-panel,rgba(0,0,0,0.03));border-radius:var(--acu-radius-sm,4px);cursor:pointer;transition:all .2s;border:2px solid rgba(0,0,0,0)}.acu-matrix-cell:hover{background:var(--acu-hover-bg,rgba(0,0,0,0.05))}.acu-matrix-cell.active{background:var(--acu-title-color-bg,rgba(102,126,234,0.15));border-color:var(--acu-title-color,#667eea)}.acu-matrix-cell.active .acu-matrix-label{color:var(--acu-title-color,#667eea);font-weight:600}.acu-matrix-cell.active i{color:var(--acu-title-color,#667eea)}.acu-matrix-cell.changed{box-shadow:0 0 0 2px var(--acu-warning,#f39c12)}.acu-matrix-cell.deleting{opacity:.5;text-decoration:line-through}.acu-matrix-label{font-size:calc(var(--acu-font-size,13px) - 1px);color:var(--acu-text-main,#333);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-option-list{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}.acu-option-actions{display:flex;gap:8px;flex-wrap:wrap;padding-top:12px;border-top:1px solid var(--acu-border,rgba(0,0,0,0.05))}.acu-sortable-list{display:flex;flex-direction:column;gap:4px}.acu-sortable-item{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--acu-card-bg,rgba(255,255,255,0.05));border-radius:6px;cursor:pointer;transition:all .2s ease;border:1px solid rgba(0,0,0,0)}.acu-sortable-item:hover{background:var(--acu-hover-bg,rgba(255,255,255,0.1))}.acu-sortable-item.selected{background:var(--acu-selected-bg,rgba(52,152,219,0.2));border-color:var(--acu-primary-color,#3498db)}.acu-sort-controls{display:flex;flex-direction:column;gap:2px}.acu-sort-btn{display:flex;align-items:center;justify-content:center;width:20px;height:16px;padding:0;border:none;background:rgba(0,0,0,0);color:var(--acu-text-secondary,#999);cursor:pointer;transition:color .2s}.acu-sort-btn:hover:not(:disabled){color:var(--acu-primary-color,#3498db)}.acu-sort-btn:disabled{opacity:.3;cursor:not-allowed}.acu-sort-btn i{font-size:10px}.acu-item-content{flex:1;display:flex;align-items:center;gap:8px;min-width:0}.acu-item-content i{flex-shrink:0;width:16px;text-align:center;color:var(--acu-text-secondary,#999)}.acu-item-content span{font-size:13px;color:var(--acu-text-primary,#fff);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-remove-btn{flex-shrink:0;display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:0;border:none;background:rgba(0,0,0,0);color:var(--acu-text-secondary,#999);cursor:pointer;border-radius:4px;transition:all .2s}.acu-remove-btn:hover{background:rgba(231,76,60,.2);color:#e74c3c}.acu-sortable-empty{padding:20px;text-align:center;color:var(--acu-text-secondary,#999);font-size:13px}.acu-tab-config-panel,.acu-button-config-panel{display:flex;flex-direction:column;gap:16px}.acu-btn-text{display:flex;align-items:center;gap:4px;padding:4px 8px;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub,#999);cursor:pointer;font-size:12px;border-radius:4px;transition:all .2s}.acu-btn-text:hover{background:var(--acu-btn-hover,#cbbba8);color:var(--acu-text-main,#5e4b35)}.acu-btn-text.acu-btn-clear{font-size:11px}.acu-btn-text.acu-btn-clear:hover{color:#e74c3c;background:rgba(231,76,60,.1)}.acu-config-section{display:flex;flex-direction:column;gap:8px}.acu-config-section h4{margin:0;font-size:13px;font-weight:600;color:var(--acu-text-main,#5e4b35);display:flex;align-items:center;gap:6px}.acu-config-section h4 .acu-btn-reset{margin-left:auto;font-size:11px}.acu-config-hint{display:flex;align-items:center;gap:6px;padding:8px 12px;background:var(--acu-table-head,#efebe4);border:1px solid var(--acu-border,#dcd0c0);border-radius:6px;font-size:12px;color:var(--acu-text-sub,#999)}.acu-config-hint i{color:var(--acu-title-color,#d35400)}.acu-visible-area{background:var(--acu-title-color-bg,rgba(211,84,0,0.08));border-radius:8px;padding:12px;border:1px dashed var(--acu-border,#dcd0c0)}.acu-visible-area h4{display:flex;align-items:center;gap:6px;font-weight:600}.acu-visible-area h4 i{color:var(--acu-title-color,#d35400)}.acu-hidden-area{background:var(--acu-table-head,#efebe4);border-radius:8px;padding:12px}.acu-hidden-area h4{display:flex;align-items:center;gap:6px;font-weight:600}.acu-hidden-area h4 i{color:var(--acu-text-sub,#999)}.acu-tab-visible-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:6px;max-height:160px;overflow-y:auto;padding:4px}@media (max-width:480px){.acu-tab-visible-grid{grid-template-columns:repeat(2,1fr)}}.acu-tab-config-btn{position:relative;cursor:grab}.acu-tab-config-btn:hover{border-color:#e74c3c !important;background:rgba(231,76,60,.1) !important}.acu-tab-config-btn.dragging{opacity:.5;cursor:grabbing;border:2px dashed var(--acu-title-color,#d35400) !important}.acu-tab-config-btn .tab-type-badge-mini{position:absolute;top:-4px;right:-4px;font-size:8px;padding:1px 4px;border-radius:3px;background:var(--acu-title-color,#d35400);color:#fff;line-height:1.2}.acu-tab-hidden-list{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;max-height:150px;overflow-y:auto;padding:4px}@media (max-width:480px){.acu-tab-hidden-list{grid-template-columns:repeat(2,1fr)}}.acu-tab-hidden-item{display:flex;align-items:center;gap:6px;padding:8px 10px;border:1px solid var(--acu-border,#dcd0c0);border-radius:6px;background:var(--acu-card-bg,#fffef9);color:var(--acu-text-sub,#999);cursor:pointer;transition:all .2s;font-size:12px}.acu-tab-hidden-item:hover{background:var(--acu-title-color-bg,rgba(211,84,0,0.08));border-color:var(--acu-title-color,#d35400);color:var(--acu-title-color,#d35400)}.acu-tab-hidden-item:hover .add-icon{color:var(--acu-title-color,#d35400)}.acu-tab-hidden-item.is-special{border-left:2px solid var(--acu-text-sub,#999)}.acu-tab-hidden-item .tab-icon{width:14px;text-align:center}.acu-tab-hidden-item .tab-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-tab-hidden-item .tab-type-badge{font-size:9px;padding:1px 4px;border-radius:2px;background:rgba(0,0,0,.05)}.acu-tab-hidden-item .add-icon{font-size:10px;color:var(--acu-text-sub,#999)}.acu-empty-hint{display:flex;align-items:center;justify-content:center;gap:8px;padding:16px;color:var(--acu-text-sub,#999);font-size:12px;font-style:italic}.acu-empty-hint i{font-size:14px}.acu-btn-visible-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(48px,1fr));gap:8px;max-height:180px;overflow-y:auto;padding:4px}@media (max-width:480px){.acu-btn-visible-grid{grid-template-columns:repeat(5,1fr)}}.acu-btn-config-item{position:relative;display:flex;align-items:center;justify-content:center;width:48px;height:48px;border:1px solid var(--acu-border,#dcd0c0);border-radius:8px;background:var(--acu-card-bg,#fffef9);cursor:grab;transition:all .2s}.acu-btn-config-item .btn-icon{font-size:16px;color:var(--acu-text-main,#5e4b35)}.acu-btn-config-item:hover{background:rgba(231,76,60,.1);border-color:#e74c3c}.acu-btn-config-item:hover .btn-icon{color:#e74c3c}.acu-btn-config-item.is-required{cursor:default;border-color:var(--acu-title-color,#d35400)}.acu-btn-config-item.is-required:hover{background:var(--acu-card-bg,#fffef9);border-color:var(--acu-title-color,#d35400)}.acu-btn-config-item.is-required:hover .btn-icon{color:var(--acu-text-main,#5e4b35)}.acu-btn-config-item .required-dot{position:absolute;top:4px;right:4px;width:6px;height:6px;border-radius:50%;background:var(--acu-title-color,#d35400)}.acu-btn-config-item .attachment-indicator{position:absolute;bottom:-4px;right:-4px;display:flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:50%;background:var(--acu-title-color,#d35400);color:#fff;font-size:8px;cursor:pointer;border:2px solid var(--acu-bg-panel,#e6e2d3);transition:all .2s}.acu-btn-config-item .attachment-indicator:hover{background:#e74c3c;transform:scale(1.1)}.acu-btn-config-item .attachment-add-btn{position:absolute;bottom:-4px;right:-4px;display:flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:4px;border:1px dashed var(--acu-text-sub,#999);background:var(--acu-bg-panel,#e6e2d3);color:var(--acu-text-sub,#999);font-size:8px;cursor:pointer;padding:0;transition:all .2s}.acu-btn-config-item .attachment-add-btn:hover{border-color:var(--acu-title-color,#d35400);color:var(--acu-title-color,#d35400);background:var(--acu-title-color-bg,rgba(211,84,0,0.08))}.acu-btn-hidden-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(40px,1fr));gap:6px;max-height:100px;overflow-y:auto;padding:4px}@media (max-width:480px){.acu-btn-hidden-grid{grid-template-columns:repeat(6,1fr)}}.acu-btn-hidden-item{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border:1px solid var(--acu-border,#dcd0c0);border-radius:6px;background:var(--acu-card-bg,#fffef9);color:var(--acu-text-sub,#999);cursor:pointer;transition:all .2s;font-size:14px;padding:0}.acu-btn-hidden-item:hover{background:var(--acu-title-color-bg,rgba(211,84,0,0.08));border-color:var(--acu-title-color,#d35400);color:var(--acu-title-color,#d35400)}.acu-config-hint-fixed{position:sticky;bottom:0;margin-top:auto;background:var(--acu-bg-panel,#e6e2d3);border-top:1px solid var(--acu-border,#dcd0c0);border-left:none;border-right:none;border-bottom:none;border-radius:0;margin-left:-16px;margin-right:-16px;padding:10px 16px;margin-bottom:-16px}.acu-attachment-picker-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--acu-overlay-bg,rgba(0,0,0,0.5));display:flex;align-items:center;justify-content:center;z-index:10002}.acu-attachment-picker{width:90%;max-width:300px;background:var(--acu-bg-panel,#e6e2d3);border:1px solid var(--acu-border,#dcd0c0);border-radius:12px;box-shadow:0 8px 32px var(--acu-shadow,rgba(0,0,0,0.2));overflow:hidden}.acu-attachment-picker .picker-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--acu-table-head,#efebe4);border-bottom:1px solid var(--acu-border,#dcd0c0)}.acu-attachment-picker .picker-header h4{margin:0;font-size:14px;font-weight:600;color:var(--acu-title-color,#d35400)}.acu-attachment-picker .picker-header .btn-close{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub,#999);cursor:pointer;border-radius:4px;transition:all .2s}.acu-attachment-picker .picker-header .btn-close:hover{background:var(--acu-btn-hover,#cbbba8);color:var(--acu-text-main,#5e4b35)}.acu-attachment-picker .picker-content{padding:16px}.acu-attachment-picker .picker-hint{margin:0 0 12px;font-size:12px;color:var(--acu-text-sub,#999)}.acu-attachment-picker .picker-options{display:grid;grid-template-columns:repeat(auto-fill,minmax(48px,1fr));gap:8px;max-height:200px;overflow-y:auto}.acu-attachment-picker .picker-option{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:10px 6px;border:1px solid var(--acu-border,#dcd0c0);border-radius:8px;background:var(--acu-card-bg,#fffef9);color:var(--acu-text-main,#5e4b35);cursor:pointer;transition:all .2s;font-size:10px;text-align:center}.acu-attachment-picker .picker-option:hover{background:var(--acu-title-color-bg,rgba(211,84,0,0.08));border-color:var(--acu-title-color,#d35400);color:var(--acu-title-color,#d35400)}.acu-attachment-picker .picker-option i{font-size:18px;color:var(--acu-text-sub,#999)}.acu-attachment-picker .picker-option:hover i{color:var(--acu-title-color,#d35400)}.acu-attachment-picker .picker-option span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%}.acu-update-layout{display:flex;gap:0}@media (max-width:600px){.acu-update-layout{flex-direction:column}}.acu-update-left{flex:1;min-width:0;max-height:calc(80vh - 120px);overflow-y:auto;padding-right:16px;scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-update-left::-webkit-scrollbar{width:4px !important;height:4px !important}.acu-update-left::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-update-left::-webkit-scrollbar-thumb{background:var(--acu-border) !important;border-radius:2px !important}.acu-update-left::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important}.acu-update-left::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}@media (max-width:600px){.acu-update-left{max-height:none;padding-right:0}}.acu-update-right{width:260px;flex-shrink:0;border-left:1px solid var(--acu-border);padding-left:20px;display:flex;flex-direction:column}@media (max-width:600px){.acu-update-right{display:none}}.acu-table-selector{background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:12px;overflow:hidden}.acu-table-selector-header{display:flex;flex-wrap:wrap;gap:6px;padding:10px 12px;border-bottom:1px solid var(--acu-border);background:var(--acu-table-head)}.acu-table-selector-list{max-height:280px;overflow-y:auto;padding:8px;scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-table-selector-list::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-table-selector-list::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-table-selector-list::-webkit-scrollbar-thumb{background:var(--acu-border) !important;border-radius:3px !important}.acu-table-selector-list::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important}.acu-table-selector-list::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-table-selector-item{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:8px;cursor:pointer;transition:background .15s;-webkit-user-select:none;user-select:none}.acu-table-selector-item:hover{background:var(--acu-table-hover)}.acu-table-selector-item input[type=checkbox]{appearance:checkbox !important;-webkit-appearance:checkbox !important;-moz-appearance:checkbox !important;width:16px !important;height:16px !important;min-width:16px !important;min-height:16px !important;margin:0 !important;padding:0 !important;cursor:pointer !important;accent-color:var(--acu-title-color) !important;background:none !important;background-color:rgba(0,0,0,0) !important;background-image:none !important;border:revert !important;outline:none !important;box-shadow:none !important;vertical-align:middle !important;flex-shrink:0 !important;position:relative !important}.acu-table-selector-item input[type=checkbox]::before,.acu-table-selector-item input[type=checkbox]::after{content:none !important;display:none !important}.acu-table-selector-item .table-name{flex:1;font-size:13px;color:var(--acu-text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-table-selector-item.is-summary-outline .table-name::after{content:"★";color:var(--acu-title-color);margin-left:4px;font-size:10px}.acu-table-selector-item.is-selected{background:var(--acu-title-color-bg)}.acu-table-selector-footer{padding:8px 12px;border-top:1px solid var(--acu-border);font-size:12px;color:var(--acu-text-sub);text-align:center}.acu-table-selector-empty{padding:20px;text-align:center;color:var(--acu-text-sub);font-size:13px}.acu-table-selector-empty i{display:block;font-size:24px;margin-bottom:8px;opacity:.5}.acu-quick-select-btn{padding:4px 10px;font-size:11px;border-radius:6px;border:1px solid var(--acu-border);background:var(--acu-btn-bg);color:var(--acu-text-main);cursor:pointer;transition:all .15s;white-space:nowrap}.acu-quick-select-btn:hover{background:var(--acu-btn-hover)}.acu-quick-select-btn.active{background:var(--acu-title-color-bg);border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-quick-select-btn i{margin-right:4px;font-size:10px}.acu-table-selector-mobile{margin-top:12px}.acu-table-selector-mobile .acu-table-selector{margin-top:8px}.acu-table-selector-mobile .acu-table-selector-list{max-height:180px}.acu-collapsible{cursor:pointer;display:flex;align-items:center;justify-content:space-between}.acu-collapsible .acu-collapse-indicator{font-size:12px;color:var(--acu-text-sub);transition:transform .2s}.acu-collapsible.is-expanded .acu-collapse-indicator{transform:rotate(180deg)}@media (max-width:600px){.acu-hide-mobile{display:none !important}}.acu-show-mobile-only{display:none}@media (max-width:600px){.acu-show-mobile-only{display:block}}@media (min-width:601px){.acu-manual-update-modal{max-width:800px}.acu-manual-update-modal .acu-modal-body{overflow:visible;max-height:none;padding:20px}}.acu-relationship-graph{position:relative;width:100%;height:100%;min-height:400px;background:var(--acu-bg-panel);border-radius:12px;overflow:hidden}.acu-panel-content:has(.acu-relationship-graph){flex:1;min-height:450px}.acu-data-table:has(.acu-relationship-graph){min-height:450px;height:auto !important;max-height:none !important}.acu-graph-container{width:100%;height:100%}.acu-graph-toolbar{position:absolute;top:12px;right:12px;z-index:10;display:flex;align-items:center;gap:4px;background:var(--acu-card-bg);padding:6px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1)}.acu-toolbar-divider{width:1px;height:20px;background:var(--acu-border);margin:0 4px}.acu-graph-btn{display:flex;align-items:center;justify-content:center;width:32px;height:32px;border:none;border-radius:6px;background:rgba(0,0,0,0);color:var(--acu-text-main);cursor:pointer;transition:all .15s ease;font-size:14px}.acu-graph-btn:hover{background:var(--acu-table-hover)}.acu-graph-btn:active{transform:scale(0.95)}.acu-graph-btn.active{background:var(--acu-title-color-bg);color:var(--acu-title-color)}.acu-graph-btn.saved{background:var(--acu-success,#27ae60);color:#fff;animation:pulse-success .3s ease}@keyframes pulse-success{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}.acu-graph-legend{position:absolute;bottom:12px;left:12px;z-index:10;display:flex;flex-wrap:wrap;gap:8px;background:var(--acu-card-bg);padding:8px 12px;border-radius:8px;font-size:11px;box-shadow:0 2px 8px rgba(0,0,0,.1);max-width:calc(100% - 24px)}.acu-legend-item{display:flex;align-items:center;gap:4px;white-space:nowrap}.acu-legend-item .dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}.acu-legend-item .label{color:var(--acu-text-sub)}.acu-graph-empty{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center;gap:12px;color:var(--acu-text-sub);text-align:center}.acu-graph-empty i{font-size:48px;opacity:.3}.acu-graph-empty p{margin:0;font-size:14px}.acu-graph-empty .hint{font-size:12px;opacity:.7}.acu-node-config-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:10001;display:flex;align-items:center;justify-content:center}.acu-node-config-panel{background:var(--acu-card-bg);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.2);min-width:280px;max-width:90vw;overflow:hidden}.acu-node-config-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border)}.acu-node-config-header span{font-weight:600;font-size:14px;color:var(--acu-text-main)}.acu-node-config-header .acu-close-btn{width:28px;height:28px;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);cursor:pointer;border-radius:6px;display:flex;align-items:center;justify-content:center}.acu-node-config-header .acu-close-btn:hover{background:var(--acu-table-hover);color:var(--acu-text-main)}.acu-node-config-body{padding:16px}.acu-node-fullname{margin:0 0 6px 0;font-size:13px;color:var(--acu-text-main)}.acu-node-hint{margin:0 0 12px 0;font-size:11px;color:var(--acu-text-sub)}.acu-node-preview{margin:0 0 12px 0;padding:8px 12px;font-size:14px;font-weight:600;color:var(--acu-text-main);background:var(--acu-table-head);border-radius:6px;text-align:center}.acu-char-selector{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}.acu-char-btn{width:40px;height:40px;border:2px solid var(--acu-border);border-radius:8px;background:var(--acu-card-bg);color:var(--acu-text-main);font-size:18px;cursor:pointer;transition:all .15s ease}.acu-char-btn:hover{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-char-btn.active{border-color:var(--acu-title-color);background:var(--acu-title-color);color:#fff}.acu-node-config-actions{display:flex;gap:8px;justify-content:flex-end}.acu-action-btn{padding:8px 16px;border:none;border-radius:6px;font-size:13px;cursor:pointer;transition:all .15s ease}.acu-action-btn.primary{background:var(--acu-title-color);color:#fff}.acu-action-btn.primary:hover{filter:brightness(1.1)}.acu-action-btn.secondary{background:var(--acu-table-head);color:var(--acu-text-main)}.acu-action-btn.secondary:hover{background:var(--acu-table-hover)}@media (max-width:768px){.acu-graph-toolbar{top:8px;right:8px;padding:4px;gap:2px}.acu-graph-btn{width:28px;height:28px;font-size:12px}.acu-graph-legend{bottom:8px;left:8px;padding:6px 10px;font-size:10px;gap:6px}.acu-legend-item .dot{width:8px;height:8px}}.acu-modal-container{position:fixed;top:0;left:0;right:0;bottom:0;width:100vw !important;height:100vh !important;z-index:2147483647;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);animation:acu-fadeIn .2s ease;pointer-events:auto !important}.acu-modal{position:relative;width:90%;max-width:500px;max-height:80vh;background:var(--acu-bg-panel);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.3);display:flex;flex-direction:column;overflow:hidden;animation:acu-slideUp .3s ease}.acu-modal-header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--acu-border);background:var(--acu-table-head)}.acu-modal-header h3{margin:0;font-size:16px;font-weight:600;color:var(--acu-text-main);display:flex;align-items:center;gap:8px}.acu-modal-header h3 i{color:var(--acu-title-color)}.acu-modal-close{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);font-size:18px;cursor:pointer;border-radius:8px;transition:all .2s ease}.acu-modal-close:hover{background:rgba(231,76,60,.15);color:#e74c3c}.acu-modal-body{flex:1;padding:20px;overflow-y:auto;overflow-x:hidden;scrollbar-width:thin !important;scrollbar-color:var(--acu-border) rgba(0,0,0,0) !important}.acu-modal-body::-webkit-scrollbar{width:6px !important;height:6px !important}.acu-modal-body::-webkit-scrollbar-track{background:rgba(0,0,0,0) !important}.acu-modal-body::-webkit-scrollbar-thumb{background:var(--acu-border) !important;border-radius:3px !important}.acu-modal-body::-webkit-scrollbar-thumb:hover{background:var(--acu-text-sub) !important}.acu-modal-body::-webkit-scrollbar-corner{background:rgba(0,0,0,0) !important}.acu-modal-footer{display:flex;align-items:center;justify-content:flex-end;gap:12px;padding:16px 20px;border-top:1px solid var(--acu-border);background:var(--acu-bg-panel)}.acu-modal-btn{padding:10px 24px;border:none;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease}.acu-modal-btn.primary{background:var(--acu-title-color);color:#fff}.acu-modal-btn.primary:hover{filter:brightness(1.1);transform:translateY(-1px)}.acu-modal-btn.secondary{background:var(--acu-btn-bg);color:var(--acu-text-main);border:1px solid var(--acu-border)}.acu-modal-btn.secondary:hover{background:var(--acu-btn-hover)}.acu-modal-btn.danger{background:#e74c3c;color:#fff}.acu-modal-btn.danger:hover{background:#c0392b}.acu-modal-btn:disabled{opacity:.5;cursor:not-allowed;transform:none !important}.acu-close-pill{background-color:var(--acu-text-main,#333) !important;color:var(--acu-bg-panel,#fff) !important;border:none !important;padding:6px 20px;border-radius:20px;font-weight:bold;font-size:13px;cursor:pointer;box-shadow:0 4px 10px var(--acu-title-color-bg,rgba(74,158,255,0.2));transition:transform .2s,filter .2s;display:inline-flex;align-items:center;justify-content:center;margin-left:auto}.acu-close-pill:hover{filter:brightness(0.85);transform:scale(1.05)}.acu-settings-modal{max-width:720px}.acu-settings-modal .acu-modal-body{padding:0}.acu-settings-section{padding:12px 16px}.acu-settings-section:first-child{padding-top:16px}.acu-settings-title{font-size:13px;font-weight:600;color:var(--acu-text-main);margin-bottom:8px;padding:0 4px;display:flex;align-items:center;gap:8px}.acu-settings-title i{color:var(--acu-text-main);font-size:14px}.acu-settings-group{padding:12px 16px;background:var(--acu-table-head);border-radius:12px;border:none}.acu-settings-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0}.acu-settings-row:not(:last-child){border-bottom:1px solid var(--acu-border)}.acu-settings-label{font-size:13px;font-weight:600;color:var(--acu-text-main);display:flex;flex-direction:column;gap:2px}.acu-settings-label .hint{font-size:11px;font-weight:400;color:var(--acu-text-sub)}.acu-settings-control{display:flex;align-items:center;gap:8px}.acu-settings-control select{appearance:auto !important;-webkit-appearance:menulist !important;-moz-appearance:menulist !important;padding:8px 12px !important;background:var(--acu-btn-bg) !important;border:1px solid var(--acu-border) !important;border-radius:6px !important;color:var(--acu-text-main) !important;font-size:13px !important;font-family:inherit !important;cursor:pointer !important;outline:none !important;box-shadow:none !important;min-height:auto !important;height:auto !important;line-height:normal !important;margin:0 !important}.acu-settings-control select:focus{border-color:var(--acu-title-color) !important}.acu-settings-control select option{background:var(--acu-bg-panel) !important;color:var(--acu-text-main) !important}.acu-settings-control input[type=number],.acu-settings-control input[type=text]{padding:8px 12px !important;background:var(--acu-btn-bg) !important;border:1px solid var(--acu-border) !important;border-radius:6px !important;color:var(--acu-text-main) !important;font-size:13px !important;font-family:inherit !important;appearance:none !important;-webkit-appearance:none !important;outline:none !important;box-shadow:none !important;min-height:auto !important;height:auto !important;line-height:normal !important;margin:0 !important}.acu-settings-control input[type=number]:focus,.acu-settings-control input[type=text]:focus{border-color:var(--acu-title-color) !important;box-shadow:0 0 0 2px var(--acu-title-color-bg) !important}.acu-settings-control input[type=number]::placeholder,.acu-settings-control input[type=text]::placeholder{color:var(--acu-text-sub) !important;opacity:.7 !important}.acu-settings-control input[type=range]{-webkit-appearance:none !important;appearance:none !important;width:120px !important;height:16px !important;background:rgba(0,0,0,0) !important;background-color:rgba(0,0,0,0) !important;background-image:none !important;border:none !important;outline:none !important;box-shadow:none !important;margin:0 !important;padding:0 !important;cursor:pointer !important;touch-action:none !important}.acu-settings-control input[type=range]::before,.acu-settings-control input[type=range]::after{content:none !important;display:none !important;background:none !important}.acu-settings-control input[type=range]::-webkit-slider-runnable-track{-webkit-appearance:none !important;width:100% !important;height:6px !important;background:var(--acu-border) !important;background-color:var(--acu-border) !important;background-image:none !important;border-radius:3px !important;border:none !important;cursor:pointer !important;box-shadow:none !important}.acu-settings-control input[type=range]::-webkit-slider-thumb{-webkit-appearance:none !important;appearance:none !important;width:16px !important;height:16px !important;background:var(--acu-title-color) !important;background-color:var(--acu-title-color) !important;background-image:none !important;border-radius:50% !important;border:none !important;margin-top:-5px !important;cursor:pointer !important;box-shadow:0 1px 3px rgba(0,0,0,.2) !important;-webkit-transition:transform .1s ease,box-shadow .1s ease !important;transition:transform .1s ease,box-shadow .1s ease !important}.acu-settings-control input[type=range]::-moz-range-track{-moz-appearance:none !important;width:100% !important;height:6px !important;background:var(--acu-border) !important;background-color:var(--acu-border) !important;background-image:none !important;border-radius:3px !important;border:none !important;cursor:pointer !important;box-shadow:none !important}.acu-settings-control input[type=range]::-moz-range-thumb{-moz-appearance:none !important;width:16px !important;height:16px !important;background:var(--acu-title-color) !important;background-color:var(--acu-title-color) !important;background-image:none !important;border-radius:50% !important;border:none !important;cursor:pointer !important;box-shadow:0 1px 3px rgba(0,0,0,.2) !important;-moz-transition:transform .1s ease,box-shadow .1s ease !important;transition:transform .1s ease,box-shadow .1s ease !important}.acu-settings-control input[type=range]::-moz-range-progress{background:var(--acu-title-color) !important;background-color:var(--acu-title-color) !important;height:6px !important;border-radius:3px !important}.acu-settings-control input[type=range]:active::-webkit-slider-thumb{transform:scale(1.1) !important;box-shadow:0 2px 6px rgba(0,0,0,.3) !important}.acu-settings-control input[type=range]:active::-moz-range-thumb{transform:scale(1.1) !important;box-shadow:0 2px 6px rgba(0,0,0,.3) !important}.acu-settings-control input[type=color]{appearance:auto !important;-webkit-appearance:auto !important;width:36px !important;height:36px !important;padding:2px !important;border:2px solid var(--acu-border) !important;border-radius:8px !important;cursor:pointer !important;background:rgba(0,0,0,0) !important;outline:none !important;box-shadow:none !important}.acu-settings-control input[type=color]::-webkit-color-swatch-wrapper{padding:0 !important}.acu-settings-control input[type=color]::-webkit-color-swatch{border:none !important;border-radius:4px !important}.acu-switch{position:relative;display:inline-flex;align-items:center;width:44px;height:24px;cursor:pointer;flex-shrink:0}.acu-switch input[type=checkbox]{opacity:0;width:0;height:0;position:absolute;pointer-events:none}.acu-switch .slider{position:absolute;inset:0;background:var(--acu-btn-bg);border:none;border-radius:12px;transition:background .2s ease}.acu-switch .slider::after{content:"";position:absolute;top:50%;left:2px;transform:translateY(-50%);width:20px;height:20px;background:var(--acu-text-sub);border:none;border-radius:50%;transition:all .2s ease;box-shadow:0 1px 3px rgba(0,0,0,.15)}.acu-switch input[type=checkbox]:checked+.slider{background:var(--acu-title-color)}.acu-switch input[type=checkbox]:checked+.slider::after{left:calc(100% - 22px);background:#fff}.acu-switch:hover .slider{opacity:.85}.acu-switch:not(:has(input)){background:var(--acu-btn-bg);border:none;border-radius:12px;transition:background .2s ease}.acu-switch:not(:has(input))::after{content:"";position:absolute;top:50%;left:2px;transform:translateY(-50%);width:20px;height:20px;background:var(--acu-text-sub);border:none;border-radius:50%;transition:all .2s ease;box-shadow:0 1px 3px rgba(0,0,0,.15)}.acu-switch:not(:has(input)).active{background:var(--acu-title-color)}.acu-switch:not(:has(input)).active::after{left:calc(100% - 22px);background:#fff}.acu-switch:not(:has(input)):hover{opacity:.9}.acu-color-picker-row .acu-settings-control{flex-shrink:0;width:50%;justify-content:flex-end}.acu-color-row{display:flex;align-items:center;gap:6px;flex-wrap:wrap;justify-content:flex-end}.acu-color-circle{width:22px;height:22px;border-radius:50%;cursor:pointer;transition:all .2s ease;border:2px solid rgba(0,0,0,0);box-shadow:0 1px 3px rgba(0,0,0,.15);flex-shrink:0}.acu-color-circle:hover{transform:scale(1.1)}.acu-color-circle.selected{border-color:rgba(0,0,0,0);box-shadow:inset 0 0 0 3px #fff,0 2px 4px rgba(0,0,0,.2);transform:scale(1.05)}.acu-nav-row{cursor:pointer;transition:background .2s ease}.acu-nav-row:hover{background:var(--acu-table-hover)}.acu-nav-row:active{opacity:.8}.acu-nav-row .acu-settings-control i.fa-chevron-right{font-size:12px;color:var(--acu-text-sub)}.acu-input-floor-modal{max-width:400px}.acu-input-floor-modal .floor-input-group{display:flex;flex-direction:column;gap:12px}.acu-input-floor-modal .floor-input{width:100%;padding:12px 16px;font-size:16px;text-align:center;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main)}.acu-input-floor-modal .floor-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-input-floor-modal .floor-hint{font-size:12px;color:var(--acu-text-sub);text-align:center}.acu-purge-range-modal{max-width:450px}.acu-purge-range-modal .range-inputs{display:flex;align-items:center;gap:12px;margin-bottom:16px}.acu-purge-range-modal .range-inputs input{flex:1;padding:12px 16px;font-size:14px;text-align:center;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main)}.acu-purge-range-modal .range-inputs input:focus{outline:none;border-color:var(--acu-title-color)}.acu-purge-range-modal .range-inputs span{color:var(--acu-text-sub);font-size:16px}.acu-purge-range-modal .warning-box{display:flex;align-items:flex-start;gap:12px;padding:12px 16px;background:rgba(231,76,60,.1);border:1px solid rgba(231,76,60,.3);border-radius:8px;color:#e74c3c}.acu-purge-range-modal .warning-box i{font-size:18px;flex-shrink:0;margin-top:2px}.acu-purge-range-modal .warning-box p{margin:0;font-size:13px;line-height:1.5}.modal-enter-active,.modal-leave-active{transition:opacity .2s ease}.modal-enter-active .acu-modal,.modal-leave-active .acu-modal{transition:transform .3s cubic-bezier(0.4,0,0.2,1)}.modal-enter-from,.modal-leave-to{opacity:0}.modal-enter-from .acu-modal,.modal-leave-to .acu-modal{transform:scale(0.95) translateY(-20px)}@media (max-width:768px){.acu-modal-container{align-items:flex-end;justify-content:stretch}.acu-modal{width:100%;max-width:none;max-height:85vh;border-radius:20px 20px 0 0;margin:0}.acu-settings-modal{max-width:none;max-height:60vh;transition:max-height .3s ease}.acu-settings-modal.expanded{max-height:85vh}.modal-enter-from .acu-modal,.modal-leave-to .acu-modal{transform:translateY(100%)}.acu-modal-header{position:relative;padding-top:24px}.acu-drag-handle{position:absolute;top:0;left:50%;transform:translateX(-50%);width:80px;height:20px;cursor:grab;touch-action:none;z-index:10}.acu-drag-handle::after{content:"";position:absolute;top:8px;left:50%;transform:translateX(-50%);width:36px;height:4px;background:var(--acu-border);border-radius:2px;transition:background .2s}.acu-drag-handle:active::after{background:var(--acu-title-color)}.acu-modal-header.dragging .acu-drag-handle::after{background:var(--acu-title-color)}.acu-modal-body{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch}.acu-modal-container.acu-center-modal{align-items:center !important;justify-content:center !important;padding:20px}.acu-modal-container.acu-center-modal .acu-modal{width:90%;max-width:400px;max-height:80vh;border-radius:16px;margin:0}.acu-modal-container.acu-center-modal .acu-modal-header{padding-top:16px}.acu-modal-container.acu-center-modal .acu-modal-header::before{display:none}}.floor-info{display:flex;align-items:center;gap:8px;padding:12px;background:var(--acu-table-head);border-radius:8px;font-size:13px;color:var(--acu-text-sub)}.floor-info i{color:var(--acu-title-color)}.floor-error{display:flex;align-items:center;gap:8px;padding:10px 12px;background:rgba(231,76,60,.1);border:1px solid rgba(231,76,60,.3);border-radius:8px;font-size:13px;color:#e74c3c}.acu-purge-overlay{display:flex !important;align-items:center !important;justify-content:center !important;padding-top:0 !important}.acu-purge-range-modal{width:85%;max-width:360px;height:auto;margin:0;box-shadow:0 25px 50px rgba(0,0,0,.5);overflow:visible;border-radius:16px;background:var(--acu-bg-panel)}.acu-purge-title{text-align:center;border-bottom:none;padding:25px 20px 0 20px;font-size:18px;font-weight:600;color:var(--acu-text-main)}.acu-purge-content{padding:20px 30px;display:flex;flex-direction:column;align-items:center;gap:15px}.acu-purge-icon{width:50px;height:50px;background:rgba(231,76,60,.15);color:#e74c3c;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;margin-bottom:5px}.acu-purge-hint{font-size:13px;color:var(--acu-text-sub);margin:0;text-align:center;line-height:1.4}.acu-purge-hint-sub{opacity:.7;font-size:12px}.acu-purge-inputs{display:flex;gap:10px;align-items:center;justify-content:center;width:100%}.acu-purge-input{text-align:center;font-size:20px;font-weight:bold;height:50px;width:100px;border-radius:12px;background:var(--acu-input-bg,var(--acu-btn-bg));border:2px solid var(--acu-border);color:var(--acu-text-main);transition:border-color .2s ease}.acu-purge-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-purge-input::placeholder{color:var(--acu-text-sub);opacity:.5;font-weight:normal;font-size:14px}.acu-purge-input::-webkit-outer-spin-button,.acu-purge-input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.acu-purge-input[type=number]{-moz-appearance:textfield}.acu-purge-separator{font-weight:bold;color:var(--acu-text-main);font-size:18px}.acu-purge-btns{padding:0 20px 25px 20px;border-top:none;display:flex;justify-content:space-between;gap:10px}.acu-purge-btn{flex:1;display:flex;justify-content:center;align-items:center;padding:10px;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;border:none;transition:all .2s ease}.acu-purge-btn-cancel{background:var(--acu-btn-bg);color:var(--acu-text-main)}.acu-purge-btn-cancel:hover{background:var(--acu-btn-hover)}.acu-purge-btn-confirm{background:#e74c3c;color:#fff}.acu-purge-btn-confirm:hover:not(:disabled){background:#c0392b}.acu-purge-btn-confirm:disabled{opacity:.5;cursor:not-allowed}.acu-purge-btn-advanced{flex:0 0 auto;background:rgba(0,0,0,0);color:var(--acu-text-sub);border:1px solid var(--acu-border);gap:6px}.acu-purge-btn-advanced:hover{background:var(--acu-btn-bg);color:var(--acu-title-color);border-color:var(--acu-title-color)}.acu-purge-btn-advanced i{font-size:12px}.acu-purge-btns-right{display:flex;gap:10px;flex:1}.acu-advanced-purge-modal{max-width:520px;max-height:85vh}.acu-advanced-purge-modal .acu-modal-body{padding:16px;overflow-y:auto;max-height:calc(85vh - 120px)}.acu-purge-range-row{display:flex;align-items:center;justify-content:center;gap:12px;padding:8px 0}.acu-purge-range-row .acu-purge-input{width:100px;height:44px;font-size:18px}.acu-purge-range-row .acu-purge-separator{font-size:20px;color:var(--acu-text-sub)}.acu-purge-range-hint{display:flex;align-items:center;justify-content:center;gap:6px;margin-top:8px;font-size:12px;color:var(--acu-text-sub)}.acu-purge-range-hint i{font-size:11px}.acu-table-selector-compact{border:1px solid var(--acu-border);border-radius:10px;overflow:hidden;background:var(--acu-card-bg)}.acu-table-selector-compact .acu-table-selector-header{padding:8px 12px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border)}.acu-table-selector-compact .acu-table-selector-list{max-height:200px;overflow-y:auto;padding:8px}.acu-table-selector-compact .acu-table-selector-item{padding:8px 12px;margin-bottom:4px;border-radius:6px;font-size:13px}.acu-table-selector-compact .acu-table-selector-item:last-child{margin-bottom:0}.acu-table-selector-compact .acu-table-selector-footer{padding:8px 12px;border-top:1px solid var(--acu-border);font-size:12px}.acu-purge-warning{display:flex;align-items:center;gap:10px;margin-top:12px;padding:12px 16px;background:rgba(231,76,60,.1);border:1px solid rgba(231,76,60,.3);border-radius:10px;color:#e74c3c;font-size:13px}.acu-purge-warning i{font-size:16px;flex-shrink:0}.acu-purge-warning span{line-height:1.4}@media (max-width:768px){.acu-advanced-purge-modal{max-width:none;max-height:70vh}.acu-advanced-purge-modal .acu-modal-body{max-height:calc(70vh - 120px)}.acu-purge-range-row .acu-purge-input{width:80px;height:40px;font-size:16px}.acu-table-selector-compact .acu-table-selector-list{max-height:150px}}.acu-settings-nav-group{margin-bottom:16px}.acu-settings-nav-item{display:flex;align-items:center;justify-content:space-between;width:100%;padding:12px 16px;margin-bottom:8px;background:var(--acu-card-bg,rgba(255,255,255,0.05));border:1px solid var(--acu-border-color,rgba(255,255,255,0.1));border-radius:8px;cursor:pointer;transition:all .2s ease;text-align:left;color:inherit}.acu-settings-nav-item:hover{background:var(--acu-hover-bg,rgba(255,255,255,0.1));border-color:var(--acu-primary-color,#4a9eff)}.acu-settings-nav-item:last-child{margin-bottom:0}.acu-settings-nav-item .nav-item-content{display:flex;align-items:center;gap:12px}.acu-settings-nav-item .nav-item-content>i{font-size:18px;color:var(--acu-primary-color,#4a9eff);width:24px;text-align:center}.acu-settings-nav-item .nav-item-text{display:flex;flex-direction:column;gap:2px}.acu-settings-nav-item .nav-item-label{font-size:14px;font-weight:500}.acu-settings-nav-item .nav-item-hint{font-size:12px;opacity:.6}.acu-settings-nav-item>i.fa-chevron-right{opacity:.4;font-size:12px}.acu-modal-back{display:flex;align-items:center;justify-content:center;width:32px;height:32px;margin-right:8px;background:rgba(0,0,0,0);border:none;border-radius:6px;cursor:pointer;color:inherit;opacity:.7;transition:all .2s ease}.acu-modal-back:hover{opacity:1;background:var(--acu-hover-bg,rgba(255,255,255,0.1))}.acu-modal-title{font-size:16px;font-weight:bold}.acu-bottom-spacer{height:80px;padding-bottom:30px;width:100%;text-align:center;color:var(--acu-text-sub,#999);font-size:10px;display:flex;align-items:center;justify-content:center;opacity:.5;flex-shrink:0}.acu-toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:2147483647;display:flex;align-items:center;gap:10px;padding:14px 24px;border-radius:12px;font-size:14px;font-weight:500;box-shadow:0 8px 32px rgba(0,0,0,.25);backdrop-filter:blur(10px);pointer-events:none}.acu-toast i{font-size:18px;flex-shrink:0}.acu-toast .acu-toast-message{max-width:300px;line-height:1.4}.acu-toast-success{background:linear-gradient(135deg,rgba(46,204,113,0.95),rgba(39,174,96,0.95));color:#fff}.acu-toast-error{background:linear-gradient(135deg,rgba(231,76,60,0.95),rgba(192,57,43,0.95));color:#fff}.acu-toast-warning{background:linear-gradient(135deg,rgba(241,196,15,0.95),rgba(243,156,18,0.95));color:#2c3e50}.acu-toast-info{background:linear-gradient(135deg,rgba(52,152,219,0.95),rgba(41,128,185,0.95));color:#fff}.toast-enter-active,.toast-leave-active{transition:all .35s cubic-bezier(0.4,0,0.2,1)}.toast-enter-from{opacity:0;transform:translateX(-50%) translateY(-20px) scale(0.9)}.toast-leave-to{opacity:0;transform:translateX(-50%) translateY(-10px) scale(0.95)}.acu-manual-update-modal{max-width:95%;max-height:80vh}@media (min-width:601px){.acu-manual-update-modal{max-width:800px;max-height:85vh}}.acu-manual-update-modal .acu-modal-body{padding:0;overflow-y:auto;max-height:calc(80vh - 60px)}@media (min-width:601px){.acu-manual-update-modal .acu-modal-body{max-height:calc(85vh - 60px);padding:20px}}.acu-manual-update-modal .acu-settings-group{padding:12px 16px}.acu-manual-update-modal .acu-settings-row{padding:8px 0}.acu-loading-state{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:48px 20px;color:var(--acu-text-sub)}.acu-loading-state i{font-size:24px;color:var(--acu-title-color)}.acu-loading-state span{font-size:14px}.acu-config-input{width:80px;padding:8px 12px;font-size:14px;text-align:center;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);transition:all .2s ease}.acu-config-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-config-input:hover:not(:focus){border-color:var(--acu-text-sub)}.acu-config-input::-webkit-inner-spin-button,.acu-config-input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.acu-config-input{-moz-appearance:textfield}.acu-update-action-group{padding:12px 16px 16px;display:flex;flex-direction:column;align-items:center}.acu-update-btn{display:flex;align-items:center;justify-content:center;gap:10px;width:100%;padding:14px 24px;font-size:15px;font-weight:600;color:var(--acu-text-main);background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:12px;cursor:pointer;transition:all .2s ease}.acu-update-btn i{font-size:18px;color:var(--acu-title-color)}.acu-update-btn:hover:not(:disabled){background:var(--acu-btn-hover);transform:translateY(-1px)}.acu-update-btn:active:not(:disabled){transform:translateY(0)}.acu-update-btn:disabled{opacity:.7;cursor:not-allowed}.acu-update-btn.is-updating{opacity:.7}.acu-update-hint{display:none;margin:0;font-size:12px;color:var(--acu-text-sub);text-align:center}@media (max-width:768px){.acu-manual-update-modal{max-width:none;max-height:70vh}.acu-manual-update-modal .acu-modal-body{max-height:calc(70vh - 60px)}.acu-manual-update-modal .acu-config-input{width:100px}.acu-update-btn{padding:16px 24px;font-size:16px}}.acu-preset-control{display:flex;align-items:center;gap:6px}.acu-config-select{min-width:120px;padding:8px 12px;font-size:13px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);cursor:pointer;transition:all .2s ease}.acu-config-select:focus{outline:none;border-color:var(--acu-title-color)}.acu-config-select:hover:not(:focus){border-color:var(--acu-text-sub)}.acu-icon-btn{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);cursor:pointer;transition:all .2s ease}.acu-icon-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-icon-btn.acu-btn-danger:hover{background:rgba(231,76,60,.1);border-color:#e74c3c;color:#e74c3c}.acu-sub-row{padding-left:16px;opacity:.9}.acu-sub-row .acu-settings-label{font-size:12px;font-weight:500}.acu-issue-alert{display:flex;align-items:center;gap:10px;margin:0 16px 12px;padding:12px 16px;background:rgba(245,108,108,.1);border:1px solid rgba(245,108,108,.3);border-radius:10px;color:#f56c6c;font-size:13px}.acu-issue-alert i{font-size:16px;flex-shrink:0}.acu-issue-alert span{line-height:1.4}.acu-modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;z-index:2147483647;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5);backdrop-filter:blur(2px)}.acu-mini-dialog{width:90%;max-width:320px;background:var(--acu-bg-panel);border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,.3);overflow:hidden;animation:acu-slideUp .2s ease}.acu-mini-dialog-header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--acu-border);background:var(--acu-table-head)}.acu-mini-dialog-header span{font-size:14px;font-weight:600;color:var(--acu-text-main)}.acu-mini-close{display:flex;align-items:center;justify-content:center;width:28px;height:28px;background:rgba(0,0,0,0);border:none;border-radius:6px;color:var(--acu-text-sub);cursor:pointer;transition:all .2s ease}.acu-mini-close:hover{background:rgba(231,76,60,.1);color:#e74c3c}.acu-mini-dialog-body{padding:16px}.acu-mini-dialog-footer{display:flex;gap:10px;padding:12px 16px;border-top:1px solid var(--acu-border);justify-content:flex-end}.acu-full-width{width:100% !important;text-align:left !important}.acu-preset-save-dialog{max-width:360px}.acu-duplicate-warning{display:flex;align-items:center;gap:8px;margin-top:10px;padding:8px 12px;background:rgba(243,156,18,.1);border:1px solid rgba(243,156,18,.3);border-radius:6px;color:#f39c12;font-size:12px}.acu-duplicate-warning i{font-size:14px;flex-shrink:0}.acu-preset-summary{margin-top:12px;padding:10px 12px;background:var(--acu-table-head);border-radius:8px;font-size:12px}.acu-preset-summary .acu-preset-summary-title{font-weight:600;color:var(--acu-text-main);margin-bottom:8px}.acu-preset-summary .acu-preset-summary-list{margin:0;padding-left:16px;color:var(--acu-text-sub);line-height:1.6}.acu-preset-summary .acu-preset-summary-list li{margin:2px 0}.acu-btn-primary{padding:8px 20px;background:var(--acu-title-color);color:#fff;border:none;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s ease}.acu-btn-primary:hover:not(:disabled){filter:brightness(1.1)}.acu-btn-primary:disabled{opacity:.5;cursor:not-allowed}.acu-btn-secondary{padding:8px 20px;background:var(--acu-btn-bg);color:var(--acu-text-main);border:1px solid var(--acu-border);border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s ease}.acu-btn-secondary:hover{background:var(--acu-btn-hover)}.acu-history-modal{min-width:800px;max-width:1200px;max-height:90vh}.acu-history-modal .acu-pc-only{display:block}.acu-history-modal .acu-mobile-only{display:none}.acu-history-modal .acu-modal-body{padding:0;overflow:hidden}.acu-history-layout.acu-pc-layout{display:flex;height:calc(90vh - 60px);overflow:hidden}.acu-history-layout.acu-pc-layout .acu-history-sidebar{flex:1;min-width:320px;max-width:480px;overflow-y:auto;border-right:1px solid var(--acu-border);padding:20px 24px;background:var(--acu-table-head)}.acu-history-layout.acu-pc-layout .acu-history-main{flex:1;min-width:320px;display:flex;flex-direction:column;padding:20px 24px;overflow:hidden}.acu-history-list{display:flex;flex-direction:column;gap:8px}.acu-history-item{border:1px solid var(--acu-border);border-radius:8px;background:var(--acu-card-bg);overflow:hidden}.acu-history-item[open] .acu-history-summary{border-bottom:1px solid var(--acu-border)}.acu-history-summary{padding:10px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:13px;font-weight:600;transition:background .2s;list-style:none}.acu-history-summary::-webkit-details-marker{display:none}.acu-history-summary::before{content:"▶";font-size:10px;transition:transform .2s}.acu-history-summary:hover{background:var(--acu-table-hover)}details[open]>.acu-history-summary::before{transform:rotate(90deg)}.acu-history-badge{padding:2px 6px;border-radius:4px;font-size:10px;font-weight:bold}.acu-history-badge.manual{background:var(--acu-highlight-manual-bg,rgba(211,84,0,0.15));color:var(--acu-highlight-manual,#d35400)}.acu-history-badge.ai{background:var(--acu-highlight-ai-bg,rgba(52,152,219,0.15));color:var(--acu-highlight-ai,#3498db)}.acu-history-title{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-history-time{font-size:11px;color:var(--acu-text-sub);font-weight:normal;flex-shrink:0}.acu-history-card-wrapper{padding:8px}.acu-history-card-wrapper .acu-data-card{width:100% !important;flex:none !important}.acu-current-card .acu-data-card,.acu-current-scroll .acu-data-card{width:100% !important;flex:none !important}.acu-current-card-label{display:flex;align-items:center;gap:8px;padding:8px 12px;font-size:13px;font-weight:600;color:var(--acu-text-main);background:var(--acu-table-head);border-radius:8px 8px 0 0;border:1px solid var(--acu-border);border-bottom:none}.acu-current-card-label i{color:var(--acu-title-color)}.acu-current-card-label .acu-changes-count{font-weight:normal;color:var(--acu-title-color)}.acu-current-card{flex:1;overflow-y:auto;border:1px solid var(--acu-border);border-top:none;border-radius:0 0 8px 8px;padding:8px;margin-bottom:12px}.acu-history-actions{display:flex;gap:8px;padding-top:12px;border-top:1px solid var(--acu-border);flex-wrap:wrap}.acu-history-actions .acu-btn-start-edit{flex:1}.acu-history-trigger{position:absolute;top:8px;right:8px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-sub);cursor:pointer;transition:all .2s;z-index:5}.acu-history-trigger:hover{background:var(--acu-title-color-bg);border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-history-layout.acu-mobile-layout{display:none;flex-direction:column;height:calc(100vh - 60px);overflow:hidden;position:relative}.acu-history-layout.acu-mobile-layout .acu-history-mobile-list{flex:1;overflow-y:auto;padding:12px;padding-bottom:calc(120px + env(safe-area-inset-bottom,20px))}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-history-section{flex:1;display:flex;flex-direction:column;min-height:0;border-bottom:1px solid var(--acu-border)}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-history-section .acu-section-label{padding:8px 12px;font-size:12px;font-weight:600;color:var(--acu-text-sub);background:var(--acu-table-head);display:flex;align-items:center;gap:6px;flex-shrink:0}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-history-section .acu-section-label i{color:var(--acu-title-color)}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-history-section .acu-history-scroll{flex:1;overflow-y:auto;padding:8px}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section{flex:1.5;display:flex;flex-direction:column;min-height:0}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section .acu-section-label{padding:8px 12px;font-size:12px;font-weight:600;color:var(--acu-text-sub);background:var(--acu-table-head);display:flex;align-items:center;gap:6px;flex-shrink:0}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section .acu-section-label i{color:var(--acu-title-color)}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section .acu-section-label .acu-changes-count{color:var(--acu-title-color);font-weight:normal}.acu-history-layout.acu-mobile-layout.acu-mobile-edit-mode .acu-mobile-current-section .acu-current-scroll{flex:1;overflow-y:auto;padding:8px;padding-bottom:calc(120px + env(safe-area-inset-bottom,20px))}.acu-history-layout.acu-mobile-layout .acu-mobile-actions{position:fixed;bottom:0;left:0;right:0;padding:10px 12px;padding-bottom:36px;padding-bottom:calc(16px + env(safe-area-inset-bottom,20px));background:var(--acu-bg-panel);border-top:1px solid var(--acu-border);display:flex;flex-wrap:wrap;gap:8px;z-index:2147483640;box-shadow:0 -4px 12px rgba(0,0,0,.15)}.acu-history-layout.acu-mobile-layout .acu-mobile-actions button{flex:1;min-width:80px;min-height:42px;padding:8px 10px;border-radius:8px;border:1px solid var(--acu-border);background:var(--acu-btn-bg);color:var(--acu-text-main);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:4px;white-space:nowrap}.acu-history-layout.acu-mobile-layout .acu-mobile-actions button:disabled{opacity:.5;cursor:not-allowed}.acu-history-layout.acu-mobile-layout .acu-mobile-actions button.acu-btn-primary{background:var(--acu-title-color);color:#fff;border:none}.acu-history-layout.acu-mobile-layout .acu-mobile-actions button.acu-btn-preview{background:var(--acu-table-head)}.acu-history-layout.acu-mobile-layout .acu-mobile-actions button.acu-btn-done{flex-basis:100%;background:var(--acu-title-color);color:#fff;border:none}.acu-history-layout.acu-mobile-layout .acu-mobile-actions button i{font-size:12px}.acu-history-layout.acu-mobile-layout .acu-preview-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.85);z-index:2147483641;display:flex;align-items:center;justify-content:center;padding:20px;pointer-events:none}.acu-history-layout.acu-mobile-layout .acu-preview-overlay :deep(.acu-data-card){width:100%;max-height:80vh;overflow-y:auto;background:var(--acu-bg-panel);border-radius:12px;pointer-events:auto}.preview-fade-enter-active,.preview-fade-leave-active{transition:opacity .15s ease}.preview-fade-enter-from,.preview-fade-leave-to{opacity:0}@media (max-width:768px){.acu-history-modal{min-width:unset;max-width:none;width:100%;max-height:100vh;height:100vh;border-radius:0}.acu-history-modal .acu-pc-only{display:none !important}.acu-history-modal .acu-mobile-only{display:block !important}.acu-history-modal .acu-modal-header{border-radius:0}.acu-history-modal .acu-modal-body{flex:1;overflow:hidden}.acu-history-modal .acu-history-layout.acu-pc-layout{display:none !important}.acu-history-modal .acu-history-layout.acu-mobile-layout{display:flex !important}.acu-history-modal .acu-history-layout.acu-mobile-layout .acu-mobile-actions{padding-bottom:40px !important}@supports (padding-bottom:env(safe-area-inset-bottom)){.acu-history-modal .acu-history-layout.acu-mobile-layout .acu-mobile-actions{padding-bottom:calc(16px + env(safe-area-inset-bottom,24px)) !important}}}.acu-ball-preview-fixed{position:sticky;top:-20px;margin:-20px -20px 16px;padding:28px 36px 12px 36px;z-index:10;display:flex;justify-content:center;align-items:center;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border)}.acu-reset-mini-btn{position:absolute;top:24px;right:24px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-sub);cursor:pointer;transition:all .2s ease}.acu-reset-mini-btn:hover{background:var(--acu-btn-hover);color:var(--acu-title-color);border-color:var(--acu-title-color)}.acu-reset-mini-btn i{font-size:12px}.acu-settings-title-row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}.acu-settings-title-row .acu-settings-title{margin-bottom:0}.acu-preview-buttons{display:flex;gap:6px;flex-shrink:0}.acu-tool-btn{padding:4px 10px;font-size:11px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);cursor:pointer;transition:all .2s ease;white-space:nowrap}.acu-tool-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color)}.acu-ball-preview{position:relative;display:flex;justify-content:center;align-items:center;width:var(--ball-size,48px);height:var(--ball-size,48px);border-radius:50%;background:var(--ball-bg-color,rgba(0,0,0,0.5));border:2px solid var(--ball-border-color-rgba,rgba(255,255,255,0.3));box-shadow:0 4px 16px rgba(0,0,0,.3);transition:transform .2s ease}.acu-ball-preview i{font-size:calc(var(--ball-size,48px)*.4);color:#fff}.acu-ball-preview img{width:70%;height:70%;border-radius:50%;object-fit:cover}.acu-ball-preview .ball-ripple-1,.acu-ball-preview .ball-ripple-2{position:absolute;top:50%;left:50%;width:100%;height:100%;border-radius:50%;border:2px solid var(--ball-border-color-rgba,rgba(255,255,255,0.3));transform:translate(-50%,-50%);pointer-events:none}.acu-ball-preview .ball-arc{position:absolute;top:50%;left:50%;width:120%;height:120%;transform:translate(-50%,-50%);pointer-events:none}.acu-ball-preview .ball-arc::before,.acu-ball-preview .ball-arc::after{content:"";position:absolute;top:0;left:50%;width:4px;height:50%;background:linear-gradient(to bottom,var(--ball-border-color,#4a9eff),transparent);transform-origin:bottom center}.acu-ball-preview .ball-arc::before{transform:translateX(-50%) rotate(45deg)}.acu-ball-preview .ball-arc::after{transform:translateX(-50%) rotate(-45deg)}.acu-ball-preview.preview-ripple .ball-ripple-1{animation:acu-preview-ripple 1.5s ease-out infinite}.acu-ball-preview.preview-ripple .ball-ripple-2{animation:acu-preview-ripple 1.5s ease-out infinite .75s}.acu-ball-preview.preview-arc .ball-arc{animation:acu-preview-arc-rotate 2s linear infinite}@keyframes acu-preview-ripple{0%{transform:translate(-50%,-50%) scale(1);opacity:.8}100%{transform:translate(-50%,-50%) scale(2);opacity:0}}@keyframes acu-preview-arc-rotate{from{transform:translate(-50%,-50%) rotate(0deg)}to{transform:translate(-50%,-50%) rotate(360deg)}}.acu-anim-grid{display:flex;gap:8px;width:100%}.acu-anim-option{flex:1;display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 12px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:10px;cursor:pointer;transition:all .2s ease}.acu-anim-option:hover{background:var(--acu-btn-hover);border-color:var(--acu-text-sub)}.acu-anim-option.active{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-anim-option .acu-anim-icon{font-size:18px;line-height:1}.acu-anim-option .acu-anim-name{font-size:12px;color:var(--acu-text-main)}.acu-color-picker-inline{display:flex;align-items:center;gap:8px}.acu-color-input{width:auto;min-width:75px;max-width:90px;padding:6px 10px;font-size:12px;font-family:monospace;text-transform:uppercase;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main)}.acu-color-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-color-swatch{width:32px;height:32px;padding:0;border:2px solid var(--acu-border);border-radius:6px;cursor:pointer;background:rgba(0,0,0,0);flex-shrink:0}.acu-color-swatch::-webkit-color-swatch-wrapper{padding:2px}.acu-color-swatch::-webkit-color-swatch{border-radius:3px;border:none}.acu-rgb-picker{display:flex;align-items:center;gap:8px}.acu-rgb-picker input[type=color]{width:32px;height:32px;padding:0;border:2px solid var(--acu-border);border-radius:6px;cursor:pointer;background:rgba(0,0,0,0);flex-shrink:0}.acu-rgb-picker input[type=color]::-webkit-color-swatch-wrapper{padding:2px}.acu-rgb-picker input[type=color]::-webkit-color-swatch{border-radius:3px;border:none}.acu-rgb-row{display:flex;align-items:center;gap:10px}.acu-rgb-row .acu-rgb-label{width:20px;font-size:12px;font-weight:600;text-align:center}.acu-rgb-row .acu-rgb-label.label-r{color:#e74c3c}.acu-rgb-row .acu-rgb-label.label-g{color:#2ecc71}.acu-rgb-row .acu-rgb-label.label-b{color:#3498db}.acu-rgb-row .acu-rgb-label.label-a{color:var(--acu-text-sub)}.acu-rgb-row .acu-rgb-slider{flex:1;height:8px;-webkit-appearance:none;appearance:none;background:linear-gradient(to right,#000,#e74c3c);border-radius:4px;outline:none;cursor:pointer}.acu-rgb-row .acu-rgb-slider::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;background:#fff;border-radius:50%;box-shadow:0 2px 6px rgba(0,0,0,.3);cursor:pointer}.acu-rgb-row .acu-rgb-slider::-moz-range-thumb{width:16px;height:16px;background:#fff;border-radius:50%;box-shadow:0 2px 6px rgba(0,0,0,.3);cursor:pointer;border:none}.acu-rgb-row .acu-rgb-slider.slider-r{background:linear-gradient(to right,#000,#e74c3c)}.acu-rgb-row .acu-rgb-slider.slider-g{background:linear-gradient(to right,#000,#2ecc71)}.acu-rgb-row .acu-rgb-slider.slider-b{background:linear-gradient(to right,#000,#3498db)}.acu-rgb-row .acu-rgb-slider.slider-a{background:linear-gradient(to right,transparent,currentColor)}.acu-rgb-row .acu-rgb-value{width:40px;padding:4px 6px;font-size:11px;text-align:center;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:4px;color:var(--acu-text-main)}.acu-color-preview-row{display:flex;align-items:center;gap:10px;margin-top:4px}.acu-color-preview-row .acu-color-swatch{width:32px;height:32px;border-radius:8px;border:2px solid var(--acu-border);box-shadow:inset 0 0 0 1px hsla(0,0%,100%,.1)}.acu-color-preview-row .acu-color-hex{flex:1;padding:8px 12px;font-size:13px;font-family:monospace;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);text-transform:uppercase}.acu-icon-type-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;width:100%}.acu-icon-type-row{display:flex;gap:8px;width:100%}.acu-icon-btn{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;padding:10px 8px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:10px;cursor:pointer;transition:all .2s ease}.acu-icon-btn input[type=radio]{display:none}.acu-icon-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-text-sub)}.acu-icon-btn.active{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-icon-btn i{font-size:16px;color:var(--acu-text-main)}.acu-icon-btn .emoji-icon{font-size:16px;line-height:1}.acu-icon-btn>span:last-child{font-size:12px;color:var(--acu-text-main);white-space:nowrap}.acu-icon-type-option{display:flex;flex-direction:column;align-items:center;gap:6px;padding:14px 8px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:10px;cursor:pointer;transition:all .2s ease}.acu-icon-type-option:hover{background:var(--acu-btn-hover);border-color:var(--acu-text-sub)}.acu-icon-type-option.active{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-icon-type-option i,.acu-icon-type-option .type-emoji{font-size:22px;color:var(--acu-text-main)}.acu-icon-type-option .type-emoji{line-height:1}.acu-icon-type-option span{font-size:11px;color:var(--acu-text-sub)}.acu-icon-content-input{width:100%;margin-top:12px}.acu-emoji-input-row{display:flex;align-items:center;gap:8px}.acu-emoji-input-row input{flex:1;padding:10px 14px;font-size:18px;text-align:center;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);transition:border-color .2s ease}.acu-emoji-input-row input:focus{outline:none;border-color:var(--acu-title-color)}.acu-emoji-input-row input::placeholder{font-size:13px;color:var(--acu-text-sub);opacity:.6}.acu-image-preview-row{display:flex;align-items:center;gap:12px;margin-top:10px}.acu-preview-thumb{width:48px;height:48px;border-radius:50%;object-fit:cover;border:2px solid var(--acu-border)}.acu-clear-btn{display:flex;align-items:center;gap:4px;padding:6px 12px;background:rgba(231,76,60,.1);border:1px solid rgba(231,76,60,.3);border-radius:6px;color:#e74c3c;font-size:12px;cursor:pointer;transition:all .2s ease}.acu-clear-btn:hover{background:rgba(231,76,60,.2);border-color:#e74c3c}.acu-clear-btn i{font-size:10px}.acu-image-upload-area{display:flex;flex-direction:column;align-items:center;gap:12px;padding:20px;background:var(--acu-btn-bg);border:2px dashed var(--acu-border);border-radius:12px;cursor:pointer;transition:all .2s ease}.acu-image-upload-area:hover{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-image-upload-area i{font-size:28px;color:var(--acu-text-sub)}.acu-image-upload-area span{font-size:13px;color:var(--acu-text-sub)}.acu-image-upload-area .upload-hint{font-size:11px;color:var(--acu-text-sub);opacity:.7}.acu-image-preview-area{display:flex;align-items:center;gap:12px;padding:12px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:10px}.acu-image-preview-area .preview-image{width:48px;height:48px;border-radius:50%;object-fit:cover;border:2px solid var(--acu-border)}.acu-image-preview-area .preview-info{flex:1;display:flex;flex-direction:column;gap:2px}.acu-image-preview-area .preview-info .preview-name{font-size:13px;color:var(--acu-text-main);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-image-preview-area .preview-info .preview-size{font-size:11px;color:var(--acu-text-sub)}.acu-image-preview-area .preview-actions{display:flex;gap:6px}.acu-image-preview-area .preview-actions button{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:var(--acu-table-head);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-sub);cursor:pointer;transition:all .2s ease}.acu-image-preview-area .preview-actions button:hover{background:var(--acu-btn-hover);color:var(--acu-text-main)}.acu-image-preview-area .preview-actions button.btn-delete:hover{background:rgba(231,76,60,.1);border-color:#e74c3c;color:#e74c3c}.acu-size-slider-container{display:flex;align-items:center;gap:12px;width:100%}.acu-size-slider-container .acu-size-slider{flex:1;height:6px;-webkit-appearance:none;appearance:none;background:var(--acu-border);border-radius:3px;outline:none;cursor:pointer}.acu-size-slider-container .acu-size-slider::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:var(--acu-title-color);border-radius:50%;box-shadow:0 2px 6px rgba(0,0,0,.2);cursor:pointer;-webkit-transition:transform .15s ease;transition:transform .15s ease}.acu-size-slider-container .acu-size-slider::-webkit-slider-thumb:hover{transform:scale(1.1)}.acu-size-slider-container .acu-size-slider::-moz-range-thumb{width:18px;height:18px;background:var(--acu-title-color);border-radius:50%;box-shadow:0 2px 6px rgba(0,0,0,.2);cursor:pointer;border:none}.acu-size-slider-container .acu-size-value{min-width:50px;padding:6px 10px;font-size:13px;font-weight:600;text-align:center;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main)}.acu-test-anim-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px;margin-top:8px;background:var(--acu-title-color-bg);border:1px solid var(--acu-title-color);border-radius:8px;color:var(--acu-title-color);font-size:13px;font-weight:500;cursor:pointer;transition:all .2s ease}.acu-test-anim-btn:hover{background:var(--acu-title-color);color:#fff}.acu-test-anim-btn i{font-size:14px}.acu-reset-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px;margin-top:16px;background:rgba(0,0,0,0);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-sub);font-size:13px;cursor:pointer;transition:all .2s ease}.acu-reset-btn:hover{background:rgba(231,76,60,.1);border-color:#e74c3c;color:#e74c3c}.acu-reset-btn i{font-size:12px}.acu-ball-appearance-panel{padding:0}.acu-ball-preview-hint{position:absolute;top:8px;left:12px;font-size:11px;color:var(--acu-text-sub);opacity:.7}.acu-ball-preview-container{position:relative;flex-direction:column;gap:16px}.acu-preview-buttons{display:flex;gap:8px;margin-top:8px}.acu-tool-btn{padding:6px 12px;font-size:12px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);cursor:pointer;transition:all .2s ease}.acu-tool-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color)}.acu-anim-icon{font-size:20px;line-height:1}.acu-anim-name{font-size:11px;color:var(--acu-text-sub);margin-top:4px}.acu-preset-header{position:sticky;top:-20px;margin:-20px -20px 16px;padding:28px 36px 12px 36px;z-index:10;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border)}.acu-preset-header .acu-settings-row{margin-bottom:0}.acu-preset-control{display:flex;align-items:center;gap:8px}.acu-preset-dropdown{position:relative;flex:1;min-width:120px;max-width:200px}.acu-preset-dropdown.open .acu-preset-dropdown-btn i{transform:rotate(180deg)}.acu-preset-dropdown-btn{display:flex;align-items:center;justify-content:space-between;width:100%;padding:8px 12px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);font-size:13px;cursor:pointer;transition:all .2s ease}.acu-preset-dropdown-btn:hover{border-color:var(--acu-text-sub)}.acu-preset-dropdown-btn .acu-preset-selected-name{flex:1;text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-preset-dropdown-btn i{font-size:10px;color:var(--acu-text-sub);transition:transform .2s ease;margin-left:8px}.acu-preset-dropdown-menu{position:absolute;top:100%;left:0;right:0;margin-top:4px;max-height:200px;overflow-y:auto;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:8px;box-shadow:0 4px 16px rgba(0,0,0,.15);z-index:100}.acu-preset-option{display:flex;align-items:center;padding:10px 12px;cursor:pointer;transition:background .15s ease}.acu-preset-option:hover{background:var(--acu-btn-hover)}.acu-preset-option.active{background:var(--acu-title-color-bg);color:var(--acu-title-color)}.acu-preset-option:first-child{border-radius:7px 7px 0 0}.acu-preset-option:last-child{border-radius:0 0 7px 7px}.acu-preset-option .acu-preset-option-name{flex:1;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-preset-option .acu-preset-delete-btn{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;border-radius:4px;color:var(--acu-text-sub);cursor:pointer;opacity:0;transition:all .15s ease}.acu-preset-option .acu-preset-delete-btn:hover{background:rgba(231,76,60,.1);color:#e74c3c}.acu-preset-option .acu-preset-delete-btn i{font-size:10px}.acu-preset-option:hover .acu-preset-delete-btn{opacity:1}.acu-btn-save{padding:8px 14px;white-space:nowrap}.acu-theme-section{margin-bottom:24px}.acu-theme-section:last-child{margin-bottom:0}.acu-theme-section-title{display:flex;align-items:center;gap:8px;font-size:14px;font-weight:600;color:var(--acu-text-main);margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid var(--acu-border)}.acu-theme-section-title i{font-size:14px;color:var(--acu-title-color)}.acu-highlight-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}.acu-highlight-item{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;transition:border-color .2s ease}.acu-highlight-item:hover{border-color:var(--acu-text-sub)}.acu-highlight-item .acu-highlight-label{flex:1;font-size:12px;color:var(--acu-text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-highlight-item .acu-highlight-swatch{width:28px;height:28px;padding:0;border:2px solid var(--acu-border);border-radius:6px;cursor:pointer;background:rgba(0,0,0,0);flex-shrink:0}.acu-highlight-item .acu-highlight-swatch::-webkit-color-swatch-wrapper{padding:2px}.acu-highlight-item .acu-highlight-swatch::-webkit-color-swatch{border-radius:3px;border:none}.acu-var-group{margin-bottom:16px}.acu-var-group:last-child{margin-bottom:0}.acu-var-group-header{display:flex;align-items:center;gap:8px;padding:10px 12px;background:var(--acu-table-head);border:1px solid var(--acu-border);border-radius:8px;cursor:pointer;transition:all .2s ease;-webkit-user-select:none;user-select:none}.acu-var-group-header:hover{background:var(--acu-btn-hover)}.acu-var-group-header .acu-var-group-icon{font-size:12px;color:var(--acu-text-sub);transition:transform .2s ease}.acu-var-group-header.expanded .acu-var-group-icon{transform:rotate(90deg)}.acu-var-group-header .acu-var-group-name{flex:1;font-size:13px;font-weight:500;color:var(--acu-text-main)}.acu-var-group-header .acu-var-group-count{font-size:11px;color:var(--acu-text-sub);padding:2px 8px;background:var(--acu-btn-bg);border-radius:10px}.acu-var-group-content{margin-top:8px;padding-left:12px;border-left:2px solid var(--acu-border)}.acu-var-item{display:flex;align-items:center;gap:10px;padding:8px 12px;margin-bottom:6px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px}.acu-var-item:last-child{margin-bottom:0}.acu-var-item .acu-var-label{flex:1;font-size:12px;color:var(--acu-text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-var-item .acu-var-label code{font-size:10px;color:var(--acu-text-sub);display:block;margin-top:2px}.acu-var-item .acu-var-input{width:80px;padding:4px 8px;font-size:11px;font-family:monospace;background:var(--acu-table-head);border:1px solid var(--acu-border);border-radius:4px;color:var(--acu-text-main)}.acu-var-item .acu-var-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-var-item .acu-var-swatch{width:28px;height:28px;padding:0;border:2px solid var(--acu-border);border-radius:6px;cursor:pointer;background:rgba(0,0,0,0);flex-shrink:0}.acu-var-item .acu-var-swatch::-webkit-color-swatch-wrapper{padding:2px}.acu-var-item .acu-var-swatch::-webkit-color-swatch{border-radius:3px;border:none}.acu-preset-section{margin-bottom:20px}.acu-preset-list{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}.acu-preset-item{display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;cursor:pointer;transition:all .2s ease}.acu-preset-item:hover{background:var(--acu-btn-hover);border-color:var(--acu-text-sub)}.acu-preset-item.active{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-preset-item .acu-preset-icon{font-size:16px;color:var(--acu-title-color)}.acu-preset-item .acu-preset-info{flex:1;min-width:0}.acu-preset-item .acu-preset-info .acu-preset-name{font-size:13px;font-weight:500;color:var(--acu-text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-preset-item .acu-preset-info .acu-preset-meta{font-size:11px;color:var(--acu-text-sub);margin-top:2px}.acu-preset-item .acu-preset-actions{display:flex;gap:4px}.acu-preset-item .acu-preset-actions button{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:1px solid rgba(0,0,0,0);border-radius:6px;color:var(--acu-text-sub);cursor:pointer;transition:all .15s ease}.acu-preset-item .acu-preset-actions button:hover{background:var(--acu-table-head);border-color:var(--acu-border);color:var(--acu-text-main)}.acu-preset-item .acu-preset-actions button.btn-delete:hover{background:rgba(231,76,60,.1);border-color:#e74c3c;color:#e74c3c}.acu-preset-item .acu-preset-actions button i{font-size:12px}.acu-preset-empty{padding:20px;text-align:center;color:var(--acu-text-sub);font-size:13px;background:var(--acu-btn-bg);border:1px dashed var(--acu-border);border-radius:8px}.acu-save-preset-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:10px;background:var(--acu-title-color-bg);border:1px solid var(--acu-title-color);border-radius:8px;color:var(--acu-title-color);font-size:13px;cursor:pointer;transition:all .2s ease}.acu-save-preset-btn:hover{background:var(--acu-title-color);color:#fff}.acu-save-preset-btn i{font-size:12px}.acu-css-section{margin-top:20px}.acu-css-editor-container{position:relative}.acu-css-editor{width:100%;min-height:150px;max-height:300px;padding:12px;font-family:"Consolas","Monaco",monospace;font-size:12px;line-height:1.5;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);resize:vertical}.acu-css-editor:focus{outline:none;border-color:var(--acu-title-color)}.acu-css-editor::placeholder{color:var(--acu-text-sub);opacity:.6}.acu-css-hint{margin-top:8px;padding:10px 12px;background:var(--acu-title-color-bg);border-radius:6px;font-size:11px;color:var(--acu-text-sub);line-height:1.5}.acu-css-hint p{margin:0 0 6px 0;font-weight:500;color:var(--acu-text-main)}.acu-css-hint code{display:inline-block;background:var(--acu-btn-bg);border:1px solid var(--acu-border);padding:3px 8px;border-radius:4px;font-size:11px;font-family:"Consolas","Monaco",monospace;color:var(--acu-title-color);margin:2px 4px 2px 0}.acu-theme-actions{display:flex;gap:10px;margin-top:16px;padding-top:16px;border-top:1px solid var(--acu-border)}.acu-theme-btn{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;padding:10px 12px;font-size:12px;border-radius:8px;cursor:pointer;transition:all .2s ease}.acu-theme-btn i{font-size:11px}.acu-theme-btn.btn-primary{background:var(--acu-title-color);border:1px solid var(--acu-title-color);color:#fff}.acu-theme-btn.btn-primary:hover{filter:brightness(1.1)}.acu-theme-btn.btn-secondary{background:rgba(0,0,0,0);border:1px solid var(--acu-border);color:var(--acu-text-main)}.acu-theme-btn.btn-secondary:hover{background:var(--acu-btn-hover);border-color:var(--acu-text-sub)}.acu-theme-btn.btn-danger{background:rgba(0,0,0,0);border:1px solid var(--acu-border);color:var(--acu-text-sub)}.acu-theme-btn.btn-danger:hover{background:rgba(231,76,60,.1);border-color:#e74c3c;color:#e74c3c}.acu-preset-save-modal{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:10002}.acu-preset-save-dialog{width:90%;max-width:320px;padding:20px;background:var(--acu-bg-panel);border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,.3)}.acu-preset-save-dialog .dialog-title{font-size:15px;font-weight:600;color:var(--acu-text-main);margin-bottom:16px}.acu-preset-save-dialog .dialog-input{width:100%;padding:10px 12px;font-size:13px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);margin-bottom:16px}.acu-preset-save-dialog .dialog-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-preset-save-dialog .dialog-actions{display:flex;gap:10px;justify-content:flex-end}.acu-preset-save-dialog .dialog-actions button{padding:8px 16px;font-size:12px;border-radius:6px;cursor:pointer;transition:all .2s ease}.acu-preset-save-dialog .dialog-actions button.btn-cancel{background:rgba(0,0,0,0);border:1px solid var(--acu-border);color:var(--acu-text-sub)}.acu-preset-save-dialog .dialog-actions button.btn-cancel:hover{background:var(--acu-btn-hover)}.acu-preset-save-dialog .dialog-actions button.btn-confirm{background:var(--acu-title-color);border:1px solid var(--acu-title-color);color:#fff}.acu-preset-save-dialog .dialog-actions button.btn-confirm:hover{filter:brightness(1.1)}.acu-preset-save-dialog .dialog-actions button.btn-confirm:disabled{opacity:.5;cursor:not-allowed}.acu-var-groups-container{border:1px solid var(--acu-border);border-radius:8px;overflow:hidden}.acu-var-group{margin-bottom:0;border-bottom:1px solid var(--acu-border)}.acu-var-group:last-child,.acu-var-group.last{border-bottom:none}.acu-var-group.first .acu-var-group-header{border-radius:7px 7px 0 0}.acu-var-group.last .acu-var-group-header{border-radius:0 0 7px 7px}.acu-var-group .acu-var-group-header{border-radius:0;border:none;background:var(--acu-btn-bg)}.acu-var-group .acu-var-group-header:hover{background:var(--acu-btn-hover)}.acu-var-group-body{padding:8px 12px;background:var(--acu-table-head)}.acu-var-row{display:flex;align-items:center;gap:10px;padding:8px 12px;margin-bottom:6px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px}.acu-var-row:last-child{margin-bottom:0}.acu-var-row .acu-var-label{flex:1;font-size:12px;color:var(--acu-text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-var-row .acu-var-control{display:flex;align-items:center;gap:6px}.acu-var-count{font-size:11px;color:var(--acu-text-sub);padding:2px 8px;background:var(--acu-btn-bg);border-radius:10px;margin-left:auto;margin-right:8px}.acu-var-reset{width:26px;height:26px;display:flex;align-items:center;justify-content:center;background:var(--acu-table-head);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-sub);cursor:pointer;transition:all .15s ease}.acu-var-reset:hover{background:var(--acu-title-color-bg);border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-var-reset i{font-size:10px}.acu-preset-btn{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:1px solid rgba(0,0,0,0);border-radius:6px;color:var(--acu-text-sub);cursor:pointer;transition:all .15s ease}.acu-preset-btn:hover{background:rgba(231,76,60,.1);border-color:#e74c3c;color:#e74c3c}.acu-preset-btn i{font-size:12px}.acu-preset-save{display:flex;gap:10px;margin-top:12px}.acu-input{flex:1;padding:10px 12px;font-size:13px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);transition:border-color .2s ease}.acu-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-input::placeholder{color:var(--acu-text-sub);opacity:.7}.acu-btn{display:flex;align-items:center;justify-content:center;gap:6px;padding:10px 16px;font-size:13px;border-radius:8px;cursor:pointer;transition:all .2s ease;white-space:nowrap}.acu-btn i{font-size:12px}.acu-btn.acu-btn-primary{background:var(--acu-title-color);border:1px solid var(--acu-title-color);color:#fff}.acu-btn.acu-btn-primary:hover{filter:brightness(1.1)}.acu-btn.acu-btn-primary:disabled{opacity:.5;cursor:not-allowed}.acu-css-actions{display:flex;gap:8px;margin-bottom:10px}.acu-btn-danger:hover{background:rgba(231,76,60,.1) !important;border-color:#e74c3c !important;color:#e74c3c !important}.acu-css-footer{display:flex;justify-content:flex-end;margin-top:6px;font-size:11px;color:var(--acu-text-sub)}@media (max-width:768px){.acu-highlight-grid{grid-template-columns:repeat(2,1fr)}.acu-var-row{flex-wrap:wrap}.acu-var-row .acu-var-label{width:100%;flex:none;margin-bottom:6px}.acu-var-row .acu-var-control{flex:1}.acu-preset-save{flex-direction:column}.acu-preset-save .acu-btn{width:100%}}.acu-rgb-picker{display:flex;align-items:center;gap:8px}.acu-rgb-picker input[type=color]{width:36px;height:36px;padding:0;border:2px solid var(--acu-border);border-radius:8px;cursor:pointer;background:rgba(0,0,0,0)}.acu-rgb-picker input[type=color]::-webkit-color-swatch-wrapper{padding:2px}.acu-rgb-picker input[type=color]::-webkit-color-swatch{border-radius:4px;border:none}.acu-color-input{flex:1;padding:8px 12px;font-size:13px;font-family:monospace;text-transform:uppercase;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main)}.acu-color-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-icon-option{display:flex;flex-direction:column;align-items:center;gap:6px;padding:14px 8px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:10px;cursor:pointer;transition:all .2s ease}.acu-icon-option input[type=radio]{display:none}.acu-icon-option:hover{background:var(--acu-btn-hover);border-color:var(--acu-text-sub)}.acu-icon-option.active{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-icon-option i{font-size:22px;color:var(--acu-text-main)}.acu-icon-option .emoji-icon{font-size:22px;line-height:1}.acu-icon-option>span:last-child{font-size:11px;color:var(--acu-text-sub)}.acu-icon-input-area{margin-top:12px}.acu-icon-input input,.acu-emoji-input input{width:100%;padding:10px 14px;font-size:14px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);transition:border-color .2s ease}.acu-icon-input input:focus,.acu-emoji-input input:focus{outline:none;border-color:var(--acu-title-color)}.acu-icon-input input::placeholder,.acu-emoji-input input::placeholder{color:var(--acu-text-sub);opacity:.6}.acu-emoji-input input{font-size:18px;text-align:center}.acu-input-hint{display:block;margin-top:6px;font-size:11px;color:var(--acu-text-sub);opacity:.7}.acu-image-upload{display:flex;flex-direction:column;gap:10px}.acu-upload-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:14px;background:var(--acu-btn-bg);border:2px dashed var(--acu-border);border-radius:10px;color:var(--acu-text-main);font-size:13px;cursor:pointer;transition:all .2s ease}.acu-upload-btn:hover{border-color:var(--acu-title-color);background:var(--acu-title-color-bg);color:var(--acu-title-color)}.acu-upload-btn i{font-size:16px}.acu-image-preview{position:relative;display:inline-flex;align-items:center;justify-content:center;width:60px;height:60px;border-radius:50%;border:2px solid var(--acu-border);overflow:hidden;background:var(--acu-table-head)}.acu-image-preview img{width:100%;height:100%;object-fit:cover}.acu-clear-btn{position:absolute;top:-4px;right:-4px;width:20px;height:20px;display:flex;align-items:center;justify-content:center;background:#e74c3c;border:none;border-radius:50%;color:#fff;font-size:14px;font-weight:bold;cursor:pointer;transition:transform .15s ease}.acu-clear-btn:hover{transform:scale(1.1)}@media (max-width:768px){.acu-ball-preview-container{padding:20px 12px}.acu-anim-grid,.acu-icon-type-grid{grid-template-columns:repeat(2,1fr);gap:6px}.acu-anim-option,.acu-icon-type-option,.acu-icon-option{padding:10px 6px}.acu-anim-option i,.acu-icon-type-option i,.acu-icon-option i{font-size:16px}.acu-anim-option span,.acu-icon-type-option span,.acu-icon-option span{font-size:10px}.acu-rgb-row .acu-rgb-label{width:16px;font-size:11px}.acu-rgb-row .acu-rgb-value{width:36px;font-size:10px}.acu-preview-buttons{flex-wrap:wrap;justify-content:center}}.acu-font-control{display:flex;align-items:center;gap:6px}.acu-font-control select{text-align:center;text-align-last:center}.acu-font-dialog-overlay{position:absolute;top:0;left:0;right:0;bottom:0;z-index:100;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5);backdrop-filter:blur(2px)}.acu-add-font-btn{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-sub);cursor:pointer;transition:all .2s ease;flex-shrink:0}.acu-add-font-btn:hover{background:var(--acu-title-color-bg);border-color:var(--acu-title-color);color:var(--acu-title-color)}.acu-add-font-btn i{font-size:12px}.acu-add-font-dialog{max-width:380px}.acu-font-form{display:flex;flex-direction:column;gap:14px}.acu-form-row{display:flex;flex-direction:column;gap:6px}.acu-form-row label{font-size:13px;font-weight:500;color:var(--acu-text-main)}.acu-form-row label .optional{font-weight:normal;font-size:11px;color:var(--acu-text-sub);opacity:.7}.acu-form-row input{width:100%;padding:10px 12px;font-size:13px;background:var(--acu-btn-bg);border:2px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);transition:border-color .2s ease}.acu-form-row input:focus{outline:none;border-color:var(--acu-title-color)}.acu-form-row input::placeholder{color:var(--acu-text-sub);opacity:.6}.acu-form-hint{display:flex;align-items:flex-start;gap:8px;padding:10px 12px;background:var(--acu-table-head);border-radius:8px;font-size:11px;color:var(--acu-text-sub);line-height:1.4}.acu-form-hint i{flex-shrink:0;margin-top:1px;color:var(--acu-title-color)}.acu-cell-menu{position:fixed;z-index:2147483647;min-width:160px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.25);padding:6px;animation:acu-scaleIn .15s ease;transform-origin:top left}.acu-cell-menu.from-right{transform-origin:top right}.acu-cell-menu.from-bottom{transform-origin:bottom left}.acu-cell-menu.from-right.from-bottom{transform-origin:bottom right}.acu-menu-item{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;font-size:13px;color:var(--acu-text-main);cursor:pointer;transition:all .15s ease;white-space:nowrap}.acu-menu-item i{width:16px;text-align:center;font-size:14px;color:var(--acu-text-sub);transition:color .15s ease}.acu-menu-item:hover{background:var(--acu-btn-hover)}.acu-menu-item:hover i{color:var(--acu-title-color)}.acu-menu-item:active{transform:scale(0.98)}.acu-menu-item.danger{color:#e74c3c}.acu-menu-item.danger i{color:#e74c3c}.acu-menu-item.danger:hover{background:rgba(231,76,60,.15)}.acu-menu-item.success{color:#27ae60}.acu-menu-item.success i{color:#27ae60}.acu-menu-item.success:hover{background:rgba(46,204,113,.15)}.acu-menu-item.disabled{opacity:.5;cursor:not-allowed;pointer-events:none}.acu-menu-divider{height:1px;background:var(--acu-border);margin:6px 8px}.acu-menu-group-title{padding:6px 14px;font-size:11px;font-weight:600;color:var(--acu-text-sub);text-transform:uppercase;letter-spacing:.5px}.acu-menu-arrow{margin-left:auto;font-size:10px;color:var(--acu-text-sub)}.acu-submenu{position:absolute;top:0;left:100%;margin-left:4px;min-width:140px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.25);padding:6px;opacity:0;visibility:hidden;transform:translateX(-10px);transition:all .15s ease}.acu-submenu.from-right{left:auto;right:100%;margin-left:0;margin-right:4px;transform:translateX(10px)}.acu-menu-item.has-submenu{position:relative}.acu-menu-item.has-submenu:hover .acu-submenu{opacity:1;visibility:visible;transform:translateX(0)}.acu-menu-shortcut{margin-left:auto;font-size:11px;color:var(--acu-text-sub);opacity:.7}.acu-menu-checkbox{width:16px;height:16px;display:flex;align-items:center;justify-content:center;border:2px solid var(--acu-border);border-radius:4px;font-size:10px;color:rgba(0,0,0,0);transition:all .15s ease}.acu-menu-checkbox.checked{background:var(--acu-title-color);border-color:var(--acu-title-color);color:#fff}.acu-cell-menu.compact{padding:4px}.acu-cell-menu.compact .acu-menu-item{padding:8px 12px;font-size:12px}.acu-cell-menu.compact .acu-menu-item i{font-size:12px}.acu-context-menu{position:fixed;z-index:var(--acu-z-menu,2147483648);min-width:160px;max-width:220px;background:var(--acu-menu-bg,#fff);border:1px solid var(--acu-border,#dcd0c0);border-radius:var(--acu-radius-md,12px);box-shadow:0 4px 16px rgba(0,0,0,.15),0 0 1px rgba(0,0,0,.1);padding:6px 0;outline:none;overflow:hidden;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);pointer-events:auto !important}.acu-context-menu .acu-menu-item{display:flex;align-items:center;gap:12px;padding:10px 16px;cursor:pointer;color:var(--acu-menu-text,#333);font-size:var(--acu-font-size,13px);transition:background var(--acu-transition-fast,0.15s),color var(--acu-transition-fast,0.15s);-webkit-user-select:none;user-select:none}.acu-context-menu .acu-menu-item i{width:16px;text-align:center;color:var(--acu-text-sub,#999);font-size:14px;transition:color var(--acu-transition-fast,0.15s)}.acu-context-menu .acu-menu-item span{flex:1}.acu-context-menu .acu-menu-item:hover{background:var(--acu-table-hover,#f0ebe0)}.acu-context-menu .acu-menu-item:active{background:var(--acu-btn-hover,#cbbba8)}.acu-context-menu .acu-menu-item.acu-menu-danger{color:var(--acu-danger,#e74c3c)}.acu-context-menu .acu-menu-item.acu-menu-danger i{color:var(--acu-danger,#e74c3c)}.acu-context-menu .acu-menu-item.acu-menu-danger:hover{background:rgba(231,76,60,.1)}.acu-context-menu .acu-menu-item.acu-menu-warning{color:var(--acu-warning,#f39c12)}.acu-context-menu .acu-menu-item.acu-menu-warning i{color:var(--acu-warning,#f39c12)}.acu-context-menu .acu-menu-item.acu-menu-warning:hover{background:rgba(243,156,18,.1)}.acu-context-menu .acu-menu-divider{height:1px;background:var(--acu-border,#dcd0c0);margin:6px 12px;opacity:.6}.acu-menu-fade-enter-active,.acu-menu-fade-leave-active{transition:opacity .15s ease,transform .15s ease}.acu-menu-fade-enter-from,.acu-menu-fade-leave-to{opacity:0;transform:scale(0.95)}.acu-menu-fade-enter-to,.acu-menu-fade-leave-from{opacity:1;transform:scale(1)}.acu-quick-view{position:fixed;z-index:2147483646;min-width:280px;max-width:400px;max-height:60vh;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.3);overflow:hidden;animation:acu-fadeIn .2s ease}.acu-quick-view::before{content:"";position:absolute;width:12px;height:12px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-right:none;border-bottom:none;transform:rotate(45deg)}.acu-quick-view.arrow-left::before{left:-7px;top:20px}.acu-quick-view.arrow-right::before{right:-7px;top:20px;transform:rotate(-135deg)}.acu-quick-view.arrow-top::before{top:-7px;left:20px}.acu-quick-view.arrow-bottom::before{bottom:-7px;left:20px;transform:rotate(-135deg)}.acu-quick-view-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border)}.acu-quick-view-header .title{font-size:14px;font-weight:600;color:var(--acu-text-main);display:flex;align-items:center;gap:8px}.acu-quick-view-header .title i{color:var(--acu-title-color)}.acu-quick-view-header .close-btn{width:24px;height:24px;display:flex;align-items:center;justify-content:center;border:none;background:rgba(0,0,0,0);color:var(--acu-text-sub);font-size:14px;cursor:pointer;border-radius:6px;transition:all .15s ease}.acu-quick-view-header .close-btn:hover{background:rgba(231,76,60,.15);color:#e74c3c}.acu-quick-view-content{padding:16px;overflow-y:auto;max-height:calc(60vh - 50px)}.acu-quick-view-item{display:flex;flex-direction:column;gap:4px;padding:10px 0}.acu-quick-view-item:not(:last-child){border-bottom:1px solid var(--acu-border)}.acu-quick-view-item .label{font-size:11px;color:var(--acu-text-sub);text-transform:uppercase;letter-spacing:.5px}.acu-quick-view-item .value{font-size:14px;color:var(--acu-text-main);word-break:break-word;line-height:1.5}.acu-quick-view-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}.acu-quick-view-grid .acu-quick-view-item{padding:8px 12px;background:var(--acu-btn-bg);border-radius:8px;border-bottom:none}.acu-quick-view-actions{display:flex;gap:8px;padding:12px 16px;border-top:1px solid var(--acu-border);background:var(--acu-bg-panel)}.acu-quick-view-btn{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;padding:8px 16px;border:none;border-radius:8px;font-size:12px;cursor:pointer;transition:all .15s ease}.acu-quick-view-btn.primary{background:var(--acu-title-color);color:#fff}.acu-quick-view-btn.primary:hover{filter:brightness(1.1)}.acu-quick-view-btn.secondary{background:var(--acu-btn-bg);color:var(--acu-text-main);border:1px solid var(--acu-border)}.acu-quick-view-btn.secondary:hover{background:var(--acu-btn-hover)}.acu-quick-view-loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;color:var(--acu-text-sub)}.acu-quick-view-loading .spinner{width:32px;height:32px;border:3px solid var(--acu-border);border-top-color:var(--acu-title-color);border-radius:50%;animation:acu-spin .8s linear infinite;margin-bottom:12px}.acu-quick-view-loading .text{font-size:13px}.acu-quick-view-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px 20px;color:var(--acu-text-sub);text-align:center}.acu-quick-view-empty i{font-size:32px;margin-bottom:12px;opacity:.5}.acu-quick-view-empty .text{font-size:13px}.acu-edit-overlay{position:fixed;top:0;left:0;right:0;bottom:0;z-index:2147483645;background:rgba(0,0,0,.5);backdrop-filter:blur(2px);animation:acu-fadeIn .2s ease}.acu-overlay{position:fixed;top:0;left:0;right:0;bottom:0;z-index:2147483640;background:rgba(0,0,0,.4);animation:acu-fadeIn .15s ease}.acu-overlay.transparent{background:rgba(0,0,0,0)}.acu-overlay.light{background:hsla(0,0%,100%,.3)}.acu-overlay.blur{backdrop-filter:blur(4px)}.acu-loading-overlay{position:absolute;top:0;left:0;right:0;bottom:0;z-index:100;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(var(--acu-bg-panel-rgb),0.9);backdrop-filter:blur(4px)}.acu-loading-overlay .spinner{width:40px;height:40px;border:4px solid var(--acu-border);border-top-color:var(--acu-title-color);border-radius:50%;animation:acu-spin .8s linear infinite;margin-bottom:16px}.acu-loading-overlay .text{font-size:14px;color:var(--acu-text-main)}.acu-loading-overlay .progress{width:200px;height:4px;background:var(--acu-border);border-radius:2px;margin-top:12px;overflow:hidden}.acu-loading-overlay .progress .bar{height:100%;background:var(--acu-title-color);border-radius:2px;transition:width .3s ease}.acu-saving-overlay{position:fixed;top:0;left:0;right:0;bottom:0;z-index:2147483648;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(4px)}.acu-saving-overlay .saving-content{display:flex;flex-direction:column;align-items:center;padding:32px 48px;background:var(--acu-bg-panel);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.3)}.acu-saving-overlay .saving-content .spinner{width:48px;height:48px;border:4px solid var(--acu-border);border-top-color:var(--acu-title-color);border-radius:50%;animation:acu-spin .8s linear infinite;margin-bottom:16px}.acu-saving-overlay .saving-content .text{font-size:16px;font-weight:500;color:var(--acu-text-main)}.acu-saving-overlay .saving-content .subtext{font-size:12px;color:var(--acu-text-sub);margin-top:8px}.acu-toast-overlay{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);z-index:2147483649;display:flex;flex-direction:column;align-items:center;gap:8px;pointer-events:none}.acu-toast{display:flex;align-items:center;gap:10px;padding:12px 20px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.25);font-size:13px;color:var(--acu-text-main);animation:acu-slideUp .3s ease;pointer-events:auto}.acu-toast i{font-size:16px}.acu-toast.success{border-color:rgba(46,204,113,.3)}.acu-toast.success i{color:#27ae60}.acu-toast.error{border-color:rgba(231,76,60,.3)}.acu-toast.error i{color:#e74c3c}.acu-toast.warning{border-color:rgba(241,196,15,.3)}.acu-toast.warning i{color:#f39c12}.acu-toast.info{border-color:rgba(52,152,219,.3)}.acu-toast.info i{color:#3498db}.acu-hidden-buttons-popup{position:absolute;bottom:calc(100% + 8px);left:0;right:0;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:8px;padding:8px;box-shadow:0 -4px 16px rgba(0,0,0,.3);z-index:100;pointer-events:auto}.acu-hidden-buttons-popup .popup-buttons-grid{display:flex;flex-wrap:wrap;gap:6px;justify-content:center}.acu-hidden-buttons-popup .popup-button{display:flex;align-items:center;justify-content:center;width:36px;height:36px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);cursor:pointer;transition:all .2s ease}.acu-hidden-buttons-popup .popup-button:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color)}.acu-hidden-buttons-popup .popup-button.btn-danger{color:#e74c3c}.hidden-popup-enter-active,.hidden-popup-leave-active{transition:all .2s ease}.hidden-popup-enter-from,.hidden-popup-leave-to{opacity:0;transform:translateY(10px)}.acu-tabs-popup{position:absolute;bottom:calc(100% + 8px);left:0;right:0;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:12px;padding:12px;box-shadow:0 -8px 24px rgba(0,0,0,.35);z-index:100;pointer-events:auto;max-height:60vh;overflow-y:auto}.acu-tabs-popup .popup-tabs-grid{display:grid;grid-template-columns:var(--acu-nav-cols,repeat(auto-fill,minmax(90px,1fr)));gap:6px}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn{display:flex;align-items:center;justify-content:center;gap:6px;padding:8px 12px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:8px;color:var(--acu-text-main);font-size:12px;cursor:pointer;transition:all .2s ease;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn i{font-size:14px;flex-shrink:0}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn span{overflow:hidden;text-overflow:ellipsis}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color)}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn.active{background:var(--acu-title-color-bg);border-color:var(--acu-title-color);color:var(--acu-title-color);font-weight:500}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn.has-issues{border-color:#e74c3c;box-shadow:0 0 0 2px rgba(231,76,60,.2)}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn.has-ai-changes{border-color:var(--acu-highlight-ai-color,#3498db);box-shadow:0 0 0 2px rgba(52,152,219,.2)}.acu-tabs-popup .popup-tabs-grid .acu-nav-btn.acu-nav-btn-special{background:var(--acu-table-head);font-weight:500}.acu-confirm-overlay{position:fixed;top:0;left:0;right:0;bottom:0;z-index:2147483647;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);animation:acu-fadeIn .2s ease}.acu-confirm-dialog{width:90%;max-width:360px;background:var(--acu-bg-panel);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden;animation:acu-scaleIn .2s ease}.acu-confirm-dialog .confirm-header{padding:20px 20px 0;text-align:center}.acu-confirm-dialog .confirm-header i{font-size:48px;margin-bottom:12px}.acu-confirm-dialog .confirm-header i.warning{color:#f39c12}.acu-confirm-dialog .confirm-header i.danger{color:#e74c3c}.acu-confirm-dialog .confirm-header i.info{color:#3498db}.acu-confirm-dialog .confirm-header h4{margin:0;font-size:18px;font-weight:600;color:var(--acu-text-main)}.acu-confirm-dialog .confirm-body{padding:16px 20px;text-align:center}.acu-confirm-dialog .confirm-body p{margin:0;font-size:14px;color:var(--acu-text-sub);line-height:1.6}.acu-confirm-dialog .confirm-footer{display:flex;border-top:1px solid var(--acu-border)}.acu-confirm-dialog .confirm-footer button{flex:1;padding:14px;border:none;background:rgba(0,0,0,0);font-size:14px;font-weight:500;cursor:pointer;transition:all .15s ease}.acu-confirm-dialog .confirm-footer button:first-child{color:var(--acu-text-sub);border-right:1px solid var(--acu-border)}.acu-confirm-dialog .confirm-footer button:first-child:hover{background:var(--acu-btn-hover)}.acu-confirm-dialog .confirm-footer button:last-child{color:var(--acu-title-color)}.acu-confirm-dialog .confirm-footer button:last-child:hover{background:rgba(var(--acu-title-color-rgb),0.1)}.acu-confirm-dialog .confirm-footer button:last-child.danger{color:#e74c3c}.acu-confirm-dialog .confirm-footer button:last-child.danger:hover{background:rgba(231,76,60,.1)}.acu-hidden-buttons-popup{position:absolute;bottom:calc(100% + 8px);left:0;right:0;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:8px;padding:8px;box-shadow:0 -4px 16px rgba(0,0,0,.3);z-index:100;pointer-events:auto}.acu-hidden-buttons-popup .popup-buttons-grid{display:flex;flex-wrap:wrap;gap:6px;justify-content:center}.acu-hidden-buttons-popup .popup-button{display:flex;align-items:center;justify-content:center;width:36px;height:36px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);cursor:pointer;transition:all .2s}.acu-hidden-buttons-popup .popup-button:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color);color:var(--acu-title-color);transform:translateY(-2px)}.acu-hidden-buttons-popup .popup-button:active{transform:scale(0.95)}.acu-hidden-buttons-popup .popup-button i{font-size:14px}.acu-hidden-buttons-popup .popup-button.btn-danger{color:#e74c3c}.acu-hidden-buttons-popup .popup-button.btn-danger:hover{border-color:#e74c3c;background:rgba(231,76,60,.1)}.acu-more-btn.active{color:var(--acu-title-color);background:var(--acu-btn-hover)}.acu-more-btn.active i{transform:rotate(180deg)}.acu-more-btn i{transition:transform .2s ease}.hidden-popup-enter-active,.hidden-popup-leave-active{transition:all .2s ease}.hidden-popup-enter-from,.hidden-popup-leave-to{opacity:0;transform:translateY(8px)}.acu-avatar-manager-dialog{width:90%;max-width:500px;max-height:80vh;display:flex;flex-direction:column}.acu-avatar-manager-dialog .acu-modal-body{flex:1;overflow-y:auto;padding:0}.acu-avatar-loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;gap:12px;color:var(--acu-text-sub)}.acu-avatar-loading i{font-size:24px}.acu-avatar-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;gap:12px;color:var(--acu-text-sub)}.acu-avatar-empty i{font-size:32px;opacity:.5}.acu-avatar-empty p{margin:0}.acu-avatar-items{padding:8px}.acu-avatar-item{display:flex;align-items:flex-start;gap:12px;padding:12px;margin-bottom:8px;background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:12px;position:relative;transition:all .2s ease}.acu-avatar-item:last-child{margin-bottom:0}.acu-avatar-item:hover{background:var(--acu-table-hover)}.acu-avatar-item.selected{border-color:var(--acu-title-color);background:var(--acu-title-color-bg)}.acu-avatar-checkbox{display:flex;align-items:center;justify-content:center;width:24px;height:48px;cursor:pointer;color:var(--acu-text-sub)}.acu-avatar-checkbox:hover{color:var(--acu-title-color)}.acu-avatar-checkbox i{font-size:18px}.acu-avatar-column{display:flex;flex-direction:column;align-items:center;gap:4px;flex-shrink:0}.acu-avatar-preview{width:48px;height:48px;min-width:48px;border-radius:50%;background:var(--acu-btn-bg);border:2px solid var(--acu-border);display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;background-size:cover;background-position:center;background-repeat:no-repeat;transition:all .2s ease}.acu-avatar-preview:hover{border-color:var(--acu-title-color);transform:scale(1.05)}.acu-avatar-preview.has-image{border-color:var(--acu-title-color)}.acu-avatar-initial{font-size:18px;font-weight:bold;color:var(--acu-text-sub)}.acu-avatar-camera-hint{position:absolute;bottom:2px;right:2px;font-size:10px;color:var(--acu-text-sub);opacity:0;transition:opacity .2s}.acu-avatar-preview:hover .acu-avatar-camera-hint{opacity:.8}.acu-avatar-source{font-size:9px;padding:1px 4px;border-radius:3px;font-weight:500;white-space:nowrap}.acu-avatar-source.acu-source-local{background:var(--acu-title-color-bg);color:var(--acu-title-color)}.acu-avatar-source.acu-source-url{background:var(--acu-btn-bg);color:var(--acu-text-sub)}.acu-avatar-source.acu-source-auto{background:var(--acu-title-color-bg);color:var(--acu-title-color)}.acu-avatar-info{flex:1;min-width:0;display:flex;flex-direction:column;gap:8px}.acu-avatar-name-row{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}.acu-avatar-name-left{display:flex;align-items:center;gap:4px;flex:1;min-width:0}.acu-avatar-name{font-size:14px;font-weight:600;color:var(--acu-text-main);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-avatar-label-preview{font-size:12px;color:var(--acu-text-sub);flex-shrink:0}.acu-avatar-name-right{display:flex;align-items:center;gap:6px;flex-shrink:0}.acu-avatar-name-btn{padding:4px 10px;font-size:12px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);cursor:pointer;transition:all .15s}.acu-avatar-name-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color)}.acu-import-dropdown{position:relative}.acu-avatar-import-btn{padding:4px 10px;font-size:12px;background:var(--acu-btn-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);cursor:pointer;display:flex;align-items:center;gap:4px;transition:all .15s}.acu-avatar-import-btn:hover{background:var(--acu-btn-hover);border-color:var(--acu-title-color)}.acu-avatar-import-btn i{font-size:10px}.acu-dropdown-menu{position:absolute;top:100%;right:0;margin-top:4px;background:var(--acu-card-bg);border:1px solid var(--acu-border);border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:10;min-width:120px;overflow:hidden}.acu-dropdown-item{padding:10px 14px;font-size:13px;color:var(--acu-text-main);cursor:pointer;display:flex;align-items:center;gap:8px;transition:background .15s}.acu-dropdown-item:hover{background:var(--acu-table-hover)}.acu-dropdown-item.disabled{opacity:.5;cursor:not-allowed}.acu-dropdown-item.disabled:hover{background:rgba(0,0,0,0)}.acu-dropdown-item i{width:16px;text-align:center;color:var(--acu-text-sub)}.acu-avatar-url-row{display:flex;align-items:center;gap:8px}.acu-url-label{font-size:12px;color:var(--acu-text-sub);white-space:nowrap}.acu-avatar-url-input{flex:1;padding:6px 10px;font-size:12px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);min-width:0}.acu-avatar-url-input:focus{outline:none;border-color:var(--acu-title-color)}.acu-avatar-url-input::placeholder{color:var(--acu-text-sub);opacity:.6}.acu-avatar-footer{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-top:1px solid var(--acu-border);background:var(--acu-bg-panel);gap:12px}.acu-footer-left,.acu-footer-right{display:flex;gap:8px}.acu-crop-dialog{width:90%;max-width:400px}.acu-crop-body{display:flex;flex-direction:column;gap:20px;padding:20px !important}.acu-crop-preview-wrapper{display:flex;justify-content:center}.acu-crop-preview{width:120px;height:120px;border-radius:50%;background:var(--acu-btn-bg);border:3px solid var(--acu-border);background-size:cover;background-position:center;background-repeat:no-repeat;display:flex;align-items:center;justify-content:center;position:relative;-webkit-user-select:none;user-select:none;touch-action:none}.acu-crop-preview.is-dragging{border-color:var(--acu-title-color)}.acu-crop-preview:hover:not(.is-dragging){border-color:var(--acu-title-color)}.acu-crop-placeholder{display:flex;flex-direction:column;align-items:center;gap:8px;color:var(--acu-text-sub)}.acu-crop-placeholder i{font-size:32px;opacity:.5}.acu-crop-placeholder span{font-size:12px}.acu-crop-controls{display:flex;flex-direction:column;gap:16px}.acu-crop-control-row{display:flex;align-items:center;gap:12px}.acu-crop-label{width:70px;font-size:13px;color:var(--acu-text-main);display:flex;align-items:center;gap:6px}.acu-crop-label i{width:16px;text-align:center;color:var(--acu-text-sub)}.acu-crop-slider{flex:1;height:6px;-webkit-appearance:none;background:var(--acu-border);border-radius:3px;outline:none}.acu-crop-slider::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--acu-title-color);cursor:pointer;border:2px solid var(--acu-card-bg);box-shadow:0 2px 4px rgba(0,0,0,.2)}.acu-crop-slider::-moz-range-thumb{width:18px;height:18px;border-radius:50%;background:var(--acu-title-color);cursor:pointer;border:2px solid var(--acu-card-bg);box-shadow:0 2px 4px rgba(0,0,0,.2)}.acu-crop-value{width:45px;text-align:right;font-size:12px;color:var(--acu-text-sub);font-family:monospace}.acu-crop-upload-section{display:flex;justify-content:center;padding-top:8px;border-top:1px solid var(--acu-border)}.acu-modal-footer{display:flex;justify-content:flex-end;gap:8px;padding:12px 16px;border-top:1px solid var(--acu-border)}@media (max-width:768px){.acu-avatar-manager-overlay.acu-modal-container{align-items:flex-start;padding-top:10vh;padding-left:16px;padding-right:16px}.acu-avatar-manager-dialog{width:95%;max-height:55vh;margin:0}.acu-avatar-manager-dialog .acu-modal-body{max-height:calc(55vh - 100px);overflow-y:auto}.acu-avatar-item{flex-wrap:wrap}.acu-avatar-name-row{flex-wrap:wrap}.acu-avatar-url-row{flex-wrap:wrap}.acu-crop-modal-overlay.acu-modal-container{align-items:flex-start;padding-top:10vh;padding-left:16px;padding-right:16px}.acu-crop-dialog{width:95%;max-height:55vh;margin:0;display:flex;flex-direction:column}.acu-crop-body{flex:1;overflow-y:auto;padding:10px !important;gap:10px}.acu-crop-preview{width:90px;height:90px}.acu-crop-controls{gap:10px}.acu-crop-control-row{gap:8px}.acu-crop-label{width:55px;font-size:12px}.acu-crop-upload-section{padding-top:8px}}.acu-dashboard-sort-modal{width:90%;max-width:450px;max-height:80vh;display:flex;flex-direction:column}.acu-dashboard-sort-modal .acu-modal-body{flex:1;overflow-y:auto;padding:0}.acu-sort-hint{color:var(--acu-text-sub);font-size:13px;padding:12px 16px;text-align:center;border-bottom:1px solid var(--acu-border);background:var(--acu-bg-panel)}.acu-feedback-success{animation:acu-success-flash .5s ease}@keyframes acu-success-flash{0%,100%{box-shadow:none}50%{box-shadow:0 0 0 3px rgba(46,204,113,.4)}}.acu-feedback-error{animation:acu-error-shake .4s ease}@keyframes acu-error-shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-5px)}40%,80%{transform:translateX(5px)}}.acu-feedback-warning{animation:acu-warning-pulse .6s ease}@keyframes acu-warning-pulse{0%,100%{box-shadow:none}50%{box-shadow:0 0 0 3px rgba(241,196,15,.4)}}.acu-ripple{position:relative;overflow:hidden}.acu-ripple::after{content:"";position:absolute;top:50%;left:50%;width:0;height:0;background:hsla(0,0%,100%,.3);border-radius:50%;transform:translate(-50%,-50%);opacity:0}.acu-ripple:active::after{width:200px;height:200px;opacity:0;transition:width .3s ease,height .3s ease,opacity .3s ease}.acu-dragging{opacity:.8;transform:scale(1.02);box-shadow:0 8px 24px rgba(0,0,0,.2);cursor:grabbing !important;z-index:1000}.acu-drag-over{background:rgba(var(--acu-title-color-rgb),0.1);border:2px dashed var(--acu-title-color)}.acu-saving{position:relative;pointer-events:none}.acu-saving::after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:hsla(0,0%,100%,.5);z-index:10}.acu-changed{position:relative}.acu-changed::before{content:"";position:absolute;top:4px;right:4px;width:8px;height:8px;background:var(--acu-title-color);border-radius:50%;animation:acu-pulse 1.5s infinite}.acu-new-item{animation:acu-new-highlight 1s ease}@keyframes acu-new-highlight{0%{background:rgba(var(--acu-title-color-rgb),0.3)}100%{background:rgba(0,0,0,0)}}.acu-delete-confirm{background:rgba(231,76,60,.1) !important;border-color:rgba(231,76,60,.3) !important}.acu-selected{background:rgba(var(--acu-title-color-rgb),0.1);border-color:var(--acu-title-color);box-shadow:0 0 0 2px rgba(var(--acu-title-color-rgb),0.2)}.acu-focused{outline:none;border-color:var(--acu-title-color);box-shadow:0 0 0 3px rgba(var(--acu-title-color-rgb),0.15)}.acu-disabled{opacity:.5;pointer-events:none;cursor:not-allowed}.acu-readonly{background:var(--acu-btn-bg);cursor:default}.acu-readonly input,.acu-readonly textarea,.acu-readonly select{pointer-events:none}.acu-skeleton{background:linear-gradient(90deg,var(--acu-btn-bg) 25%,var(--acu-btn-hover) 50%,var(--acu-btn-bg) 75%);background-size:200% 100%;animation:acu-skeleton-loading 1.5s infinite}@keyframes acu-skeleton-loading{0%{background-position:200% 0}100%{background-position:-200% 0}}.acu-data-updated{animation:acu-data-flash .8s ease}@keyframes acu-data-flash{0%,100%{background:rgba(0,0,0,0)}30%{background:rgba(var(--acu-title-color-rgb),0.3)}}.acu-tooltip{position:relative}.acu-tooltip::before{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translateX(-50%) translateY(-8px);padding:6px 12px;background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:8px;font-size:12px;color:var(--acu-text-main);white-space:nowrap;opacity:0;visibility:hidden;transition:all .2s ease;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:1000}.acu-tooltip:hover::before{opacity:1;visibility:visible;transform:translateX(-50%) translateY(-4px)}.acu-progress-indicator{position:relative}.acu-progress-indicator::after{content:"";position:absolute;bottom:0;left:0;height:3px;background:var(--acu-title-color);width:var(--progress,0%);transition:width .3s ease}.acu-hidden{display:none !important}.acu-invisible{visibility:hidden !important}.acu-sr-only{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0,0,0,0) !important;white-space:nowrap !important;border:0 !important}.acu-text-truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.acu-text-wrap{word-wrap:break-word;word-break:break-word}.acu-text-center{text-align:center}.acu-text-left{text-align:left}.acu-text-right{text-align:right}.acu-text-uppercase{text-transform:uppercase}.acu-text-lowercase{text-transform:lowercase}.acu-text-capitalize{text-transform:capitalize}.acu-text-main{color:var(--acu-text-main)}.acu-text-sub{color:var(--acu-text-sub)}.acu-text-highlight{color:var(--acu-title-color)}.acu-text-success{color:#27ae60}.acu-text-warning{color:#f39c12}.acu-text-danger{color:#e74c3c}.acu-text-info{color:#3498db}.acu-flex{display:flex}.acu-flex-inline{display:inline-flex}.acu-flex-row{flex-direction:row}.acu-flex-col{flex-direction:column}.acu-flex-wrap{flex-wrap:wrap}.acu-flex-nowrap{flex-wrap:nowrap}.acu-flex-1{flex:1}.acu-flex-auto{flex:auto}.acu-flex-none{flex:none}.acu-items-start{align-items:flex-start}.acu-items-center{align-items:center}.acu-items-end{align-items:flex-end}.acu-items-stretch{align-items:stretch}.acu-justify-start{justify-content:flex-start}.acu-justify-center{justify-content:center}.acu-justify-end{justify-content:flex-end}.acu-justify-between{justify-content:space-between}.acu-justify-around{justify-content:space-around}.acu-gap-0{gap:0px}.acu-m-0{margin:0px}.acu-mt-0{margin-top:0px}.acu-mr-0{margin-right:0px}.acu-mb-0{margin-bottom:0px}.acu-ml-0{margin-left:0px}.acu-mx-0{margin-left:0px;margin-right:0px}.acu-my-0{margin-top:0px;margin-bottom:0px}.acu-p-0{padding:0px}.acu-pt-0{padding-top:0px}.acu-pr-0{padding-right:0px}.acu-pb-0{padding-bottom:0px}.acu-pl-0{padding-left:0px}.acu-px-0{padding-left:0px;padding-right:0px}.acu-py-0{padding-top:0px;padding-bottom:0px}.acu-gap-1{gap:4px}.acu-m-1{margin:4px}.acu-mt-1{margin-top:4px}.acu-mr-1{margin-right:4px}.acu-mb-1{margin-bottom:4px}.acu-ml-1{margin-left:4px}.acu-mx-1{margin-left:4px;margin-right:4px}.acu-my-1{margin-top:4px;margin-bottom:4px}.acu-p-1{padding:4px}.acu-pt-1{padding-top:4px}.acu-pr-1{padding-right:4px}.acu-pb-1{padding-bottom:4px}.acu-pl-1{padding-left:4px}.acu-px-1{padding-left:4px;padding-right:4px}.acu-py-1{padding-top:4px;padding-bottom:4px}.acu-gap-2{gap:8px}.acu-m-2{margin:8px}.acu-mt-2{margin-top:8px}.acu-mr-2{margin-right:8px}.acu-mb-2{margin-bottom:8px}.acu-ml-2{margin-left:8px}.acu-mx-2{margin-left:8px;margin-right:8px}.acu-my-2{margin-top:8px;margin-bottom:8px}.acu-p-2{padding:8px}.acu-pt-2{padding-top:8px}.acu-pr-2{padding-right:8px}.acu-pb-2{padding-bottom:8px}.acu-pl-2{padding-left:8px}.acu-px-2{padding-left:8px;padding-right:8px}.acu-py-2{padding-top:8px;padding-bottom:8px}.acu-gap-3{gap:12px}.acu-m-3{margin:12px}.acu-mt-3{margin-top:12px}.acu-mr-3{margin-right:12px}.acu-mb-3{margin-bottom:12px}.acu-ml-3{margin-left:12px}.acu-mx-3{margin-left:12px;margin-right:12px}.acu-my-3{margin-top:12px;margin-bottom:12px}.acu-p-3{padding:12px}.acu-pt-3{padding-top:12px}.acu-pr-3{padding-right:12px}.acu-pb-3{padding-bottom:12px}.acu-pl-3{padding-left:12px}.acu-px-3{padding-left:12px;padding-right:12px}.acu-py-3{padding-top:12px;padding-bottom:12px}.acu-gap-4{gap:16px}.acu-m-4{margin:16px}.acu-mt-4{margin-top:16px}.acu-mr-4{margin-right:16px}.acu-mb-4{margin-bottom:16px}.acu-ml-4{margin-left:16px}.acu-mx-4{margin-left:16px;margin-right:16px}.acu-my-4{margin-top:16px;margin-bottom:16px}.acu-p-4{padding:16px}.acu-pt-4{padding-top:16px}.acu-pr-4{padding-right:16px}.acu-pb-4{padding-bottom:16px}.acu-pl-4{padding-left:16px}.acu-px-4{padding-left:16px;padding-right:16px}.acu-py-4{padding-top:16px;padding-bottom:16px}.acu-gap-5{gap:20px}.acu-m-5{margin:20px}.acu-mt-5{margin-top:20px}.acu-mr-5{margin-right:20px}.acu-mb-5{margin-bottom:20px}.acu-ml-5{margin-left:20px}.acu-mx-5{margin-left:20px;margin-right:20px}.acu-my-5{margin-top:20px;margin-bottom:20px}.acu-p-5{padding:20px}.acu-pt-5{padding-top:20px}.acu-pr-5{padding-right:20px}.acu-pb-5{padding-bottom:20px}.acu-pl-5{padding-left:20px}.acu-px-5{padding-left:20px;padding-right:20px}.acu-py-5{padding-top:20px;padding-bottom:20px}.acu-gap-6{gap:24px}.acu-m-6{margin:24px}.acu-mt-6{margin-top:24px}.acu-mr-6{margin-right:24px}.acu-mb-6{margin-bottom:24px}.acu-ml-6{margin-left:24px}.acu-mx-6{margin-left:24px;margin-right:24px}.acu-my-6{margin-top:24px;margin-bottom:24px}.acu-p-6{padding:24px}.acu-pt-6{padding-top:24px}.acu-pr-6{padding-right:24px}.acu-pb-6{padding-bottom:24px}.acu-pl-6{padding-left:24px}.acu-px-6{padding-left:24px;padding-right:24px}.acu-py-6{padding-top:24px;padding-bottom:24px}.acu-gap-7{gap:28px}.acu-m-7{margin:28px}.acu-mt-7{margin-top:28px}.acu-mr-7{margin-right:28px}.acu-mb-7{margin-bottom:28px}.acu-ml-7{margin-left:28px}.acu-mx-7{margin-left:28px;margin-right:28px}.acu-my-7{margin-top:28px;margin-bottom:28px}.acu-p-7{padding:28px}.acu-pt-7{padding-top:28px}.acu-pr-7{padding-right:28px}.acu-pb-7{padding-bottom:28px}.acu-pl-7{padding-left:28px}.acu-px-7{padding-left:28px;padding-right:28px}.acu-py-7{padding-top:28px;padding-bottom:28px}.acu-gap-8{gap:32px}.acu-m-8{margin:32px}.acu-mt-8{margin-top:32px}.acu-mr-8{margin-right:32px}.acu-mb-8{margin-bottom:32px}.acu-ml-8{margin-left:32px}.acu-mx-8{margin-left:32px;margin-right:32px}.acu-my-8{margin-top:32px;margin-bottom:32px}.acu-p-8{padding:32px}.acu-pt-8{padding-top:32px}.acu-pr-8{padding-right:32px}.acu-pb-8{padding-bottom:32px}.acu-pl-8{padding-left:32px}.acu-px-8{padding-left:32px;padding-right:32px}.acu-py-8{padding-top:32px;padding-bottom:32px}.acu-w-full{width:100%}.acu-h-full{height:100%}.acu-w-auto{width:auto}.acu-h-auto{height:auto}.acu-min-w-0{min-width:0}.acu-min-h-0{min-height:0}.acu-max-w-full{max-width:100%}.acu-max-h-full{max-height:100%}.acu-relative{position:relative}.acu-absolute{position:absolute}.acu-fixed{position:fixed}.acu-sticky{position:sticky}.acu-inset-0{top:0;right:0;bottom:0;left:0}.acu-overflow-auto{overflow:auto}.acu-overflow-hidden{overflow:hidden}.acu-overflow-scroll{overflow:scroll}.acu-overflow-x-auto{overflow-x:auto}.acu-overflow-y-auto{overflow-y:auto}.acu-overflow-x-hidden{overflow-x:hidden}.acu-overflow-y-hidden{overflow-y:hidden}.acu-scrollbar{scrollbar-width:thin;scrollbar-color:var(--acu-scrollbar-thumb) var(--acu-scrollbar-track)}.acu-scrollbar::-webkit-scrollbar{width:6px;height:6px}.acu-scrollbar::-webkit-scrollbar-track{background:var(--acu-scrollbar-track);border-radius:3px}.acu-scrollbar::-webkit-scrollbar-thumb{background:var(--acu-scrollbar-thumb);border-radius:3px}.acu-scrollbar::-webkit-scrollbar-thumb:hover{background:var(--acu-scrollbar-thumb-hover)}.acu-scrollbar-hidden{scrollbar-width:none;-ms-overflow-style:none}.acu-scrollbar-hidden::-webkit-scrollbar{display:none}.acu-rounded-none{border-radius:0}.acu-rounded-sm{border-radius:4px}.acu-rounded{border-radius:8px}.acu-rounded-lg{border-radius:12px}.acu-rounded-xl{border-radius:16px}.acu-rounded-full{border-radius:9999px}.acu-border{border:1px solid var(--acu-border)}.acu-border-t{border-top:1px solid var(--acu-border)}.acu-border-r{border-right:1px solid var(--acu-border)}.acu-border-b{border-bottom:1px solid var(--acu-border)}.acu-border-l{border-left:1px solid var(--acu-border)}.acu-border-none{border:none}.acu-shadow-none{box-shadow:none}.acu-shadow-sm{box-shadow:0 1px 2px rgba(0,0,0,.1)}.acu-shadow{box-shadow:0 2px 8px rgba(0,0,0,.15)}.acu-shadow-lg{box-shadow:0 8px 24px rgba(0,0,0,.2)}.acu-shadow-xl{box-shadow:0 16px 48px rgba(0,0,0,.25)}.acu-pointer-events-none{pointer-events:none}.acu-pointer-events-auto{pointer-events:auto}.acu-cursor-pointer{cursor:pointer}.acu-cursor-default{cursor:default}.acu-cursor-move{cursor:move}.acu-cursor-not-allowed{cursor:not-allowed}.acu-select-none{-webkit-user-select:none;user-select:none}.acu-select-text{-webkit-user-select:text;user-select:text}.acu-select-all{-webkit-user-select:all;user-select:all}.acu-transition{transition:all .2s ease}.acu-transition-fast{transition:all .1s ease}.acu-transition-slow{transition:all .3s ease}.acu-transition-none{transition:none}.acu-opacity-0{opacity:0}.acu-opacity-25{opacity:.25}.acu-opacity-50{opacity:.5}.acu-opacity-75{opacity:.75}.acu-opacity-100{opacity:1}',e.head.appendChild(r),n.value=r,console.info('[ACU Styles] Base styles injected')})(),u(),(()=>{const e=t(),a=`${Oe}-dynamic-${o.value}`;e.getElementById(a)?.remove();const n=e.createElement('style');n.id=a,n.setAttribute('data-source','acu-visualizer'),e.head.appendChild(n),r.value=n,console.info('[ACU Styles] Dynamic styles element created')})(),(()=>{const e=t(),a=`${Ge}-${o.value}`;e.getElementById(a)?.remove();const n=e.createElement('style');n.id=a,n.setAttribute('data-source','acu-visualizer-theme'),e.head.appendChild(n),c.value=n,console.info('[ACU Styles] Theme custom styles element created')})(),a.loadFromStorage(),d(),p(),s.value=!0,console.info('[ACU Styles] Style system initialized'))};return(0,l.watch)(()=>e.config,e=>{s.value&&(d(),m(e.theme),g(e.layout))},{deep:!0}),(0,l.watch)(()=>e.config.fontFamily,e=>{s.value&&b(e)}),(0,l.watch)([()=>a.currentThemeVars,()=>a.currentHighlight,()=>a.customCSS],()=>{s.value&&p()},{deep:!0}),(0,l.onMounted)(()=>{v()}),(0,l.onUnmounted)(()=>{f()}),{isInitialized:s,init:v,cleanup:f,updateDynamicVariables:d,updateThemeCustomStyles:p,applyTheme:m,applyLayout:g,applyFont:b,applyAllStyles:()=>{d(),p(),m(),g(),b()},baseStyleEl:n,dynamicStyleEl:r,fontStyleEl:i,themeCustomStyleEl:c}}const We='acu_locked_fields_v2_',qe={全局数据表:null,世界地图点:'详细地点',地图元素表:'元素名称',主角信息:'姓名',重要人物表:'姓名',技能表:'技能名称',物品表:'物品名称',装备表:'装备名称',任务表:'名称',总结表:'编码索引',总体大纲:'编码索引',重要情报:'情报名称',势力:'名称'};function Xe(){try{const e=window.SillyTavern?.getContext?.();if(e?.chatId)return e.chatId;if(e?.characterId&&e?.chat?.length>0)return`${e.characterId}_${e.chat.length}`}catch{}return'default'}function Ke(e){return We+(e||Xe())}const Je=(0,l.ref)({}),Qe=(0,l.ref)({});let Ze=null;function ea(){function e(){const e=Xe();if(Ze!==e){Ze=e;try{const a=localStorage.getItem(Ke(e));if(a){const e=JSON.parse(a);delete e._lastAccess,Je.value=e}else Je.value={}}catch{Je.value={}}}return Je.value}function a(){try{const e={...Je.value,_lastAccess:Date.now()};localStorage.setItem(Ke(),JSON.stringify(e)),function(){try{const e=[];for(let a=0;a<localStorage.length;a++){const t=localStorage.key(a);t?.startsWith(We)&&e.push(t)}if(e.length<=20)return;const a=e.map(e=>{try{const a=JSON.parse(localStorage.getItem(e)||'{}');return{key:e,time:a?._lastAccess||0}}catch{return{key:e,time:0}}});a.sort((e,a)=>a.time-e.time);const t=a.slice(20);t.forEach(e=>localStorage.removeItem(e.key)),t.length>0&&console.log(`[CellLock] 清理了 ${t.length} 个过期的锁定数据`)}catch(e){console.warn('[CellLock] 清理失败',e)}}()}catch(e){console.warn('[CellLock] 保存失败',e)}}function t(e,a,t,o){const n=qe[e];if(null===n)return'_row_0';let r=1;if(n){const e=t.indexOf(n);-1!==e&&(r=e)}const i=a[r];if(i)return`${n||t[r]}=${i}`;if(void 0!==o)return`_row_${o}`;for(let e=0;e<a.length;e++)if(a[e]&&0!==e)return`${t[e]||`col${e}`}=${a[e]}`;return null}function o(e,a){const t=a._fullRow?a._snapshot:a._fields;if(!t||0===Object.keys(t).length)return null;const o=new Array(e.length).fill(null);for(const[a,n]of Object.entries(t)){const t=e.indexOf(a);-1!==t&&(o[t]=n)}return o}const n=(0,l.computed)(()=>{let e=0;for(const a of Object.values(Qe.value))if('object'==typeof a)for(const t of Object.values(a))t._fullRow?e+=Object.keys(t._snapshot||{}).length:e+=Object.keys(t._fields||{}).length;return e});return{loadLocks:e,initPendingLocks:function(){e(),Qe.value=JSON.parse(JSON.stringify(Je.value))},getRowKey:t,pendingLocks:Qe,toggleCellLock:function(e,a,t,o){const n=JSON.parse(JSON.stringify(Qe.value));n[e]||(n[e]={}),n[e][a]||(n[e][a]={_fullRow:!1,_fields:{},_snapshot:null});const r=n[e][a];let i;return r._fullRow&&r._snapshot?void 0!==r._snapshot[t]?(delete r._snapshot[t],0===Object.keys(r._snapshot).length&&(r._fullRow=!1,r._snapshot=null),i=!1):(r._fields[t]=o,i=!0):void 0!==r._fields[t]?(delete r._fields[t],i=!1):(r._fields[t]=o,i=!0),r._fullRow||0!==Object.keys(r._fields).length||(delete n[e][a],0===Object.keys(n[e]).length&&delete n[e]),Qe.value=n,console.log('[CellLock] toggleCellLock:',e,a,t,'->',i,'count:',function(e){let a=0;for(const t of Object.values(e))if('object'==typeof t)for(const e of Object.values(t))e._fullRow?a+=Object.keys(e._snapshot||{}).length:a+=Object.keys(e._fields||{}).length;return a}(n)),i},toggleRowLock:function(e,a,t,o){const n=JSON.parse(JSON.stringify(Qe.value));n[e]||(n[e]={});const r=n[e]?.[a];if(r?._fullRow)return delete n[e][a],0===Object.keys(n[e]).length&&delete n[e],Qe.value=n,console.log('[CellLock] toggleRowLock: 解锁整行',e,a),!1;const i={};return t.forEach((e,a)=>{e&&null!=o[a]&&''!==o[a]&&(i[e]=o[a])}),n[e][a]={_fullRow:!0,_fields:{},_snapshot:i},Qe.value=n,console.log('[CellLock] toggleRowLock: 锁定整行',e,a,'fields:',Object.keys(i).length),!0},savePendingLocks:function(){Je.value=JSON.parse(JSON.stringify(Qe.value)),a()},discardPendingLocks:function(){Qe.value={}},isCellLockedPending:function(e,a,t){const o=Qe.value[e]?.[a];return!!o&&(o._fullRow?void 0!==o._snapshot?.[t]:void 0!==o._fields?.[t])},isRowLockedPending:function(e,a){return!0===Qe.value[e]?.[a]?._fullRow},getLockedFieldsPending:function(e,a){const t=Qe.value[e]?.[a];return t?t._fullRow?Object.keys(t._snapshot||{}):Object.keys(t._fields||{}):[]},hasRowAnyLockPending:function(e,a){const t=Qe.value[e]?.[a];return!!t&&(!!t._fullRow||Object.keys(t._fields||{}).length>0)},isCellLocked:function(a,t,o){e();const n=Je.value[a]?.[t];return!!n&&(n._fullRow?void 0!==n._snapshot?.[o]:void 0!==n._fields?.[o])},isRowLocked:function(a,t){return e(),!0===Je.value[a]?.[t]?._fullRow},applyLocks:function(a,n){e();const r=Je.value[a];if(!r||!n||n.length<2)return{modified:!1,restored:[]};const i=n[0],c=[];let l=!1;const s={};for(let e=1;e<n.length;e++){const o=t(a,n[e],i);o&&(s[o]=e)}for(const[e,a]of Object.entries(r)){const t=s[e];if(void 0===t){const t=o(i,a);t&&(n.push(t),c.push(e),l=!0);continue}const r=n[t],u=a._fullRow?a._snapshot:a._fields;if(u)for(const[e,a]of Object.entries(u)){const t=i.indexOf(e);-1!==t&&r[t]!==a&&(r[t]=a,l=!0)}}return{modified:l,restored:c}},updateLockedValue:function(t,o,n,r){e();const i=Je.value[t]?.[o];if(!i)return!1;let c=!1;return i._fullRow&&i._snapshot&&void 0!==i._snapshot[n]&&(i._snapshot[n]=r,c=!0),i._fields&&void 0!==i._fields[n]&&(i._fields[n]=r,c=!0),c&&(a(),console.log('[CellLock] updateLockedValue:',t,o,n,'->',r)),c},pendingLockCount:n}}const aa='row_snapshots';let ta=null;async function oa(){return ta||new Promise((e,a)=>{const t=indexedDB.open('acu_history_db',1);t.onerror=()=>{console.error('[ACU IndexedDB] 打开数据库失败:',t.error),a(t.error)},t.onsuccess=()=>{ta=t.result,console.info('[ACU IndexedDB] 数据库连接成功'),e(ta)},t.onupgradeneeded=e=>{const a=e.target.result;if(!a.objectStoreNames.contains(aa)){const e=a.createObjectStore(aa,{keyPath:'id',autoIncrement:!0});e.createIndex('by_chat_row',['chatId','rowKey'],{unique:!1}),e.createIndex('by_chat','chatId',{unique:!1}),e.createIndex('by_timestamp','timestamp',{unique:!1}),console.info('[ACU IndexedDB] 创建数据库表和索引成功')}}})}async function na(e){const a=await oa();return new Promise((t,o)=>{const n=a.transaction(aa,'readwrite').objectStore(aa).add(e);n.onsuccess=()=>{console.info('[ACU IndexedDB] 添加快照成功, ID:',n.result),t(n.result)},n.onerror=()=>{console.error('[ACU IndexedDB] 添加快照失败:',n.error),o(n.error)}})}async function ra(e,a){const t=await oa();return new Promise((o,n)=>{const r=t.transaction(aa,'readonly').objectStore(aa).index('by_chat_row').getAll([e,a]);r.onsuccess=()=>{o(r.result||[])},r.onerror=()=>{console.error('[ACU IndexedDB] 查询快照失败:',r.error),n(r.error)}})}async function ia(e){const a=await oa();return new Promise((t,o)=>{const n=a.transaction(aa,'readwrite').objectStore(aa).delete(e);n.onsuccess=()=>{console.info('[ACU IndexedDB] 删除快照成功, ID:',e),t()},n.onerror=()=>{console.error('[ACU IndexedDB] 删除快照失败:',n.error),o(n.error)}})}function ca(){try{const e=window.SillyTavern||window.parent?.SillyTavern||window.top?.SillyTavern;if(e?.getCurrentChatId){const a=e.getCurrentChatId();if(a)return a}if(e?.chat?.length>0){const a=e.chat[0];if(a?.chat_id)return a.chat_id}}catch(e){console.warn('[ACU History] 获取 chatId 失败:',e)}return'default'}function la(e,a){return`${e}-row-${a}`}function sa(e,a){const t=Object.keys(e).map(Number),o=Object.keys(a).map(Number);if(t.length!==o.length)return!1;for(const o of t)if(e[o]!==a[o])return!1;return!0}function ua(){const e=(0,l.ref)(!1);return{isLoading:e,saveSnapshot:async function(a,t,o,n){try{e.value=!0;const r=ca(),i=la(a,t),c=(await ra(r,i)).sort((e,a)=>a.timestamp-e.timestamp);if(c.length>0){if(sa(o,c[0].cells))return void console.info('[ACU History] 内容未变化，跳过记录')}if(await na({chatId:r,rowKey:i,timestamp:Date.now(),source:n,cells:o}),console.info(`[ACU History] 已记录 ${i} 的快照 (${n})`),c.length>=5){const e=c.slice(4);for(const a of e)void 0!==a.id&&await ia(a.id);console.info(`[ACU History] 清理旧快照 ${e.length} 条`)}}catch(e){console.error('[ACU History] 保存快照失败:',e)}finally{e.value=!1}},getSnapshots:async function(a,t){try{e.value=!0;const o=ca(),n=la(a,t);console.info('[ACU History] 查询快照, 参数:',{chatId:o,rowKey:n,tableName:a,rowIndex:t});const r=await ra(o,n);return console.info('[ACU History] 查询结果:',r.length,'条'),r.sort((e,a)=>a.timestamp-e.timestamp).slice(0,5)}catch(e){return console.error('[ACU History] 获取快照失败:',e),[]}finally{e.value=!1}},snapshotToTableRow:function(e,a){return{index:a.index,key:a.key,cells:a.cells.map((a,t)=>({...a,value:void 0!==e.cells[t]?e.cells[t]:a.value}))}},tableRowToCells:function(e){const a={};return e.cells.forEach((e,t)=>{a[t]=e.value}),a},getDiff:function(e,a){const t=new Set;for(const[o,n]of Object.entries(a)){const a=Number(o);e.cells[a]!==n&&t.add(a)}for(const o of Object.keys(e.cells)){const e=Number(o);void 0===a[e]&&t.add(e)}return t},formatRelativeTime:function(e){const a=Date.now()-e;return a<6e4?'刚刚':a<36e5?`${Math.floor(a/6e4)}分钟前`:a<864e5?`${Math.floor(a/36e5)}小时前`:a<1728e5?'昨天':new Date(e).toLocaleDateString('zh-CN',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'})},clearCurrentChatHistory:async function(){try{const e=ca();await async function(e){const a=await oa();return new Promise((t,o)=>{const n=a.transaction(aa,'readwrite'),r=n.objectStore(aa).index('by_chat').openCursor(IDBKeyRange.only(e));let i=0;r.onsuccess=e=>{const a=e.target.result;a&&(a.delete(),i++,a.continue())},n.oncomplete=()=>{console.info(`[ACU IndexedDB] 按聊天删除完成, 共删除 ${i} 条`),t()},n.onerror=()=>{console.error('[ACU IndexedDB] 按聊天删除失败:',n.error),o(n.error)}})}(e),console.info('[ACU History] 已清除当前聊天的历史记录')}catch(e){console.error('[ACU History] 清除历史失败:',e)}},getCurrentChatId:ca}}const da={indexColumnName:'编码索引',checkEmptyCell:!0,checkIndexGap:!0};function pa(e){if(!e||'string'!=typeof e)return!1;const a=e.toLowerCase();return a.includes('总结')||a.includes('大纲')||a.includes('summary')||a.includes('outline')}function ma(e){if(null==e)return null;const a=String(e).trim();if(''===a)return null;const t=a.match(/(\d+)/);return t?parseInt(t[1],10):null}function ga(e){const a=e.match(/^(.+)-row-\d+$/);if(a)return a[1];const t=e.match(/^(.+)-\d+-\d+$/);return t?t[1]:null}function ba(e){const a=e.match(/-row-(\d+)$/);if(a)return parseInt(a[1],10);const t=e.match(/-(\d+)-\d+$/);return t?parseInt(t[1],10):null}function fa(e,a,t,o,n){const r=a.name||e,i=[];if(!pa(r))return{sheetId:e,tableName:r,hasIssues:!1,issues:[]};if(!a.content||!Array.isArray(a.content)||a.content.length<2)return{sheetId:e,tableName:r,hasIssues:!1,issues:[]};const c=t?.content?.length||1,l=a.content.length;if(l<=c)return{sheetId:e,tableName:r,hasIssues:!1,issues:[]};const s=c,u=l-1;console.info(`[ACU IntegrityCheck] 表格 "${r}" 检测到新增行: 快照${c-1}行 → 当前${l-1}行, 新增行范围: 第${s}~${u}行(content索引)`);const d=a.content[0],p=d.findIndex(e=>String(e).trim()===n.indexColumnName);if(-1===p)return console.info(`[ACU IntegrityCheck] 表格 "${r}" 没有编码索引列，跳过检测`),{sheetId:e,tableName:r,hasIssues:!1,issues:[]};let m=null;if(t?.content&&t.content.length>1){m=ma(t.content[t.content.length-1][p])}for(let t=s;t<=u;t++){const o=a.content[t],c=t-1;if(n.checkEmptyCell)for(let a=0;a<d.length;a++){const n=o[a];''===(null!=n?String(n).trim():'')&&i.push({sheetId:e,tableName:r,rowIndex:c,colIndex:a,issueType:'empty_cell',description:`AI新增的第 ${t} 行，"${d[a]}" 列为空`,currentValue:''})}if(n.checkIndexGap){const n=ma(o[p]);if(t===s&&null!==m&&null!==n)n!==m+1&&i.push({sheetId:e,tableName:r,rowIndex:c,colIndex:p,issueType:'index_gap',description:`AI新增行索引从 ${m} 跳到 ${n}`,currentValue:String(o[p]??''),expectedValue:String(m+1)});else if(t>s){const l=t-1,s=ma(a.content[l][p]);null!==s&&null!==n&&n!==s+1&&i.push({sheetId:e,tableName:r,rowIndex:c,colIndex:p,issueType:'index_gap',description:`AI新增行之间索引从 ${s} 跳到 ${n}`,currentValue:String(o[p]??''),expectedValue:String(s+1)})}}}return{sheetId:e,tableName:r,hasIssues:i.length>0,issues:i}}const va='acu_data_snapshot_v18_5',ha='shujuku_v34_allSettings_v2';function xa(e){if(null==e)return'';const a=String(e).trim();return'null'===a||'undefined'===a?'':a}const wa=a('acu-data',()=>{const e=(0,l.ref)(null),a=(0,l.ref)({}),o=(0,l.ref)(null),n=(0,l.ref)(null),r=(0,l.reactive)(new Set),i=(0,l.reactive)(new Set),c=(0,l.computed)(()=>{const e=new Set;return r.forEach(a=>e.add(a)),i.forEach(a=>e.add(a)),e}),s=(0,l.reactive)(new Set),u=(0,l.ref)(!1),d=(0,l.ref)(!1),p=(0,l.ref)(null),m=function(e={}){const a={...da,...e},t=(0,l.ref)(new Map),o=(0,l.computed)(()=>{const e=[];return t.value.forEach(a=>{e.push(...a)}),e}),n=(0,l.computed)(()=>o.value.length>0),r=(0,l.computed)(()=>{const e=[];return t.value.forEach((a,t)=>{a.length>0&&e.push(t)}),e}),i=(0,l.computed)(()=>{let e=0,a=0;return o.value.forEach(t=>{'empty_cell'===t.issueType&&e++,'index_gap'===t.issueType&&a++}),{total:o.value.length,emptyCell:e,indexGap:a}});return{issuesByTable:t,allIssues:o,hasIssues:n,problematicTables:r,issueStats:i,checkIntegrity:function(e,r,i){const c=new Map;if(!e||!i||0===i.size)return void(t.value=c);const l=new Map;for(const e of i){const a=ga(e),t=ba(e);a&&null!==t&&(l.has(a)||l.set(a,new Set),l.get(a).add(t))}for(const t in e){if('mate'===t||'updated'===t||'created'===t||t.startsWith('_'))continue;const o=e[t];if(!o||!o.name)continue;const n=o.name,i=l.get(n);if(!i||0===i.size)continue;let s=null;if(r)for(const e in r)if(r[e]?.name===n){s=r[e];break}const u=fa(t,o,s,0,a);u.hasIssues&&(c.set(u.tableName,u.issues),console.warn(`[ACU IntegrityCheck] 表格 "${u.tableName}" 发现 ${u.issues.length} 个问题`))}t.value=c,n.value?console.warn(`[ACU IntegrityCheck] 共发现 ${o.value.length} 个完整性问题`):console.info('[ACU IntegrityCheck] AI填表完整性检测通过')},hasTableIssues:function(e){const a=t.value.get(e);return!!a&&a.length>0},getTableIssues:function(e){return t.value.get(e)||[]},clearIssues:function(){t.value=new Map},getSummaryText:function(){if(!n.value)return'所有表格完整性检测通过';const e=i.value,a=[];return e.emptyCell>0&&a.push(`${e.emptyCell} 个空值`),e.indexGap>0&&a.push(`${e.indexGap} 个索引断裂`),`发现 ${a.join('、')}，共 ${e.total} 个问题`},isSummaryOrOutlineTable:pa}}(),g=ea(),b=m.issuesByTable,f=m.hasIssues,v=m.problematicTables,h=m.issueStats,x=(0,l.computed)(()=>s.size>0),w=(0,l.computed)(()=>r.size>0||i.size>0||s.size>0),y=w,k=(0,l.computed)(()=>null!==n.value);function C(){try{const e=localStorage.getItem(va);return e?JSON.parse(e):null}catch{return null}}function N(e){try{o.value=t(e),localStorage.setItem(va,JSON.stringify(e))}catch(e){console.error('[ACU] Save snapshot failed:',e)}}function V(){try{localStorage.removeItem(va)}catch{}}function E(e,a){return`${e}-row-${a}`}function B(e,a,t){return`${e}-${a}-${t}`}function S(){let e=window.SillyTavern||(window.parent?window.parent.SillyTavern:null);return!e&&window.top&&window.top.SillyTavern&&(e=window.top.SillyTavern),e}function A(e,a,t){if(!o.value)return'';for(const n in o.value){const r=o.value[n];if(r&&r.name===e&&r.content){const e=r.content[a+1];if(e&&void 0!==e[t])return String(e[t])}}return''}function T(){if(!e.value)return;const o=t(e.value);for(const e in o){const t=o[e];if(!t||!t.name||!t.content)continue;const n=a.value[t.name];if(!n)continue;const r=t.content[0]||[],i=[r];for(const e of n){const a=[];for(let t=0;t<r.length;t++){const o=e.cells[t];a.push(o?o.value:'')}i.push(a)}t.content=i}e.value=o}function U(e=!1){r.clear(),i.clear(),e&&s.clear()}function D(e){const a={};for(const t in e){const o=e[t];if(!o?.name)continue;if(!o.content||!Array.isArray(o.content))continue;const n=o.name,r=o.content[0]||[],i=[];for(let e=1;e<o.content.length;e++){const a=o.content[e],t=[];for(let e=0;e<r.length;e++)t.push({key:String(r[e]||`col_${e}`),value:String(a[e]??'')});i.push({index:e-1,cells:t})}a[n]=i}return a}function I(e){if(0===s.size)return e;const a=t(e);for(const e in a){if('mate'===e)continue;const t=a[e];if(!t||!t.name||!t.content)continue;const o=[t.content[0]];for(let e=1;e<t.content.length;e++){const a=e-1,n=E(t.name,a);s.has(n)||o.push(t.content[e])}t.content=o}return a}async function M(e,a){const o=S();if(!o||!o.chat||!o.chat[e])throw new Error(`楼层 ${e} 不存在`);const n=o.chat[e];let r=function(){let e='';try{let a=window.localStorage;if(!a.getItem(ha)&&window.parent)try{a=window.parent.localStorage}catch{}const t=a.getItem(ha);if(t){const a=JSON.parse(t);a.dataIsolationEnabled&&a.dataIsolationCode&&(e=a.dataIsolationCode)}}catch{}return e}();if(n.TavernDB_ACU_IsolatedData){const e=Object.keys(n.TavernDB_ACU_IsolatedData);e.length>0&&(r=e[0])}else n.TavernDB_ACU_IsolatedData={};n.TavernDB_ACU_IsolatedData[r]||(n.TavernDB_ACU_IsolatedData[r]={independentData:{},modifiedKeys:[],updateGroupKeys:[]});const i=n.TavernDB_ACU_IsolatedData[r];i.independentData||(i.independentData={});const c=Object.keys(a).filter(e=>e.startsWith('sheet_'));c.forEach(e=>{i.independentData[e]=t(a[e])});const l=i.modifiedKeys||[];i.modifiedKeys=[...new Set([...l,...c])]}async function j(){const e=Pe().getDB();if(e&&e.syncWorldbookEntries)try{await e.syncWorldbookEntries({createIfNeeded:!0})}catch(e){console.warn('[ACU] Worldbook sync failed:',e)}}async function F(){const e=S();e?.saveChatDebounced?await e.saveChatDebounced():e?.saveChat&&await e.saveChat()}function P(e){s.has(e)?(s.delete(e),console.info(`[ACU] 取消删除标记: ${e}`)):(s.add(e),console.info(`[ACU] 添加删除标记: ${e}`))}function L(e){return i.has(e)?'manual':r.has(e)?'ai':null}function R(e,t,o){const n=E(e,t);if(i.has(n))return'manual';if(r.has(n))return'ai';if(s.has(n))return'manual';const c=a.value[e],l=o??(c?.[t]?.cells.length||0);let u=!1,d=!1;for(let a=0;a<l;a++){const o=B(e,t,a);i.has(o)&&(u=!0),r.has(o)&&(d=!0)}return u?'manual':d?'ai':null}return{stagedData:e,tables:a,snapshot:o,aiDiffMap:r,manualDiffMap:i,diffMap:c,pendingDeletes:s,isSaving:u,isLoading:d,targetFloorInfo:p,lastSavedData:n,hasPendingDeletes:x,hasUnsavedChanges:w,hasChanges:y,hasUndoData:k,getStagedData:function(){return e.value},loadFromDatabase:async function(){if(d.value)console.warn('[ACU] 加载进行中，跳过重复请求');else try{d.value=!0,console.info('[ACU] 开始加载数据...');const n=Le();if(!n)return void console.warn('[ACU] 未获取到表格数据');const c=t(n);let l=0;for(const e in c){const a=c[e];if(!a?.name||!a.content||!Array.isArray(a.content))continue;const t=g.applyLocks(a.name,a.content);t.modified&&(l+=t.restored.length,console.info(`[ACU] 表 "${a.name}" 应用了锁定保护，恢复了 ${t.restored.length} 项`))}l>0&&console.info(`[ACU] 共恢复 ${l} 个被 AI 修改的锁定值`),e.value=c;const u=D(c);a.value=u,o.value=t(c),r.clear(),i.clear(),s.clear(),N(c),m.checkIntegrity(c,null,new Set),console.info('[ACU] 数据加载完成，表格数量:',Object.keys(u).length)}catch(e){throw console.error('[ACU] 加载数据失败:',e),e}finally{d.value=!1}},processToTableData:D,setStagedData:function(o){e.value=t(o);const n=D(o);a.value=n,console.info('[ACU] 暂存数据已设置')},generateDiffMap:function(e){if(r.clear(),!o.value)return;const a=o.value;for(const t in e){if('mate'===t||'updated'===t||'created'===t||t.startsWith('_'))continue;const o=e[t],n=a[t];if(!o||!o.content)continue;const c=o.name||t.replace('sheet_','');if(!n||!n.content){for(let e=1;e<o.content.length;e++){const a=E(c,e-1);i.has(a)||r.add(a)}continue}const l=Math.max(o.content.length,n.content.length);for(let e=1;e<l;e++){const a=o.content[e],t=n.content[e],l=e-1;if(!a||!t){const e=E(c,l);if(i.has(e)||r.add(e),a&&!t)for(let e=0;e<a.length;e++){const a=B(c,l,e);i.has(a)||r.add(a)}continue}const s=Math.max(a.length,t.length);for(let e=0;e<s;e++){if(xa(a[e])!==xa(t[e])){const a=B(c,l,e);i.has(a)||r.add(a)}}}}console.info(`[ACU] AI差异映射已生成，AI变更: ${r.size}, 手动变更: ${i.size}`)},saveToDatabase:async function(){if(u.value)return console.warn('[ACU] 保存进行中，跳过重复请求'),{success:!1,savedToFloor:-1,error:'保存进行中'};try{u.value=!0,console.info('[ACU] 开始保存数据...');let a=e.value;if(a||(a=Le()),!a)throw new Error('无数据可保存');const n=I(t(a)),r=function(){const e=S();if(!e||!e.chat||0===e.chat.length)return-1;for(let a=e.chat.length-1;a>=0;a--){const t=e.chat[a];if(!t.is_user&&t.TavernDB_ACU_IsolatedData)return p.value={index:a,isAuto:!0,reason:'已存在数据'},a}for(let a=e.chat.length-1;a>=0;a--)if(!e.chat[a].is_user)return p.value={index:a,isAuto:!0,reason:'新建数据位置'},a;return-1}();if(-1===r)throw new Error('未找到合适的目标楼层');return await M(r,n),await j(),await F(),o.value=t(n),e.value=t(n),U(!0),N(n),console.info(`[ACU] 数据保存完成，目标楼层: ${r}`),{success:!0,savedToFloor:r}}catch(e){const a=e.message;return console.error('[ACU] 保存数据失败:',e),{success:!1,savedToFloor:-1,error:a}}finally{u.value=!1}},saveToFloor:async function(a){if(u.value)return console.warn('[ACU] 保存进行中，跳过重复请求'),{success:!1,savedToFloor:-1,error:'保存进行中'};try{u.value=!0,console.info(`[ACU] 保存到第 ${a} 楼...`);let n=e.value;if(n||(n=Le()),!n)throw new Error('无数据可保存');const r=I(t(n));return await M(a,r),await j(),await F(),o.value=t(r),e.value=t(r),U(!0),N(r),console.info(`[ACU] 已保存到第 ${a} 楼`),{success:!0,savedToFloor:a}}catch(e){const a=e.message;return console.error('[ACU] 保存到指定楼层失败:',e),{success:!1,savedToFloor:-1,error:a}}finally{u.value=!1}},purgeFloorRange:async function(e,a){if(u.value)console.warn('[ACU] 操作进行中，跳过重复请求');else try{u.value=!0,console.info(`[ACU] 清除第 ${e} 到 ${a} 楼的数据...`);const t=S();if(!t||!t.chat)throw new Error('无法访问聊天记录');const o=t.chat.length-1,n=Math.max(0,e),r=Math.min(o,a);if(isNaN(n)||isNaN(r)||n>r)throw new Error('无效的楼层范围');const i=['TavernDB_ACU_Data','TavernDB_ACU_SummaryData','TavernDB_ACU_IndependentData','TavernDB_ACU_Identity','TavernDB_ACU_IsolatedData','TavernDB_ACU_ModifiedKeys','TavernDB_ACU_UpdateGroupKeys'];let c=0;for(let e=n;e<=r;e++){const a=t.chat[e];if(!a)continue;let o=!1;for(const e of i)Object.prototype.hasOwnProperty.call(a,e)&&(delete a[e],o=!0);o&&c++}c>0&&(await F(),V(),U(!0),await j()),console.info(`[ACU] 已清除 ${c} 个楼层的数据`)}catch(e){throw console.error('[ACU] 清除楼层数据失败:',e),e}finally{u.value=!1}},insertRow:function(e,t){const o=a.value[e];if(!o||0===o.length)return void console.warn(`[ACU] 表格 ${e} 不存在或为空`);const n=o[0],r={index:o.length,cells:n.cells.map(e=>({key:e.key,value:''}))};o.splice(t+1,0,r),o.forEach((e,a)=>{e.index=a});const c=E(e,t+1);i.add(c),T(),console.info(`[ACU] 在 ${e} 第 ${t} 行后插入新行`)},updateCell:function(e,t,o,n,c){const l=a.value[e];if(!l||!l[t])return void console.warn(`[ACU] 无效的单元格位置: ${e}[${t}][${o}]`);const s=l[t];if(s.cells[o]){const a=s.cells[o].value;s.cells[o].value=n;const l=B(e,t,o);if(n!==A(e,t,o)){if(i.add(l),r.delete(l),!c?.skipHistory){const r=function(){const e=S();if(e?.getCurrentChatId){const a=e.getCurrentChatId();if(a)return a}return e?.chat_metadata?.chat_id?String(e.chat_metadata.chat_id):e?.chat?.length>0&&e.chat[0]?.chat_id?e.chat[0].chat_id:'default'}();if(console.info('[ACU] 保存历史记录, 参数:',{chatId:r,tableId:e,rowIndex:t,colIndex:o,oldValue:a.substring(0,50)+(a.length>50?'...':''),newValue:n.substring(0,50)+(n.length>50?'...':'')}),r){const n={index:t,key:E(e,t),cells:s.cells.map((e,t)=>({colIndex:t,key:e.key,value:t===o?a:e.value}))};(async function(e,a,t,o){try{const n=la(a,t.index),r={};t.cells.forEach((e,a)=>{r[a]=String(e.value)});const i=(await ra(e,n)).sort((e,a)=>a.timestamp-e.timestamp);if(i.length>0){const e=i[0];if(sa(r,e.cells))return void console.info('[ACU History] 内容未变化，跳过记录')}if(await na({chatId:e,rowKey:n,timestamp:Date.now(),source:o,cells:r}),console.info(`[ACU History] 已记录 ${n} 的快照 (${o})`),i.length>=5){const e=i.slice(4);for(const a of e)void 0!==a.id&&await ia(a.id);console.info(`[ACU History] 清理旧快照 ${e.length} 条`)}}catch(e){console.error('[ACU History] 保存快照失败:',e)}})(r,e,n,'manual').then(()=>{console.info('[ACU] 历史记录保存成功')}).catch(e=>{console.warn('[ACU] 历史记录保存失败:',e)})}else console.warn('[ACU] 无法获取 chatId，跳过历史记录保存')}}else{i.delete(l),r.delete(l);s.cells.every((a,o)=>a.value===A(e,t,o))&&s.cells.forEach((_,a)=>{const o=B(e,t,a);i.delete(o),r.delete(o)})}T(),console.info(`[ACU] 更新 ${e}[${t}][${o}]: "${a}" -> "${n}"`)}},toggleDelete:P,toggleDeleteRow:function(e,a){P(E(e,a))},markForDelete:function(e,a){const t=E(e,a);s.add(t)},unmarkForDelete:function(e,a){const t=E(e,a);s.delete(t)},getCellChangeType:L,getRowChangeType:R,hasTableAiChanges:function(e){for(const a of r)if(a.startsWith(`${e}-`))return!0;return!1},getTablesWithAiChanges:function(){const e=new Set;for(const a of r){const t=a.split('-');if(t.length>=2){const a=[];for(let e=0;e<t.length&&('row'!==t[e]&&!/^\d+$/.test(t[e]));e++)a.push(t[e]);a.length>0&&e.add(a.join('-'))}}return Array.from(e)},isRowChanged:function(e,a,t){return null!==R(e,a,t)},isRowPendingDelete:function(e,a){return s.has(E(e,a))},isPendingDelete:function(e){return s.has(e)},isCellChanged:function(e){return null!==L(e)},getRowKey:E,getCellKey:B,clearChanges:U,syncToStagedData:T,loadSnapshot:C,saveSnapshot:N,clearSnapshot:V,saveLastState:function(){const e=o.value||C();e?(n.value=t(e),console.info('[ACU] 已保存当前快照到撤回缓存')):console.warn('[ACU] 无快照数据可保存到撤回缓存')},undoToLastSave:function(){if(!n.value)return console.warn('[ACU] 无可撤回的数据'),!1;const c=t(n.value);e.value=c;const l=D(c);a.value=l,r.clear(),s.clear();const u=[];if(o.value)for(const e in c){if('mate'===e||'updated'===e||'created'===e||e.startsWith('_'))continue;const a=c[e],t=o.value[e];if(!a?.content)continue;const n=a.name||e.replace('sheet_','');if(!t?.content){for(let e=1;e<a.content.length;e++){const a=E(n,e-1);u.push(a)}continue}const r=Math.max(a.content.length,t.content.length);for(let e=1;e<r;e++){const o=a.content[e],r=t.content[e],i=e-1;if(!o||!r){const e=E(n,i);u.push(e);continue}const c=Math.max(o.length,r.length);for(let e=0;e<c;e++){if(String(o[e]??'')!==String(r[e]??'')){const a=B(n,i,e);u.push(a)}}}}return i.clear(),u.forEach(e=>i.add(e)),i.add('__undo_pending__'),console.info(`[ACU] 撤回后差异: 手动变更 ${i.size} 项`),console.info('[ACU] 已撤回到上次保存前的状态（需手动保存）'),!0},clearUndoCache:function(){n.value=null,console.info('[ACU] 已清除撤回缓存')},getUndoData:function(){return n.value?t(n.value):null},integrityIssues:b,hasIntegrityIssues:f,problematicTables:v,integrityStats:h,checkIntegrity:e=>{m.checkIntegrity(e,o.value,r)},hasTableIssues:m.hasTableIssues,getTableIssues:m.getTableIssues,getIntegritySummary:m.getSummaryText,clearIntegrityIssues:m.clearIssues,isSummaryOrOutlineTable:pa}}),ya='acu_ui_collapse_state',ka='acu_pin_state',Ca='acu_active_tab',Na='acu_table_order',Va='acu_table_heights',Ea='acu_table_styles',za='acu_reverse_tables',Ba='acu_float_ball_pos',Sa='acu_layout',Aa='acu_visible_tabs',Ta='acu_tab_order',Ua='acu_tab_dashboard_home',Da='acu_tab_options_panel',Ia='acu_tab_relationship_graph',Ma=a('acu-ui',()=>{const e=K(ya,!1),a=K(ka,!1),t=K(Ca,null),o=K(Na,[]),n=K(Va,{}),r=K(Ea,{}),i=K(za,[]),c=K(Ba,{x:20,y:'undefined'!=typeof window?window.innerHeight-150:500}),s=K(Sa,'horizontal'),u=K(Aa,[]),d=K(Ta,[]),p=(0,l.ref)(1),m=(0,l.ref)(''),g=(0,l.ref)(0),b=(0,l.ref)(!1),f=(0,l.ref)(!1),v=(0,l.ref)(!1),h=(0,l.ref)(!1),x=(0,l.ref)(!1),w=(0,l.ref)(!1),y=(0,l.computed)(()=>!e.value&&null!==t.value),k=(0,l.computed)(()=>t.value===Ua),C=(0,l.computed)(()=>t.value===Da);const N=(0,l.computed)(()=>m.value);const V=(0,l.computed)(()=>'horizontal'===s.value);function E(e){if(!d.value||0===d.value.length)return e;return[...d.value.filter(a=>e.includes(a)),...e.filter(e=>!d.value.includes(e))]}return{isCollapsed:e,isPinned:a,activeTab:t,tableOrder:o,tableHeights:n,tableStyles:r,reverseTables:i,ballPosition:c,layout:s,visibleTabs:u,currentPage:p,searchTerm:m,currentSearchTerm:N,scrollTop:g,isEditingOrder:b,isInitialized:f,isContentHidden:v,isMobile:h,isLockEditMode:x,showLockedOnly:w,isPanelVisible:y,isDashboardActive:k,isOptionsActive:C,reverseOrderTables:i,isHorizontalLayout:V,toggleCollapse:function(){e.value=!e.value},togglePin:function(){a.value=!a.value},setActiveTab:function(e){t.value=e,p.value=1,m.value=''},setTableOrder:function(e){o.value=e},setTableHeight:function(e,a){n.value={...n.value,[e]:a}},resetTableHeight:function(e){const a={...n.value};delete a[e],n.value=a},getTableHeight:function(e){return n.value[e]},setTableStyle:function(e,a){r.value={...r.value,[e]:a}},getTableStyle:function(e){return r.value[e]||'list'},toggleTableReverse:function(e){const a=[...i.value],t=a.indexOf(e);t>-1?a.splice(t,1):a.push(e),i.value=a},isTableReversed:function(e){return i.value.includes(e)},setCurrentPage:function(e){p.value=Math.max(1,e)},setSearchTerm:function(e){m.value=e.toLowerCase(),p.value=1},saveScrollTop:function(e){g.value=e},enterEditingOrder:function(){b.value=!0},exitEditingOrder:function(){b.value=!1},setEditingOrder:function(e){b.value=e},setMobile:function(e){h.value=e},setLayout:function(e){s.value=e},toggleLayout:function(){s.value='horizontal'===s.value?'vertical':'horizontal'},closePanel:function(){e.value=!0,v.value=!1},openPanel:function(){v.value=!1,e.value=!1,null===t.value&&(t.value=Ua)},setInitialized:function(e){f.value=e},updateSaveBtnState:function(){const{$}=window.jQuery?{$:window.jQuery}:{$:window.parent.$};if(!$)return;const e=wa().hasUnsavedChanges,a=$(window.parent.document).find('#acu-btn-save-global');a.length&&(e?(a.addClass('acu-has-changes'),a.find('i').addClass('fa-beat-fade'),a.css('color','#e67e22')):(a.removeClass('acu-has-changes'),a.find('i').removeClass('fa-beat-fade'),a.css('color','')))},autoFitPanelHeight:function(e=!1){const{$}=window.jQuery?{$:window.jQuery}:{$:window.parent.$};if(!$)return;const a=$(window.parent.document).find('#acu-data-area');if(!a.length)return;const o=t.value;!e&&o&&n.value[o]||setTimeout(()=>{const e=a[0].scrollHeight,t=($(window.parent).height()||800)-200;let o=Math.min(e+20,t);o<200&&(o=200),a.css('height',o+'px')},100)},saveBallPosition:function(e){c.value=e},getBallPosition:function(){return c.value},resetBallPosition:function(){const e='undefined'!=typeof window?window.parent?.innerHeight??window.innerHeight:500;c.value={x:20,y:Math.max(100,e-150)}},setVisibleTabs:function(e){u.value=e},isTabVisible:function(e){return 0===u.value.length||u.value.includes(e)},toggleTabVisibility:function(e){const a=[...u.value],t=a.indexOf(e);t>-1?a.splice(t,1):a.push(e),u.value=a},resetVisibleTabs:function(){u.value=[]},tabOrder:d,setTabOrder:function(e){d.value=e},getSortedTabIds:E,moveTab:function(e,a,t){const o=E(t),n=o.indexOf(e);if(-1===n)return;const r=[...o];r.splice(n,1),r.splice(a,0,e),d.value=r},showTab:function(e){u.value.includes(e)||(u.value=[...u.value,e])},hideTab:function(e){u.value=u.value.filter(a=>a!==e)},resetTabConfig:function(){u.value=[],d.value=[]},syncNewTablesToVisibleTabs:function(e){if(0===u.value.length)return[];const a=e.filter(e=>!u.value.includes(e));return a.length>0&&(u.value=[...u.value,...a],console.info(`[ACU] 检测到 ${a.length} 个新表格，已自动添加到可见列表:`,a)),a}}});function _a(){const e='shujuku_v80_allSettings_v2';if(localStorage.getItem(e))return e;const a='shujuku_v70_allSettings_v2';if(localStorage.getItem(a))return a;return Object.keys(localStorage||{}).find(e=>/^shujuku_.*_allSettings_v2$/.test(e))||e}function $a(){try{const e=_a(),a=localStorage.getItem(e);return a?JSON.parse(a):{}}catch(e){return console.warn('[ACU] 读取 localStorage 设置失败:',e),{}}}function ja(e){try{const a=_a(),t=$a();localStorage.setItem(a,JSON.stringify({...t,...e}))}catch(e){console.warn('[ACU] 写入 localStorage 设置失败:',e)}}function Fa(){const e=(0,l.ref)({}),a=(0,l.ref)(!1),t=(0,l.ref)(!1);async function o(a){try{const t=Pe().getDB(),o={...e.value,...a};return t&&'function'==typeof t.updateSettings?(await t.updateSettings(o),e.value=o,console.info('[ACU] 通过 API 保存设置成功'),!0):(ja(o),e.value=o,console.info('[ACU] 通过 localStorage 保存设置'),!0)}catch(t){console.error('[ACU] 保存设置失败:',t);try{return ja({...e.value,...a}),e.value={...e.value,...a},!0}catch{return!1}}}async function n(){try{const e=Pe().getDB();if(!e)return console.warn('[ACU] 数据库 API 不可用'),!1;if('function'==typeof e.manualUpdate)return await e.manualUpdate(),console.info('[ACU] 手动更新执行成功 (manualUpdate)'),!0;if('function'==typeof e.triggerUpdate){const a=await e.triggerUpdate();return console.info('[ACU] 手动更新执行成功 (triggerUpdate):',a),!!a}return console.warn('[ACU] 没有可用的更新方法'),!1}catch(e){return console.error('[ACU] 手动更新失败:',e),!1}}return{settings:e,isLoading:a,isInitialized:t,loadSettings:async function(){a.value=!0;try{const a=Pe().getDB();if(a&&'function'==typeof a.getSettings){const t=await a.getSettings();if(t&&'object'==typeof t)return e.value=t,console.info('[ACU] 从 API 读取设置成功'),t}const t=$a();return e.value=t,console.info('[ACU] 从 localStorage 读取设置'),t}catch(a){console.error('[ACU] 读取设置失败:',a);const t=$a();return e.value=t,t}finally{a.value=!1,t.value=!0}},saveSettings:o,updateSetting:async function(e,a){await o({[e]:a})},executeManualUpdate:n,getTableList:function(){try{const e=Pe().getDB();if(!e)return console.warn('[ACU] 数据库 API 不可用'),[];if('function'==typeof e.getTableList){const a=e.getTableList();return console.info('[ACU] 获取表格列表成功:',a?.length||0),a||[]}if('function'==typeof e.exportTableAsJson){const a=e.exportTableAsJson();if(a&&'object'==typeof a){const e=[];return Object.keys(a).forEach(t=>{if(!t.startsWith('sheet_'))return;const o=a[t],n=o?.name||t,r=n.includes('总结')||n.includes('大纲')||n.toLowerCase().includes('summary')||n.toLowerCase().includes('outline');e.push({key:t,name:n,isSummaryOrOutline:r})}),console.info('[ACU] 从 exportTableAsJson 解析表格列表:',e.length),e}}return console.warn('[ACU] 无法获取表格列表'),[]}catch(e){return console.error('[ACU] 获取表格列表失败:',e),[]}},executeWithPreset:async function(e,a=[],t=!1){try{const r=Pe().getDB();if(!r)return{success:!1,message:'数据库 API 不可用'};if('function'==typeof r.executeWithPreset){const o=await r.executeWithPreset({settings:{autoUpdateThreshold:e.autoUpdateThreshold,updateBatchSize:e.updateBatchSize,skipUpdateFloors:e.skipUpdateFloors,autoUpdateFrequency:e.autoUpdateFrequency},targetTableNames:a.length>0?a:null,silent:t});return console.info('[ACU] executeWithPreset 结果:',o),o}console.info('[ACU] 回退到旧方式: saveSettings + executeManualUpdate'),await o(e);const i=await n();return{success:i,message:i?'更新成功':'更新失败'}}catch(e){return console.error('[ACU] 预设执行失败:',e),{success:!1,message:String(e)}}},findDatabaseSettingsKey:_a}}var Pa=c(99);const La=z,Ra=La.z.object({autoUpdateThreshold:La.z.number().min(1).max(500).default(3),updateBatchSize:La.z.number().min(1).max(50).default(3),skipUpdateFloors:La.z.number().min(0).max(20).default(0),autoUpdateFrequency:La.z.number().min(1).max(100).default(1)}),Oa=La.z.object({enabled:La.z.boolean().default(!1),onEmptyCell:La.z.boolean().default(!0),onIndexGap:La.z.boolean().default(!0),targetTables:La.z.array(La.z.string()).default(['总结表','大纲表']),updateTargetTables:La.z.array(La.z.string()).default([])}),Ha=La.z.object({id:La.z.string(),name:La.z.string().min(1).max(50),createdAt:La.z.number(),settings:Ra,autoTrigger:Oa.optional().transform(e=>Oa.parse(e??{}))}),Ga=La.z.object({presets:La.z.array(Ha).default([]),activePresetId:La.z.string().nullable().default(null),autoFixPresetId:La.z.string().nullable().default(null),globalAutoTriggerEnabled:La.z.boolean().default(!1),globalAutoExecuteEnabled:La.z.boolean().default(!1)}),Ya='acu-visualizer',Wa='updatePresets',qa={autoUpdateThreshold:3,updateBatchSize:3,skipUpdateFloors:0,autoUpdateFrequency:1},Xa={enabled:!1,onEmptyCell:!0,onIndexGap:!0,targetTables:['总结表','大纲表'],updateTargetTables:[]};function Ka(){try{if('function'==typeof getVariables)return getVariables({type:'script',script_id:Ya})||{}}catch(e){console.warn('[ACU Presets] getVariables 不可用，使用 localStorage 回退')}try{const e=localStorage.getItem(`acu_${Wa}`);return e?JSON.parse(e):{}}catch{return{}}}function Ja(){const e=(0,l.ref)({presets:[],activePresetId:null,autoFixPresetId:null,globalAutoTriggerEnabled:!1,globalAutoExecuteEnabled:!1}),a=(0,l.ref)(!1),o=(0,l.computed)(()=>e.value.presets),n=(0,l.computed)(()=>{const a=e.value.activePresetId;return a&&e.value.presets.find(e=>e.id===a)||null}),r=(0,l.computed)(()=>{const a=e.value.autoFixPresetId;return a&&e.value.presets.find(e=>e.id===a)||null}),i=(0,l.computed)(()=>e.value.presets.length>0);function c(){try{const t=Ka()[Wa];if(t){const a=Ga.safeParse(t);a.success?(e.value=a.data,console.info('[ACU Presets] 加载预设成功，数量:',a.data.presets.length)):(console.warn('[ACU Presets] 预设数据格式无效，使用默认值'),e.value=Ga.parse({}))}else e.value=Ga.parse({});a.value=!0}catch(t){console.error('[ACU Presets] 加载预设失败:',t),e.value=Ga.parse({}),a.value=!0}}function s(){try{const a=Ka();a[Wa]=t(e.value),function(e){try{if('function'==typeof replaceVariables)return void replaceVariables(t(e),{type:'script',script_id:Ya})}catch(e){console.warn('[ACU Presets] replaceVariables 不可用，使用 localStorage 回退')}try{localStorage.setItem(`acu_${Wa}`,JSON.stringify(e))}catch(e){console.error('[ACU Presets] 保存到 localStorage 失败:',e)}}(a),console.info('[ACU Presets] 保存预设成功')}catch(e){console.error('[ACU Presets] 保存预设失败:',e)}}function u(a){const t=a.trim();return e.value.presets.find(e=>e.name.trim()===t)||null}function d(a,t={},o={}){const n={id:`preset_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:a,createdAt:Date.now(),settings:Ra.parse({...qa,...t}),autoTrigger:Oa.parse({...Xa,...o})};return e.value.presets.push(n),s(),console.info('[ACU Presets] 创建预设:',n.name),n}function p(a,t){const o=e.value.presets.findIndex(e=>e.id===a);if(-1===o)return console.warn('[ACU Presets] 预设不存在:',a),!1;const n=e.value.presets[o];return void 0!==t.name&&(n.name=t.name),void 0!==t.settings&&(n.settings=Ra.parse({...n.settings,...t.settings})),void 0!==t.autoTrigger&&(n.autoTrigger=Oa.parse({...n.autoTrigger,...t.autoTrigger})),s(),console.info('[ACU Presets] 更新预设:',n.name),!0}const m=(0,l.computed)(()=>e.value.globalAutoTriggerEnabled),g=(0,l.computed)(()=>e.value.globalAutoExecuteEnabled);return a.value||c(),{storage:e,presets:o,activePreset:n,autoFixPreset:r,hasPresets:i,isLoaded:a,globalAutoTriggerEnabled:m,globalAutoExecuteEnabled:g,loadPresets:c,savePresets:s,createPreset:d,createOrUpdatePreset:function(e,a={},t={}){const o=u(e);return o?(p(o.id,{settings:Ra.parse({...qa,...a}),autoTrigger:Oa.parse({...Xa,...t})}),console.info('[ACU Presets] 更新预设:',e),{preset:o,isNew:!1}):{preset:d(e,a,t),isNew:!0}},findPresetByName:u,updatePreset:p,deletePreset:function(a){const t=e.value.presets.findIndex(e=>e.id===a);if(-1===t)return console.warn('[ACU Presets] 预设不存在:',a),!1;const o=e.value.presets[t];return e.value.presets.splice(t,1),e.value.activePresetId===a&&(e.value.activePresetId=null),e.value.autoFixPresetId===a&&(e.value.autoFixPresetId=null),s(),console.info('[ACU Presets] 删除预设:',o.name),!0},setActivePreset:function(a){e.value.activePresetId=a,s()},setAutoFixPreset:function(a){e.value.autoFixPresetId=a,s()},duplicatePreset:function(a,o){const n=e.value.presets.find(e=>e.id===a);return n?d(o||`${n.name} (副本)`,t(n.settings),t(n.autoTrigger)):(console.warn('[ACU Presets] 源预设不存在:',a),null)},createFromCurrent:function(e,a){return d(e,a)},getPresetSettings:function(a){const o=e.value.presets.find(e=>e.id===a);return o?t(o.settings):null},setGlobalAutoTrigger:function(a){e.value.globalAutoTriggerEnabled=a,a||(e.value.globalAutoExecuteEnabled=!1),s(),console.info('[ACU Presets] 全局问题检测提示:',a)},setGlobalAutoExecute:function(a){e.value.globalAutoExecuteEnabled=a,s(),console.info('[ACU Presets] 全局自动执行修复:',a)},UpdateSettingsSchema:Ra,AutoTriggerConfigSchema:Oa,UpdatePresetSchema:Ha}}let Qa=null,Za=null,et=!1;function at(){const e=wa(),a=Ma(),t=Ja(),o=Fa();let n=0;let r=!1;function i(){const{getDB:t}=Pe(),o=t();o?(et=!1,o.registerTableUpdateCallback&&(Qa=()=>{if(et)return;if(a.isEditingOrder||e.isSaving)return;const t=Le();if(t){e.setStagedData(t);const o=Object.keys(t).filter(e=>e.startsWith('sheet_'));a.syncNewTablesToVisibleTabs(o),e.generateDiffMap(t),e.checkIntegrity(t),s()}},o.registerTableUpdateCallback(Qa),console.info('[ACU] 已注册表格更新回调')),o.registerTableFillStartCallback&&(Za=()=>{if(et)return;if(e.saveLastState(),e.diffMap&&e.diffMap.size>0)return void console.info('[ACU] 累积高亮：保留旧快照');const a=Le();a&&Object.keys(a).length>0&&(e.saveSnapshot(a),console.info('[ACU] 快照已更新'))},o.registerTableFillStartCallback(Za),console.info('[ACU] 已注册表格填充回调 (高亮逻辑)'))):console.warn('[ACU] 数据库 API 未就绪，跳过回调注册')}function c(){et=!0;const{getDB:e}=Pe(),a=e();if(a)try{a.registerTableUpdateCallback&&Qa&&('function'==typeof a.unregisterTableUpdateCallback&&a.unregisterTableUpdateCallback(Qa),Qa=null,console.info('[ACU] 已注销表格更新回调')),a.registerTableFillStartCallback&&Za&&('function'==typeof a.unregisterTableFillStartCallback&&a.unregisterTableFillStartCallback(Za),Za=null,console.info('[ACU] 已注销表格填充回调'))}catch(e){console.warn('[ACU] 注销回调时出错:',e)}}async function s(){if(!e.hasIntegrityIssues)return;const a=Date.now();if(a-n<3e4)return;if(r)return;const i=t.autoFixPreset.value;if(i&&i.autoTrigger.enabled){let t=!1;const c=e.problematicTables;if(c&&c.length>0&&(t=!0),t){n=a;const t=e.getIntegritySummary();r=!0,Pa.toast.info(`🔧 检测到问题：${t}，正在自动修复...`),console.info('[ACU] 自动触发修复:',t);try{const e=i.autoTrigger.updateTargetTables||[],a=await o.executeWithPreset({autoUpdateThreshold:i.settings.autoUpdateThreshold,autoUpdateFrequency:i.settings.autoUpdateFrequency,updateBatchSize:i.settings.updateBatchSize,skipUpdateFloors:i.settings.skipUpdateFloors},e);a.success?Pa.toast.success('✅ 自动修复已完成'):Pa.toast.warning('⚠️ 自动修复失败：'+(a.message||'请手动更新'))}catch(e){console.error('[ACU] 自动修复失败:',e),Pa.toast.error('❌ 自动修复出错')}finally{r=!1}}}}return(0,l.onMounted)(()=>{i()}),(0,l.onUnmounted)(()=>{c()}),{registerCallbacks:i,unregisterCallbacks:c,checkAndNotifyIssues:s}}function tt(e){const a=Object.keys(e),t=a.find(e=>e.match(/^shujuku_v\d+_allSettings_v2$/)&&parseInt(e.match(/v(\d+)/)?.[1]||'0')>=100);if(t)return t;const o=a.find(e=>e.match(/^shujuku_v\d+_allSettings_v2$/));return o||null}const ot='TavernDB_ACU_InternalSheetGuide',nt='orderNo';const rt=['acu_table_order','acu_reverse_tables','acu_table_heights','acu_active_tab','acu_ui_collapse','acu_pin','acu_table_styles','acu_win_config'];function it(){const e=wa(),a=se();async function o(a,o,r=-1){const i=t(a);if(o&&e.pendingDeletes.size>0)for(const a in i){if('mate'===a)continue;const t=i[a];if(!t||!t.name||!t.content)continue;const o=[t.content[0]];for(let a=1;a<t.content.length;a++){const n=a-1;e.pendingDeletes.has(`${t.name}-row-${n}`)||o.push(t.content[a])}t.content=o}try{let e=window.SillyTavern||(window.parent?window.parent.SillyTavern:null);!e&&window.top&&window.top.SillyTavern&&(e=window.top.SillyTavern);let a='';try{let e=window.localStorage,t=tt(e);if(!t&&window.parent)try{e=window.parent.localStorage,t=tt(e)}catch{}if(t){const o=e.getItem(t);if(o){const e=JSON.parse(o);e.dataIsolationEnabled&&e.dataIsolationCode&&(a=e.dataIsolationCode,console.info(`[ACU] 使用隔离标签: "${a}" (from ${t})`))}}else console.info('[ACU] 未找到 ACU 设置键，将使用空标签')}catch(e){console.warn('[ACU] 读取隔离配置失败:',e)}if(e&&e.chat&&e.chat.length>0){let o=null,c=-1;if(r>=0&&r<e.chat.length)c=r,o=e.chat[c];else{for(let a=e.chat.length-1;a>=0;a--)if(!e.chat[a].is_user&&e.chat[a].TavernDB_ACU_IsolatedData){c=a,o=e.chat[a];break}if(!o)for(let a=e.chat.length-1;a>=0;a--)if(!e.chat[a].is_user){c=a,o=e.chat[a];break}}if(o){let r=a;if(o.TavernDB_ACU_IsolatedData){const e=Object.keys(o.TavernDB_ACU_IsolatedData);e.length>0&&(r=e[0])}else o.TavernDB_ACU_IsolatedData={};o.TavernDB_ACU_IsolatedData[r]||(o.TavernDB_ACU_IsolatedData[r]={independentData:{},modifiedKeys:[],updateGroupKeys:[]});const l=o.TavernDB_ACU_IsolatedData[r];l.independentData||(l.independentData={});const s=Object.keys(i).filter(e=>e.startsWith('sheet_'));s.forEach(e=>{l.independentData[e]=t(i[e])});const u=l.modifiedKeys||[];if(l.modifiedKeys=[...new Set([...u,...s])],s.length>0){const a=function(e){const a={mate:{type:'chatSheets',version:1}};return Object.keys(e).forEach(t=>{if(!t.startsWith('sheet_'))return;const o=e[t];if(!o||'object'!=typeof o)return;const n=o.content,r=Array.isArray(n)&&Array.isArray(n[0])?n[0]:[null];a[t]={uid:o.uid||t,name:o.name||t,sourceData:o.sourceData||{note:'',initNode:'',insertNode:'',updateNode:'',deleteNode:''},content:[r],updateConfig:o.updateConfig||{uiSentinel:-1,contextDepth:-1,updateFrequency:-1,batchSize:-1,skipFloors:-1},exportConfig:o.exportConfig||{enabled:!1,splitByRow:!1,entryName:o.name||t,entryType:'constant',keywords:'',preventRecursion:!0,injectionTemplate:''},[nt]:o[nt]??void 0}}),a}(i);Object.keys(a).some(e=>e.startsWith('sheet_'))&&function(e,a,t){if(!e?.chat||0===e.chat.length)return console.info('[ACU] 无法更新指导表：聊天记录为空'),!1;const o=e.chat[0];if(!o)return console.info('[ACU] 无法更新指导表：chat[0] 不存在'),!1;try{let e=null;const n=o[ot];if(n)if('string'==typeof n)try{e=JSON.parse(n)}catch{e=null}else'object'==typeof n&&(e=n);return e&&'object'==typeof e||(e={version:1,tags:{}}),e.tags&&'object'==typeof e.tags||(e.tags={}),e.version=1,e.tags[a]={data:t,updatedAt:Date.now(),reason:'vue_visualizer_save'},o[ot]=e,console.info(`[ACU] 已更新 chat[0] 指导表 (tag=${a||'无标签'}, tables=${Object.keys(t).filter(e=>e.startsWith('sheet_')).length})`),!0}catch(e){return console.warn('[ACU] 更新指导表失败:',e),!1}}(e,r,a)}if(e.saveChat)return await e.saveChat(),await n(),{...i,_savedToFloor:c}}}}catch(e){throw console.error('[ACU] Core save error:',e),e}return await n(),i}async function n(){const e=Pe().getDB();if(e&&e.syncWorldbookEntries)try{await e.syncWorldbookEntries({createIfNeeded:!0})}catch(e){console.warn('[ACU] Worldbook sync failed after save:',e)}else console.warn('[ACU] syncWorldbookEntries API not found, skipping sync.')}let r=null;function i(t=5e3){r&&(r(),r=null),r=function(e,a,t={}){const{debounce:o=0,maxWait:n,...r}=t;return E(e,a,{...r,eventFilter:x(o,{maxWait:n})})}(()=>e.tables,async()=>{if(e.hasChanges&&a.config.autoSave)try{console.info('[ACU] 自动保存触发...'),await e.saveToDatabase(),console.info('[ACU] 自动保存完成')}catch(e){console.error('[ACU] 自动保存失败:',e)}},{debounce:t,deep:!0}),console.info(`[ACU] 自动保存已启用，防抖延迟: ${t}ms`)}function c(){console.info('[ACU] 检查旧版本数据...');let e=!1;rt.forEach(a=>{try{const t=localStorage.getItem(a);if(t){console.info(`[ACU] 发现旧版本数据: ${a}`),e=!0;try{const e=JSON.parse(t),a=Array.isArray(e)?'array':typeof e;console.info(`[ACU]   - 数据类型: ${a}`)}catch{console.info('[ACU]   - 数据类型: string')}}}catch(e){console.warn(`[ACU] 读取 ${a} 失败:`,e)}});try{localStorage.getItem('acu_v5_isolation_settings')&&(console.info('[ACU] 发现 V5 隔离设置数据'),e=!0)}catch{}e||console.info('[ACU] 未发现旧版本数据')}return{saveToDatabase:async function(a=null,t=!1,r=!1,i=-1){if(e.isSaving)return console.warn('[ACU] Save already in progress'),!1;let c=e.getStagedData();if(c||(c=a||Le()),!c)return console.warn('[ACU] 无数据可保存'),!1;const{$}=Pe(),l=$?.('#acu-btn-save-global, #acu-parent-container #acu-btn-save-global');let s='';try{e.isSaving=!0,!t&&l?.length&&(s=l.html(),l.html('<i class="fa-solid fa-spinner fa-spin"></i>').prop('disabled',!0));const a=await o(c,r,i);if(!t){const t=a?._savedToFloor;void 0!==t&&Pa.toast.success(`已更新至第 ${t} 层 (覆盖旧数据)`);$(window.parent?.document||document).find('.acu-highlight-changed').removeClass('acu-highlight-changed'),l?.removeClass('acu-save-alert'),e.clearChanges(r),e.stagedData=null,a&&e.saveSnapshot(a)}return await n(),!0}catch(e){return console.error('[ACU] Save failed:',e),t||Pa.toast.error('保存失败: '+e.message),!1}finally{setTimeout(()=>{e.isSaving=!1,!t&&l?.length&&l.html(s||'<i class="fa-solid fa-save"></i>').prop('disabled',!1)},100)}},syncWorldbook:n,saveSnapshot:function(a){e.saveSnapshot(a)},loadSnapshot:function(){return e.loadSnapshot()},clearSnapshot:function(){e.clearSnapshot()},purgeFloorRange:async function(a,t){if(e.isSaving)return;let o=window.SillyTavern||(window.parent?window.parent.SillyTavern:null);if(!o&&window.top&&window.top.SillyTavern&&(o=window.top.SillyTavern),!o||!o.chat)return void Pa.toast.error('无法连接到 SillyTavern 核心数据');const r=o.chat.length-1;if(a=Math.max(0,a),t=Math.min(r,t),isNaN(a)||isNaN(t)||a>t)Pa.toast.warning('无效的楼层范围');else{e.isSaving=!0;try{console.log(`[ACU-Purge] 开始强力清洗楼层范围: ${a} - ${t}`);let r=0;const i=['TavernDB_ACU_Data','TavernDB_ACU_SummaryData','TavernDB_ACU_IndependentData','TavernDB_ACU_Identity','TavernDB_ACU_IsolatedData','TavernDB_ACU_ModifiedKeys','TavernDB_ACU_UpdateGroupKeys'];for(let e=a;e<=t;e++){const a=o.chat[e];if(!a)continue;let t=!1;for(const e of i)Object.prototype.hasOwnProperty.call(a,e)&&(delete a[e],t=!0);t&&r++}if(r>0){o.saveChat&&await o.saveChat(),await n();const a=Le();a?e.saveSnapshot(a):e.clearSnapshot(),e.clearChanges(!0),Pa.toast.success(`已强力清除 ${r} 个楼层的数据`)}else Pa.toast.info('指定范围内没有可清除的数据')}catch(e){console.error('[ACU] Purge Error:',e),Pa.toast.error('清除失败: '+e.message)}finally{e.isSaving=!1}}},purgeTableDataByRange:async function(a,t,o){const r=Array.isArray(a)?[...new Set(a.filter(e=>'string'==typeof e&&e.startsWith('sheet_')))]:[];if(0===r.length)return{changed:!1,changedCount:0};let i=window.SillyTavern||(window.parent?window.parent.SillyTavern:null);if(!i&&window.top&&window.top.SillyTavern&&(i=window.top.SillyTavern),!i?.chat||0===i.chat.length)return Pa.toast.error('无法连接到 SillyTavern 核心数据'),{changed:!1,changedCount:0};const c=i.chat.length-1;if(t=Math.max(0,t),o=Math.min(c,o),isNaN(t)||isNaN(o)||t>o)return Pa.toast.warning('无效的楼层范围'),{changed:!1,changedCount:0};if(e.isSaving)return Pa.toast.warning('保存操作进行中，请稍后再试'),{changed:!1,changedCount:0};e.isSaving=!0;const l=(e,a)=>{if(!Array.isArray(e)||0===e.length)return{arr:e,changed:!1};const t=e.filter(e=>e!==a);return{arr:t,changed:t.length!==e.length}};try{console.info(`[ACU-AdvancedPurge] 开始清除表格 [${r.join(', ')}] 在楼层 ${t}-${o} 的数据`);let a=!1,c=0;for(let e=t;e<=o;e++){const t=i.chat[e];if(!t||t.is_user)continue;let o=!1;t.TavernDB_ACU_IsolatedData&&'object'==typeof t.TavernDB_ACU_IsolatedData&&(Object.keys(t.TavernDB_ACU_IsolatedData).forEach(e=>{const a=t.TavernDB_ACU_IsolatedData[e];a&&'object'==typeof a&&(a.independentData&&'object'==typeof a.independentData&&r.forEach(e=>{a.independentData[e]&&(delete a.independentData[e],o=!0)}),Array.isArray(a.modifiedKeys)&&r.forEach(e=>{const t=l(a.modifiedKeys,e);t.changed&&(a.modifiedKeys=t.arr,o=!0)}),Array.isArray(a.updateGroupKeys)&&r.forEach(e=>{const t=l(a.updateGroupKeys,e);t.changed&&(a.updateGroupKeys=t.arr,o=!0)}),!a.independentData||0!==Object.keys(a.independentData).length||a.modifiedKeys&&0!==a.modifiedKeys.length||a.updateGroupKeys&&0!==a.updateGroupKeys.length||(delete t.TavernDB_ACU_IsolatedData[e],o=!0))}),0===Object.keys(t.TavernDB_ACU_IsolatedData).length&&(delete t.TavernDB_ACU_IsolatedData,o=!0)),t.TavernDB_ACU_IndependentData&&'object'==typeof t.TavernDB_ACU_IndependentData&&r.forEach(e=>{t.TavernDB_ACU_IndependentData[e]&&(delete t.TavernDB_ACU_IndependentData[e],o=!0)}),Array.isArray(t.TavernDB_ACU_ModifiedKeys)&&r.forEach(e=>{const a=l(t.TavernDB_ACU_ModifiedKeys,e);a.changed&&(t.TavernDB_ACU_ModifiedKeys=a.arr,o=!0)}),Array.isArray(t.TavernDB_ACU_UpdateGroupKeys)&&r.forEach(e=>{const a=l(t.TavernDB_ACU_UpdateGroupKeys,e);a.changed&&(t.TavernDB_ACU_UpdateGroupKeys=a.arr,o=!0)}),t.TavernDB_ACU_Data&&'object'==typeof t.TavernDB_ACU_Data&&r.forEach(e=>{t.TavernDB_ACU_Data[e]&&(delete t.TavernDB_ACU_Data[e],o=!0)}),t.TavernDB_ACU_SummaryData&&'object'==typeof t.TavernDB_ACU_SummaryData&&r.forEach(e=>{t.TavernDB_ACU_SummaryData[e]&&(delete t.TavernDB_ACU_SummaryData[e],o=!0)}),o&&(a=!0,c++)}if(a){i.saveChat&&await i.saveChat(),await n();const a=Le();a?e.saveSnapshot(a):e.clearSnapshot(),e.clearChanges(!0),console.info(`[ACU-AdvancedPurge] 清除完成，影响 ${c} 个楼层`)}return{changed:a,changedCount:c}}catch(e){throw console.error('[ACU-AdvancedPurge] 清除失败:',e),e}finally{e.isSaving=!1}},setupAutoSave:i,stopAutoSave:function(){r&&(r(),r=null,console.info('[ACU] 自动保存已停止'))},migrateLegacyData:c,initDataPersistence:async function(){console.info('[ACU] 初始化数据持久化...'),c(),await e.loadFromDatabase(),a.config.autoSave&&i(a.config.autoSaveDelay||5e3),console.info('[ACU] 数据持久化初始化完成')},getTableData:Le,dataStore:e}}function ct(){const{saveToDatabase:e,getTableData:a,saveSnapshot:t,loadSnapshot:o}=it(),n=wa();return{insertRow:async(t,o)=>{let r=n.getStagedData();if(r||(r=a()),!r)return console.warn('[ACU insertRow] 无法获取数据'),void Pa.toast.error('无法获取数据');const i=r[t];if(!i?.content)return console.warn('[ACU insertRow] 未找到表格:',t,'可用表格:',Object.keys(r)),void Pa.toast.error('未找到目标表格');const c=i.content,l=c[0]?c[0].length:2,s=new Array(l).fill('');l>0&&(s[0]=String(c.length)),c.splice(o+2,0,s),Pa.toast.info('正在插入新行...'),n.setStagedData(r),n.saveLastState();await e(r,!1,!0)&&Pa.toast.success('新行已插入')},copyContent:e=>{const a=window.parent||window;if(a.TavernHelper&&a.TavernHelper.triggerSlash)try{const t=e.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\n/g,'\\n');return a.TavernHelper.triggerSlash(`/clipboard-set "${t}"`),void Pa.toast.success('已复制')}catch(e){console.warn('酒馆复制接口失败',e)}const t=document.createElement('textarea');t.value=e,t.style.position='fixed',t.style.left='-9999px',document.body.appendChild(t),t.select();try{document.execCommand('copy'),Pa.toast.success('已复制')}catch(a){prompt('请手动复制:',e)}document.body.removeChild(t)},toggleDelete:(e,a,t)=>{if(!t||!t.length){const{$}=Pe();if($){const o=$(window.parent.document).find(`.acu-editable-title[data-tname="${e}"][data-row="${a}"]`);o.length&&(t=o.closest('.acu-data-card'))}}if(!t||!t.find)return void console.warn('[ACU] toggleDelete failed: card element not found',{tableName:e,rowIdx:a});const o=`${e}-row-${a}`;n.isPendingDelete(o)?(n.toggleDelete(o),t.find('.acu-badge-pending').remove(),Pa.toast.success('已取消删除')):(n.toggleDelete(o),0===t.find('.acu-badge-pending').length&&t.append('<div class="acu-badge-pending">待删除</div>'),Pa.toast.warning('整行已标记为删除'))},setInput:e=>{const a=window.parent.document.getElementById('send_textarea'),t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(a){const o=a.value||'',n=o?o+' '+e:e;a.value=n,a.dispatchEvent(new Event('input',{bubbles:!0})),t||a.focus()}else console.warn('[ACU] 未找到输入框 #send_textarea')},editCell:(e,r,i)=>{const{tableKey:c,rowIdx:l,colIdx:s,$cell:u}=e,{$}=Pe(),d=i||document;let p=n.getStagedData();if(p||(p=a()),p||(p=o()),p){const e=p[c];e?.content&&e.content[l+1]&&(e.content[l+1][s]=r,n.setStagedData(p),t(p))}u.attr('data-val',encodeURIComponent(r)),u.data('val',encodeURIComponent(r));let m=u;u.hasClass('acu-grid-item')?m=u.find('.acu-grid-value'):u.hasClass('acu-full-item')&&(m=u.find('.acu-full-value'));const g=function(e){if(!e)return'';const a=String(e);return'True'===a||'Yes'===a||'完成'===a||'已完成'===a?'acu-badge-success':'False'===a||'No'===a||'失败'===a||'未完成'===a?'acu-badge-danger':'进行中'===a||'Doing'===a?'acu-badge-warning':/^\d+%$/.test(a)?'acu-badge-info':/^Lv\.?\d+$/i.test(a)?'acu-badge-primary':''}(r);g&&!u.hasClass('acu-editable-title')?m.html(`<span class="acu-badge ${g}">${r}</span>`):m.text(r),m.addClass('acu-highlight-changed'),u.hasClass('acu-editable-title')&&u.addClass('acu-highlight-changed'),n.updateCell(c,l,s,r);$(d).find('#acu-btn-save-global').addClass('acu-save-alert'),Pa.toast.info('修改已暂存')}}}const lt=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;function st(){if('undefined'!=typeof window){if(window.innerWidth<=768)return!0;if(window.innerWidth>1024)return!1}return lt.test(navigator.userAgent)}function ut(){const e=(0,l.ref)(st());if('undefined'!=typeof window){const a=()=>{e.value=st()};window.addEventListener('resize',a),(0,l.onUnmounted)(()=>{window.removeEventListener('resize',a)})}return{isMobile:e,isTouchDevice:(0,l.computed)(()=>'ontouchstart'in window||navigator.maxTouchPoints>0)}}function dt(e,a={}){const{initialX:t=100,initialY:o=100,edgePadding:n=10,elementWidth:r=50,onPositionChange:i,useParentWindow:c=!1}=a,s=()=>c&&window.parent&&window.parent!==window?window.parent:window,d=()=>{const e=s();return{width:e.innerWidth,height:e.innerHeight}},p=(0,l.ref)(!1),m=(0,l.computed)(()=>{if(c)try{return s().document}catch{return document}return document}),{x:g,y:b,isDragging:f}=function(e,a={}){var t;const{pointerTypes:o,preventDefault:n,stopPropagation:r,exact:i,onMove:c,onEnd:s,onStart:d,initialValue:p,axis:m='both',draggingElement:g=T,containerElement:b,handle:f=e,buttons:v=[0]}=a,h=(0,l.ref)(null!=(t=(0,l.toValue)(p))?t:{x:0,y:0}),x=(0,l.ref)(),w=e=>!o||o.includes(e.pointerType),y=e=>{(0,l.toValue)(n)&&e.preventDefault(),(0,l.toValue)(r)&&e.stopPropagation()},k=t=>{if((0,l.toValue)(a.disabled)||!w(t))return;if(!x.value)return;const o=(0,l.toValue)(b),n=(0,l.toValue)(e).getBoundingClientRect();let{x:r,y:i}=h.value;'x'!==m&&'both'!==m||(r=t.clientX-x.value.x,o&&(r=Math.min(Math.max(0,r),o.scrollWidth-n.width))),'y'!==m&&'both'!==m||(i=t.clientY-x.value.y,o&&(i=Math.min(Math.max(0,i),o.scrollHeight-n.height))),h.value={x:r,y:i},null==c||c(h.value,t),y(t)},C=e=>{!(0,l.toValue)(a.disabled)&&w(e)&&x.value&&(x.value=void 0,null==s||s(h.value,e),y(e))};if(u){const t=()=>{var e;return{capture:null==(e=a.capture)||e,passive:!(0,l.toValue)(n)}};I(f,'pointerdown',t=>{var o;if(!(0,l.toValue)(v).includes(t.button))return;if((0,l.toValue)(a.disabled)||!w(t))return;if((0,l.toValue)(i)&&t.target!==(0,l.toValue)(e))return;const n=(0,l.toValue)(b),r=null==(o=null==n?void 0:n.getBoundingClientRect)?void 0:o.call(n),c=(0,l.toValue)(e).getBoundingClientRect(),s={x:t.clientX-(n?c.left-r.left+n.scrollLeft:c.left),y:t.clientY-(n?c.top-r.top+n.scrollTop:c.top)};!1!==(null==d?void 0:d(s,t))&&(x.value=s,y(t))},t),I(g,'pointermove',k,t),I(g,'pointerup',C,t)}return{...S(h),position:h,isDragging:(0,l.computed)(()=>!!x.value),style:(0,l.computed)(()=>`left:${h.value.x}px;top:${h.value.y}px;`)}}(e,{initialValue:{x:t,y:o},draggingElement:m,onStart(){p.value=!1},onMove(){p.value=!0},onEnd(){if(p.value){const{width:e,height:a}=d();g.value<n&&(g.value=n),g.value>e-r-n&&(g.value=e-r-n),b.value<n&&(b.value=n),b.value>a-r-n&&(b.value=a-r-n),i?.(g.value,b.value)}}}),v=(0,l.computed)(()=>({left:`${g.value}px`,top:`${b.value}px`,cursor:f.value?'grabbing':'grab'}));return{x:g,y:b,isDragging:f,wasDragging:p,style:v,reset:()=>{g.value=t,b.value=o,i?.(g.value,b.value)}}}const pt={clearTableOnSwipe:!0};function mt(){const e=wa(),a=se(),t=(0,l.ref)(!1),o=(0,l.ref)({...pt}),n=[];let r=0,i=0,c=!1;async function s(a){try{return await e.purgeFloorRange(a,a),console.info(`[ACU Swipe] 已清除第 ${a} 楼的表格数据`),!0}catch(e){return console.error('[ACU Swipe] 清除楼层数据失败:',e),!1}}function u(e){if(e.is_user)return!1;return(e.swipe_id??0)>=(e.swipes?.length??1)-1}async function d(){if(console.info('[ACU Swipe] handleSwipeClearOnly 开始执行'),t.value)return void console.info('[ACU Swipe] 正在处理中，跳过');const e=function(){const e=window.parent||window,a=e.SillyTavern||e.top?.SillyTavern;return a&&'function'==typeof a.getContext?a.getContext():null}();if(!e?.chat?.length)return void console.warn('[ACU Swipe] SillyTavern context.chat 不可用');const a=e.chat.length-1,o=e.chat[a];if(console.info('[ACU Swipe] 检查最后一楼:',{index:a,is_user:o.is_user,swipe_id:o.swipe_id,swipes_length:o.swipes?.length}),!u(o))return void console.info('[ACU Swipe] 查看历史 swipe，跳过清除');const n=function(e){const a=e.TavernDB_ACU_IsolatedData;return!(!a||'object'!=typeof a)&&Object.keys(a).length>0}(o);if(console.info('[ACU Swipe] 最后一楼是否有 ACU 数据:',n),n){t.value=!0;try{console.info('[ACU Swipe] 开始清除第',a,'楼的表格数据');await s(a)&&Pa.toast.info('Swipe: 已清除最后一楼表格数据')}finally{t.value=!1}}else console.info('[ACU Swipe] 最后一楼无 ACU 数据，跳过清除')}async function p(e){const t=a.config.clearTableOnSwipe??o.value.clearTableOnSwipe;console.info('[ACU Swipe] handleSwipe 调用',{clearEnabled:t}),t?(console.info('[ACU Swipe] 执行清除表格'),await d()):console.info('[ACU Swipe] 功能未启用，跳过')}function m(){const e=window.parent.document.getElementById('chat');if(!e)return void console.warn('[ACU Swipe] 未找到 #chat 容器，无法初始化移动端监听');const a=e=>{const a=e.touches[0];r=a.clientX,i=a.clientY,c=!1},t=e=>{if(c)return;const a=e.touches[0],t=a.clientX-r,o=a.clientY-i;Math.abs(t)>Math.abs(o)&&t<-50&&(c=!0,function(e){if(!e)return!1;const a=window.parent.document.querySelectorAll('#chat .mes');return 0!==a.length&&a[a.length-1].contains(e)}(e.target)&&(console.log('[ACU Swipe] 移动端：检测到左滑手势'),p()))};e.addEventListener('touchstart',a,{passive:!0}),e.addEventListener('touchmove',t,{passive:!0}),n.push(()=>{e.removeEventListener('touchstart',a),e.removeEventListener('touchmove',t),console.info('[ACU Swipe] 移动端监听已清理')}),console.info('[ACU Swipe] 移动端监听已初始化')}function g(){n.forEach(e=>e()),n.length=0,console.info('[ACU Swipe] Swipe 增强功能已清理')}return(0,l.onUnmounted)(()=>{g()}),{isProcessing:t,config:o,updateConfig:function(e){o.value={...o.value,...e},console.info('[ACU Swipe] 配置已更新:',o.value)},getConfig:function(){return{...o.value}},clearFloorData:s,handleSwipe:p,handleSwipeClearOnly:d,willTriggerNewGeneration:u,init:function(){!function(){const{$}=Pe();if(!$)return void console.warn('[ACU Swipe] jQuery 不可用，无法初始化桌面端监听');const e=window.parent.document,a=e=>{e.target.closest('.swipe_right')&&(console.info('[ACU Swipe] 检测到 swipe_right 点击'),p())};e.addEventListener('click',a,{capture:!0}),n.push(()=>{e.removeEventListener('click',a,{capture:!0}),console.info('[ACU Swipe] 桌面端监听已清理')}),console.info('[ACU Swipe] 桌面端监听已初始化 (捕获模式)')}(),m(),console.info('[ACU Swipe] Swipe 增强功能已初始化')},cleanup:g}}const gt='avatars';let bt=null;const ft=new Map;function vt(){const e=(0,l.ref)(!1),a=(0,l.ref)(null);async function t(){return bt||new Promise((t,o)=>{const n=indexedDB.open('acu_avatars',1);n.onerror=()=>{const e=`[AvatarManager] 打开数据库失败: ${n.error?.message}`;console.error(e),a.value=e,o(n.error)},n.onsuccess=()=>{bt=n.result,e.value=!0,console.info('[AvatarManager] 数据库连接成功'),t(bt)},n.onupgradeneeded=e=>{const a=e.target.result;a.objectStoreNames.contains(gt)||(a.createObjectStore(gt,{keyPath:'name'}),console.info('[AvatarManager] 创建数据库表成功'))}})}async function o(e){const a=await t();return new Promise((t,o)=>{const n=a.transaction(gt,'readwrite').objectStore(gt);ft.has(e.name)&&(URL.revokeObjectURL(ft.get(e.name)),ft.delete(e.name));const r={...e,updatedAt:e.updatedAt||Date.now()},i=n.put(r);i.onsuccess=()=>{console.info(`[AvatarManager] 保存头像成功: ${e.name}`),t()},i.onerror=()=>{console.error(`[AvatarManager] 保存头像失败: ${i.error}`),o(i.error)}})}async function n(e){if(!e)return null;const a=await t();return new Promise(t=>{const o=a.transaction(gt,'readonly').objectStore(gt).get(e);o.onsuccess=()=>{t(o.result||null)},o.onerror=()=>{console.error(`[AvatarManager] 获取头像失败: ${o.error}`),t(null)}})}async function r(){const e=await t();return new Promise(a=>{const t=e.transaction(gt,'readonly').objectStore(gt).getAll();t.onsuccess=()=>{a(t.result||[])},t.onerror=()=>{console.error(`[AvatarManager] 获取所有头像失败: ${t.error}`),a([])}})}function i(){try{const e=window.parent||window,$=e.jQuery||window.jQuery;if($){const e=$('.mes[is_user="true"]').last().find('.avatar img');if(e.length&&e.attr('src')){const a=e.attr('src');if(a&&!a.includes('default')&&!a.includes('placeholder'))return a}const a=$('#user_avatar_block img').first();if(a.length&&a.attr('src'))return a.attr('src')}const a=e.SillyTavern||window.SillyTavern;if(a?.getContext){const e=a.getContext();if(e?.userAvatar)return e.userAvatar}}catch(e){console.warn('[AvatarManager] getSillyTavernUserAvatar error:',e)}return null}function c(){try{const e=(window.parent||window).AutoCardUpdaterAPI;if(e?.exportTableAsJson){const a=e.exportTableAsJson();for(const e in a){const t=a[e];if(t?.name?.includes('主角')&&t.content?.[1]?.[1])return t.content[1][1]}}}catch(e){console.warn('[AvatarManager] getPlayerNameFromTable error:',e)}return null}function s(e){if(!e)return!1;const a=['<user>','{{user}}','主角','player','protagonist'],t=e.toLowerCase();for(const e of a)if(t===e.toLowerCase())return!0;const o=c();return!(!o||e!==o)}async function u(e){if(!e)return e;const a=await r();for(const t of a)if(t.aliases?.includes(e))return t.name;return e}function d(e){if(!e)return[];if('undefined'!=typeof Intl&&Intl.Segmenter){const a=new Intl.Segmenter('zh',{granularity:'grapheme'});return Array.from(a.segment(e),e=>e.segment)}return[...e]}return{isReady:e,error:a,initDB:t,saveAvatar:o,getAvatar:n,deleteAvatar:async function(e){if(!e)return;ft.has(e)&&(URL.revokeObjectURL(ft.get(e)),ft.delete(e));const a=await t();return new Promise(t=>{const o=a.transaction(gt,'readwrite').objectStore(gt).delete(e);o.onsuccess=()=>{console.info(`[AvatarManager] 删除头像成功: ${e}`),t()},o.onerror=()=>{console.error(`[AvatarManager] 删除头像失败: ${o.error}`),t()}})},deleteAvatars:async function(e){if(!e.length)return;for(const a of e)ft.has(a)&&(URL.revokeObjectURL(ft.get(a)),ft.delete(a));const a=await t();return new Promise((t,o)=>{const n=a.transaction(gt,'readwrite'),r=n.objectStore(gt);let i=0;const c=e.length;for(const a of e){const e=r.delete(a);e.onsuccess=()=>{i++,i===c&&(console.info(`[AvatarManager] 批量删除完成: ${c} 个`),t())},e.onerror=()=>{console.error(`[AvatarManager] 删除失败: ${a}`),i++,i===c&&t()}}n.onerror=()=>o(n.error)})},getAllAvatars:r,hasAvatar:async function(e){if(!e)return!1;const a=await t();return new Promise(t=>{const o=a.transaction(gt,'readonly').objectStore(gt).getKey(e);o.onsuccess=()=>t(void 0!==o.result),o.onerror=()=>t(!1)})},getStats:async function(){const e=await t();return new Promise(a=>{const t=e.transaction(gt,'readonly').objectStore(gt).getAll();t.onsuccess=()=>{const e=t.result||[],o=e.reduce((e,a)=>e+(a.blob?.size||0),0);a({count:e.length,totalSizeBytes:o,totalSizeMB:(o/1024/1024).toFixed(2)})},t.onerror=()=>{a({count:0,totalSizeBytes:0,totalSizeMB:'0.00'})}})},clearAll:async function(){ft.forEach(e=>URL.revokeObjectURL(e)),ft.clear();const e=await t();return new Promise(a=>{const t=e.transaction(gt,'readwrite').objectStore(gt).clear();t.onsuccess=()=>{console.info('[AvatarManager] 清空所有头像成功'),a()},t.onerror=()=>{console.error(`[AvatarManager] 清空失败: ${t.error}`),a()}})},getAvatarUrl:async function e(a){if(!a)return null;if(ft.has(a))return ft.get(a);const t=await n(a);if(t){if(t.blob){const e=URL.createObjectURL(t.blob);return ft.set(a,e),e}if(t.url)return t.url}const o=await u(a);if(o!==a)return e(o);if(s(a)){const e=i();if(e)return e}return null},getAvatarDisplayConfig:async function(e){const a=await n(e);return a?{offsetX:a.offsetX??50,offsetY:a.offsetY??50,scale:a.scale??150}:{offsetX:50,offsetY:50,scale:150}},getSillyTavernUserAvatar:i,getSillyTavernCharacterAvatar:function(){try{const e=window.parent||window,$=e.jQuery||window.jQuery;if($){const e=$('#avatar_img_holder img').first();if(e.length&&e.attr('src'))return e.attr('src');const a=$('.mes:not([is_user="true"])').last().find('.avatar img');if(a.length&&a.attr('src'))return a.attr('src')}const a=e.SillyTavern||window.SillyTavern;if(a?.getContext){const e=a.getContext();if(e?.characterAvatar)return e.characterAvatar}}catch(e){console.warn('[AvatarManager] getSillyTavernCharacterAvatar error:',e)}return null},getPlayerNameFromTable:c,isPlayerNode:s,resolvePrimaryName:u,addAlias:async function(e,a){const t=await n(e);if(!t)return;const r=t.aliases||[];r.includes(a)||(r.push(a),await o({...t,aliases:r,updatedAt:Date.now()}))},removeAlias:async function(e,a){const t=await n(e);if(!t)return;const r=(t.aliases||[]).filter(e=>e!==a);await o({...t,aliases:r,updatedAt:Date.now()})},getDisplayLabel:async function(e){if(!e)return'';const a=await n(e);if(a?.labelIndices?.length){const t=d(e);return a.labelIndices.map(e=>t[e]||'').join('')}return e},setDisplayLabel:async function(e,a){let t=await n(e);t=t?{...t,labelIndices:a,updatedAt:Date.now()}:{name:e,offsetX:50,offsetY:50,scale:150,aliases:[],labelIndices:a,updatedAt:Date.now()},await o(t)},getDisplayChars:d,cleanup:function(){ft.forEach(e=>URL.revokeObjectURL(e)),ft.clear(),console.info('[AvatarManager] 已清理 ObjectURL 缓存')}}}const ht={widgets:[],layout:'grid',columns:2,showStats:!0};const xt=a('acu-dashboard',()=>{const e=(0,l.ref)({...ht}),a=(0,l.ref)(!1),t=(0,l.computed)(()=>e.value.widgets.filter(e=>e.enabled).sort((e,a)=>e.order-a.order)),o=(0,l.computed)(()=>[...e.value.widgets].sort((e,a)=>e.order-a.order)),n=(0,l.computed)(()=>e.value.showStats),r=(0,l.computed)(()=>e.value.columns),i=(0,l.computed)(()=>e.value.layout);async function c(){try{const a=getVariables({type:'chat'})||{};replaceVariables({...a,acu_dashboard_config:e.value},{type:'chat'}),console.log('[ACU Dashboard] 配置保存成功 (聊天变量)')}catch(e){console.error('[ACU Dashboard] 保存配置失败:',e)}}function s(a,t){const o=e.value.widgets.find(e=>e.id===a);o&&(Object.assign(o,t),c())}return{config:e,isInitialized:a,enabledWidgets:t,allWidgets:o,showStats:n,columns:r,layout:i,loadConfig:async function(){try{const t=getVariables({type:'chat'});t&&t.acu_dashboard_config&&(e.value={...ht,...t.acu_dashboard_config}),a.value=!0,console.log('[ACU Dashboard] 配置加载成功 (聊天变量):',e.value)}catch(t){console.warn('[ACU Dashboard] 加载配置失败，使用默认配置:',t),e.value={...ht},a.value=!0}},saveConfig:c,updateConfig:function(a){e.value={...e.value,...a},c()},addWidget:function(a,t){let o=t?ge[t]:void 0;if(!o)for(const[e,t]of Object.entries(be))if(t.some(e=>a.toLowerCase().includes(e.toLowerCase()))){o=ge[e];break}const n={id:`widget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:'table',tableId:a,title:o?.title||a,icon:o?.icon||'fa-table',displayColumns:o?.displayColumns||[],maxRows:o?.maxRows||8,actions:o?.actions||['goToTable'],order:e.value.widgets.length,enabled:!0,colSpan:o?.colSpan||1,displayStyle:o?.displayStyle||'list'};return e.value.widgets.push(n),c(),n},removeWidget:function(a){const t=e.value.widgets.findIndex(e=>e.id===a);-1!==t&&(e.value.widgets.splice(t,1),e.value.widgets.forEach((e,a)=>{e.order=a}),c())},updateWidget:s,toggleWidget:function(a){const t=e.value.widgets.find(e=>e.id===a);t&&(t.enabled=!t.enabled,c())},moveWidget:function(a,t){const o=[...e.value.widgets],n=o.findIndex(e=>e.id===a);if(-1===n)return;const[r]=o.splice(n,1);o.splice(t,0,r),o.forEach((e,a)=>{e.order=a}),e.value.widgets=o,c()},setWidgetActions:function(e,a){s(e,{actions:a})},resetConfig:function(){e.value={...ht},c()},findWidgetByTableId:function(a){return e.value.widgets.find(e=>e.tableId===a)},hasWidget:function(a){return e.value.widgets.some(e=>e.tableId===a)}}}),wt=['title'],yt={class:'ball-emoji'},kt=['src'],Ct={key:1,class:'acu-issue-badge'},Nt=(0,l.defineComponent)({__name:'FloatingBall',setup(e,{expose:a}){const t=Ma(),o=wa(),n=ue(),r=(0,l.computed)(()=>o.hasIntegrityIssues),i=(0,l.computed)(()=>r.value?o.getIntegritySummary():''),c=(0,l.computed)(()=>n.appearance),s=(0,l.ref)(!1);let u=null;const d=(0,l.computed)(()=>({docked:b.value,'has-issues':r.value,'ai-notify':s.value,'anim-ripple':s.value&&'ripple'===c.value.notifyAnimation,'anim-arc':s.value&&'arc'===c.value.notifyAnimation})),p=(0,l.computed)(()=>{const e=c.value;return{'--ball-size':`${e.size}px`,'--ball-border-color':e.borderColor,'--ball-border-color-rgba':Fe(e.borderColor,e.borderOpacity),'--ball-bg-color':Fe(e.bgColor,e.bgOpacity),...w.value}});function m(){const e=window.parent&&window.parent!==window?window.parent:window;return{width:e.innerWidth,height:e.innerHeight}}const g=(0,l.ref)(),b=(0,l.ref)(!1);let f=null;const v=function(){const{height:e}=m();return{x:20,y:e-150}}(),{x:h,y:x,style:w,isDragging:y,wasDragging:k}=dt(g,{initialX:v.x,initialY:v.y,edgePadding:10,elementWidth:(0,l.computed)(()=>c.value.size).value,useParentWindow:!0,onPositionChange:(e,a)=>{console.info('[ACU FloatingBall] 位置已保存:',e,a)}});function C(e){return k.value?(k.value=!1,void e.stopPropagation()):b.value?(b.value=!1,void e.stopPropagation()):void(f?(clearTimeout(f),f=null,b.value=!0,console.info('[ACU FloatingBall] 双击 - 进入停靠模式')):f=setTimeout(()=>{f=null,t.openPanel(),console.info('[ACU FloatingBall] 单击 - 打开面板')},250))}var N,V,E;return N='resize',V=()=>{const{width:e,height:a}=m(),t=c.value.size,o=10;let n=!1;h.value>e-t-o&&(h.value=e-t-o,n=!0),x.value>a-t-o&&(x.value=a-t-o,n=!0),h.value<o&&(h.value=o,n=!0),x.value<o&&(x.value=o,n=!0),n&&console.info('[ACU FloatingBall] 窗口大小变化，位置已调整')},I(window.parent&&window.parent!==window?window.parent:window,N,V,E),(0,l.onMounted)(()=>{n.loadFromScriptVariables()}),(0,l.onUnmounted)(()=>{f&&clearTimeout(f),u&&clearTimeout(u)}),a({resetPosition:()=>{const e=(window.parent?.innerHeight??window.innerHeight)-150;h.value=20,x.value=e},setDocked:e=>{b.value=e},triggerAiNotify:function(e=3e3){u&&clearTimeout(u),s.value=!0,u=setTimeout(()=>{s.value=!1,u=null},e)},getAppearance:()=>c.value}),(e,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{ref_key:'ballRef',ref:g,class:(0,l.normalizeClass)(['acu-floating-ball-vue',d.value]),style:(0,l.normalizeStyle)(p.value),title:r.value?i.value:'点击打开面板',onClick:C},[(0,l.createCommentVNode)(' 图标内容 - 根据类型动态渲染 '),b.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:0},[(0,l.createCommentVNode)(' FontAwesome 图标 '),'icon'===c.value.type?((0,l.openBlock)(),(0,l.createElementBlock)('i',{key:0,class:(0,l.normalizeClass)(['fa-solid',c.value.content])},null,2)):'emoji'===c.value.type?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' Emoji '),(0,l.createElementVNode)('span',yt,(0,l.toDisplayString)(c.value.content),1)],2112)):'image'===c.value.type&&c.value.content?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' 图片 '),(0,l.createElementVNode)('img',{src:c.value.content,alt:''},null,8,kt)],2112)):(0,l.createCommentVNode)('v-if',!0)],64)),(0,l.createCommentVNode)(' 问题徽章 '),r.value&&!b.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',Ct,'!')):(0,l.createCommentVNode)('v-if',!0)],14,wt))}}),Vt={class:'popup-buttons-grid'},Et=['title','onClick'],zt=(0,l.defineComponent)({__name:'HiddenButtonsPopup',props:{visible:{type:Boolean},buttons:{}},emits:['close','button-click'],setup(e,{emit:a}){const t=a,o=e=>{const a=[];return'purge'===e&&a.push('btn-danger'),a};return(a,n)=>((0,l.openBlock)(),(0,l.createBlock)(l.Transition,{name:'hidden-popup'},{default:(0,l.withCtx)(()=>[e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-hidden-buttons-popup',onClick:n[0]||(n[0]=(0,l.withModifiers)(()=>{},['stop']))},[(0,l.createElementVNode)('div',Vt,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.buttons,e=>((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:e.id,class:(0,l.normalizeClass)(['popup-button',o(e.id)]),title:e.label,onClick:(0,l.withModifiers)(a=>{return o=e.id,t('button-click',o),void t('close');var o},['stop'])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fa-solid',e.icon])},null,2)],10,Et))),128))])])):(0,l.createCommentVNode)('v-if',!0)]),_:1}))}});c(219);var Bt=c(455);const St=(0,Bt.A)(zt,[['__scopeId','data-v-09fbfd4e']]),At={class:'acu-panel-content'},Tt={class:'acu-nav-actions-area'},Ut={key:0,class:'acu-action-btn-wrapper acu-lock-mode-btns'},Dt={key:0,class:'acu-lock-count'},It=['title','onClick','onMousedown','onTouchstartPassive'],Mt={key:0,class:'secondary-indicator'},_t=['title','onClick'],$t={key:1,class:'acu-action-btn-wrapper'},jt=(0,l.defineComponent)({__name:'MainPanel',props:{title:{default:'ACU 可视化表格'},theme:{default:'retro'},layout:{default:'vertical'},isCollapsed:{type:Boolean,default:!1},isPinned:{type:Boolean,default:!1},isContentHidden:{type:Boolean,default:!1},lockPanel:{type:Boolean,default:!1},hasChanges:{type:Boolean,default:!1},panelType:{default:'normal'}},emits:['refresh','save','save-as','undo','manual-update','purge','settings','open-native','toggle-pin','toggle','close','hide-content','height-change','width-change','collapse-tab'],setup(e,{expose:a,emit:t}){const o=e,n=t,r=Ma(),i=ea(),c=se(),s=['save','refresh','settings','pin','toggle'],u=(0,l.computed)(()=>{let e=c.config.buttonOrder||ae.map(e=>e.id);const a=c.config.visibleButtons?.length>0?[...c.config.visibleButtons]:[...s];if(c.config.collapseTabBar){if(a.includes('collapseTab')||a.push('collapseTab'),!e.includes('collapseTab')){const a=e.indexOf('settings');e=a>=0?[...e.slice(0,a),'collapseTab',...e.slice(a)]:[...e,'collapseTab']}}else{const e=a.indexOf('collapseTab');e>-1&&a.splice(e,1)}return console.info('[ACU MainPanel] 计算可见按钮:',{order:e,visibleIds:a,collapseTabBar:c.config.collapseTabBar}),e.map(e=>ae.find(a=>a.id===e)).filter(e=>!!e&&a.includes(e.id))}),d=(0,l.computed)(()=>c.hiddenButtons),p=(0,l.computed)(()=>c.hasHiddenButtons),m=(0,l.ref)(!1),g=()=>{m.value=!m.value},b=e=>{m.value=!1,S(e)},f=(0,l.ref)(!1),v=e=>{const a=[];return'purge'===e&&a.push('acu-btn-danger'),'pin'===e&&(a.push('acu-btn-toggle'),o.isPinned&&a.push('active')),'save'===e&&o.hasChanges&&a.push('has-changes'),'refresh'===e&&f.value&&a.push('refreshing'),a},h=e=>{const a={};return'purge'===e&&(a.color='#e74c3c'),'pin'===e&&o.isPinned&&(a.color='var(--acu-title-color)',a.borderColor='var(--acu-title-color)',a.background='var(--acu-btn-hover)'),a};let x=null;const w=(0,l.ref)(!1),y=(0,l.ref)(null),k=e=>c.getSecondaryButtonId(e),C=e=>{const a=ae.find(a=>a.id===e);return a?.icon||'fa-circle'},N=e=>{const a=ae.find(a=>a.id===e);return a?.label||e},V=e=>{const a=N(e),t=k(e);if(t){return`${a} (长按: ${N(t)})`}return a},E=e=>{const a=k(e);console.log('[ACU MainPanel] startLongPress:',e,'secondaryId:',a,'groups:',c.buttonGroups),a?(w.value=!1,x=setTimeout(()=>{w.value=!0,console.log('[ACU MainPanel] Long press triggered for:',e,'directExec:',c.longPressDirectExec),c.longPressDirectExec?(console.log('[ACU MainPanel] Direct exec:',a),S(a)):(console.log('[ACU MainPanel] Popup button:',a),y.value=e,setTimeout(()=>{y.value===e&&(y.value=null)},3e3))},600)):console.log('[ACU MainPanel] No secondary button for:',e)},B=()=>{x&&(clearTimeout(x),x=null)},S=e=>{switch(e){case'save':n('save');break;case'saveAs':n('save-as');break;case'undo':n('undo');break;case'refresh':n('refresh');break;case'manualUpdate':n('manual-update');break;case'purge':n('purge');break;case'pin':n('toggle-pin');break;case'toggle':n('toggle');break;case'settings':n('settings');break;case'openNative':n('open-native');break;case'collapseTab':n('collapse-tab');break;default:console.warn(`[MainPanel] 未知的动作 ID: ${e}`)}},A=()=>{const e=i.pendingLockCount.value;i.savePendingLocks(),r.isLockEditMode=!1,Pa.toast.success(`已保存 ${e} 个单元格锁定`)},T=()=>{i.discardPendingLocks(),r.isLockEditMode=!1,Pa.toast.info('已取消锁定编辑')},U=()=>{r.showLockedOnly=!r.showLockedOnly},D=(0,l.ref)(),M=(0,l.ref)(),j=(0,l.ref)(),F=(0,l.ref)(),P=K('acu_win_config',{width:400,left:'50%',bottom:'50%',isCentered:!0});function L(){const e=P.value;if(e.isCentered)return;const{width:a,height:t}={width:window.parent?.innerWidth??window.innerWidth,height:window.parent?.innerHeight??window.innerHeight};let o=!1,n=e.left,r=e.bottom;if('number'==typeof e.left){const t=a-50;e.left<-200?(n=-200,o=!0):e.left>t&&(n=Math.max(0,t),o=!0)}if('number'==typeof e.bottom){const a=t-50;e.bottom<0?(r=0,o=!0):e.bottom>a&&(r=Math.max(0,a),o=!0)}o&&(console.info('[ACU MainPanel] 面板位置越界，已自动修正'),P.value={...e,left:n,bottom:r})}function R(e){if(o.lockPanel)return;if(e.target.closest('.acu-resize-handle, .acu-slider, input'))return;if(0!==e.button)return;const a=j.value;if(!a||!D.value)return;const t=e.clientX,n=e.clientY,r=D.value.getBoundingClientRect(),i=r.left,c=window.parent?.innerHeight??window.innerHeight,l=c-r.bottom;let s=!1,u=!1;const d=e=>{const a=e.originalEvent,o=a.clientX-t,r=a.clientY-n;if(!s&&(Math.abs(o)>5||Math.abs(r)>5)&&(s=!0,u=!0,P.value.isCentered=!1),s){e.preventDefault();let a=i+o,t=l-r;const n=(window.parent?.innerWidth??window.innerWidth)-50,s=c-50;a<-200&&(a=-200),a>n&&(a=n),t<0&&(t=0),t>s&&(t=s),P.value.left=a,P.value.bottom=t}},p=()=>{if($('body').off('pointermove',d),$('body').off('pointerup',p),u){const e=t=>{t.stopPropagation(),t.preventDefault(),a.removeEventListener('click',e,!0)};a.addEventListener('click',e,!0),console.info('[ACU MainPanel] 面板位置已更新')}};$('body').on('pointermove',d),$('body').on('pointerup',p)}(0,l.watchEffect)(()=>{if(!D.value)return;const e=P.value,a=D.value;if(e.width&&a.style.setProperty('--acu-win-width',`${e.width}px`),void 0!==e.left){const t='number'==typeof e.left?`${e.left}px`:e.left;a.style.setProperty('--acu-win-left',t)}if(void 0!==e.bottom){const t='number'==typeof e.bottom?`${e.bottom}px`:e.bottom;a.style.setProperty('--acu-win-bottom',t)}e.isCentered?a.style.transform='translate(-50%, 50%)':a.style.transform=''});const O=(0,l.ref)(),H=(0,l.ref)(!1),G=(0,l.ref)(0),Y=(0,l.computed)(()=>o.panelType),W=(0,l.computed)(()=>c.config.showPagination);(0,l.onMounted)(()=>{L();const e=j.value;e&&(e.addEventListener('pointerdown',R),console.info('[ACU MainPanel] 导航栏拖拽事件已绑定'));const a=F.value;a&&(a.addEventListener('pointerdown',Q),console.info('[ACU MainPanel] 宽度调节事件已绑定'))}),(0,l.onUnmounted)(()=>{const e=j.value;e&&e.removeEventListener('pointerdown',R);const a=F.value;a&&a.removeEventListener('pointerdown',Q)}),I(window.parent??window,'resize',()=>{L()});const{height:q,recalculate:X}=function(e,a,t,o={}){const{minHeight:n=200,maxHeightRatio:r=.8,headerHeight:i=42,paginationHeight:c=56,contentPadding:s=25,onHeightChange:u}=o,d=(0,l.ref)(n),p=()=>window.parent&&window.parent!==window?window.parent.innerHeight:window.innerHeight,m=()=>p()*r,g=()=>'string'==typeof a?a:a.value,b=()=>'boolean'==typeof t?t:t.value;J(e,e=>{const a=e[0];if(!a)return;if('dashboard'===g()){const e=m();return console.info('[ACU useSmartHeight] 仪表盘高度计算:',{maxH:e,parentHeight:p(),ratio:r}),d.value=e,void u?.(e)}const t=a.contentRect.height,o=b()?c:0,l=i+t+s+o,f=m(),v=Math.max(n,Math.min(l,f));d.value=v,u?.(v)}),'string'!=typeof a&&(0,l.watch)(a,e=>{if('dashboard'===e){const e=m();console.info('[ACU useSmartHeight] 切换到仪表盘，设置高度:',e),d.value=e,u?.(e)}}),'boolean'!=typeof t&&(0,l.watch)(t,()=>{if(e.value){const a=e.value.scrollHeight;if('dashboard'!==g()){const e=b()?c:0,t=i+a+s+e,o=m(),r=Math.max(n,Math.min(t,o));d.value=r,u?.(r)}}});const f=(0,l.computed)(()=>({height:`${d.value}px`,maxHeight:`${m()}px`}));return{height:d,heightStyle:f,maxHeight:(0,l.computed)(()=>m()),reset:()=>{d.value=n,u?.(n)},maximize:()=>{const e=m();d.value=e,u?.(e)},recalculate:()=>{if(e.value)if('dashboard'===g()){const e=m();d.value=e,u?.(e)}else{const a=e.value.scrollHeight,t=b()?c:0,o=i+a+s+t,r=m(),l=Math.max(n,Math.min(o,r));d.value=l,u?.(l)}}}}(O,Y,W,{minHeight:200,maxHeightRatio:.8,headerHeight:42,paginationHeight:56,contentPadding:25,onHeightChange:e=>{!H.value&&M.value&&(G.value=e,n('height-change',e))}});function Q(e){if(0!==e.button)return;e.preventDefault(),e.stopPropagation();if(!F.value||!D.value)return;const a=e.clientX,t=D.value.getBoundingClientRect().width,o=e=>{const o=e.originalEvent.clientX-a;let r=t+o;const i=(window.parent?.innerWidth??window.innerWidth)-10;r<300&&(r=300),r>i&&(r=i),P.value.width=r,n('width-change',r)},r=()=>{$('body').off('pointermove',o),$('body').off('pointerup',r),console.info('[ACU MainPanel] 宽度已更新:',P.value.width)};$('body').on('pointermove',o),$('body').on('pointerup',r)}return a({getPanelElement:()=>D.value,getDataAreaElement:()=>M.value,getCurrentHeight:()=>G.value,resetPosition:()=>{P.value={width:400,left:'50%',bottom:'50%',isCentered:!0}},resetHeight:()=>{if(!M.value)return;H.value=!1;const e=.8*(window.parent?.innerHeight??window.innerHeight);M.value.style.height;M.value.style.height='auto',M.value.style.maxHeight='none';const a=M.value.scrollHeight,t=Math.max(200,Math.min(a,e));M.value.style.height=`${t}px`,M.value.style.maxHeight='',G.value=t,console.info(`[ACU] 高度已重置: natural=${a}, final=${t}, max=${e}`),n('height-change',t)},recalculateHeight:X}),(a,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{ref_key:'panelRef',ref:D,class:(0,l.normalizeClass)(['acu-wrapper',[`acu-theme-${e.theme}`,`acu-layout-${e.layout}`,{collapsed:e.isCollapsed,pinned:e.isPinned}]])},[(0,l.createCommentVNode)(' 1. 数据显示区（放在最前面） '),(0,l.createElementVNode)('div',{ref_key:'dataAreaRef',ref:M,class:(0,l.normalizeClass)(['acu-data-display',{visible:!e.isContentHidden,'acu-layout-horizontal':'horizontal'===e.layout,'acu-layout-vertical':'vertical'===e.layout}])},[(0,l.createCommentVNode)(' 内容区 '),(0,l.createElementVNode)('div',At,[(0,l.renderSlot)(a.$slots,'default')])],2),(0,l.createCommentVNode)(' 2. 宽度调节把手 '),(0,l.createCommentVNode)(' 注意：事件绑定在 onMounted 中手动进行，避免跨 iframe 生产构建事件绑定失效 '),e.lockPanel?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,ref_key:'resizeHandleRef',ref:F,class:'acu-resize-handle'},null,512)),(0,l.createCommentVNode)(' 3. 导航容器（放在最后，显示在底部） '),(0,l.createCommentVNode)(' 注意：拖拽事件绑定在 onMounted 中手动进行 '),(0,l.createElementVNode)('div',{ref_key:'navContainerRef',ref:j,class:(0,l.normalizeClass)(['acu-nav-container',{'acu-locked':e.lockPanel}])},[(0,l.createCommentVNode)(' Tab 区域 (由 slot 提供，TabBar 自带 .acu-nav-tabs-area) '),(0,l.renderSlot)(a.$slots,'tabs'),(0,l.createCommentVNode)(' 分隔线 '),t[5]||(t[5]=(0,l.createElementVNode)('div',{class:'acu-nav-separator'},null,-1)),(0,l.createCommentVNode)(' 动作按钮区（横排） '),(0,l.createElementVNode)('div',Tt,[(0,l.createCommentVNode)(' 锁定编辑模式：在最前面添加确认/取消/筛选按钮 '),(0,l.unref)(r).isLockEditMode?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ut,[(0,l.createElementVNode)('button',{class:'acu-action-btn acu-btn-success',title:'完成锁定编辑',onClick:(0,l.withModifiers)(A,['stop'])},[...t[1]||(t[1]=[(0,l.createElementVNode)('i',{class:'fas fa-check'},null,-1)])]),(0,l.createElementVNode)('button',{class:'acu-action-btn acu-btn-cancel',title:'取消锁定编辑',onClick:(0,l.withModifiers)(T,['stop'])},[...t[2]||(t[2]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1)])]),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-action-btn',{'acu-btn-active':(0,l.unref)(r).showLockedOnly}]),title:'只显示锁定的卡片',onClick:(0,l.withModifiers)(U,['stop'])},[...t[3]||(t[3]=[(0,l.createElementVNode)('i',{class:'fas fa-filter'},null,-1)])],2),(0,l.unref)(i).pendingLockCount.value>0?((0,l.openBlock)(),(0,l.createElementBlock)('span',Dt,(0,l.toDisplayString)((0,l.unref)(i).pendingLockCount.value),1)):(0,l.createCommentVNode)('v-if',!0)])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 常规按钮（始终显示） '),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(u.value,e=>{return(0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:'acu-action-btn-wrapper'},[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-action-btn',v(e.id)]),title:V(e.id),style:(0,l.normalizeStyle)(h(e.id)),onClick:(0,l.withModifiers)(a=>{return t=e.id,void(w.value?w.value=!1:('refresh'===t&&(f.value=!0,setTimeout(()=>{f.value=!1},1e3)),S(t)));var t},['stop']),onMousedown:(0,l.withModifiers)(a=>E(e.id),['stop']),onMouseup:(0,l.withModifiers)(B,['stop']),onMouseleave:B,onTouchstartPassive:(0,l.withModifiers)(a=>E(e.id),['stop']),onTouchend:(0,l.withModifiers)(B,['stop'])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fa-solid',e.icon])},null,2),(0,l.createCommentVNode)(' 附属按钮指示点 '),(a=e.id,null!==k(a)?((0,l.openBlock)(),(0,l.createElementBlock)('span',Mt)):(0,l.createCommentVNode)('v-if',!0))],46,It),(0,l.createCommentVNode)(' 长按弹出的附属按钮 '),(0,l.createVNode)(l.Transition,{name:'popup'},{default:(0,l.withCtx)(()=>[y.value===e.id&&k(e.id)?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'acu-action-btn acu-popup-btn',title:N(k(e.id)),onClick:(0,l.withModifiers)(a=>(e=>{const a=k(e);a&&S(a),y.value=null})(e.id),['stop'])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fa-solid',C(k(e.id))])},null,2)],8,_t)):(0,l.createCommentVNode)('v-if',!0)]),_:2},1024)]);var a}),128)),(0,l.createCommentVNode)(' 更多按钮（仅当有隐藏按钮时显示） '),p.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',$t,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-action-btn acu-more-btn',{active:m.value}]),title:'更多按钮',onClick:(0,l.withModifiers)(g,['stop'])},[...t[4]||(t[4]=[(0,l.createElementVNode)('i',{class:'fa-solid fa-chevron-up'},null,-1)])],2)])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 隐藏按钮浮窗（放在 actions-area 内，贴着 action 按钮显示） '),(0,l.createVNode)(St,{visible:m.value,buttons:d.value,onClose:t[0]||(t[0]=e=>m.value=!1),onButtonClick:b},null,8,['visible','buttons']),(0,l.createCommentVNode)(' Tab浮窗（放在 actions-area 内，贴着 action 按钮显示） '),(0,l.renderSlot)(a.$slots,'tabs-popup')])],2)],2))}}),Ft=jt,Pt={class:'acu-tab-bar'},Lt=['title','draggable','onClick','onDragstart','onDragover','onDrop'],Rt=(0,l.defineComponent)({__name:'TabBar',props:{tabs:{},activeTab:{},showDashboard:{type:Boolean,default:!0},hasOptionsTabs:{type:Boolean,default:!1},hasRelationshipGraph:{type:Boolean,default:!1},isEditingOrder:{type:Boolean,default:!1},gridColumns:{default:'repeat(auto-fill, minmax(90px, 1fr))'}},emits:['tab-change','order-change','exit-editing'],setup(e,{expose:a,emit:t}){const o=e,n=t,r=Ma(),i=wa(),c=(0,l.ref)([]);function s(e){return e===Ua||e===Da||e===Ia}const u=(0,l.computed)(()=>{const e=r.visibleTabs;if(!e||0===e.length){const e=[];return o.showDashboard&&e.push({id:Ua,name:'仪表盘',icon:'fas fa-home'}),e.push(...c.value),o.hasRelationshipGraph&&e.push({id:Ia,name:'关系图',icon:'fas fa-project-diagram'}),o.hasOptionsTabs&&e.push({id:Da,name:'选项',icon:'fas fa-sliders-h'}),e}return e.map(e=>function(e){return e===Ua?{id:Ua,name:'仪表盘',icon:'fas fa-home'}:e===Ia?{id:Ia,name:'关系图',icon:'fas fa-project-diagram'}:e===Da?{id:Da,name:'选项',icon:'fas fa-sliders-h'}:c.value.find(a=>a.id===e)}(e)).filter(e=>!!e&&(!(e.id===Ua&&!o.showDashboard)&&(!(e.id===Ia&&!o.hasRelationshipGraph)&&!(e.id===Da&&!o.hasOptionsTabs))))});function d(e){return i.hasTableIssues(e)}function p(e){if(d(e.name)){return`⚠️ 发现 ${i.getTableIssues(e.name).length} 个问题`}return e.name}let m=null,g=null;(0,l.watch)(()=>o.tabs,e=>{c.value=[...e]},{immediate:!0,deep:!0});const b=()=>{n('exit-editing')},f=e=>{e.target.classList.remove('dragging'),m=null,g=null};return a({getCurrentOrder:()=>c.value.map(e=>e.id),getVisibleTabs:()=>u.value.map(e=>e.id)}),(a,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',Pt,[(0,l.createCommentVNode)(' 排序提示 '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-order-controls',{visible:e.isEditingOrder}])},[(0,l.createElementVNode)('span',null,[t[1]||(t[1]=(0,l.createElementVNode)('i',{class:'fas fa-info-circle'},null,-1)),t[2]||(t[2]=(0,l.createTextVNode)(' 拖拽调整顺序，完成后点击 ',-1)),(0,l.createElementVNode)('button',{class:'acu-order-done-btn',onClick:b},[...t[0]||(t[0]=[(0,l.createElementVNode)('i',{class:'fas fa-check'},null,-1),(0,l.createTextVNode)(' 完成',-1)])])])],2),(0,l.createCommentVNode)(' Tab 网格区域 '),(0,l.createElementVNode)('div',{class:'acu-nav-tabs-area',style:(0,l.normalizeStyle)({'--acu-nav-cols':e.gridColumns})},[(0,l.createCommentVNode)(' 统一 Tab 列表（包含仪表盘、普通表格、选项面板） '),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(u.value,a=>{return(0,l.openBlock)(),(0,l.createElementBlock)('button',{key:a.id,class:(0,l.normalizeClass)(['acu-nav-btn',{'acu-nav-btn-special':s(a.id),active:e.activeTab===a.id,'drag-handle':e.isEditingOrder,'has-issues':!s(a.id)&&d(a.name),'has-ai-changes':!s(a.id)&&!d(a.name)&&(t=a.name,i.hasTableAiChanges(t))}]),title:p(a),draggable:e.isEditingOrder,onClick:(0,l.withModifiers)(e=>{return t=a.id,void(o.isEditingOrder||n('tab-change',t));var t},['stop']),onDragstart:e=>((e,a)=>{o.isEditingOrder?(m=a,e.dataTransfer&&(e.dataTransfer.effectAllowed='move',e.dataTransfer.setData('text/plain',a.id)),e.target.classList.add('dragging')):e.preventDefault()})(e,a),onDragover:(0,l.withModifiers)(e=>((e,a)=>{o.isEditingOrder&&m&&(e.preventDefault(),g=a)})(e,a),['prevent']),onDrop:e=>((e,a)=>{if(!o.isEditingOrder||!m)return;e.preventDefault();const t=c.value.findIndex(e=>e.id===m.id),r=c.value.findIndex(e=>e.id===a.id);if(-1!==t&&-1!==r&&t!==r){const[e]=c.value.splice(t,1);c.value.splice(r,0,e),n('order-change',c.value.map(e=>e.id))}m=null,g=null})(e,a),onDragend:f},[a.icon?((0,l.openBlock)(),(0,l.createElementBlock)('i',{key:0,class:(0,l.normalizeClass)(a.icon)},null,2)):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(a.name),1)],42,Lt);var t}),128))],4)]))}}),Ot=(0,l.defineComponent)({__name:'Badge',props:{value:{},type:{default:'default'}},setup(e){const a=e,t=(0,l.computed)(()=>{if('default'!==a.type)return a.type;const e=String(a.value);return/Lv\.?\s*\d+/i.test(e)?'level':/\d+(\.\d+)?%/.test(e)?'percent':'男'===e?'male':'女'===e?'female':/^[+-]?\d+(\.\d+)?$/.test(e.trim())?'number':'default'}),o=(0,l.computed)(()=>`acu-badge-${t.value}`),n=(0,l.computed)(()=>{const e=a.value;return null==e||''===e?'-':String(e)});return(e,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('span',{class:(0,l.normalizeClass)(['acu-badge',o.value])},(0,l.toDisplayString)(n.value),3))}}),Ht=(0,l.defineComponent)({__name:'InlineEditor',props:{value:{},minHeight:{default:24}},emits:['save','cancel'],setup(e,{emit:a}){const t=e,o=a,n=(0,l.ref)(),r=(0,l.ref)(String(t.value)),i=(0,l.ref)(!1),c=(0,l.ref)(!1),s=()=>{const e=window.getSelection();c.value=null!==e&&e.toString().length>0},u=()=>{const e=n.value;if(!e)return;const a=e.offsetHeight,o=e.style.visibility;e.style.visibility='hidden',e.style.height='0px';const r=e.scrollHeight,i=Math.max(r,t.minHeight);e.style.visibility=o,e.style.height=i===a&&a>0?`${a}px`:`${i}px`};(0,l.watch)(r,()=>{(0,l.nextTick)(u)});const d=()=>{if(i.value)return;i.value=!0;const e=String(t.value);r.value!==e?o('save',r.value):o('cancel')},p=e=>{'Escape'===e.key?(e.preventDefault(),e.stopPropagation(),i.value=!0,o('cancel')):'Enter'!==e.key||e.shiftKey||(e.preventDefault(),e.stopPropagation(),d())},m=e=>{e.stopPropagation()},g=e=>{s(),c.value,e.stopPropagation()};return(0,l.onMounted)(()=>{(0,l.nextTick)(()=>{const e=n.value;if(!e)return;const a=e.scrollHeight,o=Math.max(a,t.minHeight);e.style.height=`${o}px`,e.focus();const r=e.value.length;e.setSelectionRange(r,r)}),document.addEventListener('selectionchange',s)}),(0,l.onBeforeUnmount)(()=>{document.removeEventListener('selectionchange',s)}),(e,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:'acu-inline-editor',onClick:a[5]||(a[5]=(0,l.withModifiers)(()=>{},['stop'])),onMousedown:a[6]||(a[6]=(0,l.withModifiers)(()=>{},['stop'])),onPointerdown:a[7]||(a[7]=(0,l.withModifiers)(()=>{},['stop']))},[(0,l.withDirectives)((0,l.createElementVNode)('textarea',{ref_key:'textareaRef',ref:n,'onUpdate:modelValue':a[0]||(a[0]=e=>r.value=e),class:'acu-edit-textarea',onBlur:d,onKeydown:p,onClick:a[1]||(a[1]=(0,l.withModifiers)(()=>{},['stop'])),onMousedown:a[2]||(a[2]=(0,l.withModifiers)(()=>{},['stop'])),onPointerdown:a[3]||(a[3]=(0,l.withModifiers)(()=>{},['stop'])),onTouchstart:m,onTouchmove:g,onTouchend:a[4]||(a[4]=(0,l.withModifiers)(()=>{},['stop']))},null,544),[[l.vModelText,r.value]])],32))}}),Gt={key:0,class:'acu-card-header'},Yt={key:0,class:'acu-card-index'},Wt={key:0,class:'fas fa-lock acu-title-lock-icon'},qt={class:'acu-card-main-grid'},Xt=['onClick'],Kt={class:'acu-grid-label'},Jt={class:'acu-grid-value'},Qt={key:0,class:'fas fa-lock acu-lock-icon'},Zt={key:0,class:'acu-card-full-area'},eo=['onClick'],ao={class:'acu-full-label'},to={class:'acu-full-value'},oo={key:1},no={key:0,class:'fas fa-lock acu-lock-icon'},ro={class:'acu-card-body'},io=['onClick'],co={class:'acu-card-label'},lo={class:'acu-card-value'},so={key:0,class:'fas fa-lock acu-lock-icon'},uo={class:'acu-pull-icon'},po={class:'acu-pull-text'},mo={key:3,class:'acu-delete-stamp'},go=(0,l.defineComponent)({__name:'DataCard',props:{data:{},tableId:{},tableName:{},isChanged:{type:Boolean,default:!1},layout:{default:'vertical'},viewMode:{default:'card'},showIndex:{type:Boolean,default:!0},showHeader:{type:Boolean,default:!0},titleColIndex:{default:1},showHistoryButton:{type:Boolean,default:!0},customHighlights:{default:void 0}},emits:['cellClick','insertRow','toggleDelete','contextMenu','showHistory'],setup(e,{emit:a}){const t=e,o=a,n=(0,l.ref)(),r=(0,l.ref)(null),i=wa(),c=Ma(),s=ea(),u=(0,l.ref)(),d=(0,l.ref)(),p=(0,l.ref)(),m=(0,l.ref)(),{isMobile:g}=ut(),b=(0,l.ref)(!1),f=(0,l.ref)(null),v=(0,l.computed)(()=>`${t.tableName}-row-${t.data.index}`),h=(0,l.computed)(()=>i.pendingDeletes.has(v.value)),x=(0,l.computed)(()=>t.titleColIndex>=0&&t.data.cells.length>t.titleColIndex?t.data.cells[t.titleColIndex]:null),w=(0,l.computed)(()=>{let e=t.data.cells.filter((_,e)=>e>0);return t.showHeader&&x.value&&t.titleColIndex>0&&(e=e.filter((_,e)=>e+1!==t.titleColIndex)),e}),y=e=>{const a=String(e.value),t=e.key.toLowerCase();return a.length>50||t.includes('描述')||t.includes('说明')||t.includes('备注')||t.includes('内容')||t.includes('detail')||t.includes('description')},k=(0,l.computed)(()=>w.value.filter(e=>!y(e))),C=(0,l.computed)(()=>w.value.filter(e=>y(e))),N=(0,l.computed)(()=>{const e=t.data.cells.map(e=>e.key),a=t.data.cells.map(e=>String(e.value??''));return s.getRowKey(t.tableName,a,e,t.data.index)}),V=(0,l.computed)(()=>{if(!c.isLockEditMode)return!1;const e=N.value;return!!e&&s.isRowLockedPending(t.tableName,e)}),E=(0,l.computed)(()=>{if(!c.isLockEditMode||!x.value)return!1;const e=N.value;return!!e&&s.isCellLockedPending(t.tableName,e,x.value.key)});function B(e){if(t.customHighlights?.has(e))return{'acu-cell-changed':!0,'acu-cell-changed-manual':!0};const a=`${t.tableName}-${t.data.index}-${e}`,o=i.getCellChangeType(a);return{'acu-cell-changed':null!==o,'acu-cell-changed-manual':'manual'===o,'acu-cell-changed-ai':'ai'===o}}const S=(0,l.computed)(()=>{const e=i.getRowChangeType(t.tableName,t.data.index,t.data.cells.length);return'manual'===e?'acu-highlight-changed acu-highlight-manual':'ai'===e?'acu-highlight-changed acu-highlight-ai':''}),{isSelecting:A,shouldBlockInteraction:T,wasSelecting:U}=function(){const{text:e}=Q(),a=(0,l.computed)(()=>e.value.length>0),t=(0,l.ref)(!1),o=(0,l.ref)(null);return(0,l.watch)(a,e=>{!e&&t.value?o.value=setTimeout(()=>{t.value=!1},100):e&&(t.value=!0,o.value&&(clearTimeout(o.value),o.value=null))}),{selectedText:e,isSelecting:a,wasSelecting:(0,l.computed)(()=>t.value),shouldBlockInteraction:()=>a.value||t.value,clearSelection:()=>{const e=window.getSelection();e&&e.removeAllRanges()}}}(),{isSwiping:D,gestureType:I,atStart:M,atEnd:j,checkScrollEdge:F,lengthX:P,lengthY:L}=function(e,a){const{layout:t,onInsertRow:o,onToggleDelete:n,horizontalThreshold:r=50,verticalThreshold:i=40,edgeThreshold:c=5,longPressDelay:s=400,longPressCancelThreshold:u=5}=a,d='horizontal'===t?r:i,{text:p}=Q(),m=(0,l.computed)(()=>p.value.length>0),g=(0,l.ref)(!1),b=(0,l.ref)(!1),f=(0,l.ref)(!1),v=(0,l.ref)(null),h=(0,l.ref)(!1),x=(0,l.ref)(0),w=(0,l.ref)(0),y=(0,l.ref)(0),k=(0,l.ref)(0),C=(0,l.ref)(null),N=(0,l.ref)(!1),V=(0,l.ref)(0),E=(0,l.ref)(null),B=(0,l.ref)(!1),S=(0,l.ref)(null),A=(0,l.ref)(!1),T=a=>{const o=a?.currentTarget,n=o||e.value;n&&('horizontal'===t?(b.value=n.scrollTop<=c,f.value=n.scrollTop+n.clientHeight>=n.scrollHeight-c):(b.value=n.scrollLeft<=c,f.value=n.scrollLeft+n.clientWidth>=n.scrollWidth-c),g.value=b.value||f.value)},U=()=>{const e=window.getSelection();return!!e&&e.toString().length>0},D=(0,l.computed)(()=>m.value||U()),I=a=>{const o=e.value;if(!o)return;B.value=!1,A.value=!1,v.value=null,C.value=null,N.value=!1,S.value&&(clearTimeout(S.value),S.value=null),U()&&(B.value=!0);const n=a.touches[0];if(x.value=n.clientX,w.value=n.clientY,y.value=0,k.value=0,h.value=!0,'horizontal'===t){const e=o.closest('.acu-data-display');E.value=e,V.value=e?.scrollLeft??0}T(),S.value=setTimeout(()=>{A.value=!0,B.value=!0},s)},M=a=>{const o=e.value;if(!o||!h.value)return;const n=a.touches[0],r=n.clientX-x.value,i=n.clientY-w.value;y.value=r,k.value=i,(Math.abs(r)>u||Math.abs(i)>u)&&S.value&&(clearTimeout(S.value),S.value=null);const c=U();if(B.value||A.value||c)B.value=!0;else if(T(),!C.value&&(Math.abs(r)>10||Math.abs(i)>10)&&(C.value=Math.abs(r)>Math.abs(i)?'horizontal':'vertical',console.info('[ACU Card] 方向锁定为:',C.value)),'horizontal'===t){const e=o.scrollTop,t=o.scrollHeight,n=o.clientHeight;if(t<=n+2){if(Math.abs(i)>=Math.abs(r)&&Math.abs(i)>5){a.cancelable&&a.preventDefault(),a.stopPropagation();const e=i>0?'insert':'delete';.6*Math.abs(i)>30?N.value||(v.value=e,N.value=!0):N.value||(v.value=null)}else N.value||(v.value=null,E.value&&Math.abs(r)>Math.abs(i)&&(E.value.scrollLeft=V.value-r));return}if('horizontal'===C.value)return N.value||(v.value=null),void(E.value&&(E.value.scrollLeft=V.value-r));if('vertical'===C.value){const o=i>0&&e<=0;if(o||i<0&&e+n>=t-1){a.cancelable&&a.preventDefault(),a.stopPropagation();const e=o?'insert':'delete';.6*Math.abs(i)>30?N.value||(v.value=e,N.value=!0):N.value||(v.value=null)}else N.value||(v.value=null)}}else if('vertical'===t&&Math.abs(r)>Math.abs(i)&&Math.abs(r)>10){a.cancelable&&a.preventDefault(),a.stopPropagation();const e=.7*Math.abs(r);v.value=r>0&&e>28?'delete':r<0&&e>28?'insert':null}},j=a=>{const r=e.value;if(!r)return;if(S.value&&(clearTimeout(S.value),S.value=null),A.value||U())return B.value=!0,h.value=!1,void(v.value=null);if(B.value)return h.value=!1,void(v.value=null);const i=y.value,c=k.value;if('horizontal'===t){const e=r.scrollTop,a=r.scrollHeight,t=r.clientHeight,i=a<=t+2,l=c<0&&(e+t>=a-1||i);c>0&&(e<=0||i)&&c>d?(console.info('[ACU Card] 下拉触发新增行 (deltaY:',c,')'),o()):l&&Math.abs(c)>d&&(console.info('[ACU Card] 上划触发删除切换 (deltaY:',c,')'),n())}else'vertical'===t&&(i>d?(console.info('[ACU Card] 右滑触发删除切换 (deltaX:',i,')'),n()):i<-d&&(console.info('[ACU Card] 左滑触发新增行 (deltaX:',i,')'),o()));setTimeout(()=>{v.value=null,N.value=!1},300),h.value=!1};return(0,l.watch)(e,(e,a)=>{a&&(a.removeEventListener('touchstart',I),a.removeEventListener('touchmove',M),a.removeEventListener('touchend',j)),e&&(e.addEventListener('touchstart',I,{passive:!0}),e.addEventListener('touchmove',M,{passive:!1}),e.addEventListener('touchend',j,{passive:!0}),T())},{immediate:!0}),(0,l.onUnmounted)(()=>{const a=e.value;a&&(a.removeEventListener('touchstart',I),a.removeEventListener('touchmove',M),a.removeEventListener('touchend',j)),S.value&&(clearTimeout(S.value),S.value=null)}),{isSelecting:D,scrolledToEdge:g,atStart:b,atEnd:f,isSwiping:h,gestureType:v,checkScrollEdge:T,lengthX:y,lengthY:k,shouldBlockClick:B,isSelectionMode:A}}(n,{layout:t.layout,horizontalThreshold:50,verticalThreshold:40,edgeThreshold:10,onInsertRow:()=>{console.info('[ACU DataCard] 手势触发新增行'),o('insertRow')},onToggleDelete:()=>{console.info('[ACU DataCard] 手势触发切换删除',{isDeleting:h.value}),o('toggleDelete')}}),R=(0,l.computed)(()=>{if('horizontal'!==t.layout)return 0;const e=Math.abs(L?.value||0);return Math.min(.6*e,120)}),O=(0,l.computed)(()=>Math.min(R.value/80,1)),H=(0,l.computed)(()=>{if('vertical'!==t.layout)return 0;const e=Math.abs(P?.value||0);return Math.min(.7*e,120)}),G=(0,l.computed)(()=>Math.min(H.value/60,1));(0,l.watchEffect)(()=>{u.value&&(u.value.style.height=`${R.value}px`,u.value.style.opacity=String(O.value)),d.value&&(d.value.style.height=`${R.value}px`,d.value.style.opacity=String(O.value))}),(0,l.watchEffect)(()=>{p.value&&(p.value.style.width=`${H.value}px`,p.value.style.opacity=String(G.value)),m.value&&(m.value.style.width=`${H.value}px`,m.value.style.opacity=String(G.value))}),(0,l.watch)([M,j],([e,a])=>{g.value&&(e||a)&&(f.value&&clearTimeout(f.value),b.value=!0,f.value=setTimeout(()=>{b.value=!1},2e3))});const Y=e=>{F(e)};function W(e){if(!c.isLockEditMode)return{};const a=t.data.cells[e];if(!a)return{};const o=N.value;if(!o)return{};const n=s.isCellLockedPending(t.tableName,o,a.key),r=s.isRowLockedPending(t.tableName,o);return{'acu-cell-locked':n||r,'acu-cell-row-locked':r}}const q=()=>{const e=N.value;if(!e)return void console.warn('[ACU] 无法生成行键，跳过整行锁定');const a=t.data.cells.map(e=>e.key),o=t.data.cells.map(e=>String(e.value??'')),n=s.toggleRowLock(t.tableName,e,a,o);console.info(`[ACU] 整行锁定状态切换: ${e} -> ${n?'锁定':'解锁'}`)},X=e=>{if(T()||U.value)console.info('[ACU] 检测到选词操作或刚结束选词，阻止点击事件');else if(D.value)console.info('[ACU] 滑动中，阻止点击事件');else if(h.value)console.info('[ACU] 待删除行不能编辑');else{if(c.isLockEditMode){const a=t.data.cells[e];if(!a)return;const o=N.value;if(!o)return void console.warn('[ACU] 无法生成行键，跳过锁定操作');const n=String(a.value??''),r=s.toggleCellLock(t.tableName,o,a.key,n);return void console.info(`[ACU] 单元格锁定状态切换: ${a.key} -> ${r?'锁定':'解锁'}`)}r.value=e,o('cellClick',t.data.index,e)}},K=()=>{if(!(t.titleColIndex<0)&&x.value)if(h.value)console.info('[ACU] 待删除行不能操作标题');else{if(c.isLockEditMode){const e=N.value;if(!e)return void console.warn('[ACU] 无法生成行键，跳过标题锁定操作');const a=String(x.value.value??''),o=s.toggleCellLock(t.tableName,e,x.value.key,a);return void console.info(`[ACU] 标题锁定状态切换: ${x.value.key} -> ${o?'锁定':'解锁'}`)}console.info('[ACU DataCard] 标题点击，触发编辑 colIndex:',t.titleColIndex),r.value=t.titleColIndex,o('cellClick',t.data.index,t.titleColIndex)}},J=(e,a)=>{i.updateCell(t.tableName,t.data.index,e,a);const o=t.data.cells[e],n=N.value;o&&n&&s.isCellLocked(t.tableName,n,o.key)&&(s.updateLockedValue(t.tableName,n,o.key,a),console.info('[ACU] 同步更新锁定值:',o.key,'->',a)),r.value=null},Z=e=>{/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?console.info('[ACU] 移动端不触发右键菜单'):o('contextMenu',e,t.data.index)};return(a,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{ref_key:'cardRef',ref:n,class:(0,l.normalizeClass)(['acu-data-card',[S.value,{'acu-editing-lock':null!==r.value,'acu-style-list':'list'===e.viewMode,'acu-style-card':'card'===e.viewMode,'acu-swiping':(0,l.unref)(D)}]]),onContextmenu:(0,l.withModifiers)(Z,['prevent']),onScroll:Y},[(0,l.createCommentVNode)(' 横向布局：顶部下拉新增提示（必须在最前面，与原版 prepend 一致） '),(0,l.createCommentVNode)(' 注意：使用 v-show 替代 v-if 保持 DOM 存在，配合 watchEffect 直接操作样式 '),(0,l.withDirectives)((0,l.createElementVNode)('div',{ref_key:'pullTopRef',ref:u,class:'acu-pull-overlay acu-pull-top'},[...t[6]||(t[6]=[(0,l.createElementVNode)('div',{class:'acu-pull-icon'},[(0,l.createElementVNode)('i',{class:'fa-solid fa-plus'}),(0,l.createElementVNode)('span',{class:'acu-pull-text'},'新增一行')],-1)])],512),[[l.vShow,'horizontal'===e.layout&&(0,l.unref)(g)&&'insert'===(0,l.unref)(I)]]),(0,l.createCommentVNode)(' 卡片头部（可选显示索引和标题） '),e.showHeader?((0,l.openBlock)(),(0,l.createElementBlock)('div',Gt,[e.showIndex?((0,l.openBlock)(),(0,l.createElementBlock)('span',Yt,'#'+(0,l.toDisplayString)(e.data.index+1),1)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 标题编辑模式 '),x.value&&r.value===e.titleColIndex&&!(0,l.unref)(c).isLockEditMode?((0,l.openBlock)(),(0,l.createBlock)(Ht,{key:1,class:'acu-title-editor',value:x.value.value,onSave:t[0]||(t[0]=a=>J(e.titleColIndex,a)),onCancel:t[1]||(t[1]=e=>r.value=null)},null,8,['value'])):x.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' 标题显示模式 '),(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['acu-editable-title',{'acu-title-locked':E.value}]),onClick:K},[(0,l.createTextVNode)((0,l.toDisplayString)(x.value.value||'未命名')+' ',1),E.value?((0,l.openBlock)(),(0,l.createElementBlock)('i',Wt)):(0,l.createCommentVNode)('v-if',!0)],2)],2112)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 行锁定按钮（仅锁定编辑模式显示） '),(0,l.unref)(c).isLockEditMode?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:3,class:(0,l.normalizeClass)(['acu-row-lock-btn',{'acu-row-locked':V.value}]),title:'锁定/解锁整行',onClick:(0,l.withModifiers)(q,['stop'])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(V.value?'fas fa-lock':'fas fa-lock-open')},null,2)],2)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 历史记录按钮 '),e.showHistoryButton&&!(0,l.unref)(c).isLockEditMode?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:4,class:'acu-history-trigger',title:'查看历史记录',onClick:t[2]||(t[2]=(0,l.withModifiers)(e=>o('showHistory'),['stop']))},[...t[7]||(t[7]=[(0,l.createElementVNode)('i',{class:'fas fa-search'},null,-1)])])):(0,l.createCommentVNode)('v-if',!0)])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 卡片内容区 - Card 布局 '),'card'===e.viewMode?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' Card 单元格区域 '),(0,l.createElementVNode)('div',qt,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(k.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.colIndex,class:(0,l.normalizeClass)(['acu-grid-item',[B(e.colIndex),W(e.colIndex)]]),onClick:a=>X(e.colIndex)},[(0,l.createElementVNode)('label',Kt,(0,l.toDisplayString)(e.key),1),(0,l.createElementVNode)('div',Jt,[r.value!==e.colIndex||(0,l.unref)(c).isLockEditMode?((0,l.openBlock)(),(0,l.createBlock)(Ot,{key:1,value:e.value},null,8,['value'])):((0,l.openBlock)(),(0,l.createBlock)(Ht,{key:0,value:e.value,onSave:a=>J(e.colIndex,a),onCancel:t[3]||(t[3]=e=>r.value=null)},null,8,['value','onSave']))]),(0,l.createCommentVNode)(' 锁定图标（仅锁定编辑模式下显示） '),(0,l.unref)(c).isLockEditMode&&W(e.colIndex)['acu-cell-locked']?((0,l.openBlock)(),(0,l.createElementBlock)('i',Qt)):(0,l.createCommentVNode)('v-if',!0)],10,Xt))),128))]),(0,l.createCommentVNode)(' Full-Width 单元格区域（长文本） '),C.value.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',Zt,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(C.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.colIndex,class:(0,l.normalizeClass)(['acu-full-item',[B(e.colIndex),W(e.colIndex)]]),onClick:a=>X(e.colIndex)},[(0,l.createElementVNode)('label',ao,(0,l.toDisplayString)(e.key),1),(0,l.createElementVNode)('div',to,[r.value!==e.colIndex||(0,l.unref)(c).isLockEditMode?((0,l.openBlock)(),(0,l.createElementBlock)('span',oo,(0,l.toDisplayString)(e.value||'-'),1)):((0,l.openBlock)(),(0,l.createBlock)(Ht,{key:0,value:e.value,'max-height':300,onSave:a=>J(e.colIndex,a),onCancel:t[4]||(t[4]=e=>r.value=null)},null,8,['value','onSave']))]),(0,l.createCommentVNode)(' 锁定图标（仅锁定编辑模式下显示） '),(0,l.unref)(c).isLockEditMode&&W(e.colIndex)['acu-cell-locked']?((0,l.openBlock)(),(0,l.createElementBlock)('i',no)):(0,l.createCommentVNode)('v-if',!0)],10,eo))),128))])):(0,l.createCommentVNode)('v-if',!0)],64)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' 卡片内容区 - List 布局 '),(0,l.createElementVNode)('div',ro,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(w.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.colIndex,class:(0,l.normalizeClass)(['acu-card-row',[B(e.colIndex),W(e.colIndex)]]),onClick:a=>X(e.colIndex)},[(0,l.createElementVNode)('label',co,(0,l.toDisplayString)(e.key)+':',1),(0,l.createElementVNode)('div',lo,[r.value!==e.colIndex||(0,l.unref)(c).isLockEditMode?((0,l.openBlock)(),(0,l.createBlock)(Ot,{key:1,value:e.value},null,8,['value'])):((0,l.openBlock)(),(0,l.createBlock)(Ht,{key:0,value:e.value,onSave:a=>J(e.colIndex,a),onCancel:t[5]||(t[5]=e=>r.value=null)},null,8,['value','onSave']))]),(0,l.createCommentVNode)(' 锁定图标（仅锁定编辑模式下显示） '),(0,l.unref)(c).isLockEditMode&&W(e.colIndex)['acu-cell-locked']?((0,l.openBlock)(),(0,l.createElementBlock)('i',so)):(0,l.createCommentVNode)('v-if',!0)],10,io))),128))])],64)),(0,l.createCommentVNode)(' 横向布局：底部上划删除提示（在内容区域之后，与原版 append 一致） '),(0,l.createCommentVNode)(' 注意：使用 v-show 替代 v-if 保持 DOM 存在，配合 watchEffect 直接操作样式 '),(0,l.withDirectives)((0,l.createElementVNode)('div',{ref_key:'pullBottomRef',ref:d,class:(0,l.normalizeClass)(['acu-pull-overlay acu-pull-bottom',{'acu-pull-restore':h.value}])},[(0,l.createElementVNode)('div',uo,[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(h.value?'fa-solid fa-undo':'fa-solid fa-trash')},null,2),(0,l.createElementVNode)('span',po,(0,l.toDisplayString)(h.value?'撤销删除':'删除本行'),1)])],2),[[l.vShow,'horizontal'===e.layout&&(0,l.unref)(g)&&'delete'===(0,l.unref)(I)]]),(0,l.createCommentVNode)(' 待删除印章 (圆形印章样式，与原代码 .acu-badge-pending 保持一致) '),h.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',mo,'待删除')):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 竖向布局：左右滑动反馈（与原版 .acu-swipe-overlay 一致） '),(0,l.createCommentVNode)(' 注意：使用 v-show 替代 v-if 保持 DOM 存在，配合 watchEffect 直接操作样式 '),'vertical'===e.layout&&(0,l.unref)(g)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:4},[(0,l.createCommentVNode)(' 左侧右滑删除提示 '),(0,l.withDirectives)((0,l.createElementVNode)('div',{ref_key:'swipeLeftRef',ref:p,class:(0,l.normalizeClass)(['acu-swipe-overlay acu-swipe-left',{'acu-swipe-restore':h.value}])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(h.value?'fa-solid fa-undo':'fa-solid fa-trash')},null,2)],2),[[l.vShow,'delete'===(0,l.unref)(I)]]),(0,l.createCommentVNode)(' 右侧左滑新增提示 '),(0,l.withDirectives)((0,l.createElementVNode)('div',{ref_key:'swipeRightRef',ref:m,class:'acu-swipe-overlay acu-swipe-right'},[...t[8]||(t[8]=[(0,l.createElementVNode)('i',{class:'fa-solid fa-plus'},null,-1)])],512),[[l.vShow,'insert'===(0,l.unref)(I)]])],64)):(0,l.createCommentVNode)('v-if',!0)],34))}}),bo=['draggable'],fo={class:'acu-dash-title'},vo={class:'acu-dash-title-text'},ho={key:0,class:'acu-dash-count'},xo={key:0,class:'acu-dash-actions'},wo=['title','onClick'],yo={key:0,class:'acu-dash-npc-grid'},ko=['onClick'],Co={class:'acu-dash-list'},No=['onClick'],Vo={class:'acu-dash-list-text'},Eo={key:0,class:'acu-dash-list-badge'},zo={class:'acu-dash-compact'},Bo={class:'acu-dash-stat-label'},So={class:'acu-dash-empty'},Ao=(0,l.defineComponent)({__name:'DashboardWidget',props:{config:{},tableData:{},isEditing:{type:Boolean},diffMap:{}},emits:['navigate','row-click','action','remove','resize','config-actions','drag-start','drag-end','drop'],setup(e,{emit:a}){const t=e,o=a,n=((0,l.computed)(()=>t.tableData?.rows.length??0),(0,l.computed)(()=>i.value.length)),r=(0,l.computed)(()=>t.tableData?.name?t.tableData.name:t.config.title),i=(0,l.computed)(()=>t.tableData?t.tableData.rows:[]),c=(0,l.computed)(()=>({'acu-dash-body-scrollable':!0}));function s(e){const{displayColumns:a}=t.config;if(a.length>0)for(const t of a){const a=e.cells.find(e=>e.key.toLowerCase().includes(t.toLowerCase()));if(a&&a.value)return String(a.value)}const o=e.cells.find(e=>e.value&&String(e.value).trim());return o?String(o.value):`行 ${e.index+1}`}function u(e){const{displayColumns:a}=t.config,o=s(e);if(a.length>1)for(let t=1;t<a.length;t++){const n=a[t],r=e.cells.find(e=>e.key.toLowerCase().includes(n.toLowerCase()));if(r&&r.value){const e=String(r.value);if(e!==o)return e}}return null}function d(e){return e.cells[0]?.value?String(e.cells[0].value):`项 ${e.index+1}`}function p(e){return e.cells[1]?.value?String(e.cells[1].value):'-'}function m(e){if(!t.config.tableId)return!1;const a=`${t.config.tableId}:${e.key}`;return t.diffMap.has(a)}function g(e){return me[e]?.icon??'fa-question'}function b(e){return me[e]?.tooltip??e}function f(e){t.config.tableId&&o('row-click',t.config.tableId,e)}function v(e){e.preventDefault();const a=1===t.config.colSpan?2:1;o('resize',t.config.id,a)}function h(e){t.isEditing?(e.dataTransfer?.setData('text/plain',t.config.id),o('drag-start',t.config.id)):e.preventDefault()}function x(){o('drag-end')}function w(e){e.preventDefault(),o('drop',t.config.id)}return(a,y)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['acu-dash-widget',{'acu-dash-widget-wide':2===e.config.colSpan,'acu-dash-widget-editing':e.isEditing}]),draggable:e.isEditing,onDragstart:h,onDragend:x,onDragover:y[2]||(y[2]=(0,l.withModifiers)(()=>{},['prevent'])),onDrop:w},[(0,l.createCommentVNode)(' 编辑控件 (仅编辑态显示) '),e.isEditing?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:0},[(0,l.createElementVNode)('button',{class:'acu-widget-remove',title:'移除组件',onClick:y[0]||(y[0]=(0,l.withModifiers)(a=>o('remove',e.config.id),['stop']))},[...y[3]||(y[3]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1)])]),(0,l.createElementVNode)('button',{class:'acu-widget-config',title:'配置快捷按钮',onClick:y[1]||(y[1]=(0,l.withModifiers)(a=>o('config-actions',e.config.id),['stop']))},[...y[4]||(y[4]=[(0,l.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])]),(0,l.createElementVNode)('div',{class:'acu-widget-resize',title:'拖动改变大小',onMousedown:(0,l.withModifiers)(v,['stop']),onTouchstart:(0,l.withModifiers)(v,['stop'])},[...y[5]||(y[5]=[(0,l.createElementVNode)('i',{class:'fas fa-expand-alt'},null,-1)])],32)],64)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 头部 '),(0,l.createElementVNode)('div',fo,[(0,l.createElementVNode)('span',vo,[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fas',e.config.icon])},null,2),(0,l.createTextVNode)(' '+(0,l.toDisplayString)(r.value)+' ',1),n.value>0?((0,l.openBlock)(),(0,l.createElementBlock)('span',ho,(0,l.toDisplayString)(n.value),1)):(0,l.createCommentVNode)('v-if',!0)]),!e.isEditing&&e.config.actions.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',xo,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.config.actions,e=>((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:e,class:'acu-dash-action-btn',title:b(e),onClick:(0,l.withModifiers)(a=>function(e){t.config.tableId&&o('action',e,t.config.tableId)}(e),['stop'])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fas',g(e)])},null,2)],8,wo))),128))])):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' 内容区 (可滚动) '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-dash-body',c.value])},[e.tableData&&i.value.length>0?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:0},[(0,l.createCommentVNode)(' 网格式展示 (NPC风格) '),'grid'===e.config.displayStyle?((0,l.openBlock)(),(0,l.createElementBlock)('div',yo,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(i.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.key,class:(0,l.normalizeClass)(['acu-dash-npc-item acu-dash-interactive',{'acu-highlight-changed':m(e)}]),onClick:(0,l.withModifiers)(a=>f(e),['stop'])},(0,l.toDisplayString)(s(e)),11,ko))),128))])):'list'===e.config.displayStyle?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' 列表式展示 (任务风格) '),(0,l.createElementVNode)('div',Co,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(i.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.key,class:(0,l.normalizeClass)(['acu-dash-list-item acu-dash-interactive',{'acu-highlight-changed':m(e)}]),onClick:(0,l.withModifiers)(a=>f(e),['stop'])},[y[6]||(y[6]=(0,l.createElementVNode)('i',{class:'fas fa-circle',style:{'font-size':'6px'}},null,-1)),(0,l.createElementVNode)('span',Vo,(0,l.toDisplayString)(s(e)),1),u(e)?((0,l.openBlock)(),(0,l.createElementBlock)('span',Eo,(0,l.toDisplayString)(u(e)),1)):(0,l.createCommentVNode)('v-if',!0)],10,No))),128))])],2112)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' 紧凑式展示 (状态栏风格) '),(0,l.createElementVNode)('div',zo,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(i.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.key,class:'acu-dash-stat-row'},[(0,l.createElementVNode)('span',Bo,(0,l.toDisplayString)(d(e)),1),(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['acu-dash-stat-val',{'acu-highlight-changed':m(e)}])},(0,l.toDisplayString)(p(e)),3)]))),128))])],2112))],64)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' 空状态 '),(0,l.createElementVNode)('div',So,[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fas',e.config.icon])},null,2),y[7]||(y[7]=(0,l.createElementVNode)('span',null,'暂无数据',-1))])],2112))],2)],42,bo))}}),To=Ao,Uo={class:'acu-sortable-list'},Do=['onClick'],Io={class:'acu-sort-controls'},Mo=['disabled','onClick'],_o=['disabled','onClick'],$o={class:'acu-item-content'},jo=['onClick'],Fo={key:0,class:'acu-sortable-empty'},Po=(0,l.defineComponent)({__name:'SortableList',props:{items:{},selectedId:{default:''},showRemove:{type:Boolean,default:!0}},emits:['reorder','remove','select'],setup(e,{emit:a}){const t=e,o=a;return(a,n)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',Uo,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.items,(a,r)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:a.id,class:(0,l.normalizeClass)(['acu-sortable-item',{selected:e.selectedId===a.id}]),onClick:e=>o('select',a)},[(0,l.createCommentVNode)(' 移动按钮 '),(0,l.createElementVNode)('div',Io,[(0,l.createElementVNode)('button',{class:'acu-sort-btn',disabled:0===r,title:'上移',onClick:(0,l.withModifiers)(e=>(e=>{if(0===e)return;const a=[...t.items];[a[e-1],a[e]]=[a[e],a[e-1]],o('reorder',a)})(r),['stop'])},[...n[0]||(n[0]=[(0,l.createElementVNode)('i',{class:'fas fa-chevron-up'},null,-1)])],8,Mo),(0,l.createElementVNode)('button',{class:'acu-sort-btn',disabled:r===e.items.length-1,title:'下移',onClick:(0,l.withModifiers)(e=>(e=>{if(e===t.items.length-1)return;const a=[...t.items];[a[e],a[e+1]]=[a[e+1],a[e]],o('reorder',a)})(r),['stop'])},[...n[1]||(n[1]=[(0,l.createElementVNode)('i',{class:'fas fa-chevron-down'},null,-1)])],8,_o)]),(0,l.createCommentVNode)(' 项目内容 '),(0,l.createElementVNode)('div',$o,[a.icon?((0,l.openBlock)(),(0,l.createElementBlock)('i',{key:0,class:(0,l.normalizeClass)(['fas',a.icon])},null,2)):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(a.name||a.label),1)]),(0,l.createCommentVNode)(' 删除按钮 '),e.showRemove?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'acu-remove-btn',title:'移除',onClick:(0,l.withModifiers)(e=>(e=>{o('remove',t.items[e])})(r),['stop'])},[...n[2]||(n[2]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1)])],8,jo)):(0,l.createCommentVNode)('v-if',!0)],10,Do))),128)),(0,l.createCommentVNode)(' 空状态 '),0===e.items.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',Fo,[(0,l.renderSlot)(a.$slots,'empty',{},()=>[n[3]||(n[3]=(0,l.createElementVNode)('span',null,'暂无项目',-1))])])):(0,l.createCommentVNode)('v-if',!0)]))}});c(773);const Lo=(0,Bt.A)(Po,[['__scopeId','data-v-23a88fea']]),Ro={class:'acu-modal acu-dashboard-sort-modal'},Oo={class:'acu-modal-header'},Ho={class:'acu-modal-body'},Go=(0,l.defineComponent)({__name:'DashboardSortDialog',props:{tables:{}},emits:['close'],setup(e,{emit:a}){const t=e,o=a,n=xt(),r=(0,l.computed)(()=>n.enabledWidgets.map(e=>{const a=t.tables.find(a=>a.id===e.tableId),o=a?a.name:e.title||e.tableId;return{id:e.id,name:o,icon:e.icon,originalOrder:e.order}}));function i(e){e.forEach((e,a)=>{n.updateWidget(e.id,{order:a})})}return(e,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:'acu-modal-container',onClick:a[1]||(a[1]=(0,l.withModifiers)(e=>o('close'),['self']))},[(0,l.createElementVNode)('div',Ro,[(0,l.createElementVNode)('div',Oo,[a[2]||(a[2]=(0,l.createElementVNode)('span',{class:'acu-modal-title'},[(0,l.createElementVNode)('i',{class:'fas fa-sort'}),(0,l.createTextVNode)(' 调整看板顺序 ')],-1)),(0,l.createElementVNode)('button',{class:'acu-close-pill',onClick:a[0]||(a[0]=(0,l.withModifiers)(e=>o('close'),['stop']))},'完成')]),(0,l.createElementVNode)('div',Ho,[a[3]||(a[3]=(0,l.createElementVNode)('div',{class:'acu-sort-hint'},'使用上下箭头调整看板显示顺序',-1)),(0,l.createVNode)(Lo,{items:r.value,'show-remove':!1,onReorder:i},null,8,['items'])])])]))}});c(727);const Yo=Go,Wo=Yo,qo={class:'acu-dash-container-new'},Xo={class:'acu-dash-header'},Ko={class:'acu-dash-header-actions'},Jo={class:'acu-search-box'},Qo={key:0,class:'acu-dash-empty-state'},Zo={class:'acu-modal acu-add-widget-modal'},en={class:'acu-modal-header'},an={class:'acu-modal-body'},tn={class:'acu-add-widget-list'},on=['onClick'],nn={class:'acu-add-widget-name'},rn={key:0,class:'acu-add-widget-badge'},cn={key:1,class:'acu-add-widget-count'},ln={class:'acu-modal acu-actions-config-modal'},sn={class:'acu-modal-header'},un={class:'acu-modal-body'},dn={class:'acu-actions-list'},pn=['checked','onChange'],mn=(0,l.defineComponent)({__name:'Dashboard',props:{tables:{}},emits:['navigate','rowClick','showRelationshipGraph','action'],setup(e,{emit:a}){const t=e,o=a,n=wa(),r=xt(),i=(0,l.ref)(!1),c=(0,l.ref)(!1),s=(0,l.ref)(!1),u=(0,l.ref)(''),d=(0,l.ref)(null),p=(0,l.ref)(null),m=(0,l.ref)(null),g=(0,l.ref)(null),b=(0,l.computed)(()=>r.enabledWidgets),f=(0,l.computed)(()=>n.diffMap),v=(0,l.computed)(()=>t.tables),h=(0,l.computed)(()=>Object.values(me)),x=(0,l.computed)(()=>d.value?r.config.widgets.find(e=>e.id===d.value):null),w=(0,l.computed)(()=>c.value||s.value||null!==d.value);function y(e){return r.hasWidget(e)}function k(e){for(const[a,t]of Object.entries(be))if(t.some(a=>e.toLowerCase().includes(a.toLowerCase()))){const a=r.config.widgets.find(a=>a.tableId===e);return a?.icon??'fa-table'}return'fa-table'}function C(){i.value=!0}function N(){i.value=!1,p.value=null,m.value=null}function V(e){r.removeWidget(e)}function E(e,a){r.updateWidget(e,{colSpan:a})}function B(e){d.value=e}function S(e){return x.value?.actions.includes(e)??!1}function A(e){p.value=e}function T(){p.value=null,m.value=null}function U(e){if(!p.value||p.value===e)return;const a=r.config.widgets.find(a=>a.id===e);a&&r.moveWidget(p.value,a.order),p.value=null,m.value=null}function D(e){o('navigate',e)}function I(e,a){o('rowClick',e,a)}function M(e,a){switch(e){case'goToTable':o('navigate',a);break;case'relationshipGraph':o('showRelationshipGraph');break;default:o('action',e,a)}}return(0,l.watch)(w,e=>{const{$}=Pe();e?$('.acu-data-display').addClass('has-modal'):$('.acu-data-display').removeClass('has-modal')}),(0,l.onMounted)(async()=>{await r.loadConfig(),0===r.config.widgets.length&&function(){for(const e of t.tables)for(const[,a]of Object.entries(be))if(a.some(a=>e.id.toLowerCase().includes(a.toLowerCase())||e.name.includes(a))){r.addWidget(e.id);break}}()}),(0,l.watch)(()=>t.tables,()=>{}),(a,o)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',qo,[(0,l.createCommentVNode)(' 顶栏 '),(0,l.createElementVNode)('div',Xo,[o[14]||(o[14]=(0,l.createElementVNode)('div',{class:'acu-dash-header-left'},[(0,l.createElementVNode)('span',{class:'acu-dash-header-title'},[(0,l.createElementVNode)('i',{class:'fas fa-th-large'}),(0,l.createTextVNode)(' 仪表盘 ')])],-1)),(0,l.createElementVNode)('div',Ko,[(0,l.createCommentVNode)(' 搜索框 '),(0,l.createElementVNode)('div',Jo,[o[10]||(o[10]=(0,l.createElementVNode)('i',{class:'fas fa-search acu-search-icon'},null,-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':o[0]||(o[0]=e=>u.value=e),type:'text',class:'acu-search-input',placeholder:'搜索...'},null,512),[[l.vModelText,u.value]]),u.value?((0,l.openBlock)(),(0,l.createElementBlock)('i',{key:0,class:'fas fa-times acu-search-clear',onClick:o[1]||(o[1]=e=>u.value='')})):(0,l.createCommentVNode)('v-if',!0)]),i.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:0},[(0,l.createElementVNode)('button',{class:'acu-dash-add-widget-btn',title:'添加看板',onClick:o[2]||(o[2]=(0,l.withModifiers)(e=>c.value=!0,['stop']))},[...o[11]||(o[11]=[(0,l.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])]),(0,l.createElementVNode)('button',{class:'acu-dash-sort-btn',title:'调整顺序',onClick:o[3]||(o[3]=(0,l.withModifiers)(e=>s.value=!0,['stop']))},[...o[12]||(o[12]=[(0,l.createElementVNode)('i',{class:'fas fa-sort'},null,-1)])]),(0,l.createElementVNode)('button',{class:'acu-dash-done-btn',onClick:(0,l.withModifiers)(N,['stop'])},'完成')],64)):((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:1,class:'acu-dash-edit-btn',title:'编辑仪表盘',onClick:(0,l.withModifiers)(C,['stop'])},[...o[13]||(o[13]=[(0,l.createElementVNode)('i',{class:'fas fa-edit'},null,-1)])]))])]),(0,l.createCommentVNode)(' 组件网格 '),(0,l.createElementVNode)('div',{ref_key:'gridRef',ref:g,class:'acu-dash-grid'},[(0,l.createCommentVNode)(' 动态配置的看板 '),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(b.value,e=>{return(0,l.openBlock)(),(0,l.createBlock)((0,l.unref)(To),{key:e.id,config:e,'table-data':(a=e.tableId,a?t.tables.find(e=>e.id===a)??null:null),'is-editing':i.value,'diff-map':f.value,class:(0,l.normalizeClass)({'acu-dash-widget-dragging':p.value===e.id,'acu-dash-widget-drop-target':m.value===e.id}),onNavigate:D,onRowClick:I,onAction:M,onRemove:V,onResize:E,onConfigActions:B,onDragStart:A,onDragEnd:T,onDrop:U},null,8,['config','table-data','is-editing','diff-map','class']);var a}),128)),(0,l.createCommentVNode)(' 空状态 - 没有配置任何看板 '),0===b.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',Qo,[o[16]||(o[16]=(0,l.createElementVNode)('i',{class:'fas fa-layer-group'},null,-1)),o[17]||(o[17]=(0,l.createElementVNode)('p',null,'还没有配置任何看板',-1)),(0,l.createElementVNode)('button',{class:'acu-dash-add-first-btn',onClick:o[4]||(o[4]=(0,l.withModifiers)(e=>c.value=!0,['stop']))},[...o[15]||(o[15]=[(0,l.createElementVNode)('i',{class:'fas fa-plus'},null,-1),(0,l.createTextVNode)(' 添加第一个看板 ',-1)])])])):(0,l.createCommentVNode)('v-if',!0)],512),(0,l.createCommentVNode)(' 添加组件弹窗 (不使用 Teleport，因为 Vue 应用已挂载到父窗口) '),c.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-modal-container',onClick:o[6]||(o[6]=(0,l.withModifiers)(e=>c.value=!1,['self']))},[(0,l.createElementVNode)('div',Zo,[(0,l.createElementVNode)('div',en,[o[18]||(o[18]=(0,l.createElementVNode)('span',{class:'acu-modal-title'},'添加看板',-1)),(0,l.createElementVNode)('button',{class:'acu-close-pill',onClick:o[5]||(o[5]=(0,l.withModifiers)(e=>c.value=!1,['stop']))},'关闭')]),(0,l.createElementVNode)('div',an,[o[19]||(o[19]=(0,l.createElementVNode)('div',{class:'acu-add-widget-hint'},'选择要添加到仪表盘的表格：',-1)),(0,l.createElementVNode)('div',tn,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(v.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['acu-add-widget-item',{'acu-add-widget-item-added':y(e.id)}]),onClick:(0,l.withModifiers)(a=>{var t;y(t=e.id)||r.addWidget(t)},['stop'])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fas',k(e.id)])},null,2),(0,l.createElementVNode)('span',nn,(0,l.toDisplayString)(e.name),1),y(e.id)?((0,l.openBlock)(),(0,l.createElementBlock)('span',rn,'已添加')):((0,l.openBlock)(),(0,l.createElementBlock)('span',cn,(0,l.toDisplayString)(e.rows.length)+' 行',1))],10,on))),128))])])])])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 快捷按钮配置弹窗 (不使用 Teleport，因为 Vue 应用已挂载到父窗口) '),d.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:1,class:'acu-modal-container',onClick:o[8]||(o[8]=(0,l.withModifiers)(e=>d.value=null,['self']))},[(0,l.createElementVNode)('div',ln,[(0,l.createElementVNode)('div',sn,[o[20]||(o[20]=(0,l.createElementVNode)('span',{class:'acu-modal-title'},'配置快捷按钮',-1)),(0,l.createElementVNode)('button',{class:'acu-close-pill',onClick:o[7]||(o[7]=(0,l.withModifiers)(e=>d.value=null,['stop']))},'完成')]),(0,l.createElementVNode)('div',un,[(0,l.createElementVNode)('div',dn,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(h.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('label',{key:e.id,class:(0,l.normalizeClass)(['acu-action-checkbox',{active:S(e.id)}])},[(0,l.createElementVNode)('input',{type:'checkbox',checked:S(e.id),onChange:a=>function(e){if(!d.value||!x.value)return;const a=[...x.value.actions],t=a.indexOf(e);t>=0?a.splice(t,1):a.push(e),r.setWidgetActions(d.value,a)}(e.id)},null,40,pn),(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fas',e.icon])},null,2),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(e.label),1)],2))),128))])])])])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 排序弹窗 '),s.value?((0,l.openBlock)(),(0,l.createBlock)(Wo,{key:2,tables:e.tables,onClose:o[9]||(o[9]=e=>s.value=!1)},null,8,['tables'])):(0,l.createCommentVNode)('v-if',!0)]))}}),gn=mn,bn=gn,fn={class:'acu-table-toolbar'},vn={class:'acu-toolbar-left'},hn={class:'acu-table-title'},xn={class:'acu-table-count'},wn={key:0,class:'acu-table-badge acu-badge-changed'},yn={key:1,class:'acu-table-badge acu-badge-deleting'},kn={class:'acu-toolbar-right'},Cn=['title'],Nn={class:'acu-search-box'},Vn={key:0,class:'acu-empty-state'},En={key:0,class:'acu-pagination-container'},zn={class:'acu-pagination-numbers'},Bn={key:0,class:'acu-page-dots'},Sn=['onClick'],An=(0,l.defineComponent)({__name:'DataTable',props:{tableId:{},tableName:{},rows:{},headers:{default:()=>[]},searchTerm:{default:''},showIndex:{type:Boolean,default:!0},showHeader:{type:Boolean,default:!0},showPagination:{type:Boolean,default:!0},emptyText:{default:'暂无数据'},isLoading:{type:Boolean,default:!1}},emits:['cellClick','insertRow','toggleDelete','contextMenu','searchChange','pageChange','close','heightDragStart','heightReset','showHistory'],setup(e,{emit:a}){const t=e,o=a,n=wa(),r=se(),i=Ma(),c=(0,l.ref)(),s=(0,l.ref)(),u=(0,l.ref)(i.getTableStyle(t.tableName)),d=(0,l.ref)(t.searchTerm),p=(0,l.ref)(1),m=(0,l.computed)(()=>{if(t.tableName.includes('总结')||t.tableName.includes('大纲')){const e=t.headers.findIndex(e=>e&&(e.includes('索引')||e.includes('编号')||e.includes('代码')));if(e>0)return e}return 1}),g=(0,l.computed)(()=>i.isTableReversed(t.tableName)),b=(0,l.computed)(()=>{let e=t.rows;if(i.showLockedOnly&&i.isLockEditMode){const a=ea();e=e.filter(e=>{const o=e.cells.map(e=>e.key),n=e.cells.map(e=>String(e.value??'')),r=a.getRowKey(t.tableName,n,o,e.index);return!!r&&a.hasRowAnyLockPending(t.tableName,r)})}const a=d.value.toLowerCase().trim();return a?e.filter(e=>e.cells.some(e=>String(e.value).toLowerCase().includes(a))):e});function f(e){return n.getRowChangeType(t.tableName,e.index,e.cells.length)}function v(e){return'manual'===e?2:'ai'===e?1:0}const h=(0,l.computed)(()=>[...b.value].sort((e,a)=>{const t=f(e),o=f(a),n=v(t),r=v(o);return n!==r?r-n:g.value?a.index-e.index:e.index-a.index})),x=(0,l.computed)(()=>r.config.itemsPerPage||20),w=(0,l.computed)(()=>Math.max(1,Math.ceil(h.value.length/x.value))),y=(0,l.computed)(()=>{const e=(p.value-1)*x.value;return h.value.slice(e,e+x.value)}),k=(0,l.computed)(()=>t.rows.length),C=(0,l.computed)(()=>t.rows.filter(e=>B(e)).length),N=(0,l.computed)(()=>t.rows.filter(e=>{const a=`${t.tableName}-row-${e.index}`;return n.pendingDeletes.has(a)}).length),V=(0,l.computed)(()=>t.showPagination&&!1!==r.config.showPagination),E=(0,l.computed)(()=>{const e=[],a=w.value,t=p.value;if(a<=7)for(let t=1;t<=a;t++)e.push(t);else{e.push(1),t>3&&e.push('...');const o=Math.max(2,t-1),n=Math.min(a-1,t+1);for(let a=o;a<=n;a++)e.push(a);t<a-2&&e.push('...'),e.push(a)}return e});function B(e){return n.isRowChanged(t.tableName,e.index,e.cells.length)}function S(){i.toggleTableReverse(t.tableName)}function A(){u.value='card'===u.value?'list':'card'}function T(){o('close')}function U(){p.value=1,o('searchChange',d.value)}function D(){d.value='',p.value=1,o('searchChange','')}function I(e){e<1||e>w.value||(p.value=e,o('pageChange',e),(0,l.nextTick)(()=>{c.value?.scrollTo({top:0,behavior:'smooth'})}))}function M(e,a){o('cellClick',t.tableId,e,a)}function j(e,a){o('contextMenu',e,t.tableId,a)}function F(e){s.value&&o('heightDragStart',e,s.value)}function P(){o('heightReset')}let L=0;function R(){const e=Date.now();e-L<300?(P(),L=0):L=e}return(0,l.watch)(()=>t.searchTerm,e=>{d.value=e}),(0,l.watch)(u,e=>{i.setTableStyle(t.tableName,e)}),(0,l.watch)(w,e=>{p.value>e&&(p.value=Math.max(1,e))}),(a,n)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['acu-data-table',{'acu-table-loading':e.isLoading}])},[(0,l.createCommentVNode)(' 固定工具栏 '),(0,l.createElementVNode)('div',fn,[(0,l.createCommentVNode)(' 左侧：表名 + (条数) '),(0,l.createElementVNode)('div',vn,[(0,l.createElementVNode)('span',hn,(0,l.toDisplayString)(e.tableName),1),(0,l.createElementVNode)('span',xn,'('+(0,l.toDisplayString)(k.value)+')',1),C.value>0?((0,l.openBlock)(),(0,l.createElementBlock)('span',wn,(0,l.toDisplayString)(C.value),1)):(0,l.createCommentVNode)('v-if',!0),N.value>0?((0,l.openBlock)(),(0,l.createElementBlock)('span',yn,(0,l.toDisplayString)(N.value),1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' 右侧：从右到左 - 关闭、搜索、高度拖手、倒序、视图切换 '),(0,l.createElementVNode)('div',kn,[(0,l.createCommentVNode)(' 视图切换按钮 '),(0,l.createElementVNode)('button',{class:'acu-toolbar-btn',title:'card'===u.value?'切换到列表视图':'切换到卡片视图',onClick:A},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)('card'===u.value?'fas fa-list':'fas fa-th-large')},null,2)],8,Cn),(0,l.createCommentVNode)(' 倒序按钮 '),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-toolbar-btn',{active:g.value}]),title:'倒序显示',onClick:S},[...n[3]||(n[3]=[(0,l.createElementVNode)('i',{class:'fas fa-sort-amount-down-alt'},null,-1)])],2),(0,l.createCommentVNode)(' 高度拖手 '),(0,l.createElementVNode)('button',{ref_key:'heightHandleRef',ref:s,class:'acu-toolbar-btn acu-height-handle',title:'拖动调整高度 / 双击重置',onPointerdown:F,onDblclick:P,onTouchend:(0,l.withModifiers)(R,['stop'])},[...n[4]||(n[4]=[(0,l.createElementVNode)('i',{class:'fas fa-grip-lines'},null,-1)])],544),(0,l.createCommentVNode)(' 搜索框 '),(0,l.createElementVNode)('div',Nn,[n[5]||(n[5]=(0,l.createElementVNode)('i',{class:'fas fa-search acu-search-icon'},null,-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':n[0]||(n[0]=e=>d.value=e),type:'text',class:'acu-search-input',placeholder:'搜索...',onInput:U},null,544),[[l.vModelText,d.value]]),d.value?((0,l.openBlock)(),(0,l.createElementBlock)('i',{key:0,class:'fas fa-times acu-search-clear',onClick:D})):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' 关闭按钮 '),(0,l.createElementVNode)('button',{class:'acu-toolbar-btn acu-close-btn',title:'关闭数据区',onClick:(0,l.withModifiers)(T,['stop'])},[...n[6]||(n[6]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])])]),(0,l.createCommentVNode)(' 数据卡片列表 '),(0,l.createElementVNode)('div',{ref_key:'containerRef',ref:c,class:(0,l.normalizeClass)(['acu-cards-container',[`acu-view-${u.value}`]])},[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(y.value,a=>((0,l.openBlock)(),(0,l.createBlock)(go,{key:`${e.tableId}-${a.index}`,data:a,'table-id':e.tableId,'table-name':e.tableName,'is-changed':B(a),layout:(0,l.unref)(r).config.layout,'view-mode':u.value,'show-index':e.showIndex,'show-header':e.showHeader,'title-col-index':m.value,'show-history-button':!0,onCellClick:M,onInsertRow:e=>{return n=a.index,void o('insertRow',t.tableId,n);var n},onToggleDelete:e=>{return n=a.index,void o('toggleDelete',t.tableId,n);var n},onContextMenu:j,onShowHistory:e=>function(e){o('showHistory',t.tableId,t.tableName,e.index,e)}(a)},null,8,['data','table-id','table-name','is-changed','layout','view-mode','show-index','show-header','title-col-index','onInsertRow','onToggleDelete','onShowHistory']))),128)),(0,l.createCommentVNode)(' 空状态 '),0===b.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',Vn,[n[7]||(n[7]=(0,l.createElementVNode)('i',{class:'fas fa-inbox'},null,-1)),(0,l.createElementVNode)('p',null,(0,l.toDisplayString)(e.emptyText),1)])):(0,l.createCommentVNode)('v-if',!0)],2),(0,l.createCommentVNode)(' 分页器 (读取全局配置) '),(0,l.renderSlot)(a.$slots,'pagination',{},()=>[V.value&&w.value>1?((0,l.openBlock)(),(0,l.createElementBlock)('div',En,[(0,l.createCommentVNode)(' 上一页 (固定在最左) '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-page-btn acu-page-arrow',{disabled:1===p.value}]),title:'上一页',onClick:n[1]||(n[1]=e=>p.value>1&&I(p.value-1))},[...n[8]||(n[8]=[(0,l.createElementVNode)('i',{class:'fa-solid fa-chevron-left'},null,-1)])],2),(0,l.createCommentVNode)(' 中间数字区 (居中) '),(0,l.createElementVNode)('div',zn,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(E.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:e},['...'===e?((0,l.openBlock)(),(0,l.createElementBlock)('div',Bn,'...')):((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:1,class:(0,l.normalizeClass)(['acu-page-btn',{active:e===p.value}]),onClick:a=>I(e)},(0,l.toDisplayString)(e),11,Sn))],64))),128))]),(0,l.createCommentVNode)(' 下一页 (固定在最右) '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-page-btn acu-page-arrow',{disabled:p.value===w.value}]),title:'下一页',onClick:n[2]||(n[2]=e=>p.value<w.value&&I(p.value+1))},[...n[9]||(n[9]=[(0,l.createElementVNode)('i',{class:'fa-solid fa-chevron-right'},null,-1)])],2)])):(0,l.createCommentVNode)('v-if',!0)])],2))}}),Tn=An,Un=Tn,Dn={class:'acu-options-panel'},In={class:'acu-panel-header acu-options-header'},Mn={class:'acu-header-actions'},_n={class:'acu-options-count'},$n={class:'acu-panel-content acu-options-content'},jn={key:0,class:'acu-empty-state'},Fn={class:'acu-options-list'},Pn={class:'acu-dash-title'},Ln={class:'acu-option-rows'},Rn=['onClick'],On={class:'acu-option-tags'},Hn={class:'acu-option-text'},Gn=(0,l.defineComponent)({__name:'OptionsPanel',props:{tables:{}},emits:['navigate','optionClick'],setup(e,{emit:a}){const t=e,o=a,{setInput:n}=ct(),r=(0,l.computed)(()=>t.tables.filter(e=>e.name.includes('选项')));function i(e){const a=[],{isMatrix:t,optionColIndices:o}=function(e){const a=e.headers||[],t=[];return a.forEach((e,a)=>{e&&/(选项|Option|分支)/i.test(String(e))&&t.push(a)}),{isMatrix:t.length>=2,optionColIndices:t}}(e),n=e.headers||[];return e.rows.forEach(e=>{const r=e.cells.map(e=>String(e.value||'').trim());if(t){const e=[];r.forEach((a,t)=>{!o.includes(t)&&a&&e.push(a)}),o.forEach(t=>{const o=r[t];if(o){const r=n[t]||'',i=[...e];r&&i.push(r),a.push({text:o,tags:i})}})}else{const e=r.filter(e=>''!==e);if(0===e.length)return;const t=e[e.length-1],o=e.slice(0,e.length-1);a.push({text:t,tags:o})}}),a}function c(e,a){const t=e.currentTarget;a?(t.style.background='var(--acu-table-hover)',t.style.borderColor='var(--acu-title-color)'):(t.style.background='rgba(255,255,255,0.05)',t.style.borderColor='var(--acu-border)')}return(e,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',Dn,[(0,l.createCommentVNode)(' 面板头部 '),(0,l.createElementVNode)('div',In,[a[4]||(a[4]=(0,l.createElementVNode)('div',{class:'acu-panel-title acu-options-title'},[(0,l.createElementVNode)('i',{class:'fa-solid fa-list-check'}),(0,l.createTextVNode)(' 选项聚合 ')],-1)),(0,l.createElementVNode)('div',Mn,[(0,l.createElementVNode)('span',_n,(0,l.toDisplayString)(r.value.length)+' 个选项表',1)])]),(0,l.createCommentVNode)(' 内容滚动区域 '),(0,l.createElementVNode)('div',$n,[(0,l.createCommentVNode)(' 空状态 '),0===r.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',jn,'未找到名称包含"选项"的表格')):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' 选项表格列表 '),(0,l.createElementVNode)('div',Fn,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(r.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:'acu-dash-card'},[(0,l.createCommentVNode)(' 表格标题 '),(0,l.createElementVNode)('div',Pn,(0,l.toDisplayString)(e.name),1),(0,l.createCommentVNode)(' 选项行列表 '),(0,l.createElementVNode)('div',Ln,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(i(e),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t,class:'acu-option-row',title:'点击追加',onClick:a=>{return t=e.text,n(t),o('optionClick',t),void Pa.toast.success('已追加到输入框');var t},onMouseover:a[0]||(a[0]=e=>c(e,!0)),onMouseout:a[1]||(a[1]=e=>c(e,!1)),onMousedown:a[2]||(a[2]=e=>{e.currentTarget.style.transform='translateY(1px)'}),onMouseup:a[3]||(a[3]=e=>{e.currentTarget.style.transform='translateY(0)'})},[(0,l.createCommentVNode)(' 标签区域 '),(0,l.createElementVNode)('div',On,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.tags,(e,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('span',{key:a,class:'acu-badge acu-option-tag'},(0,l.toDisplayString)(e),1))),128))]),(0,l.createCommentVNode)(' 选项文本 '),(0,l.createElementVNode)('div',Hn,(0,l.toDisplayString)(e.text),1)],40,Rn))),128))])]))),128))])],2112))])]))}}),Yn=Gn,Wn=Yn,qn=(0,l.defineComponent)({__name:'ContextMenu',props:{visible:{type:Boolean},x:{},y:{},tableId:{},tableName:{},rowIndex:{},cellValue:{}},emits:['update:visible','insertRow','delete','undoDelete','copied'],setup(e,{expose:a,emit:t}){const o=e,n=t,r=(0,l.ref)(),i=wa(),{copy:c,copied:s}=L(),u=(0,l.computed)(()=>{const e=`${o.tableName||o.tableId}-row-${o.rowIndex}`;return i.pendingDeletes.has(e)}),d=(0,l.computed)(()=>{const e=window.parent||window,a=e.innerWidth,t=e.innerHeight;let n=o.x,r=o.y;return n+180>a&&(n=a-180-10),r+200>t&&(r=t-200-10),n=Math.max(10,n),r=Math.max(10,r),{left:`${n}px`,top:`${r}px`}});let p=null,m=null;(0,l.onMounted)(()=>{const e=window.parent?.document||document;p=e=>{if(!o.visible||!r.value)return;const a=e.target;r.value.contains(a)||(console.info('[ACU] 点击外部关闭右键菜单'),g())},m=e=>{if(!o.visible||!r.value)return;const a=e.target;r.value.contains(a)||(console.info('[ACU] 右键点击外部关闭右键菜单'),g())},e.addEventListener('click',p,!0),e.addEventListener('contextmenu',m,!0),e.addEventListener('touchstart',p,!0)}),(0,l.onUnmounted)(()=>{const e=window.parent?.document||document;p&&(e.removeEventListener('click',p,!0),e.removeEventListener('touchstart',p,!0),p=null),m&&(e.removeEventListener('contextmenu',m,!0),m=null)}),(0,l.watch)(()=>o.visible,e=>{e&&(0,l.nextTick)(()=>{r.value?.focus()})});const g=()=>{n('update:visible',!1)},b=()=>{n('insertRow',o.tableId,o.rowIndex),g()},f=async()=>{if(o.cellValue)try{await c(o.cellValue),n('copied')}catch(e){console.error('[ACU] Copy failed:',e)}g()},v=()=>{n('delete',o.tableId,o.rowIndex),g()},h=()=>{n('undoDelete',o.tableId,o.rowIndex),g()};return a({close:g,copied:s}),(a,t)=>((0,l.openBlock)(),(0,l.createBlock)(l.Transition,{name:'acu-menu-fade'},{default:(0,l.withCtx)(()=>[e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,ref_key:'menuRef',ref:r,class:'acu-context-menu',style:(0,l.normalizeStyle)(d.value),tabindex:'-1',onKeydown:(0,l.withKeys)(g,['escape']),onClick:t[0]||(t[0]=(0,l.withModifiers)(()=>{},['stop'])),onMousedown:t[1]||(t[1]=(0,l.withModifiers)(()=>{},['stop'])),onTouchstart:t[2]||(t[2]=(0,l.withModifiers)(()=>{},['stop']))},[(0,l.createCommentVNode)(' 插入行 '),(0,l.createElementVNode)('div',{class:'acu-menu-item',onClick:(0,l.withModifiers)(b,['stop'])},[...t[3]||(t[3]=[(0,l.createElementVNode)('i',{class:'fas fa-plus'},null,-1),(0,l.createElementVNode)('span',null,'插入行',-1)])]),(0,l.createCommentVNode)(' 复制内容 '),(0,l.createElementVNode)('div',{class:'acu-menu-item',onClick:(0,l.withModifiers)(f,['stop'])},[...t[4]||(t[4]=[(0,l.createElementVNode)('i',{class:'fas fa-copy'},null,-1),(0,l.createElementVNode)('span',null,'复制内容',-1)])]),(0,l.createCommentVNode)(' 分隔线 '),t[7]||(t[7]=(0,l.createElementVNode)('div',{class:'acu-menu-divider'},null,-1)),(0,l.createCommentVNode)(' 删除行（未标记删除时显示） '),u.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' 撤销删除（已标记删除时显示） '),(0,l.createElementVNode)('div',{class:'acu-menu-item acu-menu-warning',onClick:(0,l.withModifiers)(h,['stop'])},[...t[6]||(t[6]=[(0,l.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,l.createElementVNode)('span',null,'撤销删除',-1)])])],2112)):((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-menu-item acu-menu-danger',onClick:(0,l.withModifiers)(v,['stop'])},[...t[5]||(t[5]=[(0,l.createElementVNode)('i',{class:'fas fa-trash'},null,-1),(0,l.createElementVNode)('span',null,'删除整行',-1)])]))],36)):(0,l.createCommentVNode)('v-if',!0)]),_:1}))}}),Xn=qn,Kn=Xn,Jn={class:'acu-pagination'},Qn={class:'acu-pagination-info'},Zn={class:'acu-pagination-current'},er={key:0,class:'acu-pagination-total'},ar={class:'acu-pagination-controls'},tr=['disabled'],or=['disabled'],nr={class:'acu-page-list'},rr={key:0,class:'acu-page-ellipsis'},ir=['onClick'],cr=['disabled'],lr=['disabled'],sr={key:0,class:'acu-pagination-jump'},ur=['max'],dr=(Boolean,Boolean,{class:'acu-search-input-wrapper'}),pr=['placeholder'],mr={key:0,class:'acu-search-result'},gr={key:1,class:'no-result'},br=(Boolean,Boolean,{class:'acu-modal-body'}),fr={class:'acu-settings-section'},vr={class:'acu-settings-group'},hr={class:'acu-purge-range-row'},xr={class:'acu-settings-section'},wr={class:'acu-table-selector acu-table-selector-compact'},yr={class:'acu-table-selector-header'},kr={class:'acu-table-selector-list'},Cr=['onClick'],Nr=['checked','onChange'],Vr={class:'table-name'},Er={key:0,class:'acu-table-selector-empty'},zr={class:'acu-table-selector-footer'},Br={class:'acu-modal-footer'},Sr=['disabled'],Ar={key:0,class:'fas fa-spinner fa-spin'},Tr={key:1,class:'fas fa-trash-alt'},Ur=(0,l.defineComponent)({__name:'AdvancedPurgeDialog',props:{visible:{type:Boolean},initialStartFloor:{default:void 0},initialEndFloor:{default:void 0}},emits:['update:visible','confirm'],setup(e,{emit:a}){const t=e,o=a,n=(0,l.ref)(),r=(0,l.ref)(),i=(0,l.ref)(),c=(0,l.ref)(null),s=(0,l.ref)(null),u=(0,l.ref)([]),d=(0,l.ref)([]),p=(0,l.ref)(!1),{purgeTableDataByRange:m}=it(),g=(0,l.computed)(()=>0!==d.value.length&&u.value.length===d.value.length),b=(0,l.computed)(()=>null!==c.value&&null!==s.value&&(!isNaN(c.value)&&!isNaN(s.value)&&(!(c.value<0||s.value<0)&&(!(c.value>s.value)&&0!==u.value.length))));function f(e){const a=u.value.indexOf(e);-1===a?u.value.push(e):u.value.splice(a,1)}function v(){u.value=d.value.map(e=>e.key)}function h(){u.value=[]}function x(){i.value?.focus()}function w(){o('update:visible',!1)}async function y(){if(b.value&&!p.value){p.value=!0;try{const e=await m(u.value,c.value,s.value);if(e.changed){const a=u.value.map(e=>d.value.find(a=>a.key===e)?.name||e).join(', ');Pa.toast.success(`已清除 ${e.changedCount} 层数据 (${a})`),o('confirm',{changedCount:e.changedCount,tables:u.value}),w()}else Pa.toast.info('未找到需要清除的数据')}catch(e){console.error('[ACU] 高级清除失败:',e),Pa.toast.error('清除失败: '+(e instanceof Error?e.message:String(e)))}finally{p.value=!1}}}return(0,l.watch)(()=>t.visible,e=>{e&&(c.value=t.initialStartFloor??null,s.value=t.initialEndFloor??null,u.value=[],p.value=!1,function(){try{const e=Le();if(!e)return void(d.value=[]);const a=[];Object.keys(e).forEach(t=>{if(!t.startsWith('sheet_'))return;const o=e[t];o&&'object'==typeof o&&o.name&&a.push({key:t,name:o.name})}),d.value=a}catch(e){console.warn('[ACU] 加载表格列表失败:',e),d.value=[]}}(),(0,l.nextTick)(()=>{r.value?.focus()}))}),j(n,()=>{p.value||w()}),(a,t)=>e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,l.withModifiers)(w,['self'])},[(0,l.createElementVNode)('div',{ref_key:'dialogRef',ref:n,class:'acu-modal acu-advanced-purge-modal'},[(0,l.createCommentVNode)(' 头部 '),(0,l.createElementVNode)('div',{class:'acu-modal-header'},[(0,l.createElementVNode)('button',{class:'acu-modal-back',onClick:w},[...t[3]||(t[3]=[(0,l.createElementVNode)('i',{class:'fas fa-arrow-left'},null,-1)])]),t[4]||(t[4]=(0,l.createElementVNode)('span',{class:'acu-modal-title'},'高级清除',-1)),t[5]||(t[5]=(0,l.createElementVNode)('span',null,null,-1))]),(0,l.createCommentVNode)(' 内容区 '),(0,l.createElementVNode)('div',br,[(0,l.createCommentVNode)(' 楼层范围设置 '),(0,l.createElementVNode)('div',fr,[t[8]||(t[8]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-layer-group'}),(0,l.createTextVNode)(' 楼层范围 ')],-1)),(0,l.createElementVNode)('div',vr,[(0,l.createElementVNode)('div',hr,[(0,l.withDirectives)((0,l.createElementVNode)('input',{ref_key:'startInputRef',ref:r,'onUpdate:modelValue':t[0]||(t[0]=e=>c.value=e),type:'number',class:'acu-purge-input',placeholder:'起始',min:'0',onKeydown:(0,l.withKeys)(x,['enter'])},null,544),[[l.vModelText,c.value,void 0,{number:!0}]]),t[6]||(t[6]=(0,l.createElementVNode)('span',{class:'acu-purge-separator'},'—',-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{ref_key:'endInputRef',ref:i,'onUpdate:modelValue':t[1]||(t[1]=e=>s.value=e),type:'number',class:'acu-purge-input',placeholder:'结束',min:'0'},null,512),[[l.vModelText,s.value,void 0,{number:!0}]])]),t[7]||(t[7]=(0,l.createElementVNode)('div',{class:'acu-purge-range-hint'},[(0,l.createElementVNode)('i',{class:'fas fa-info-circle'}),(0,l.createTextVNode)(' 输入 Chat 索引（从 0 开始） ')],-1))])]),(0,l.createCommentVNode)(' 表格选择 '),(0,l.createElementVNode)('div',xr,[t[12]||(t[12]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-table'}),(0,l.createTextVNode)(' 选择要清除的表格 ')],-1)),(0,l.createElementVNode)('div',wr,[(0,l.createElementVNode)('div',yr,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-quick-select-btn',{active:g.value}]),onClick:v},[...t[9]||(t[9]=[(0,l.createElementVNode)('i',{class:'fas fa-check-double'},null,-1),(0,l.createTextVNode)(' 全选 ',-1)])],2),(0,l.createElementVNode)('button',{class:'acu-quick-select-btn',onClick:h},[...t[10]||(t[10]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1),(0,l.createTextVNode)(' 清空 ',-1)])])]),(0,l.createElementVNode)('div',kr,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(d.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.key,class:(0,l.normalizeClass)(['acu-table-selector-item',{'is-selected':u.value.includes(e.key)}]),onClick:a=>f(e.key)},[(0,l.createElementVNode)('input',{type:'checkbox',checked:u.value.includes(e.key),onClick:t[2]||(t[2]=(0,l.withModifiers)(()=>{},['stop'])),onChange:a=>f(e.key)},null,40,Nr),(0,l.createElementVNode)('span',Vr,(0,l.toDisplayString)(e.name),1)],10,Cr))),128)),0===d.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',Er,[...t[11]||(t[11]=[(0,l.createElementVNode)('i',{class:'fas fa-inbox'},null,-1),(0,l.createTextVNode)(' 暂无可用表格 ',-1)])])):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',zr,' 已选择: '+(0,l.toDisplayString)(u.value.length)+'/'+(0,l.toDisplayString)(d.value.length)+' 个表格 ',1)])]),(0,l.createCommentVNode)(' 警告提示 '),t[13]||(t[13]=(0,l.createElementVNode)('div',{class:'acu-purge-warning'},[(0,l.createElementVNode)('i',{class:'fas fa-exclamation-triangle'}),(0,l.createElementVNode)('span',null,'此操作将从指定楼层范围内删除选中表格的数据，操作不可撤销！')],-1))]),(0,l.createCommentVNode)(' 底部按钮 '),(0,l.createElementVNode)('div',Br,[(0,l.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:w},'取消'),(0,l.createElementVNode)('button',{class:'acu-modal-btn danger',disabled:!b.value||p.value,onClick:y},[p.value?((0,l.openBlock)(),(0,l.createElementBlock)('i',Ar)):((0,l.openBlock)(),(0,l.createElementBlock)('i',Tr)),(0,l.createTextVNode)(' '+(0,l.toDisplayString)(p.value?'执行中...':'确认清除'),1)],8,Sr)])],512)])):(0,l.createCommentVNode)('v-if',!0)}}),Dr={class:'acu-modal acu-crop-dialog'},Ir={class:'acu-modal-header'},Mr={class:'acu-modal-title'},_r={class:'acu-modal-body acu-crop-body'},$r={class:'acu-crop-preview-wrapper'},jr={key:0,class:'acu-crop-placeholder'},Fr={class:'acu-crop-controls'},Pr={class:'acu-crop-control-row'},Lr=['value'],Rr={class:'acu-crop-value'},Or={class:'acu-crop-control-row'},Hr=['value'],Gr={class:'acu-crop-value'},Yr={class:'acu-crop-control-row'},Wr=['value'],qr={class:'acu-crop-value'},Xr={class:'acu-crop-upload-section'},Kr={class:'acu-modal-footer'},Jr=(0,l.defineComponent)({__name:'AvatarCropDialog',props:{visible:{type:Boolean,default:!1},imageUrl:{default:''},name:{default:''},initialOffsetX:{default:50},initialOffsetY:{default:50},initialScale:{default:150}},emits:['close','apply','upload'],setup(e,{emit:a}){const t=e,o=a,n=(0,l.ref)(t.initialOffsetX),r=(0,l.ref)(t.initialOffsetY),i=(0,l.ref)(t.initialScale),c=(0,l.ref)(null),s=(0,l.ref)(null),u=(0,l.ref)(!1),d=(0,l.ref)(0),p=(0,l.ref)(0),m=(0,l.ref)(0),g=(0,l.ref)(0),b=(0,l.computed)(()=>t.imageUrl?{backgroundImage:`url('${t.imageUrl}')`,backgroundPosition:`${n.value}% ${r.value}%`,backgroundSize:`${i.value}%`}:{});function f(){o('close')}function v(){o('apply',{offsetX:n.value,offsetY:r.value,scale:i.value})}function h(){n.value=50,r.value=50,i.value=150}function x(){c.value?.click()}function w(e){const a=e.target,t=a.files?.[0];t&&o('upload',t),a.value=''}function y(e){if(!t.imageUrl)return;u.value=!0,d.value=e.clientX,p.value=e.clientY,m.value=n.value,g.value=r.value;const a=window.parent?.document||document;a.addEventListener('mousemove',C),a.addEventListener('mouseup',E)}function k(e){if(!t.imageUrl||1!==e.touches.length)return;const a=e.touches[0];u.value=!0,d.value=a.clientX,p.value=a.clientY,m.value=n.value,g.value=r.value;const o=window.parent?.document||document;o.addEventListener('touchmove',N,{passive:!1}),o.addEventListener('touchend',B)}function C(e){if(!u.value)return;V(e.clientX-d.value,e.clientY-p.value)}function N(e){if(!u.value||1!==e.touches.length)return;e.preventDefault();const a=e.touches[0];V(a.clientX-d.value,a.clientY-p.value)}function V(e,a){const t=m.value-e/120*100*.8,o=g.value-a/120*100*.8;n.value=Math.max(0,Math.min(100,Math.round(t))),r.value=Math.max(0,Math.min(100,Math.round(o)))}function E(){u.value=!1;const e=window.parent?.document||document;e.removeEventListener('mousemove',C),e.removeEventListener('mouseup',E)}function B(){u.value=!1;const e=window.parent?.document||document;e.removeEventListener('touchmove',N),e.removeEventListener('touchend',B)}return(0,l.watch)(()=>t.visible,e=>{e&&(n.value=t.initialOffsetX,r.value=t.initialOffsetY,i.value=t.initialScale)}),(a,t)=>e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-modal-container acu-crop-modal-overlay',onClick:(0,l.withModifiers)(f,['self'])},[(0,l.createElementVNode)('div',Dr,[(0,l.createCommentVNode)(' 头部 '),(0,l.createElementVNode)('div',Ir,[(0,l.createElementVNode)('span',Mr,[t[3]||(t[3]=(0,l.createElementVNode)('i',{class:'fas fa-crop-simple'},null,-1)),(0,l.createTextVNode)(' 调整头像 - '+(0,l.toDisplayString)(e.name),1)]),(0,l.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,l.withModifiers)(f,['stop'])},[...t[4]||(t[4]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])]),(0,l.createCommentVNode)(' 内容区 '),(0,l.createElementVNode)('div',_r,[(0,l.createCommentVNode)(' 预览区 - 支持拖动 '),(0,l.createElementVNode)('div',$r,[(0,l.createElementVNode)('div',{ref_key:'previewRef',ref:s,class:(0,l.normalizeClass)(['acu-crop-preview',{'is-dragging':u.value}]),style:(0,l.normalizeStyle)(b.value),onMousedown:y,onTouchstart:(0,l.withModifiers)(k,['prevent'])},[(0,l.createCommentVNode)(' 无图片时显示占位 '),e.imageUrl?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('div',jr,[...t[5]||(t[5]=[(0,l.createElementVNode)('i',{class:'fas fa-image'},null,-1),(0,l.createElementVNode)('span',null,'暂无图片',-1)])]))],38)]),(0,l.createCommentVNode)(' 滑块控制 '),(0,l.createElementVNode)('div',Fr,[(0,l.createCommentVNode)(' X 偏移 '),(0,l.createElementVNode)('div',Pr,[t[6]||(t[6]=(0,l.createElementVNode)('label',{class:'acu-crop-label'},[(0,l.createElementVNode)('i',{class:'fas fa-arrows-left-right'}),(0,l.createTextVNode)(' X偏移 ')],-1)),(0,l.createElementVNode)('input',{type:'range',class:'acu-crop-slider',min:'0',max:'100',value:n.value,onInput:t[0]||(t[0]=e=>n.value=Number(e.target.value))},null,40,Lr),(0,l.createElementVNode)('span',Rr,(0,l.toDisplayString)(n.value)+'%',1)]),(0,l.createCommentVNode)(' Y 偏移 '),(0,l.createElementVNode)('div',Or,[t[7]||(t[7]=(0,l.createElementVNode)('label',{class:'acu-crop-label'},[(0,l.createElementVNode)('i',{class:'fas fa-arrows-up-down'}),(0,l.createTextVNode)(' Y偏移 ')],-1)),(0,l.createElementVNode)('input',{type:'range',class:'acu-crop-slider',min:'0',max:'100',value:r.value,onInput:t[1]||(t[1]=e=>r.value=Number(e.target.value))},null,40,Hr),(0,l.createElementVNode)('span',Gr,(0,l.toDisplayString)(r.value)+'%',1)]),(0,l.createCommentVNode)(' 缩放 '),(0,l.createElementVNode)('div',Yr,[t[8]||(t[8]=(0,l.createElementVNode)('label',{class:'acu-crop-label'},[(0,l.createElementVNode)('i',{class:'fas fa-magnifying-glass-plus'}),(0,l.createTextVNode)(' 缩放 ')],-1)),(0,l.createElementVNode)('input',{type:'range',class:'acu-crop-slider',min:'100',max:'300',value:i.value,onInput:t[2]||(t[2]=e=>i.value=Number(e.target.value))},null,40,Wr),(0,l.createElementVNode)('span',qr,(0,l.toDisplayString)(i.value)+'%',1)])]),(0,l.createCommentVNode)(' 上传新图片按钮 '),(0,l.createElementVNode)('div',Xr,[(0,l.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:(0,l.withModifiers)(x,['stop'])},[...t[9]||(t[9]=[(0,l.createElementVNode)('i',{class:'fas fa-upload'},null,-1),(0,l.createTextVNode)(' 上传新图片 ',-1)])]),(0,l.createElementVNode)('input',{ref_key:'fileInputRef',ref:c,type:'file',accept:'image/*',style:{display:'none'},onChange:w},null,544)])]),(0,l.createCommentVNode)(' 底部按钮 '),(0,l.createElementVNode)('div',Kr,[(0,l.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:(0,l.withModifiers)(h,['stop'])},'重置'),(0,l.createElementVNode)('button',{class:'acu-modal-btn primary',onClick:(0,l.withModifiers)(v,['stop'])},'确定')])])])):(0,l.createCommentVNode)('v-if',!0)}}),Qr={class:'acu-node-config-panel'},Zr={class:'acu-node-config-header'},ei={class:'acu-node-config-body'},ai={class:'acu-node-fullname'},ti={class:'acu-char-selector'},oi=['onClick'],ni={class:'acu-node-preview'},ri={class:'acu-node-config-actions'},ii=(0,l.defineComponent)({__name:'NodeLabelDialog',props:{visible:{type:Boolean,default:!1},fullName:{default:''},initialIndices:{default:()=>[]}},emits:['close','apply','reset'],setup(e,{expose:a,emit:t}){const o=e,n=t,r=(0,l.ref)(new Set);function i(e){return/^[A-Za-z\s'-]+$/.test(e)&&e.includes(' ')}function c(e){return e?i(e)?e.split(' ').filter(Boolean):e.split(''):[]}function s(e){const a=c(e);return i(e)?[0]:a.length>0?[a.length-1]:[]}function u(e){if(i(e)){const a=e.split(' ')[0];return a.length>6?a.slice(0,6):a}return e.length>0?e[e.length-1]:e}const d=(0,l.computed)(()=>c(o.fullName)),p=(0,l.computed)(()=>{if(!o.fullName)return'';const e=d.value,a=Array.from(r.value).sort((e,a)=>e-a).map(a=>e[a]).filter(Boolean);return 0===a.length?u(o.fullName):i(o.fullName)?a.join(' '):a.join('')});function m(){n('apply',{displayLabel:p.value,selectedIndices:Array.from(r.value)}),n('close')}function g(){n('reset'),n('close')}function b(){n('close')}return(0,l.watch)(()=>[o.visible,o.fullName,o.initialIndices],([e])=>{e&&(o.initialIndices&&o.initialIndices.length>0?r.value=new Set(o.initialIndices):r.value=new Set(s(o.fullName)))},{immediate:!0}),a({isEnglishName:i,getDisplayChars:c,getDefaultIndices:s,getDefaultLabel:u}),(a,t)=>e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-node-config-overlay',onClick:(0,l.withModifiers)(b,['self'])},[(0,l.createElementVNode)('div',Qr,[(0,l.createElementVNode)('div',Zr,[t[1]||(t[1]=(0,l.createElementVNode)('span',null,'选择显示的字符',-1)),(0,l.createElementVNode)('button',{class:'acu-close-btn',onClick:(0,l.withModifiers)(b,['stop'])},[...t[0]||(t[0]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])]),(0,l.createElementVNode)('div',ei,[(0,l.createElementVNode)('p',ai,'全名：'+(0,l.toDisplayString)(e.fullName),1),t[2]||(t[2]=(0,l.createElementVNode)('p',{class:'acu-node-hint'},'点击选择要显示的字符（可多选）',-1)),(0,l.createElementVNode)('div',ti,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(d.value,(e,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:a,class:(0,l.normalizeClass)(['acu-char-btn',{active:r.value.has(a)}]),onClick:(0,l.withModifiers)(e=>function(e){const a=new Set(r.value);a.has(e)?a.delete(e):a.add(e),r.value=a}(a),['stop'])},(0,l.toDisplayString)(e),11,oi))),128))]),(0,l.createElementVNode)('p',ni,'预览：'+(0,l.toDisplayString)(p.value),1),(0,l.createElementVNode)('div',ri,[(0,l.createElementVNode)('button',{class:'acu-action-btn secondary',onClick:(0,l.withModifiers)(g,['stop'])},'显示全名'),(0,l.createElementVNode)('button',{class:'acu-action-btn primary',onClick:(0,l.withModifiers)(m,['stop'])},'确定')])])])])):(0,l.createCommentVNode)('v-if',!0)}}),ci=ii,li={class:'acu-modal acu-avatar-manager-dialog'},si={class:'acu-modal-header'},ui={class:'acu-modal-body acu-avatar-list'},di={key:0,class:'acu-avatar-loading'},pi={class:'acu-avatar-items'},mi=['onClick'],gi={class:'acu-avatar-column'},bi=['onClick'],fi={key:0,class:'acu-avatar-initial'},vi={key:1,class:'fas fa-camera acu-avatar-camera-hint'},hi={class:'acu-avatar-info'},xi={class:'acu-avatar-name-row'},wi={class:'acu-avatar-name-left'},yi={class:'acu-avatar-name'},ki={key:0,class:'acu-avatar-label-preview'},Ci={class:'acu-avatar-name-right'},Ni=['onClick'],Vi={class:'acu-import-dropdown'},Ei=['onClick'],zi={key:0,class:'acu-dropdown-menu'},Bi=['onClick'],Si=['onClick'],Ai={class:'acu-avatar-url-row'},Ti=['value','onChange','onBlur'],Ui={class:'acu-avatar-footer'},Di={class:'acu-footer-left'},Ii=['disabled'],Mi={class:'acu-footer-right'},_i=['disabled'],$i='acu_graph_config',ji=(0,l.defineComponent)({__name:'AvatarManagerDialog',props:{visible:{type:Boolean,default:!1},nodes:{default:()=>[]}},emits:['close','update'],setup(e,{emit:a}){function t(){try{return getVariables({type:'chat'})[$i]||{}}catch(e){return console.warn('[AvatarManager] 获取聊天变量失败:',e),{}}}function o(e){try{insertOrAssignVariables({[$i]:e},{type:'chat'})}catch(e){console.warn('[AvatarManager] 保存聊天变量失败:',e)}}const n=e,r=a,i=vt(),c=(0,l.ref)(!0),s=(0,l.ref)([]),u=(0,l.ref)(new Map),d=(0,l.computed)(()=>u.value.size>0),p=(0,l.ref)(!1),m=(0,l.ref)(new Set),g=(0,l.ref)(null),b=(0,l.ref)(null),f=(0,l.ref)(null),v=(0,l.ref)(!1),h=(0,l.ref)(null),x=(0,l.ref)(!1),w=(0,l.ref)(null);async function y(){c.value=!0;try{const e=[];for(const a of n.nodes){const t=await i.getAvatar(a.name),o=await i.getAvatarUrl(a.name),n=!!t?.blob;let r=null;n?r='local':t?.url?r='url':o&&i.isPlayerNode(a.name)&&(r='auto');const c=await i.getDisplayLabel(a.name);e.push({id:a.id,name:a.name,label:a.label||c||a.name,type:a.type,avatarUrl:o,url:t?.url,offsetX:t?.offsetX??50,offsetY:t?.offsetY??50,scale:t?.scale??150,labelIndices:t?.labelIndices,displayLabel:c!==a.name?c:void 0,source:r,hasLocalBlob:n})}s.value=e}catch(e){console.error('[AvatarManager] 加载头像列表失败:',e)}finally{c.value=!1}}function k(){d.value&&!confirm('有未保存的更改，确定要关闭吗？')||(u.value.clear(),r('close'))}function C(e){switch(e){case'local':return'本地';case'url':return'URL';case'auto':return'酒馆';default:return''}}function N(e){return e.avatarUrl?{backgroundImage:`url('${e.avatarUrl}')`,backgroundPosition:`${e.offsetX}% ${e.offsetY}%`,backgroundSize:`${e.scale}%`}:{}}function V(){g.value=null}function E(e){return i.isPlayerNode(e.name)?!!i.getSillyTavernUserAvatar():!!i.getSillyTavernCharacterAvatar()}async function B(e){const a=e.target,t=a.files?.[0];if(!t||!f.value)return void(a.value='');const o=f.value;try{await i.saveAvatar({name:o.name,blob:t,offsetX:o.offsetX,offsetY:o.offsetY,scale:o.scale,aliases:[],labelIndices:o.labelIndices,updatedAt:Date.now()}),await y(),r('update')}catch(e){console.error('[AvatarManager] 上传失败:',e),alert('上传失败')}a.value='',f.value=null}function S(e,a){const t=a.trim();L(e.name,{url:t||void 0});const o=s.value.findIndex(a=>a.id===e.id);-1!==o&&(s.value[o]={...s.value[o],url:t||void 0,avatarUrl:t||s.value[o].avatarUrl,source:t?'url':s.value[o].source})}function A(){v.value=!1,h.value=null}function T(e){if(!h.value)return;const a=h.value,n=s.value.findIndex(e=>e.id===a.id);-1!==n&&(s.value[n]={...s.value[n],displayLabel:e.displayLabel,labelIndices:e.selectedIndices,label:e.displayLabel});const i=t();i.labels||(i.labels={}),i.labels[a.name]={displayLabel:e.displayLabel,selectedIndices:e.selectedIndices},o(i),r('update')}function U(){if(!h.value)return;const e=h.value,a=s.value.findIndex(a=>a.id===e.id);-1!==a&&(s.value[a]={...s.value[a],displayLabel:void 0,labelIndices:void 0,label:e.name});const n=t();n.labels&&(delete n.labels[e.name],o(n)),r('update')}function D(){x.value=!1,w.value=null}function I(e){if(!w.value)return;const a=w.value;L(a.name,{offsetX:e.offsetX,offsetY:e.offsetY,scale:e.scale});const t=s.value.findIndex(e=>e.id===a.id);-1!==t&&(s.value[t]={...s.value[t],offsetX:e.offsetX,offsetY:e.offsetY,scale:e.scale}),D()}async function M(e){if(!w.value)return;const a=w.value;try{await i.saveAvatar({name:a.name,blob:e,offsetX:50,offsetY:50,scale:150,aliases:[],labelIndices:a.labelIndices,updatedAt:Date.now()}),await y(),D(),r('update')}catch(e){console.error('[AvatarManager] 上传失败:',e),alert('上传失败')}}function j(){p.value=!0,m.value.clear()}function F(){p.value=!1,m.value.clear()}async function P(){if(0===m.value.size)return;const e=s.value.filter(e=>m.value.has(e.id)).map(e=>e.name);if(confirm(`确定要删除 ${e.length} 个头像配置吗？\n\n这将从 IndexedDB 中永久删除图片数据。`))try{await i.deleteAvatars(e),await y(),F(),r('update')}catch(e){console.error('[AvatarManager] 删除失败:',e),alert('删除失败')}}function L(e,a){const t=u.value.get(e)||{};u.value.set(e,{...t,...a})}async function R(){if(0!==u.value.size)try{for(const[e,a]of u.value){const t=await i.getAvatar(e),o={name:e,blob:t?.blob,url:void 0!==a.url?a.url:t?.url,offsetX:a.offsetX??t?.offsetX??50,offsetY:a.offsetY??t?.offsetY??50,scale:a.scale??t?.scale??150,aliases:t?.aliases||[],labelIndices:void 0!==a.labelIndices?a.labelIndices:t?.labelIndices,updatedAt:Date.now()};await i.saveAvatar(o)}u.value.clear(),r('update')}catch(e){console.error('[AvatarManager] 保存失败:',e),alert('保存失败')}}return(0,l.onMounted)(()=>{n.visible&&y()}),(0,l.watch)(()=>n.visible,e=>{e?y():(p.value=!1,m.value.clear(),g.value=null)}),(0,l.watch)(g,e=>{if(e){const e=()=>{g.value=null,document.removeEventListener('click',e)};setTimeout(()=>{document.addEventListener('click',e)},0)}}),(a,t)=>e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-modal-container acu-avatar-manager-overlay',onClick:(0,l.withModifiers)(k,['self'])},[(0,l.createElementVNode)('div',li,[(0,l.createCommentVNode)(' 头部 '),(0,l.createElementVNode)('div',si,[t[0]||(t[0]=(0,l.createElementVNode)('span',{class:'acu-modal-title'},[(0,l.createElementVNode)('i',{class:'fas fa-user-circle'}),(0,l.createTextVNode)(' 头像管理 ')],-1)),(0,l.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,l.withModifiers)(k,['stop'])},'完成')]),(0,l.createCommentVNode)(' 内容区 - 可滚动 '),(0,l.createElementVNode)('div',ui,[(0,l.createCommentVNode)(' 加载中 '),c.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',di,[...t[1]||(t[1]=[(0,l.createElementVNode)('i',{class:'fas fa-spinner fa-spin'},null,-1),(0,l.createElementVNode)('span',null,'加载中...',-1)])])):0===s.value.length?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' 空状态 '),t[2]||(t[2]=(0,l.createElementVNode)('div',{class:'acu-avatar-empty'},[(0,l.createElementVNode)('i',{class:'fas fa-user-slash'}),(0,l.createElementVNode)('p',null,'暂无角色数据')],-1))],2112)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' 头像列表 '),(0,l.createElementVNode)('div',pi,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(s.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['acu-avatar-item',{selected:m.value.has(e.id)}])},[(0,l.createCommentVNode)(' 批量删除选择框 '),p.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-avatar-checkbox',onClick:(0,l.withModifiers)(a=>function(e){const a=new Set(m.value);a.has(e)?a.delete(e):a.add(e),m.value=a}(e.id),['stop'])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(m.value.has(e.id)?'fas fa-check-square':'far fa-square')},null,2)],8,mi)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 头像区：头像 + 来源标签 '),(0,l.createElementVNode)('div',gi,[(0,l.createCommentVNode)(' 头像预览 '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-avatar-preview',{'has-image':!!e.avatarUrl}]),style:(0,l.normalizeStyle)(N(e)),onClick:(0,l.withModifiers)(a=>function(e){if(!e.avatarUrl)return f.value=e,void b.value?.click();w.value=e,x.value=!0}(e),['stop'])},[e.avatarUrl?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',fi,(0,l.toDisplayString)(e.label),1)),e.avatarUrl?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('i',vi))],14,bi),(0,l.createCommentVNode)(' 来源标签 '),e.source?((0,l.openBlock)(),(0,l.createElementBlock)('span',{key:0,class:(0,l.normalizeClass)(['acu-avatar-source','acu-source-'+e.source])},(0,l.toDisplayString)(C(e.source)),3)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' 信息区 '),(0,l.createElementVNode)('div',hi,[(0,l.createCommentVNode)(' 名称行 '),(0,l.createElementVNode)('div',xi,[(0,l.createCommentVNode)(' 左侧：全名 + 标签预览 '),(0,l.createElementVNode)('div',wi,[(0,l.createElementVNode)('span',yi,(0,l.toDisplayString)(e.name),1),e.displayLabel?((0,l.openBlock)(),(0,l.createElementBlock)('span',ki,'('+(0,l.toDisplayString)(e.displayLabel)+')',1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' 右侧：按钮区 '),(0,l.createElementVNode)('div',Ci,[(0,l.createCommentVNode)(' 名字配置按钮 '),(0,l.createElementVNode)('button',{class:'acu-avatar-name-btn',title:'配置头像显示名称',onClick:(0,l.withModifiers)(a=>function(e){h.value=e,v.value=!0}(e),['stop'])},' 姓名显示 ',8,Ni),(0,l.createCommentVNode)(' 导入下拉 '),(0,l.createElementVNode)('div',Vi,[(0,l.createElementVNode)('button',{class:'acu-avatar-import-btn',title:'导入头像',onClick:(0,l.withModifiers)(a=>{return t=e.id,void(g.value=g.value===t?null:t);var t},['stop'])},[...t[3]||(t[3]=[(0,l.createTextVNode)(' 导入 ',-1),(0,l.createElementVNode)('i',{class:'fas fa-caret-down'},null,-1)])],8,Ei),g.value===e.id?((0,l.openBlock)(),(0,l.createElementBlock)('div',zi,[(0,l.createElementVNode)('div',{class:'acu-dropdown-item',onClick:(0,l.withModifiers)(a=>function(e){V(),f.value=e,b.value?.click()}(e),['stop'])},[...t[4]||(t[4]=[(0,l.createElementVNode)('i',{class:'fas fa-upload'},null,-1),(0,l.createTextVNode)(' 本地导入 ',-1)])],8,Bi),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-dropdown-item',{disabled:!E(e)}]),onClick:(0,l.withModifiers)(a=>function(e){V();let a=null;if(a=i.isPlayerNode(e.name)?i.getSillyTavernUserAvatar():i.getSillyTavernCharacterAvatar(),a){L(e.name,{url:a});const t=s.value.findIndex(a=>a.id===e.id);-1!==t&&(s.value[t]={...s.value[t],url:a,avatarUrl:a,source:'url'})}else alert(i.isPlayerNode(e.name)?'未找到用户头像':'未找到角色卡头像')}(e),['stop'])},[...t[5]||(t[5]=[(0,l.createElementVNode)('i',{class:'fas fa-globe'},null,-1),(0,l.createTextVNode)(' 酒馆导入 ',-1)])],10,Si)])):(0,l.createCommentVNode)('v-if',!0)])])]),(0,l.createCommentVNode)(' URL 输入 '),(0,l.createElementVNode)('div',Ai,[t[6]||(t[6]=(0,l.createElementVNode)('span',{class:'acu-url-label'},'URL:',-1)),(0,l.createElementVNode)('input',{type:'text',class:'acu-avatar-url-input',placeholder:'粘贴图片URL...',value:e.url||'',onChange:a=>S(e,a.target.value),onBlur:a=>S(e,a.target.value)},null,40,Ti)])])],2))),128))])],2112))]),(0,l.createCommentVNode)(' 底部固定栏 '),(0,l.createElementVNode)('div',Ui,[(0,l.createElementVNode)('div',Di,[p.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:(0,l.withModifiers)(F,['stop'])},'取消'),(0,l.createElementVNode)('button',{class:'acu-modal-btn danger',disabled:0===m.value.size,onClick:(0,l.withModifiers)(P,['stop'])},' 删除 ('+(0,l.toDisplayString)(m.value.size)+') ',9,Ii)],64)):((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'acu-modal-btn secondary',onClick:(0,l.withModifiers)(j,['stop'])},[...t[7]||(t[7]=[(0,l.createElementVNode)('i',{class:'fas fa-trash-alt'},null,-1),(0,l.createTextVNode)(' 批量删除 ',-1)])]))]),(0,l.createElementVNode)('div',Mi,[(0,l.createElementVNode)('button',{class:'acu-modal-btn primary',disabled:!d.value,onClick:(0,l.withModifiers)(R,['stop'])},[...t[8]||(t[8]=[(0,l.createElementVNode)('i',{class:'fas fa-save'},null,-1),(0,l.createTextVNode)(' 保存 ',-1)])],8,_i)])])]),(0,l.createCommentVNode)(' 隐藏的文件输入 '),(0,l.createElementVNode)('input',{ref_key:'fileInputRef',ref:b,type:'file',accept:'image/*',style:{display:'none'},onChange:B},null,544),(0,l.createCommentVNode)(' 姓名选择弹窗 '),(0,l.createVNode)(ci,{visible:v.value,'full-name':h.value?.name||'','initial-indices':h.value?.labelIndices||[],onClose:A,onApply:T,onReset:U},null,8,['visible','full-name','initial-indices']),(0,l.createCommentVNode)(' 裁剪弹窗 '),x.value?((0,l.openBlock)(),(0,l.createBlock)(Jr,{key:0,visible:x.value,'image-url':w.value?.avatarUrl||'',name:w.value?.name||'','initial-offset-x':w.value?.offsetX??50,'initial-offset-y':w.value?.offsetY??50,'initial-scale':w.value?.scale??150,onClose:D,onApply:I,onUpload:M},null,8,['visible','image-url','name','initial-offset-x','initial-offset-y','initial-scale'])):(0,l.createCommentVNode)('v-if',!0)])):(0,l.createCommentVNode)('v-if',!0)}}),Fi={class:'acu-modal-header'},Pi={class:'acu-modal-title'},Li={class:'acu-history-layout acu-pc-layout'},Ri={key:0,class:'acu-loading-state'},Oi={key:1,class:'acu-empty-hint'},Hi={key:2,class:'acu-history-list'},Gi=['open','onToggle'],Yi={class:'acu-history-summary'},Wi={class:'acu-history-title'},qi={class:'acu-history-time'},Xi={class:'acu-history-card-wrapper'},Ki={class:'acu-current-card-label'},Ji={key:0,class:'acu-changes-count'},Qi={class:'acu-current-card'},Zi={class:'acu-history-actions'},ec=['disabled'],ac=['disabled'],tc={class:'acu-config-hint'},oc={key:0},nc={key:1},rc={class:'acu-history-mobile-list'},ic={key:0,class:'acu-loading-state'},cc={key:1,class:'acu-empty-hint'},lc={key:2,class:'acu-history-list'},sc=['open','onToggle'],uc={class:'acu-history-summary'},dc={class:'acu-history-title'},pc={class:'acu-history-time'},mc={class:'acu-history-card-wrapper'},gc={class:'acu-mobile-actions'},bc={class:'acu-mobile-history-section'},fc={class:'acu-history-scroll'},vc={key:0,class:'acu-empty-hint'},hc={key:1,class:'acu-history-list'},xc=['open','onToggle'],wc={class:'acu-history-summary'},yc={class:'acu-history-title'},kc={class:'acu-history-time'},Cc={class:'acu-history-card-wrapper'},Nc={class:'acu-mobile-current-section'},Vc={class:'acu-section-label'},Ec={key:0,class:'acu-changes-count'},zc={class:'acu-current-scroll'},Bc={class:'acu-mobile-actions'},Sc=['disabled'],Ac=['disabled'],Tc={key:0,class:'acu-preview-overlay'},Uc=(0,l.defineComponent)({__name:'HistoryDialog',props:{visible:{type:Boolean,default:!1},tableName:{},tableId:{},rowIndex:{},currentRowData:{default:null},titleColIndex:{default:-1},headers:{default:()=>[]}},emits:['update:visible','close','apply'],setup(e,{emit:a}){const t=e,o=a,n=se(),{getSnapshots:r,snapshotToTableRow:i,tableRowToCells:c,formatRelativeTime:s,getDiff:u,getCurrentChatId:d}=(wa(),ua()),{isMobile:p}=ut(),m=(0,l.ref)([]),g=(0,l.ref)(!1),b=(0,l.ref)(!1),f=(0,l.ref)(new Map),v=(0,l.ref)([]),h=(0,l.ref)(null),x=(0,l.ref)(!1),w=(0,l.ref)(''),y=(0,l.ref)(-1),k=(0,l.computed)(()=>n.config.cardWidth||280),C=(0,l.computed)(()=>{if(t.titleColIndex>=0)return t.titleColIndex;if(t.tableName.includes('总结')||t.tableName.includes('大纲')){if(t.headers.length>0){const e=t.headers.findIndex(e=>e&&(e.includes('索引')||e.includes('编号')||e.includes('代码')));if(e>0)return e}if(t.currentRowData){const e=t.currentRowData.cells.findIndex(e=>e.key&&(e.key.includes('索引')||e.key.includes('编号')||e.key.includes('代码')));if(e>0)return e}}return 1}),N=(0,l.computed)(()=>{const e=function(e){if(!e)return'';const a=C.value;if(a>=0&&e.cells.length>a){const t=e.cells[a]?.value;return void 0!==t?String(t):''}return''}(t.currentRowData);return e?`${t.tableName} - ${e}`:t.tableName}),V=(0,l.computed)(()=>new Set(f.value.keys())),E=(0,l.computed)(()=>[...f.value.entries()].map(([e,a])=>`${e}:${a.substring(0,10)}`).join(',')),B=(0,l.computed)(()=>t.currentRowData?0===f.value.size?t.currentRowData:{index:t.currentRowData.index,key:t.currentRowData.key,cells:t.currentRowData.cells.map((e,a)=>f.value.has(a)?{...e,value:f.value.get(a)}:e)}:{index:0,key:'',cells:[]});function S(e){const a=C.value;return a>=0&&e.cells[a]?e.cells[a]:''}function A(e){return t.currentRowData?i(e,t.currentRowData):{index:0,key:'',cells:[]}}function T(e){const a=c(B.value);return u(e,a)}function U(e,a){a.target.open&&b.value&&(h.value=e)}function D(){b.value=!0,f.value=new Map,v.value=[],h.value=m.value.length>0?m.value[0]:null}function I(){b.value=!1,f.value=new Map,v.value=[],h.value=null}function M(e,a){if(!b.value)return;h.value=e,v.value.push(new Map(f.value));const t=e.cells[a];if(void 0!==t){const e=new Map(f.value);e.set(a,t),f.value=e}}function j(){if(!h.value)return;v.value.push(new Map(f.value));const e=new Map;for(const[a,t]of Object.entries(h.value.cells))e.set(Number(a),t);f.value=e}function F(){0!==v.value.length&&(f.value=new Map(v.value.pop()))}function P(){x.value=!0}function L(){x.value=!1}function R(){f.value.size>0&&o('apply',new Map(f.value)),o('update:visible',!1),o('close')}function O(){m.value=[],b.value=!1,f.value=new Map,v.value=[],h.value=null,x.value=!1}async function H(){g.value=!0;try{console.info('[HistoryDialog] 加载历史快照, 参数:',{tableName:t.tableName,tableId:t.tableId,rowIndex:t.rowIndex}),m.value=await r(t.tableName,t.rowIndex),console.info('[HistoryDialog] 加载到快照数量:',m.value.length),m.value.length>0&&console.info('[HistoryDialog] 快照示例:',m.value[0])}catch(e){console.error('[HistoryDialog] 加载历史快照失败:',e),m.value=[]}finally{g.value=!1}}return(0,l.watch)(()=>t.visible,e=>{e?(console.info('[HistoryDialog] visible 变为 true，开始加载数据'),w.value=t.tableName,y.value=t.rowIndex,O(),H()):O()},{immediate:!0}),(0,l.watch)(()=>[t.tableName,t.rowIndex],([e,a])=>{t.visible&&(e===w.value&&a===y.value||(console.info('[HistoryDialog] 行参数变化，重新加载数据'),w.value=e,y.value=a,O(),H()))}),(a,t)=>e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-modal-container',onClick:(0,l.withModifiers)(R,['self'])},[(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-modal acu-history-modal',{'acu-mobile-edit-mode':b.value}])},[(0,l.createCommentVNode)(' 头部 '),(0,l.createElementVNode)('div',Fi,[(0,l.createCommentVNode)(' 移动端拖动把手 '),t[1]||(t[1]=(0,l.createElementVNode)('div',{class:'acu-drag-handle acu-mobile-only'},null,-1)),(0,l.createElementVNode)('span',Pi,[t[0]||(t[0]=(0,l.createElementVNode)('i',{class:'fas fa-history'},null,-1)),(0,l.createTextVNode)(' 历史记录 - '+(0,l.toDisplayString)(N.value),1)]),(0,l.createCommentVNode)(' PC端在头部显示完成按钮 '),(0,l.createElementVNode)('button',{class:'acu-close-pill acu-pc-only',onClick:R},'完成')]),(0,l.createCommentVNode)(' PC 端布局：左右分栏（使用 CSS 媒体查询控制显示） '),(0,l.createElementVNode)('div',Li,[(0,l.createCommentVNode)(' 左侧：历史记录列表 '),(0,l.createElementVNode)('div',{class:'acu-history-sidebar',style:(0,l.normalizeStyle)({width:`${k.value+64}px`})},[g.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ri,[...t[2]||(t[2]=[(0,l.createElementVNode)('i',{class:'fas fa-spinner fa-spin'},null,-1),(0,l.createElementVNode)('span',null,'加载历史记录...',-1)])])):0===m.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',Oi,[...t[3]||(t[3]=[(0,l.createElementVNode)('i',{class:'fas fa-history'},null,-1),(0,l.createElementVNode)('span',null,'暂无历史记录',-1)])])):((0,l.openBlock)(),(0,l.createElementBlock)('div',Hi,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(m.value,(a,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('details',{key:a.id||a.timestamp,open:0===t,class:'acu-history-item',onToggle:e=>U(a,e)},[(0,l.createElementVNode)('summary',Yi,[(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['acu-history-badge',a.source])},(0,l.toDisplayString)('manual'===a.source?'手动':'AI'),3),(0,l.createElementVNode)('span',Wi,' #'+(0,l.toDisplayString)(t+1)+' '+(0,l.toDisplayString)(S(a)),1),(0,l.createElementVNode)('span',qi,(0,l.toDisplayString)((0,l.unref)(s)(a.timestamp)),1)]),(0,l.createElementVNode)('div',Xi,[(0,l.createVNode)(go,{data:A(a),'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!1,'show-index':!1,'show-history-button':!1,'title-col-index':C.value,'custom-highlights':b.value?T(a):void 0,onCellClick:(e,t)=>M(a,t)},null,8,['data','table-name','table-id','title-col-index','custom-highlights','onCellClick'])])],40,Gi))),128))]))],4),(0,l.createCommentVNode)(' 右侧：当前卡片 + 操作区 '),(0,l.createElementVNode)('div',{class:'acu-history-main',style:(0,l.normalizeStyle)({width:`${k.value+64}px`})},[(0,l.createElementVNode)('div',Ki,[t[4]||(t[4]=(0,l.createElementVNode)('i',{class:'fas fa-file-alt'},null,-1)),t[5]||(t[5]=(0,l.createTextVNode)(' 当前版本 ',-1)),f.value.size>0?((0,l.openBlock)(),(0,l.createElementBlock)('span',Ji,' (已修改 '+(0,l.toDisplayString)(f.value.size)+' 处) ',1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',Qi,[((0,l.openBlock)(),(0,l.createBlock)(go,{key:`current-pc-${E.value}`,data:B.value,'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!0,'show-index':!0,'show-history-button':!1,'title-col-index':C.value,'custom-highlights':V.value},null,8,['data','table-name','table-id','title-col-index','custom-highlights']))]),(0,l.createCommentVNode)(' 操作按钮 '),(0,l.createElementVNode)('div',Zi,[b.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createElementVNode)('button',{class:'acu-modal-btn primary',disabled:!h.value,onClick:j},[...t[7]||(t[7]=[(0,l.createElementVNode)('i',{class:'fas fa-layer-group'},null,-1),(0,l.createTextVNode)(' 整卡覆盖 ',-1)])],8,ec),(0,l.createElementVNode)('button',{class:'acu-modal-btn secondary',disabled:0===v.value.length,onClick:F},[...t[8]||(t[8]=[(0,l.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,l.createTextVNode)(' 撤销 ',-1)])],8,ac),(0,l.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:I},[...t[9]||(t[9]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1),(0,l.createTextVNode)(' 退出编辑',-1)])])],64)):((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'acu-modal-btn primary acu-btn-start-edit',onClick:D},[...t[6]||(t[6]=[(0,l.createElementVNode)('i',{class:'fas fa-edit'},null,-1),(0,l.createTextVNode)(' 启动编辑 ',-1)])]))]),(0,l.createCommentVNode)(' 提示信息 '),(0,l.createElementVNode)('div',tc,[t[10]||(t[10]=(0,l.createElementVNode)('i',{class:'fas fa-info-circle'},null,-1)),b.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',nc,'点击左侧历史卡片的单元格进行覆盖')):((0,l.openBlock)(),(0,l.createElementBlock)('span',oc,'点击"启动编辑"开始修改'))])],4)]),(0,l.createCommentVNode)(' 移动端布局：全屏分区（使用 CSS 媒体查询控制显示） '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-history-layout acu-mobile-layout',{'acu-mobile-edit-mode':b.value}])},[(0,l.createCommentVNode)(' 非编辑模式：只显示历史列表 '),b.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' 编辑模式：上下分屏 '),(0,l.createCommentVNode)(' 上半部分：历史记录滚动区 '),(0,l.createElementVNode)('div',bc,[t[17]||(t[17]=(0,l.createElementVNode)('div',{class:'acu-section-label'},[(0,l.createElementVNode)('i',{class:'fas fa-history'}),(0,l.createTextVNode)(' 历史记录（点击单元格覆盖）')],-1)),(0,l.createElementVNode)('div',fc,[0===m.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',vc,[...t[16]||(t[16]=[(0,l.createElementVNode)('i',{class:'fas fa-history'},null,-1),(0,l.createElementVNode)('span',null,'暂无历史记录',-1)])])):((0,l.openBlock)(),(0,l.createElementBlock)('div',hc,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(m.value,(a,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('details',{key:a.id||a.timestamp,open:0===t,class:'acu-history-item',onToggle:e=>U(a,e)},[(0,l.createElementVNode)('summary',wc,[(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['acu-history-badge',a.source])},(0,l.toDisplayString)('manual'===a.source?'手动':'AI'),3),(0,l.createElementVNode)('span',yc,' #'+(0,l.toDisplayString)(t+1)+' '+(0,l.toDisplayString)(S(a)),1),(0,l.createElementVNode)('span',kc,(0,l.toDisplayString)((0,l.unref)(s)(a.timestamp)),1)]),(0,l.createElementVNode)('div',Cc,[(0,l.createVNode)(go,{data:A(a),'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!1,'show-index':!1,'show-history-button':!1,'title-col-index':C.value,'custom-highlights':T(a),onCellClick:(e,t)=>M(a,t)},null,8,['data','table-name','table-id','title-col-index','custom-highlights','onCellClick'])])],40,xc))),128))]))])]),(0,l.createCommentVNode)(' 下半部分：当前版本滚动区 '),(0,l.createElementVNode)('div',Nc,[(0,l.createElementVNode)('div',Vc,[t[18]||(t[18]=(0,l.createElementVNode)('i',{class:'fas fa-file-alt'},null,-1)),t[19]||(t[19]=(0,l.createTextVNode)(' 当前版本 ',-1)),f.value.size>0?((0,l.openBlock)(),(0,l.createElementBlock)('span',Ec,'(已修改 '+(0,l.toDisplayString)(f.value.size)+' 处)',1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',zc,[((0,l.openBlock)(),(0,l.createBlock)(go,{key:`current-mobile-${E.value}`,data:B.value,'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!0,'show-index':!0,'show-history-button':!1,'title-col-index':C.value,'custom-highlights':V.value},null,8,['data','table-name','table-id','title-col-index','custom-highlights']))])]),(0,l.createCommentVNode)(' 编辑模式底部按钮 '),(0,l.createElementVNode)('div',Bc,[(0,l.createElementVNode)('button',{disabled:0===v.value.length,onClick:F},[...t[20]||(t[20]=[(0,l.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,l.createTextVNode)(' 撤销',-1)])],8,Sc),(0,l.createElementVNode)('button',{class:'acu-btn-primary',disabled:!h.value,onClick:j},[...t[21]||(t[21]=[(0,l.createElementVNode)('i',{class:'fas fa-layer-group'},null,-1),(0,l.createTextVNode)(' 整卡覆盖 ',-1)])],8,Ac),(0,l.createElementVNode)('button',{onClick:I},[...t[22]||(t[22]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1),(0,l.createTextVNode)(' 退出编辑',-1)])]),(0,l.createElementVNode)('button',{class:'acu-btn-done',onClick:R},[...t[23]||(t[23]=[(0,l.createElementVNode)('i',{class:'fas fa-check'},null,-1),(0,l.createTextVNode)(' 完成',-1)])])])],64)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:0},[(0,l.createElementVNode)('div',rc,[g.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',ic,[...t[11]||(t[11]=[(0,l.createElementVNode)('i',{class:'fas fa-spinner fa-spin'},null,-1),(0,l.createElementVNode)('span',null,'加载历史记录...',-1)])])):0===m.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',cc,[...t[12]||(t[12]=[(0,l.createElementVNode)('i',{class:'fas fa-history'},null,-1),(0,l.createElementVNode)('span',null,'暂无历史记录',-1)])])):((0,l.openBlock)(),(0,l.createElementBlock)('div',lc,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(m.value,(a,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('details',{key:a.id||a.timestamp,open:0===t,class:'acu-history-item',onToggle:e=>U(a,e)},[(0,l.createElementVNode)('summary',uc,[(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['acu-history-badge',a.source])},(0,l.toDisplayString)('manual'===a.source?'手动':'AI'),3),(0,l.createElementVNode)('span',dc,' #'+(0,l.toDisplayString)(t+1)+' '+(0,l.toDisplayString)(S(a)),1),(0,l.createElementVNode)('span',pc,(0,l.toDisplayString)((0,l.unref)(s)(a.timestamp)),1)]),(0,l.createElementVNode)('div',mc,[(0,l.createVNode)(go,{data:A(a),'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!1,'show-index':!1,'show-history-button':!1,'title-col-index':C.value},null,8,['data','table-name','table-id','title-col-index'])])],40,sc))),128))]))]),(0,l.createCommentVNode)(' 非编辑模式底部按钮 '),(0,l.createElementVNode)('div',gc,[(0,l.createElementVNode)('button',{class:'acu-btn-preview',onTouchstart:(0,l.withModifiers)(P,['prevent']),onTouchend:(0,l.withModifiers)(L,['prevent']),onMousedown:P,onMouseup:L,onMouseleave:L},[...t[13]||(t[13]=[(0,l.createElementVNode)('i',{class:'fas fa-eye'},null,-1),(0,l.createTextVNode)(' 预览最新 ',-1)])],32),(0,l.createElementVNode)('button',{class:'acu-btn-primary',onClick:D},[...t[14]||(t[14]=[(0,l.createElementVNode)('i',{class:'fas fa-edit'},null,-1),(0,l.createTextVNode)(' 启动编辑',-1)])]),(0,l.createElementVNode)('button',{class:'acu-btn-done',onClick:R},[...t[15]||(t[15]=[(0,l.createElementVNode)('i',{class:'fas fa-check'},null,-1),(0,l.createTextVNode)(' 完成',-1)])])])],64)),(0,l.createCommentVNode)(' 预览悬浮层 '),(0,l.createVNode)(l.Transition,{name:'preview-fade'},{default:(0,l.withCtx)(()=>[x.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',Tc,[(0,l.createVNode)(go,{data:B.value,'table-name':e.tableName,'table-id':e.tableId,'view-mode':'list','show-header':!0,'show-index':!0,'show-history-button':!1,'title-col-index':C.value},null,8,['data','table-name','table-id','title-col-index'])])):(0,l.createCommentVNode)('v-if',!0)]),_:1})],2)],2)])):(0,l.createCommentVNode)('v-if',!0)}}),Dc={class:'acu-modal-body'},Ic={class:'floor-input-group'},Mc={key:0,class:'floor-info'},_c={key:1,class:'floor-error'},$c={class:'acu-modal-footer'},jc=['disabled'],Fc=(0,l.defineComponent)({__name:'InputFloorDialog',props:{visible:{type:Boolean},currentFloorInfo:{default:''},maxFloor:{default:999}},emits:['update:visible','confirm'],setup(e,{emit:a}){const t=e,o=a,n=(0,l.ref)(),r=(0,l.ref)(),i=(0,l.ref)(null),c=(0,l.computed)(()=>{if(null===i.value||void 0===i.value)return!1;const e=i.value;return Number.isInteger(e)&&0!==e}),s=(0,l.computed)(()=>null===i.value||void 0===i.value?'':0===i.value?'楼层索引不能为 0':Number.isInteger(i.value)?Math.abs(i.value)>t.maxFloor?`楼层索引超出范围 (±${t.maxFloor})`:'':'请输入整数');(0,l.watch)(()=>t.visible,e=>{e&&(i.value=null,(0,l.nextTick)(()=>{r.value?.focus()}))}),j(n,()=>{d()});const u=()=>{c.value&&null!==i.value&&(o('confirm',i.value),o('update:visible',!1))},d=()=>{o('update:visible',!1)};return(a,t)=>e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,l.withModifiers)(d,['self'])},[(0,l.createElementVNode)('div',{ref_key:'dialogRef',ref:n,class:'acu-modal acu-input-floor-modal'},[(0,l.createCommentVNode)(' 头部 '),(0,l.createElementVNode)('div',{class:'acu-modal-header'},[t[2]||(t[2]=(0,l.createElementVNode)('h3',null,[(0,l.createElementVNode)('i',{class:'fas fa-layer-group'}),(0,l.createTextVNode)(' 指定保存楼层 ')],-1)),(0,l.createElementVNode)('button',{class:'acu-modal-close',onClick:d},[...t[1]||(t[1]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])]),(0,l.createCommentVNode)(' 内容 '),(0,l.createElementVNode)('div',Dc,[(0,l.createElementVNode)('div',Ic,[t[5]||(t[5]=(0,l.createElementVNode)('p',{class:'floor-hint'},'输入目标楼层索引。正数为从头开始计数，负数为倒数计数（-1 表示最后一楼）。',-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{ref_key:'inputRef',ref:r,'onUpdate:modelValue':t[0]||(t[0]=e=>i.value=e),type:'number',class:'floor-input',placeholder:'例如: 5 或 -1',onKeydown:[(0,l.withKeys)(u,['enter']),(0,l.withKeys)(d,['escape'])]},null,544),[[l.vModelText,i.value,void 0,{number:!0}]]),e.currentFloorInfo?((0,l.openBlock)(),(0,l.createElementBlock)('div',Mc,[t[3]||(t[3]=(0,l.createElementVNode)('i',{class:'fas fa-info-circle'},null,-1)),(0,l.createElementVNode)('span',null,'当前自动目标楼层: '+(0,l.toDisplayString)(e.currentFloorInfo),1)])):(0,l.createCommentVNode)('v-if',!0),s.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',_c,[t[4]||(t[4]=(0,l.createElementVNode)('i',{class:'fas fa-exclamation-circle'},null,-1)),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(s.value),1)])):(0,l.createCommentVNode)('v-if',!0)])]),(0,l.createCommentVNode)(' 底部 '),(0,l.createElementVNode)('div',$c,[(0,l.createElementVNode)('button',{class:'acu-modal-btn secondary',onClick:d},'取消'),(0,l.createElementVNode)('button',{class:'acu-modal-btn primary',disabled:!c.value,onClick:u},[...t[6]||(t[6]=[(0,l.createElementVNode)('i',{class:'fas fa-save'},null,-1),(0,l.createTextVNode)(' 保存到此楼层 ',-1)])],8,jc)])],512)])):(0,l.createCommentVNode)('v-if',!0)}}),Pc={class:'acu-modal-body'},Lc={key:0,class:'acu-loading-state'},Rc={class:'acu-update-layout'},Oc={class:'acu-update-left'},Hc={class:'acu-settings-section'},Gc={class:'acu-settings-row'},Yc={class:'acu-settings-control acu-preset-control'},Wc=['value'],qc={class:'acu-settings-row'},Xc={class:'acu-settings-control'},Kc=['value'],Jc={class:'acu-settings-section'},Qc={class:'acu-settings-row'},Zc={class:'acu-settings-control'},el={class:'acu-settings-row'},al={class:'acu-settings-control'},tl={class:'acu-settings-row'},ol={class:'acu-settings-control'},nl={class:'acu-settings-row'},rl={class:'acu-settings-control'},il={class:'acu-settings-section'},cl={class:'acu-settings-row'},ll={class:'acu-settings-control'},sl={class:'acu-switch'},ul={key:0,class:'acu-settings-row'},dl={class:'acu-settings-control'},pl={class:'acu-switch'},ml={class:'acu-settings-section acu-show-mobile-only'},gl={class:'acu-collapse-indicator'},bl={class:'acu-table-selector-mobile'},fl={class:'acu-table-selector'},vl={class:'acu-table-selector-header'},hl={class:'acu-table-selector-list'},xl=['onClick'],wl=['checked','onChange'],yl={class:'table-name'},kl={key:0,class:'acu-table-selector-empty'},Cl={class:'acu-table-selector-footer'},Nl={key:0,style:{color:'var(--acu-title-color)'}},Vl={class:'acu-update-right acu-hide-mobile'},El={class:'acu-table-selector'},zl={class:'acu-table-selector-header'},Bl={class:'acu-table-selector-list'},Sl=['onClick'],Al=['checked','onChange'],Tl={class:'table-name'},Ul={key:0,class:'acu-table-selector-empty'},Dl={class:'acu-table-selector-footer'},Il={key:0,style:{color:'var(--acu-title-color)'}},Ml={key:0,class:'acu-issue-alert'},_l={class:'acu-update-action-group'},$l=['disabled'],jl={key:0,class:'fas fa-spinner fa-spin'},Fl={key:1,class:'fas fa-hand-sparkles'},Pl={class:'acu-mini-dialog acu-preset-save-dialog'},Ll={class:'acu-mini-dialog-header'},Rl={class:'acu-mini-dialog-body'},Ol={key:0,class:'acu-duplicate-warning'},Hl={class:'acu-preset-summary'},Gl={class:'acu-preset-summary-list'},Yl={class:'acu-mini-dialog-footer'},Wl=['disabled'],ql=(0,l.defineComponent)({__name:'ManualUpdateDialog',props:{visible:{type:Boolean}},emits:['update:visible'],setup(e,{emit:a}){const t=e,o=a,n=(0,l.ref)(),r=(0,l.ref)(!0),i=(0,l.ref)(!1),c=(0,l.reactive)({autoUpdateThreshold:void 0,autoUpdateFrequency:void 0,updateBatchSize:void 0,skipUpdateFloors:void 0}),s=(0,l.ref)(''),u=(0,l.ref)(''),d=(0,l.ref)(!1),p=(0,l.ref)(''),m=(0,l.ref)(!1),g=(0,l.ref)(!1),b=(0,l.ref)([]),f=(0,l.ref)([]),v=(0,l.ref)(!1),{settings:h,loadSettings:x,saveSettings:w,executeManualUpdate:y,getTableList:k,executeWithPreset:C}=Fa(),N=Ja(),V=wa(),E=(0,l.computed)(()=>N.presets.value),B=(0,l.computed)(()=>V.hasIntegrityIssues),S=(0,l.computed)(()=>V.getIntegritySummary()),A=(0,l.computed)(()=>{const e=p.value.trim();return!!e&&null!==N.findPresetByName(e)}),T=(0,l.computed)(()=>0!==b.value.length&&f.value.length===b.value.length),U=(0,l.computed)(()=>{const e=b.value.filter(e=>e.isSummaryOrOutline);return 0!==e.length&&(f.value.length===e.length&&e.every(e=>f.value.includes(e.name)))});function D(){d.value=!1,o('update:visible',!1)}async function I(e,a){if(void 0!==a&&!isNaN(a))try{await w({[e]:a}),console.info(`[ACU] 配置项 ${e} 已更新为:`,a)}catch(a){console.error(`[ACU] 保存配置项 ${e} 失败:`,a),Pa.toast.error('保存配置失败')}}async function M(){if(!s.value)return;const e=E.value.find(e=>e.id===s.value);e&&(Object.assign(c,e.settings),f.value=e.autoTrigger.updateTargetTables||[],await w(e.settings),N.setActivePreset(s.value),Pa.toast.success('已应用预设配置'))}function F(){N.setAutoFixPreset(u.value||null),Pa.toast.info(u.value?'已设置自动修复预设':'已禁用自动修复')}function P(){const e=p.value.trim();if(!e)return;const{preset:a,isNew:t}=N.createOrUpdatePreset(e,{autoUpdateThreshold:c.autoUpdateThreshold,updateBatchSize:c.updateBatchSize,skipUpdateFloors:c.skipUpdateFloors,autoUpdateFrequency:c.autoUpdateFrequency},{enabled:m.value,onEmptyCell:!0,onIndexGap:!0,targetTables:['总结表','大纲表'],updateTargetTables:f.value});d.value=!1,p.value='',t?Pa.toast.success(`预设"${e}"已创建`):Pa.toast.success(`预设"${e}"已更新`)}function L(){if(!s.value)return;const e=s.value,a=E.value.find(a=>a.id===e);a&&confirm(`确定删除预设"${a.name}"吗？`)&&(N.deletePreset(s.value),s.value='',Pa.toast.success('预设已删除'))}function R(){N.setGlobalAutoTrigger(m.value),s.value&&N.updatePreset(s.value,{autoTrigger:{enabled:m.value,onEmptyCell:!0,onIndexGap:!0,targetTables:['总结表','大纲表'],updateTargetTables:f.value}}),m.value||(g.value=!1,N.setAutoFixPreset(null),V.clearIntegrityIssues())}function O(){if(N.setGlobalAutoExecute(g.value),g.value)if(!u.value&&E.value.length>0)u.value=E.value[0].id,N.setAutoFixPreset(u.value),Pa.toast.info(`已自动选择预设"${E.value[0].name}"用于自动修复`);else{if(0===E.value.length)return Pa.toast.warning('请先保存一个预设再启用自动执行'),g.value=!1,void N.setGlobalAutoExecute(!1);N.setAutoFixPreset(u.value)}else N.setAutoFixPreset(null),u.value=''}function H(e){const a=f.value.indexOf(e);-1===a?f.value.push(e):f.value.splice(a,1),s.value&&N.updatePreset(s.value,{autoTrigger:{enabled:m.value,onEmptyCell:!0,onIndexGap:!0,targetTables:['总结表','大纲表'],updateTargetTables:f.value}})}function G(){T.value?f.value=[]:f.value=b.value.map(e=>e.name)}function Y(){const e=b.value.filter(e=>e.isSummaryOrOutline);f.value=e.map(e=>e.name)}async function W(){if(!i.value){i.value=!0;try{const e=await C({autoUpdateThreshold:c.autoUpdateThreshold,updateBatchSize:c.updateBatchSize,skipUpdateFloors:c.skipUpdateFloors,autoUpdateFrequency:c.autoUpdateFrequency},f.value);e.success?Pa.toast.success('✅ 手动更新已执行'):Pa.toast.warning('⚠️ '+(e.message||'更新执行完成，请检查结果'))}catch(e){console.error('[ACU] 手动更新执行失败:',e),Pa.toast.error('手动更新执行失败')}finally{i.value=!1}}}return(0,l.watch)(()=>t.visible,async e=>{if(e){r.value=!0;try{await x(),Object.assign(c,{autoUpdateThreshold:h.value.autoUpdateThreshold,autoUpdateFrequency:h.value.autoUpdateFrequency,updateBatchSize:h.value.updateBatchSize,skipUpdateFloors:h.value.skipUpdateFloors}),N.loadPresets();const e=N.autoFixPreset.value?.id;u.value=e||'',m.value=N.globalAutoTriggerEnabled.value,g.value=N.globalAutoExecuteEnabled.value;const a=N.activePreset.value;a&&(f.value=a.autoTrigger.updateTargetTables||[]),b.value=k()}catch(e){console.error('[ACU] 加载配置失败:',e),Pa.toast.error('加载配置失败')}finally{r.value=!1}}},{immediate:!0}),j(n,()=>{D()}),(a,t)=>e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-modal-container acu-center-modal',onClick:(0,l.withModifiers)(D,['self'])},[(0,l.createElementVNode)('div',{ref_key:'dialogRef',ref:n,class:'acu-modal acu-manual-update-modal'},[(0,l.createCommentVNode)(' 头部 '),(0,l.createElementVNode)('div',{class:'acu-modal-header'},[(0,l.createCommentVNode)(' 返回按钮 '),(0,l.createElementVNode)('button',{class:'acu-modal-back',onClick:D},[...t[20]||(t[20]=[(0,l.createElementVNode)('i',{class:'fas fa-arrow-left'},null,-1)])]),t[21]||(t[21]=(0,l.createElementVNode)('span',{class:'acu-modal-title'},'手动更新配置',-1)),(0,l.createCommentVNode)(' 胶囊式完成按钮 '),(0,l.createElementVNode)('button',{class:'acu-close-pill',onClick:D},'完成')]),(0,l.createCommentVNode)(' 内容 '),(0,l.createElementVNode)('div',Pc,[(0,l.createCommentVNode)(' 加载状态 '),r.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',Lc,[...t[22]||(t[22]=[(0,l.createElementVNode)('i',{class:'fas fa-spinner fa-spin'},null,-1),(0,l.createElementVNode)('span',null,'加载配置中...',-1)])])):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' 配置项 '),(0,l.createCommentVNode)(' PC端并排布局 '),(0,l.createElementVNode)('div',Rc,[(0,l.createCommentVNode)(' 左侧：参数设置 '),(0,l.createElementVNode)('div',Oc,[(0,l.createCommentVNode)(' 预设管理区域 '),(0,l.createElementVNode)('div',Hc,[t[29]||(t[29]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-bookmark'}),(0,l.createTextVNode)(' 预设管理 ')],-1)),(0,l.createCommentVNode)(' 预设选择 '),(0,l.createElementVNode)('div',Gc,[t[26]||(t[26]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 选择预设 '),(0,l.createElementVNode)('span',{class:'hint'},'快速应用保存的配置')],-1)),(0,l.createElementVNode)('div',Yc,[(0,l.withDirectives)((0,l.createElementVNode)('select',{'onUpdate:modelValue':t[0]||(t[0]=e=>s.value=e),class:'acu-config-select',onChange:M},[t[23]||(t[23]=(0,l.createElementVNode)('option',{value:''},'-- 当前配置 --',-1)),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(E.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('option',{key:e.id,value:e.id},(0,l.toDisplayString)(e.name),9,Wc))),128))],544),[[l.vModelSelect,s.value]]),(0,l.createElementVNode)('button',{class:'acu-icon-btn',title:'保存为新预设',onClick:t[1]||(t[1]=e=>d.value=!0)},[...t[24]||(t[24]=[(0,l.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])]),s.value?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'acu-icon-btn acu-btn-danger',title:'删除预设',onClick:L},[...t[25]||(t[25]=[(0,l.createElementVNode)('i',{class:'fas fa-trash'},null,-1)])])):(0,l.createCommentVNode)('v-if',!0)])]),(0,l.createCommentVNode)(' 自动修复预设 '),(0,l.createElementVNode)('div',qc,[t[28]||(t[28]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 检测问题时使用 '),(0,l.createElementVNode)('span',{class:'hint'},'检测到问题时自动应用此预设')],-1)),(0,l.createElementVNode)('div',Xc,[(0,l.withDirectives)((0,l.createElementVNode)('select',{'onUpdate:modelValue':t[2]||(t[2]=e=>u.value=e),class:'acu-config-select',onChange:F},[t[27]||(t[27]=(0,l.createElementVNode)('option',{value:''},'-- 禁用 --',-1)),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(E.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('option',{key:e.id,value:e.id},(0,l.toDisplayString)(e.name),9,Kc))),128))],544),[[l.vModelSelect,u.value]])])])]),(0,l.createCommentVNode)(' 参数设置区域 '),(0,l.createElementVNode)('div',Jc,[t[34]||(t[34]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-sliders-h'}),(0,l.createTextVNode)(' 更新参数设置 ')],-1)),(0,l.createCommentVNode)(' AI读取上下文层数 '),(0,l.createElementVNode)('div',Qc,[t[30]||(t[30]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' AI读取上下文层数 '),(0,l.createElementVNode)('span',{class:'hint'},'AI阅读最近多少层来理解剧情')],-1)),(0,l.createElementVNode)('div',Zc,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[3]||(t[3]=e=>c.autoUpdateThreshold=e),type:'number',class:'acu-config-input',min:'1',max:'500',onChange:t[4]||(t[4]=e=>I('autoUpdateThreshold',c.autoUpdateThreshold))},null,544),[[l.vModelText,c.autoUpdateThreshold,void 0,{number:!0}]])])]),(0,l.createCommentVNode)(' 每N层自动更新一次 '),(0,l.createElementVNode)('div',el,[t[31]||(t[31]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 每N层自动更新一次 '),(0,l.createElementVNode)('span',{class:'hint'},'设置自动触发更新的楼层间隔')],-1)),(0,l.createElementVNode)('div',al,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[5]||(t[5]=e=>c.autoUpdateFrequency=e),type:'number',class:'acu-config-input',min:'1',max:'100',onChange:t[6]||(t[6]=e=>I('autoUpdateFrequency',c.autoUpdateFrequency))},null,544),[[l.vModelText,c.autoUpdateFrequency,void 0,{number:!0}]])])]),(0,l.createCommentVNode)(' 每批次更新楼层数 '),(0,l.createElementVNode)('div',tl,[t[32]||(t[32]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 每批次更新楼层数 '),(0,l.createElementVNode)('span',{class:'hint'},'单次更新处理的最大楼层数')],-1)),(0,l.createElementVNode)('div',ol,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[7]||(t[7]=e=>c.updateBatchSize=e),type:'number',class:'acu-config-input',min:'1',max:'50',onChange:t[8]||(t[8]=e=>I('updateBatchSize',c.updateBatchSize))},null,544),[[l.vModelText,c.updateBatchSize,void 0,{number:!0}]])])]),(0,l.createCommentVNode)(' 保留X层楼不更新 '),(0,l.createElementVNode)('div',nl,[t[33]||(t[33]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 保留X层楼不更新 '),(0,l.createElementVNode)('span',{class:'hint'},'最近的几层楼跳过更新')],-1)),(0,l.createElementVNode)('div',rl,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[9]||(t[9]=e=>c.skipUpdateFloors=e),type:'number',class:'acu-config-input',min:'0',max:'20',onChange:t[10]||(t[10]=e=>I('skipUpdateFloors',c.skipUpdateFloors))},null,544),[[l.vModelText,c.skipUpdateFloors,void 0,{number:!0}]])])])]),(0,l.createCommentVNode)(' 智能检测设置 '),(0,l.createElementVNode)('div',il,[t[39]||(t[39]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-magic'}),(0,l.createTextVNode)(' 智能检测 ')],-1)),(0,l.createCommentVNode)(' 启用智能检测 '),(0,l.createElementVNode)('div',cl,[t[36]||(t[36]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 启用问题检测提示 '),(0,l.createElementVNode)('span',{class:'hint'},'检测编码索引断裂或空单元格时显示警告')],-1)),(0,l.createElementVNode)('div',ll,[(0,l.createElementVNode)('label',sl,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[11]||(t[11]=e=>m.value=e),type:'checkbox',onChange:R},null,544),[[l.vModelCheckbox,m.value]]),t[35]||(t[35]=(0,l.createElementVNode)('span',{class:'slider'},null,-1))])])]),(0,l.createCommentVNode)(' 自动执行修复 '),m.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',ul,[t[38]||(t[38]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 检测到问题时自动执行 '),(0,l.createElementVNode)('span',{class:'hint'},'自动按选定预设触发手动更新')],-1)),(0,l.createElementVNode)('div',dl,[(0,l.createElementVNode)('label',pl,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[12]||(t[12]=e=>g.value=e),type:'checkbox',onChange:O},null,544),[[l.vModelCheckbox,g.value]]),t[37]||(t[37]=(0,l.createElementVNode)('span',{class:'slider'},null,-1))])])])):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' 移动端：折叠式表格选择 '),(0,l.createElementVNode)('div',ml,[(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-settings-title acu-collapsible',{'is-expanded':v.value}]),onClick:t[13]||(t[13]=e=>v.value=!v.value)},[t[40]||(t[40]=(0,l.createElementVNode)('i',{class:'fas fa-table'},null,-1)),t[41]||(t[41]=(0,l.createTextVNode)(' 更新表格选择 ',-1)),(0,l.createElementVNode)('span',gl,(0,l.toDisplayString)(v.value?'▲':'▼'),1)],2),(0,l.withDirectives)((0,l.createElementVNode)('div',bl,[(0,l.createCommentVNode)(' 表格选择器 '),(0,l.createElementVNode)('div',fl,[(0,l.createElementVNode)('div',vl,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-quick-select-btn',{active:T.value}]),onClick:G},[...t[42]||(t[42]=[(0,l.createElementVNode)('i',{class:'fas fa-check-double'},null,-1),(0,l.createTextVNode)(' 全选 ',-1)])],2),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-quick-select-btn',{active:U.value}]),onClick:Y},[...t[43]||(t[43]=[(0,l.createElementVNode)('i',{class:'fas fa-star'},null,-1),(0,l.createTextVNode)(' 仅总结/大纲 ',-1)])],2)]),(0,l.createElementVNode)('div',hl,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(b.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.key,class:(0,l.normalizeClass)(['acu-table-selector-item',{'is-summary-outline':e.isSummaryOrOutline,'is-selected':f.value.includes(e.name)}]),onClick:a=>H(e.name)},[(0,l.createElementVNode)('input',{type:'checkbox',checked:f.value.includes(e.name),onClick:t[14]||(t[14]=(0,l.withModifiers)(()=>{},['stop'])),onChange:a=>H(e.name)},null,40,wl),(0,l.createElementVNode)('span',yl,(0,l.toDisplayString)(e.name),1)],10,xl))),128)),0===b.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',kl,[...t[44]||(t[44]=[(0,l.createElementVNode)('i',{class:'fas fa-inbox'},null,-1),(0,l.createTextVNode)(' 暂无可用表格 ',-1)])])):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',Cl,[(0,l.createTextVNode)(' 已选择: '+(0,l.toDisplayString)(f.value.length)+'/'+(0,l.toDisplayString)(b.value.length)+' 个表格 ',1),0===f.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('span',Nl,'(更新全部)')):(0,l.createCommentVNode)('v-if',!0)])])],512),[[l.vShow,v.value]])])]),(0,l.createCommentVNode)(' 右侧：表格选择 (PC端显示) '),(0,l.createElementVNode)('div',Vl,[(0,l.createElementVNode)('div',El,[(0,l.createElementVNode)('div',zl,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-quick-select-btn',{active:T.value}]),onClick:G},[...t[45]||(t[45]=[(0,l.createElementVNode)('i',{class:'fas fa-check-double'},null,-1),(0,l.createTextVNode)(' 全选 ',-1)])],2),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-quick-select-btn',{active:U.value}]),onClick:Y},[...t[46]||(t[46]=[(0,l.createElementVNode)('i',{class:'fas fa-star'},null,-1),(0,l.createTextVNode)(' 仅总结/大纲 ',-1)])],2)]),(0,l.createElementVNode)('div',Bl,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(b.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.key,class:(0,l.normalizeClass)(['acu-table-selector-item',{'is-summary-outline':e.isSummaryOrOutline,'is-selected':f.value.includes(e.name)}]),onClick:a=>H(e.name)},[(0,l.createElementVNode)('input',{type:'checkbox',checked:f.value.includes(e.name),onClick:t[15]||(t[15]=(0,l.withModifiers)(()=>{},['stop'])),onChange:a=>H(e.name)},null,40,Al),(0,l.createElementVNode)('span',Tl,(0,l.toDisplayString)(e.name),1)],10,Sl))),128)),0===b.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ul,[...t[47]||(t[47]=[(0,l.createElementVNode)('i',{class:'fas fa-inbox'},null,-1),(0,l.createTextVNode)(' 暂无可用表格 ',-1)])])):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',Dl,[(0,l.createTextVNode)(' 已选择: '+(0,l.toDisplayString)(f.value.length)+'/'+(0,l.toDisplayString)(b.value.length)+' 个表格 ',1),0===f.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('span',Il,'(更新全部)')):(0,l.createCommentVNode)('v-if',!0)])])])]),(0,l.createCommentVNode)(' 问题提示 '),B.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ml,[t[48]||(t[48]=(0,l.createElementVNode)('i',{class:'fas fa-exclamation-triangle'},null,-1)),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(S.value),1)])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 执行按钮 '),(0,l.createElementVNode)('div',_l,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-update-btn',{'is-updating':i.value}]),disabled:i.value,onClick:W},[i.value?((0,l.openBlock)(),(0,l.createElementBlock)('i',jl)):((0,l.openBlock)(),(0,l.createElementBlock)('i',Fl)),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(i.value?'正在更新...':'立即执行手动更新'),1)],10,$l)])],64))])],512),(0,l.createCommentVNode)(' 保存预设对话框 '),d.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-modal-overlay',onClick:t[19]||(t[19]=(0,l.withModifiers)(e=>d.value=!1,['self']))},[(0,l.createElementVNode)('div',Pl,[(0,l.createElementVNode)('div',Ll,[t[50]||(t[50]=(0,l.createElementVNode)('span',null,'保存为预设',-1)),(0,l.createElementVNode)('button',{class:'acu-mini-close',onClick:t[16]||(t[16]=e=>d.value=!1)},[...t[49]||(t[49]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])]),(0,l.createElementVNode)('div',Rl,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[17]||(t[17]=e=>p.value=e),type:'text',class:'acu-config-input acu-full-width',placeholder:'输入预设名称',onKeyup:(0,l.withKeys)(P,['enter'])},null,544),[[l.vModelText,p.value]]),(0,l.createCommentVNode)(' 重名提示 '),A.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ol,[...t[51]||(t[51]=[(0,l.createElementVNode)('i',{class:'fas fa-exclamation-circle'},null,-1),(0,l.createTextVNode)(' 已存在同名预设，保存将覆盖原有配置 ',-1)])])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 保存内容摘要 '),(0,l.createElementVNode)('div',Hl,[t[52]||(t[52]=(0,l.createElementVNode)('div',{class:'acu-preset-summary-title'},'将保存以下配置：',-1)),(0,l.createElementVNode)('ul',Gl,[(0,l.createElementVNode)('li',null,'上下文层数: '+(0,l.toDisplayString)(c.autoUpdateThreshold),1),(0,l.createElementVNode)('li',null,'更新频率: 每 '+(0,l.toDisplayString)(c.autoUpdateFrequency)+' 层',1),(0,l.createElementVNode)('li',null,'批次大小: '+(0,l.toDisplayString)(c.updateBatchSize),1),(0,l.createElementVNode)('li',null,'跳过层数: '+(0,l.toDisplayString)(c.skipUpdateFloors),1),(0,l.createElementVNode)('li',null,'表格选择: '+(0,l.toDisplayString)(f.value.length?f.value.join(', '):'全部表格'),1)])])]),(0,l.createElementVNode)('div',Yl,[(0,l.createElementVNode)('button',{class:'acu-btn-secondary',onClick:t[18]||(t[18]=e=>d.value=!1)},'取消'),(0,l.createElementVNode)('button',{class:'acu-btn-primary',disabled:!p.value.trim(),onClick:P},(0,l.toDisplayString)(A.value?'覆盖保存':'保存'),9,Wl)])])])):(0,l.createCommentVNode)('v-if',!0)])):(0,l.createCommentVNode)('v-if',!0)}});c(586);const Xl=(0,Bt.A)(ql,[['__scopeId','data-v-acb73d8c']]),Kl={class:'acu-purge-content'},Jl={class:'acu-purge-inputs'},Ql={class:'acu-purge-btns'},Zl={class:'acu-purge-btns-right'},es=['disabled'],as=(0,l.defineComponent)({__name:'PurgeRangeDialog',props:{visible:{type:Boolean},maxFloor:{default:999}},emits:['update:visible','confirm'],setup(e,{emit:a}){const t=e,o=a,n=(0,l.ref)(),r=(0,l.ref)(),i=(0,l.ref)(),c=(0,l.ref)(null),s=(0,l.ref)(null),u=(0,l.ref)(!1),d=(0,l.ref)(!1);const p=(0,l.computed)(()=>null!==c.value&&null!==s.value&&(!isNaN(c.value)&&!isNaN(s.value)&&(!(c.value<0||s.value<0)&&!(c.value>s.value))));(0,l.watch)(()=>t.visible,e=>{if(e){const e=function(){let e=window.SillyTavern||(window.parent?window.parent.SillyTavern:null);!e&&window.top&&window.top.SillyTavern&&(e=window.top.SillyTavern);let a=-1,t=0;if(e&&e.chat){t=Math.max(0,e.chat.length-1);for(let t=e.chat.length-1;t>=0;t--){const o=e.chat[t];if(!o.is_user&&o.TavernDB_ACU_IsolatedData){const e=Object.keys(o.TavernDB_ACU_IsolatedData);let n=!1;for(const a of e){const e=o.TavernDB_ACU_IsolatedData[a];if(e&&e.independentData&&Object.keys(e.independentData).length>0){n=!0;break}}if(n){a=t;break}}}}return{start:-1!==a?a:t,end:-1!==a?a:t}}();c.value=e.start,s.value=e.end,u.value=!1,(0,l.nextTick)(()=>{r.value?.focus()})}}),j(n,()=>{b()});const m=()=>{i.value?.focus()},g=()=>{p.value&&null!==c.value&&null!==s.value?(o('confirm',c.value,s.value),o('update:visible',!1)):(u.value=!0,setTimeout(()=>{u.value=!1},500),Pa.toast.warning('请输入有效的楼层范围 (Start <= End)'))},b=()=>{o('update:visible',!1)},f=()=>{d.value=!0},v=()=>{o('update:visible',!1)};return(a,t)=>((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,null,[e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-modal-container acu-purge-overlay',onClick:(0,l.withModifiers)(b,['self'])},[(0,l.createElementVNode)('div',{ref_key:'dialogRef',ref:n,class:'acu-modal acu-purge-range-modal'},[(0,l.createCommentVNode)(' 标题区 '),t[7]||(t[7]=(0,l.createElementVNode)('div',{class:'acu-purge-title'},'清除数据范围',-1)),(0,l.createCommentVNode)(' 内容区 '),(0,l.createElementVNode)('div',Kl,[(0,l.createCommentVNode)(' 装饰图标 '),t[4]||(t[4]=(0,l.createElementVNode)('div',{class:'acu-purge-icon'},[(0,l.createElementVNode)('i',{class:'fa-solid fa-eraser'})],-1)),(0,l.createCommentVNode)(' 提示文字 '),t[5]||(t[5]=(0,l.createElementVNode)('p',{class:'acu-purge-hint'},[(0,l.createTextVNode)(' 请输入要清除数据的楼层范围'),(0,l.createElementVNode)('br'),(0,l.createElementVNode)('span',{class:'acu-purge-hint-sub'},'(起始楼层 - 结束楼层)')],-1)),(0,l.createCommentVNode)(' 范围输入 '),(0,l.createElementVNode)('div',Jl,[(0,l.withDirectives)((0,l.createElementVNode)('input',{ref_key:'startInputRef',ref:r,'onUpdate:modelValue':t[0]||(t[0]=e=>c.value=e),type:'number',class:'acu-purge-input',placeholder:'Start',min:'0',onKeydown:(0,l.withKeys)(m,['enter'])},null,544),[[l.vModelText,c.value,void 0,{number:!0}]]),t[3]||(t[3]=(0,l.createElementVNode)('span',{class:'acu-purge-separator'},'-',-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{ref_key:'endInputRef',ref:i,'onUpdate:modelValue':t[1]||(t[1]=e=>s.value=e),type:'number',class:'acu-purge-input',placeholder:'End',min:'0',onKeydown:(0,l.withKeys)(g,['enter'])},null,544),[[l.vModelText,s.value,void 0,{number:!0}]])])]),(0,l.createCommentVNode)(' 按钮区 '),(0,l.createElementVNode)('div',Ql,[(0,l.createElementVNode)('button',{class:'acu-purge-btn acu-purge-btn-advanced',onClick:f},[...t[6]||(t[6]=[(0,l.createElementVNode)('i',{class:'fas fa-cogs'},null,-1),(0,l.createTextVNode)(' 高级 ',-1)])]),(0,l.createElementVNode)('div',Zl,[(0,l.createElementVNode)('button',{class:'acu-purge-btn acu-purge-btn-cancel',onClick:b},'取消'),(0,l.createElementVNode)('button',{class:'acu-purge-btn acu-purge-btn-confirm',disabled:!p.value,onClick:g},' 确认清除 ',8,es)])])],512)])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 高级清除弹窗 '),(0,l.createVNode)(Ur,{visible:d.value,'onUpdate:visible':t[2]||(t[2]=e=>d.value=e),'initial-start-floor':c.value??void 0,'initial-end-floor':s.value??void 0,onConfirm:v},null,8,['visible','initial-start-floor','initial-end-floor'])],64))}}),ts={class:'acu-ball-appearance-panel'},os={class:'acu-ball-preview-fixed'},ns=['src'],rs={key:3,class:'fa-solid fa-image'},is={class:'acu-ball-scroll-content'},cs={class:'acu-settings-section'},ls={class:'acu-settings-title-row'},ss={class:'acu-preview-buttons'},us={class:'acu-anim-grid'},ds={class:'acu-settings-section'},ps={class:'acu-settings-group'},ms={class:'acu-settings-row'},gs={class:'acu-settings-control acu-color-picker-inline'},bs={class:'acu-settings-row'},fs={class:'acu-settings-label'},vs={class:'hint'},hs={class:'acu-settings-control'},xs={class:'acu-settings-section'},ws={class:'acu-settings-group'},ys={class:'acu-settings-row'},ks={class:'acu-settings-control acu-color-picker-inline'},Cs={class:'acu-settings-row'},Ns={class:'acu-settings-label'},Vs={class:'hint'},Es={class:'acu-settings-control'},zs={class:'acu-settings-section'},Bs={class:'acu-settings-group'},Ss={class:'acu-settings-row'},As={class:'acu-settings-label'},Ts={class:'hint'},Us={class:'acu-settings-control'},Ds={class:'acu-settings-section'},Is={class:'acu-icon-type-row'},Ms={key:0,class:'acu-icon-input-area'},_s={class:'acu-icon-input'},$s={key:1,class:'acu-icon-input-area'},js={class:'acu-emoji-input'},Fs={class:'acu-icon-input-area'},Ps={class:'acu-image-preview-row'},Ls=['src'],Rs=(0,l.defineComponent)({__name:'BallAppearancePanel',setup(e){const a=ue(),t=(0,l.reactive)({...a.appearance}),o=(0,l.ref)(!1),n=(0,l.ref)(!1),r=(0,l.ref)();(0,l.watch)(t,e=>{a.updateAppearance(e)},{deep:!0});const i=(0,l.computed)(()=>({'p-anim-ripple':o.value&&'ripple'===t.notifyAnimation,'p-anim-arc':o.value&&'arc'===t.notifyAnimation,'p-notify':n.value})),c=(0,l.computed)(()=>({'--ball-size':`${t.size}px`,'--ball-border-color':t.borderColor,'--ball-border-color-rgba':Fe(t.borderColor,t.borderOpacity),'--ball-bg-color':Fe(t.bgColor,t.bgOpacity)}));function s(){o.value=!0,n.value=!1,setTimeout(()=>{o.value=!1},3e3)}function u(){n.value=!0,o.value=!1,setTimeout(()=>{n.value=!1},3e3)}function d(){t.type='image',r.value?.click()}async function p(e){const a=e.target,o=a.files?.[0];if(o){try{let e=await $e(o);e=await je(e,100,.8),t.content=e}catch(e){console.error('[ACU] 图片上传失败:',e)}a.value=''}}function m(){Object.assign(t,ee)}return(e,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',ts,[(0,l.createCommentVNode)(' 预览区域 - 固定在顶部（使用 position: absolute） '),(0,l.createElementVNode)('div',os,[(0,l.createElementVNode)('button',{class:'acu-reset-mini-btn',title:'重置为默认',onClick:(0,l.withModifiers)(m,['stop'])},[...a[14]||(a[14]=[(0,l.createElementVNode)('i',{class:'fas fa-undo'},null,-1)])]),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-ball-preview',i.value]),style:(0,l.normalizeStyle)(c.value)},['icon'===t.type?((0,l.openBlock)(),(0,l.createElementBlock)('i',{key:0,class:(0,l.normalizeClass)(['fa-solid',t.content])},null,2)):'emoji'===t.type?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createTextVNode)((0,l.toDisplayString)(t.content),1)],64)):'image'===t.type&&t.content?((0,l.openBlock)(),(0,l.createElementBlock)('img',{key:2,src:t.content,alt:''},null,8,ns)):((0,l.openBlock)(),(0,l.createElementBlock)('i',rs))],6)]),(0,l.createCommentVNode)(' 可滚动内容区 '),(0,l.createElementVNode)('div',is,[(0,l.createCommentVNode)(' 通知动画类型 - 标题与按钮同行 '),(0,l.createElementVNode)('div',cs,[(0,l.createElementVNode)('div',ls,[a[15]||(a[15]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-bell'}),(0,l.createTextVNode)(' AI 填表通知动画 ')],-1)),(0,l.createElementVNode)('div',ss,[(0,l.createElementVNode)('button',{class:'acu-tool-btn',onClick:(0,l.withModifiers)(s,['stop'])},'▶️ 播放'),(0,l.createElementVNode)('button',{class:'acu-tool-btn',onClick:(0,l.withModifiers)(u,['stop'])},'🔔 通知')])]),(0,l.createElementVNode)('div',us,[(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-anim-option',{active:'ripple'===t.notifyAnimation}]),onClick:a[0]||(a[0]=(0,l.withModifiers)(e=>t.notifyAnimation='ripple',['stop']))},[...a[16]||(a[16]=[(0,l.createElementVNode)('span',{class:'acu-anim-icon'},'🌊',-1),(0,l.createElementVNode)('span',{class:'acu-anim-name'},'脉冲波纹',-1)])],2),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-anim-option',{active:'arc'===t.notifyAnimation}]),onClick:a[1]||(a[1]=(0,l.withModifiers)(e=>t.notifyAnimation='arc',['stop']))},[...a[17]||(a[17]=[(0,l.createElementVNode)('span',{class:'acu-anim-icon'},'⚡',-1),(0,l.createElementVNode)('span',{class:'acu-anim-name'},'电磁闪烁',-1)])],2)])]),(0,l.createCommentVNode)(' 边框颜色 '),(0,l.createElementVNode)('div',ds,[a[20]||(a[20]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-palette'}),(0,l.createTextVNode)(' 边框颜色 ')],-1)),(0,l.createElementVNode)('div',ps,[(0,l.createElementVNode)('div',ms,[a[18]||(a[18]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},'颜色',-1)),(0,l.createElementVNode)('div',gs,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':a[2]||(a[2]=e=>t.borderColor=e),type:'text',class:'acu-color-input',placeholder:'#RRGGBB'},null,512),[[l.vModelText,t.borderColor]]),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':a[3]||(a[3]=e=>t.borderColor=e),type:'color',class:'acu-color-swatch'},null,512),[[l.vModelText,t.borderColor]])])]),(0,l.createElementVNode)('div',bs,[(0,l.createElementVNode)('div',fs,[a[19]||(a[19]=(0,l.createTextVNode)(' 透明度 ',-1)),(0,l.createElementVNode)('span',vs,(0,l.toDisplayString)(t.borderOpacity)+'%',1)]),(0,l.createElementVNode)('div',hs,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':a[4]||(a[4]=e=>t.borderOpacity=e),type:'range',min:'0',max:'100',step:'5'},null,512),[[l.vModelText,t.borderOpacity,void 0,{number:!0}]])])])])]),(0,l.createCommentVNode)(' 背景颜色 '),(0,l.createElementVNode)('div',xs,[a[23]||(a[23]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-fill-drip'}),(0,l.createTextVNode)(' 背景颜色 ')],-1)),(0,l.createElementVNode)('div',ws,[(0,l.createElementVNode)('div',ys,[a[21]||(a[21]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},'颜色',-1)),(0,l.createElementVNode)('div',ks,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':a[5]||(a[5]=e=>t.bgColor=e),type:'text',class:'acu-color-input',placeholder:'#RRGGBB'},null,512),[[l.vModelText,t.bgColor]]),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':a[6]||(a[6]=e=>t.bgColor=e),type:'color',class:'acu-color-swatch'},null,512),[[l.vModelText,t.bgColor]])])]),(0,l.createElementVNode)('div',Cs,[(0,l.createElementVNode)('div',Ns,[a[22]||(a[22]=(0,l.createTextVNode)(' 透明度 ',-1)),(0,l.createElementVNode)('span',Vs,(0,l.toDisplayString)(t.bgOpacity)+'%',1)]),(0,l.createElementVNode)('div',Es,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':a[7]||(a[7]=e=>t.bgOpacity=e),type:'range',min:'0',max:'100',step:'5'},null,512),[[l.vModelText,t.bgOpacity,void 0,{number:!0}]])])])])]),(0,l.createCommentVNode)(' 尺寸 '),(0,l.createElementVNode)('div',zs,[a[25]||(a[25]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-expand-arrows-alt'}),(0,l.createTextVNode)(' 尺寸 ')],-1)),(0,l.createElementVNode)('div',Bs,[(0,l.createElementVNode)('div',Ss,[(0,l.createElementVNode)('div',As,[a[24]||(a[24]=(0,l.createTextVNode)(' 球体大小 ',-1)),(0,l.createElementVNode)('span',Ts,(0,l.toDisplayString)(t.size)+'px',1)]),(0,l.createElementVNode)('div',Us,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':a[8]||(a[8]=e=>t.size=e),type:'range',min:'40',max:'100',step:'2'},null,512),[[l.vModelText,t.size,void 0,{number:!0}]])])])])]),(0,l.createCommentVNode)(' 图标类型 '),(0,l.createElementVNode)('div',Ds,[a[35]||(a[35]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-icons'}),(0,l.createTextVNode)(' 图标 ')],-1)),(0,l.createCommentVNode)(' 图标类型按钮 - 图标和文字同行 '),(0,l.createElementVNode)('div',Is,[(0,l.createElementVNode)('label',{class:(0,l.normalizeClass)(['acu-icon-btn',{active:'icon'===t.type}])},[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':a[9]||(a[9]=e=>t.type=e),type:'radio',value:'icon'},null,512),[[l.vModelRadio,t.type]]),a[26]||(a[26]=(0,l.createElementVNode)('i',{class:'fa-solid fa-icons'},null,-1)),a[27]||(a[27]=(0,l.createElementVNode)('span',null,'FA图标',-1))],2),(0,l.createElementVNode)('label',{class:(0,l.normalizeClass)(['acu-icon-btn',{active:'emoji'===t.type}])},[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':a[10]||(a[10]=e=>t.type=e),type:'radio',value:'emoji'},null,512),[[l.vModelRadio,t.type]]),a[28]||(a[28]=(0,l.createElementVNode)('span',{class:'emoji-icon'},'😀',-1)),a[29]||(a[29]=(0,l.createElementVNode)('span',null,'Emoji',-1))],2),(0,l.createCommentVNode)(' 图片按钮 - 点击直接上传 '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-icon-btn',{active:'image'===t.type}]),onClick:(0,l.withModifiers)(d,['stop'])},[(0,l.createElementVNode)('input',{ref_key:'imageInputRef',ref:r,type:'file',accept:'image/*',hidden:'',onChange:p},null,544),a[30]||(a[30]=(0,l.createElementVNode)('i',{class:'fa-solid fa-image'},null,-1)),a[31]||(a[31]=(0,l.createElementVNode)('span',null,'图片',-1))],2)]),(0,l.createCommentVNode)(' 根据类型显示不同输入（仅图标/Emoji需要输入，图片无需额外输入） '),'icon'===t.type?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ms,[(0,l.createElementVNode)('div',_s,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':a[11]||(a[11]=e=>t.content=e),placeholder:'fa-layer-group'},null,512),[[l.vModelText,t.content]]),a[32]||(a[32]=(0,l.createElementVNode)('span',{class:'acu-input-hint'},'输入 FontAwesome 图标类名',-1))])])):'emoji'===t.type?((0,l.openBlock)(),(0,l.createElementBlock)('div',$s,[(0,l.createElementVNode)('div',js,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':a[12]||(a[12]=e=>t.content=e),placeholder:'🎭'},null,512),[[l.vModelText,t.content]]),a[33]||(a[33]=(0,l.createElementVNode)('span',{class:'acu-input-hint'},'输入 Emoji 表情',-1))])])):'image'===t.type&&t.content?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' 图片模式：已上传时显示清除按钮 '),(0,l.createElementVNode)('div',Fs,[(0,l.createElementVNode)('div',Ps,[(0,l.createElementVNode)('img',{src:t.content,alt:'',class:'acu-preview-thumb'},null,8,Ls),(0,l.createElementVNode)('button',{class:'acu-clear-btn',onClick:a[13]||(a[13]=(0,l.withModifiers)(e=>t.content='',['stop']))},[...a[34]||(a[34]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1),(0,l.createTextVNode)(' 清除 ',-1)])])])])],2112)):(0,l.createCommentVNode)('v-if',!0)])])]))}}),Os={class:'acu-button-config-panel'},Hs={class:'acu-settings-row'},Gs={class:'acu-settings-control'},Ys={class:'acu-config-section acu-visible-area'},Ws={key:0,class:'acu-btn-visible-grid'},qs=['title','onClick','onDragstart','onDragover','onDrop'],Xs={key:0,class:'required-dot'},Ks=['title','onClick'],Js=['onClick'],Qs={key:1,class:'acu-empty-hint'},Zs={class:'acu-config-section acu-hidden-area'},eu={key:0,class:'acu-btn-hidden-grid'},au=['title','onClick'],tu={key:1,class:'acu-empty-hint'},ou={class:'picker-header'},nu={class:'picker-content'},ru={class:'picker-hint'},iu={class:'picker-options'},cu=['onClick'],lu=(0,l.defineComponent)({__name:'NavButtonConfigPanel',setup(e){const a=se(),t=e=>{const a=ae.find(a=>a.id===e);return a?.icon||'fa-circle'},o=e=>{const a=ae.find(a=>a.id===e);return a?.label||e},n=(0,l.computed)(()=>{const e=a.config.buttonOrder,t=a.config.visibleButtons,o=a.config.buttonGroups||[];return e.filter(e=>t.includes(e)).map(e=>{const a=ae.find(a=>a.id===e),t=o.find(a=>a.primaryId===e);return{id:e,icon:a?.icon||'fa-circle',label:a?.label||e,secondaryId:t?.secondaryId||null}})}),r=(0,l.computed)(()=>{const e=a.config.visibleButtons,t=(a.config.buttonGroups||[]).map(e=>e.secondaryId).filter(Boolean);return ae.filter(a=>!a.hidden&&!e.includes(a.id)&&!t.includes(a.id))}),i=(0,l.computed)(()=>{const e=(a.config.buttonGroups||[]).map(e=>e.secondaryId).filter(Boolean);return ae.filter(a=>a.id!==d.value&&!e.includes(a.id))}),c=(0,l.ref)(null),s=e=>{e.target.classList.remove('dragging');document.querySelectorAll('.acu-button-card').forEach(e=>e.classList.remove('drop-target')),c.value=null},u=(0,l.ref)(!1),d=(0,l.ref)(''),p=()=>{u.value=!1,d.value=''},m=()=>{a.resetButtonConfig()};return(e,g)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',Os,[(0,l.createCommentVNode)(' 长按直接执行开关 - 使用设置面板的行开关样式 '),(0,l.createElementVNode)('div',Hs,[g[2]||(g[2]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 长按直接执行 '),(0,l.createElementVNode)('span',{class:'hint'},'开启后，长按将跳过弹出按钮，直接执行附属功能')],-1)),(0,l.createElementVNode)('div',Gs,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-switch',{active:(0,l.unref)(a).longPressDirectExec}]),onClick:g[0]||(g[0]=(0,l.withModifiers)(e=>(0,l.unref)(a).toggleLongPressDirectExec(),['stop']))},null,2)])]),(0,l.createCommentVNode)(' 展示区：网格布局，只显示图标 '),(0,l.createElementVNode)('div',Ys,[(0,l.createElementVNode)('h4',null,[g[4]||(g[4]=(0,l.createElementVNode)('i',{class:'fas fa-th-large'},null,-1)),(0,l.createTextVNode)(' 展示中 ('+(0,l.toDisplayString)(n.value.length)+') ',1),(0,l.createElementVNode)('button',{class:'acu-btn-text acu-btn-reset',onClick:(0,l.withModifiers)(m,['stop'])},[...g[3]||(g[3]=[(0,l.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,l.createTextVNode)(' 重置',-1)])])]),n.value.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ws,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(n.value,(e,n)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['acu-btn-config-item',{'is-required':'settings'===e.id}]),title:e.label+('settings'===e.id?' (必选)':' (点击移除)'),draggable:'true',onClick:(0,l.withModifiers)(t=>(e=>{if('settings'===e)return;const t=[...a.config.visibleButtons],o=t.indexOf(e);o>-1&&(t.splice(o,1),a.setVisibleButtons(t))})(e.id),['stop']),onDragstart:e=>((e,a)=>{c.value=a,e.dataTransfer&&(e.dataTransfer.effectAllowed='move',e.dataTransfer.setData('text/plain',String(a))),e.target.classList.add('dragging')})(e,n),onDragover:(0,l.withModifiers)(e=>((e,a)=>{if(e.preventDefault(),null===c.value||c.value===a)return;document.querySelectorAll('.acu-button-card').forEach(e=>e.classList.remove('drop-target')),e.currentTarget.classList.add('drop-target')})(e,n),['prevent']),onDrop:e=>((e,t)=>{if(e.preventDefault(),null===c.value||c.value===t)return;const o=[...a.config.buttonOrder],n=a.config.visibleButtons,r=o.filter(e=>n.includes(e)),[i]=r.splice(c.value,1);r.splice(t,0,i);const l=o.filter(e=>!n.includes(e));a.setButtonOrder([...r,...l]),document.querySelectorAll('.acu-button-card').forEach(e=>e.classList.remove('drop-target')),c.value=null})(e,n),onDragend:s},[(0,l.createCommentVNode)(' 主按钮图标 '),(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)([['fas',e.icon],'btn-icon'])},null,2),(0,l.createCommentVNode)(' 必选标记 '),'settings'===e.id?((0,l.openBlock)(),(0,l.createElementBlock)('span',Xs)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 附属按钮指示器/添加按钮 '),e.secondaryId?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:1,class:'attachment-indicator',title:'长按附属: '+o(e.secondaryId)+' (点击移除)',onClick:(0,l.withModifiers)(t=>{return o=e.id,void a.removeButtonGroupSecondary(o);var o},['stop'])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fas',t(e.secondaryId)])},null,2)],8,Ks)):((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:2,class:'attachment-add-btn',title:'添加长按附属',onClick:(0,l.withModifiers)(a=>{return t=e.id,d.value=t,void(u.value=!0);var t},['stop'])},[...g[5]||(g[5]=[(0,l.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])],8,Js))],42,qs))),128))])):((0,l.openBlock)(),(0,l.createElementBlock)('div',Qs,[...g[6]||(g[6]=[(0,l.createElementVNode)('i',{class:'fas fa-exclamation-triangle'},null,-1),(0,l.createElementVNode)('span',null,'请至少保留一个按钮',-1)])]))]),(0,l.createCommentVNode)(' 隐藏区：可用按钮 '),(0,l.createElementVNode)('div',Zs,[(0,l.createElementVNode)('h4',null,[g[7]||(g[7]=(0,l.createElementVNode)('i',{class:'fas fa-eye-slash'},null,-1)),(0,l.createTextVNode)(' 未展示 ('+(0,l.toDisplayString)(r.value.length)+') ',1)]),r.value.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',eu,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(r.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:e.id,class:'acu-btn-hidden-item',title:e.label+' (点击添加)',onClick:(0,l.withModifiers)(t=>(e=>{const t=[...a.config.visibleButtons],o=[...a.config.buttonOrder];if(t.includes(e)||(t.push(e),a.setVisibleButtons(t)),!o.includes(e)){const t=o.indexOf('settings');t>=0?o.splice(t,0,e):o.push(e),a.setButtonOrder(o)}})(e.id),['stop'])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fas',e.icon])},null,2)],8,au))),128))])):((0,l.openBlock)(),(0,l.createElementBlock)('div',tu,[...g[8]||(g[8]=[(0,l.createElementVNode)('i',{class:'fas fa-check-circle'},null,-1),(0,l.createElementVNode)('span',null,'所有按钮都已展示',-1)])]))]),(0,l.createCommentVNode)(' 附属按钮选择弹窗 '),u.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-attachment-picker-overlay',onClick:(0,l.withModifiers)(p,['self'])},[(0,l.createElementVNode)('div',{class:'acu-attachment-picker',onClick:g[1]||(g[1]=(0,l.withModifiers)(()=>{},['stop']))},[(0,l.createElementVNode)('div',ou,[g[10]||(g[10]=(0,l.createElementVNode)('h4',null,'选择长按附属按钮',-1)),(0,l.createElementVNode)('button',{class:'btn-close',onClick:(0,l.withModifiers)(p,['stop'])},[...g[9]||(g[9]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])]),(0,l.createElementVNode)('div',nu,[(0,l.createElementVNode)('p',ru,'选择一个按钮作为 "'+(0,l.toDisplayString)(o(d.value))+'" 的长按附属功能：',1),(0,l.createElementVNode)('div',iu,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(i.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:e.id,class:'picker-option',onClick:(0,l.withModifiers)(t=>{return o=e.id,a.addButtonGroup(d.value,o),void p();var o},['stop'])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fas',e.icon])},null,2),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(e.label),1)],8,cu))),128))])])])])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 提示信息（固定在底部） '),g[11]||(g[11]=(0,l.createElementVNode)('div',{class:'acu-config-hint acu-config-hint-fixed'},[(0,l.createElementVNode)('i',{class:'fas fa-info-circle'}),(0,l.createElementVNode)('span',null,'拖动排序 · 点击移除 · +号添加长按附属')],-1))]))}});c(499);const su=(0,Bt.A)(lu,[['__scopeId','data-v-5b5624ec']]),uu={class:'acu-tab-config-panel'},du={class:'acu-config-section acu-visible-area'},pu=['onClick','onDragstart','onDragover','onDrop'],mu={key:1,class:'tab-type-badge-mini'},gu={key:1,class:'acu-empty-hint'},bu={class:'acu-config-section acu-hidden-area'},fu={key:0,class:'acu-tab-hidden-list'},vu=['title','onClick'],hu={class:'tab-name'},xu={key:1,class:'tab-type-badge'},wu={key:1,class:'acu-empty-hint'},yu=(0,l.defineComponent)({__name:'TabConfigPanel',setup(e){const a=se(),t=(0,l.computed)(()=>{const e=a.config.gridColumns;return 0===e?{gridTemplateColumns:'repeat(auto-fill, minmax(90px, 1fr))'}:{gridTemplateColumns:`repeat(${e}, 1fr)`}}),o=Ma(),n=wa(),r=(0,l.computed)(()=>{const e=[];a.config.showDashboard&&e.push({id:Ua,name:'仪表盘',icon:'fas fa-home',type:'dashboard'});const t=n.stagedData;if(t){const a=Re(t);if(a)for(const[t,o]of Object.entries(a)){const a=o.key,n=t.includes('选项');e.push({id:a,name:t,icon:n?'fas fa-sliders-h':void 0,type:n?'special':'normal'})}}e.some(e=>'normal'===e.type&&De(e.name,e.id))&&e.push({id:Ia,name:'关系图',icon:'fas fa-project-diagram',type:'graph'});return e.some(e=>'special'===e.type)&&e.push({id:Da,name:'选项面板',icon:'fas fa-sliders-h',type:'options'}),e}),i=(0,l.computed)(()=>{const e=o.visibleTabs;return e&&0!==e.length?e.map(e=>r.value.find(a=>a.id===e)).filter(e=>void 0!==e):[]}),c=(0,l.computed)(()=>{const e=o.visibleTabs;return e&&0!==e.length?r.value.filter(a=>!e.includes(a.id)):r.value}),s=e=>{switch(e){case'dashboard':return'首页';case'graph':return'关系';case'options':return'聚合';case'special':return'选项';default:return''}},u=(0,l.ref)(null),d=()=>{u.value=null},p=()=>{const e=r.value.map(e=>e.id);o.setVisibleTabs(e)},m=()=>{o.setVisibleTabs([])};return(e,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',uu,[(0,l.createCommentVNode)(' 展示区：当前显示的 Tab（网格布局，复用导航栏样式） '),(0,l.createElementVNode)('div',du,[(0,l.createElementVNode)('h4',null,[a[1]||(a[1]=(0,l.createElementVNode)('i',{class:'fas fa-eye'},null,-1)),(0,l.createTextVNode)(' 展示中 ('+(0,l.toDisplayString)(i.value.length)+') ',1),(0,l.createElementVNode)('button',{class:'acu-btn-text acu-btn-reset',onClick:(0,l.withModifiers)(p,['stop'])},[...a[0]||(a[0]=[(0,l.createElementVNode)('i',{class:'fas fa-undo'},null,-1),(0,l.createTextVNode)(' 重置',-1)])])]),i.value.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-tab-visible-grid',style:(0,l.normalizeStyle)(t.value)},[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(i.value,(e,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:e.id,class:(0,l.normalizeClass)(['acu-nav-btn acu-tab-config-btn',{'acu-nav-btn-special':'normal'!==e.type,dragging:u.value===a}]),draggable:'true',title:'点击移除，拖拽排序',onClick:(0,l.withModifiers)(a=>(e=>{const a=[...o.visibleTabs];if(0===a.length){const a=r.value.map(e=>e.id).filter(a=>a!==e);return void(a.length>0&&o.setVisibleTabs(a))}const t=a.indexOf(e);t>-1&&a.length>1&&(a.splice(t,1),o.setVisibleTabs(a))})(e.id),['stop']),onDragstart:e=>((e,a)=>{u.value=a,e.dataTransfer&&(e.dataTransfer.effectAllowed='move',e.dataTransfer.setData('text/plain',String(a)))})(e,a),onDragover:(0,l.withModifiers)(e=>(e.preventDefault(),void(null!==u.value&&u.value)),['prevent']),onDrop:e=>((e,a)=>{if(e.preventDefault(),null===u.value||u.value===a)return;let t=[...o.visibleTabs];0===t.length&&(t=r.value.map(e=>e.id));const[n]=t.splice(u.value,1);t.splice(a,0,n),o.setVisibleTabs(t),document.querySelectorAll('.acu-tab-config-btn').forEach(e=>e.classList.remove('drop-target')),u.value=null})(e,a),onDragend:d},[e.icon?((0,l.openBlock)(),(0,l.createElementBlock)('i',{key:0,class:(0,l.normalizeClass)(e.icon)},null,2)):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(e.name),1),'normal'!==e.type?((0,l.openBlock)(),(0,l.createElementBlock)('span',mu,(0,l.toDisplayString)(s(e.type)),1)):(0,l.createCommentVNode)('v-if',!0)],42,pu))),128))],4)):((0,l.openBlock)(),(0,l.createElementBlock)('div',gu,[...a[2]||(a[2]=[(0,l.createElementVNode)('i',{class:'fas fa-info-circle'},null,-1),(0,l.createElementVNode)('span',null,'展示区为空时显示全部Tab，从下方添加需要的',-1)])]))]),(0,l.createCommentVNode)(' 不展示区：隐藏的 Tab '),(0,l.createElementVNode)('div',bu,[(0,l.createElementVNode)('h4',null,[a[4]||(a[4]=(0,l.createElementVNode)('i',{class:'fas fa-eye-slash'},null,-1)),(0,l.createTextVNode)(' 未展示 ('+(0,l.toDisplayString)(c.value.length)+') ',1),(0,l.createElementVNode)('button',{class:'acu-btn-text acu-btn-clear',title:'将展示区所有Tab移到未展示区',onClick:(0,l.withModifiers)(m,['stop'])},[...a[3]||(a[3]=[(0,l.createElementVNode)('i',{class:'fas fa-angle-double-down'},null,-1),(0,l.createTextVNode)(' 全部下移 ',-1)])])]),c.value.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',fu,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(c.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:e.id,class:(0,l.normalizeClass)(['acu-tab-hidden-item',{'is-special':'normal'!==e.type}]),title:'添加 '+e.name,onClick:(0,l.withModifiers)(a=>(e=>{const a=[...o.visibleTabs];a.includes(e)||(a.push(e),o.setVisibleTabs(a))})(e.id),['stop'])},[e.icon?((0,l.openBlock)(),(0,l.createElementBlock)('i',{key:0,class:(0,l.normalizeClass)([e.icon,'tab-icon'])},null,2)):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('span',hu,(0,l.toDisplayString)(e.name),1),'normal'!==e.type?((0,l.openBlock)(),(0,l.createElementBlock)('span',xu,(0,l.toDisplayString)(s(e.type)),1)):(0,l.createCommentVNode)('v-if',!0),a[5]||(a[5]=(0,l.createElementVNode)('i',{class:'fas fa-plus add-icon'},null,-1))],10,vu))),128))])):((0,l.openBlock)(),(0,l.createElementBlock)('div',wu,[...a[6]||(a[6]=[(0,l.createElementVNode)('i',{class:'fas fa-check-circle'},null,-1),(0,l.createElementVNode)('span',null,'所有表格都已展示',-1)])]))]),(0,l.createCommentVNode)(' 提示信息（固定在底部） '),a[7]||(a[7]=(0,l.createElementVNode)('div',{class:'acu-config-hint acu-config-hint-fixed'},[(0,l.createElementVNode)('i',{class:'fas fa-info-circle'}),(0,l.createElementVNode)('span',null,'点击移除/添加，拖拽排序 | 展示区为空时主界面显示全部')],-1))]))}});c(574);const ku=(0,Bt.A)(yu,[['__scopeId','data-v-1c4a9379']]),Cu={class:'acu-theme-panel'},Nu={class:'acu-preset-header'},Vu={class:'acu-settings-row'},Eu={class:'acu-settings-control acu-preset-control'},zu={class:'acu-preset-selected-name'},Bu={class:'acu-preset-dropdown-menu'},Su=['onClick'],Au={class:'acu-preset-option-name'},Tu=['onClick'],Uu={class:'acu-theme-scroll-content'},Du={class:'acu-settings-section'},Iu={class:'acu-settings-group'},Mu={class:'acu-settings-row'},_u={class:'acu-settings-control'},$u=['value'],ju={class:'acu-settings-section'},Fu={class:'acu-settings-group'},Pu={class:'acu-settings-row'},Lu={class:'acu-settings-control acu-color-picker-inline'},Ru={class:'acu-settings-row'},Ou={class:'acu-settings-control acu-color-picker-inline'},Hu={class:'acu-settings-row'},Gu={class:'acu-settings-control acu-color-picker-inline'},Yu={class:'acu-settings-section'},Wu={class:'acu-var-groups-container'},qu=['onClick'],Xu={class:'acu-var-count'},Ku={class:'acu-var-group-body'},Ju={class:'acu-var-label'},Qu={class:'acu-var-control'},Zu=['onClick'],ed=['value','onChange'],ad=['value','onChange'],td={class:'acu-settings-section'},od={class:'acu-settings-group'},nd={class:'acu-settings-row'},rd={class:'acu-settings-label'},id={class:'hint'},cd={class:'acu-settings-control acu-css-actions'},ld={class:'dialog-actions'},sd=['disabled'],ud=(0,l.defineComponent)({__name:'ThemePanel',setup(e){const a=ke(),t=se();function o(){return a.presets||[]}function n(){return a.activePresetId}function r(){return a.currentThemeVars||{}}function i(){return a.currentHighlight}function c(){return a.customCSS||''}const s=(0,l.ref)('#d35400'),u=(0,l.ref)('#3498db'),d=(0,l.ref)('#d35400'),p=(0,l.ref)('retro'),m=(0,l.ref)([]),g=(0,l.ref)(!1),b=(0,l.ref)(''),f=(0,l.ref)(!1),v=(0,l.ref)(''),h=(0,l.ref)(),x=(0,l.ref)(),w=(0,l.computed)(()=>{const e=n();if(!e)return'默认配置';const a=o().find(a=>a.id===e);return a?.name||'默认配置'});function y(){s.value=a.manualHighlightColor,u.value=a.aiHighlightColor,d.value=a.titleColor}function k(e){e.target.closest('.acu-preset-dropdown')||(g.value=!1)}function C(){g.value=!g.value}function N(){var e;e=null,a.activePresetId=e,a.clearThemeVars(),y(),v.value='',a.clearCustomCSS(),g.value=!1,window.toastr&&window.toastr.success('已恢复默认配置')}function V(){f.value=!0,b.value='',(0,l.nextTick)(()=>{x.value?.focus()})}function E(){f.value=!1,b.value=''}function B(){const e=b.value.trim();e&&(a.saveCurrentToPreset(e),E(),window.toastr&&window.toastr.success(`预设「${e}」已保存`))}function S(){t.setTheme(p.value)}function A(){a.setManualHighlightColor('custom',s.value)}function T(){a.setAiHighlightColor('custom',u.value)}function U(){a.setTitleColor('custom',d.value)}function D(e){const a=r();return e.vars.filter(e=>a[e.key]).length}function I(e){return r()[e]||''}function M(e){const a=I(e);return a&&a.startsWith('#')&&(4===a.length||7===a.length)?a:'#888888'}function j(e,t){t.trim()?a.setThemeVar(e,t.trim()):a.removeThemeVar(e)}function F(){a.setCustomCSS(v.value)}function P(){confirm('确定要清空自定义 CSS 吗？')&&(v.value='',a.clearCustomCSS())}function L(){const e={type:'acu_theme_config',version:'1.0',timestamp:(new Date).toISOString(),theme:p.value,highlight:i(),themeVars:r(),customCSS:c()},a=new Blob([JSON.stringify(e,null,2)],{type:'application/json'}),t=URL.createObjectURL(a),o=document.createElement('a');o.href=t,o.download=`acu-theme-${Date.now()}.json`,o.click(),URL.revokeObjectURL(t),window.toastr&&window.toastr.success('配置已导出')}function R(){h.value?.click()}function O(e){const o=e.target.files?.[0];if(!o)return;const n=new FileReader;n.onload=e=>{try{const n=e.target?.result;if(o.name.endsWith('.json')){const e=JSON.parse(n);if('acu_theme_config'!==e.type)throw new Error('无效的配置文件格式');if(e.theme&&(p.value=e.theme,t.setTheme(e.theme)),e.highlight){const a=i();a.manualColor=e.highlight.manualColor||'custom',a.manualHex=e.highlight.manualHex,a.aiColor=e.highlight.aiColor||'custom',a.aiHex=e.highlight.aiHex,a.titleColor=e.highlight.titleColor||'custom',a.titleHex=e.highlight.titleHex}if(e.themeVars){const a=r();Object.assign(a,e.themeVars)}e.customCSS&&(v.value=e.customCSS,a.setCustomCSS(e.customCSS)),y(),window.toastr&&window.toastr.success('主题配置已导入')}else v.value=n,a.setCustomCSS(n),window.toastr&&window.toastr.success('CSS 已导入')}catch(e){console.error('[ThemePanel] 导入失败:',e),window.toastr&&window.toastr.error('导入失败：无效的文件格式')}},n.readAsText(o),e.target.value=''}return(0,l.onMounted)(()=>{a.loadFromStorage(),y(),p.value=t.config.theme||'retro',v.value=c(),document.addEventListener('click',k)}),(0,l.onUnmounted)(()=>{document.removeEventListener('click',k)}),(0,l.watch)(()=>i(),()=>y(),{deep:!0}),(0,l.watch)(()=>t.config.theme,e=>{p.value=e||'retro'}),(e,i)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',Cu,[(0,l.createCommentVNode)(' 固定区域：预设管理 '),(0,l.createElementVNode)('div',Nu,[(0,l.createElementVNode)('div',Vu,[i[14]||(i[14]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 预设管理 '),(0,l.createElementVNode)('span',{class:'hint'},'保存和加载主题配置')],-1)),(0,l.createElementVNode)('div',Eu,[(0,l.createCommentVNode)(' 自定义下拉选择框 '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-preset-dropdown',{open:g.value}])},[(0,l.createElementVNode)('button',{class:'acu-preset-dropdown-btn',onClick:(0,l.withModifiers)(C,['stop'])},[(0,l.createElementVNode)('span',zu,(0,l.toDisplayString)(w.value),1),i[10]||(i[10]=(0,l.createElementVNode)('i',{class:'fas fa-chevron-down'},null,-1))]),(0,l.withDirectives)((0,l.createElementVNode)('div',Bu,[(0,l.createCommentVNode)(' 默认配置选项 '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['acu-preset-option',{active:!n()}]),onClick:(0,l.withModifiers)(N,['stop'])},[...i[11]||(i[11]=[(0,l.createElementVNode)('span',{class:'acu-preset-option-name'},'默认配置',-1)])],2),(0,l.createCommentVNode)(' 用户预设选项 '),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(o(),e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['acu-preset-option',{active:n()===e.id}]),onClick:(0,l.withModifiers)(o=>{return n=e.id,a.applyPreset(n),y(),v.value=c(),p.value=t.config.theme||'retro',g.value=!1,void(window.toastr&&window.toastr.success('预设已应用'));var n},['stop'])},[(0,l.createElementVNode)('span',Au,(0,l.toDisplayString)(e.name),1),(0,l.createElementVNode)('button',{class:'acu-preset-delete-btn',title:'删除',onClick:(0,l.withModifiers)(t=>function(e){const t=o().find(a=>a.id===e);t&&confirm(`确定要删除预设「${t.name}」吗？`)&&(a.deletePreset(e),window.toastr&&window.toastr.info('预设已删除'))}(e.id),['stop'])},[...i[12]||(i[12]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1)])],8,Tu)],10,Su))),128))],512),[[l.vShow,g.value]])],2),(0,l.createCommentVNode)(' 保存按钮 '),(0,l.createElementVNode)('button',{class:'acu-btn acu-btn-primary acu-btn-save',onClick:(0,l.withModifiers)(V,['stop'])},[...i[13]||(i[13]=[(0,l.createElementVNode)('i',{class:'fas fa-save'},null,-1),(0,l.createTextVNode)(' 保存 ',-1)])])])])]),(0,l.createCommentVNode)(' 可滚动区域 '),(0,l.createElementVNode)('div',Uu,[(0,l.createCommentVNode)(' 主题风格选择 '),(0,l.createElementVNode)('div',Du,[i[16]||(i[16]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-palette'}),(0,l.createTextVNode)(' 主题风格 ')],-1)),(0,l.createElementVNode)('div',Iu,[(0,l.createElementVNode)('div',Mu,[i[15]||(i[15]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 界面配色 '),(0,l.createElementVNode)('span',{class:'hint'},'选择界面配色方案')],-1)),(0,l.createElementVNode)('div',_u,[(0,l.withDirectives)((0,l.createElementVNode)('select',{'onUpdate:modelValue':i[0]||(i[0]=e=>p.value=e),class:'acu-select',onChange:S},[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(ie),e=>((0,l.openBlock)(),(0,l.createElementBlock)('option',{key:e.id,value:e.id},(0,l.toDisplayString)(e.name),9,$u))),128))],544),[[l.vModelSelect,p.value]])])])])]),(0,l.createCommentVNode)(' 高亮颜色配置 '),(0,l.createElementVNode)('div',ju,[i[20]||(i[20]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-highlighter'}),(0,l.createTextVNode)(' 高亮颜色 ')],-1)),(0,l.createElementVNode)('div',Fu,[(0,l.createCommentVNode)(' 手动修改高亮颜色 '),(0,l.createElementVNode)('div',Pu,[i[17]||(i[17]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 手动修改高亮 '),(0,l.createElementVNode)('span',{class:'hint'},'手动编辑内容的标记颜色')],-1)),(0,l.createElementVNode)('div',Lu,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':i[1]||(i[1]=e=>s.value=e),type:'text',class:'acu-color-input',placeholder:'#RRGGBB',onChange:A},null,544),[[l.vModelText,s.value]]),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':i[2]||(i[2]=e=>s.value=e),type:'color',class:'acu-color-swatch',onChange:A},null,544),[[l.vModelText,s.value]])])]),(0,l.createCommentVNode)(' AI 填表高亮颜色 '),(0,l.createElementVNode)('div',Ru,[i[18]||(i[18]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' AI 填表高亮 '),(0,l.createElementVNode)('span',{class:'hint'},'AI 自动填写内容的标记颜色')],-1)),(0,l.createElementVNode)('div',Ou,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':i[3]||(i[3]=e=>u.value=e),type:'text',class:'acu-color-input',placeholder:'#RRGGBB',onChange:T},null,544),[[l.vModelText,u.value]]),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':i[4]||(i[4]=e=>u.value=e),type:'color',class:'acu-color-swatch',onChange:T},null,544),[[l.vModelText,u.value]])])]),(0,l.createCommentVNode)(' 标题颜色 '),(0,l.createElementVNode)('div',Hu,[i[19]||(i[19]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 标题颜色 '),(0,l.createElementVNode)('span',{class:'hint'},'表格标题的颜色')],-1)),(0,l.createElementVNode)('div',Gu,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':i[5]||(i[5]=e=>d.value=e),type:'text',class:'acu-color-input',placeholder:'#RRGGBB',onChange:U},null,544),[[l.vModelText,d.value]]),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':i[6]||(i[6]=e=>d.value=e),type:'color',class:'acu-color-swatch',onChange:U},null,544),[[l.vModelText,d.value]])])])])]),(0,l.createCommentVNode)(' 主题变量自定义 '),(0,l.createElementVNode)('div',Yu,[i[22]||(i[22]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-paint-brush'}),(0,l.createTextVNode)(' 主题变量自定义 '),(0,l.createElementVNode)('span',{class:'hint',style:{'margin-left':'auto','font-weight':'normal'}},'覆盖当前主题的 CSS 变量')],-1)),(0,l.createCommentVNode)(' 连续的可折叠组 '),(0,l.createElementVNode)('div',Wu,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(pe),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['acu-var-group',{first:0===t,last:t===(0,l.unref)(pe).length-1}])},[(0,l.createElementVNode)('div',{class:'acu-var-group-header',onClick:(0,l.withModifiers)(a=>function(e){const a=m.value.indexOf(e);a>-1?m.value.splice(a,1):m.value.push(e)}(e.id),['stop'])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fas',e.icon])},null,2),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(e.name),1),(0,l.createElementVNode)('span',Xu,(0,l.toDisplayString)(D(e))+'/'+(0,l.toDisplayString)(e.vars.length),1),(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(['fas',m.value.includes(e.id)?'fa-chevron-up':'fa-chevron-down'])},null,2)],8,qu),(0,l.withDirectives)((0,l.createElementVNode)('div',Ku,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.vars,e=>{return(0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.key,class:'acu-var-row'},[(0,l.createElementVNode)('div',Ju,(0,l.toDisplayString)(e.label),1),(0,l.createElementVNode)('div',Qu,[(t=e.key,r()[t]?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'acu-var-reset',title:'恢复默认',onClick:(0,l.withModifiers)(t=>function(e){a.removeThemeVar(e)}(e.key),['stop'])},[...i[21]||(i[21]=[(0,l.createElementVNode)('i',{class:'fas fa-undo'},null,-1)])],8,Zu)):(0,l.createCommentVNode)('v-if',!0)),(0,l.createElementVNode)('input',{value:I(e.key),type:'text',class:'acu-color-input',placeholder:'使用主题默认值',onChange:a=>j(e.key,a.target.value)},null,40,ed),(0,l.createElementVNode)('input',{value:M(e.key),type:'color',class:'acu-color-swatch',onChange:a=>j(e.key,a.target.value)},null,40,ad)])]);var t}),128))],512),[[l.vShow,m.value.includes(e.id)]])],2))),128))])]),(0,l.createCommentVNode)(' 自定义 CSS '),(0,l.createElementVNode)('div',td,[i[28]||(i[28]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-code'}),(0,l.createTextVNode)(' 自定义 CSS ')],-1)),(0,l.createElementVNode)('div',od,[(0,l.createElementVNode)('div',nd,[(0,l.createElementVNode)('div',rd,[i[23]||(i[23]=(0,l.createTextVNode)(' CSS 代码 ',-1)),(0,l.createElementVNode)('span',id,(0,l.toDisplayString)(v.value.length)+' 字符',1)]),(0,l.createElementVNode)('div',cd,[(0,l.createElementVNode)('button',{class:'acu-tool-btn',onClick:(0,l.withModifiers)(L,['stop'])},[...i[24]||(i[24]=[(0,l.createElementVNode)('i',{class:'fas fa-download'},null,-1),(0,l.createTextVNode)(' 导出 ',-1)])]),(0,l.createElementVNode)('button',{class:'acu-tool-btn',onClick:(0,l.withModifiers)(R,['stop'])},[...i[25]||(i[25]=[(0,l.createElementVNode)('i',{class:'fas fa-upload'},null,-1),(0,l.createTextVNode)(' 导入 ',-1)])]),(0,l.createElementVNode)('button',{class:'acu-tool-btn acu-btn-danger',onClick:(0,l.withModifiers)(P,['stop'])},[...i[26]||(i[26]=[(0,l.createElementVNode)('i',{class:'fas fa-trash'},null,-1),(0,l.createTextVNode)(' 清空 ',-1)])])])]),i[27]||(i[27]=(0,l.createElementVNode)('div',{class:'acu-css-hint'},[(0,l.createElementVNode)('p',null,'常用选择器：'),(0,l.createElementVNode)('code',null,'.acu-wrapper'),(0,l.createTextVNode)(),(0,l.createElementVNode)('code',null,'.acu-floating-ball'),(0,l.createTextVNode)(),(0,l.createElementVNode)('code',null,'.acu-main-panel'),(0,l.createElementVNode)('code',null,'.acu-modal'),(0,l.createTextVNode)(),(0,l.createElementVNode)('code',null,'.acu-tab-bar'),(0,l.createTextVNode)(),(0,l.createElementVNode)('code',null,'.acu-data-card')],-1)),(0,l.withDirectives)((0,l.createElementVNode)('textarea',{'onUpdate:modelValue':i[7]||(i[7]=e=>v.value=e),class:'acu-css-editor',placeholder:'/* 在此输入自定义 CSS */',rows:'8',onChange:F},null,544),[[l.vModelText,v.value]])])])]),(0,l.createCommentVNode)(' 保存预设弹窗 '),f.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-preset-save-modal',onClick:(0,l.withModifiers)(E,['stop'])},[(0,l.createElementVNode)('div',{class:'acu-preset-save-dialog',onClick:i[9]||(i[9]=(0,l.withModifiers)(()=>{},['stop']))},[i[29]||(i[29]=(0,l.createElementVNode)('div',{class:'dialog-title'},'保存预设',-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{ref_key:'presetNameInputRef',ref:x,'onUpdate:modelValue':i[8]||(i[8]=e=>b.value=e),type:'text',class:'dialog-input',placeholder:'输入预设名称...',onKeyup:(0,l.withKeys)(B,['enter'])},null,544),[[l.vModelText,b.value]]),(0,l.createElementVNode)('div',ld,[(0,l.createElementVNode)('button',{class:'btn-cancel',onClick:(0,l.withModifiers)(E,['stop'])},'取消'),(0,l.createElementVNode)('button',{class:'btn-confirm',disabled:!b.value.trim(),onClick:(0,l.withModifiers)(B,['stop'])},'确定',8,sd)])])])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 隐藏的文件输入 '),(0,l.createElementVNode)('input',{ref_key:'fileInputRef',ref:h,type:'file',accept:'.json,.css,.txt',style:{display:'none'},onChange:O},null,544)]))}}),dd={class:'acu-modal-title'},pd={class:'acu-modal-body'},md={class:'acu-settings-section'},gd={class:'acu-settings-group'},bd={class:'acu-settings-row'},fd={class:'acu-settings-control acu-font-control'},vd=['value'],hd={class:'acu-settings-row'},xd={class:'acu-settings-control'},wd={class:'acu-settings-row'},yd={class:'acu-settings-label'},kd={class:'hint'},Cd={class:'acu-settings-control'},Nd={class:'acu-settings-row'},Vd={class:'acu-settings-label'},Ed={class:'hint'},zd={class:'acu-settings-control'},Bd={class:'acu-settings-row'},Sd={class:'acu-settings-label'},Ad={class:'hint'},Td={class:'acu-settings-control'},Ud={class:'acu-settings-row'},Dd={class:'acu-settings-label'},Id={class:'hint'},Md={class:'acu-settings-control'},_d={class:'acu-settings-section'},$d={class:'acu-settings-group'},jd={class:'acu-settings-section'},Fd={class:'acu-settings-group'},Pd={class:'acu-settings-row'},Ld={class:'acu-settings-control'},Rd={class:'acu-settings-row'},Od={class:'acu-settings-control'},Hd={class:'acu-settings-row'},Gd={class:'acu-settings-control'},Yd={class:'acu-settings-row'},Wd={class:'acu-settings-control'},qd={class:'acu-settings-row'},Xd={class:'acu-settings-control'},Kd={class:'acu-settings-section'},Jd={class:'acu-settings-group'},Qd={class:'acu-settings-row'},Zd={class:'acu-settings-control'},ep={class:'acu-mini-dialog-header'},ap={class:'acu-mini-dialog-body'},tp={class:'acu-font-form'},op={class:'acu-form-row'},np={class:'acu-form-row'},rp={class:'acu-mini-dialog-footer'},ip=['disabled'],cp=(0,l.defineComponent)({__name:'SettingsDialog',props:{visible:{type:Boolean}},emits:['update:visible'],setup(e,{emit:a}){const t=e,o=a,n=(0,l.ref)(),r=(0,l.ref)(),i=se(),c=ue(),s=Ma(),u=ea(),d=(0,l.ref)(!1),p=(0,l.ref)(!1),m=(0,l.ref)(''),g=(0,l.ref)(''),b=(0,l.ref)('main'),f=(0,l.reactive)({...i.config});(0,l.watch)(f,e=>{i.updateConfig(e)},{deep:!0});const v=(0,l.computed)(()=>{switch(b.value){case'tabConfig':return'表格展示选择';case'buttonConfig':return'导航栏按钮配置';case'ballAppearance':return'悬浮球外观';case'themeConfig':return'主题美化与高亮配置';default:return'设置'}}),h=((0,l.computed)(()=>{switch(b.value){case'tabConfig':return'fas fa-table';case'buttonConfig':return'fas fa-ellipsis-h';case'ballAppearance':return'fas fa-circle';case'themeConfig':return'fas fa-palette';default:return'fas fa-cog'}}),e=>{b.value=e}),x=()=>{b.value='main'},w=()=>{u.initPendingLocks(),s.isLockEditMode=!0,o('update:visible',!1)};(0,l.watch)(()=>t.visible,e=>{e&&(Object.assign(f,i.config),b.value='main')}),j(n,()=>{k()});const y=()=>{o('update:visible',!1)},k=()=>{o('update:visible',!1)},C=()=>{d.value=!d.value},N=(0,l.computed)(()=>c.allFonts),V=(0,l.computed)(()=>m.value.trim()&&g.value.trim()),E=()=>{if(!V.value)return;const e=m.value.trim(),a=`'${e}', sans-serif`;c.addFont({name:e,fontFamily:a,importUrl:g.value.trim()}),m.value='',g.value='',p.value=!1};return(a,t)=>((0,l.openBlock)(),(0,l.createBlock)(l.Transition,{name:'modal'},{default:(0,l.withCtx)(()=>[e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-modal-container',onClick:(0,l.withModifiers)(k,['self'])},[(0,l.createElementVNode)('div',{ref_key:'dialogRef',ref:n,class:(0,l.normalizeClass)(['acu-modal acu-settings-modal',{expanded:d.value}])},[(0,l.createCommentVNode)(' 头部 '),(0,l.createElementVNode)('div',{ref_key:'headerRef',ref:r,class:'acu-modal-header'},[(0,l.createCommentVNode)(' 拖动把手区域（点击切换高度） '),(0,l.createElementVNode)('div',{class:'acu-drag-handle',onClick:C}),(0,l.createCommentVNode)(' 返回按钮（仅在子面板时显示） '),'main'!==b.value?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'acu-modal-back',onClick:(0,l.withModifiers)(x,['stop'])},[...t[23]||(t[23]=[(0,l.createElementVNode)('i',{class:'fas fa-arrow-left'},null,-1)])])):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('span',dd,(0,l.toDisplayString)(v.value),1),(0,l.createCommentVNode)(' 胶囊式完成按钮 '),(0,l.createElementVNode)('button',{class:'acu-close-pill',onClick:(0,l.withModifiers)(y,['stop'])},'完成')],512),(0,l.createCommentVNode)(' 内容 '),(0,l.createElementVNode)('div',pd,[(0,l.createCommentVNode)(' ============ 主设置面板 ============ '),'main'===b.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:0},[(0,l.createCommentVNode)(' 外观与布局（合并）'),(0,l.createElementVNode)('div',md,[t[32]||(t[32]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-palette'}),(0,l.createTextVNode)(' 外观与布局 ')],-1)),(0,l.createElementVNode)('div',gd,[(0,l.createCommentVNode)(' 字体选择 '),(0,l.createElementVNode)('div',bd,[t[25]||(t[25]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 显示字体 '),(0,l.createElementVNode)('span',{class:'hint'},'选择界面字体')],-1)),(0,l.createElementVNode)('div',fd,[(0,l.withDirectives)((0,l.createElementVNode)('select',{'onUpdate:modelValue':t[0]||(t[0]=e=>f.fontFamily=e)},[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(N.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('option',{key:e.id,value:e.id},(0,l.toDisplayString)(e.name),9,vd))),128))],512),[[l.vModelSelect,f.fontFamily]]),(0,l.createElementVNode)('button',{class:'acu-add-font-btn',title:'添加自定义字体',onClick:t[1]||(t[1]=(0,l.withModifiers)(e=>p.value=!0,['stop']))},[...t[24]||(t[24]=[(0,l.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])])])]),(0,l.createCommentVNode)(' 布局模式 '),(0,l.createElementVNode)('div',hd,[t[27]||(t[27]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 布局模式 '),(0,l.createElementVNode)('span',{class:'hint'},'卡片排列方向')],-1)),(0,l.createElementVNode)('div',xd,[(0,l.withDirectives)((0,l.createElementVNode)('select',{'onUpdate:modelValue':t[2]||(t[2]=e=>f.layout=e)},[...t[26]||(t[26]=[(0,l.createElementVNode)('option',{value:'vertical'},'纵向布局',-1),(0,l.createElementVNode)('option',{value:'horizontal'},'横向布局',-1)])],512),[[l.vModelSelect,f.layout]])])]),(0,l.createCommentVNode)(' 字体大小 '),(0,l.createElementVNode)('div',wd,[(0,l.createElementVNode)('div',yd,[t[28]||(t[28]=(0,l.createTextVNode)(' 字体大小 ',-1)),(0,l.createElementVNode)('span',kd,(0,l.toDisplayString)(f.fontSize)+'px',1)]),(0,l.createElementVNode)('div',Cd,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[3]||(t[3]=e=>f.fontSize=e),type:'range',min:'12',max:'18',step:'1'},null,512),[[l.vModelText,f.fontSize,void 0,{number:!0}]])])]),(0,l.createCommentVNode)(' 卡片宽度 '),(0,l.createElementVNode)('div',Nd,[(0,l.createElementVNode)('div',Vd,[t[29]||(t[29]=(0,l.createTextVNode)(' 卡片宽度 ',-1)),(0,l.createElementVNode)('span',Ed,(0,l.toDisplayString)(f.cardWidth)+'px',1)]),(0,l.createElementVNode)('div',zd,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[4]||(t[4]=e=>f.cardWidth=e),type:'range',min:'200',max:'400',step:'10'},null,512),[[l.vModelText,f.cardWidth,void 0,{number:!0}]])])]),(0,l.createCommentVNode)(' 表格按钮列数 '),(0,l.createElementVNode)('div',Bd,[(0,l.createElementVNode)('div',Sd,[t[30]||(t[30]=(0,l.createTextVNode)(' 表格按钮列数 ',-1)),(0,l.createElementVNode)('span',Ad,(0,l.toDisplayString)(0===f.gridColumns?'自适应':`${f.gridColumns} 列`),1)]),(0,l.createElementVNode)('div',Td,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[5]||(t[5]=e=>f.gridColumns=e),type:'range',min:'0',max:'6',step:'1'},null,512),[[l.vModelText,f.gridColumns,void 0,{number:!0}]])])]),(0,l.createCommentVNode)(' 每页显示数 '),(0,l.createElementVNode)('div',Ud,[(0,l.createElementVNode)('div',Dd,[t[31]||(t[31]=(0,l.createTextVNode)(' 每页显示条数 ',-1)),(0,l.createElementVNode)('span',Id,(0,l.toDisplayString)(f.itemsPerPage)+' 条',1)]),(0,l.createElementVNode)('div',Md,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[6]||(t[6]=e=>f.itemsPerPage=e),type:'range',min:'10',max:'100',step:'10'},null,512),[[l.vModelText,f.itemsPerPage,void 0,{number:!0}]])])])])]),(0,l.createCommentVNode)(' 界面配置入口（使用圆角容器）'),(0,l.createElementVNode)('div',_d,[t[37]||(t[37]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-columns'}),(0,l.createTextVNode)(' 界面配置 ')],-1)),(0,l.createElementVNode)('div',$d,[(0,l.createCommentVNode)(' 表格展示选择入口 '),(0,l.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:t[7]||(t[7]=e=>h('tabConfig'))},[...t[33]||(t[33]=[(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 表格自定义配置 '),(0,l.createElementVNode)('span',{class:'hint'},'选择要显示的表格及排序')],-1),(0,l.createElementVNode)('div',{class:'acu-settings-control'},[(0,l.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])]),(0,l.createCommentVNode)(' 导航栏按钮配置入口 '),(0,l.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:t[8]||(t[8]=e=>h('buttonConfig'))},[...t[34]||(t[34]=[(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 导航栏按钮自定义配置 '),(0,l.createElementVNode)('span',{class:'hint'},'自定义导航栏显示的按钮')],-1),(0,l.createElementVNode)('div',{class:'acu-settings-control'},[(0,l.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])]),(0,l.createCommentVNode)(' 悬浮球外观配置入口 '),(0,l.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:t[9]||(t[9]=e=>h('ballAppearance'))},[...t[35]||(t[35]=[(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 悬浮球外观 '),(0,l.createElementVNode)('span',{class:'hint'},'自定义悬浮球样式和AI填表通知动画')],-1),(0,l.createElementVNode)('div',{class:'acu-settings-control'},[(0,l.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])]),(0,l.createCommentVNode)(' 主题美化与高亮配置入口 '),(0,l.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:t[10]||(t[10]=e=>h('themeConfig'))},[...t[36]||(t[36]=[(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 主题美化与高亮配置 '),(0,l.createElementVNode)('span',{class:'hint'},'自定义主题变量、高亮颜色、CSS')],-1),(0,l.createElementVNode)('div',{class:'acu-settings-control'},[(0,l.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])])])]),(0,l.createCommentVNode)(' 行为设置 '),(0,l.createElementVNode)('div',jd,[t[44]||(t[44]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-sliders-h'}),(0,l.createTextVNode)(' 行为 ')],-1)),(0,l.createElementVNode)('div',Fd,[(0,l.createCommentVNode)(' 显示分页 (移除了仪表盘开关) '),(0,l.createElementVNode)('div',Pd,[t[38]||(t[38]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 显示分页器 '),(0,l.createElementVNode)('span',{class:'hint'},'表格底部分页控件')],-1)),(0,l.createElementVNode)('div',Ld,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-switch',{active:f.showPagination}]),onClick:t[11]||(t[11]=e=>f.showPagination=!f.showPagination)},null,2)])]),(0,l.createCommentVNode)(' 限制长文本 '),(0,l.createElementVNode)('div',Rd,[t[39]||(t[39]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 限制长文本 '),(0,l.createElementVNode)('span',{class:'hint'},'超长内容自动截断')],-1)),(0,l.createElementVNode)('div',Od,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-switch',{active:f.limitLongText}]),onClick:t[12]||(t[12]=e=>f.limitLongText=!f.limitLongText)},null,2)])]),(0,l.createCommentVNode)(' 锁定面板位置 '),(0,l.createElementVNode)('div',Hd,[t[40]||(t[40]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 锁定面板位置 '),(0,l.createElementVNode)('span',{class:'hint'},'禁止拖动面板')],-1)),(0,l.createElementVNode)('div',Gd,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-switch',{active:f.lockPanel}]),onClick:t[13]||(t[13]=e=>f.lockPanel=!f.lockPanel)},null,2)])]),(0,l.createCommentVNode)(' 清除确认 '),(0,l.createElementVNode)('div',Yd,[t[41]||(t[41]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 清除操作确认 '),(0,l.createElementVNode)('span',{class:'hint'},'删除数据前需确认。关闭后点按默认删除最新一个有数据楼层。')],-1)),(0,l.createElementVNode)('div',Wd,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-switch',{active:f.purgeConfirmation}]),onClick:t[14]||(t[14]=e=>f.purgeConfirmation=!f.purgeConfirmation)},null,2)])]),(0,l.createCommentVNode)(' 收纳Tab栏 '),(0,l.createElementVNode)('div',qd,[t[42]||(t[42]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 收纳Tab栏 '),(0,l.createElementVNode)('span',{class:'hint'},'将Tab栏收纳到导航按钮中')],-1)),(0,l.createElementVNode)('div',Xd,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-switch',{active:f.collapseTabBar}]),onClick:t[15]||(t[15]=e=>f.collapseTabBar=!f.collapseTabBar)},null,2)])]),(0,l.createCommentVNode)(' 锁定单元格入口 '),(0,l.createElementVNode)('div',{class:'acu-settings-row acu-nav-row',onClick:w},[...t[43]||(t[43]=[(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' 锁定单元格 '),(0,l.createElementVNode)('span',{class:'hint'},'保护数据不被 AI 修改')],-1),(0,l.createElementVNode)('div',{class:'acu-settings-control'},[(0,l.createElementVNode)('i',{class:'fas fa-chevron-right'})],-1)])])])]),(0,l.createCommentVNode)(' Swipe 增强功能 '),(0,l.createElementVNode)('div',Kd,[t[46]||(t[46]=(0,l.createElementVNode)('div',{class:'acu-settings-title'},[(0,l.createElementVNode)('i',{class:'fas fa-hand-pointer'}),(0,l.createTextVNode)(' Swipe 增强 ')],-1)),(0,l.createElementVNode)('div',Jd,[(0,l.createCommentVNode)(' Swipe 时清除表格 '),(0,l.createElementVNode)('div',Qd,[t[45]||(t[45]=(0,l.createElementVNode)('div',{class:'acu-settings-label'},[(0,l.createTextVNode)(' Swipe 清除表格 '),(0,l.createElementVNode)('span',{class:'hint'},'重 roll 时若最后一楼有表格数据则自动清除')],-1)),(0,l.createElementVNode)('div',Zd,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-switch',{active:f.clearTableOnSwipe}]),onClick:t[16]||(t[16]=e=>f.clearTableOnSwipe=!f.clearTableOnSwipe)},null,2)])])])])],64)):'tabConfig'===b.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' ============ Tab 配置面板 ============ '),(0,l.createVNode)(ku)],2112)):'buttonConfig'===b.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' ============ 导航栏按钮配置面板 ============ '),(0,l.createVNode)(su)],2112)):'ballAppearance'===b.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:3},[(0,l.createCommentVNode)(' ============ 悬浮球外观配置面板 ============ '),(0,l.createVNode)(Rs)],2112)):'themeConfig'===b.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:4},[(0,l.createCommentVNode)(' ============ 主题美化与高亮配置面板 ============ '),(0,l.createVNode)(ud)],2112)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' ============ 添加自定义字体弹窗（直接渲染，不使用 Teleport） ============ '),(0,l.createVNode)(l.Transition,{name:'modal'},{default:(0,l.withCtx)(()=>[p.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-font-dialog-overlay',onClick:t[22]||(t[22]=(0,l.withModifiers)(e=>p.value=!1,['self']))},[(0,l.createElementVNode)('div',{class:'acu-mini-dialog acu-add-font-dialog',onClick:t[21]||(t[21]=(0,l.withModifiers)(()=>{},['stop']))},[(0,l.createElementVNode)('div',ep,[t[48]||(t[48]=(0,l.createElementVNode)('span',null,'添加自定义字体',-1)),(0,l.createElementVNode)('button',{class:'acu-mini-close',onClick:t[17]||(t[17]=(0,l.withModifiers)(e=>p.value=!1,['stop']))},[...t[47]||(t[47]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])]),(0,l.createElementVNode)('div',ap,[(0,l.createElementVNode)('div',tp,[(0,l.createElementVNode)('div',op,[t[49]||(t[49]=(0,l.createElementVNode)('label',null,'字体名称',-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[18]||(t[18]=e=>m.value=e),type:'text',placeholder:'例如：霞鹜文楷'},null,512),[[l.vModelText,m.value]])]),(0,l.createElementVNode)('div',np,[t[50]||(t[50]=(0,l.createElementVNode)('label',null,'字体链接',-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[19]||(t[19]=e=>g.value=e),type:'text',placeholder:'@import URL 或 CDN 链接'},null,512),[[l.vModelText,g.value]])])])]),(0,l.createElementVNode)('div',rp,[(0,l.createElementVNode)('button',{class:'acu-btn-secondary',onClick:t[20]||(t[20]=(0,l.withModifiers)(e=>p.value=!1,['stop']))},'取消'),(0,l.createElementVNode)('button',{class:'acu-btn-primary',disabled:!V.value,onClick:(0,l.withModifiers)(E,['stop'])},'添加',8,ip)])])])):(0,l.createCommentVNode)('v-if',!0)]),_:1}),(0,l.createCommentVNode)(' 底部留白适配移动端安全区 '),t[51]||(t[51]=(0,l.createElementVNode)('div',{class:'acu-bottom-spacer'},'—— ACU Visualizer 7.1.0 ——',-1))],2)])):(0,l.createCommentVNode)('v-if',!0)]),_:1}))}});c(294);const lp=(0,Bt.A)(cp,[['__scopeId','data-v-6aebce94']]),sp={class:'acu-action-bar'},up={key:0,class:'acu-action-btn-wrapper acu-lock-mode-btns'},dp={key:0,class:'acu-lock-count'},pp=['title','onClick','onMousedown','onTouchstartPassive'],mp={key:0,class:'secondary-indicator'},gp=['title','onClick'];Boolean,Boolean;c(872);const bp={class:'acu-toast-message'},fp=(0,l.defineComponent)({__name:'Toast',props:{visible:{type:Boolean},message:{},type:{default:'info'}},setup(e){const a=e,t=(0,l.computed)(()=>`acu-toast-${a.type}`),o=(0,l.computed)(()=>{switch(a.type){case'success':return'fas fa-check-circle';case'error':return'fas fa-times-circle';case'warning':return'fas fa-exclamation-triangle';default:return'fas fa-info-circle'}});return(a,n)=>((0,l.openBlock)(),(0,l.createBlock)(l.Transition,{name:'toast'},{default:(0,l.withCtx)(()=>[e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:(0,l.normalizeClass)(['acu-toast',t.value])},[(0,l.createElementVNode)('i',{class:(0,l.normalizeClass)(o.value)},null,2),(0,l.createElementVNode)('span',bp,(0,l.toDisplayString)(e.message),1)],2)):(0,l.createCommentVNode)('v-if',!0)]),_:1}))}}),vp={class:'acu-relationship-graph'},hp={class:'acu-graph-toolbar'},xp={key:0,class:'acu-graph-legend'},wp={class:'label'},yp={key:1,class:'acu-graph-empty'},kp={class:'acu-node-config-panel'},Cp={class:'acu-node-config-header'},Np={class:'acu-node-config-body'},Vp={class:'acu-node-fullname'},Ep={class:'acu-char-selector'},zp=['onClick'],Bp={class:'acu-node-preview'},Sp={class:'acu-node-config-actions'},Ap='acu_graph_config',Tp=(0,l.defineComponent)({__name:'RelationshipGraph',props:{relationshipTable:{default:null},characterTables:{default:()=>[]},factionTable:{default:null},showLegend:{type:Boolean,default:!0},initialLayout:{default:'fcose'}},emits:['node-click','edge-click'],setup(e,{expose:a,emit:t}){o.use(n);const r=se(),i=vt(),c=(0,l.ref)(new Map),s=e,u=t,d=(0,l.ref)(null);let p=null;const m=(0,l.ref)(s.initialLayout),g=(0,l.ref)(!1),b=(0,l.ref)(!1),f=(0,l.ref)(null),v=(0,l.ref)(''),h=(0,l.ref)(new Set),x=(0,l.ref)(null);function w(){try{const e=getVariables({type:'chat'})[Ap]||{};return e.positions&&!e.layoutPositions&&(console.info('[RelationshipGraph] 迁移旧格式位置数据到 fcose'),e.layoutPositions={fcose:e.positions},delete e.positions,y(e)),e}catch(e){return console.warn('[RelationshipGraph] 获取聊天变量失败:',e),{}}}function y(e){try{insertOrAssignVariables({[Ap]:e},{type:'chat'})}catch(e){console.warn('[RelationshipGraph] 保存聊天变量失败:',e)}}function k(e){const a=e||m.value;return w().layoutPositions?.[a]}function C(e,a){try{const t=window.parent?.document||document,o=t.querySelector('.acu-wrapper');if(o){const a=getComputedStyle(o).getPropertyValue(e).trim();if(a)return a}return getComputedStyle(t.documentElement).getPropertyValue(e).trim()||a}catch{return a}}function N(){return{textMain:C('--acu-text-main','#333333'),textSub:C('--acu-text-sub','#666666'),cardBg:C('--acu-card-bg','#ffffff'),border:C('--acu-border','#e0e0e0'),titleColor:C('--acu-title-color','#d35400'),bgPanel:C('--acu-bg-panel','#e6e2d3'),btnBg:C('--acu-btn-bg','#dcd0c0'),highlight:C('--acu-highlight','#d35400'),fontFamily:C('--acu-font-family','Source Han Sans SC, sans-serif')}}const V=(0,l.computed)(()=>function(){const e={S:'💗',A:'💙',B:'💚',C:'⚪',D:'💛',E:'❤️','?':'🟣'};return[...Ce.map(a=>({level:a.level,name:a.name,color:a.color,emoji:e[a.level]})),{level:Ne,name:Ve,color:Ee,emoji:e['?']}]}()),E=(0,l.computed)(()=>{console.info('[RelationshipGraph] 解析数据 - props:',{relationshipTable:s.relationshipTable?.name,characterTablesCount:s.characterTables?.length,characterTablesNames:s.characterTables?.map(e=>e.name),factionTable:s.factionTable?.name});const e=Me(s.relationshipTable,s.characterTables,s.factionTable);if(console.info('[RelationshipGraph] 专用关系表解析结果:',{nodeCount:e.nodeCount,edgeCount:e.edgeCount,warnings:e.warnings}),0===e.nodeCount&&s.characterTables&&s.characterTables.length>0){console.info('[RelationshipGraph] 无专用关系表，尝试从角色表内嵌字段解析');const e=_e(s.characterTables,s.factionTable);return console.info('[RelationshipGraph] 内嵌字段解析结果:',{nodeCount:e.nodeCount,edgeCount:e.edgeCount,warnings:e.warnings}),e}return e}),B=(0,l.computed)(()=>E.value.nodeCount>0);function S(e){switch(e){case'circle':return{name:'concentric',concentric:e=>x.value&&e.id()===x.value?100:x.value||'protagonist'!==e.data('type')?1:100,levelWidth:()=>1,minNodeSpacing:80,animate:!0,animationDuration:500,fit:!0,padding:30};case'dagre':return{name:'breadthfirst',directed:!0,padding:30,spacingFactor:1.5,animate:!0,animationDuration:300};default:return{name:'fcose',quality:'proof',randomize:!0,animate:!0,animationDuration:500,fit:!0,padding:30,nodeSeparation:100,idealEdgeLength:150,edgeElasticity:.45,nestingFactor:.1,gravity:.25,gravityRange:3.8,numIter:2500,tile:!0,tilingPaddingVertical:10,tilingPaddingHorizontal:10}}}function A(){if(!d.value)return;const e=N(),a=k(),t=a?Object.keys(a).length:0,n=E.value.nodeCount,r=t>0&&n>0&&t>=.8*n;console.info('[RelationshipGraph] 布局检查:',{保存的位置数:t,当前节点数:n,使用保存位置:r});const i=E.value.elements.map(e=>{const t=e.data?.id;if(t&&!e.data?.source){const o=c.value.get(t);let n;r&&a&&(a[t]?(console.info('[RelationshipGraph] 恢复节点位置:',t,a[t]),n=a[t]):n={x:200*(Math.random()-.5),y:200*(Math.random()-.5)});const i=e.data?.fullName||e.data?.id||'';return{...e,data:{...e.data,avatarUrl:o||void 0,fullName:i},...n?{position:n}:{}}}return e});p=o({container:d.value,elements:i,style:[{selector:'node',style:{label:'data(label)','text-valign':'center','text-halign':'center','text-wrap':'wrap','text-max-width':'46px','background-color':e.btnBg,color:e.textMain,'font-size':e=>{const a=(e.data('label')||'').length;return a<=1?'20px':a<=2?'16px':a<=3?'13px':a<=4?'11px':'10px'},'font-weight':'bold',width:50,height:50,'border-width':1.5,'border-color':e.textMain}},{selector:'node.protagonist',style:{'background-color':e.highlight,color:e.textMain,'border-width':1.5,'border-color':e.textMain}},{selector:'node.character',style:{}},{selector:'node.faction',style:{'background-color':e.btnBg,color:e.textMain,'border-width':1.5,'border-color':e.textMain,shape:'round-rectangle',width:70,height:35,'font-size':'14px'}},{selector:'node.unknown',style:{'background-color':e.btnBg,color:e.textMain,'border-width':1.5,'border-color':e.textMain}},{selector:'node[avatarUrl]',style:{'background-image':'data(avatarUrl)','background-fit':'cover','background-clip':'node',width:50,height:50,label:'data(fullName)','text-valign':'bottom','text-margin-y':5,'font-size':'14px','font-weight':'bold','font-family':e.fontFamily,color:e.textMain,'text-outline-width':1,'text-outline-color':e.cardBg}},{selector:'edge',style:{'curve-style':'bezier','target-arrow-shape':'triangle','target-arrow-color':'data(color)','line-color':'data(color)','line-style':'solid',width:2.5,label:'data(label)','font-size':'10px','text-rotation':'autorotate','text-margin-y':-8,color:'#fff','text-background-color':'data(color)','text-background-opacity':.95,'text-background-padding':'3px','text-background-shape':'roundrectangle'}},{selector:'edge[lineStyle = "dashed"]',style:{'line-style':'dashed'}},{selector:'edge[?bidirectional]',style:{'source-arrow-shape':'triangle','source-arrow-color':'data(color)','curve-style':'straight'}},{selector:'node:selected',style:{'border-width':4,'border-color':'#FFC107','overlay-opacity':.2,'overlay-color':'#FFC107'}},{selector:'edge:selected',style:{width:4,'line-color':'#FFC107','target-arrow-color':'#FFC107'}}],layout:r?{name:'preset'}:S(m.value),userZoomingEnabled:!0,userPanningEnabled:!0,boxSelectionEnabled:!1,minZoom:.3,maxZoom:3}),p.on('tap','node',e=>{const a=e.target,t=a.id(),o=a.data('type')||'unknown';'circle'===m.value&&function(e){if(!p)return;if(x.value===e)return;console.info(`[RelationshipGraph] 切换环形中心节点: ${x.value||'(主角)'} → ${e}`),x.value=e;p.layout(S('circle')).run()}(t),u('node-click',{id:t,type:o})}),p.on('dbltap','node',e=>{const a=e.target;!function(e,a){f.value=e,v.value=a;const t=L()[e];t&&t.selectedIndices?h.value=new Set(t.selectedIndices):h.value=new Set(function(e){const a=H(e);if(O(e))return[0];return a.length>0?[a.length-1]:[]}(a));g.value=!0}(a.id(),a.id())}),p.on('tap','edge',e=>{const a=e.target;u('edge-click',{source:a.source().id(),target:a.target().id(),relation:a.data('label')||''})}),r&&p.fit(void 0,30),function(){if(!p)return;const e=L();p.nodes().forEach(a=>{const t=e[a.id()];t&&t.displayLabel&&a.data('label',t.displayLabel)})}()}function T(){p&&(p.elements().remove(),p.add(E.value.elements),p.layout(S(m.value)).run())}function U(){p&&p.zoom(1.2*p.zoom())}function D(){p&&p.zoom(p.zoom()/1.2)}function I(){p?.fit(void 0,30)}function M(e){if(!p)return;if(e===m.value)return;const a=m.value;m.value=e,console.info(`[RelationshipGraph] 布局切换: ${a} → ${e}`);const t=function(e){const a=e||m.value,t=w();console.info(`[RelationshipGraph] hasSavedPositions(${a}):`,{layoutPositions:t.layoutPositions?Object.keys(t.layoutPositions):'undefined',targetLayoutData:t.layoutPositions?.[a]?Object.keys(t.layoutPositions[a]).length+' 个节点':'无'});const o=t.layoutPositions?.[a];return!!(o&&Object.keys(o).length>0)}(e);if(console.info(`[RelationshipGraph] 检查 [${e}] 是否有保存位置: ${t}`),t)console.info(`[RelationshipGraph] 恢复 [${e}] 保存的位置`),function(e){if(!p)return!1;const a=e||m.value,t=k(a);if(!t)return!1;const o=Object.keys(t)[0],n=t[o];console.info(`[RelationshipGraph] 准备恢复 [${a}] 位置，共 ${Object.keys(t).length} 个节点 (首节点 "${o}": 保存=${n?.x?.toFixed(0)}, ${n?.y?.toFixed(0)})`);let r=!1,i=0;p.nodes().forEach(e=>{const a=e.id(),o=t[a];if(o){const t=e.position();console.info(`[RelationshipGraph] 设置节点 "${a}": 目标=(${o.x?.toFixed?.(0)??o.x}, ${o.y?.toFixed?.(0)??o.y}), 当前=(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`),e.position({x:o.x,y:o.y});const n=e.position();console.info(`[RelationshipGraph] 节点 "${a}": (${t.x.toFixed(0)}, ${t.y.toFixed(0)}) → (${n.x.toFixed(0)}, ${n.y.toFixed(0)})`),r=!0,i++}}),r&&(console.info(`[RelationshipGraph] 从 [${a}] 恢复了 ${i} 个节点位置`),p.fit(void 0,30))}(e);else{console.info(`[RelationshipGraph] [${e}] 无保存位置，运行布局算法`);p.layout(S(e)).run()}}function j(e){if(!p)return;const a=e||m.value,t={};let o=!0;if(p.nodes().forEach(e=>{const a=e.position();a&&isFinite(a.x)&&isFinite(a.y)&&(t[e.id()]={x:a.x,y:a.y},0===a.x&&0===a.y||(o=!1))}),o&&Object.keys(t).length>0)return void console.warn('[RelationshipGraph] 跳过保存：所有位置都是 (0, 0)，布局可能未完成');const n=Object.keys(t)[0],r=t[n];console.info(`[RelationshipGraph] 保存节点位置到 [${a}]:`,Object.keys(t).length,`个节点 (首节点 "${n}": ${r?.x?.toFixed(0)}, ${r?.y?.toFixed(0)})`);const i=w();i.layoutPositions||(i.layoutPositions={}),i.layoutPositions[a]=t,y(i)}function F(){const e=w();e.layoutPositions&&(delete e.layoutPositions[m.value],y(e));const a=m.value;console.info(`[RelationshipGraph] 清除 [${a}] 布局位置，重新运行布局`);const t=p?.layout(S(a));t?.one('layoutstop',()=>{j(a)}),t?.run()}function P(){j();const e=document.querySelector('.acu-graph-btn[title="保存当前布局"]');e&&(e.classList.add('saved'),setTimeout(()=>e.classList.remove('saved'),1e3))}function L(){return w().labels||{}}function R(e){const a=w();a.labels=e,y(a)}function O(e){return/^[A-Za-z\s'-]+$/.test(e)&&e.includes(' ')}function H(e){return O(e)?e.split(' ').filter(Boolean):e.split('')}function G(){if(!v.value)return'';const e=H(v.value),a=Array.from(h.value).sort((e,a)=>e-a).map(a=>e[a]).filter(Boolean);return 0===a.length?function(e){if(O(e)){const a=e.split(' ')[0];return a.length>6?a.slice(0,6):a}return e.length>0?e[e.length-1]:e}(v.value):O(v.value)?a.join(' '):a.join('')}function Y(){if(!f.value||!v.value)return void q();const e=G(),a=Array.from(h.value),t=L();if(t[f.value]={displayLabel:e,selectedIndices:a},R(t),p){const a=p.getElementById(f.value);a&&a.data('label',e)}q()}function W(){if(!f.value||!v.value)return;const e=L();if(delete e[f.value],R(e),p){const e=p.getElementById(f.value);e&&e.data('label',v.value)}q()}function q(){g.value=!1,f.value=null,h.value=new Set}const X=(0,l.computed)(()=>E.value&&E.value.elements?E.value.elements.filter(e=>!e.data.source&&!e.data.target).map(e=>({id:e.data.id,name:e.data.id,label:e.data.label||e.data.id,type:e.data.type||'character'})):[]);function K(){b.value=!0;const{$}=Pe();$('.acu-data-display').addClass('has-modal')}function J(){b.value=!1;const{$}=Pe();$('.acu-data-display').removeClass('has-modal')}async function Q(){const e=E.value.elements.filter(e=>!e.data.source&&!e.data.target),a=new Map;for(const t of e){const e=t.data.id;if(e)try{const t=await i.getAvatarUrl(e);t&&a.set(e,t)}catch(a){console.warn(`[RelationshipGraph] 获取头像失败: ${e}`,a)}}c.value=a,console.info(`[RelationshipGraph] 头像预加载完成: ${a.size}/${e.length}`)}async function Z(){await Q(),p&&(p.nodes().forEach(e=>{const a=e.id(),t=c.value.get(a);t?e.data('avatarUrl',t):e.removeData('avatarUrl')}),p.style().update())}const ee=(0,l.ref)(!1);return(0,l.onMounted)(async()=>{B.value&&(await Q(),A(),ee.value=!0)}),(0,l.watch)(B,async e=>{e&&!ee.value&&d.value&&(console.info('[RelationshipGraph] 数据准备就绪，预加载头像...'),await Q(),console.info('[RelationshipGraph] 初始化图形'),A(),ee.value=!0)},{immediate:!0}),(0,l.onBeforeUnmount)(()=>{p?.destroy(),p=null}),(0,l.watch)(()=>s.relationshipTable,()=>{p&&T()},{deep:!0}),(0,l.watch)(()=>r.config.theme,()=>{p&&setTimeout(()=>{!function(){if(!p)return;const e=N();p.style().selector('node').style({'background-color':e.btnBg,color:e.textMain,'border-width':1.5,'border-color':e.textMain}).selector('node.protagonist').style({'background-color':e.highlight,color:e.textMain,'border-width':1.5,'border-color':e.textMain}).selector('node.faction').style({'background-color':e.btnBg,color:e.textMain,'border-width':1.5,'border-color':e.textMain}).selector('node.unknown').style({'background-color':e.btnBg,color:e.textMain,'border-width':1.5,'border-color':e.textMain}).update()}()},50)}),a({fitToView:I,zoomIn:U,zoomOut:D,setLayout:M,refresh:function(){T()}}),(a,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',vp,[(0,l.createCommentVNode)(' 工具栏 '),(0,l.createElementVNode)('div',hp,[(0,l.createElementVNode)('button',{class:'acu-graph-btn',title:'放大',onClick:U},[...t[3]||(t[3]=[(0,l.createElementVNode)('i',{class:'fas fa-plus'},null,-1)])]),(0,l.createElementVNode)('button',{class:'acu-graph-btn',title:'缩小',onClick:D},[...t[4]||(t[4]=[(0,l.createElementVNode)('i',{class:'fas fa-minus'},null,-1)])]),(0,l.createElementVNode)('button',{class:'acu-graph-btn',title:'适应视图',onClick:I},[...t[5]||(t[5]=[(0,l.createElementVNode)('i',{class:'fas fa-compress-arrows-alt'},null,-1)])]),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-graph-btn',{active:'fcose'===m.value}]),title:'力导向布局',onClick:t[0]||(t[0]=e=>M('fcose'))},[...t[6]||(t[6]=[(0,l.createElementVNode)('i',{class:'fas fa-project-diagram'},null,-1)])],2),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-graph-btn',{active:'circle'===m.value}]),title:'环形布局',onClick:t[1]||(t[1]=e=>M('circle'))},[...t[7]||(t[7]=[(0,l.createElementVNode)('i',{class:'fas fa-circle-notch'},null,-1)])],2),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['acu-graph-btn',{active:'dagre'===m.value}]),title:'层级布局',onClick:t[2]||(t[2]=e=>M('dagre'))},[...t[8]||(t[8]=[(0,l.createElementVNode)('i',{class:'fas fa-sitemap'},null,-1)])],2),t[12]||(t[12]=(0,l.createElementVNode)('span',{class:'acu-toolbar-divider'},null,-1)),(0,l.createElementVNode)('button',{class:'acu-graph-btn',title:'保存当前布局',onClick:P},[...t[9]||(t[9]=[(0,l.createElementVNode)('i',{class:'fas fa-save'},null,-1)])]),(0,l.createElementVNode)('button',{class:'acu-graph-btn',title:'重置布局',onClick:F},[...t[10]||(t[10]=[(0,l.createElementVNode)('i',{class:'fas fa-undo'},null,-1)])]),t[13]||(t[13]=(0,l.createElementVNode)('span',{class:'acu-toolbar-divider'},null,-1)),(0,l.createElementVNode)('button',{class:'acu-graph-btn',title:'头像管理',onClick:K},[...t[11]||(t[11]=[(0,l.createElementVNode)('i',{class:'fas fa-user-circle'},null,-1)])])]),(0,l.createCommentVNode)(' 图容器 '),(0,l.createElementVNode)('div',{ref_key:'containerRef',ref:d,class:'acu-graph-container'},null,512),(0,l.createCommentVNode)(' 图例 '),e.showLegend?((0,l.openBlock)(),(0,l.createElementBlock)('div',xp,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(V.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.level,class:'acu-legend-item'},[(0,l.createElementVNode)('span',{class:'dot',style:(0,l.normalizeStyle)({backgroundColor:e.color})},null,4),(0,l.createElementVNode)('span',wp,(0,l.toDisplayString)(e.emoji)+' '+(0,l.toDisplayString)(e.name),1)]))),128))])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 空状态 '),B.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('div',yp,[...t[14]||(t[14]=[(0,l.createElementVNode)('i',{class:'fas fa-project-diagram'},null,-1),(0,l.createElementVNode)('p',null,'暂无关系数据',-1),(0,l.createElementVNode)('p',{class:'hint'},'请确保存在"关系表"并包含有效数据',-1)])])),(0,l.createCommentVNode)(' 头像管理弹窗 '),(0,l.createVNode)((0,l.unref)(ji),{visible:b.value,nodes:X.value,onClose:J,onUpdate:Z},null,8,['visible','nodes']),(0,l.createCommentVNode)(' 节点配置弹窗 - 选择显示的字符 '),g.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:2,class:'acu-node-config-overlay',onClick:(0,l.withModifiers)(q,['self'])},[(0,l.createElementVNode)('div',kp,[(0,l.createElementVNode)('div',Cp,[t[16]||(t[16]=(0,l.createElementVNode)('span',null,'选择显示的字符',-1)),(0,l.createElementVNode)('button',{class:'acu-close-btn',onClick:(0,l.withModifiers)(q,['stop'])},[...t[15]||(t[15]=[(0,l.createElementVNode)('i',{class:'fas fa-times'},null,-1)])])]),(0,l.createElementVNode)('div',Np,[(0,l.createElementVNode)('p',Vp,'全名：'+(0,l.toDisplayString)(v.value),1),t[17]||(t[17]=(0,l.createElementVNode)('p',{class:'acu-node-hint'},'点击选择要显示的字符（可多选）',-1)),(0,l.createElementVNode)('div',Ep,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(H(v.value),(e,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:a,class:(0,l.normalizeClass)(['acu-char-btn',{active:h.value.has(a)}]),onClick:(0,l.withModifiers)(e=>function(e){const a=new Set(h.value);a.has(e)?a.delete(e):a.add(e),h.value=a}(a),['stop'])},(0,l.toDisplayString)(e),11,zp))),128))]),(0,l.createElementVNode)('p',Bp,'预览：'+(0,l.toDisplayString)(G()),1),(0,l.createElementVNode)('div',Sp,[(0,l.createElementVNode)('button',{class:'acu-action-btn secondary',onClick:(0,l.withModifiers)(W,['stop'])},'显示全名'),(0,l.createElementVNode)('button',{class:'acu-action-btn primary',onClick:(0,l.withModifiers)(Y,['stop'])},'确定')])])])])):(0,l.createCommentVNode)('v-if',!0)]))}});c(939);const Up=Tp,Dp=['title','onClick'],Ip=(0,l.defineComponent)({__name:'TabsPopup',props:{visible:{type:Boolean},tabs:{},activeTab:{},gridColumns:{default:'repeat(auto-fill, minmax(90px, 1fr))'},showDashboard:{type:Boolean,default:!0},showRelationshipGraph:{type:Boolean,default:!1},showOptionsPanel:{type:Boolean,default:!1}},emits:['close','tab-click'],setup(e,{emit:a}){const t=a,o=wa();function n(e){return o.hasTableIssues(e)}const r=e=>{t('tab-click',e),t('close')};return(a,t)=>((0,l.openBlock)(),(0,l.createBlock)(l.Transition,{name:'hidden-popup'},{default:(0,l.withCtx)(()=>[e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'acu-tabs-popup',onClick:t[3]||(t[3]=(0,l.withModifiers)(()=>{},['stop']))},[(0,l.createElementVNode)('div',{class:'popup-tabs-grid',style:(0,l.normalizeStyle)({'--acu-nav-cols':e.gridColumns})},[(0,l.createCommentVNode)(' 仪表盘 Tab '),e.showDashboard?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:(0,l.normalizeClass)(['acu-nav-btn',{active:e.activeTab===(0,l.unref)(Ua)}]),onClick:t[0]||(t[0]=(0,l.withModifiers)(e=>r((0,l.unref)(Ua)),['stop']))},[...t[4]||(t[4]=[(0,l.createElementVNode)('i',{class:'fas fa-home'},null,-1),(0,l.createElementVNode)('span',null,'仪表盘',-1)])],2)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 普通 Tab 列表 '),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.tabs,a=>{return(0,l.openBlock)(),(0,l.createElementBlock)('button',{key:a.id,class:(0,l.normalizeClass)(['acu-nav-btn',{active:e.activeTab===a.id,'has-issues':n(a.name),'has-ai-changes':!n(a.name)&&(t=a.name,o.hasTableAiChanges(t))}]),title:a.name,onClick:(0,l.withModifiers)(e=>r(a.id),['stop'])},[a.icon?((0,l.openBlock)(),(0,l.createElementBlock)('i',{key:0,class:(0,l.normalizeClass)(a.icon)},null,2)):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(a.name),1)],10,Dp);var t}),128)),(0,l.createCommentVNode)(' 关系图 Tab '),e.showRelationshipGraph?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:1,class:(0,l.normalizeClass)(['acu-nav-btn',{active:e.activeTab===(0,l.unref)(Ia)}]),onClick:t[1]||(t[1]=(0,l.withModifiers)(e=>r((0,l.unref)(Ia)),['stop']))},[...t[5]||(t[5]=[(0,l.createElementVNode)('i',{class:'fas fa-project-diagram'},null,-1),(0,l.createElementVNode)('span',null,'关系图',-1)])],2)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' 选项面板 Tab '),e.showOptionsPanel?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:2,class:(0,l.normalizeClass)(['acu-nav-btn',{active:e.activeTab===(0,l.unref)(Da)}]),onClick:t[2]||(t[2]=(0,l.withModifiers)(e=>r((0,l.unref)(Da)),['stop']))},[...t[6]||(t[6]=[(0,l.createElementVNode)('i',{class:'fas fa-sliders-h'},null,-1),(0,l.createElementVNode)('span',null,'选项',-1)])],2)):(0,l.createCommentVNode)('v-if',!0)],4)])):(0,l.createCommentVNode)('v-if',!0)]),_:1}))}});c(245);const Mp=(0,Bt.A)(Ip,[['__scopeId','data-v-8edb0844']]),_p=(0,l.defineComponent)({__name:'App',setup(e){const a=Ma(),t=wa(),o=se(),{init:n,cleanup:r}=Ye(),{saveToDatabase:i,getTableData:c,purgeFloorRange:s,stopAutoSave:u}=it(),{state:d}=(0,Pa.d)();!function(){const e=(0,l.ref)(0),a=(0,l.ref)(0);let t=null,o=null;function n(t){const o=t.target;if(!o.closest?.('.acu-layout-horizontal .acu-panel-content'))return;const n=t.touches[0];e.value=n.clientX,a.value=n.clientY}function r(t){const o=t.target;if(!o.closest?.('.acu-layout-horizontal .acu-panel-content'))return;if('INPUT'===o.tagName||'TEXTAREA'===o.tagName||o.isContentEditable)return;let n=o,r=!1;for(;n&&n.classList&&!n.classList.contains('acu-panel-content');){if(n.scrollHeight>n.clientHeight){const e=window.getComputedStyle(n);if(['auto','scroll'].includes(e.overflowY)){r=!0;break}}n=n.parentElement}if(r)return;const i=t.touches[0],c=i.clientX-e.value,l=i.clientY-a.value;Math.abs(l)>Math.abs(c)&&t.cancelable&&t.preventDefault()}function i(){const e=window.parent?.document;e?(t=n,o=r,e.addEventListener('touchstart',t,{capture:!0,passive:!1}),e.addEventListener('touchmove',o,{capture:!0,passive:!1}),console.info('[ACU] 触摸滚动修复已安装（composable 管理）')):console.warn('[ACU] 无法访问父窗口 document，触摸滚动修复未安装')}function c(){const e=window.parent?.document;e&&(t&&(e.removeEventListener('touchstart',t,{capture:!0}),t=null),o&&(e.removeEventListener('touchmove',o,{capture:!0}),o=null),console.info('[ACU] 触摸滚动修复已卸载'))}(0,l.onMounted)(()=>{i()}),(0,l.onUnmounted)(()=>{c()})}(),at();const p=mt(),m=(0,l.ref)(),g=(0,l.ref)();(0,l.provide)('allTables',()=>B.value);const b=(0,l.ref)(''),f=(0,l.ref)(!1),v=(0,l.ref)(!1),h=(0,l.ref)(!1),x=(0,l.ref)(!1),w=(0,l.ref)(!1),y=(0,l.ref)(!1),k=(0,l.ref)(!1),C=(0,l.reactive)({tableName:'',tableId:'',rowIndex:0,currentRowData:null,titleColIndex:1}),N=(0,l.reactive)({visible:!1,x:0,y:0,tableId:'',tableName:'',rowIndex:0,isDeleting:!1}),V=(0,l.computed)(()=>[`acu-theme-${o.config.theme}`,`acu-font-${o.config.fontFamily.replace(/\s+/g,'-').toLowerCase()}`,{'acu-mobile':a.isMobile,'acu-layout-horizontal':'horizontal'===o.config.layout,'acu-layout-vertical':'vertical'===o.config.layout}]),E=(0,l.computed)(()=>a.activeTab===Ua?'ACU 仪表盘':a.activeTab===Da?'ACU 选项面板':`ACU - ${a.activeTab||'可视化表格'}`),B=(0,l.computed)(()=>{const e=t.stagedData;if(!e)return[];const a=Re(e);return a?Object.entries(a).map(([e,a])=>{const{key:t,headers:o,rows:n}=a,r=n.map((a,t)=>{const n=a.map((e,a)=>({colIndex:a,key:o[a]||`col_${a}`,value:String(e??'')}));return{index:t,key:`${e}-row-${t}`,cells:n}});return{id:t,name:e,headers:o.map(e=>String(e)),rows:r}}):[]}),S=(0,l.computed)(()=>B.value.map(e=>({id:e.id,name:e.name,icon:R(e.name)}))),A=(0,l.computed)(()=>B.value.some(e=>e.name.includes('选项')||e.name.toLowerCase().includes('option'))),T=(0,l.computed)(()=>!0===o.config.collapseTabBar),U=(0,l.computed)(()=>B.value.filter(e=>e.name.includes('选项')||e.name.toLowerCase().includes('option'))),D=(0,l.computed)(()=>B.value.some(e=>De(e.name,e.id))),I=(0,l.computed)(()=>B.value.find(e=>{const a=e.name.toLowerCase(),t=e.id.toLowerCase();return a.includes('关系')||t.includes('relationship')||t.includes('relation')})||null),M=(0,l.computed)(()=>B.value.filter(e=>De(e.name,e.id))),j=(0,l.computed)(()=>{const e=['势力','faction','组织','organization','阵营'];return B.value.find(a=>{const t=a.name.toLowerCase(),o=a.id.toLowerCase();return e.some(e=>t.includes(e)||o.includes(e))})||null}),F=(0,l.computed)(()=>a.activeTab&&B.value.find(e=>e.id===a.activeTab)||null),P=(0,l.computed)(()=>0),L=(0,l.computed)(()=>{const e=window.SillyTavern?.chat;return Array.isArray(e)?e.length-1:0});function R(e){const a=e.toLowerCase();return a.includes('主角')||a.includes('player')?'fas fa-user':a.includes('npc')||a.includes('角色')?'fas fa-users':a.includes('任务')||a.includes('quest')?'fas fa-tasks':a.includes('物品')||a.includes('item')?'fas fa-box-open':a.includes('技能')||a.includes('skill')?'fas fa-magic':a.includes('装备')||a.includes('equip')?'fas fa-shield-alt':a.includes('状态')||a.includes('status')?'fas fa-heart':a.includes('事件')||a.includes('event')?'fas fa-calendar-alt':a.includes('选项')||a.includes('option')?'fas fa-sliders-h':'fas fa-table'}function O(){a.closePanel(),console.info('[ACU] 面板已关闭')}function H(){f.value=!f.value}function G(){a.isCollapsed=!0,console.info('[ACU] 面板已收起为悬浮球')}function Y(e){a.setActiveTab(e),b.value='',f.value=!1,console.info(`[ACU] 切换到 Tab: ${e}`),(0,l.nextTick)(()=>{W(e)})}function W(e){const t=g.value?.getDataAreaElement();if(!t)return;const o=a.getTableHeight(e);o?(t.style.height=`${o}px`,console.info(`[ACU] 恢复高度: ${e} = ${o}px`)):g.value?.resetHeight()}function q(e){a.setTableOrder(e),console.info('[ACU] Tab 顺序已更新')}function X(){k.value=!k.value,console.info('[ACU] Tab浮窗: '+(k.value?'显示':'隐藏'))}function K(e){k.value=!1,Y(e)}function J(e){a.setActiveTab(e),console.info(`[ACU] 导航到表格: ${e}`),(0,l.nextTick)(()=>{W(e)})}function Q(){D.value?(a.setActiveTab(Ia),console.info('[ACU] 导航到关系图 Tab')):Pa.toast.warning('未找到人物关系数据')}function Z(e,a){switch(e){case'clear':x.value=!0;break;case'undo':ie();break;case'manualUpdate':we();break;default:console.log('[ACU Dashboard] 未处理的动作:',e,a)}}function ee(){f.value=!0,console.info('[ACU] 数据区已隐藏')}function ae(e,t){const o=g.value?.getDataAreaElement();if(!o)return;if(0!==e.button)return;e.preventDefault(),e.stopPropagation(),t.setPointerCapture(e.pointerId);const n=e.clientY,r=o.offsetHeight,i=e=>{const a=n-e.clientY;let t=r+a;const i=.8*(window.parent?.innerHeight??window.innerHeight);t=Math.max(200,Math.min(i,t)),o.style.height=`${t}px`},c=e=>{t.releasePointerCapture(e.pointerId),t.removeEventListener('pointermove',i),t.removeEventListener('pointerup',c);const n=a.activeTab;if(n&&o){const e=o.offsetHeight;a.setTableHeight(n,e),console.info(`[ACU] 保存高度: ${n} = ${e}px`)}};t.addEventListener('pointermove',i),t.addEventListener('pointerup',c)}function te(){const e=a.activeTab;e&&(a.resetTableHeight(e),console.info(`[ACU] 清除高度记忆: ${e}`)),g.value?.resetHeight(),console.info('[ACU] 高度已重置为自适应')}async function oe(){const e=c();if(e){t.setStagedData(e),t.saveSnapshot(e);const o=Object.keys(e).filter(e=>e.startsWith('sheet_'));a.syncNewTablesToVisibleTabs(o),t.clearChanges(!0)}}async function ne(){try{await oe(),console.info('[ACU] 数据已刷新')}catch(e){console.error('[ACU] 刷新失败:',e)}}async function re(){try{t.saveLastState();await i(null,!1,!0)&&(console.info('[ACU] 数据已保存'),await oe())}catch(e){console.error('[ACU] 保存失败:',e)}}function ie(){if(!t.hasUndoData)return void Pa.toast.warning('没有可撤回的数据');t.undoToLastSave()?(Pa.toast.success('已撤回到上次保存前的状态（需手动保存）'),console.info('[ACU] 已撤回到上次保存前的状态, hasUnsavedChanges:',t.hasUnsavedChanges)):Pa.toast.error('撤回失败')}function ce(e,a,t){console.info(`[ACU] 单元格点击: ${e}[${a}][${t}]`)}function le(e,a){console.info(`[ACU] 行点击: ${e}[${a.index}]`)}async function ue(e,a){console.info(`[ACU] 插入行: ${e} 在索引 ${a} 之后`);if(!B.value.find(a=>a.id===e))return void console.warn('[ACU] 未找到表格:',e);const{insertRow:t}=ct();await t(e,a),await oe()}function de(e,a){const o=B.value.find(a=>a.id===e),n=`${o?.name||e}-row-${a}`;t.toggleDelete(n),console.info(`[ACU] 切换删除状态: ${n}`)}function pe(e,a,o){const n=B.value.find(e=>e.id===a),r=n?.name||a,i=`${r}-row-${o}`;N.visible=!0,N.x=e.clientX,N.y=e.clientY,N.tableId=a,N.tableName=r,N.rowIndex=o,N.isDeleting=t.pendingDeletes.has(i)}function me(){ue(N.tableId,N.rowIndex),N.visible=!1}function ge(){const e=B.value.find(e=>e.id===N.tableId),a=e?.rows[N.rowIndex];if(a){const e=a.cells.map(e=>`${e.key}: ${e.value}`).join('\n');navigator.clipboard.writeText(e).then(()=>{console.info('[ACU] 内容已复制')})}N.visible=!1}function be(){de(N.tableId,N.rowIndex),N.visible=!1}function fe(){de(N.tableId,N.rowIndex),N.visible=!1}function ve(e,a,t,o){C.tableId=e,C.tableName=a,C.rowIndex=t,C.currentRowData=o;const n=B.value.find(a=>a.id===e);if(n&&(a.includes('总结')||a.includes('大纲'))){const e=n.headers.findIndex(e=>e&&(e.includes('索引')||e.includes('编号')||e.includes('代码')));C.titleColIndex=e>0?e:1}else C.titleColIndex=1;y.value=!0,console.info(`[ACU] 打开历史记录: ${a}[${t}], titleColIndex=${C.titleColIndex}`)}async function he(e){const{tableId:a,tableName:o,rowIndex:n,currentRowData:r}=C;if(!r||0===e.size)return void(y.value=!1);const{saveSnapshot:i,getCurrentChatId:c}=ua();c()&&(await i(o,n,function(e){const a={};return e.cells.forEach((e,t)=>{a[t]=String(e.value)}),a}(r),'manual'),console.info('[ACU] 已保存历史记录（批量操作前）'));for(const[a,r]of e)t.updateCell(o,n,a,r,{skipHistory:!0});console.info(`[ACU] 应用历史更改: ${e.size} 个单元格`),y.value=!1}function xe(){console.info('[ACU] 设置已保存')}function we(){w.value=!0}function ye(){try{const e=(window.parent||window).AutoCardUpdaterAPI||window.AutoCardUpdaterAPI;e&&'function'==typeof e.openVisualizer?(e.openVisualizer(),console.info('[ACU] 已打开原生编辑器')):console.warn('[ACU] AutoCardUpdaterAPI.openVisualizer 不可用')}catch(e){console.error('[ACU] 打开原生编辑器失败:',e)}}async function ke(e){try{await i(null,!1,!1,e)&&console.info(`[ACU] 数据已保存到第 ${e} 楼`)}catch(e){console.error('[ACU] 保存到指定楼层失败:',e)}}async function Ce(e,a){try{await s(e,a),console.info(`[ACU] 已清除第 ${e} 到 ${a} 楼的数据`),await oe()}catch(e){console.error('[ACU] 清除范围失败:',e)}}return(0,l.onMounted)(async()=>{console.info('[ACU] App 组件已挂载'),n();try{p.init(),console.info('[ACU] Swipe 增强功能初始化成功')}catch(e){console.error('[ACU] Swipe 增强功能初始化失败:',e)}a.setMobile(window.innerWidth<=768),window.addEventListener('resize',()=>{a.setMobile(window.innerWidth<=768)});try{await oe(),a.setInitialized(!0),!a.activeTab&&B.value.length>0&&a.setActiveTab(Ua)}catch(e){console.error('[ACU] 初始化数据加载失败:',e)}}),(0,l.onUnmounted)(()=>{console.info('[ACU] App 组件已卸载'),u(),r()}),(0,l.onMounted)(()=>{const e=window.parent?.document||document,t=e=>{if(!a.isPanelVisible||a.isPinned)return;(function(e){const a=window.parent?.document||document;if(a.querySelector('.acu-inline-editor'))return console.info('[ACU] 检测到 InlineEditor 存在，阻止收起面板'),!0;if(a.querySelector('.acu-editing-lock'))return console.info('[ACU] 检测到编辑锁定状态，阻止收起面板'),!0;const t=a.activeElement;return!t||'TEXTAREA'!==t.tagName&&'INPUT'!==t.tagName||!t.closest('.acu-wrapper')&&!t.closest('.acu-inline-editor')?!!(v.value||h.value||x.value||w.value||y.value)||!!(e.closest('.acu-wrapper')||e.closest('.acu-floating-ball-vue')||e.closest('.acu-context-menu')||e.closest('.acu-modal-overlay')||e.closest('.acu-modal')||e.closest('.acu-modal-container')||e.closest('.acu-history-modal')||e.closest('.acu-dialog')||e.closest('[class*="acu-settings"]')||e.closest('#acu_visualizer_vue-root')||e.closest('.acu-inline-editor')||e.closest('.acu-editing-lock')||e.closest('.acu-edit-textarea')):(console.info('[ACU] 检测到 ACU 内的输入框活动，阻止收起面板'),!0)})(e.target)||(a.closePanel(),console.info('[ACU] 点击外部，面板已收起'))};e.addEventListener('click',t),(0,l.onUnmounted)(()=>{e.removeEventListener('click',t)})}),(0,l.watch)(()=>t.stagedData,e=>{e&&t.generateDiffMap(e)},{deep:!0}),(e,n)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['acu-app',V.value])},[(0,l.createCommentVNode)(' 悬浮球 (面板隐藏时显示) '),(0,l.createCommentVNode)(' :style 绑定在跨 iframe 脚本项目中是可用的（参考 src/手机界面） '),(0,l.createVNode)((0,l.unref)(Nt),{ref_key:'floatingBallRef',ref:m,style:(0,l.normalizeStyle)({display:(0,l.unref)(a).isPanelVisible?'none':'block'})},null,8,['style']),(0,l.createCommentVNode)(' 主面板 '),(0,l.createCommentVNode)(' :style 绑定在跨 iframe 脚本项目中是可用的（参考 src/手机界面） '),(0,l.createVNode)((0,l.unref)(Ft),{ref_key:'mainPanelRef',ref:g,style:(0,l.normalizeStyle)({display:(0,l.unref)(a).isPanelVisible?'flex':'none'}),title:E.value,theme:(0,l.unref)(o).config.theme,layout:(0,l.unref)(o).config.layout,'is-collapsed':(0,l.unref)(a).isCollapsed,'is-pinned':(0,l.unref)(a).isPinned,'is-content-hidden':f.value,'lock-panel':(0,l.unref)(o).config.lockPanel,'has-changes':(0,l.unref)(t).hasUnsavedChanges,onRefresh:ne,onSave:re,onSaveAs:n[3]||(n[3]=e=>h.value=!0),onUndo:ie,onManualUpdate:we,onPurge:n[4]||(n[4]=e=>x.value=!0),onOpenNative:ye,onSettings:n[5]||(n[5]=e=>v.value=!0),onTogglePin:(0,l.unref)(a).togglePin,onToggle:G,onClose:O,onHideContent:H,onCollapseTab:X},{tabs:(0,l.withCtx)(()=>[T.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createBlock)((0,l.unref)(Rt),{key:0,tabs:S.value,'active-tab':(0,l.unref)(a).activeTab,'show-dashboard':!0,'has-options-tabs':A.value,'has-relationship-graph':D.value,'is-editing-order':(0,l.unref)(a).isEditingOrder,'grid-columns':(0,l.unref)(o).gridColumnsCss,onTabChange:Y,onOrderChange:q,onExitEditing:n[0]||(n[0]=e=>(0,l.unref)(a).setEditingOrder(!1))},null,8,['tabs','active-tab','has-options-tabs','has-relationship-graph','is-editing-order','grid-columns']))]),'tabs-popup':(0,l.withCtx)(()=>[(0,l.createVNode)((0,l.unref)(Mp),{visible:k.value,tabs:S.value,'active-tab':(0,l.unref)(a).activeTab,'grid-columns':(0,l.unref)(o).gridColumnsCss,'show-dashboard':!0,'show-options-panel':A.value,'show-relationship-graph':D.value,onTabClick:K,onClose:n[1]||(n[1]=e=>k.value=!1)},null,8,['visible','tabs','active-tab','grid-columns','show-options-panel','show-relationship-graph'])]),default:(0,l.withCtx)(()=>[(0,l.createCommentVNode)(' 仪表盘视图 '),(0,l.unref)(a).activeTab===(0,l.unref)(Ua)?((0,l.openBlock)(),(0,l.createBlock)((0,l.unref)(bn),{key:0,tables:B.value,onNavigate:J,onRowClick:le,onShowRelationshipGraph:Q,onAction:Z},null,8,['tables'])):(0,l.unref)(a).activeTab===(0,l.unref)(Da)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' 选项面板视图 '),(0,l.createVNode)((0,l.unref)(Wn),{tables:U.value,onCellClick:ce,onToggleDelete:de},null,8,['tables'])],2112)):(0,l.unref)(a).activeTab===(0,l.unref)(Ia)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' 关系图视图 '),(0,l.createVNode)((0,l.unref)(Up),{'relationship-table':I.value,'character-tables':M.value,'faction-table':j.value,'show-legend':!0},null,8,['relationship-table','character-tables','faction-table'])],2112)):F.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:3},[(0,l.createCommentVNode)(' 普通表格视图 '),((0,l.openBlock)(),(0,l.createBlock)((0,l.unref)(Un),{key:F.value.id,'table-id':F.value.id,'table-name':F.value.name,rows:F.value.rows,headers:F.value.headers,'search-term':b.value,onCellClick:ce,onInsertRow:ue,onToggleDelete:de,onContextMenu:pe,onSearchChange:n[2]||(n[2]=e=>b.value=e),onClose:ee,onHeightDragStart:ae,onHeightReset:te,onShowHistory:ve},null,8,['table-id','table-name','rows','headers','search-term']))],2112)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:4},[(0,l.createCommentVNode)(' 无数据状态 '),n[12]||(n[12]=(0,l.createElementVNode)('div',{class:'acu-no-data'},[(0,l.createElementVNode)('i',{class:'fas fa-inbox'}),(0,l.createElementVNode)('p',null,'请选择一个表格')],-1))],2112))]),_:1},8,['style','title','theme','layout','is-collapsed','is-pinned','is-content-hidden','lock-panel','has-changes','onTogglePin']),(0,l.createCommentVNode)(' 右键菜单 '),(0,l.createVNode)((0,l.unref)(Kn),{visible:N.visible,'onUpdate:visible':n[6]||(n[6]=e=>N.visible=e),x:N.x,y:N.y,'table-id':N.tableId,'table-name':N.tableName,'row-index':N.rowIndex,onInsertRow:me,onCopy:ge,onDelete:be,onUndoDelete:fe},null,8,['visible','x','y','table-id','table-name','row-index']),(0,l.createCommentVNode)(' 设置弹窗 '),(0,l.createVNode)((0,l.unref)(lp),{visible:v.value,'onUpdate:visible':n[7]||(n[7]=e=>v.value=e),onSave:xe},null,8,['visible']),(0,l.createCommentVNode)(' 输入楼层弹窗 '),(0,l.createVNode)((0,l.unref)(Fc),{visible:h.value,'onUpdate:visible':n[8]||(n[8]=e=>h.value=e),'current-floor':P.value,onConfirm:ke},null,8,['visible','current-floor']),(0,l.createCommentVNode)(' 清除范围弹窗 '),(0,l.createVNode)((0,l.unref)(as),{visible:x.value,'onUpdate:visible':n[9]||(n[9]=e=>x.value=e),'max-floor':L.value,onConfirm:Ce},null,8,['visible','max-floor']),(0,l.createCommentVNode)(' 手动更新配置弹窗 '),(0,l.createVNode)((0,l.unref)(Xl),{visible:w.value,'onUpdate:visible':n[10]||(n[10]=e=>w.value=e)},null,8,['visible']),(0,l.createCommentVNode)(' 历史记录弹窗 '),(0,l.createVNode)((0,l.unref)(Uc),{visible:y.value,'onUpdate:visible':n[11]||(n[11]=e=>y.value=e),'table-name':C.tableName,'table-id':C.tableId,'row-index':C.rowIndex,'current-row-data':C.currentRowData,'title-col-index':C.titleColIndex,onApply:he},null,8,['visible','table-name','table-id','row-index','current-row-data','title-col-index']),(0,l.createCommentVNode)(' 全局 Toast 通知 '),(0,l.createVNode)((0,l.unref)(fp),{visible:(0,l.unref)(d).visible,message:(0,l.unref)(d).message,type:(0,l.unref)(d).type},null,8,['visible','message','type'])],2))}}),$p=_p;window.$=window.parent.$;const jp='acu-parent-container';let Fp=null,Pp=null,Lp=null,Rp=!1;function Op(){let a=0;const t=()=>{if(Rp)return void console.info('[ACU] 脚本正在卸载，停止 API 检查');const{$,getDB:o}=Pe(),n=o();if(n&&'function'==typeof n.exportTableAsJson&&$){const o=n.exportTableAsJson();if(!(o&&Object.keys(o).length>0)&&a<10)return a++,console.info(`[ACU] API 就绪但无数据，等待中... (${a}/10)`),void(Lp=setTimeout(t,1e3));Lp=null,function(){const a=window.parent.document;if(a.getElementById(jp))return void console.warn('[ACU] Vue 应用已存在，跳过重复初始化');Pp=a.createElement('div'),Pp.id=jp,a.body.appendChild(Pp);const t=e();Fp=(0,l.createApp)($p),Fp.use(t),Fp.mount(Pp),console.info(`[ACU] Vue 应用已挂载到父窗口 (${jp})`)}()}else Lp=setTimeout(t,1e3)};t()}$(()=>{console.info(`[ACU] 脚本加载: ${jp}`),Op(),$(window).on('pagehide',()=>{console.info('[ACU] 页面卸载，执行清理'),console.info('[ACU] 开始清理资源...'),Rp=!0,null!==Lp&&(clearTimeout(Lp),Lp=null,console.info('[ACU] 初始化定时器已清除')),Fp&&(Fp.unmount(),Fp=null,console.info('[ACU] Vue 应用已卸载')),Pp&&(Pp.remove(),Pp=null,console.info('[ACU] 挂载点已移除')),console.info('[ACU] 资源清理完成')})});
//# sourceMappingURL=index.js.map