# 移动端安全区配置开发计划

## 需求背景

移动端浏览器底部存在安全区域（Home 指示条、虚拟导航键等），当前安全区大小是硬编码的，但不同浏览器/设备的需求差异很大：
- 有些浏览器不需要安全区
- 有些需要很大的安全区

用户希望能在设置面板中通过开关和滑块统一控制安全区大小。

## 方案确认

- **范围**: 0-150px（0 = 禁用）
- **默认值**: 50px
- **控件**: 仅使用滑块，设为 0 即禁用

## 当前安全区实现位置

| 文件 | 位置 | 用途 | 当前值 |
|------|------|------|--------|
| `MainPanel.vue` | `getMobileSafeBottomMargin()` | 拖拽边界限制 | iOS: `max(60, safeAreaBottom + 20)`, 其他: `50px` |
| `dialogs.scss` | `.acu-bottom-spacer` | 设置弹窗底部留白 | `height: 80px; padding-bottom: 30px` |
| `dialogs.scss` | `.acu-mobile-actions` | 历史记录底部按钮 | `max(50px, calc(24px + env(safe-area-inset-bottom, 30px)))` |

## 实现步骤

### Step 1: 类型定义 (types.ts)

在 `ACUConfig` 接口中新增配置项：

```typescript
export interface ACUConfig {
  // ... 现有配置

  /** 移动端底部安全区大小 (0-150px，0表示禁用) */
  mobileSafeAreaBottom?: number;
}
```

### Step 2: 配置 Store (useConfigStore.ts)

在 `DEFAULT_CONFIG` 中添加默认值：

```typescript
export const DEFAULT_CONFIG: ACUConfig = {
  // ... 现有配置
  mobileSafeAreaBottom: 50, // 默认 50px
};
```

### Step 3: CSS 变量注入 (App.vue)

在 `App.vue` 的 `watchEffect` 中动态设置 CSS 变量：

```typescript
// 在现有的 watchEffect 中添加
const safeArea = configStore.config.mobileSafeAreaBottom ?? 50;
// 注入到父窗口（因为样式在父窗口生效）
if (window.parent?.document?.documentElement) {
  window.parent.document.documentElement.style.setProperty(
    '--acu-safe-area-bottom',
    `${safeArea}px`
  );
}
```

### Step 4: MainPanel.vue 修改

修改 `getMobileSafeBottomMargin()` 函数：

```typescript
function getMobileSafeBottomMargin(): number {
  if (!isMobileDevice()) {
    return 0;
  }

  // 使用用户配置的安全区大小，默认 50px
  return configStore.config.mobileSafeAreaBottom ?? 50;
}
```

需要在组件中引入 `configStore`。

### Step 5: dialogs.scss 修改

#### 5.1 设置弹窗底部留白

```scss
// 底部留白 - 适配移动端安全区
.acu-bottom-spacer {
  height: calc(30px + var(--acu-safe-area-bottom, 50px));
  padding-bottom: var(--acu-safe-area-bottom, 50px);
  width: 100%;
  text-align: center;
  color: var(--acu-text-sub, #999);
  font-size: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.5;
  flex-shrink: 0;
}
```

#### 5.2 历史记录弹窗底部按钮

```scss
.acu-mobile-actions {
  // ... 其他样式保持不变
  padding-bottom: calc(24px + var(--acu-safe-area-bottom, 50px));
  // 移除原来的 max() 逻辑，直接使用变量
}
```

### Step 6: 设置面板 UI (SettingsDialog.vue)

在「行为」分组中新增设置项：

```vue
<!-- 移动端底部安全区 -->
<div class="acu-settings-row">
  <div class="acu-settings-label">
    移动端底部安全区
    <span class="hint">{{ localConfig.mobileSafeAreaBottom ?? 50 }}px</span>
  </div>
  <div class="acu-settings-control">
    <input
      v-model.number="localConfig.mobileSafeAreaBottom"
      type="range"
      min="0"
      max="150"
      step="10"
    />
  </div>
</div>
```

## 文件修改清单

| 文件 | 修改类型 | 说明 |
|------|----------|------|
| `src/可视化表格/types.ts` | 新增属性 | `ACUConfig` 接口添加 `mobileSafeAreaBottom` |
| `src/可视化表格/stores/useConfigStore.ts` | 新增默认值 | `DEFAULT_CONFIG` 添加 `mobileSafeAreaBottom: 50` |
| `src/可视化表格/App.vue` | 新增逻辑 | CSS 变量注入到父窗口 |
| `src/可视化表格/components/MainPanel.vue` | 修改函数 | `getMobileSafeBottomMargin()` 使用配置值 |
| `src/可视化表格/styles/overlays/dialogs.scss` | 修改样式 | `.acu-bottom-spacer` 和 `.acu-mobile-actions` 使用 CSS 变量 |
| `src/可视化表格/components/dialogs/SettingsDialog.vue` |  | 添加安全区滑块设置项（可复用原有拖动条和设置行样式） |

## 测试要点

1. **默认值**: 新用户首次打开时应使用 50px 默认值
2. **实时生效**: 调整滑块后，安全区大小应立即更新
3. **持久化**: 刷新页面后配置应保持
4. **拖拽边界**: 导航栏拖拽时边界限制应正确应用
5. **弹窗底部**: 设置弹窗和历史记录弹窗底部留白应正确
6. **设为 0**: 安全区设为 0 时应完全禁用底部留白
