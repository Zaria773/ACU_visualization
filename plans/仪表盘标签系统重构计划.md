# ä»ªè¡¨ç›˜æ ‡ç­¾ç³»ç»Ÿé‡æ„è®¡åˆ’

## éœ€æ±‚æ¦‚è¿°

æ ¹æ®ç”¨æˆ·åé¦ˆï¼Œéœ€è¦å¯¹ä»ªè¡¨ç›˜ç»„ä»¶è¿›è¡Œä»¥ä¸‹é‡æ„ï¼š



### éœ€æ±‚3ï¼šæ ‡ç­¾ç³»ç»Ÿå®Œå…¨é‡æ„

#### 3.1 äº’åŠ¨æ ‡ç­¾çš„æ¦‚å¿µ
- **äº’åŠ¨æ ‡ç­¾**ï¼šèƒ½å¤Ÿè¾“å…¥æç¤ºè¯çš„æ ‡ç­¾ï¼Œç‚¹å‡»åä¼šå°†æç¤ºè¯è¿½åŠ åˆ°è¾“å…¥æ¡†
- æ ‡ç­¾åº“æŒ‰**è¡¨**ä¿å­˜ï¼Œå­˜å‚¨åœ¨**é…’é¦†å…¨å±€å˜é‡**ä¸­

#### 3.2 UI å¸ƒå±€ï¼ˆäº”åŒºåŸŸè®¾è®¡ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»„ä»¶è®¾ç½®å¼¹çª—                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ åŒºåŸŸä¸€ï¼šå·²å±•ç¤ºçš„äº’åŠ¨æ ‡ç­¾                                  â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚ â”‚ â”‚ [æ ‡ç­¾A] [æ ‡ç­¾B] [æ ‡ç­¾C]                             â”‚ â”‚â”‚
â”‚ â”‚ â”‚  ç‚¹å‡»å¯ç§»é™¤(å˜ä¸ºæœªå±•ç¤º)                              â”‚ â”‚â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ åŒºåŸŸäºŒï¼šæ ‡ç­¾åº“æ»šåŠ¨åŒº (è¡¨å: xxx)           âŸ³ çºµå‘æ»šåŠ¨     â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚ â”‚ â”‚ [æ ‡ç­¾D] ç‚¹éæŒ‰é’®åŒºé€‰ä¸­ç¼–è¾‘       [+å±•ç¤º] [ğŸ—‘åˆ é™¤]    â”‚ â”‚â”‚
â”‚ â”‚ â”‚ [æ ‡ç­¾E]                           [+å±•ç¤º] [ğŸ—‘åˆ é™¤]    â”‚ â”‚â”‚
â”‚ â”‚ â”‚ [æ ‡ç­¾F] â† å½“å‰é€‰ä¸­ (é«˜äº®)        [+å±•ç¤º] [ğŸ—‘åˆ é™¤]    â”‚ â”‚â”‚
â”‚ â”‚ â”‚ [æ ‡ç­¾G]                           [+å±•ç¤º] [ğŸ—‘åˆ é™¤]    â”‚ â”‚â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ åŒºåŸŸä¸‰ï¼šæ ‡ç­¾ç¼–è¾‘åŒº                                        â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚ â”‚ â”‚ æ ‡ç­¾æ–‡æœ¬: [                                        ] â”‚ â”‚â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚ â”‚ â”‚ æç¤ºè¯æ¨¡æ¿:                                          â”‚ â”‚â”‚
â”‚ â”‚ â”‚ [                                                   ]â”‚ â”‚â”‚
â”‚ â”‚ â”‚ [                                                   ]â”‚ â”‚â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚ â”‚ é€šé…ç¬¦: [{{value}}] [{{rowTitle}}] [{{playerName}}]      â”‚â”‚
â”‚ â”‚         â†‘ ç‚¹å‡»è¿½åŠ åˆ°è¾“å…¥æ¡†æœ«å°¾                           â”‚â”‚
â”‚ â”‚                                                          â”‚â”‚
â”‚ â”‚                           [ğŸ§¹æ¸…é™¤] [ğŸ’¾å­˜å…¥æ ‡ç­¾åº“]         â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ åŒºåŸŸå››ï¼šé€šé…ç¬¦è¯´æ˜                                        â”‚â”‚
â”‚ â”‚ â€¢ {{value}} - æ ‡ç­¾æœ¬èº«çš„å€¼                                â”‚â”‚
â”‚ â”‚ â€¢ {{rowTitle}} - å½“å‰è¡Œæ ‡é¢˜                              â”‚â”‚
â”‚ â”‚ â€¢ {{playerName}} - ä¸»è§’å                                â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ åŒºåŸŸäº”ï¼šäº’åŠ¨æ ‡ç­¾å…¶ä»–æ¥æºåˆ—                                â”‚â”‚
â”‚ â”‚ é€‰æ‹©åˆ—: [ä¸‹æ‹‰é€‰æ‹©...]                                     â”‚â”‚
â”‚ â”‚ å·²é€‰: [åˆ—A Ã—] [åˆ—B Ã—]                                    â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.3 äº¤äº’é€»è¾‘è¯´æ˜

| åŒºåŸŸ | åŠŸèƒ½ | äº¤äº’ |
|------|------|------|
| **åŒºåŸŸä¸€** | å·²å±•ç¤ºçš„äº’åŠ¨æ ‡ç­¾ | ç‚¹å‡»å¯ç§»é™¤ï¼ˆå˜ä¸ºæœªå±•ç¤ºçŠ¶æ€ï¼‰ |
| **åŒºåŸŸäºŒ** | æ ‡ç­¾åº“æ»šåŠ¨åŒº | ç‚¹å‡»æ ‡ç­¾éæŒ‰é’®åŒºé€‰ä¸­ç¼–è¾‘ï¼›[+]å±•ç¤ºåˆ°åŒºåŸŸä¸€ï¼›[ğŸ—‘]åˆ é™¤ |
| **åŒºåŸŸä¸‰** | æ ‡ç­¾ç¼–è¾‘åŒº | ç¼–è¾‘é€‰ä¸­æ ‡ç­¾æˆ–æ–°å»ºï¼›[ğŸ§¹]æ¸…é™¤è¾“å…¥æ¡†ï¼›[ğŸ’¾]ä¿å­˜ |
| **åŒºåŸŸå››** | é€šé…ç¬¦è¯´æ˜ | çº¯å±•ç¤ºï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£é€šé…ç¬¦å«ä¹‰ |
| **åŒºåŸŸäº”** | æ¥æºåˆ—é…ç½® | é€‰æ‹©ä»å“ªäº›åˆ—è‡ªåŠ¨æå–æ ‡ç­¾ |

**æ–°å»ºæ ‡ç­¾æµç¨‹**ï¼š
1. ç¡®ä¿åŒºåŸŸäºŒæ²¡æœ‰é€‰ä¸­ä»»ä½•æ ‡ç­¾ï¼ˆæˆ–ç‚¹å‡»æ¸…é™¤æŒ‰é’®ï¼‰
2. åœ¨åŒºåŸŸä¸‰å¡«å†™æ ‡ç­¾æ–‡æœ¬å’Œæç¤ºè¯æ¨¡æ¿
3. ç‚¹å‡»ä¿å­˜ï¼Œæ–°æ ‡ç­¾å‡ºç°åœ¨åŒºåŸŸäºŒ

---

## æŠ€æœ¯å®ç°è®¡åˆ’

---

### R3: æ ‡ç­¾ç³»ç»Ÿé‡æ„ - æ•°æ®å±‚

#### 3.1 ç±»å‹å®šä¹‰æ›´æ–° (`types.ts`)

```typescript
/** äº’åŠ¨æ ‡ç­¾å®šä¹‰ - å­˜å‚¨åœ¨å…¨å±€å˜é‡ä¸­ */
export interface InteractiveTag {
  /** æ ‡ç­¾å”¯ä¸€ ID */
  id: string;
  /** æ ‡ç­¾æ˜¾ç¤ºæ–‡æœ¬ */
  label: string;
  /** æç¤ºè¯æ¨¡æ¿ */
  promptTemplate: string;
  /** åˆ›å»ºæ—¶é—´ */
  createdAt: string;
}

/** æŒ‰è¡¨å­˜å‚¨çš„æ ‡ç­¾åº“ */
export interface TableTagLibrary {
  /** è¡¨æ ¼ ID */
  tableId: string;
  /** è¡¨æ ¼åç§° (ç”¨äºæ˜¾ç¤º) */
  tableName: string;
  /** è¯¥è¡¨çš„æ ‡ç­¾åˆ—è¡¨ */
  tags: InteractiveTag[];
}

/** ç»„ä»¶é…ç½®ä¸­çš„æ ‡ç­¾å¼•ç”¨ */
export interface WidgetTagConfig {
  /** æ ‡ç­¾æ¥æºåˆ— (åŒºåŸŸäº”é…ç½®) */
  sourceColumns: string[];
  /** å·²å±•ç¤ºçš„æ ‡ç­¾ ID åˆ—è¡¨ (åŒºåŸŸä¸€æ˜¾ç¤ºçš„) */
  displayedTagIds: string[];
}
```

#### 3.2 å…¨å±€å˜é‡å­˜å‚¨

å­˜å‚¨é”®ï¼š`acu_table_tag_libraries`
å­˜å‚¨ç±»å‹ï¼š`TableTagLibrary[]`
å­˜å‚¨ä½ç½®ï¼šé…’é¦†å…¨å±€å˜é‡ `getVariables({ type: 'global' })`

#### 3.3 æ–°å»º `useTagLibraryStore.ts`

```typescript
// stores/useTagLibraryStore.ts
export const useTagLibraryStore = defineStore('acu-tag-library', () => {
  /** æŒ‰è¡¨å­˜å‚¨çš„æ ‡ç­¾åº“ */
  const libraries = ref<TableTagLibrary[]>([]);

  /** ä»å…¨å±€å˜é‡åŠ è½½ */
  async function loadLibraries(): Promise<void>;

  /** ä¿å­˜åˆ°å…¨å±€å˜é‡ */
  async function saveLibraries(): Promise<void>;

  /** è·å–æŒ‡å®šè¡¨çš„æ ‡ç­¾åº“ */
  function getLibrary(tableId: string): TableTagLibrary | undefined;

  /** ç¡®ä¿è¡¨çš„æ ‡ç­¾åº“å­˜åœ¨ */
  function ensureLibrary(tableId: string, tableName: string): TableTagLibrary;

  /** æ·»åŠ æˆ–æ›´æ–°æ ‡ç­¾ */
  function upsertTag(tableId: string, tableName: string, tag: InteractiveTag): void;

  /** åˆ é™¤æ ‡ç­¾ */
  function deleteTag(tableId: string, tagId: string): void;

  return { libraries, loadLibraries, saveLibraries, getLibrary, ensureLibrary, upsertTag, deleteTag };
});
```

---

### R4: æ ‡ç­¾ç³»ç»Ÿé‡æ„ - UI å±‚

#### 4.1 é‡æ„ `WidgetSettingsDialog.vue`

**çŠ¶æ€å®šä¹‰ï¼š**
```typescript
// å½“å‰é€‰ä¸­çš„æ ‡ç­¾ ID (ç”¨äºç¼–è¾‘)
const selectedTagId = ref<string | null>(null);

// ç¼–è¾‘åŒºè¡¨å•æ•°æ®
const editingLabel = ref('');
const editingPromptTemplate = ref('');

// å½“å‰è¡¨çš„æ ‡ç­¾åº“
const tableTagLibrary = computed(() => {
  return tagLibraryStore.getLibrary(props.widgetConfig?.tableId || '')?.tags || [];
});

// å·²å±•ç¤ºçš„æ ‡ç­¾åˆ—è¡¨ (åŒºåŸŸä¸€)
const displayedTags = computed(() => {
  const displayedIds = localConfig.widgetTagConfig?.displayedTagIds || [];
  return tableTagLibrary.value.filter(t => displayedIds.includes(t.id));
});

// æœªå±•ç¤ºçš„æ ‡ç­¾åˆ—è¡¨ (åŒºåŸŸäºŒ)
const availableTags = computed(() => {
  const displayedIds = localConfig.widgetTagConfig?.displayedTagIds || [];
  return tableTagLibrary.value.filter(t => !displayedIds.includes(t.id));
});
```

**æ–¹æ³•å®šä¹‰ï¼š**
```typescript
// åŒºåŸŸä¸€ï¼šç§»é™¤å·²å±•ç¤ºçš„æ ‡ç­¾
function removeFromDisplayed(tagId: string): void {
  const ids = localConfig.widgetTagConfig?.displayedTagIds || [];
  localConfig.widgetTagConfig.displayedTagIds = ids.filter(id => id !== tagId);
}

// åŒºåŸŸäºŒï¼šé€‰ä¸­æ ‡ç­¾è¿›è¡Œç¼–è¾‘
function selectTagForEdit(tagId: string): void {
  selectedTagId.value = tagId;
  const tag = tableTagLibrary.value.find(t => t.id === tagId);
  if (tag) {
    editingLabel.value = tag.label;
    editingPromptTemplate.value = tag.promptTemplate;
  }
}

// åŒºåŸŸäºŒï¼šæ·»åŠ åˆ°å·²å±•ç¤º
function addToDisplayed(tagId: string): void {
  if (!localConfig.widgetTagConfig) {
    localConfig.widgetTagConfig = { sourceColumns: [], displayedTagIds: [] };
  }
  if (!localConfig.widgetTagConfig.displayedTagIds.includes(tagId)) {
    localConfig.widgetTagConfig.displayedTagIds.push(tagId);
  }
}

// åŒºåŸŸäºŒï¼šåˆ é™¤æ ‡ç­¾
function deleteTagFromLibrary(tagId: string): void {
  tagLibraryStore.deleteTag(props.widgetConfig?.tableId || '', tagId);
  // åŒæ—¶ä»å·²å±•ç¤ºä¸­ç§»é™¤
  removeFromDisplayed(tagId);
  // å¦‚æœæ­£åœ¨ç¼–è¾‘è¯¥æ ‡ç­¾ï¼Œæ¸…é™¤ç¼–è¾‘çŠ¶æ€
  if (selectedTagId.value === tagId) {
    clearEditForm();
  }
}

// åŒºåŸŸä¸‰ï¼šæ¸…é™¤ç¼–è¾‘è¡¨å•
function clearEditForm(): void {
  selectedTagId.value = null;
  editingLabel.value = '';
  editingPromptTemplate.value = '';
}

// åŒºåŸŸä¸‰ï¼šè¿½åŠ é€šé…ç¬¦åˆ°æç¤ºè¯æœ«å°¾
function appendWildcard(wildcard: string): void {
  editingPromptTemplate.value += wildcard;
}

// åŒºåŸŸä¸‰ï¼šä¿å­˜æ ‡ç­¾
function saveTag(): void {
  if (!editingLabel.value.trim()) return;

  const tableId = props.widgetConfig?.tableId || '';
  const tableName = props.widgetConfig?.title || '';

  if (selectedTagId.value) {
    // æ›´æ–°ç°æœ‰æ ‡ç­¾
    tagLibraryStore.upsertTag(tableId, tableName, {
      id: selectedTagId.value,
      label: editingLabel.value.trim(),
      promptTemplate: editingPromptTemplate.value,
      createdAt: new Date().toISOString(),
    });
  } else {
    // æ–°å»ºæ ‡ç­¾
    const newTag: InteractiveTag = {
      id: `tag_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      label: editingLabel.value.trim(),
      promptTemplate: editingPromptTemplate.value,
      createdAt: new Date().toISOString(),
    };
    tagLibraryStore.upsertTag(tableId, tableName, newTag);
  }

  clearEditForm();
}
```

#### 4.2 æ¨¡æ¿ç»“æ„

```vue
<template>
  <!-- å…¶ä»–é…ç½®åŒº... -->

  <!-- åŒºåŸŸä¸€ï¼šå·²å±•ç¤ºçš„äº’åŠ¨æ ‡ç­¾ -->
  <div class="acu-settings-section">
    <div class="acu-settings-title">
      <i class="fas fa-eye"></i>
      å·²å±•ç¤ºçš„äº’åŠ¨æ ‡ç­¾
    </div>
    <div class="acu-displayed-tags">
      <span v-for="tag in displayedTags" :key="tag.id" class="acu-displayed-tag">
        {{ tag.label }}
        <button class="acu-tag-remove-btn" @click.stop="removeFromDisplayed(tag.id)">
          <i class="fas fa-times"></i>
        </button>
      </span>
      <span v-if="displayedTags.length === 0" class="acu-empty-hint">
        æš‚æ— å·²å±•ç¤ºçš„æ ‡ç­¾
      </span>
    </div>
  </div>

  <!-- åŒºåŸŸäºŒï¼šæ ‡ç­¾åº“æ»šåŠ¨åŒº -->
  <div class="acu-settings-section">
    <div class="acu-settings-title">
      <i class="fas fa-database"></i>
      æ ‡ç­¾åº“ (è¡¨: {{ tableName }})
    </div>
    <div class="acu-tag-library-scroll">
      <div
        v-for="tag in availableTags"
        :key="tag.id"
        class="acu-tag-library-item"
        :class="{ selected: selectedTagId === tag.id }"
        @click="selectTagForEdit(tag.id)"
      >
        <span class="acu-tag-label">{{ tag.label }}</span>
        <div class="acu-tag-actions">
          <button class="acu-icon-btn" title="æ·»åŠ åˆ°å±•ç¤º" @click.stop="addToDisplayed(tag.id)">
            <i class="fas fa-plus"></i>
          </button>
          <button class="acu-icon-btn danger" title="åˆ é™¤" @click.stop="deleteTagFromLibrary(tag.id)">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
      <div v-if="availableTags.length === 0" class="acu-empty-hint">
        æš‚æ— å¯ç”¨æ ‡ç­¾ï¼Œè¯·åœ¨ä¸‹æ–¹åˆ›å»º
      </div>
    </div>
  </div>

  <!-- åŒºåŸŸä¸‰ï¼šæ ‡ç­¾ç¼–è¾‘åŒº -->
  <div class="acu-settings-section">
    <div class="acu-settings-title">
      <i class="fas fa-edit"></i>
      {{ selectedTagId ? 'ç¼–è¾‘æ ‡ç­¾' : 'æ–°å»ºæ ‡ç­¾' }}
    </div>
    <div class="acu-tag-editor">
      <input
        v-model="editingLabel"
        type="text"
        class="acu-input"
        placeholder="æ ‡ç­¾æ–‡æœ¬"
      />
      <textarea
        v-model="editingPromptTemplate"
        class="acu-textarea"
        placeholder="æç¤ºè¯æ¨¡æ¿"
        rows="3"
      ></textarea>
      <div class="acu-wildcard-shortcuts">
        <span class="hint">ç‚¹å‡»æ’å…¥é€šé…ç¬¦:</span>
        <button class="acu-wildcard-btn" @click.stop="appendWildcard('{{value}}')">
          {{value}}
        </button>
        <button class="acu-wildcard-btn" @click.stop="appendWildcard('{{rowTitle}}')">
          {{rowTitle}}
        </button>
        <button class="acu-wildcard-btn" @click.stop="appendWildcard('{{playerName}}')">
          {{playerName}}
        </button>
      </div>
      <div class="acu-tag-editor-actions">
        <button class="acu-btn-secondary" @click.stop="clearEditForm" title="æ¸…é™¤">
          <i class="fas fa-eraser"></i>
          æ¸…é™¤
        </button>
        <button class="acu-btn-primary" @click.stop="saveTag" :disabled="!editingLabel.trim()">
          <i class="fas fa-save"></i>
          ä¿å­˜
        </button>
      </div>
    </div>
  </div>

  <!-- åŒºåŸŸå››ï¼šé€šé…ç¬¦è¯´æ˜ -->
  <div class="acu-config-hint">
    <i class="fas fa-lightbulb"></i>
    <div>
      <strong>é€šé…ç¬¦è¯´æ˜ï¼š</strong>
      <ul>
        <li><code>{{value}}</code> - æ ‡ç­¾æœ¬èº«çš„å€¼</li>
        <li><code>{{rowTitle}}</code> - å½“å‰è¡Œæ ‡é¢˜</li>
        <li><code>{{playerName}}</code> - ä¸»è§’å</li>
      </ul>
    </div>
  </div>

  <!-- åŒºåŸŸäº”ï¼šäº’åŠ¨æ ‡ç­¾æ¥æºåˆ— -->
  <div class="acu-settings-section">
    <div class="acu-settings-title">
      <i class="fas fa-columns"></i>
      äº’åŠ¨æ ‡ç­¾æ¥æºåˆ—
    </div>
    <div class="acu-settings-group">
      <div class="acu-settings-row">
        <div class="acu-settings-label">
          é€‰æ‹©åˆ—
          <span class="hint">ä»è¿™äº›åˆ—è‡ªåŠ¨æå–äº’åŠ¨æ ‡ç­¾</span>
        </div>
        <div class="acu-settings-control">
          <select v-model="selectedSourceColumn" class="acu-select" @change="handleSourceColumnSelect">
            <option value="">é€‰æ‹©è¦æ·»åŠ çš„åˆ—...</option>
            <option v-for="header in availableSourceColumns" :key="header" :value="header">
              {{ header }}
            </option>
          </select>
        </div>
      </div>
      <div v-if="localConfig.widgetTagConfig?.sourceColumns.length > 0" class="acu-selected-tags">
        <span v-for="col in localConfig.widgetTagConfig.sourceColumns" :key="col" class="acu-selected-tag">
          {{ col }}
          <button class="acu-tag-remove" @click.stop="removeSourceColumn(col)">
            <i class="fas fa-times"></i>
          </button>
        </span>
      </div>
    </div>
  </div>
</template>
```

#### 4.3 æ ·å¼æ›´æ–° (`dialogs.scss`)

```scss
// å·²å±•ç¤ºçš„æ ‡ç­¾åŒº
.acu-displayed-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 8px;
  min-height: 40px;
  background: var(--acu-input-bg);
  border-radius: 6px;
}

.acu-displayed-tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  background: var(--acu-title-color-bg);
  border: 1px solid var(--acu-title-color);
  border-radius: 4px;
  font-size: 12px;

  .acu-tag-remove-btn {
    padding: 2px;
    background: none;
    border: none;
    cursor: pointer;
    opacity: 0.6;

    &:hover {
      opacity: 1;
    }
  }
}

// æ ‡ç­¾åº“æ»šåŠ¨åŒº
.acu-tag-library-scroll {
  max-height: 150px;
  overflow-y: auto;
  padding: 8px;
  background: var(--acu-input-bg);
  border-radius: 6px;
}

.acu-tag-library-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 12px;
  margin-bottom: 4px;
  background: var(--acu-card-bg);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;

  &:hover {
    background: var(--acu-table-hover);
  }

  &.selected {
    outline: 2px solid var(--acu-title-color);
  }

  .acu-tag-label {
    flex: 1;
  }

  .acu-tag-actions {
    display: flex;
    gap: 4px;
  }
}

// æ ‡ç­¾ç¼–è¾‘åŒº
.acu-tag-editor {
  padding: 12px;
  background: var(--acu-input-bg);
  border-radius: 8px;

  .acu-input,
  .acu-textarea {
    width: 100%;
    margin-bottom: 8px;
  }
}

.acu-wildcard-shortcuts {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
  flex-wrap: wrap;

  .hint {
    font-size: 11px;
    color: var(--acu-text-sub);
  }
}

.acu-wildcard-btn {
  padding: 4px 8px;
  background: var(--acu-badge-bg);
  border: 1px solid var(--acu-border);
  border-radius: 4px;
  font-family: monospace;
  font-size: 11px;
  cursor: pointer;
  transition: all 0.2s;

  &:hover {
    background: var(--acu-btn-hover);
  }
}

.acu-tag-editor-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}
```

---

## æ•°æ®æµè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…¨å±€å˜é‡å­˜å‚¨     â”‚ â†â†’  â”‚  useTagLibraryStore   â”‚
â”‚ (é…’é¦†å…¨å±€å˜é‡)   â”‚     â”‚  (æŒ‰è¡¨å­˜å‚¨æ ‡ç­¾åº“)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ WidgetSettingsDialog  â”‚
                         â”‚ - åŒºåŸŸä¸€: å·²å±•ç¤ºæ ‡ç­¾   â”‚
                         â”‚ - åŒºåŸŸäºŒ: æ ‡ç­¾åº“é€‰æ‹©   â”‚
                         â”‚ - åŒºåŸŸä¸‰: ç¼–è¾‘/æ–°å»º    â”‚
                         â”‚ - åŒºåŸŸå››: é€šé…ç¬¦è¯´æ˜   â”‚
                         â”‚ - åŒºåŸŸäº”: æ¥æºåˆ—é…ç½®   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ DashboardWidgetConfig â”‚
                         â”‚ - displayedTagIds     â”‚
                         â”‚ - sourceColumns       â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®æ–½é¡ºåº

### é˜¶æ®µä¸€ï¼šåŸºç¡€é‡æ„ï¼ˆR1+R2ï¼‰
1. [R1] åˆ›å»º `WidgetActionsDialog.vue`
2. [R1] æ›´æ–° `useUIStore.ts` æ·»åŠ å¼¹çª—çŠ¶æ€
3. [R1] æ›´æ–° `App.vue` æ¸²æŸ“å¼¹çª—
4. [R1] æ›´æ–° `DashboardWidget.vue` è§¦å‘å…¨å±€å¼¹çª—
5. [R2] æ·»åŠ  `nativeEdit` åŠ¨ä½œç±»å‹
6. [R2] æ›´æ–°é»˜è®¤æŒ‰é’®é…ç½®

### é˜¶æ®µäºŒï¼šæ ‡ç­¾ç³»ç»Ÿé‡æ„ï¼ˆR3+R4ï¼‰
1. [R3] æ›´æ–° `types.ts` æ ‡ç­¾ç±»å‹å®šä¹‰
2. [R3] åˆ›å»º `useTagLibraryStore.ts`
3. [R4] é‡æ„ `WidgetSettingsDialog.vue` UI (äº”åŒºåŸŸ)
4. [R4] æ›´æ–° `dialogs.scss` æ ·å¼
5. [R4] æ›´æ–° `DashboardWidget.vue` è¯»å–æ ‡ç­¾é…ç½®

---

## å…¼å®¹æ€§è€ƒè™‘

### æ•°æ®è¿ç§»
- æ—§çš„ `interactiveTagConfig.tagDefinitions` éœ€è¦è¿ç§»åˆ°æ–°çš„å…¨å±€æ ‡ç­¾åº“
- è¿ç§»é€»è¾‘æ”¾åœ¨ `useTagLibraryStore.loadLibraries()` ä¸­

### å‘åå…¼å®¹
- ç»„ä»¶é…ç½®ä¸­ä¿ç•™ `interactiveTagConfig` å­—æ®µä½†æ ‡è®°ä¸º deprecated
- æ–°å¢ `widgetTagConfig` å­—æ®µä½¿ç”¨æ–°ç»“æ„
