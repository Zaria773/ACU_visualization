# ä»ªè¡¨ç›˜é‡æ„è®¡åˆ’

## éœ€æ±‚æ¦‚è¿°

å°†ä»ªè¡¨ç›˜é‡æ„ä¸ºå¯è‡ªç”±é…ç½®çš„å¤šåŠŸèƒ½åŒºï¼Œæ”¯æŒï¼š
1. **æ»šåŠ¨å°çœ‹æ¿**ï¼šæ¯ä¸ªè¡¨éƒ½å¯å˜æˆæå–ç‰¹å®šæ ‡é¢˜çš„æ»šåŠ¨çœ‹æ¿ï¼ˆå‚è€ƒ6.4.1çš„NPC/ä»»åŠ¡çœ‹æ¿ï¼‰
2. **è‡ªç”±é…ç½®**ï¼šæ¯ä¸ªè¡¨æ ¼éƒ½å¯ä»¥æ·»åŠ ä¸ºçœ‹æ¿
3. **è¡¨æ ¼ç»Ÿè®¡**ï¼ˆæš‚å®šï¼‰ï¼šæ˜¾ç¤ºæ›´æ–°é¢‘ç‡å’Œæœªæ›´æ–°æ¥¼å±‚æ•°
4. **å¿«æ·æŒ‰é’®**ï¼šçœ‹æ¿å¤´å³ä¾§å¯é…ç½®å¿«æ·åŠŸèƒ½æŒ‰é’®ï¼ˆæ¸…é™¤ã€æ’¤å›ã€æ‰‹åŠ¨æ›´æ–°ã€å…³ç³»å›¾ç­‰ï¼‰

### æ–°å¢éœ€æ±‚ (2025-01-14)

**1. å­˜å‚¨ä½ç½®è°ƒæ•´**
- é…ç½®ä»ã€Œå…¨å±€å˜é‡ã€æ”¹ä¸ºã€Œ**èŠå¤©å˜é‡**ã€ï¼ˆç»‘å®šå½“å‰è§’è‰²å¡çš„èŠå¤©ï¼‰
- ä½¿ç”¨ `getVariables({ type: 'chat' })` å­˜å–

**2. é¡¶æ å…¥å£**
- ä»ªè¡¨ç›˜æœ‰è‡ªå·±çš„é¡¶æ ï¼ˆå’Œå…¶ä»– Tab é£æ ¼ä¸€è‡´ï¼‰
- é¡¶æ åŒ…å«ã€Œç¼–è¾‘ã€æŒ‰é’®ï¼Œç‚¹å‡»è¿›å…¥ç¼–è¾‘æ€

**3. iOS å°ç»„ä»¶ç¼–è¾‘é£æ ¼**
è¿›å…¥ç¼–è¾‘æ€åï¼Œæ¯ä¸ªç»„ä»¶æ˜¾ç¤ºï¼š
- **å·¦ä¸Šè§’ [Ã—]**ï¼šç§»é™¤ç»„ä»¶
- **å³ä¸Šè§’ [+]**ï¼šé…ç½®å¿«æ·æŒ‰é’®
- **å³ä¸‹è§’ [â¤¡]**ï¼šæ‹–åŠ¨æ”¹å˜å¤§å°ï¼ˆå•æ â†”åŒæ ï¼‰
- **æ‹–åŠ¨ç»„ä»¶è¡¨å¤´**ï¼šæ¢ç»„ä»¶ä½ç½®
- **æ‹–åŠ¨ç»„ä»¶è¡Œï¼ˆæ­¤æ—¶è¡Œå‰é¢å‡ºç°6ç‚¹å›¾æ ‡ï¼ŒæŒ‰è¿™é‡Œå¯ä»¥æ‹–åŠ¨ï¼‰**ï¼šæ¢ç»„ä»¶è¡Œä½ç½®

å¤§å°è§„åˆ™ï¼š
- å•æ ã€åŒæ æœ‰å›ºå®šå®½åº¦
- åŒæ å¯æ‹–æˆå•æ ï¼Œå•æ å¯æ‹–æˆåŒæ 
- åŒæ å˜å•æ æ—¶ï¼Œä¼šæŠŠå¦ä¸€ä¸ªåŒæ æŒ¤åˆ°ä¸‹ä¸€è¡Œ

**4. æ»šåŠ¨è§„åˆ™**
- **ç»„ä»¶å†…éƒ¨æ»šåŠ¨**ï¼šç»„ä»¶å†…å®¹è¶…å‡ºæ—¶ï¼Œç»„ä»¶å†…éƒ¨å¯æ»šåŠ¨ï¼ˆè®¾ç½® `max-height` + `overflow-y: auto`ï¼‰
- **ä»ªè¡¨ç›˜æ•´ä½“æ»šåŠ¨**ï¼šå½“æ‰€æœ‰ç»„ä»¶è¶…å‡ºä»ªè¡¨ç›˜é«˜åº¦æ—¶ï¼Œä»ªè¡¨ç›˜æ•´ä½“ä¹Ÿå¯æ»šåŠ¨

**5. æ·»åŠ ç»„ä»¶å…¥å£**
- ç¼–è¾‘æ€ä¸‹ï¼Œé¡¶æ å‡ºç° **[+] æ·»åŠ ç»„ä»¶** æŒ‰é’®
- ç‚¹å‡»å¼¹å‡ºé€‰æ‹©è¡¨æ ¼å¼¹çª—

## æ¶æ„è®¾è®¡

### 1. ç±»å‹å®šä¹‰

åœ¨ `types.ts` ä¸­æ–°å¢ï¼š

```typescript
/** çœ‹æ¿å¿«æ·æŒ‰é’®ç±»å‹ */
export type WidgetActionId =
  | 'goToTable'        // è·³è½¬åˆ°è¡¨æ ¼
  | 'clear'            // æ¸…é™¤è¡¨æ ¼
  | 'undo'             // æ’¤å›
  | 'manualUpdate'     // æ‰‹åŠ¨æ›´æ–°
  | 'relationshipGraph' // äººç‰©å…³ç³»å›¾
  | 'settings';        // è®¾ç½®

/** çœ‹æ¿å¿«æ·æŒ‰é’®é…ç½® */
export interface WidgetAction {
  id: WidgetActionId;
  icon: string;      // FA å›¾æ ‡ class
  label: string;     // æ˜¾ç¤ºæ ‡ç­¾
  tooltip?: string;  // æ‚¬æµ®æç¤º
}

/** å•ä¸ªçœ‹æ¿é…ç½® */
export interface DashboardWidgetConfig {
  /** å”¯ä¸€ ID */
  id: string;
  /** çœ‹æ¿ç±»å‹ */
  type: 'table' | 'stats' | 'custom';
  /** å…³è”çš„è¡¨æ ¼ ID (type='table' æ—¶å¿…å¡«) */
  tableId?: string;
  /** æ˜¾ç¤ºæ ‡é¢˜ */
  title: string;
  /** å›¾æ ‡ (FA class) */
  icon: string;
  /** æå–çš„åˆ—ååˆ—è¡¨ (ç©º=æ˜¾ç¤ºå…¨éƒ¨) */
  displayColumns: string[];
  /** æœ€å¤§æ˜¾ç¤ºè¡Œæ•° */
  maxRows: number;
  /** å¿«æ·æŒ‰é’®åˆ—è¡¨ */
  actions: WidgetActionId[];
  /** æ’åºç´¢å¼• */
  order: number;
  /** æ˜¯å¦å¯ç”¨ */
  enabled: boolean;
  /** å®½åº¦æƒé‡ (1=å•æ ¼, 2=åŒæ ¼) */
  colSpan: 1 | 2;
}

/** ä»ªè¡¨ç›˜é…ç½® */
export interface DashboardConfig {
  /** çœ‹æ¿åˆ—è¡¨ */
  widgets: DashboardWidgetConfig[];
  /** å¸ƒå±€æ¨¡å¼ */
  layout: 'grid' | 'list';
  /** åˆ—æ•° (grid æ¨¡å¼) */
  columns: number;
  /** æ˜¯å¦æ˜¾ç¤ºç»Ÿè®¡å¡ç‰‡ */
  showStats: boolean;
}
```

### 2. é¢„è®¾å¿«æ·æŒ‰é’®

```typescript
export const WIDGET_ACTIONS: Record<WidgetActionId, WidgetAction> = {
  goToTable: { id: 'goToTable', icon: 'fa-external-link-alt', label: 'è·³è½¬', tooltip: 'è·³è½¬åˆ°è¡¨æ ¼' },
  clear: { id: 'clear', icon: 'fa-eraser', label: 'æ¸…é™¤', tooltip: 'æ¸…é™¤è¡¨æ ¼æ•°æ®' },
  undo: { id: 'undo', icon: 'fa-undo', label: 'æ’¤å›', tooltip: 'æ’¤å›ä¸Šæ¬¡ä¿®æ”¹' },
  manualUpdate: { id: 'manualUpdate', icon: 'fa-hand-sparkles', label: 'æ›´æ–°', tooltip: 'æ‰‹åŠ¨æ›´æ–°' },
  relationshipGraph: { id: 'relationshipGraph', icon: 'fa-project-diagram', label: 'å…³ç³»å›¾', tooltip: 'äººç‰©å…³ç³»å›¾' },
  settings: { id: 'settings', icon: 'fa-cog', label: 'è®¾ç½®', tooltip: 'çœ‹æ¿è®¾ç½®' },
};
```

### 3. å­˜å‚¨å±‚è®¾è®¡

æ‰©å±• `useConfigStore.ts` æˆ–æ–°å»º `useDashboardStore.ts`ï¼š

```typescript
// å­˜å‚¨é”®
const STORAGE_KEY_DASHBOARD = 'acu_dashboard_config_v1';

// é»˜è®¤é…ç½®
export const DEFAULT_DASHBOARD_CONFIG: DashboardConfig = {
  widgets: [],
  layout: 'grid',
  columns: 2,
  showStats: true,
};

// é»˜è®¤çœ‹æ¿æ¨¡æ¿ (ç”¨äºå¿«é€Ÿæ·»åŠ )
export const WIDGET_TEMPLATES: Record<string, Partial<DashboardWidgetConfig>> = {
  npc: {
    type: 'table',
    title: 'NPC',
    icon: 'fa-users',
    displayColumns: ['åç§°', 'å§“å', 'name', 'çŠ¶æ€', 'å¥½æ„Ÿåº¦'],
    maxRows: 8,
    actions: ['goToTable', 'relationshipGraph'],
    colSpan: 1,
  },
  task: {
    type: 'table',
    title: 'ä»»åŠ¡',
    icon: 'fa-tasks',
    displayColumns: ['åç§°', 'ä»»åŠ¡å', 'ç±»å‹', 'çŠ¶æ€'],
    maxRows: 5,
    actions: ['goToTable'],
    colSpan: 1,
  },
  item: {
    type: 'table',
    title: 'ç‰©å“',
    icon: 'fa-box-open',
    displayColumns: ['åç§°', 'ç‰©å“å', 'æ•°é‡'],
    maxRows: 12,
    actions: ['goToTable', 'clear'],
    colSpan: 1,
  },
  character: {
    type: 'table',
    title: 'ä¸»è§’',
    icon: 'fa-user',
    displayColumns: [],
    maxRows: 1,
    actions: ['goToTable'],
    colSpan: 2,
  },
};
```

---

## ç»„ä»¶è®¾è®¡

### 1. ç»„ä»¶ç»“æ„

```
src/å¯è§†åŒ–è¡¨æ ¼/components/
â”œâ”€â”€ Dashboard.vue                    # ä»ªè¡¨ç›˜ä¸»å®¹å™¨ (é‡å†™)
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ DashboardWidget.vue          # é€šç”¨çœ‹æ¿ç»„ä»¶
â”‚   â”œâ”€â”€ DashboardWidgetHeader.vue    # çœ‹æ¿å¤´éƒ¨ (æ ‡é¢˜+å¿«æ·æŒ‰é’®)
â”‚   â”œâ”€â”€ DashboardWidgetBody.vue      # çœ‹æ¿å†…å®¹åŒº (æ»šåŠ¨åˆ—è¡¨)
â”‚   â”œâ”€â”€ DashboardStatsCard.vue       # ç»Ÿè®¡å¡ç‰‡
â”‚   â””â”€â”€ DashboardAddButton.vue       # æ·»åŠ çœ‹æ¿æŒ‰é’®
â”œâ”€â”€ dialogs/
â”‚   â””â”€â”€ DashboardConfigDialog.vue    # ä»ªè¡¨ç›˜é…ç½®å¼¹çª— (æ–°å¢)
```

### 2. Dashboard.vue (ä¸»å®¹å™¨)

```vue
<template>
  <div class="acu-dash-container">
    <!-- ç»Ÿè®¡å¡ç‰‡ (å¯é€‰) -->
    <DashboardStatsCard v-if="showStats" />

    <!-- çœ‹æ¿ç½‘æ ¼ -->
    <div class="acu-dash-grid" :style="gridStyle">
      <DashboardWidget
        v-for="widget in enabledWidgets"
        :key="widget.id"
        :config="widget"
        :table="getTableData(widget.tableId)"
        @navigate="handleNavigate"
        @action="handleAction"
        @row-click="handleRowClick"
      />

      <!-- æ·»åŠ çœ‹æ¿æŒ‰é’® -->
      <DashboardAddButton @click="openConfigDialog" />
    </div>
  </div>
</template>
```

### 3. DashboardWidget.vue (é€šç”¨çœ‹æ¿)

å‚è€ƒ6.4.1æ ·å¼ï¼Œå®ç°ï¼š
- åœ†è§’å¡ç‰‡å®¹å™¨
- å¯é…ç½®æ ‡é¢˜å’Œå›¾æ ‡
- æ»šåŠ¨åˆ—è¡¨å±•ç¤º
- é«˜äº®å˜åŠ¨é¡¹
- ç‚¹å‡»è·³è½¬/é¢„è§ˆ

```vue
<template>
  <div class="acu-dash-card" :class="{ 'acu-dash-card-wide': config.colSpan === 2 }">
    <!-- å¤´éƒ¨ -->
    <DashboardWidgetHeader
      :title="config.title"
      :icon="config.icon"
      :actions="config.actions"
      :count="displayRows.length"
      @action="handleAction"
    />

    <!-- å†…å®¹åŒº -->
    <div class="acu-dash-body" :class="bodyClass">
      <template v-if="config.type === 'table' && table">
        <!-- ç½‘æ ¼å¼å±•ç¤º (NPCé£æ ¼) -->
        <div v-if="isGridStyle" class="acu-dash-npc-grid">
          <div
            v-for="row in displayRows"
            :key="row.key"
            class="acu-dash-npc-item acu-dash-interactive"
            :class="{ 'acu-highlight-changed': isRowChanged(row) }"
            @click="handleRowClick(row)"
          >
            {{ getDisplayValue(row) }}
          </div>
        </div>

        <!-- åˆ—è¡¨å¼å±•ç¤º (ä»»åŠ¡é£æ ¼) -->
        <div v-else class="acu-dash-list">
          <div
            v-for="row in displayRows"
            :key="row.key"
            class="acu-dash-list-item acu-dash-interactive"
            :class="{ 'acu-highlight-changed': isRowChanged(row) }"
            @click="handleRowClick(row)"
          >
            <i :class="['fas', itemIcon]"></i>
            {{ getDisplayValue(row) }}
            <Badge v-if="getBadgeValue(row)" :value="getBadgeValue(row)" />
          </div>
        </div>
      </template>

      <!-- ç©ºçŠ¶æ€ -->
      <div v-else class="acu-dash-empty">
        <i :class="['fas', config.icon]"></i>
        <span>æš‚æ— æ•°æ®</span>
      </div>
    </div>

    <!-- æŸ¥çœ‹æ›´å¤š -->
    <button
      v-if="hasMore"
      class="acu-dash-more-btn"
      @click="handleNavigate"
    >
      æŸ¥çœ‹å…¨éƒ¨ ({{ totalCount }})
    </button>
  </div>
</template>
```

### 4. DashboardWidgetHeader.vue (çœ‹æ¿å¤´éƒ¨)

```vue
<template>
  <div class="acu-dash-title">
    <span class="acu-dash-title-text">
      <i :class="['fas', icon]"></i>
      {{ title }}
      <Badge v-if="count > 0" :value="String(count)" type="number" />
    </span>

    <!-- å¿«æ·æŒ‰é’®åŒº -->
    <div class="acu-dash-actions">
      <button
        v-for="actionId in actions"
        :key="actionId"
        class="acu-dash-action-btn"
        :title="getActionTooltip(actionId)"
        @click.stop="$emit('action', actionId)"
      >
        <i :class="['fas', getActionIcon(actionId)]"></i>
      </button>
    </div>
  </div>
</template>
```

### 5. DashboardConfigDialog.vue (é…ç½®å¼¹çª—)

é…ç½®é¢æ¿å…è®¸ç”¨æˆ·ï¼š
1. é€‰æ‹©è¦æ·»åŠ çš„è¡¨æ ¼
2. é…ç½®æ˜¾ç¤ºåˆ—
3. è®¾ç½®æœ€å¤§è¡Œæ•°
4. é€‰æ‹©å¿«æ·æŒ‰é’®
5. æ‹–æ‹½æ’åº

---

## æ ·å¼è®¾è®¡ (å‚è€ƒ6.4.1)

åˆ é™¤ç°æœ‰ `dashboard.scss`ï¼Œé‡å†™ä¸ºï¼š

```scss
// =========================================
// Dashboard - ä»ªè¡¨ç›˜ (é‡æ„ç‰ˆ)
// =========================================

// å®¹å™¨å¸ƒå±€
.acu-dash-container {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 8px;
  height: 100%;
  overflow-y: auto;
  font-size: var(--acu-font-size);
  touch-action: pan-y;
}

// ç½‘æ ¼å¸ƒå±€
.acu-dash-grid {
  display: grid;
  grid-template-columns: repeat(var(--acu-dash-columns, 2), 1fr);
  gap: 16px;

  @media (max-width: 700px) {
    grid-template-columns: 1fr;
  }
}

// çœ‹æ¿å¡ç‰‡
.acu-dash-card {
  background: var(--acu-card-bg);
  border-radius: 12px;
  border: 1px solid var(--acu-border);
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  box-shadow: 0 4px 12px var(--acu-shadow);

  &.acu-dash-card-wide {
    grid-column: span 2;

    @media (max-width: 700px) {
      grid-column: span 1;
    }
  }
}

// çœ‹æ¿æ ‡é¢˜
.acu-dash-title {
  font-size: 1.2em;
  font-weight: bold;
  color: var(--acu-title-color);
  border-bottom: 1px dashed var(--acu-border);
  padding-bottom: 8px;
  display: flex;
  justify-content: space-between;
  align-items: center;

  .acu-dash-title-text {
    display: flex;
    align-items: center;
    gap: 8px;

    i {
      font-size: 0.9em;
    }
  }
}

// å¿«æ·æŒ‰é’®åŒº
.acu-dash-actions {
  display: flex;
  gap: 4px;
}

.acu-dash-action-btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--acu-btn-bg);
  border: 1px solid transparent;
  border-radius: 6px;
  color: var(--acu-text-sub);
  cursor: pointer;
  transition: all 0.2s;

  &:hover {
    background: var(--acu-btn-hover);
    color: var(--acu-title-color);
    border-color: var(--acu-border);
  }
}

// NPC ç½‘æ ¼
.acu-dash-npc-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 8px;
}

.acu-dash-npc-item {
  background: var(--acu-table-head);
  padding: 10px;
  border-radius: 8px;
  cursor: pointer;
  text-align: center;
  border: 1px solid transparent;
  transition: all 0.2s;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--acu-text-main);
  font-size: 1em;

  &:hover {
    border-color: var(--acu-highlight);
    color: var(--acu-highlight);
    background: var(--acu-btn-bg);
  }
}

// åˆ—è¡¨é¡¹
.acu-dash-list {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.acu-dash-list-item {
  padding: 6px 0;
  border-bottom: 1px solid var(--acu-border);
  color: var(--acu-text-sub);
  font-size: 1em;
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;

  &:last-child {
    border-bottom: none;
  }

  &:hover {
    color: var(--acu-text-main);
    padding-left: 4px;
  }

  i {
    font-size: 0.8em;
    color: var(--acu-highlight);
  }
}

// äº¤äº’çŠ¶æ€
.acu-dash-interactive {
  cursor: pointer !important;
  position: relative;

  &:hover::after {
    content: '\f002';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    position: absolute;
    right: 5px;
    top: 50%;
    transform: translateY(-50%);
    opacity: 0.5;
    font-size: 10px;
  }
}

// å˜åŠ¨é«˜äº®
.acu-dash-npc-item.acu-highlight-changed,
.acu-dash-list-item.acu-highlight-changed {
  color: var(--acu-highlight) !important;
  background-color: var(--acu-highlight-bg);
  font-weight: bold;
  animation: pulse-highlight 2s infinite;
}

// æŸ¥çœ‹æ›´å¤š
.acu-dash-more-btn {
  display: block;
  width: 100%;
  padding: 8px;
  text-align: center;
  background: transparent;
  border: none;
  color: var(--acu-text-sub);
  cursor: pointer;
  font-size: 0.9em;
  transition: color 0.2s;

  &:hover {
    color: var(--acu-title-color);
  }
}

// ç©ºçŠ¶æ€
.acu-dash-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  color: var(--acu-text-sub);
  text-align: center;

  i {
    font-size: 24px;
    margin-bottom: 8px;
    opacity: 0.5;
  }
}

// æ·»åŠ æŒ‰é’®
.acu-dash-add-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 120px;
  background: var(--acu-btn-bg);
  border: 2px dashed var(--acu-border);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
  color: var(--acu-text-sub);
  font-size: 24px;

  &:hover {
    border-color: var(--acu-title-color);
    color: var(--acu-title-color);
    background: var(--acu-table-hover);
  }
}
```

---

## å®ç°æ­¥éª¤ä¸è¿›åº¦

### âœ… å·²å®Œæˆéƒ¨åˆ† (åŸºç¡€æ¶æ„)

| ä»»åŠ¡ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| ç±»å‹å®šä¹‰ | `types.ts` | `DashboardWidgetConfig`, `WIDGET_ACTIONS`, `WIDGET_TEMPLATES` ç­‰ |
| å­˜å‚¨å±‚ | `useDashboardStore.ts` | æ”¹ä¸ºèŠå¤©å˜é‡å­˜å‚¨ï¼ŒCRUD æ“ä½œ |
| æ ·å¼ | `dashboard.scss` | åŸºç¡€æ ·å¼ |
| é€šç”¨ç»„ä»¶ | `DashboardWidget.vue` | åŸºç¡€ç‰ˆæœ¬ |
| ä¸»å®¹å™¨ | `Dashboard.vue` | åŠ¨æ€é…ç½®ç‰ˆæœ¬ |
| ç¼–è¾‘æ€ | Dashboard + Widget | åŸºç¡€ç¼–è¾‘æ§ä»¶ |
| å¿«æ·æŒ‰é’®å¼¹çª— | Dashboard.vue å†…åµŒ | åŸºç¡€ç‰ˆæœ¬ |

---

### ğŸ› BUG ä¿®å¤æ¸…å• [å¾…å¤„ç†]

| # | é—®é¢˜æè¿° | å½±å“æ–‡ä»¶ | ä¼˜å…ˆçº§ |
|---|----------|----------|--------|
| B1 | ç§»é™¤"æŸ¥çœ‹å…¨éƒ¨"æŒ‰é’® - å³ä¸Šè§’å·²æœ‰è·³è½¬å¿«æ·é”® | `DashboardWidget.vue` | é«˜ |
| B2 | ç¼–è¾‘æ¨¡å¼å–æ¶ˆæŠ–åŠ¨åŠ¨ç”» - ä¼¤çœ¼ç› | `dashboard.scss` | é«˜ |
| B3 | ç»„ä»¶å³ä¸Š+å·ç‚¹å‡»åè¦å¼¹å‡ºå¿«æ·å›¾æ ‡é…ç½®å¼¹çª— | `Dashboard.vue` | é«˜ |
| B4 | ä»ªè¡¨ç›˜é¡¶æ æ·»åŠ æŒ‰é’®æ— ååº” | `Dashboard.vue` | é«˜ |
| B5 | è¡¨å¤´æ˜¾ç¤ºè¡¨IDè€Œéè¡¨å | `DashboardWidget.vue` | é«˜ |
| B6 | ç‰©å“æ ä¸èƒ½æ»šåŠ¨ | `dashboard.scss` / `DashboardWidget.vue` | é«˜ |
| B7 | ä»»åŠ¡æ æ˜¾ç¤ºé‡å¤å€¼ï¼ˆåŒä¸€è¡Œä¸¤ä¸ªä»»åŠ¡åï¼‰ | `DashboardWidget.vue` | é«˜ |
| B8 | PCæ‹–åŠ¨ç»„ä»¶æ—¶æ»šè½®ä¸å¯ç”¨ | `Dashboard.vue` | ä¸­ |

---

### ğŸ†• æ–°åŠŸèƒ½éœ€æ±‚ [å¾…å®ç°]

| # | åŠŸèƒ½æè¿° | å½±å“æ–‡ä»¶ | ä¼˜å…ˆçº§ |
|---|----------|----------|--------|
| F1 | **ä»ªè¡¨ç›˜é¡¶æ é‡æ„** - å¸ƒå±€ï¼šä»ªè¡¨ç›˜æ ‡é¢˜ / (ç©º) / ç¼–è¾‘å›¾æ ‡ / é«˜åº¦æ‹–æ‰‹ / æœç´¢æ¡† | `Dashboard.vue` | é«˜ |
| F2 | **æ‹–åŠ¨æ’åºæ”¹ä¸ºæ‹–é¡¶æ ** - ç¼–è¾‘æ€æ‹–åŠ¨ç»„ä»¶é¡¶æ æ¢ä½ | `DashboardWidget.vue` | é«˜ |
| F3 | **ç§»åŠ¨ç«¯æ‹–åŠ¨æ»šåŠ¨** - è¯†åˆ«æ‹–åŠ¨æ„å›¾æ—¶æ»šåŠ¨æ¡è·Ÿéš | `Dashboard.vue` | ä¸­ |
| F4 | **è¡Œæœ«ç¼–è¾‘æŒ‰é’®** - ç‚¹å‡»æ‰“å¼€å¯ç¼–è¾‘å¡ç‰‡å¼¹çª—ï¼ˆå¤ç”¨å†å²è®°å½•æ ·å¼ï¼‰ | `DashboardWidget.vue` + æ–°å¼¹çª— | ä¸­ |
| F5 | **PCæ‚¬æµ®å¿«é€Ÿé¢„è§ˆ** - é¼ æ ‡ç§»åˆ°è¡Œä¸Šæ˜¾ç¤ºé¢„è§ˆå¡ç‰‡ | `DashboardWidget.vue` | ä¸­ |
| F6 | **ç»„ä»¶é¡¶æ è®¾ç½®æŒ‰é’®** - æ¯ä¸ªè¡¨ç»„ä»¶é¡¶æ åŠ è®¾ç½®å›¾æ ‡ | `DashboardWidget.vue` | ä½ |

---

### ğŸ“‹ å¾…å®ç°ä»»åŠ¡æ˜ç»†

#### Phase A: BUG ä¿®å¤

```
[ ] B1: ç§»é™¤ DashboardWidget.vue ä¸­çš„"æŸ¥çœ‹å…¨éƒ¨"æŒ‰é’®
[ ] B2: ç§»é™¤ dashboard.scss ä¸­çš„ widget-wiggle æŠ–åŠ¨åŠ¨ç”»
[ ] B3: ä¿®å¤ç»„ä»¶å³ä¸Š+å·è§¦å‘å¿«æ·æŒ‰é’®é…ç½®å¼¹çª—
[ ] B4: ä¿®å¤ä»ªè¡¨ç›˜é¡¶æ æ·»åŠ æŒ‰é’®äº‹ä»¶ç»‘å®š
[ ] B5: ä¿®å¤è¡¨åæ˜¾ç¤º - ä½¿ç”¨ table.name è€Œé table.id
[ ] B6: ä¿®å¤ç»„ä»¶å†…å®¹åŒºæ»šåŠ¨ (ç¡®ä¿ max-height + overflow-y: auto)
[ ] B7: ä¿®å¤ä»»åŠ¡æ é‡å¤æ˜¾ç¤º - getDisplayValue é€»è¾‘
[ ] B8: ä¿®å¤PCæ‹–åŠ¨æ—¶æ»šè½®é—®é¢˜
```

#### Phase B: é¡¶æ é‡æ„

```
[ ] F1.1: é‡æ„ Dashboard.vue é¡¶æ å¸ƒå±€
      - å·¦ä¾§: ä»ªè¡¨ç›˜æ ‡é¢˜
      - ä¸­é—´: flex-grow å ç©º
      - å³ä¾§: ç¼–è¾‘å›¾æ ‡ | é«˜åº¦æ‹–æ‰‹ | æœç´¢æ¡†
[ ] F1.2: é›†æˆæœç´¢æ¡†ç»„ä»¶
[ ] F1.3: é›†æˆé«˜åº¦æ‹–æ‰‹åŠŸèƒ½
```

#### Phase C: æ‹–åŠ¨æ’åºä¼˜åŒ–

```
[ ] F2.1: ç¼–è¾‘æ€æ”¹ä¸ºæ‹–åŠ¨ç»„ä»¶é¡¶æ åŒºåŸŸæ¢ä½
[ ] F2.2: éç¼–è¾‘æ€ç¦ç”¨æ‹–åŠ¨
[ ] F3.1: ç§»åŠ¨ç«¯æ‹–åŠ¨æ—¶æ»šåŠ¨è·Ÿéš
```

#### Phase D: è¡Œäº¤äº’å¢å¼º

```
[ ] F4.1: è¡Œæœ«æ·»åŠ ç¼–è¾‘æŒ‰é’®
[ ] F4.2: åˆ›å»ºè¡Œç¼–è¾‘å¼¹çª— (å¤ç”¨å†å²è®°å½•å¼¹çª—æ ·å¼)
[ ] F5.1: PCç«¯é¼ æ ‡æ‚¬æµ®è¡Œæ—¶æ˜¾ç¤ºå¿«é€Ÿé¢„è§ˆ
```

#### Phase E: ç»„ä»¶è®¾ç½®

```
[ ] F6.1: ç»„ä»¶é¡¶æ æ·»åŠ è®¾ç½®æŒ‰é’®
[ ] F6.2: è®¾ç½®æŒ‰é’®åŠŸèƒ½å¾…å®š (é¢„ç•™æ¥å£)
```

---

## å¾…ç¡®è®¤äº‹é¡¹

1. **è¡¨æ ¼ç»Ÿè®¡æ•°æ®æ¥æº**ï¼šæ›´æ–°é¢‘ç‡å’Œæœªæ›´æ–°æ¥¼å±‚æ•°å¦‚ä½•ä»æ•°æ®åº“è·å–ï¼Ÿ
   - éœ€è¦ç¡®è®¤ `AutoCardUpdaterAPI` æ˜¯å¦æä¾›ç›¸å…³æ¥å£
   - å¦‚æ— ç°æˆæ¥å£ï¼Œæ­¤åŠŸèƒ½æš‚æ—¶æç½®

2. ~~**é…ç½®å­˜å‚¨ä½ç½®**~~ï¼šâœ… å·²ç¡®å®š
   - ä½¿ç”¨é…’é¦†å…¨å±€å˜é‡ (`getVariables({ type: 'global' })`)
   - å­˜å‚¨åœ¨ `acu_dashboard_config` é”®ä¸‹

3. ~~**é¢„è®¾æ¨¡æ¿è¡Œä¸º**~~ï¼šâœ… å·²å®ç°
   - `TABLE_KEYWORD_RULES` å®šä¹‰å…³é”®è¯åŒ¹é…è§„åˆ™
   - æ·»åŠ çœ‹æ¿æ—¶è‡ªåŠ¨åŒ¹é…æ¨¡æ¿

---

## å½“å‰æ–‡ä»¶çŠ¶æ€

| æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| `types.ts` | âœ… å®Œæˆ | ç±»å‹å®šä¹‰ (è¡Œ 588-720+) |
| `useDashboardStore.ts` | ğŸ”„ éœ€ä¿®æ”¹ | Store å®ç° - éœ€æ”¹ä¸ºèŠå¤©å˜é‡å­˜å‚¨ |
| `dashboard.scss` | âœ… å®Œæˆ | æ ·å¼æ–‡ä»¶ (356 è¡Œ) |
| `Dashboard.vue` | ğŸ”„ éœ€é‡æ„ | ç¡¬ç¼–ç ç‰ˆï¼Œéœ€æ”¹ä¸ºåŠ¨æ€é…ç½® |
| `DashboardWidget.vue` | âŒ å¾…åˆ›å»º | é€šç”¨çœ‹æ¿ç»„ä»¶ |
| `WidgetActionsDialog.vue` | âŒ å¾…åˆ›å»º | å¿«æ·æŒ‰é’®é…ç½®å¼¹çª— |
| `AddWidgetDialog.vue` | âŒ å¾…åˆ›å»º | æ·»åŠ ç»„ä»¶å¼¹çª— |

---

## è¯¦ç»†å®ç°è§„æ ¼

### 1. useDashboardStore.ts ä¿®æ”¹

**å½“å‰ä»£ç ä½ç½®**: `src/å¯è§†åŒ–è¡¨æ ¼/stores/useDashboardStore.ts`

**ä¿®æ”¹å†…å®¹**:
```typescript
// æ—§ä»£ç  (è¡Œ 63-64, 84-85)
const vars = getVariables({ type: 'global' });
replaceVariables({ ...currentVars, acu_dashboard_config: config.value }, { type: 'global' });

// æ–°ä»£ç 
const vars = getVariables({ type: 'chat' });
replaceVariables({ ...currentVars, acu_dashboard_config: config.value }, { type: 'chat' });
```

### 2. DashboardWidget.vue ç»„ä»¶è§„æ ¼

**æ–‡ä»¶è·¯å¾„**: `src/å¯è§†åŒ–è¡¨æ ¼/components/dashboard/DashboardWidget.vue`

**Props**:
```typescript
interface Props {
  config: DashboardWidgetConfig;  // çœ‹æ¿é…ç½®
  tableData: ProcessedTable | null;  // è¡¨æ ¼æ•°æ®
  isEditing: boolean;  // æ˜¯å¦å¤„äºç¼–è¾‘æ€
  diffMap: Set<string>;  // å˜æ›´è¡Œé›†åˆ
}
```

**Emits**:
```typescript
const emit = defineEmits<{
  'navigate': [tableId: string];  // è·³è½¬åˆ°è¡¨æ ¼
  'row-click': [tableId: string, row: TableRow];  // ç‚¹å‡»è¡Œ
  'action': [actionId: WidgetActionId, tableId: string];  // å¿«æ·æŒ‰é’®
  'remove': [widgetId: string];  // ç§»é™¤ç»„ä»¶
  'resize': [widgetId: string, colSpan: 1 | 2];  // æ”¹å˜å¤§å°
  'config-actions': [widgetId: string];  // é…ç½®å¿«æ·æŒ‰é’®
}>();
```

**æ¨¡æ¿ç»“æ„**:
```vue
<template>
  <div class="acu-dash-widget" :class="{
    'acu-dash-widget-wide': config.colSpan === 2,
    'acu-dash-widget-editing': isEditing
  }">
    <!-- ç¼–è¾‘æ§ä»¶ (ä»…ç¼–è¾‘æ€æ˜¾ç¤º) -->
    <template v-if="isEditing">
      <button class="acu-widget-remove" @click.stop="emit('remove', config.id)">Ã—</button>
      <button class="acu-widget-config" @click.stop="emit('config-actions', config.id)">+</button>
      <div class="acu-widget-resize" @mousedown="startResize">â¤¡</div>
    </template>

    <!-- å¤´éƒ¨ -->
    <div class="acu-dash-title">
      <span class="acu-dash-title-text">
        <i :class="['fas', config.icon]"></i>
        {{ config.title }}
        <Badge v-if="rowCount > 0" :value="String(rowCount)" />
      </span>
      <div class="acu-dash-actions">
        <button v-for="actionId in config.actions" ...>
      </div>
    </div>

    <!-- å†…å®¹åŒº (å¯æ»šåŠ¨) -->
    <div class="acu-dash-body" :style="{ maxHeight: bodyMaxHeight }">
      <!-- grid/list/compact ä¸‰ç§æ˜¾ç¤ºé£æ ¼ -->
    </div>

    <!-- æŸ¥çœ‹æ›´å¤š -->
    <button v-if="hasMore" class="acu-dash-more-btn" @click="emit('navigate', config.tableId)">
      æŸ¥çœ‹å…¨éƒ¨ ({{ totalCount }})
    </button>
  </div>
</template>
```

### 3. Dashboard.vue é‡æ„è§„æ ¼

**æ¨¡æ¿ç»“æ„**:
```vue
<template>
  <div class="acu-dash-container">
    <!-- é¡¶æ  -->
    <div class="acu-dash-header">
      <span class="acu-dash-header-title">ä»ªè¡¨ç›˜</span>
      <div class="acu-dash-header-actions">
        <template v-if="isEditing">
          <button class="acu-dash-add-widget-btn" @click.stop="showAddDialog = true">
            <i class="fas fa-plus"></i> æ·»åŠ 
          </button>
          <button class="acu-dash-done-btn" @click.stop="isEditing = false">å®Œæˆ</button>
        </template>
        <template v-else>
          <button class="acu-dash-edit-btn" @click.stop="isEditing = true">ç¼–è¾‘</button>
        </template>
      </div>
    </div>

    <!-- ç»„ä»¶ç½‘æ ¼ (å¯æ•´ä½“æ»šåŠ¨) -->
    <div class="acu-dash-grid" ref="gridRef">
      <DashboardWidget
        v-for="widget in enabledWidgets"
        :key="widget.id"
        :config="widget"
        :table-data="getTableData(widget.tableId)"
        :is-editing="isEditing"
        :diff-map="diffMap"
        @navigate="handleNavigate"
        @row-click="handleRowClick"
        @action="handleAction"
        @remove="handleRemove"
        @resize="handleResize"
        @config-actions="showActionsDialog"
      />
    </div>

    <!-- å¼¹çª— -->
    <AddWidgetDialog v-if="showAddDialog" @close="showAddDialog = false" @add="handleAddWidget" />
    <WidgetActionsDialog v-if="editingWidgetId" ... />
  </div>
</template>
```

### 4. æ ·å¼è§„æ ¼è¡¥å…… (dashboard.scss)

éœ€è¦æ–°å¢çš„æ ·å¼:
```scss
// é¡¶æ 
.acu-dash-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  border-bottom: 1px solid var(--acu-border);
  background: var(--acu-bg-nav);
}

// ç¼–è¾‘æ€ç»„ä»¶
.acu-dash-widget-editing {
  position: relative;
  border: 2px dashed var(--acu-title-color);
  animation: widget-wiggle 0.3s ease-in-out infinite;
}

// ç¼–è¾‘æ§ä»¶
.acu-widget-remove {
  position: absolute;
  top: -10px;
  left: -10px;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: var(--acu-danger, #e74c3c);
  color: white;
  border: none;
  cursor: pointer;
  z-index: 10;
}

.acu-widget-config {
  position: absolute;
  top: -10px;
  right: -10px;
  // ç±»ä¼¼ remove æ ·å¼
}

.acu-widget-resize {
  position: absolute;
  bottom: -10px;
  right: -10px;
  width: 24px;
  height: 24px;
  cursor: nwse-resize;
  // æ‹–åŠ¨æ‰‹æŸ„æ ·å¼
}

// ç»„ä»¶å†…å®¹åŒºæ»šåŠ¨
.acu-dash-body {
  max-height: 200px;  // å¯é…ç½®
  overflow-y: auto;
  overflow-x: hidden;
}

// ç½‘æ ¼æ•´ä½“æ»šåŠ¨
.acu-dash-grid {
  flex: 1;
  overflow-y: auto;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  padding: 16px;
}

// iOS å°ç»„ä»¶æŠ–åŠ¨åŠ¨ç”»
@keyframes widget-wiggle {
  0%, 100% { transform: rotate(-0.5deg); }
  50% { transform: rotate(0.5deg); }
}
```

### 5. äº¤äº’æµç¨‹å›¾

```
ç”¨æˆ·è¿›å…¥ä»ªè¡¨ç›˜
    â”‚
    â”œâ”€â†’ æ™®é€šæ€: æ˜¾ç¤ºæ‰€æœ‰ç»„ä»¶ï¼Œå¯æ­£å¸¸äº¤äº’
    â”‚       â”‚
    â”‚       â””â”€â†’ ç‚¹å‡»[ç¼–è¾‘]æŒ‰é’®
    â”‚               â”‚
    â”‚               â–¼
    â””â”€â†’ ç¼–è¾‘æ€: ç»„ä»¶æ˜¾ç¤ºç¼–è¾‘æ§ä»¶ï¼Œå¼€å§‹æŠ–åŠ¨
            â”‚
            â”œâ”€â†’ ç‚¹å‡»[Ã—]: ç§»é™¤ç»„ä»¶
            â”‚       â””â”€â†’ è°ƒç”¨ dashboardStore.removeWidget(id)
            â”‚
            â”œâ”€â†’ ç‚¹å‡»[+]: æ‰“å¼€å¿«æ·æŒ‰é’®é…ç½®å¼¹çª—
            â”‚       â””â”€â†’ é€‰æ‹©åè°ƒç”¨ dashboardStore.setWidgetActions(id, actions)
            â”‚
            â”œâ”€â†’ æ‹–åŠ¨[â¤¡]: æ”¹å˜å¤§å°
            â”‚       â””â”€â†’ å•æ â†”åŒæ åˆ‡æ¢ï¼Œè°ƒç”¨ dashboardStore.updateWidget(id, {colSpan})
            â”‚
            â”œâ”€â†’ æ‹–åŠ¨æ•´ä½“: æ¢ä½ç½®
            â”‚       â””â”€â†’ è°ƒç”¨ dashboardStore.moveWidget(id, newOrder)
            â”‚
            â”œâ”€â†’ ç‚¹å‡»é¡¶æ [+æ·»åŠ ]: æ‰“å¼€æ·»åŠ ç»„ä»¶å¼¹çª—
            â”‚       â””â”€â†’ é€‰æ‹©è¡¨æ ¼åè°ƒç”¨ dashboardStore.addWidget(tableId)
            â”‚
            â””â”€â†’ ç‚¹å‡»[å®Œæˆ]: é€€å‡ºç¼–è¾‘æ€
                    â””â”€â†’ isEditing = false
```

---

## Mermaid æ¶æ„å›¾

```mermaid
graph TB
    subgraph Dashboard ä»ªè¡¨ç›˜
        DC[Dashboard.vue ä¸»å®¹å™¨]
        DG[DashboardGrid ç½‘æ ¼å¸ƒå±€]
        DW[DashboardWidget çœ‹æ¿ç»„ä»¶]
        DH[DashboardWidgetHeader å¤´éƒ¨]
        DB[DashboardWidgetBody å†…å®¹åŒº]
        DS[DashboardStatsCard ç»Ÿè®¡å¡ç‰‡]
        DA[DashboardAddButton æ·»åŠ æŒ‰é’®]
    end

    subgraph Config é…ç½®
        DCD[DashboardConfigDialog é…ç½®å¼¹çª—]
        CS[useConfigStore é…ç½®å­˜å‚¨]
    end

    subgraph Data æ•°æ®
        DataStore[useDataStore]
        Tables[ProcessedTable è¡¨æ ¼æ•°æ®]
    end

    DC --> DG
    DG --> DW
    DG --> DS
    DG --> DA
    DW --> DH
    DW --> DB

    DA --> DCD
    DCD --> CS

    DW --> DataStore
    DataStore --> Tables

    CS --> DC
```

```mermaid
flowchart LR
    subgraph Actions å¿«æ·æŒ‰é’®
        A1[goToTable è·³è½¬]
        A2[clear æ¸…é™¤]
        A3[undo æ’¤å›]
        A4[manualUpdate æ›´æ–°]
        A5[relationshipGraph å…³ç³»å›¾]
    end

    DH[WidgetHeader] --> A1
    DH --> A2
    DH --> A3
    DH --> A4
    DH --> A5

    A1 --> MainPanel[åˆ‡æ¢Tab]
    A2 --> PurgeDialog[æ¸…é™¤å¼¹çª—]
    A3 --> HistoryDialog[å†å²è®°å½•]
    A4 --> ManualUpdateDialog[æ‰‹åŠ¨æ›´æ–°å¼¹çª—]
    A5 --> RelationshipGraph[å…³ç³»å›¾ç»„ä»¶]
